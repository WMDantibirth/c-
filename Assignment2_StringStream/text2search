    1: What is C++0x ? What is C++0x ?
    2: 
    3: 
    4: Bjarne Stroustrup 
    5: 
    6: Abstract 
    7: 
    8: This paper illustrates the power of C++ through some simple examples of C++0x code presented 
    9: in the context of their role in C++. My aim is to give an idea of the breath of the facilities and an 
   10: understanding of the aims of C++, rather than offering an in-depth understanding of any 
   11: individual feature. The list of language features and standard library facilities described is too 
   12: long mention here, but a major theme is the role of features as building blocks for elegant and 
   13: efficient software, especially software infrastructure components. The emphasis is on C++＊s 
   14: facilities for building lightweight abstractions. 
   15: 
   16: Introduction 
   17: 
   18: What is C++0x? I don＊t mean ※How does C++0x differ from C++98?§ I mean what kind of language is 
   19: C++0x? What kinds of programming are C++0x good for? In fact, I could drop the ※0x§ right here and 
   20: attack the fundamental question directly: What is C++? Or, if you feel pedantic, ※What will C++ be once 
   21: we have the facilities offered by the upcoming standard?§ This is not an innocent ※just philosophical§ 
   22: question. Consider how many programmers have been harmed by believing that ※C++ is an object-
   23: oriented language§ and ※religiously§ built all code into huge class hierarchies, missing out on simpler, 
   24: more modular approaches and on generic programming. Of course C++ also supports OOP, but a simple 
   25: label 每 especially if supported by doctrinaire teaching 每 can do harm by overly narrowing a programmer＊s 
   26: view of what can be considered reasonable code. 
   27: 
   28: I will discuss the ※what is?§ question in the context of C++0x, the upcoming revision of the ISO C++ 
   29: standard. The examples will emphasize what＊s new in C++0x, but the ※commentary§ will emphasize their 
   30: place in the general C++ design philosophy. Despite ※x§ in ※C++0x§ becoming hexadecimal, I＊ll use the 
   31: present tense because most features described are already available for exploratory or experimental use (if 
   32: not necessarily all in the same implementation). Also, for the benefit of people with an allergy to 
   33: philosophy, I will discuss ideas and facilities in the context of concrete code examples. 
   34: 
   35: The rest of this paper is organized like this: 
   36: 
   37: . Simplifying simple tasks 
   38: . Initialization 
   39: . Support for low-level programming 
   40: . Tools for writing classes 
   41: . Concurrency 
   42: . The sum of the language extensions 
   43: 
   44: 
   45: 
   46: . Standard library components 
   47: . So, what does this add up to? 
   48: 
   49: 
   50: That is, I roughly proceed from the simple to the complex. If you want more examples, more details, 
   51: and/or more precision, see my online C++0x FAQ [Stroustrup], which contains references to the actual 
   52: proposals with the names of the people who did most of the work and to the draft standard itself [Becker, 
   53: 2009]. 
   54: 
   55: Simplifying simple tasks 
   56: 
   57: Much of what there is to like and dislike about a programming language are minor details; the kind of 
   58: minor design decisions, omissions, and mistakes that escape academic attention. For C++0x, quite a bit of 
   59: attention has been paid to ※removing embarrassments§ found in C++98 and simplifying and generalizing 
   60: rules for the use of the language and standard library. 
   61: 
   62: Deducing a type, etc. 
   63: 
   64: Consider: 
   65: 
   66:  cout << sqrt(2); 
   67: 
   68: Obviously, this should work, but it does not in C++98: The compiler couldn＊t decide which of the several 
   69: overloads of sqrt() to pick. Now it can (there are now sufficient overloads to get a right answer), but what 
   70: if you want the value ※right here§ and not as an argument to an overloaded function or a template? 
   71: 
   72: auto x = sqrt(2); 
   73: 
   74: By using auto instead of a specific type, you tell the compiler that the type of x is the type of its 
   75: initializer. In this case, that happens to be double. In many templates, auto can save you from over-
   76: specification and in some cases auto saves you from writing some long-winded type: 
   77: 
   78:  for (auto p = v.begin(); p!=v.end(); ++p) cout <<*p; 
   79: 
   80: Say that v was a vector<list<double,Myallocator<double>>> and that a suitable definition of 
   81: operator<<() for lists was available. In this case, I saved myself from writing something like 
   82: 
   83: for (vector<list<double,Myallocator<double>>>::iterator p = v.begin(); 
   84: 
   85: p!=v.end(); 
   86: 
   87: ++p) 
   88: 
   89: cout <<*p; 
   90: 
   91: I consider that improvement significant 每 even more so for a reader and a maintainer than for the original 
   92: programmer. 
   93: 
   94:  ※auto§ is the oldest improvement in C++0x: I first implemented it in C with Classes in the winter of 
   95: 1983/84, but was forced to take it out because of the obvious(?) C incompatibility. Please also note that I 
   96: did not say vector< list< double, Myallocator<double> > >. We can now do without those annoying 
   97: extra spaces. 
   98: 
   99: 
  100: Such ※trivial improvements§ can matter disproportionally. A tiny stone in a boot can spoil a whole day 
  101: and a tiny irregularity in a language can make a programmer＊s day miserable. However, a programmer 
  102: cannot simply remove a language irregularity 每 at best it can be hidden behind an interface until a 
  103: standards committee gets around to the problem. 
  104: 
  105: Range for loop 
  106: 
  107: Let＊s step up one level from the minute to the small. Why did we play around with iterators to print the 
  108: elements in that vector? We need the generality offered by iterators for many important loops, but in most 
  109: cases, we don＊t care about details, we just want to do something to each element, so we can say: 
  110: 
  111:  for (auto x : v) cout << x; 
  112: 
  113: That＊s not just shorter, but also a more precise specification of what we do. If we wanted to access 
  114: neighboring elements, iterate backwards, or whatever, we can do so (using the familiar and general for 
  115: loop), but with this ※range for loop§ we know that nothing complicated happens in the loop body as soon 
  116: as we see the header of the for-statement. 
  117: 
  118: This range-for loop works for all ranges; that is, for every data structure that has a beginning and an end 
  119: so that you can iterate trough it in the conventional way. So it works for std::vector, std::list, std::array, 
  120: built-in arrays, etc. 
  121: 
  122: Note the use of auto in that loop; I did not have to mention v＊s type. That＊s good because in generic 
  123: programs that type can be very hard to express. Consider: 
  124: 
  125:  template<class C> print_all(const C& v) 
  126: 
  127:  { 
  128: 
  129: for (const auto& x : v) cout << x; 
  130: 
  131:  } 
  132: 
  133:  
  134: 
  135: This can be called with any ※container§ or ※range§ providing a begin() and an end(). Since C was 
  136: declared const and I don＊t know the size of the elements, I decorated auto with const and &. 
  137: 
  138: Initialization 
  139: 
  140: Trying to make rules more general and to minimize spurious typing has a long tradition in C++ and most 
  141: other languages. I suspect it is a never-ending task, but of course the desire for uniformity of rules and 
  142: simple notation is not restricted to trivial examples. In particular, every irregularity is a source of 
  143: complexity, added learning time, and bugs (when you make the wrong choice among alternatives). 
  144: Irregularity also becomes a barrier to generic programming, which critically depends on identical notation 
  145: for a set of types. One area where uniformity and generality is seriously lacking in C++98 is initialization. 
  146: There is a bewildering variety of syntaxes ({＃}, (＃), =＃, or default), semantics (e.g., copy or 
  147: construct), and applicability (can I use a {＃} initializer for new? for a vector? Can I use a (＃) initializer 
  148: for a local variable?). Some of this irregularity goes all the way back to the early days of C, but C++0x 
  149: manages to unify and generalize all of these mechanisms: You can use {＃} initialization everywhere. For 
  150: example: 
  151: 
  152: int v1 = 7; 
  153: 
  154: 
  155: int v2(7); 
  156: 
  157: int v3 = { 7 }; // yes that＊s legal C and C++98 
  158: 
  159: int v4 {7}; // new for C++0x: initialize v4 with 7 
  160: 
  161:  
  162: 
  163: int x1; // default x1 becomes 0 (unless x1 is a local variable) 
  164: 
  165: int x2(); // oops a function declaration 
  166: 
  167: int x3 = {}; // new for C++0x: give x3 the default int value (0) 
  168: 
  169: int x4{}; // new for C++0x: give x4 the default int value (0) 
  170: 
  171:  
  172: 
  173: What could be simpler than initializing an int? Yet, we see surprises and irregularities. This gets much 
  174: more interesting when we consider aggregates and containers: 
  175: 
  176:  
  177: 
  178:  int a[] = { 1, 2, 3 }; 
  179: 
  180:  S s = { 1, 2, 3 }; // ok, maybe 
  181: 
  182:  std::vector<int> v1 = { 1, 2, 3 }; // new in C++0x 
  183: 
  184:  std::vector<int> v2 { 1, 2, 3 }; // new in C++0x 
  185: 
  186:  
  187: 
  188: It always bothered me that we couldn＊t handle v1 in C++. That violated the principle that user-defined 
  189: and built-in types should receive equivalent support (so why does my favorite container, vector, get 
  190: worse support than the perennial problem, array?). It also violated the principle that fundamental 
  191: operations should receive direct support (what＊s more fundamental than initialization?). 
  192: 
  193: When does S s = { 1, 2, 3 }; actually work? It works in C++98 iff S is a struct (or an array) with at least 
  194: three members that can be initialized by an int and iff S does not declare a constructor. That answer is too 
  195: long and depends on too many details about S. In C++0x, the answer boils down to ※iff S can be 
  196: initialized by three integers.§ In particular, that answer does not depend on how that initialization is done 
  197: (e.g. constructors or not). Also, the answer does not depend on exactly what kind of variable is being 
  198: initialized. Consider: 
  199: 
  200:  
  201: 
  202: int a[] = { 1, 2, 3 }; 
  203: 
  204: void f1(const int(&)[3]); // reference to array 
  205: 
  206: f1({1,2,3}); // new in C++0x 
  207: 
  208: p1 = new int[]{1,2,3}; // new in C++0x 
  209: 
  210:  
  211: 
  212:  S s = { 1, 2, 3 }; // ok, maybe 
  213: 
  214:  void f2(S); 
  215: 
  216:  f2({1,2,3}); // new in C++0x 
  217: 
  218:  p2 = new S {1,2,3}; // new in C++0x 
  219: 
  220:  
  221: 
  222:  std::vector<int> v2 { 1, 2, 3 }; // new in C++0x 
  223: 
  224:  void f3(std::vector<int>); 
  225: 
  226: f3({ 1, 2, 3 }); // new in C++0x 
  227: 
  228: p3 = new std::vector{1,2,3}; // new in C++0x 
  229: 
  230:  
  231: 
  232: 
  233: Why didn＊t I just say void f1(int[])? Well, compatibility is hard to deal with. That [] ※decays§ to * so 
  234: unfortunately void f1(int[]) is just another way of saying void f1(int*) and we can＊t initialize a pointer 
  235: with a list. Array decay is the root of much evil. 
  236: 
  237:  
  238: 
  239: I don＊t have the time or space to go into details, but I hope you get the idea that something pretty dramatic 
  240: is going on here: We are not just adding yet another mechanism for initialization, C++0x provides a 
  241: single uniform mechanism for initializing objects of all types. For every type X, and wherever an 
  242: initialization with a value v makes sense, we can say X{v} and the resulting object of type X will have the 
  243: same value in all cases. For example: 
  244: 
  245:  
  246: 
  247:  X x{v}; 
  248: 
  249:  X* p = new X{v}; 
  250: 
  251:  auto x2 = X{v}; // explicit conversion 
  252: 
  253:  void f(X); 
  254: 
  255:  f(X{v}); 
  256: 
  257:  f({v}); 
  258: 
  259:  struct C : X { 
  260: 
  261: C() : X{v}, a{v} { } 
  262: 
  263: X a; 
  264: 
  265: // ＃ 
  266: 
  267: }; 
  268: 
  269:  
  270: 
  271: Have fun imagining how to do that using C++98 for all types you can think of (note that X might be a 
  272: container, v might be a list of values or empty). One of my favorites is where X is a char* and v is 7. 
  273: 
  274: Support for low-level programming 
  275: 
  276: There is a school of thought that all programming these days is ※web services§ and that ※efficiency§ 
  277: ceased to matter decades ago. If that＊s your world, the lower reaches of C++ are unlikely to be of much 
  278: interest. However, most computers these days are embedded, processors are not getting any faster (in fact 
  279: many are getting slower as multi-cores become the norm), and all those web-services and high-level 
  280: applications have to be supported by efficient and compact infrastructure components. So, C++0x has 
  281: facilities to make C++ a better language for low-level systems programming (and for programming 
  282: aiming for efficiency in general). 
  283: 
  284: At the bottom of everything in a computer is memory. Working directly with physical memory is 
  285: unpleasant and error prone. In fact, if it wasn＊t for the C++0x memory model (see below) it would be 
  286: impossible for humans to write code at the traditional ※C language level.§ Here I＊m concerned about how 
  287: to get from the world of ints, arrays, and pointers to the first level of abstraction. 
  288: 
  289: Plain Old data and layout 
  290: 
  291: Consider 
  292: 
  293: struct S1 { 
  294: 
  295: int a, b; 
  296: 
  297: 
  298: }; 
  299: 
  300:  
  301: 
  302: struct S2 { 
  303: 
  304: S2(int aa, int bb) : a{aa}, b{bb} { } 
  305: 
  306: S2() { } // leave a an b uninitialized 
  307: 
  308: int a,b; 
  309: 
  310: }; 
  311: 
  312:  
  313: 
  314: S1 and S2 are ※standard-layout classes§ with nice guarantees for layout, objects can be copied by 
  315: memcpy() and shared with C code. They can even be initialized by the same {＃} initializer syntax. In 
  316: C++98, that wasn＊t so. They required different initialization syntaxes and only S1 had the nice 
  317: guarantees, but S2 simply wasn＊t a POD (the C++98 term for ※guaranteed well-behaved layout§). 
  318: 
  319:  
  320: 
  321: Obviously, this improvement shouldn＊t be oversold as ※major,§ but constructors are really nice to have 
  322: and you could already define ordinary member functions for a POD. This can make a difference when 
  323: you are close to the hardware and/or need to interoperate with C or Fortran code. For example, 
  324: complex<double> is a standard-layout class in C++0x, but it wasn＊t in C++98. 
  325: 
  326: Unions 
  327: 
  328: Like structs, C++98 unions had restrictions that made them hard to use together with the abstraction 
  329: mechanisms, making low-level programming unnecessarily tedious. In particular, if a class had a 
  330: constructor, a destructor, or a user-defined copy operation, it could not be a member of a union. Now, I＊m 
  331: no great fan of unions because of their misuses in higher-level software, but since we have them in the 
  332: language and need them for some ※close to the Iron§ tasks, the restrictions on them should reflect reality. 
  333: In particular, there is no problem with a member having a destructor; the real problem is that if it has one 
  334: it must be invoked iff it is the member used when the union is destroyed (iff the union is ever destroyed). 
  335: So the C++0x rules for a union are: 
  336: 
  337: . No virtual functions (as ever) 
  338: . No references (as ever) 
  339: . No bases (as ever) 
  340: . If a union has a member with a user-defined constructor, copy, or destructor then that special 
  341: function is ※deleted;§ that is, it cannot be used for an object of the union type. 
  342: 
  343: 
  344: This implies that we can have a complex<double> as a union member. It also implies that if we want to 
  345: have members with user-defined copy operations and destructors, we have to implement some kind of 
  346: variant type (or be very careful about how we use the objects of the unions or the compiler will catch us). 
  347: For example: 
  348: 
  349: class Widget { // Three alternative implementations represented as a union 
  350: 
  351: private: 
  352: 
  353:  enum class Tag { point, number, text } type; // discriminant 
  354: 
  355:  
  356: 
  357:  union { // compact representation 
  358: 
  359:  point p; // point has constructor 
  360: 
  361:  int i; 
  362:
  363:  
  364:  string s; // string has default constructor, copy operations, and destructor 
  365: 
  366:  }; 
  367: 
  368:  
  369: 
  370:  // ... 
  371: 
  372:  
  373: 
  374:  Widget& operator=(const Widget& w) // necessary because of the string union member 
  375: 
  376:  { 
  377: 
  378:  if (type==Tag::text && w.type==Tag::text) { 
  379: 
  380:  s = w.s; // usual string assignment 
  381: 
  382:  return *this; 
  383: 
  384:  } 
  385: 
  386:  
  387: 
  388:  if (type==Tag::text) s.~string(); // destroy (explicitly!) 
  389: 
  390:  
  391: 
  392:  switch (type=w.type) { 
  393: 
  394:  case Tag::point: p = w.p; break; // normal copy 
  395: 
  396:  case Tag::number: i = w.i; break; 
  397: 
  398:  case Tag::text: new(&s)(w.s); break; // placement new 
  399: 
  400:  } 
  401: 
  402:  return *this; 
  403: 
  404:  } 
  405: 
  406: }; 
  407: 
  408: I＊m still not a great fan of unions. It often takes too much cleverness to use them right. However, I don＊t 
  409: doubt that they have their uses and C++0x serves their users better than C++98. 
  410: 
  411: Did you notice the ※enum class§ notation above? An enum class is an enum where the enumerators have 
  412: class scope and where there is no implicit conversion to int. I used a class enum (a ※strongly typed 
  413: enum§) here, so that I could use tag names without worrying about name. Also, not the use of Tag::, in 
  414: C++0x we can qualify an enumerator with the name of its enumeration for clarity or disambiguation. 
  415: 
  416: General constant expressions 
  417: 
  418: Compile-time evaluation can be a major saver of run time and space. C++98 offers support for some 
  419: pretty fancy template meta-programming. However, the basic constant expression evaluation facilities are 
  420: somewhat impoverished: We can do only integer arithmetic, cannot use user-defined types, and can＊t 
  421: even call a function. C++0x takes care of that by a mechanism called constexpr: 
  422: 
  423: . We can use floating-point in constant expressions 
  424: . We can call simple functions (※constexpr functions§) in constant expressions 
  425: . We can use simple user-defined types (※literal types§) in constant expressions 
  426: . We can request that an expression must be evaluated at compile time 
  427: 
  428: 
  429: For example: 
  430: 
  431:  
  432: 
  433:  enum Flags { good=0, fail=1, bad=2, eof=4 }; 
  434: 
  435:  
  436: 
  437:  constexpr int operator|(Flags f1, Flags f2) { return Flags(f1|f2); } 
  438: 
  439:  
  440: 
  441:  void f(Flags x) 
  442: 
  443:  
  444:  { 
  445: 
  446:  switch (x) { 
  447: 
  448:  case bad: /* ... */ break; 
  449: 
  450:  case eof: /* ... */ break; 
  451: 
  452:  case bad|eof: /* ... */ break; 
  453: 
  454:  default: /* ... */ break; 
  455: 
  456:  } 
  457: 
  458:  } 
  459: 
  460:  
  461: 
  462: Here constexpr says that the function must be of a simple form so that it can be evaluated at compile time 
  463: when given constant expressions as arguments. That ※simple form§ is a single return statement, so we 
  464: don＊t do loops or declare variables in a constexpr function, but since we do have recursion the sky is the 
  465: limit. For example, I have seen a very useful integer square root constexpr function. 
  466: 
  467: In addition to be able to evaluate expressions at compile time, we want to be able to require expressions 
  468: to be evaluated at compile time; constexpr in front of a variable definition does that (and implies const): 
  469: 
  470:  constexpr int x1 = bad|eof; // ok 
  471: 
  472:  
  473: 
  474:  void f(Flags f3) 
  475: 
  476:  { 
  477: 
  478:  constexpr int x2 = bad|f3; // error: can't evaluate at compile time 
  479: 
  480:  const int x3 = bad|f3; // ok: but evaluated at run time 
  481: 
  482:  // ＃ 
  483: 
  484:  } 
  485: 
  486:  
  487: 
  488: Typically we want the compile-time evaluation guarantee for one of two reasons: 
  489: 
  490:  
  491: 
  492: . For values we want to use in constant expressions (e.g. case labels, template arguments, or array 
  493: bounds) 
  494: . For variables in namespace scope that want don＊t want run-time initialized (e.g. because we want 
  495: to place them in read-only storage). 
  496: 
  497: 
  498: This also works for objects for which the constructors are simple enough to be constexpr and expressions 
  499: involving such objects: 
  500: 
  501:  struct Point { 
  502: 
  503:  int x,y; 
  504: 
  505:  constexpr Point(int xx, int yy) : x{xx}, y{yy} { } 
  506: 
  507:  }; 
  508: 
  509:  
  510: 
  511:  constexpr Point origo { 0,0 }; 
  512: 
  513:  constexpr int z { origo.x }; 
  514: 
  515:  
  516: 
  517:  constexpr Point a[] { Point{0,0}, Point{1,1}, Point{2,2} }; 
  518: 
  519:  constexpr int x { a[1].x }; // x becomes 1 
  520: 
  521:  
  522: 
  523: Who needs this? Why isn＊t ※good old const§ good enough? Or conversely, as one academic in all 
  524: seriousness asked, ※Why don＊t you just provide a full compile-time interpreter?§ I think the answers to 
  525: the first two questions are interesting and relate to general principles. Think: what do people do when 
  526: 
  527:  
  528: they have only ※good old const§? They hit the limits of const and proceed to use macros for examples 
  529: like the Flags one. In other words, they fall back on typeless programming and the most error-prone 
  530: abstraction mechanism we know. The result is bugs. Similarly, in the absence of compile-time user-
  531: defined types, people revert to a pre-classes style of programming which obscures the logic of what they 
  532: are doing. Again, the result is bugs. 
  533: 
  534:  
  535: 
  536: I observed two other phenomena: 
  537: 
  538: . Some people were willing to go to extremes of cleverness to simulate compile-time expression 
  539: evaluation: Template instantiation is Turing complete, but you do have to write rather 
  540: ※interesting§ code to take advantage of that in many cases. Like most workarounds, it＊s much 
  541: more work (for programmers and compilers) than a specific language feature and with the 
  542: complexity comes bugs and learning time. 
  543: . Some people (mostly in the embedded systems industry) have little patience with Turing 
  544: completeness or clever programming techniques. On the other hand, they have a serious need to 
  545: use ROM, so special-purpose, proprietary facilities start to appear. 
  546: 
  547: 
  548: The constexpr design is interesting in that it addresses some serious performance and correctness needs 
  549: by doing nothing but selectively easing restrictions. There is not a single new semantic rule here: it 
  550: simply allows more of C++ to be used at compile time. 
  551: 
  552: Narrowing 
  553: 
  554: Maybe you noticed that I used {} initialization consistently. Maybe, you also thought that I was uglifying 
  555: code and was overenamored by a novel feature? That happens, of course, but I don＊t think that is the case 
  556: here. Consider: 
  557: 
  558:  
  559: 
  560: int x1 = 64000; 
  561: 
  562: int x2 { 64000 }; 
  563: 
  564:  
  565: 
  566: We can have a nice friendly discussion about the aesthetics of those two definitions and you might even 
  567: point out that the {} version requires one more keystroke than the = one. However, there is one significant 
  568: difference between those two forms that makes me chose {}. The {} version doesn＊t allow narrowing and I 
  569: failed to tell you that the two definitions were written for a machine with 16-bit ints. That means that the 
  570: value of x1 could be very surprising, whereas the definition of x2 causes a compile-time error. 
  571: 
  572: When you use {} initializers, no narrowing conversions are allowed: 
  573: 
  574: . No narrowing integral conversions (e.g., no int-to-char conversion) 
  575: . No floating-to-integral conversions (e.g. no double-to-int or double-to-bool conversion) 
  576: . When an initializer is a constant expression the actual value is checked, rather than the type (e.g. 
  577: char c {'x'}; is ok because 'x' fits in a char) 
  578: 
  579: 
  580: This directly addresses a source of nasty errors that has persisted since the dawn of C. 
  581: 
  582: Tools for writing classes 
  583: 
  584: Most of what is good, efficient, and effective about C++ involves designing, implementing, and using 
  585: classes. Thus, anything that is good for classes is good for C++ programmers. People often look for 
  586: ※major features§ and ※solutions,§ but I think of language features as building blocks: If you have the right 
  587: set of building blocks, you can apply them in combination to provide ※solutions.§ In particular, we need 
  588: simple and powerful ※building blocks§ to provide general or application-specific abstractions in the form 
  589: of classes and libraries. Thus, ※little features§ that are unimportant in themselves may have a major 
  590: impact as one of a set of interrelated features. When designed well, the sum is indeed greater than the 
  591: 
  592:  
  593: parts. Here, I will just give three examples: initializer-list constructors, inheriting constructors, and move 
  594: semantics. 
  595: 
  596: Initializer list constructors 
  597: 
  598: How did we manage to get a std::vector to accept a list of elements as its initializer? For example: 
  599: 
  600:  vector<int> v0 {}; // no elements 
  601: 
  602: vector<int> v1 { 1 }; // one element 
  603: 
  604: vector<int> v2 { 1,2 }; // two elements 
  605: 
  606: vector<int> v3 { 1,2,3}; // three elements 
  607: 
  608: vector<int> v4 { 1, 2, 3, 4, 5, a, b, c, d, x+y, y*z, f(1,d) }; // many elements 
  609: 
  610:  
  611: 
  612: That＊s done by providing vector with an ※initializer-list constructor§: 
  613: 
  614:  
  615: 
  616:  template<class T> class vector { 
  617: 
  618:  vector(std::initializer_list<T> a) // initializer-list constructor 
  619: 
  620:  { 
  621: 
  622:  reserve(a.size()); 
  623: 
  624:  uninitialized_copy(a.begin(),a.end(),v.begin()); 
  625: 
  626:  } 
  627: 
  628:  // ＃ 
  629: 
  630:  }; 
  631: 
  632:  
  633: 
  634: Whenever the compiler sees a { ＃} initializer for a vector, it invokes the initializer constructor (only if 
  635: type checking succeeds, of course). The initializer_list class is known to the compiler and whenever we 
  636: write a {＃} list that list will (if possible) be represented as an initializer_list and passed to the user＊s 
  637: code. For example: 
  638: 
  639:  
  640: 
  641: void f(int,initializer_list<int>,int); 
  642: 
  643: f(1,{1,2,3,4,5},1); 
  644: 
  645:  
  646: 
  647: Of course it is nice to have a simple and type safe replacement for the stdargs macros, but the serious 
  648: point here is that C++ is moving closer to its stated ideal of uniform support of built-in types and user-
  649: defined types [Stroustrup,1994]. In C++98, we could not build a container (e.g., vector) that was as 
  650: convenient to use as a built-in array; now we can. 
  651: 
  652: Inheriting constructors 
  653: 
  654: In C++98, we can derive a class from another, inheriting the members. Unfortunately, we can＊t inherit the 
  655: constructors because if a derived class adds members needing construction or virtual function (requiring a 
  656: different virtual function table) then its base constructors are simply wrong. This restriction 每 like most 
  657: restrictions 每 can be a real bother; that is, the restriction is a barrier to elegant and effective use of the 
  658: language. My favorite example is a range checked vector: 
  659: 
  660:  
  661: 
  662:  template<class T> class Vec : public std::vector<T> { 
  663: 
  664:  public: 
  665: 
  666:  
  667:  using vector<T>::vector; // use the constructors from the base class 
  668: 
  669:  T& operator[](size_type i) { return this->at(i); } 
  670: 
  671:  const T& operator[](size_type i) const { return this->at(i); } 
  672: 
  673:  }; 
  674: 
  675:  
  676: 
  677: The solution, to provide an explicit way of ※lifting up§ constructors from the base, is identical to the way 
  678: we (even in C++98) bring functions from a base class into the overload set of a derived class: 
  679: 
  680:  
  681: 
  682:  struct B { 
  683: 
  684:  void f(int); 
  685: 
  686:  void f(double); 
  687: 
  688:  }; 
  689: 
  690:  
  691: 
  692:  struct D : B { 
  693: 
  694:  using B::f; // ※import§ f()s from B 
  695: 
  696:  void f(complex<double>); // add an f() to the overload set 
  697: 
  698:  }; 
  699: 
  700:  
  701: 
  702:  D x; 
  703: 
  704:  x.f(1); // B::f(int); 
  705: 
  706:  x.f({1.3,3.14}); // D::f(complex<double>); 
  707: 
  708: Thus, this language extension is really a generalization and will in most contexts simplify the learning of 
  709: use of C++. Note also the use of the {＃} initialization mechanism in that last example: Of the 
  710: alternatives, only f(complex<double>) can be initialized with a pair of doubles, so the {＃} notation is 
  711: unambiguous. 
  712: 
  713: Move semantics 
  714: 
  715: Consider 
  716: 
  717: template<class T> void swap(T& a, T& b) 
  718: 
  719: { 
  720: 
  721: T tmp = a; // copy a into tmp 
  722: 
  723: a = b; // copy b into b 
  724: 
  725: b = tmp; // copy tmp into b 
  726: } 
  727: 
  728: But I didn＊t want to copy anything, I wanted to swap! Why do I have to make three copies? What if T is 
  729: something big and expensive to copy? This is a simple and not unrealistic example of the problem with 
  730: copy: After each copy operation, we have two copies of the copied value and often that＊s not really what 
  731: we wanted because we never again use the original. We need a way of saying that we just want to move a 
  732: value! 
  733: 
  734: In C++0x, we can define ※move constructors§ and ※move assignments§ to move rather than copy their 
  735: argument: 
  736: 
  737:  template<class T> class vector { 
  738: 
  739:  
  740:  // ... 
  741: 
  742:  vector(const vector&); // copy constructor 
  743: 
  744:  vector(vector&&); // move constructor 
  745: 
  746:  vector& operator=(const vector&); // copy assignment 
  747: 
  748:  vector& operator=(vector&&); // move assignment 
  749: 
  750:  }; 
  751: 
  752:  
  753: 
  754: The ※&&§ means ※rvalue reference.§ An rvalue reference is a reference that can bind to an rvalue. The 
  755: point about an rvalue here is that we may assume that it will never be used again after we are finished 
  756: with it. The obvious implementation is for the vector move constructor it therefore to grab the 
  757: representation of its source and to leave its source as the empty vector. That is often far more efficient 
  758: than making a copy. When there is a choice, that is, if we try to initialize or assign from an rvalue, the 
  759: move constructor (or move assignment) is preferred over the copy constructor (or copy assignment). For 
  760: example: 
  761: 
  762:  
  763: 
  764:  vector<int> make_rand(int s) 
  765: 
  766: { 
  767: 
  768: vector<int> res(s); 
  769: 
  770: for (auto& x : res) x = rand_int(); 
  771: 
  772: return res; 
  773: 
  774: } 
  775: 
  776:  vector<int> v { make_rand(10000) }; 
  777: 
  778:  void print_rand(int s) 
  779: 
  780: { 
  781: 
  782: for (auto x : make_rand(s)) cout << x << '\n'; 
  783: 
  784:  } 
  785: 
  786: Obviously (once you become used to thinking about moves), no vector is copied in this example. If you 
  787: have ever wanted to efficiently return a large object from a function without messing with free store 
  788: management, you see the point. 
  789: 
  790: So what about swap()? The C++0x standard library provides: 
  791: 
  792:  template<class T> 
  793: 
  794:  void swap(T& a, T& b) // ※perfect swap§ (almost) 
  795: 
  796:  { 
  797: 
  798:  T tmp = std::move(a); 
  799: 
  800:  a = std::move(b); 
  801: 
  802:  b = std::move(tmp); 
  803: 
  804:  } 
  805: 
  806: The standard library function move(x) means ※you may treat x as an rvalue.§ Rvalue references can also 
  807: be used to provide perfect forwarding: A template function std::forward() supports that. Consider a 
  808: 
  809:  
  810: ※factory function§ that given an argument has to create an object of a type and return a unique_ptr to the 
  811: created object: 
  812: 
  813: template <class T, class A1> std::unique_ptr<T> factory(A1&& a1) 
  814: 
  815: { 
  816: 
  817:  return std::unique_ptr<T>{new T{std::forward<A1>{a1}}}; 
  818: 
  819: } 
  820: 
  821:  
  822: 
  823: unique_ptr p1 { factory<vector<string>>{100}) } 
  824: 
  825:  
  826: 
  827: A unique_ptr is a standard-library ※smart pointer§ that can be used to represent exclusive ownership; it is 
  828: a superior alternative to std::shared_ptr in many (most?) cases. 
  829: 
  830:  
  831: 
  832: One way to look at rvalue references is that C++ had a pressing need to support move semantics: Getting 
  833: large values out of functions was at best inelegant or inefficient, transferring ownership by using shared 
  834: pointers was logically wrong, and some forms of generic programming cause people to write a lot of 
  835: forwarding functions that in principle implies zero run-time costs but in reality were expensive. 
  836: Sometimes move vs. copy is a simple optimization and sometimes it is a key design decision, so a design 
  837: must support both. The result was rvalue references, which supports the name binding rules that allows us 
  838: to define std::move(), std::forward(), and the rules for copy and move constructors and assignments. 
  839: 
  840: User-defined literals 
  841: 
  842: For each built-in type we have corresponding literals: 
  843: 
  844:  'a' '\n' // char 
  845: 
  846: 1 345 // int 
  847: 
  848:  345u // unsigned 
  849: 
  850:  1.2f // float 
  851: 
  852:  1.2 12.345e-7 // double 
  853: 
  854:  "Hello, world!" // C-style string 
  855: 
  856:  
  857: 
  858: However, C++98 does not offer an equivalent mechanism for user-defined types: 
  859: 
  860:  
  861: 
  862: 1+2i // complex 
  863: 
  864:  "Really!"s // std::string 
  865: 
  866:  103F 39.5c // Temperature 
  867: 
  868: 123.4567891234df // decimal floating point 
  869: 
  870: 123s // seconds 
  871: 
  872: 101010111000101b // binary 
  873: 
  874: 1234567890123456789012345678901234567890x // extended-precision 
  875: 
  876:  
  877: 
  878: Not providing literals for user-defined types is clear violation of the principle that user-defined and built-
  879: in types should receive equivalent support. I don＊t see how C++ could have survived without user-defined 
  880: literals! Well, I do: inlined constructors is a pretty good substitute and constexpr constructors would be 
  881: even better, but why not simply give people the notation they ask for? 
  882: 
  883:  
  884: 
  885:  
  886: C++0x supports ※user-defined literals§ through the notion of literal operators that map literals with a 
  887: given suffix into a desired type. For example: 
  888: 
  889:  
  890: 
  891:  constexpr complex<double> operator"" i(long double d) // imaginary literal 
  892: 
  893:  { 
  894: 
  895:  return {0,d}; // complex is a literal type 
  896: 
  897:  } 
  898: 
  899:  
  900: 
  901:  std::string operator "" s(const char* p, size_t n) // std::string literal 
  902: 
  903:  { 
  904: 
  905:  return string{p,n}; // requires free store allocation 
  906: 
  907:  } 
  908: 
  909:  
  910: 
  911: Note the use of constexpr to enable compile-time evaluation; complex<double> is a literal type. The 
  912: syntax is operator"" to say that a literal operator is being defined followed by the name of the function, 
  913: which is the suffix to be recognized. Given those literal operators, we can write: 
  914: 
  915:  
  916: 
  917:  template<class T> void f(const T&); 
  918: 
  919:  f("Hello"); // pass pointer to char* 
  920: 
  921:  f("Hello"s); // pass (5-character) std::string object 
  922: 
  923:  f("Hello\n"s); // pass (6-character) std::string object 
  924: 
  925:  
  926: 
  927:  auto z = 2+3.14i; // 2+complex<double>(0,3.14) 
  928: 
  929:  
  930: 
  931: The basic (implementation) idea is that after parsing what could be a literal, the compiler always checks 
  932: for a suffix. The user-defined literal mechanism simple allows the user to specify a new suffix and what is 
  933: to be done with the literal before it. It is not possible to redefine the meaning of a built-in literal suffix or 
  934: invent new syntax for literals. In this, user-defined literals are identical to user-defined operators. 
  935: 
  936:  
  937: 
  938: A literal operator can request to get its (preceding) literal passed ※cooked§ (with the value it would have 
  939: had if the new suffix hadn't been defined) or ※raw§ (the string of characters exactly as typed. 
  940: 
  941: To get an ※uncooked§ string, simply request a const char* argument: 
  942: 
  943:  Bignum operator"" x(const char* p) 
  944: 
  945:  { 
  946: 
  947:  return Bignum(p); 
  948: 
  949:  } 
  950: 
  951:  
  952: 
  953:  void f(Bignum); 
  954: 
  955:  f(1234567890123456789012345678901234567890x); 
  956: 
  957:  
  958: 
  959: Here the C-style string "1234567890123456789012345678901234567890" is passed to operator"" x(). 
  960: Note that we did not have to explicitly put those digits into a string, though we could have: 
  961: 
  962:  
  963: 
  964:  f("1234567890123456789012345678901234567890"x); 
  965: 
  966:  
  967: 
  968: Note that ※literal§ does not mean ※efficient§ or ※compile-time evaluated.§ If you need run-time 
  969: performance, you can design for that, but ※user-defined literals§ is 每 in the best C++ tradition 每 a very 
  970: general mechanism. 
  971: 
  972:  
  973: The sum of language extensions 
  974: 
  975: When you add it all up, C++0x offers are many new language facilities. The C++0x FAQ list them: 
  976: 
  977: . __cplusplus 
  978: . alignments 
  979: . attributes 
  980: . atomic operations 
  981: . auto (type deduction from initializer) 
  982: . C99 features 
  983: . enum class (scoped and strongly typed enums) 
  984: . copying and rethrowing exceptions 
  985: . constant expressions (generalized and guaranteed; constexpr) 
  986: . decltype 
  987: . default template parameters for function 
  988: . defaulted and deleted functions (control of defaults) 
  989: . delegating constructors 
  990: . Dynamic Initialization and Destruction with Concurrency 
  991: . explicit conversion operators 
  992: . extended friend syntax 
  993: . extended integer types 
  994: . extern templates 
  995: . for statement; see range for statement 
  996: . generalized SFINAE rules 
  997: . in-class member initializers 
  998: . inherited constructors 
  999: . initializer lists (uniform and general initialization) 
 1000: . lambdas 
 1001: . local classes as template arguments 
 1002: . long long integers (at least 64 bits) 
 1003: . memory model 
 1004: . move semantics; see rvalue references 
 1005: . Namespace Associations (Strong using) 
 1006: . Preventing narrowing 
 1007: . null pointer (nullptr) 
 1008: . PODs (generalized) 
 1009: . range for statement 
 1010: . raw string literals 
 1011: . right-angle brackets 
 1012: . rvalue references 
 1013: . static (compile-time) assertions (static_assert) 
 1014: . suffix return type syntax (extended function declaration syntax) 
 1015: . template alias 
 1016: 
 1017: 
 1018:  
 1019: . template typedef; see template alias 
 1020: . thread-local storage (thread_local) 
 1021: . unicode characters 
 1022: . Uniform initialization syntax and semantics 
 1023: . unions (generalized) 
 1024: . user-defined literals 
 1025: . variadic templates 
 1026: 
 1027: 
 1028: Fortunately most are minor and much work has been spent to ensure that they work in combination. The 
 1029: sum is greater than its parts. 
 1030: 
 1031: Like inheriting constructors, some of the new features address fairly specific and localized problems (e.g. 
 1032: raw literals for simpler expression of regular expressions, nullptr for people who are upset by 0 as the 
 1033: notation for the null pointer, and enum classes for stronger type-checked enumerations with scoped 
 1034: enumerators). Other features, like general and uniform initialization, aim to support more general 
 1035: programming techniques (e.g. decltype, variadic templates, and template aliases for the support of 
 1036: generic programming). The most ambitious new support for generic programming, concepts, didn＊t make 
 1037: it into C++0x (see [Stroustrup,2009]). 
 1038: 
 1039: When exploring those new features (my C++0x FAQ is a good starting point), I encourage you to focus 
 1040: on how they work in conjunction with old and new language features and libraries. I think of these 
 1041: language features as ※building bricks§ (my home town is about an hour＊s drive from the Lego factory) 
 1042: and few make much sense when considered in isolation. 
 1043: 
 1044: Concurrency and memory model 
 1045: 
 1046: Concurrency has been the next big thing for about 50 years, but concurrency is no longer just for people 
 1047: with multi-million dollar equipment budgets. For example, my cell phone (programmed in C++ of course) 
 1048: is a multi-core. We don＊t just have to be able to do concurrent programming in C++ (as we have 
 1049: ※forever§), we need a standard for doing so and help to get concurrent code general and portable. 
 1050: Unfortunately, there is not just one model for concurrency and just one way of writing concurrent code, 
 1051: so standardization implies serious design choices. 
 1052: 
 1053: Concurrency occurs at several levels in a system, the lowest level visible to software is the level of 
 1054: individual memory accesses. With multiple processors (※cores§) sharing a memory hierarchy of caches, 
 1055: this can get quite ※interesting.§ This is the level addressed by the memory model. The next level up is the 
 1056: systems level where computations are represented by threads. Above that can be general or application-
 1057: specific models of concurrency and parallel computation. 
 1058: 
 1059: The general approach of C++0x is to specify the memory model, to provide primitive operations for 
 1060: dealing with concurrency, and to provide language guarantees so that concurrency mechanism, such as 
 1061: threads, can be provided as libraries. The aim is to enable support for a variety of models of concurrency, 
 1062: rather than building one particular one into the language. 
 1063: 
 1064:  
 1065: The memory model 
 1066: 
 1067: The memory model is a treaty between the machine architects and the compiler writers to ensure that 
 1068: most programmers do not have to think about the details of modern computer hardware. Without a 
 1069: memory model, few things related to threading, locking, and lock-free programming would make sense. 
 1070: 
 1071: The key guarantee is: Two threads of execution can update and access separate memory locations without 
 1072: interfering with each other. To see why that guarantee is non-trivial, consider: 
 1073: 
 1074:  // thread 1: 
 1075: 
 1076:  char c; 
 1077: 
 1078:  c = 1; 
 1079: 
 1080:  int x = c; 
 1081: 
 1082:  
 1083: 
 1084:  // thread 2: 
 1085: 
 1086:  char b; 
 1087: 
 1088:  b = 1; 
 1089: 
 1090:  int y = b; 
 1091: 
 1092:  
 1093: 
 1094: For greater realism, I could have used separate compilation (within each thread) to ensure that the 
 1095: compiler/optimizer won't simply ignore c and b and directly initialize x and y with 1. What are the 
 1096: possible values of x and y? According to C++0x, the only correct answer is the obvious one: 1 and 1. The 
 1097: reason that＊s interesting is that if you take a conventional good pre-concurrency C or C++ compiler, the 
 1098: possible answers are 0 and 0, 1 and 0, 0 and 1, and 1 and 1. This has been observed ※in the wild.§ How? 
 1099: A linker might allocate c and b in the same word 每 nothing in the C or C++ 1990s standards says 
 1100: otherwise. In that, C and C++ resemble all languages not designed with real concurrent hardware in mind. 
 1101: However, most modern processors cannot read or write a single character, a processor must read or write 
 1102: a whole word, so the assignment to c really is ※read the word containing c, replace the c part, and write 
 1103: the word back again.§ Since the assignment to b is similarly implemented, there are plenty of 
 1104: opportunities for the two threads to clobber each other even though the threads do not (according to their 
 1105: source text) share data! 
 1106: 
 1107: So naturally, C++0x guarantees that such problems do not occur for ※separate memory locations.§ In this 
 1108: example, b and c will (if necessary on a given machine) be allocated in different words. Note that 
 1109: different bitfields within a single word are not considered separate memory locations, so don't share 
 1110: structs with bitfields among threads without some form of locking. Apart from that caveat, the C++ 
 1111: memory model is simply ※as everyone would expect.§ 
 1112: 
 1113: Fortunately, we have already adapted to modern times and every current C++ compiler (that I know of) 
 1114: gives the one right answer and has done so for years. After all, C++ has been used for serious systems 
 1115: programming of concurrent systems ※forever.§ 
 1116: 
 1117: Threads, locks, and atomics 
 1118: 
 1119: In my opinion, letting a bunch of threads loose in a shared address space and adding a few locks to try to 
 1120: ensure that the threads don＊t stump on each other is just about the worst possible way of managing 
 1121: concurrency. Unfortunately, it is also by far the most common model and deeply embedded in modern 
 1122: systems. To remain a systems programming language, C++ must support that style of programming, and 
 1123: support it well, so C++0x does. If you know Posix threads or boost threads, you have a first-order 
 1124: 
 1125:  
 1126: approximation of what C++0x offers at the most basic level. To simplify the use of this fundamental (and 
 1127: flawed) model of concurrency, C++0x also offers 
 1128: 
 1129: . thread local storage (identified by the keyword thread_local) 
 1130: . mutexes 
 1131: . locks 
 1132: . conditions variables 
 1133: . a set of atomic types for lock-free programming and the implementation of other concurrency 
 1134: facilities 
 1135: . a notion of fine grain time duration 
 1136: 
 1137: 
 1138: In my opinion lock-free programming is a necessity, but should be reserved for people who find juggling 
 1139: naked sharp swords too tame [Dechev,2009]. Importantly, the whole language and standard library has 
 1140: been re-specified (down to the last memory read or write) so that the effects of concurrency are well-
 1141: specified 每 though of course not well defined: the result of a data race is not and should not be well 
 1142: defined (it should be prevented by the library or applications programmer). 
 1143: 
 1144: As luck would have it, Anthony Williams has a paper ※Multi-threading in C++0x§ in the current issue of 
 1145: Overload [Williams, 2009], so I don＊t have to go into details. Instead, I will give an example of a way for 
 1146: the programmer to rise above the messy threads-plus-lock level of concurrent programming: 
 1147: 
 1148: template<class T, class V> struct Accum { // function object type for computing sums 
 1149: 
 1150:  T* b; 
 1151: 
 1152:  T* e; 
 1153: 
 1154:  V val; 
 1155: 
 1156:  Accum(T* bb, T* ee, const V& v) : b{bb}, e{ee}, val{vv} {} 
 1157: 
 1158:  V operator() () { return std::accumulate(b,e,val); } 
 1159: 
 1160: }; 
 1161: 
 1162:  
 1163: 
 1164: void comp(vector<double>& v) 
 1165: 
 1166:  // spawn many tasks if v is large enough 
 1167: 
 1168: { 
 1169: 
 1170:  if (v.size()<10000) return std::accumulate(v.begin(),v.end(),0.0); 
 1171: 
 1172:  
 1173: 
 1174: auto f0 {async(Accum{v.data(), v.data()+v.size()/4, 0.0})}; 
 1175: 
 1176: auto f1 {async(Accum{v.data()+v.size()/4, v.data()+v.size()/2, 0.0})}; 
 1177: 
 1178: auto f2 {async(Accum{v.data()+v.size()/2, v.data()+v.size()*3/4], 0.0})}; 
 1179: 
 1180: auto f3 {async(Accum{v.data()+v.size()*3/4, v.data()+v.size(), 0.0})}; 
 1181: 
 1182:  
 1183: 
 1184: return f0.get()+f1.get()+f2.get()+f3.get(); 
 1185: 
 1186: } 
 1187: 
 1188:  
 1189: 
 1190: This is a very simple-minded use of concurrency (note the ※magic number§), but note the absence of 
 1191: explicit threads, locks, buffers, etc. The type of the f-variables are determined by the return type of the 
 1192: standard-library function async() which called a future. If necessary, get() on a future waits for a 
 1193: 
 1194:  
 1195: std::thread to finish. Here, it is async()＊s job to spawn threads as needed and the future＊s job to join() 
 1196: the appropriate threads (i.e., wait for the completion of threads) . ※Simple§ is the most important aspect 
 1197: of the async()/future design; futures can also be used with threads in general, but don＊t even think of 
 1198: using async() to launch tasks that do I/O, manipulate mutexes, or in other ways interact with other tasks. 
 1199: The idea behind async() is the same as the idea behind the range-for statement: Provide a simple way to 
 1200: handle the simplest, rather common, case and leave the more complex examples to the fully general 
 1201: mechanism. 
 1202: 
 1203: Please note that future and async() is just one example of how to write concurrent programs above the 
 1204: messy threads-plus-lock level. I hope to see many libraries supporting a variety of models, some of which 
 1205: might become candidates for C++1x. Unlike every other feature presented here, async() has not yet been 
 1206: voted into C++0x . That＊s expected to happen in October, but no man＊s life, liberty, or programming 
 1207: language is safe while the committee is in session (apologies to Mark Twain). [It was voted in.] 
 1208: 
 1209: Standard Library Improvements 
 1210: 
 1211: At the outset of the work on C++0x, I stated my ideal as ※being careful, deliberate, conservative and 
 1212: skeptic§ about language extensions, but ※opportunistic and ambitious§ about new standard libraries 
 1213: [Stroustrup,2002] . At first glance, the opposite happened, but when you count pages in the standard you 
 1214: find that the language sections grew by about 27% and the library sections by about 100%, so maybe it 
 1215: would be wrong to complain too loudly about lack of new standard library components. The most obvious 
 1216: improvements to the standard library are the added library components: 
 1217: 
 1218: . Concurrency ABI: 
 1219: o thread 
 1220: o mutexes, locks, atomic types, 
 1221: o simple asynchronous value exchange: future, shared_future, atomic_future, and 
 1222: promise 
 1223: o simple asynchronous launcher: async() 
 1224: 
 1225: 
 1226: 
 1227: . Containers: 
 1228: o Hashed containers: unordered_map, unordered_multimap, unordered_set, 
 1229: unordered_multiset 
 1230: o Fixed sized array: array 
 1231: o Singly-linked list: forward_list 
 1232: 
 1233: 
 1234: 
 1235: . Regular expressions: regex 
 1236: . Random numbers 
 1237: . Time utilities: duration and time_point 
 1238: . Compile-time rational arithmetic: ratio 
 1239: . Resource management pointers: unique_ptr, shared_ptr, and weak_ptr 
 1240: . Utility components: bind(), function, tuple 
 1241: . Metaprogramming and type traits 
 1242: . Garbage collection ABI 
 1243: 
 1244: 
 1245:  
 1246: Whatever project you do, one or more of these libraries should help. As usual for C++, the standard 
 1247: libraries tend to be utility components rather than complete solutions to end-user problems. That makes 
 1248: them more widely useful. 
 1249: 
 1250: Another set of library improvements are ※below the surface§ in that they are improvements to existing 
 1251: library components rather than new components. For example, the C++0x vector is more flexible and 
 1252: more efficient than the C++98 vector. As usual, the standard library is the first test of new language 
 1253: features: If a language feature can＊t be used to improve the standard library, what is it good for? 
 1254: 
 1255: More containers 
 1256: 
 1257: So, C++0x gets hash tables (unordered_map, etc.), a singly-linked list (forward_list), and a fixed-sized 
 1258: container (array). What＊s the big deal and why the funny names? The ※big deal§ is simply that we have 
 1259: standard versions, available in every C++0x implementation (and in major C++ implementations today), 
 1260: rather than having to build, borrow, or buy our own. That＊s what standardization is supposed to do for us. 
 1261: Also, since ※everybody§ has written their own version (proving that the new components are widely 
 1262: useful), the standard could not use the ※obvious§ names: there were simply too many incompatible 
 1263: hash_maps and slists ※out there,§ so new names had to be found: ※unordered§ indicates that you can＊t 
 1264: iterate over an unordered_map in a predictable order defined by <; an unordered_map uses a hash 
 1265: function rather than a comparison to organize elements. Similarly, it is a defining characteristic of a 
 1266: forward_list (a singly linked list) that you can iterate through it forwards (using a forward iterator), but 
 1267: not (in any realistic way) backwards. 
 1268: 
 1269: The most important point about forward_list is that it is more compact (and has slightly more efficient 
 1270: operations) than list (a doubly-linked list): An empty forward_list is one word and a link has only a one-
 1271: word overhead. There is no size() operation, so the implementation doesn＊t have to keep track of the size 
 1272: in an extra word or (absurdly) count the number of elements each time you innocently ask. 
 1273: 
 1274: The point of unordered_map and its cousins is runtime performance. With a good hash function, lookup 
 1275: is amortized O(1) as compared to map＊s O(log(N)), which isn＊t bad for smaller containers. Yes, the 
 1276: committee cares about performance. 
 1277: 
 1278: Built-in arrays have two major problems: They implicitly ※decay§ to pointers at the slightest provocation 
 1279: and once that has happened their size is ※lost§ and must be ※managed§ by the programmer. A huge 
 1280: fraction of C and C++ bugs have this as their root cause. The standard-library array is most of what the 
 1281: built-in array is without those two problems. Consider: 
 1282: 
 1283:  array<int,6> a { 1, 2, 3 }; 
 1284: 
 1285:  a[3] { 4 }; 
 1286: 
 1287:  int x { a[5] }; // x becomes 0 because default elements are zero initialized 
 1288: 
 1289:  int* p1 { a }; // error: std::array doesn't implicitly convert to a pointer 
 1290: 
 1291:  int* p2 { a.data() }; // ok: get pointer to first element 
 1292: 
 1293:  
 1294: 
 1295: Unfortunately you cannot deduce the length of an array from an initializer list: 
 1296: 
 1297:  
 1298: 
 1299:  array<int> a3 { 1, 2, 3 }; // error: size unknown/missing 
 1300: 
 1301:  
 1302: 
 1303:  
 1304: That＊s about the only real advantage left for built-in arrays over std::array. 
 1305: 
 1306:  
 1307: 
 1308: The standard array's features make it attractive for embedded systems programming (and similar 
 1309: constrained, performance-critical, or safety-critical tasks). It is a sequence container so it provides the 
 1310: usual member types and functions (just like vector). In particular, std::array knows its end() and size() 
 1311: so that ※buffer overflow§ and other out-of-range access problems are easily avoided. Consider: 
 1312: 
 1313:  
 1314: 
 1315:  template<class C, class V> typename C::const_iterator find(const C& a, V val) 
 1316: 
 1317:  { 
 1318: 
 1319:  return find(a.begin(), a.end(), val); 
 1320: 
 1321:  } 
 1322: 
 1323:  
 1324: 
 1325:  array<int,10> a10; 
 1326: 
 1327:  array<double,1000> a1000; 
 1328: 
 1329:  vector<int> v; 
 1330: 
 1331:  // ... 
 1332: 
 1333:  auto answer = find(a10,42); 
 1334: 
 1335:  auto cold = find(a1000,-274.15); 
 1336: 
 1337:  if (find(v,666)==v.end()) cout << "See no evil"; 
 1338: 
 1339:  
 1340: 
 1341: Incidentally, have you ever been annoyed by having to write things like typename C::const_iterator? In 
 1342: C++0x, the compiler can deduce the return type of a simple function from its return-statement, so you 
 1343: can simplify: 
 1344: 
 1345:  
 1346: 
 1347: template<class C, class V> [] find(const C& a, V val) 
 1348: 
 1349:  { 
 1350: 
 1351:  return find(a.begin(), a.end(), val); 
 1352: 
 1353:  } 
 1354: 
 1355:  
 1356: 
 1357: You can read [] as ※function;§ [] is a new notation to explicitly state that a function is being declared. 
 1358: [Mark Twain strikes again: This has now become uncertain if that last example can be written that way or 
 1359: should be slightly different. It is the last such question.] 
 1360: 
 1361: Better containers 
 1362: 
 1363: I suspect that the new containers will attract the most attention, but the ※minor improvements§ to the 
 1364: existing containers (and other standard library components) are likely to be the more important. 
 1365: 
 1366: Initializer lists 
 1367: 
 1368: The most visible improvement is the use of initializer-list constructors to allow a container to take an 
 1369: initializer list as its argument: 
 1370: 
 1371:  
 1372: 
 1373:  Vector<string> vs = { "Hello", ", ", "World!", "\n" }; 
 1374: 
 1375:  for (auto s : vs ) cout << s; 
 1376: 
 1377:  
 1378: 
 1379:  
 1380: This is shorter, clearer, and potentially more efficient than building the vector up element by element. It 
 1381: gets particularly interesting when used for nested structures: 
 1382: 
 1383: vector<pair<string,Phone_number>> phone_book= { 
 1384: 
 1385: { "Donald Duck", 2015551234 }, 
 1386: 
 1387: {"Mike Doonesbury", 9794566089 }, 
 1388: 
 1389: { "Kell Dewclaw", 1123581321 } 
 1390: 
 1391: }; 
 1392: 
 1393:  
 1394: 
 1395: As an added benefit, we get the protection from narrowing from the { }-notation, so that if any of those 
 1396: integer values do not fit into Phone_number＊s representation of them (say, a 32-bit int), the example 
 1397: won＊t compile. 
 1398: 
 1399: Move operators 
 1400: 
 1401: Containers now have move constructors and move assignments (in addition to the traditional copy 
 1402: operations). The most important implication of this is that we can efficiently return a container from a 
 1403: function: 
 1404: 
 1405:  vector<int> make_random(int n) 
 1406: 
 1407:  { 
 1408: 
 1409:  vector<int> ref(n); 
 1410: 
 1411:  for(auto x& : ref) x = rand_int(); // some random number generator 
 1412: 
 1413:  return ref; 
 1414: 
 1415:  } 
 1416: 
 1417:  
 1418: 
 1419:  vector<int> v = make_random(10000); 
 1420: 
 1421:  for (auto x : make_random(1000000)) cout << x << '\n'; 
 1422: 
 1423:  
 1424: 
 1425: The point here is that 每 despite appearances 每 no vector is copied. In C++98, this make_random() is a 
 1426: performance problem waiting to happen; in C++0x it is an elegant direct solution to a classic problem, 
 1427: Consider the usual workarounds: Try to rewrite make_random() to return a free-store-allocated vector 
 1428: and you have to deal with memory management. Rewrite make_random() to pass the vector to be filled 
 1429: as an argument and you have far less obvious code (plus an added opportunity for making an error). 
 1430: 
 1431: Improved push operations 
 1432: 
 1433: My favorite container operation is push_back() that allows a container to grow gracefully: 
 1434: 
 1435:  vector<pair<string,int>> vp; 
 1436: 
 1437:  string s; 
 1438: 
 1439:  int i; 
 1440: 
 1441:  while(cin>>s>>i) vp.push_back({s,i}); 
 1442: 
 1443:  
 1444: 
 1445: This will construct a pair<string,int> out of s and i and move it into vp. Note: ※move§ not ※copy.§ There 
 1446: is a push_back version that takes an rvalue reference argument so that we can take advantage of string's 
 1447: move constructor. Note also the use of the {}-list syntax to avoid verbosity. 
 1448: 
 1449:  
 1450: Emplace operations 
 1451: 
 1452: The push_back() using a move constructor is far more efficient than the traditional copy-based one in 
 1453: important cases, but in extreme cases we can go further. Why copy/move anything? Why not make space 
 1454: in the vector and then construct the desired value in that space? Operations that do that are called 
 1455: ※emplace§ (meaning ※putting in place§). For example emplace_back(): 
 1456: 
 1457:  vector<pair<string,int>> vp; 
 1458: 
 1459:  string s; 
 1460: 
 1461:  int i; 
 1462: 
 1463:  while(cin>>s>>i) vp.emplace_back(s,i); 
 1464: 
 1465:  
 1466: 
 1467: An emplace function takes a variadic template (see the C++0xFAQ) argument and uses that to construct 
 1468: an object of the desired type in place. Whether the emplace_back() really is more efficient than the 
 1469: push_back() depends on types involved and the implementation (of the library and of variadic 
 1470: templates). In this case, there doesn＊t seem to be a performance difference. As ever, if you think it might 
 1471: matter, measure. Otherwise, choose based on aesthetics: vp.push_back({s,i}) or vp.emplace_back(s,i). 
 1472: For now, I prefer the push_back() version because I can see that an object is being composed, but that 
 1473: might change over time. For new facilities, it is not immediately obvious which styles and which 
 1474: combinations will be the more effective and more maintainable. 
 1475: 
 1476: Scoped allocators 
 1477: 
 1478: Containers can now hold ※real allocation objects§ (with state) and use those to control nested/scoped 
 1479: allocation (e.g. allocation of elements in a container). A rather sneaky problem can occur when using 
 1480: containers and user-defined allocators: Should an element＊s free-store allocated sub-objects be in the 
 1481: same allocation area as its container? For example, if you use Your_allocator for Your_string to 
 1482: allocate its elements and I use My_allocator to allocate elements of My_vector then which allocator 
 1483: should be used for string elements in My_vector<Your_string>? The solution is to tell a container when 
 1484: to pass an allocator to an element. For example, assuming that I have an allocator My_alloc and I want a 
 1485: vector that uses My_alloc for both the vector element and string element allocations. First, I must make 
 1486: a version of string that accepts My_alloc objects: 
 1487: 
 1488:  using xstring = basic_string< // a string with my allocator 
 1489: 
 1490:  char, 
 1491: 
 1492:  char_traits<char>, 
 1493: 
 1494:  My_alloc<char> 
 1495: 
 1496:  >; 
 1497: 
 1498:  
 1499: 
 1500: This use of using is new in C++0x. It is basically a variant of typedef that allows us to define an alias 
 1501: with the name being defined coming up front where we can see it. 
 1502: 
 1503:  
 1504: 
 1505: Next, I must make a version of vector that accepts those xstrings, accepts a My_alloc object, and passes 
 1506: that object on to the xstring: 
 1507: 
 1508:  
 1509: 
 1510:  using svec = vector< // a string with a scoped allocator 
 1511: 
 1512:  xstring, 
 1513: 
 1514:  scoped_allocator_adaptor<My_alloc<xstring>> 
 1515: 
 1516:  >; 
 1517: 
 1518:  
 1519: 
 1520:  
 1521: The standard library ※adaptor§ (※wrapper type§) scoped_allocator_adaptor is used to indicate that 
 1522: xstring also should use My_alloc. Note that the adaptor can (trivially) convert My_alloc<xstring> to the 
 1523: My_alloc<char> that xstring needs. 
 1524: 
 1525: Finally, we can make a vector of xstrings that uses an allocator of type My_alloc<xstring>: 
 1526: 
 1527:  
 1528: 
 1529:  svec v {scoped_allocator_adaptor(My_alloc<xstring>{my_arena1})}; 
 1530: 
 1531:  
 1532: 
 1533: Now v is a vector of strings using My_alloc to allocate memory from my_arena1 for both strings and 
 1534: characters in strings. 
 1535: 
 1536: Why would anyone go to all that bother with allocation? Well, if you have millions of objects and hard 
 1537: real-time requirements on your performance, you can get rather keen on the cost of allocation and 
 1538: deallocation and concerned about the locality of objects. In such cases, having objects and their 
 1539: subobjects in one place can be essential 每 for example, you may dramatically improve performance by 
 1540: simply ※blowing away§ a whole allocation arena by a single cheap operation rather than deleting the 
 1541: objects one by one. 
 1542: 
 1543: Resource management pointers 
 1544: 
 1545: Resource management is an important part of every non-trivial program. Destructors and the techniques 
 1546: relying on them (notably RAII) are key to most effective resource management strategies. C++0x adds a 
 1547: garbage collection ABI to our toolset, but that must not be seen as a panacea: The question is how to 
 1548: combine destructor-based management of general resources (such as locks, file handles, etc.) with the 
 1549: simple collection of unreferenced objects. This involves non-trivial challenges: for example, destructor-
 1550: based reasoning is essentially local, scoped, and typed whereas garbage collection is based on non-local 
 1551: reasoning with little use of types (beyond knowing where the pointers are). 
 1552: 
 1553: Since the mid 1980s, C++ programmers have used counted pointers of various forms to bridge that gap. 
 1554: Indeed, reference-counted objects were the original form of garbage collection (in Lisp) and are still the 
 1555: standard in several languages. They are supported by the standard library shared_ptr which provides 
 1556: shared ownership and weak_ptr which can be used to address the nasty problems that circular references 
 1557: causes for reference-counted pointers. All shared_ptrs for an object share responsibility for the object 
 1558: and the object is deleted when its last shared_ptr is destroyed. The simplest example simply provides 
 1559: exception safety: 
 1560: 
 1561: void f(int i) 
 1562: 
 1563: { 
 1564: 
 1565:  X* p = new X; 
 1566: 
 1567:  shared_ptr<X> sp(new X); 
 1568: 
 1569:  if (i<99) throw Z(); // maybe throw an exception 
 1570: 
 1571:  delete p; 
 1572: 
 1573:  // sp＊s destructor implicitly deletes sp＊s object 
 1574: 
 1575: } 
 1576: 
 1577: Here the object pointed to by p is leaked if an exception is thrown, but the object pointed to by sp is not. 
 1578: However, I am in general suspicious about ※shared ownership§ which is far too often simply a sign of 
 1579: 
 1580:  
 1581: weak design and made necessary by a lack of understanding of a system. Consider a common use of a 
 1582: shared_ptr: 
 1583: 
 1584:  
 1585: 
 1586: shared_ptr<X> make_X(int i) 
 1587: 
 1588: { 
 1589: 
 1590:  // check i, etc. 
 1591: 
 1592:  return shared_ptr<X>(new X(i)); 
 1593: 
 1594: } 
 1595: 
 1596:  
 1597: 
 1598: void f(int i) 
 1599: 
 1600: { 
 1601: 
 1602:  vector<shared_ptr<X>> v; 
 1603: 
 1604:  v.push_back(make_X(i)); 
 1605: 
 1606:  v.push_back(make_X(j)); 
 1607: 
 1608:  // ＃ 
 1609: 
 1610: } 
 1611: 
 1612:  
 1613: 
 1614: Here we use shared_ptr for three things: 
 1615: 
 1616: . Getting a large object out of a function without copying 
 1617: . Passing an object from place to place by passing a pointer to it without worrying who eventually 
 1618: needs to destroy it 
 1619: . Having an owner of the object at all times so that the code is exception-safe (using RAII). 
 1620: 
 1621: 
 1622: However, we didn＊t actually share that object in any real sense, we just passed it along in a reasonably 
 1623: efficient and exception-safe manner. The shared_ptr implementation keeps a use count to keep track of 
 1624: which is the last shared_ptr to an object. If we looked carefully, we＊d see that the use count bob up and 
 1625: down between 1 and 2 as the object is passed along before the count finally goes to 0. If we moved the 
 1626: pointer around instead of making copies, the count would always be 1 until its object finally needed to be 
 1627: destroyed. That is, we didn＊t need that count! What we saw has been called ※false sharing.§ 
 1628: 
 1629:  
 1630: 
 1631: C++0x provides a better alternative to shared_ptr for the many examples where no true sharing is 
 1632: needed, unique_ptr: 
 1633: 
 1634: . The unique_ptr (defined in <memory>) provides the semantics of strict ownership. 
 1635: o owns the object it holds a pointer to 
 1636: o can be moved but not copied 
 1637: o stores a pointer to an object and deletes that object when it is itself destroyed (such as 
 1638: when leaving block scope). 
 1639: 
 1640: 
 1641: 
 1642: . The uses of unique_ptr include 
 1643: o providing exception safety for dynamically allocated memory, 
 1644: o Passing ownership of dynamically allocated memory to a function, 
 1645: o returning dynamically allocated memory from a function. 
 1646: o storing pointers in containers 
 1647: 
 1648: 
 1649: 
 1650: . ※What auto_ptr should have been§ (but that we couldn't write in C++98) 
 1651: 
 1652: 
 1653: Obviously, unique_ptr relies critically on rvalue references and move semantics. We can rewrite the 
 1654: shared_ptr examples above using unique_ptr. For example: 
 1655: 
 1656:  
 1657:  
 1658: 
 1659: unique_ptr<X> make_X(int i) 
 1660: 
 1661: { 
 1662: 
 1663:  // check i, etc. 
 1664: 
 1665:  return unique_ptr<X>(new X(i)); 
 1666: 
 1667: } 
 1668: 
 1669:  
 1670: 
 1671: void f(int i) 
 1672: 
 1673: { 
 1674: 
 1675:  vector<unique_ptr<X>> v; 
 1676: 
 1677:  v.push_back(make_X(i)); 
 1678: 
 1679:  v.push_back(make_X(j)); 
 1680: 
 1681:  // ＃ 
 1682: 
 1683: } 
 1684: 
 1685:  
 1686: 
 1687: The logic is inherently simpler and a unique_ptr is represented by a simple built-in pointer and the 
 1688: overhead of using one compared to a built-in pointer are miniscule. In particular, unique_ptr does not 
 1689: offer any form of dynamic checking and requires no auxiliary data structures. That can be important in a 
 1690: concurrent system where updating the count for a shared pointer can be relatively costly. 
 1691: 
 1692: Regular expressions 
 1693: 
 1694: The absence of a standard regular expression library for C++ has led many to believe that they have to use 
 1695: a ※scripting language§ to get effective text manipulation. This impression is further enhanced because that 
 1696: a lack of standard also confounds teaching. Since C++0x finally does provide a regular expression library 
 1697: (a derivative of the boost::regex library), this is now changing. In a sense it has already changed because I 
 1698: use regex to illustrate text manipulation in my new programming textbook [Stroustrup,2008]. I think 
 1699: regex is likely to become the most important new library in terms of direct impact on users 每 the rest of 
 1700: the new library components have more of the flavor of foundation libraries. To give a taste of the style of 
 1701: the regex library, let＊s define and print a pattern: 
 1702: 
 1703: regex pat (R"[\w{2}\s*\d{5}(-\d{4})?]"); // ZIP code pattern XXddddd-dddd and variants 
 1704: 
 1705: cout << "pattern: " << pat << '\n'; 
 1706: 
 1707:  
 1708: 
 1709: People who have used regular expressions in just about any language will find \w{2}\s*\d{5}(-\d{4})? 
 1710: familiar. It specifies a pattern starting with two letters \w{2} optionally followed by some space \s* 
 1711: followed by five digits \d{5} and optionally followed by a dash and four digits -\d{4}. If you have not 
 1712: seen regular expressions before, this may be a good time to learn about them. I can of course recommend 
 1713: my book, but there is no shortage of regular expression tutorials on the web, including the one for 
 1714: boost::regex [Maddock,2009]. 
 1715: 
 1716:  
 1717: 
 1718: People who have used regular expressions in C or C++ notice something strange about that pattern: it is 
 1719: not littered with extra backslashes to conform to the usual string literal rules. A string literal preceded by 
 1720: R and bracketed by a [ ] pair is a raw string literal. If you prefer, you can of course use a ※good old string 
 1721: literal:§ "\\w{2}\\s*\\d{5}(-\\d{4})?" rather than R"[\w{2}\s*\d{5}(-\d{4})?]", but for more complex 
 1722: patterns the escaping can become ※quite interesting.§ The raw string literals were introduced primarily to 
 1723: 
 1724:  
 1725: counteract problems experienced with using escape characters in applications with lots of literal strings, 
 1726: such as text processing using regular expressions. The "[ ＃ ]" bracketing is there to allow plain double 
 1727: quotes in a raw string. If you want a ]" in a raw string you can have that too, but you＊ll have to look up 
 1728: the detailed rules for raw string bracketing (e.g. in the C++0x FAQ). 
 1729: 
 1730: The simplest way of using a pattern is to search for it in a stream: 
 1731: 
 1732:  
 1733: 
 1734: int lineno = 0; 
 1735: 
 1736: string line; // input buffer 
 1737: 
 1738: while (getline(in,line)) { 
 1739: 
 1740:  ++lineno; 
 1741: 
 1742:  smatch matches; // matched strings go here 
 1743: 
 1744:  if (regex_search(line, matches, pat)) // search for pat in line 
 1745: 
 1746: cout << lineno << ": " << matches[0] << '\n'; 
 1747: 
 1748: } 
 1749: 
 1750:  
 1751: 
 1752: The regex_search(line, matches, pat) searches the line for anything that matches the regular expression 
 1753: stored in pat and if it finds any matches, it stores them in matches. Naturally, if no match was found, 
 1754: regex_search(line, matches, pat) returns false. 
 1755: 
 1756: The matches variable is of type smatch. The ※s§ stands for ※sub§. Basically, a smatch is a vector of sub-
 1757: matches. The first element, here matches[0], is the complete match. 
 1758: 
 1759: So what does this all add up to? 
 1760: 
 1761: C++0x feels like a new language 每 just as C++98 felt like a new language relative to earlier C++. In 
 1762: particular, C++0x does not feel like a new layer of features on top of an older layer or a random collection 
 1763: of tools thrown together in a bag. Why not? It is important to articulate why that is or many might miss 
 1764: something important, just as many were so hung up on OOP that they missed the point of generic 
 1765: programming in C++98. Of course C++ is a general purpose programming language in the sense that it is 
 1766: Turing complete and not restricted to any particular execution environment. But what, specifically, is it 
 1767: good for? Unfortunately, I do not have a snazzy new buzzword that succinctly represents what is unique 
 1768: about C++. However, let me try: 
 1769: 
 1770: . C++ is a language for building software infrastructure. 
 1771: . C++ is a language for applications with large systems programming parts. 
 1772: . C++ is a language for building and using libraries. 
 1773: . C++ is a language for resource-constrained systems. 
 1774: . C++ is a language for efficiently expressing abstractions. 
 1775: . C++ is a language for general and efficient algorithms. 
 1776: . C++ is a language for general and compact data structures. 
 1777: . C++ is a lightweight abstraction language. 
 1778: 
 1779: 
 1780:  
 1781: In particular, it is all of those. In my mind, the first (※building software infrastructure§) points to C++＊s 
 1782: unique strengths and the last (※lightweight abstraction§) covers the essential reasons for that. 
 1783: 
 1784: It is important to find simple, accurate, and comprehensible ways to characterize C++0x. The alternative 
 1785: is to submit to inaccurate and hostile characterizations, often presenting C++ roughly as it was in 1985. 
 1786: But whichever way we describe C++0x, it is still everything C++ ever was 每 and more. Importantly, I 
 1787: don＊t think that ※more§ is achieved at the cost of greater surface complexity: Generalization and new 
 1788: features can save programmers from heading into ※dark corners.§ 
 1789: 
 1790: C++0x is not a proprietary language closely integrated with a huge development and execution 
 1791: infrastructure. Instead, C++ offers a ※tool kit§ (※building block§) approach that can deliver greater 
 1792: flexibility, superior portability, and a greater range of application areas and platforms. And 每 of course 
 1793: and essentially 每 C++ offers stability over decades. 
 1794: 
 1795: Acknowledgements 
 1796: 
 1797: The credit for C++0x goes to the people who worked on it. That primarily means the members of WG21. 
 1798: It would not be sensible to list all who contributed here, but have a look at the references in my C++0x 
 1799: FAQ: There, I take care to list names. Thanks to Niels Dekker, Steve Love, Alisdair Meredith, and Roger 
 1800: Orr for finding bugs in early drafts of this paper and to Anthony Williams for saving me from describing 
 1801: threads and locks. 
 1802: 
 1803: References 
 1804: 
 1805: [Becker,2009] Pete Becker (editor): Working Draft, Standard for Programming Language C++. 
 1806: [N2914=09-0104] 2009-06-22. Note: The working paper gets revised after each standards meeting. 
 1807: 
 1808: [Dechev,2009] Damian Dechev and Bjarne Stroustrup: Reliable and Efficient Concurrent 
 1809: Synchronization for Embedded Real-Time Software. Proc. 3rd IEEE International Conference on Space 
 1810: Mission Challenges for Information Technology (IEEE SMC-IT). July 2009. 
 1811: http://www.research.att.com/~bs/smc_it2009.pdf 
 1812: 
 1813: [Maddock,2009] John Maddock: Boost.Regex documentation 
 1814: http://www.boost.org/doc/libs/1_40_0/libs/regex/doc/html/index.html 
 1815: 
 1816: [Stroustrup,2009] Bjarne Stroustrup: C++0x FAQ. www.research.att.com/~bs/C++0xFAQ.html . Note: 
 1817: this FAQ contains references to the original proposals, thus acknowledging their authors. 
 1818: 
 1819: [Stroustrup,2002] Bjarne Stroustrup: Possible Directions of C++0x. ACCU keynote 2002. Note: No 
 1820: C++0x does not provide all I asked for then, but that＊s a different story. 
 1821: 
 1822: [Stroustrup,2009a] Bjarne Stroustrup: Concepts and the future of C++ interview by Danny Kalev for 
 1823: DevX. August 2009. http://www.devx.com/cplus/Article/42448. 
 1824: 
 1825: [Stroustrup,2009b] Bjarne Stroustrup: The C++0x ※Remove concepts§ Decision. Dr. Dobbs; July 2009. 
 1826: http://www.ddj.com/cpp/218600111 and Overload 92; August 2009. 
 1827: 
 1828:  
 1829: [Stroustrup,1994] Bjarne Stroustrup: The Design and Evolution of C++. Addison-Wesley. 1994. 
 1830: 
 1831: [Stroustrup,2008] Bjarne Stroustrup: Programming: Principles and Practice using C++. Addison-
 1832: Wesley. 2008. 
 1833: 
 1834: [Williams,2009] Anthony Williams: Multi-threading in C++0x. Overload 93; October 2009. 
 1835: 
 1836: 
 1837: 阹桯嗣啋趙域悝耀宒 婖憩弊暱趙珨霜侘
 1838: 奻漆臟埮湮悝紱釬衪祜ワ趼痀宒迵蛙價痀宒癒笭撼俴
 1839: 扂苺觓忒臟埮湮悝僕斐忑垀笢藝磁釬湮悝
 1840: 釬氪ㄩ蔓梨梨 梪琭2011爛3堎30
 1841: 
 1842: 
 1843: 奻漆臟埮湮悝紱釬衪祜ワ趼痀宒迵蛙價痀宒癒笭撼俴
 1844:  
 1845: 
 1846: 奻漆庈巹萵抎暮﹜庈酗澈淏ㄛ諒郤窒萵窒酗甄すㄛ奻漆庈巹萵抎暮秜珨霅脹堤炟痀宒
 1847:  
 1848: 
 1849: 奻漆臟埮湮悝淏宒羲馱膘扢
 1850:  
 1851: 扂苺蔚觓忒臟埮湮悝ㄛ婓奻漆翻模郲踢矞勞觙纗眼棵訬笢藝磁釬湮悝〞〞奻漆臟埮湮悝﹝奻漆臟埮湮悝蛙價痀宒衾28梒＞媥棞苤奻漆庈巹萵抎暮﹜庈酗澈淏ㄛ諒郤窒萵窒酗甄すㄛ奻漆庈巹萵抎暮秜珨霅ㄛ庈巹都巹﹜ひ陲陔⑹⑹巹抎暮剢矔ㄛ萵庈酗朻窀隴ㄛ庈淉衪萵翋炟﹜ひ陲陔⑹⑹酗蔽鑒鼘耙в膛炬Ｅ蹁耒撈鯬均Ⅲ甽封朵韌鯬廷牝測桶珨れㄛ峈陔苺蛙價鑠芩﹝扂苺絨巹抎暮桲撳佼翋厥賸蛙價痀宒﹝扂苺苺酗貤蕾笢睿臟埮湮悝苺酗埮熔﹞親佴籵珂綴婓祡棗笢桶湛賸勤奻漆臟埮湮悝傖峈室羃紗瓥枒赲銓疥躉紗鄘鷚芺枅磁釬萎毓腔ぶ渾﹝奻漆庈萵庈酗朻窀隴楷桶賸①栥祛腔蔡趕﹝
 1852:  
 1853: 
 1854: 扂苺絨巹抎暮桲撳佼翋厥蛙價痀宒
 1855:  
 1856: 
 1857: 扂苺苺酗貤蕾笢祡棗
 1858:  
 1859: 
 1860: 臟埮湮悝苺酗埮熔﹞親佴籵祡棗
 1861:  
 1862: 
 1863: 奻漆庈萵庈酗朻窀隴祡棗
 1864:  
 1865: 眳ヶㄛ奻漆臟埮湮悝紱釬衪祜淏宒ワ埮﹝諒郤窒萵窒酗甄すㄛ庈鍰絳秜珨霅﹜朻窀隴﹜蔽鑒鼘納拉模в翩扂苺萵苺酗麻福鰴祫侞拉模в翩奻漆庈諒巹翋恮污劙鵅〤硍峒藉籪掏瓥孔韃鰽洁卅眓苺酗貤蕾笢睿臟埮湮悝苺酗埮熔?親佴籵ワ扰賸衪祜﹝
 1866:  
 1867: 
 1868: ワ埮痀宒奻ㄛワ埮侐源挍忒
 1869:  
 1870: 
 1871: 扂苺萵苺酗麻福鰴秷拉模в
 1872:  
 1873: ▲弊模笢酗ぶ諒郤蜊賂睿楷桯寞赫詼猁ㄗ2010-2020爛ㄘ◎枑堤芢輛孺湮諒郤羲溫﹝奻漆臟埮湮悝岆邈妗諒郤窒迵奻漆庈僕膘弊模諒郤軘磁蜊賂妗桄⑹腔笭猁撼渠ㄛ岆奻漆詢脹諒郤弊暱趙域悝腔梓祩俶砐醴ㄛ勤衾抻坰嗣笱源宒竘輛弊俋蚥窐諒郤訧埭撿衄笭猁砩砱﹝奻漆臟埮湮悝蚕扂苺睿藝弊臟埮湮悝甡擂笢俋磁釬域悝沭瞰磁釬撼域ㄛ岆弊囀菴珨垀笢藝磁釬腔弊暱趙湮悝ㄛ撿衄黃蕾楊匋妐韗甚鞂膨糐л睍炩昃掉靺鼣妅肫銖飌椎梤硒湮悝秶僅堍俴腔珨霜旃噶倰湮悝﹝
 1874: 臟埮湮悝苺酗埮熔﹞親佴籵睿扂苺苺酗貤蕾笢桶尨ㄛ邧源磁釬畛宎ㄛ憩梂厥眕窐講峈掛腔埻寀羲桯詢弇磁釬﹜衄窐講腔磁釬﹝釬峈珨垀軘磁俶旃噶倰湮悝ㄛ奻漆臟埮湮悝蔚婓羲桯詢窐講掛褪諒郤腔肮奀ㄛ盓厥珨霜腔悝扲旃噶ㄛ甜蔚甡迖謗跺譫极悝苺羲桯悝扲俶旃噶汜睿蚳珛悝弇旃噶汜諒郤ㄛ鴃辦妏奻漆臟埮湮悝夔劂婓臟埮湮悝掛旯揭衾弊暱郔ヶ齬靡腔踢琚Ｅ而蟾悝﹜冪撳悝脹悝褪鍰郖迕荓奧堤ㄛ鑠欱撿衄弊暱弝珧﹜籵窀弊暱寞寀﹜夔劂統迵弊暱岈昢迵弊暱噥淰腔弊暱趙侘禳
 1875:  
 1876: 
 1877: 邧源苺酗迵悝汜磁荌
 1878:  
 1879: 擂洃ㄛ偌數赫邧源忑珂蔚衾2012爛れ羲扢詢傷踢硜侘齬隒舜鄸縛疤畎敘硜蘢屺例翕肪塾郋褫腔邧悝弇薊磁鑠欱馱釬﹝菴珨趣掛褪汜蔚衾2013爛9堎遹圾狠曶尬し捏芨帠昍樕善垓挍桲耒撈鯬孝弊暱珨霜湮悝源偶秶隅ㄛ粒蚚詢呇汜掀﹜苤啤趙諒悝﹜蛁笭褪旃极桄睿羲溫宒抻坰﹜粒蚚佷望宒睿枒蹦宒腔諒悝源宒ㄛ覂薯衾枑詢悝汜腔蠶瓚俶煦昴睿斐陔俶佷蕉夔薯﹝奻漆臟埮湮悝蔚峈悝汜枑鼎姻瘚騵迆鬚枅諺最极炵ㄛ妏垀衄悝汜婓旮遹彷曼遘亹儽盝例萋旁偌藲翹慲紫饑冼醴ね均〧蝏彃ね宋邰埱遛ね宏驦﹛ˋ恟羸曶志擿婐壨羌кＥ鵅
 1880: 奻漆臟埮湮悝腔悝汜褫瞳蚚臟埮湮悝婓臟埮﹜陝票崨掀脹華垀膘蕾腔室藗讕蝝鯬,輛俴郔酗褫湛跺悝ぶ腔蚔悝﹝
 1881: 奻漆臟埮湮悝帤懂腔楷桯寞耀岆茧衄3000嗣靡掛褪汜﹜旃噶汜ㄛむ笢湮圉腔悝汜蔚懂赻笢弊掛芩ㄛ迵森肮奀ㄛ蜆苺珩頗質翑臟埮湮悝腔桸彶炵苀ㄛ桸彶眈絞杅講腔弊暱悝汜ㄛ峈婓苺悝汜斐婖珨跺弊暱趙腔悝炾遠噫﹝
 1882: 勤衾扂苺奧晟ㄛ斐膘奻漆臟埮湮悝腔醴腔祤婓質牖岍賜珨霜湮悝腔域悝燴癩睿妗犛冪桄ㄛ眕婓侘齬隒齱Ⅶね忘郋縑〧蝏廗昢﹜湮悝奪燴脹源醱輛俴儅憤腔抻坰﹝
 1883: 
 1884: Garbage 
 1885: Collection 
 1886: in 
 1887: the 
 1888: Next 
 1889: C++ 
 1890: Standard 
 1891: 
 1892: 
 1893: Hans-J. Boehm Mike Spertus 
 1894: HP Laboratories Symantec 
 1895: Hans.Boehm@hp.com 
 1896: mike 
 1897: spertus@symantec.com 
 1898: 
 1899: 
 1900: Abstract 
 1901: 
 1902: 
 1903: C++ has traditionally relied on manual memory management. 
 1904: Sometimes this has been augmented by limited reference counting,
 1905:  implemented in libraries, and requiring use of separate pointer 
 1906: types. In spite of the fact that conservative garbage collectors have 
 1907: been used with C for decades, and with C++ for almost as long, 
 1908: they have not been well-supported by language standards. This in 
 1909: turn has limited their use. 
 1910: 
 1911: We have led an effort to change this by supporting optional 
 1912: ※transparent§ garbage collection in the next C++ standard. This is 
 1913: designed to either garbage collect or detect leaks in code using 
 1914: normal unadorned C++ pointers. 
 1915: 
 1916: We initially describe an ambitious effort that would have allowed
 1917:  programmers to explicitly request garbage collection. It 
 1918: faced a number of challenges, primarily in correct interaction with 
 1919: existing libraries relying on explicit destructor invocation. This effort
 1920:  was eventually postponed to the next round of standardization. 
 1921: 
 1922: This initial effort was then temporarily replaced by minimal 
 1923: support in the language that officially allows garbage collected implementations.
 1924:  Such minimal support is included in the current 
 1925: committee draft for the next C++ standard. It imposes an additional
 1926:  language restriction that makes it safe to garbage collect 
 1927: C++ programs. Stating this restriction proved subtle. 
 1928: 
 1929: We also provide narrow interfaces that make it easy to both 
 1930: correct code violating this new restriction, and to supply hints to 
 1931: a conservative garbage collector to improve its performance. These 
 1932: provide interesting implementation challenges. We discuss partial 
 1933: solutions. 
 1934: 
 1935: Categories 
 1936: and 
 1937: Subject 
 1938: Descriptors 
 1939: D.3.3 [Programming 
 1940: Languages]:
 1941:  Language Constructs and Features〞Dynamic storage 
 1942: management 
 1943: 
 1944: General 
 1945: Terms 
 1946: languages, standardization, algorithms 
 1947: 
 1948: Keywords 
 1949: garbage collection, C++ 
 1950: 
 1951: 1. 
 1952: Introduction 
 1953: Most recently designed programming languages such as Java and 
 1954: C# provide for automatic reclamation of the memory associated 
 1955: with unreachable objects, commonly referred to as garbage 
 1956: collection.
 1957:  However, languages such as C and C++ , which commonly 
 1958: still dominate for the development of systems software, traditional 
 1959: 
 1960: Permission to make digital or hard copies of all or part of this work for personal or 
 1961: classroom use is granted without fee provided that copies are not made or distributed 
 1962: for profit or commercial advantage and that copies bear this notice and the full citation 
 1963: on the first page. To copy otherwise, to republish, to post on servers or to redistribute 
 1964: to lists, requires prior specific permission and/or a fee. 
 1965: 
 1966: ISMM＊09 
 1967: June 19每20, 2009, Dublin, Ireland. 
 1968: Copyright c
 1969: 
 1970: . 
 1971: 2009 ACM 978-1-60558-347-1/09/06. . . $5.00 
 1972: desktop applications, and embedded systems, do not intrinsically 
 1973: provide such a facility. Instead the programmer is expected to explicitly
 1974:  deallocate objects when they are no longer needed. 
 1975: 
 1976: Such explicit memory management is widely recognized as 
 1977: error-prone. Especially in applications that manipulate complicated 
 1978: linked data structures, it may be difficult to identify the last use 
 1979: of an object. Mistakes lead to either duplicate deallocations and 
 1980: possible security holes, or memory leaks. 
 1981: 
 1982: This problem becomes more severe in multithreaded applications.
 1983:  Consider a program that maintains an atomically updatable 
 1984: pointer P 
 1985: to a rarely modified object O. Concurrent threads frequently
 1986:  access O 
 1987: by simply dereferencing P 
 1988: , using suitable atomic 
 1989: pointer operations. This typically adds little overhead to accesses. 
 1990: And O 
 1991: can be updated by simply allocating a new copy, initializing 
 1992: it with the updated values, and atomically updating the pointer P 
 1993: to point to the new version. In a garbage collected setting, this just 
 1994: works. 
 1995: 
 1996: However, there is no easy way to explicitly deallocate the old 
 1997: object O 
 1998: in this scheme. The thread performing the update cannot 
 1999: immediately deallocate the old object, since another thread may 
 2000: still be reading it. And indeed, adapting this technique to explicit 
 2001: memory management in an OS kernel setting constitutes the core 
 2002: of a recent Ph.D. dissertation [26]. 
 2003: 
 2004: Unlike C, C++ already simplifies memory management in a 
 2005: number of ways, none of which is a complete solution: 
 2006: 
 2007: . 
 2008: Libraries are generally designed to export values that can be 
 2009: passed around and manipulated as simple values, without the 
 2010: explicit use of pointers or memory allocation. Any memory 
 2011: allocated by the implementation is implicitly deallocated as 
 2012: these value objects are destroyed. This may require techniques 
 2013: such as reference counting of shared objects, but they are hidden 
 2014: from the library users. Although useful, this does not help the 
 2015: library implementor, nor the user who has to invent new pointer-
 2016: containing data structures. 
 2017: . 
 2018: C++ implementations commonly support a reference-counted 
 2019: ※smart pointer§ library called shared 
 2020: ptr[18]. This library 
 2021: facility is expected to become part of the next C++ standard, 
 2022: which is conventionally referred to as C++0x.1 This effectively
 2023:  allows data structures that use shared 
 2024: ptr 
 2025: pointer 
 2026: types to be garbage collected. The programmer is required to 
 2027: avoid shared 
 2028: ptr 
 2029: cycles, possibly with the aid of a provided 
 2030: weak 
 2031: ptr 
 2032: type. 
 2033: For small objects and multithreaded executables, this approach 
 2034: is often much more expensive than tracing garbage collectors
 2035:  [10], though this is expected to improve somewhat as a 
 2036: result of other C++0x language facilities. It is barely applicable
 2037:  at all in cases like our example above, where atomic pointer 
 2038: assignments are required. 
 2039: 
 2040: 1 We are not deterred by the fact that it is now essentially impossible for the 
 2041: standard to be formally approved before 2010. 
 2042: 
 2043: 30
 2044:  
 2045: Perhaps more significantly, this approach is not really applica
 2046: 
 2047: 
 2048: ble if the existing code base involves libraries that already traffic 
 2049: 
 2050: directly in C++ pointers, as most existing code does. 
 2051: 
 2052: . 
 2053: Although not part of the C++ standard per se, Microsoft＊s 
 2054: C++ /CLI supports both regular C++ pointers as well as a different 
 2055: class of pointers to a ※managed§, i.e. garbage-collected 
 2056: heap. Although this allows a wider variety of garbage collection 
 2057: techniques of the managed heap, existing code, even templatized 
 2058: generic libraries, can no longer be used for objects 
 2059: residing in this heap. 
 2060: Along with Demers, and Weiser, we originally developed techniques 
 2061: more than 20 years ago [15]2 that allow C programs to also 
 2062: rely on garbage collection. The same techniques can be used to 
 2063: identify memory leaks [15] in programs using explicit deallocation, 
 2064: an approach used by Purify[21] and other systems. The basic solution 
 2065: is to ※conservatively§ treat everything as a potential pointer, 
 2066: with a fast filtering mechanism that recognizes bit patterns that actually 
 2067: could be pointers to valid objects. 
 2068: 
 2069: This approach was subsequently explored and refined over several 
 2070: decades (cf. [11, 7, 6, 29, 4, 19, 5, 27, 23, 20, 8]), and has 
 2071: worked sufficiently well to have enjoyed some significant successes. 
 2072: It has been used directly in some C or C++ applications, and 
 2073: has often been used in runtimes for garbage collected languages 
 2074: 
 2075: (e.g. in gcj, the GNU static Java compiler and in the Mono CLR 
 2076: implementation), both because it allows a faster initial implementation, 
 2077: and because it usually supports better interoperability with 
 2078: C. 
 2079: Most Linux distributions include at least one version of our 
 2080: garbage collection library[3], along with a few C or C++ applications 
 2081: that rely on them. 
 2082: 
 2083: The second author started a company, eventually indirectly acquired 
 2084: by Symantec, that used the approach to fix memory leaks in 
 2085: existing large applications. 
 2086: 
 2087: In spite of its successes, most C and C++ applications clearly 
 2088: do not rely on such conservative garbage collection. In many cases, 
 2089: this is entirely appropriate, since libraries such as our garbage 
 2090: collector[3] often cannot satisfy some application constraint, e.g. 
 2091: guaranteed required bounds on response times or space usage [8]. 
 2092: 
 2093: But for many other applications, the main objection to adoption 
 2094: of garbage collection has been its poor support by language standards 
 2095: and vendor implementations. 
 2096: 
 2097: There are rare C and C++ programs, arguably supported by existing 
 2098: standards, that will fail in the presence of a garbage collector 
 2099: like ours. These effectively ※disguise§ pointers sufficiently that the 
 2100: garbage collector is unable to recognize them, and hence mistakenly 
 2101: identifies the referenced objects as unreachable, recycling the 
 2102: memory while it is still in use. The most common instance of this 
 2103: are data structures that combine, usually by exclusive-oring them, 
 2104: two pointers in a single pointer-sized field. 
 2105: 
 2106: Similarly, few existing vendor C or C++ implementations directly 
 2107: support garbage collection. (Notable exceptions are the Sun 
 2108: Studio and Digital Mars compilers[25, 16]). 
 2109: 
 2110: Thus our goal was to provide for proper garbage collection support 
 2111: in 
 2112: the 
 2113: language 
 2114: standard, in this case the C++0x standard. Interestingly, 
 2115: in the process of trying to make this approach more 
 2116: palatable to the standards committee, and in developing a prototype 
 2117: implementation based on our garbage collection library[3], we 
 2118: ended up addressing a number of technical issues that we believe 
 2119: had previously been under-appreciated. 
 2120: 
 2121: 2 Doug McIlroy independently explored similar approaches somewhat earlier. 
 2122: Less extreme approaches were also pursued in [28] and [1]. Much 
 2123: later, the initial Java implementations used a related, but much lower performance, 
 2124: approach. 
 2125: 
 2126: 2. 
 2127: Our 
 2128: Initial 
 2129: Proposal 
 2130: We initially proposed comprehensive garbage collection support 
 2131: for C++0x, as a required feature of the implementation, but whose 
 2132: use by the programmer is optional [13]. Although this approach 
 2133: was repeatedly supported by a majority of the committee and was 
 2134: approved as part of the Registration Draft for C++0x, a subsequent 
 2135: vote removed it from the draft standard, largely based on concerns 
 2136: of integrating such a complex language feature on the tight schedule 
 2137: remaining in the C++0x time-frame. Open issues relating to 
 2138: the interaction between distinct libraries and ensuring invocation 
 2139: of C++ destructors that explicitly deallocate non-memory resources 
 2140: in a garbage collected environment figured prominently among the 
 2141: concerns.3 Resolving these concerns would take more time, leading 
 2142: to a consensus that the comprehensive garbage collection proposal 
 2143: would be best addressed in an upcoming technical report containing 
 2144: extensions. 
 2145: 
 2146: The proposal was designed to support transparent operation 
 2147: while simultaneously allowing programmer control. 
 2148: 
 2149: 2.1 
 2150: Transparent 
 2151: Garbage 
 2152: Collection 
 2153: Transparency enables easy use of garbage collection of existing 
 2154: source and object files. In typical cases, no changes to source code 
 2155: are required. Transparent garbage collection enables a number of 
 2156: important use cases. 
 2157: 
 2158: Pure 
 2159: garbage 
 2160: collection 
 2161: We feel that if C++ is not an implementation 
 2162: option for the many programs that have no need for an explicit 
 2163: memory management, C++ will be excluded from many 
 2164: mainstream projects for which it is otherwise suitable [2]. We 
 2165: feel transparent support for the simple case of pure garbage collection 
 2166: is critical as garbage collection support that relies on 
 2167: distinct pointer types, allocators, and the like tends to result in 
 2168: opportunities for programmer error, incompatibility with existing 
 2169: libraries, and overall second-class support for pure garbage 
 2170: collected styles in C++ . 
 2171: 
 2172: Standards 
 2173: support 
 2174: for 
 2175: leak 
 2176: detectors 
 2177: By providing a standardized 
 2178: definition of what constitutes a memory leak, leak detectors 
 2179: can produce more accurate and reliable reports on existing 
 2180: manually managed programs. For this reason, garbage collection 
 2181: is of considerable interest even to those programmers who 
 2182: do not intend to deploy garbage collected programs.4 
 2183: 
 2184: Litter 
 2185: collection 
 2186: Since many existing programs leak memory, a 
 2187: common use for C++ garbage collection is to protect existing 
 2188: programs against memory leaks. Such ※litter collection§ cycles 
 2189: do not significantly affect application throughput since they 
 2190: only need to be run infrequently (often on the order of one per 
 2191: hour). 
 2192: 
 2193: 2.2 
 2194: Programmer 
 2195: Control 
 2196: While adding transparent support for pure garbage collection, we 
 2197: did not wish to impose garbage collection where it is not desired 
 2198: and so included explicit control mechanisms for disabling garbage 
 2199: collection or mixing it with explicit memory management. We 
 2200: did not include any support for scheduling the garbage collector 
 2201: explicitly, as this has proven problematic in languages such as Java, 
 2202: where explicit collection commands are typically treated as null 
 2203: operations. 
 2204: 
 2205: 3 Statements here about C++ committee actions clearly reflect the understanding 
 2206: of the authors, who were proponents of this change, and active 
 2207: participants in discussions. Biases and misunderstandings are certainly possible. 
 2208: 
 2209: 
 2210: 4 Indeed, leak detectors frequently use garbage collection as their underlying 
 2211: implementation technology 
 2212: 
 2213: 31
 2214:  
 2215: One of the most important control mechanisms is not a new one: 
 2216: Existing C++ memory reclamation commands always function as 
 2217: normal. In particular, the C++ delete 
 2218: command frees memory and 
 2219: calls destructors as expected. This ability to apply both garbage 
 2220: collection and explicit management to the same heap provides 
 2221: some notable benefits. 
 2222: 
 2223: . 
 2224: Existing code can be easily used without modification in both 
 2225: garbage collected and non-garbage collected contexts. 
 2226: . 
 2227: The amount of memory that the garbage collector needs to reclaim 
 2228: is greatly reduced, with the potential for greatly improving 
 2229: performance over pure garbage collected languages when 
 2230: space is at a premium or when the average object size is large. 
 2231: . 
 2232: The Litter Collection scenario from the previous subsection 
 2233: relies on this, as does the Leak Detection scenario. 
 2234: It is not specified whether garbage collection is enabled for 
 2235: unannotated source code. This allows existing programs to be easily 
 2236: used with leak detectors and litter collectors as described above. 
 2237: A program can explicitly request that garbage collection be enabled 
 2238: or disabled through use of specific annotation keywords. 
 2239: 
 2240: gc 
 2241: forbidden 
 2242: This keyword specifies that the code may not be 
 2243: used in a garbage collected environment. 
 2244: 
 2245: gc 
 2246: safe 
 2247: This keyword specifies that the code is safe to use in a 
 2248: garbage collected program or in a program without garbage 
 2249: collection. It is the default, and can be loosely expressed as 
 2250: signifying that the code uses explicit memory management 
 2251: but does not hide pointers from a garbage collector (e.g., by 
 2252: exclusive or＊ing two pointers). 
 2253: 
 2254: gc 
 2255: required 
 2256: This keyword specifies that the code relies on 
 2257: garbage collection to reclaim unused memory. 
 2258: 
 2259: gc 
 2260: strict 
 2261: This keyword specifies that the non-pointer types declared 
 2262: in the code, such as integers, will not be used to store 
 2263: pointers. This allows the collector to use type information to reduce 
 2264: conservatism. We believe that gc 
 2265: strict 
 2266: C++ programs 
 2267: can make effective use of precise or nearly-precise collection 
 2268: algorithms. 
 2269: 
 2270: gc 
 2271: relaxed 
 2272: This keyword specifies that the code may store pointers 
 2273: in non-pointer types. gc 
 2274: relaxed 
 2275: code generally requires 
 2276: conservative collection techniques. To maximize compatibility 
 2277: with existing programs, this is the default setting. 
 2278: 
 2279: While these directives can, and typically will, be applied to entire 
 2280: programs in accordance with a preferred garbage collection 
 2281: policy, the gc 
 2282: strict 
 2283: and gc 
 2284: relaxed 
 2285: annotations can also be 
 2286: applied on a finer grain. In this case, the directive applies to all object 
 2287: definitions of integral type in its scope. Consider the following 
 2288: structure definition. 
 2289: 
 2290: gc_strict 
 2291: struct 
 2292: A 
 2293: { 
 2294: A 
 2295: *next; 
 2296: B 
 2297: b; 
 2298: int 
 2299: video_data[100000000]; 
 2300: 
 2301: 
 2302: }; 
 2303: 
 2304: 
 2305: The garbage collector does not need to scan the video 
 2306: data 
 2307: member of A 
 2308: objects for pointers, but will need to scan the next 
 2309: member and the b 
 2310: member. This is very nice because it allows 
 2311: the author of struct 
 2312: A 
 2313: to avoid needlessly scanning of 400MB 
 2314: of video data without worrying about whether B 
 2315: stores pointers in 
 2316: integral types internally. 
 2317: 
 2318: By contrast, the gc 
 2319: forbidden 
 2320: and gc 
 2321: required 
 2322: directives 
 2323: apply to the entire program. This restriction arises because pointer 
 2324: chains may traverse memory created by arbitrary combinations of 
 2325: modules. Pointers hidden in one module can make it unsafe for a 
 2326: 
 2327: garbage collector to reclaim memory allocated in another. Therefore, 
 2328: the proposal does not allow the garbage collection decision to 
 2329: be encapsulated so that a module or library can use garbage collection 
 2330: internally without impact on the external program. Symmetrically, 
 2331: if a small garbage collected program loads a large library, 
 2332: such as libjvm 
 2333: that provides its own memory management, performance 
 2334: can suffer as the entire libjvm 
 2335: heap is needlessly scanned 
 2336: for pointers to the C++ heap. 
 2337: 
 2338: While there do not appear to be any fundamental obstacles 
 2339: to developing suitable annotations that allow encapsulating the 
 2340: garbage collection decision within a single module or library, this 
 2341: would require more time than was available in the C++0x time-
 2342: frame. This was a significant contributor to deferring the comprehensive 
 2343: proposal to a subsequent TR, which would likely include 
 2344: such annotations and appeal to the upcoming Modules Technical 
 2345: Report [30] to improve support in mixed environments. 
 2346: 
 2347: 2.3 
 2348: Finalization 
 2349: The support of finalization in the proposal was controversial. Hence 
 2350: finalization was eventually split into a separate proposal [12]. We 
 2351: believe it is especially important for C++ that garbage collectors 
 2352: support finalization for a variety of reasons. 
 2353: 
 2354: . 
 2355: It is fairly common to use per-object locks for thread synchronization. 
 2356: Indeed, Java provides explicit syntax to support this. 
 2357: For some very common operating systems, the lock resource 
 2358: consists of more than just memory in the object. Thus, without 
 2359: finalization, we may lose much of the benefit of garbage collection, 
 2360: at least in multi-threaded programs. 
 2361: . 
 2362: Opaque objects returned by a third-party library whose interface 
 2363: calls for them to be properly destroyed require finalization. 
 2364: . 
 2365: Mixing garbage collected and explicitly managed memory may 
 2366: result in memory leaks without finalization. For example, if a 
 2367: std::vector 
 2368: member of a garbage class uses a non-garbage 
 2369: collected allocator, the data structures of the vector will be 
 2370: leaked. 
 2371: . 
 2372: When supporting the ※leak detector§ use case for garbage collection, 
 2373: finalizers are useful for implementing reports on leaked 
 2374: memory and non-memory resources. 
 2375: Although tempting, it is not desirable to equate finalizers and 
 2376: destructors because they may be called in different synchronization 
 2377: contexts in multi-threaded programs.5 In addition, many destructors 
 2378: just release memory and would be wasteful to track with 
 2379: garbage collection enabled. 
 2380: 
 2381: Finalizer methods are defined by prefixing the class name with 
 2382: ~~ 
 2383: to reflect the kinship with destructors. In many cases, they will 
 2384: just call the corresponding destructor after acquiring appropriate 
 2385: locks. 
 2386: 
 2387: std::mutex 
 2388: m; 
 2389: // 
 2390: Mutex 
 2391: protecting 
 2392: global 
 2393: resource 
 2394: 
 2395: 
 2396: // 
 2397: required 
 2398: by 
 2399: destructor 
 2400: class 
 2401: A 
 2402: { 
 2403: public: 
 2404: 
 2405: 
 2406: ~A(); 
 2407: // 
 2408: destructor 
 2409: 
 2410: 
 2411: ~~A() 
 2412: { 
 2413: // 
 2414: finalizer 
 2415: 
 2416: 
 2417: std::lock_guard<std::mutex> 
 2418: protect(m); 
 2419: 
 2420: 
 2421: ~A(); 
 2422: 
 2423: 
 2424: } 
 2425: }; 
 2426: 
 2427: 
 2428: Unfortunately, finalization is difficult to support in a way that 
 2429: neither degrades performance of the vast majority of code that does 
 2430: 
 2431: 5 This issue also arises in other C++ techniques for supporting automatic 
 2432: memory management, as in the use of destructors by C++0x shared 
 2433: ptrs. 
 2434: 
 2435: 32
 2436:  
 2437: not use it, nor is likely to introduce subtle bugs into the majority of 
 2438: code. 
 2439: 
 2440: As was pointed out in [9] and repeated in [12], there is a fundamental 
 2441: tension between compiler optimizations, and specifically 
 2442: elimination of dead pointer variables, on one side, and easily usable 
 2443: finalization on the other.6 
 2444: 
 2445: To see this, consider a finalizable class that maintains some of 
 2446: the state of each object in an external data structure E, which is indexed 
 2447: with an index value stored in the object. Thus E[p->index] 
 2448: is the state associated with object p. Assume that p＊s finalizer destroys 
 2449: this state in some way that renders it unsafe to access, e.g. 
 2450: by explicitly deallocating part of it. 
 2451: 
 2452: Now assume that the final method call on p 
 2453: executes the following 
 2454: code: 
 2455: 
 2456: int 
 2457: i 
 2458: = 
 2459: index; 
 2460: 
 2461: 
 2462: a: 
 2463: foo(E[i]); 
 2464: If a garbage collection takes place at point a, there is no guarantee 
 2465: that a pointer to p, i.e. to this 
 2466: will be visible to the garbage 
 2467: collector. The this 
 2468: pointer is not subsequently accessed and hence 
 2469: there is no reason for the compiler to preserve it. Modern calling 
 2470: conventions increasingly allow it to reside only in registers, which 
 2471: are fairly likely to be reused, e.g. to store i. Thus p 
 2472: may be finalized 
 2473: at point a, and the call to foo 
 2474: may fail unexpectedly. 
 2475: 
 2476: We suggest a spectrum of solutions in [12]. These include 
 2477: 
 2478: . 
 2479: Forbidding dead-variable elimination on essentially all pointers. 
 2480: Surprisingly to us, this was viewed as having very modest 
 2481: and acceptable cost by some of the compiler experts in the 
 2482: room, though actual measurements are lacking. 
 2483: . 
 2484: Requiring the programmer to insert keepAlive() 
 2485: calls, as is 
 2486: essentially required by both Java and C#.7 
 2487: . 
 2488: A hybrid based on an argument that it is almost always possible 
 2489: to identify when this might be an issue based on static type 
 2490: information.8 
 2491: Unfortunately none of these is unambiguously the correct solution, 
 2492: and the uncertainty clearly contributed to the postponement of 
 2493: this proposal. 
 2494: 
 2495: 3. 
 2496: A 
 2497: Much 
 2498: More 
 2499: Modest 
 2500: Proposal 
 2501: Although adoption of the comprehensive proposal was moved beyond 
 2502: the next C++ standard, there remained a desire to improve 
 2503: support for garbage collection in the C++0x time frame. This 
 2504: gave rise to our current compromise proposal [14, 22], which 
 2505: has been adopted. Its goal is simply to allow garbage collecting 
 2506: C++ implementations to completely conform to the standard, while 
 2507: ensuring that existing applications either remain compatible with 
 2508: such an implementation or, in rare cases, have an easy path to become 
 2509: compatible with such implementations. It primarily makes 
 2510: three changes to the language and library: 
 2511: 
 2512: 1. It restricts the language so that only ※safely derived§ (undisguised) 
 2513: pointers to objects allocated with the built-in new 
 2514: operator 
 2515: may be safely dereferenced (or deallocated). For example, 
 2516: 6 There are also still ongoing discussions about better addressing this in 
 2517: Java, where we conjecture that a large number (majority?) of deployed 
 2518: classes using finalization exhibit the problem described below in some form. 
 2519: 
 2520: 7 However few Java and C# programmers seem to understand this fully. 
 2521: And Java currently spells keepAlive(this) 
 2522: as synchronized(this), 
 2523: with some added restrictions. 
 2524: 
 2525: 8 This unfortunately appears to be false in Java, since java.lang.ref 
 2526: effectively 
 2527: allows any object to be registered for finalization-like processing. 
 2528: 
 2529: this prevents a program from storing the only copy of a pointer 
 2530: in a file on disk, and then dereferencing it. This effectively allows 
 2531: implementations to garbage collect objects that appear to 
 2532: the garbage collector to be unreachable, and yet remain fully 
 2533: conforming. However, it provides no guarantees that a garbage 
 2534: collector is provided. 
 2535: 
 2536: 2. It provides a declare 
 2537: reachable() 
 2538: call to explicitly inform 
 2539: a garbage collector that an object must be treated as reachable 
 2540: although all pointers to it are hidden from the collector. 
 2541: Effectively this provides an escape from the above restriction 
 2542: to safely-derived pointers. An undeclare 
 2543: reachable() 
 2544: call 
 2545: is also provided to undo the effect. In a non-garbage-collected 
 2546: implementation, both may be implemented as no-ops. 
 2547: 3. It provides a 
 2548: declare 
 2549: no 
 2550: pointers() 
 2551: call (along with its 
 2552: inverse) to tell the garbage collector that certain regions of 
 2553: memory never contain valid pointers, and hence do not need 
 2554: to be scanned. 
 2555: The current proposal only allows garbage collection of objects 
 2556: allocated with the system-provided new 
 2557: operator. In particular it 
 2558: does not restrict pointers to malloc-allocated objects, although 
 2559: it would clearly be desirable for implementations to provide an 
 2560: option to collect those as well. These were excluded for now, 
 2561: both because the use of malloc 
 2562: by some low-level systems code 
 2563: imposes particular implementation challenges, and because we felt 
 2564: that such a change should really involve the C committee, not just 
 2565: the C++ committee. 
 2566: 
 2567: Even this modest proposal breaks backwards compatibility 
 2568: with a few existing C++ programs. We impose new restrictions 
 2569: on pointer use. Past experience with conservative garbage collectors 
 2570: and leak detectors in C and C++ suggests that the vast majority 
 2571: of code satisfies these restrictions. But small amounts of existing 
 2572: code may need to be updated. This is fundamentally unavoidable: If 
 2573: we want to provide garbage collection, or even reliable leak detection, 
 2574: for existing unmodified code, we must make the assumptions 
 2575: necessary to guarantee that a tracing garbage collector can work. 
 2576: 
 2577: As a practical matter, we expect such backwards compatibility 
 2578: issues to be minor. We would be very surprised if any implementations 
 2579: in the near term supported only a garbage collected runtime. 
 2580: Effectively, the programmer will be required to make changes, if 
 2581: any are needed, only in order to take advantage of newly provided 
 2582: garbage collection support. 
 2583: 
 2584: 4. 
 2585: Disallowing 
 2586: Access 
 2587: to 
 2588: Unreachable 
 2589: Objects 
 2590: A major concern with retrofitting a garbage collector to existing 
 2591: C++ code is that the code might ※hide pointers§ such that the 
 2592: garbage collector cannot see those pointers, and hence reclaims the 
 2593: referenced object, in spite of the fact that the pointer may still be 
 2594: dereferenced. This might occur for two very distinct reasons: 
 2595: 
 2596: 1. The compiler may perform code transformations that temporarily 
 2597: hide pointers to an object. For example, the last reference to 
 2598: a[i-1] 
 2599: might be compiled as a 
 2600: = 
 2601: a 
 2602: -1, 
 2603: a[i]. If a garbage 
 2604: collection were to take place just after decrementing the pointer 
 2605: to the beginning of the array a, it might reclaim the array before 
 2606: its last access. 
 2607: 2. The programmer may explicitly hide pointers. For example, 
 2608: linked list nodes occasionally store a single link field containing 
 2609: the exclusive-or of the pointers to the previous and next nodes, 
 2610: so that either pointer canbe recovered if the other is known, 
 2611: and hence the list can be traversed in both directions while only 
 2612: requiring a single pointer-sized link field. Unless the garbage 
 2613: collector is somehow informed of this convention, none of the 
 2614: 33
 2615:  
 2616: nodes in the middle of the list will appear referenced to the 
 2617: collector, and hence may be reclaimed prematurely. 
 2618: 
 2619: The first problem must be addressed by any implementation that 
 2620: supports garbage collection. The techniques for doing so are well-
 2621: known [5]. 
 2622: 
 2623: The second problem is more interesting. Historically it has been 
 2624: somewhat unclear whether a strictly conforming program could 
 2625: hide pointers in a way that could not be handled through extremely 
 2626: conservative garbage collection techniques. But the recent introduction 
 2627: of the intptr 
 2628: t 
 2629: type makes it clear that it is possible to 
 2630: convert pointers to integers and back, with arbitrary computation on 
 2631: the integers in the middle. Independent of standards conformance 
 2632: issues, such techniques have always been used by a few applications. 
 2633: 
 2634: 
 2635: Our first attempts were to craft language requiring that all 
 2636: objects allocated with new 
 2637: must be reachable from recognizable 
 2638: pointers at all times. However, this would impose significant restrictions 
 2639: on optimization. 
 2640: 
 2641: Consider the following function: 
 2642: 
 2643: int 
 2644: f() 
 2645: 
 2646: 
 2647: { 
 2648: 
 2649: 
 2650: int 
 2651: *p 
 2652: = 
 2653: new 
 2654: int(); 
 2655: 
 2656: 
 2657: int 
 2658: *q 
 2659: = 
 2660: (int 
 2661: *)((intptr_t)p 
 2662: ^ 
 2663: 0x555); 
 2664: 
 2665: 
 2666: a: 
 2667: q 
 2668: = 
 2669: (int 
 2670: *)((intptr_t)q 
 2671: ^ 
 2672: 0x555); 
 2673: return 
 2674: *q; 
 2675: } 
 2676: 
 2677: 
 2678: The object allocated at the beginning of the function is clearly 
 2679: reachable via p 
 2680: throughout f(). Nonetheless, a garbage collection 
 2681: at label a 
 2682: might reclaim it, since p 
 2683: is dead at that point, and would 
 2684: probably no longer be stored due to dead variable optimizations, 
 2685: while q 
 2686: contains only a disguised pointer to the object. This is 
 2687: closely related to the premature finalization problem described 
 2688: above and in [9]. 
 2689: 
 2690: Wholesale restrictions on dead variable elimination were regarded 
 2691: as too intrusive for (at least) the type of modest proposal 
 2692: adopted into the draft standard. C++0x implementations supporting 
 2693: garbage collection will still need to respect the more modest 
 2694: restrictions on optimizations described in [5]. 
 2695: 
 2696: Thus the correct restriction here is to first define a notion of a 
 2697: safely 
 2698: derived 
 2699: pointer, that has been derived from a pointer returned 
 2700: by new, and then modified only by a sequence of operations such 
 2701: that none of the intermediate results could have ※disguised§ the 
 2702: pointer. In addition we require that all of these intermediate values 
 2703: only be stored in fields in which they could be recognized as such 
 2704: by the garbage collector. We allow them to be stored in pointer 
 2705: fields, integer fields of sufficient size, and aligned subsequences of 
 2706: char 
 2707: arrays.9 
 2708: 
 2709: Note that this is a property of pointer expressions, not values. 
 2710: At the end of the block in our example above p 
 2711: and q 
 2712: will typically 
 2713: contain the same binary value. Clearly p 
 2714: is safely derived, and 
 2715: hence would have been safe to dereference, while q 
 2716: is not. 
 2717: 
 2718: We then insist that only safely derived pointers may be dereferenced 
 2719: or used for deallocation with delete. 
 2720: 
 2721: 5. 
 2722: Performance 
 2723: challenges 
 2724: for 
 2725: declare 
 2726: reachable 
 2727: 
 2728: 
 2729: A call to declare 
 2730: reachable(p) 
 2731: is specified to ensure that the 
 2732: entire allocated object containing the object referenced by p 
 2733: be 
 2734: 
 2735: 9 Both C and C++ allow arbitrary data to be temporarily moved into char 
 2736: arrays and relax typing rules to facilitate that. 
 2737: 
 2738: retained even if it appears to be unreachable. More precisely, a 
 2739: call to declare 
 2740: reachable(p) 
 2741: requires that p 
 2742: itself be a safely 
 2743: derived pointer, but allows subsequent dereferences of pointers q 
 2744: to the same ※complete§ object as p, even if q 
 2745: is not safely derived. 
 2746: 
 2747: This is undone by a call to undeclare 
 2748: reachable(r), where 
 2749: r 
 2750: points to the same complete object as a prior argument p 
 2751: to 
 2752: declare 
 2753: reachable(). 
 2754: 
 2755: Undeclare 
 2756: reachable() 
 2757: returns a safely-derived copy of its 
 2758: argument. If the programmer wants to temporarily hide a pointer, it 
 2759: can be safely done through code such as 
 2760: 
 2761: declare_reachable(p); 
 2762: p 
 2763: = 
 2764: (foo 
 2765: *)((intptr_t)p 
 2766: ^ 
 2767: 0x5555); 
 2768: // 
 2769: p 
 2770: is 
 2771: disguised 
 2772: here. 
 2773: p 
 2774: = 
 2775: undeclare_reachable((foo 
 2776: *) 
 2777: 
 2778: 
 2779: ((intptr_t)p 
 2780: ^ 
 2781: 0x5555)); 
 2782: // 
 2783: p 
 2784: is 
 2785: once 
 2786: again 
 2787: safely 
 2788: derived 
 2789: here 
 2790: and 
 2791: can 
 2792: // 
 2793: be 
 2794: dereferenced. 
 2795: 
 2796: 
 2797: In a non-garbage-collected implementation both calls turn into 
 2798: no-ops, and hence the resulting object code is very similar to what it 
 2799: would have been in the GC-unsafe version. In a garbage collected 
 2800: implementation declare 
 2801: reachable(p) 
 2802: effectively adds p 
 2803: to a 
 2804: global, GC-visible data structure. 
 2805: 
 2806: Multiple declare 
 2807: reachable() 
 2808: and undeclare 
 2809: reachable() 
 2810: calls on the same object may be nested. Thus the natural implementation 
 2811: keeps a multiset of all pointers that were declared reachable. 
 2812: In our prototype implementation, the multiset is implemented as a 
 2813: chained hash table, with each linked list node containing a small 
 2814: number m 
 2815: of pointers in a single node. 
 2816: 
 2817: The implementation does however pose several performance 
 2818: challenges, addressed in the next two subsections. 
 2819: 
 2820: 5.1 
 2821: Arguments 
 2822: need 
 2823: not 
 2824: be 
 2825: equal 
 2826: The effect of a declare 
 2827: reachable() 
 2828: call may be undone by a 
 2829: call to undeclare 
 2830: reachable() 
 2831: with a slightly different pointer 
 2832: to the same complete object. Since these calls really affect complete 
 2833: objects, this yields a significantly less contorted specification. Since 
 2834: our prototype is implemented in the context of the our conservative 
 2835: garbage collector, which can map pointers to the base address of 
 2836: the object, this is not a fundamental problem. We could simply map 
 2837: every argument to either call to the base of the corresponding heap 
 2838: object. 
 2839: 
 2840: We expect that in the vast majority of use cases the work to 
 2841: perform this mapping is useless. Even C++ programs typically 
 2842: traffic in pointers to the beginning of the object. Even when they 
 2843: don＊t, it is very likely that they will use the same pointer value for 
 2844: both calls. 
 2845: 
 2846: Hence we instead include the original unmodified 
 2847: declare 
 2848: reachable() 
 2849: argument in the multiset representation. 
 2850: If an undeclare 
 2851: reachable 
 2852: call cannot find its argument 
 2853: in the multiset, we map the argument to the base address of the 
 2854: object. Thus undeclare 
 2855: reachable 
 2856: proceeds by trying three 
 2857: increasingly time consuming approaches in turn: 
 2858: 
 2859: 1. We 
 2860: look for the specific argument x 
 2861: passed to 
 2862: undeclare 
 2863: reachable(x) 
 2864: in the hash table. For most 
 2865: usage, we expect this to succeed roughly all the time. 
 2866: 2. We look up the base address of the object x 
 2867: in its hash bucket, 
 2868: looking up the base address of each object in the bucket as 
 2869: we go. This is not guaranteed to succeed, since we may be 
 2870: looking in the wrong hash bucket. However, the hash function 
 2871: is designed to ignore a few of the least significant bits in the 
 2872: 34
 2873:  
 2874: pointer value10 Thus if x 
 2875: is close to the corresponding table 
 2876: entry, there is a high probability of the lookup succeeding. 
 2877: 
 2878: 3. We look through all other hash buckets corresponding to addresses 
 2879: within the object x, looking for an object with the same 
 2880: base address. Assuming O(1) 
 2881: elements in each bucket, this process 
 2882: takes O(s) 
 2883: time, where s 
 2884: is the size of the object. Thus its 
 2885: asymptotic complexity is still similar to that of allocating and 
 2886: collecting the object. 
 2887: 5.2 
 2888: Concurrent 
 2889: access 
 2890: to 
 2891: multiset 
 2892: We would like to maintain the efficiency of declare 
 2893: reachable() 
 2894: and undeclare 
 2895: reachable() 
 2896: in the presence of threads. We 
 2897: would like to minimize the chances that either becomes a scalability 
 2898: bottleneck when these functions are called from multiple 
 2899: threads. 
 2900: 
 2901: Unfortunately, it is not easily possible to keep a separate multiset 
 2902: for each thread, since corresponding declare 
 2903: reachable() 
 2904: and undeclare 
 2905: reachable() 
 2906: calls may not be made by the same 
 2907: thread. 
 2908: 
 2909: We currently address this issue by keeping lightweight per-
 2910: chain locks for our chained hash table. We dynamically increase 
 2911: the size of the hash table, using the technique described in [17]. 
 2912: 
 2913: This has the disadvantage that the fast path for both calls still requires 
 2914: a lock acquisition and release, which is usually a significant 
 2915: cost. Techniques similar to those in the next section might alleviate 
 2916: that, but it is unclear that these calls will be performance critical 
 2917: enough to warrant that effort. 
 2918: 
 2919: 6. 
 2920: Performance 
 2921: challenges 
 2922: for 
 2923: declare 
 2924: no 
 2925: pointers 
 2926: 
 2927: 
 2928: In most garbage-collected programming languages, objects in the 
 2929: heap contain type descriptors that can be used to locate pointers 
 2930: in the object to facilitate tracing during garbage collection. The 
 2931: type descriptors are derived from the type of the object when it 
 2932: was constructed. 
 2933: 
 2934: In C and C++ , type information itself may be insufficient. For 
 2935: example, a char 
 2936: array may be used to temporarily hold a pointer-
 2937: containing structure. Certain integral types may be used to hold 
 2938: pointers. 
 2939: 
 2940: We address this issue primarily by assuming a conservative 
 2941: garbage collector that can determine at run-time whether a particular 
 2942: bit-pattern is a valid object address. Nonetheless, such collectors 
 2943: may perform much better, particularly in densely occupied address 
 2944: spaces, if the collector can disregard certain fields when locating 
 2945: pointers during tracing. Large arrays containing compressed, and 
 2946: thus seemingly random, data are the most egregious example of 
 2947: this. 
 2948: 
 2949: Since we cannot rely on static type information, the C++0x draft 
 2950: instead provides a simple call declare 
 2951: no 
 2952: pointers(p, 
 2953: n). It 
 2954: declares that no pointers are stored in the memory region consisting 
 2955: of n 
 2956: bytes starting at p. More precisely, any pointers that are stored 
 2957: there are no longer considered to have been safely derived, and 
 2958: hence may no longer be dereferenced. 
 2959: 
 2960: The region passed to declare 
 2961: no 
 2962: pointers() 
 2963: will typically 
 2964: reside either in the heap, or inside a statically allocated object that 
 2965: would otherwise have been treated as part of the root set. This 
 2966: interface was chosen largely because of its simplicity. 
 2967: 
 2968: The effect of declare 
 2969: no 
 2970: pointers(p, 
 2971: n) 
 2972: may be undone 
 2973: by a call to undeclare 
 2974: no 
 2975: pointers(p, 
 2976: n) 
 2977: with the same val
 2978: 
 2979: 
 2980: 10 To avoid excessive collisions for consecutive allocations, the number of 
 2981: ignored bits shouldn＊t be much more than roughly log(m) 
 2982: + 
 2983: log(g), where 
 2984: m 
 2985: is the number of pointers in a hash chain node, and g 
 2986: is the minimum 
 2987: allocation size. 
 2988: 
 2989: ues. These calls do not nest. A no-pointers range must be unregistered 
 2990: before an object is explicitly deallocated. When an object is 
 2991: garbage-collected, any corresponding no-pointers ranges must be 
 2992: automatically removed. 
 2993: 
 2994: This interface makes it relatively convenient to exclude address 
 2995: ranges from scanning by invoking declare 
 2996: no 
 2997: pointers() 
 2998: in 
 2999: an object＊s constructor, and then to remove the information with 
 3000: undeclare 
 3001: no 
 3002: pointers() 
 3003: in its destructor. Since these calls 
 3004: apply to any region of memory, the constructor importantly does 
 3005: not need to know whether the object is allocated in the heap, on the 
 3006: stack, or statically. The object layout information does not leak to 
 3007: the client. 
 3008: 
 3009: Unlike prior approaches, such as those supported by our existing 
 3010: collector (e.g GC 
 3011: malloc 
 3012: atomic), this call modifies the collector＊s 
 3013: pointer location information after 
 3014: the object has been allocated. 
 3015: This is precisely what makes the interface a much better 
 3016: match for C++ ＊s constructor and destructor facilities, but it also 
 3017: makes the implementation 11 considerably more challenging. 
 3018: 
 3019: An implementation could accommodate this kind of dynamic 
 3020: information in one of two ways: 
 3021: 
 3022: 1. It could dynamically store the information in the object. In 
 3023: the normal case for our collector, there is no meta-information 
 3024: stored in the object. Objects allocated with explicit pointer location 
 3025: information are identified by segregating them into a 
 3026: separate ※heap block§ or chunk, roughly a page. Thus this 
 3027: appeared impossible without adding appreciable overhead, 
 3028: even for the case in which declare 
 3029: no 
 3030: pointers 
 3031: is unused. 
 3032: It may still be the most effective way to accommodate 
 3033: declare 
 3034: no 
 3035: pointers 
 3036: for large quantities of small heap objects, 
 3037: so if this interface becomes widely used, this decision 
 3038: may eventually have to be revisited. 
 3039: 2. It can store no-pointers information in a separate data structure, 
 3040: which is processed at garbage collection time. This also 
 3041: promises to add less overhead for information that is added and 
 3042: removed entirely between garbage collections. Since we expect 
 3043: calls to be made from constructors and destructors, we expect 
 3044: this to be the common case for stack allocated objects. We chose 
 3045: this route for now. 
 3046: In order to accommodate fast addition and removal of no-
 3047: pointers ranges by multiple independent threads, we go out of 
 3048: our way to allow threads to process the easy cases independently. 
 3049: This is likely to be even more important here than in the case of 
 3050: declare 
 3051: reachable() 
 3052: since we expect no-pointers calls to be 
 3053: significantly more frequent. 
 3054: 
 3055: 6.1 
 3056: The 
 3057: no-pointers 
 3058: data 
 3059: structure 
 3060: The data structures required here are again complicated 
 3061: by the fact that matching declare 
 3062: no 
 3063: pointers() 
 3064: and 
 3065: undeclare 
 3066: no 
 3067: pointers() 
 3068: calls need not be made by the 
 3069: same thread. To accommodate this without requiring a lock acquisition 
 3070: on every call, we record the information in four separate data 
 3071: structures: 
 3072: 
 3073: 1. Per-thread arrays 
 3074: Dt 
 3075: containing a fixed number of recently 
 3076: added no-pointers ranges. We also store an associated index 
 3077: IDt. Based on a tag bit, it stores either the index of what 
 3078: might be the next available slot (a hint) or the index of an entry 
 3079: currently being removed by this thread. 
 3080: 2. Per-thread arrays Ut 
 3081: containing a fixed number of no-pointers 
 3082: ranges that were recently removed by thread t, but could not be 
 3083: found in Dt. 
 3084: 11 Declare 
 3085: no 
 3086: pointers 
 3087: may be correctly implemented as a no-op, but 
 3088: this is not useful. 
 3089: 
 3090: 35
 3091:  
 3092: TDDUU0n0nUL..
 3093: .
 3094: ...
 3095: RemoveRemoveRemoveIndexed byhigh addressbitsIndexed bylow addressbits
 3096: Figure 
 3097: 1. 
 3098: No-pointers data structures 
 3099: 
 3100: 3. A linked list of no-pointers ranges UL 
 3101: containing no-pointers 
 3102: ranges representing the combined overflow from all the Ut. The 
 3103: only reason for separating these is that UL 
 3104: is protected by a lock 
 3105: shared with the garbage collector, while Ut 
 3106: can be accessed 
 3107: using light-weight lock-free techniques. Since the entire array 
 3108: Ut 
 3109: is processed at once, the separation greatly reduces the 
 3110: number of lock acquisitions. 
 3111: 4. A more complex shared data structure T 
 3112: containing no-pointers 
 3113: ranges that either overflowed from Dt, or were in effect at the 
 3114: last garbage collection. 
 3115: Figure 1 gives a pictorial representation of the data structure. 
 3116: Wide arrows indicate propagation of data between the different 
 3117: elements. Note that for Ut 
 3118: and UL, §propagation§ means that data 
 3119: is removed from T 
 3120: . Ranges are propogated from Ut 
 3121: to UL 
 3122: only if 
 3123: they cannot be found in T 
 3124: for removal. This may happen if they 
 3125: reside in another thread＊s Dt. 
 3126: 
 3127: Our garbage collector already uses a two-level tree data structure,
 3128:  reminiscent of hardware page tables, to map each heap chunk 
 3129: to its meta-information. We abstracted this data structure out, so 
 3130: that we could use a separate instance of it to represent T 
 3131: . Since the 
 3132: data structure is indexed by addresses, independent of whether they 
 3133: are inside or outside the heap, it is easy to add addresses in the root 
 3134: set. 
 3135: 
 3136: Each ※leaf§ in our two level tree contains a pointer to a sorted 
 3137: doubly-linked list of no-pointers ranges associated with the corresponding
 3138:  chunk-sized region (think page) of memory. No-pointers 
 3139: ranges spanning these regions are split and inserted separately into 
 3140: each list. The pointer at the leaf of the tree may point to anywhere 
 3141: in the list, and is left at the last accessed location, so that searches 
 3142: for ranges corresponding to adjacent memory regions are relatively 
 3143: fast. 
 3144: 
 3145: 6.2 
 3146: Managing 
 3147: asynchronous 
 3148: thread 
 3149: suspension 
 3150: Since the shared data structures UL 
 3151: and T 
 3152: are currently protected 
 3153: by the main allocator/GC lock, the trickiest ※concurrency§ issue 
 3154: arises with updates to Dt, the per-thread arrays of no-pointers 
 3155: ranges. Each Dt 
 3156: may be accessed in four different ways: 
 3157: 
 3158: Insertion 
 3159: Thread t 
 3160: may add an entry by atomically replacing a null 
 3161: element of the array with a pointer to a no-pointers range. No 
 3162: other thread ever replaces a null entry with a non-null one, so 
 3163: this does not require an atomic compare-and-swap. We do insist 
 3164: that the update become visible atomically to a signal handler 
 3165: invoked as the result of a GC request to stop the thread. 
 3166: 
 3167: Flush 
 3168: Thread t 
 3169: may acquire the allocator/GC lock and flush Dt 
 3170: by 
 3171: copying them into the shared T 
 3172: . This happens when it cannot 
 3173: immediately find an empty slot. 
 3174: 
 3175: GC 
 3176: Flush 
 3177: The garbage collector may scan and move the Dt 
 3178: contents
 3179:  into T 
 3180: , thus clearing Dt, while thread t 
 3181: is stopped in a 
 3182: signal handler. While doing so, it will ignore (and not clear) an 
 3183: entry marked by IDt 
 3184: as currently being removed. (Since the removal
 3185:  call has not yet completed, it is acceptable to treat the 
 3186: corresponding no-pointers range as still being in effect.) 
 3187: 
 3188: Removal 
 3189: Thread t 
 3190: may remove an entry from Dt 
 3191: in response to 
 3192: an undeclare 
 3193: no 
 3194: pointers 
 3195: call from the same thread on the 
 3196: same range. IDt 
 3197: is set to the index of the element being removed
 3198:  before the actual removal, and reset afterwards. Suitable
 3199:  care is exercised to prevent compiler reordering of these 
 3200: assignments, since a signal handler must see a consistent state. 
 3201: Hardware memory fences are not required, since there is no real 
 3202: concurrency. The only accesses from outside t 
 3203: occur while t 
 3204: is 
 3205: stopped. 
 3206: 
 3207: If IDt 
 3208: were not used to guard against simultaneous removals 
 3209: by the garbage collector and undeclare 
 3210: no 
 3211: pointers(), the 
 3212: undeclare 
 3213: no 
 3214: pointers() 
 3215: call may effectively be lost. Unlike 
 3216: declare 
 3217: no 
 3218: pointers() 
 3219: calls, this is unsafe, since a pointer-
 3220: containing region may no longer be scanned. 
 3221: 
 3222: The treatment of Ut 
 3223: is fundamentally similar, but easier, 
 3224: since elements are only removed while holding the allocation/GC 
 3225: lock. Thus this coordination with the garbage collector is not 
 3226: an issue. Note that in the easy cases that we particularly want 
 3227: to optimize, Ut 
 3228: is updated much less frequently than Dt. If 
 3229: undeclare 
 3230: no 
 3231: pointers() 
 3232: can directly remove an element from 
 3233: Dt 
 3234: it does not touch Ut. 
 3235: 
 3236: 6.3 
 3237: Handling 
 3238: no-pointers 
 3239: data 
 3240: while 
 3241: tracing 
 3242: The actual garbage collection code in our collector was only minimally
 3243:  modified. As before, the garbage collector stops other threads 
 3244: during the GC mark phase by sending them signals. (We do not yet 
 3245: handle incremental GC mode well, but it is relatively rarely used.) 
 3246: Once threads are stopped, the collector invokes a routine that transfers
 3247:  all no-pointers information into the shared tree T 
 3248: . This is accomplished
 3249:  by first flushing all Dt 
 3250: arrays into the tree, and then 
 3251: processing all pending removals from both the Ut 
 3252: arrays and UL. 
 3253: 
 3254: Note that this may temporarily result in duplicate or overlapping 
 3255: entries in T 
 3256: , if similar no-pointers ranges are repeatedly added and 
 3257: removed during the GC interval. This is fine; if we are asked to 
 3258: remove a range, we remove the first copy we find. 
 3259: 
 3260: Since it would be very expensive to constantly check against no-
 3261: pointers ranges during marking in our scheme, we currently limit 
 3262: the number of such checks in two ways. Both of these effectively 
 3263: cause us to ignore certain declare 
 3264: no 
 3265: pointers() 
 3266: calls: 
 3267: 
 3268: 1. We currently check for no-pointers regions only the last time we 
 3269: split large blocks in the marker. (Our collector normally does 
 3270: such splitting both in order to avoid mark stack overflows when 
 3271: pushing objects referenced from large blocks, and to facilitate 
 3272: tracing the pieces in parallel.) Currently we split blocks larger 
 3273: than 512 bytes. This normally causes no-pointers regions in the 
 3274: root set, and no-pointers regions containing substantial amounts 
 3275: of compressed data (e.g. images) to be respected. Empirically, 
 3276: these are probably the most important applications. It does 
 3277: render efforts to declare no-pointers ranges inside small heap 
 3278: objects ineffective. 
 3279: 2. We can explicitly ignore no-pointers regions below a certain 
 3280: size. We currently ignore requests of less than 2 words, though 
 3281: we have no real reason to believe that＊s an appropriate value. 
 3282: 36
 3283:  
 3284: When we do need to look up no-pointers ranges within an object, 
 3285: it is relatively efficient: It takes us as little as two memory 
 3286: references to retrieve the pointer to the doubly linked list of no-
 3287: pointers ranges for that memory region. And that pointer will typically 
 3288: be positioned close to the address we are looking for. This 
 3289: no-pointers list is then used to trace only those regions outside any 
 3290: of the ranges. 
 3291: 
 3292: The collector was already structured so that this same scheme 
 3293: handles both root segments and heap objects. 
 3294: 
 3295: Finally, we added a post-pass to the garbage collector that removes 
 3296: no-pointers regions corresponding to unmarked objects. 
 3297: 
 3298: 7. 
 3299: Evaluation 
 3300: We expect that nearly all code will pass matching arguments to 
 3301: declare 
 3302: reachable 
 3303: and undeclare 
 3304: reachable 
 3305: nearly all of 
 3306: the time. Thus the performance-critical implementation path reduces 
 3307: to that of implementing a concurrent map. Since there are 
 3308: good known solutions, we expect reasonable performance and processor 
 3309: scalability. 
 3310: 
 3311: Our initial implementation of declare 
 3312: no 
 3313: pointers() 
 3314: from 
 3315: above also appears sufficiently useful to justify the facility. We 
 3316: expect it to be tolerant of aggressive use of the facility, and to 
 3317: perform quite reasonably, although it will not take advantage of 
 3318: all such calls. We expect that in many aggressive use scenarios it 
 3319: will not inhibit scalability to a reasonable number of processors, 
 3320: since many scenarios involving very large number of calls to these 
 3321: functions can be handled locally to the thread. 
 3322: 
 3323: If declare 
 3324: no 
 3325: pointers() 
 3326: becomes heavily used, it is quite 
 3327: likely that further improvements will be necessary. Clear areas 
 3328: in which one might wish for improvement are reducing the use 
 3329: of the main GC lock when requests cannot be handled locally 
 3330: to the thread, and finding a way to better accommodate small 
 3331: declare 
 3332: no 
 3333: pointers() 
 3334: requests on heap objects, possibly by 
 3335: using compiler analysis or profile feedback to reserve space for 
 3336: layout information in certain heap objects. 
 3337: 
 3338: We measured performance on some microbenchmarks to confirm 
 3339: the above observations. The benchmarks were run on a 16 
 3340: core (4 sockets times 4 cores/socket) server blade using Intel Xeon 
 3341: E7330 processors running at 2.4 GHz. We measured overall completion 
 3342: time of a simple test running various numbers of threads 
 3343: each performing a total of 10 million declare 
 3344: / undeclare 
 3345: operation 
 3346: pairs each. Results are reported as nanoseconds per pair of 
 3347: declare 
 3348: / undeclare 
 3349: operations. Each value represents the average 
 3350: of three runs. 
 3351: 
 3352: The results for higher thread counts on the declare 
 3353: reachable 
 3354: tests were observed to vary by as much as about 30% from the average. 
 3355: We conjecture that this is attributable to some combination 
 3356: of differences in hash bucket occupancies, their impact on hash 
 3357: table growth, different maximum hash table occupancies due to 
 3358: phase differences between threads, and a locking scheme involving 
 3359: somewhat unpredictable back-offs. 
 3360: 
 3361: For the no 
 3362: pointers 
 3363: tests, we alternately declared N 
 3364: ranges, 
 3365: and then undeclared all of them, and then repeated the process. We 
 3366: measured with both N 
 3367: = 
 3368: 10 
 3369: and N 
 3370: = 
 3371: 100. The former can be 
 3372: handled entirely by the per thread arrays Dt. The latter requires 
 3373: mostly accesses to the global tree, and hence performs much worse. 
 3374: 
 3375: For the reachable 
 3376: tests, we measured a case in which both 
 3377: declare 
 3378: and undeclare 
 3379: calls were passed pointers to the base of 
 3380: 100 byte objects, and the case in which they were given 40 and 80 
 3381: byte offsets respectively. We expect the latter to represent a bad case 
 3382: that will rarely or never arise in practice. Somewhat surprisingly, 
 3383: its performance is not that much worse, in part because in our 
 3384: environment the hash function could safely ignore the bottom 8 
 3385: bits of addresses, so that it was still rare that more than one bucket 
 3386: needed to be considered. 
 3387: 
 3388:  0 
 3389: 500 
 3390: 1000 
 3391: 1500 
 3392: 2000 
 3393: 16 8 4 2 1no_pointers, 100 activeno_pointers, 10 activereachable 40/80 offsetsreachable no offsets
 3394: Figure 
 3395: 2. 
 3396: Performance of API implementations, nsecs/op-pair 
 3397: 
 3398: The results are given in figure 2.12 For reference, the 
 3399: declare 
 3400: reachable 
 3401: times with different offset are roughly similar 
 3402: to allocation round-trip times. The results for no 
 3403: pointers 
 3404: with 100 simultaneous live ranges are intentionally truncated; the 
 3405: value for 4 threads is almost 9 microseconds. 
 3406: 
 3407: 8. 
 3408: Current 
 3409: Status 
 3410: The current C++0x committee draft[24] is intended as a vehicle to 
 3411: both allow feedback to the committee, and to make it easier for vendors 
 3412: to implement some of the more time critical features (notably 
 3413: thread support) sooner rather than later. It was not labeled by the 
 3414: committee as ※final§, and hence was not intended to be approved in 
 3415: its present form. Our current best guess is that an official standard, 
 3416: containing this minimal form of garbage collection support, will be 
 3417: approved in late 2010 or 2011. We hope and expect that a number of 
 3418: vendors will be encouraged to provide garbage collection support, 
 3419: perhaps initially based on our prototype implementation. 
 3420: 
 3421: Acknowledgments 
 3422: 
 3423: 
 3424: This work benefited significantly from many in-person and email 
 3425: discussions in the context of the C++ ISO standards committee. 
 3426: Particularly insightful contributions, not always in support of our 
 3427: proposal, were made by Sean Parent, Herb Sutter, and Dave Abrahams. 
 3428: Clark Nelson contributed substantially to the formal proposal 
 3429: accepted into the current draft standard. The anonymous reviewers 
 3430: made many useful suggestions for improving this paper. 
 3431: 
 3432: References 
 3433: 
 3434: 
 3435: [1] J. F. Bartlett. Compacting garbage collection with ambiguous roots. 
 3436: Lisp 
 3437: Pointers, pages 3每12, April-June 1988. 
 3438: [2] D. Blake. Programming languages: Everyone has a favorite one. Dr. 
 3439: Dobb＊s 
 3440: Journal, 18(3), April 2008. 
 3441: [3] H.-J. Boehm. 
 3442: A garbage collector for C and C++. http: 
 3443: //www.hpl.hp.com/personal/Hans_Boehm/gc/. 
 3444: [4] H.-J. Boehm. Space efficient conservative garbage collection. In 
 3445: SIGPLAN 
 3446: ＊93 
 3447: Conference 
 3448: on 
 3449: Programming 
 3450: Language 
 3451: Design 
 3452: and 
 3453: 
 3454: 
 3455: Implementation, pages 197每206, June 1993. 
 3456: 
 3457: [5] H.-J. Boehm. 
 3458: Simple garbage-collector-safety. In SIGPLAN 
 3459: ＊96 
 3460: Conference 
 3461: on 
 3462: Programming 
 3463: Language 
 3464: Design 
 3465: and 
 3466: Implementation, 
 3467: pages 89每98, June 1996. 
 3468: [6] H.-J. Boehm. Fast multiprocessor memory allocation and garbage 
 3469: collection. Technical Report HPL-2000-165, HP Laboratories, 
 3470: December 2000. 
 3471: 12 Due to a a temporary implementation restriction, these numbers assume 
 3472: only one collecting thread. This should have minimal impact. 
 3473: 
 3474: 37
 3475:  
 3476: [7] H.-J. Boehm. Reducing garbage collector cache misses. In 
 3477: Proceedings 
 3478: of 
 3479: the 
 3480: 2000 
 3481: International 
 3482: Symposium 
 3483: on 
 3484: Memory 
 3485: Management, pages 59每64, 2000. 
 3486: 
 3487: [8] H.-J. Boehm. 
 3488: Bounding space usage of conservative garbage 
 3489: collectors. In Proceeedings 
 3490: of 
 3491: the 
 3492: Twenty-Ninth 
 3493: Annual 
 3494: ACM 
 3495: Symposium 
 3496: on 
 3497: Principles 
 3498: of 
 3499: Programming 
 3500: Languages, pages 93每 
 3501: 100, 2002. 
 3502: [9] H.-J. Boehm. Destructors, finalizers, and synchronization. In 
 3503: Proceeedings 
 3504: of 
 3505: the 
 3506: 30th 
 3507: Annual 
 3508: ACM 
 3509: Symposium 
 3510: on 
 3511: Principles 
 3512: of 
 3513: Programming 
 3514: Languages, pages 262每272, 2003. 
 3515: 
 3516: [10] H.-J. Boehm. The space cost of lazy reference counting. In 
 3517: Proceeedings 
 3518: of 
 3519: the 
 3520: 31st 
 3521: Annual 
 3522: ACM 
 3523: Symposium 
 3524: on 
 3525: Principles 
 3526: of 
 3527: Programming 
 3528: Languages, pages 210每219, 2004. 
 3529: 
 3530: [11] H.-J. Boehm, A. J. Demers, and S. Shenker. Mostly parallel garbage 
 3531: collection. In SIGPLAN 
 3532: ＊91 
 3533: Conference 
 3534: on 
 3535: Programming 
 3536: Language 
 3537: Design 
 3538: and 
 3539: Implementation, pages 157每164, June 1991. 
 3540: [12] H.-J. Boehm and M. Spertus. 
 3541: N2261: Optimization-robust finalization. 
 3542: http://www.open-std.org/jtc1/sc22/wg21/docs/ 
 3543: papers/2007/n2261.html. 
 3544: [13] H.-J. Boehm and M. Spertus. 
 3545: N2310: Transparent programmer-
 3546: directed garbage collection for c++. http://www.open-std.org/ 
 3547: jtc1/sc22/wg21/docs/papers/2007/n2310.pdf. 
 3548: [14] H.-J. Boehm, M. Spertus, and C. Nelson. N2670: Minimal support 
 3549: for garbage collection and reachability-based leak detection (revised). 
 3550: http://www.open-std.org/jtc1/sc22/wg21/docs/papers/ 
 3551: 2008/n2670.htm. 
 3552: 
 3553: [15] H.-J. Boehm and M. Weiser. Garbage collection in an uncooperative 
 3554: environment. Software 
 3555: Practice 
 3556: and 
 3557: Experience, 18:807每820, 
 3558: September 1988. 
 3559: [16] W. Bright. Digital mars. http://www.digitalmars.com/. 
 3560: [17] B. Cantrill and J. Bonwick. Real-world concurrency. 
 3561: ACM 
 3562: Queue, 
 3563: 6(5):16每25, September 2008. 
 3564: [18] G. Colvin, B. Dawes, P. Dimov, and D. Adler. 
 3565: Boost smart pointer 
 3566: library. http://www.boost.org/libs/smart ptr/. 
 3567: [19] D. Detlefs, A. Dosser, and B. Zorn. Memory allocation costs in large 
 3568: C and C++ programs. Software 
 3569: Practice 
 3570: and 
 3571: Experience, 24(6):527每 
 3572: 547, 1994. 
 3573: [20] J. R. Ellis and D. L. Detlefs. Safe, efficient garbage collection for 
 3574: C++. Technical Report CSL-93-4, Xerox Palo Alto Research Center, 
 3575: September 1993. 
 3576: [21] R. Hastings and B. Joyce. Purify: Fast detection of memory leaks and 
 3577: access errors. In Winter 
 3578: Usenix 
 3579: Conference, pages 125每136, 1992. 
 3580: [22] H. Hinnant. N2771: Lwg issues. 
 3581: http://www.open-std.org/ 
 3582: jtc1/sc22/wg21/docs/papers/2008/n2771.html. 
 3583: [23] M. Hirzel and A. Diwan. 
 3584: On the type accuracy of garbage 
 3585: collection. In Proceedings 
 3586: of 
 3587: the 
 3588: International 
 3589: Symposium 
 3590: on 
 3591: Memory 
 3592: Management 
 3593: 2000, pages 1每11, October 2000. 
 3594: [24] ISO/IEC JTC1/SC22/WG21. ISO/IEC 14882, Programming Language 
 3595: -C++ (Oct 2008 committee draft). http://www.open-std. 
 3596: org/jtc1/sc22/wg21/docs/papers/2008/n2800.pdf. 
 3597: [25] M. Kapur. 
 3598: Using the c/c++ garbage collection library, libgc. http: 
 3599: //developers.sun.com/solaris/articles/libgc.html. 
 3600: [26] P. E. McKenney. 
 3601: Exploiting 
 3602: Deferred 
 3603: Destruction: 
 3604: An 
 3605: Analysis 
 3606: of 
 3607: Read-Copy-Update 
 3608: Techniques 
 3609: in 
 3610: Operating 
 3611: Systems 
 3612: Kernels. PhD 
 3613: thesis, OGI School of Science and Engineering at Oregon Health & 
 3614: Science University, 2004. 
 3615: [27] G. Rodriguez-Rivera, M. Spertus, and C. Fiterman. 
 3616: Conservative 
 3617: garbage collection for general memory allocators. In Proceedings 
 3618: of 
 3619: the 
 3620: International 
 3621: Symposium 
 3622: on 
 3623: Memory 
 3624: Management 
 3625: 2000, pages 
 3626: 71每79, October 2000. 
 3627: [28] P. Rovner. 
 3628: On adding garbage collection and runtime types to a 
 3629: strongly-typed, statically-checked, concurrent language. Technical 
 3630: Report CSL-84-7, Xerox Palo Alto Research Center, July 1985. 
 3631: [29] M. Serrano and H.-J. Boehm. 
 3632: Understanding memory allocation 
 3633: of Scheme programs. In Proceedings 
 3634: of 
 3635: the 
 3636: 2000 
 3637: International 
 3638: Conference 
 3639: on 
 3640: Functional 
 3641: Programming 
 3642: (ICFP), pages 245每256, 
 3643: 2000. 
 3644: [30] D. Vandevoorde. 
 3645: N2073: Modules in c++ (revision 4). http: 
 3646: //www.open-std.org/jtc1/sc22/wg21/docs/papers/2006/ 
 3647: n2073.pdf. 
 3648: 38
 3649: ISO/IEC JTC 1/SC 22 N 4411 2008-10-09 
 3650: ISO/IEC JTC 1/SC 22 
 3651: Programming Languages 
 3652: Document Type: Text for CD Ballot 
 3653: Document Title: ISO/IEC 14882, Programming language 每 C++ 
 3654: Document Source: WG 21 Convener (P.J. Plauger) 
 3655: Document Status: This document is circulated to National Bodies for ballot. Please submit 
 3656: your vote via the online balloting system by the due date indicated. 
 3657: Action ID: 
 3658: Due Date: 2009-01-10 
 3659: No. of Pages: 1314 
 3660: Secretariat, ISO/IEC JTC 1, American National Standards Institute, 25 West 43rd Street, New York, NY 10036; Telephone: 1 212 642 4932; 
 3661: Facsimile: 1 212 840 2298; Email: lrajchel@ansi.org 
 3662: 
 3663: ISO 2008 〞 All rights reserved 
 3664: ISO/IEC JTC 1/SC22/WG21 N 2800 
 3665: Date: 2008-10-08 
 3666: ISO/IEC IS 14882 
 3667: ISO/IEC JTC 1/SC22 
 3668: Secretariat: ANSI 
 3669: Programming Languages 〞 C++ 
 3670: Langages de programmation 〞 C++ 
 3671: Warning 
 3672: This document is not an ISO International Standard. It is distributed for review and comment. It is subject 
 3673: to change without notice and may not be referred to as an International Standard. 
 3674: Recipients of this draft are invited to submit, with their comments, notification of any relevant patent rights 
 3675: of which they are aware and to provide supporting documentation. 
 3676: Document type: Draft International Standard 
 3677: Document stage: (30) Committee 
 3678: Document Language: E 
 3679: 
 3680: Copyright notice 
 3681: This ISO document is a working draft or committee draft and is copyright-protected by ISO. While the 
 3682: reproduction of working drafts or committee drafts in any form for use by participants in the ISO standards 
 3683: development process is permitted without prior permission from ISO, neither this document nor any extract 
 3684: from it may be reproduced, stored or transmitted in any form for any other purpose without prior written 
 3685: permission from ISO. 
 3686: Requests for permission to reproduce this document for the purpose of selling it should be addressed as 
 3687: shown below or to ISO＊s member body in the country of the requestor. 
 3688: ISO copyright office
 3689: Case postale 56, CH-1211 Geneva 20
 3690: Tel. + 41 22 749 01 11
 3691: Fax + 41 22 749 09 47
 3692: E-mail copyright@iso.org
 3693: Web www.iso.org
 3694: Reproduction for sales purposes may be subject to royalty payments or a licensing agreement. 
 3695: Violators may be prosecuted. 
 3696: 
 3697: . ISO/IEC N2800=08-0310 
 3698: Contents 
 3699: Contents iii
 3700: List of Tables x
 3701: 1 General 1
 3702: 1.1 Scope ................................................. 1
 3703: 1.2 Normativereferences......................................... 1
 3704: 1.3 Definitions............................................... 2
 3705: 1.4 Implementationcompliance ..................................... 4
 3706: 1.5 StructureofthisInternationalStandard .............................. 5
 3707: 1.6 Syntaxnotation............................................ 5
 3708: 1.7 TheC++ memorymodel....................................... 6
 3709: 1.8 TheC++ objectmodel........................................ 6
 3710: 1.9 Programexecution .......................................... 7
 3711: 1.10Multi-threadedexecutionsanddataraces ............................. 10
 3712: 1.11Acknowledgments........................................... 13
 3713: 2 Lexical conventions 15
 3714: 2.1 Phasesoftranslation......................................... 15
 3715: 2.2 Charactersets............................................. 16
 3716: 2.3 Trigraphsequences.......................................... 17
 3717: 2.4 Preprocessingtokens......................................... 18
 3718: 2.5 Alternativetokens .......................................... 18
 3719: 2.6 Tokens................................................. 19
 3720: 2.7 Comments............................................... 19
 3721: 2.8 Headernames............................................. 19
 3722: 2.9 Preprocessingnumbers........................................ 20
 3723: 2.10Identifiers ............................................... 20
 3724: 2.11Keywords ............................................... 21
 3725: 2.12Operatorsandpunctuators ..................................... 21
 3726: 2.13Literals ................................................ 22
 3727: 3 Basic concepts 31
 3728: 3.1 Declarationsanddefinitions..................................... 31
 3729: 3.2 Onedefinitionrule .......................................... 33
 3730: 3.3 Declarativeregionsandscopes ................................... 35
 3731: 3.4 Namelookup ............................................. 41
 3732: 3.5 Programandlinkage......................................... 56
 3733: 3.6 Startandtermination ........................................ 59
 3734: 3.7 Storageduration ........................................... 63
 3735: 3.8 Objectlifetime ............................................ 67
 3736: 3.9 Types ................................................. 70
 3737: 3.10Lvaluesandrvalues.......................................... 75
 3738: 3.11Alignment............................................... 77
 3739: 4 Standard conversions 79
 3740: CONTENTS iii 
 3741: 
 3742: c
 3743: . ISO/IEC N2800=08-0310 
 3744: 4.1 Lvalue-to-rvalueconversion ..................................... 80
 3745: 4.2 Array-to-pointerconversion ..................................... 80
 3746: 4.3 Function-to-pointerconversion ................................... 80
 3747: 4.4 Qualificationconversions....................................... 80
 3748: 4.5 Integralpromotions.......................................... 81
 3749: 4.6 Floatingpointpromotion ...................................... 82
 3750: 4.7 Integralconversions ......................................... 82
 3751: 4.8 Floatingpointconversions...................................... 82
 3752: 4.9 Floating-integralconversions .................................... 83
 3753: 4.10Pointerconversions.......................................... 83
 3754: 4.11Pointertomemberconversions ................................... 83
 3755: 4.12Booleanconversions ......................................... 84
 3756: 4.13Integerconversionrank ....................................... 84
 3757: 5 Expressions 85
 3758: 5.1 Primaryexpressions ......................................... 86
 3759: 5.2 Postfixexpressions .......................................... 91
 3760: 5.3 Unaryexpressions ..........................................102
 3761: 5.4 Explicittypeconversion(castnotation) ..............................109
 3762: 5.5 Pointer-to-memberoperators ....................................111
 3763: 5.6 Multiplicativeoperators .......................................111
 3764: 5.7 Additiveoperators ..........................................112
 3765: 5.8 Shiftoperators ............................................113
 3766: 5.9 Relationaloperators .........................................114
 3767: 5.10Equalityoperators ..........................................115
 3768: 5.11BitwiseANDoperator ........................................116
 3769: 5.12BitwiseexclusiveORoperator....................................116
 3770: 5.13BitwiseinclusiveORoperator....................................116
 3771: 5.14LogicalANDoperator ........................................116
 3772: 5.15LogicalORoperator .........................................116
 3773: 5.16Conditionaloperator.........................................117
 3774: 5.17Assignmentandcompoundassignmentoperators .........................118
 3775: 5.18Commaoperator ...........................................119
 3776: 5.19Constantexpressions.........................................119
 3777: 6 Statements 122
 3778: 6.1 Labeledstatement ..........................................122
 3779: 6.2 Expressionstatement.........................................122
 3780: 6.3 Compoundstatementorblock ...................................122
 3781: 6.4 Selectionstatements .........................................123
 3782: 6.5 Iterationstatements .........................................124
 3783: 6.6 Jumpstatements ...........................................127
 3784: 6.7 Declarationstatement ........................................129
 3785: 6.8 Ambiguityresolution.........................................130
 3786: 6.9 Late-checkedblock ..........................................131
 3787: 7 Declarations 133
 3788: 7.1 Specifiers ...............................................134
 3789: 7.2 Enumerationdeclarations ......................................148
 3790: 7.3 Namespaces..............................................151
 3791: 7.4 Theasm declaration .........................................165
 3792: CONTENTS iv 
 3793: 
 3794: c. ISO/IEC N2800=08-0310 
 3795: 7.5 Linkagespecifications ........................................165
 3796: 7.6 Attributes...............................................168
 3797: 8 Declarators 173
 3798: 8.1 Typenames..............................................174
 3799: 8.2 Ambiguityresolution.........................................175
 3800: 8.3 Meaningofdeclarators........................................176
 3801: 8.4 Functiondefinitions .........................................189
 3802: 8.5 Initializers...............................................191
 3803: 9 Classes 205
 3804: 9.1 Classnames..............................................207
 3805: 9.2 Classmembers ............................................209
 3806: 9.3 Memberfunctions ..........................................211
 3807: 9.4 Staticmembers............................................214
 3808: 9.5 Unions.................................................216
 3809: 9.6 Bit-fields................................................217
 3810: 9.7 Nestedclassdeclarations.......................................218
 3811: 9.8 Localclassdeclarations .......................................219
 3812: 9.9 Nestedtypenames..........................................220
 3813: 10 Derived classes 221
 3814: 10.1Multiplebaseclasses.........................................222
 3815: 10.2Membernamelookup ........................................224
 3816: 10.3Virtualfunctions ...........................................227
 3817: 10.4Abstractclasses............................................231
 3818: 11 Member access control 233
 3819: 11.1Accessspecifiers ...........................................235
 3820: 11.2Accessibilityofbaseclassesandbaseclassmembers .......................236
 3821: 11.3Accessdeclarations..........................................238
 3822: 11.4Friends.................................................239
 3823: 11.5Protectedmemberaccess ......................................242
 3824: 11.6Accesstovirtualfunctions......................................243
 3825: 11.7Multipleaccess ............................................244
 3826: 11.8Nestedclasses.............................................244
 3827: 12 Special member functions 245
 3828: 12.1Constructors .............................................245
 3829: 12.2Temporaryobjects ..........................................247
 3830: 12.3Conversions..............................................249
 3831: 12.4Destructors ..............................................252
 3832: 12.5Freestore ...............................................255
 3833: 12.6Initialization .............................................257
 3834: 12.7Constructionanddestruction ....................................262
 3835: 12.8Copyingclassobjects.........................................265
 3836: 12.9InheritingConstructors .......................................271
 3837: 13 Overloading 275
 3838: 13.1Overloadabledeclarations ......................................275
 3839: 13.2Declarationmatching.........................................278
 3840: CONTENTS v 
 3841: 
 3842: c. ISO/IEC N2800=08-0310 
 3843: 13.3Overloadresolution..........................................279
 3844: 13.4Addressofoverloadedfunction ...................................297
 3845: 13.5Overloadedoperators.........................................298
 3846: 13.6Built-inoperators...........................................303
 3847: 14 Templates 307
 3848: 14.1Templateparameters.........................................308
 3849: 14.2Namesoftemplatespecializations..................................312
 3850: 14.3Templatearguments .........................................314
 3851: 14.4Typeequivalence...........................................320
 3852: 14.5Templatedeclarations ........................................321
 3853: 14.6Nameresolution ...........................................341
 3854: 14.7Templateinstantiationandspecialization .............................354
 3855: 14.8Functiontemplatespecializations..................................367
 3856: 14.9Concepts ...............................................386
 3857: 14.10Constrainedtemplates........................................408
 3858: 15 Exception handling 427
 3859: 15.1Throwinganexception........................................428
 3860: 15.2Constructorsanddestructors ....................................430
 3861: 15.3Handlinganexception ........................................430
 3862: 15.4Exceptionspecifications .......................................432
 3863: 15.5Specialfunctions ...........................................435
 3864: 15.6Exceptionsandaccess ........................................436
 3865: 16 Preprocessing directives 437
 3866: 16.1Conditionalinclusion.........................................439
 3867: 16.2Sourcefileinclusion .........................................440
 3868: 16.3Macroreplacement..........................................441
 3869: 16.4Linecontrol..............................................446
 3870: 16.5Errordirective ............................................447
 3871: 16.6Pragmadirective ...........................................447
 3872: 16.7Nulldirective .............................................447
 3873: 16.8Predefinedmacronames.......................................447
 3874: 16.9Pragmaoperator ...........................................448
 3875: 17 Library introduction 450
 3876: 17.1General ................................................450
 3877: 17.2Overview ...............................................450
 3878: 17.3Definitions...............................................450
 3879: 17.4Additionaldefinitions ........................................454
 3880: 17.5Methodofdescription(Informative) ................................454
 3881: 17.6Library-widerequirements......................................460
 3882: 18 Language support library 471
 3883: 18.1Types .................................................471
 3884: 18.2Implementationproperties......................................472
 3885: 18.3Integertypes .............................................481
 3886: 18.4Startandtermination ........................................482
 3887: 18.5Dynamicmemorymanagement ...................................484
 3888: 18.6Typeidentification ..........................................488
 3889: CONTENTS vi 
 3890: 
 3891: c. ISO/IEC N2800=08-0310 
 3892: 18.7Exceptionhandling..........................................492
 3893: 18.8Initializerlists.............................................497
 3894: 18.9Otherruntimesupport........................................499
 3895: 19 Diagnostics library 501
 3896: 19.1Exceptionclasses...........................................501
 3897: 19.2Assertions...............................................505
 3898: 19.3Errornumbers ............................................506
 3899: 19.4Systemerrorsupport.........................................506
 3900: 20 General utilities library 518
 3901: 20.1Concepts ...............................................518
 3902: 20.2Utilitycomponents..........................................532
 3903: 20.3Compile-timerationalarithmetic ..................................545
 3904: 20.4Tuples.................................................548
 3905: 20.5Metaprogrammingandtypetraits .................................556
 3906: 20.6Functionobjects ...........................................568
 3907: 20.7Memory................................................592
 3908: 20.8Timeutilities .............................................636
 3909: 20.9Dateandtimefunctions.......................................649
 3910: 21 Strings library 650
 3911: 21.1Charactertraits............................................650
 3912: .............................................656
 3913: 21.2Stringclasses 
 3914: 21.3Classtemplatebasic_string ....................................659
 3915: 21.4NumericConversions.........................................685
 3916: 21.5Null-terminatedsequenceutilities..................................687
 3917: 22 Localization library 691
 3918: 22.1Locales ................................................691
 3919: 22.2Standardlocale categories .....................................704
 3920: 22.3Standardcodeconversionfacets...................................744
 3921: 22.4CLibraryLocales ..........................................746
 3922: 23 Containers library 747
 3923: 23.1Containerrequirements .......................................747
 3924: 23.2Sequencecontainers .........................................777
 3925: 23.3Associativecontainers ........................................819
 3926: 23.4Unorderedassociativecontainers ..................................839
 3927: 24 Iterators library 858
 3928: 24.1Iteratorconcepts ...........................................858
 3929: 24.2Header<iterator> synopsis ....................................865
 3930: 24.3Iteratoroperations ..........................................869
 3931: 24.4Predefinediterators..........................................869
 3932: 24.5Streamiterators ...........................................886
 3933: 25 Algorithms library 894
 3934: 25.1Non-modifyingsequenceoperations.................................907
 3935: 25.2Mutatingsequenceoperations....................................911
 3936: 25.3Sortingandrelatedoperations ...................................920
 3937: 25.4Clibraryalgorithms .........................................935
 3938: CONTENTS vii 
 3939: 
 3940: c. ISO/IEC N2800=08-0310 
 3941: 26 Numerics library 937
 3942: 26.1Numerictyperequirements .....................................937
 3943: 26.2Thefloating-pointenvironment ...................................938
 3944: 26.3Complexnumbers ..........................................939
 3945: 26.4Randomnumbergeneration.....................................948
 3946: 26.5Numericarrays ............................................990
 3947: 26.6Generalizednumericoperations...................................1010
 3948: 26.7CLibrary ...............................................1014
 3949: 27 Input/output library 1020
 3950: 27.1Iostreamsrequirements........................................1020
 3951: 27.2Forwarddeclarations.........................................1021
 3952: 27.3Standardiostreamobjects......................................1023
 3953: 27.4Iostreamsbaseclasses ........................................1025
 3954: 27.5Streambuffers ............................................1042
 3955: 27.6Formattingandmanipulators ....................................1053
 3956: 27.7String-basedstreams.........................................1080
 3957: 27.8File-basedstreams ..........................................1092
 3958: 28 Regular expressions library 1108
 3959: 28.1Definitions...............................................1108
 3960: 28.2Requirements.............................................1108
 3961: 28.3Regularexpressionssummary....................................1110
 3962: 28.4Header<regex> synopsis ......................................1111
 3963: 28.5Namespacestd::regex_constants ................................1117
 3964: 28.6Classregex_error ..........................................1120
 3965: 28.7Classtemplateregex_traits ....................................1120
 3966: 28.8Classtemplatebasic_regex ....................................1123
 3967: 28.9Classtemplatesub_match ......................................1128
 3968: 28.10Classtemplatematch_results ...................................1133
 3969: 28.11Regularexpressionalgorithms....................................1137
 3970: 28.12RegularexpressionIterators.....................................1142
 3971: 28.13ModifiedECMAScriptregularexpressiongrammar........................1147
 3972: 29 Atomic operations library 1150
 3973: 29.1OrderandConsistency........................................1152
 3974: 29.2Lock-freeProperty ..........................................1154
 3975: 29.3AtomicTypes.............................................1154
 3976: 29.4OperationsonAtomicTypes ....................................1160
 3977: 29.5FlagTypeandOperations......................................1163
 3978: 29.6Fences.................................................1164
 3979: 30 Thread support library 1166
 3980: 30.1Requirements.............................................1166
 3981: 30.2Threads ................................................1167
 3982: 30.3Mutualexclusion...........................................1172
 3983: 30.4Conditionvariables..........................................1186
 3984: 30.5Futures ................................................1192
 3985: A Grammar summary 1202
 3986: A.1 Keywords ...............................................1202
 3987: CONTENTS viii 
 3988: 
 3989: c
 3990: . ISO/IEC N2800=08-0310 
 3991: A.2 Lexicalconventions..........................................1202
 3992: A.3 Basicconcepts ............................................1207
 3993: A.4 Expressions ..............................................1207
 3994: A.5 Statements ..............................................1211
 3995: A.6 Declarations..............................................1212
 3996: A.7 Declarators ..............................................1215
 3997: A.8 Classes.................................................1217
 3998: A.9 Derivedclasses ............................................1217
 3999: A.10Specialmemberfunctions ......................................1218
 4000: A.11Overloading..............................................1218
 4001: A.12Templates...............................................1218
 4002: A.13Exceptionhandling..........................................1221
 4003: A.14Preprocessingdirectives .......................................1221
 4004: B Implementation quantities 1223
 4005: C Compatibility 1225
 4006: C.1 C++ andISOC............................................1225
 4007: C.2 StandardClibrary..........................................1234
 4008: D Compatibility features 1239
 4009: D.1 Incrementoperatorwithbool operand...............................1239
 4010: D.2 statickeyword ............................................1239
 4011: D.3 Accessdeclarations..........................................1239
 4012: D.4 Implicitconversionfromconststrings ...............................1239
 4013: D.5 Cstandardlibraryheaders .....................................1239
 4014: D.6 Oldiostreamsmembers .......................................1240
 4015: D.7 char* streams.............................................1241
 4016: D.8 Binders ................................................1250
 4017: D.9 auto_ptr ...............................................1252
 4018: D.10Iteratorprimitives ..........................................1254
 4019: Index 1259
 4020: CONTENTS 
 4021: 
 4022: c. ISO/IEC N2800=08-0310 
 4023: List of Tables 
 4024: 1 Trigraphsequences............................................ 17
 4025: 2 Alternativetokens ............................................ 19
 4026: 3 Keywords ................................................. 21
 4027: 4 Alternativerepresentations ....................................... 21
 4028: 5 Typesofintegerconstants........................................ 23
 4029: 6 Escapesequences............................................. 25
 4030: 7 Stringliteralconcatenations....................................... 27
 4031: 8 Relationsonconst andvolatile ................................... 75
 4032: 9 simple-type-specifiersandthetypestheyspecify ...........................145
 4033: 10 Relationshipbetweenoperatorandfunctioncallnotation ......................283
 4034: 11 Conversions................................................291
 4035: 12 Librarycategories ............................................451
 4036: 13 C++ libraryheaders ...........................................461
 4037: 14 C++ headersforClibraryfacilities...................................461
 4038: 15 C++ headersforfreestandingimplementations ............................462
 4039: 16 Languagesupportlibrarysummary...................................471
 4040: 17 Header<cstddef> synopsis .......................................471
 4041: 18 Header<climits> synopsis .......................................481
 4042: 19 Header<cfloat> synopsis........................................481
 4043: 20 Header<cstdlib> synopsis .......................................482
 4044: 21 Header<cstdarg> synopsis .......................................499
 4045: 22 Header<csetjmp> synopsis .......................................499
 4046: 23 Header<ctime> synopsis ........................................499
 4047: 24 Header<csignal> synopsis .......................................499
 4048: 25 Header<cstdlib> synopsis .......................................500
 4049: 26 Header<cstdbool> synopsis ......................................500
 4050: 27 Diagnosticslibrarysummary ......................................501
 4051: 28 Header<cassert> synopsis .......................................505
 4052: 29 Header<cerrno> synopsis........................................506
 4053: 30 Generalutilitieslibrarysummary....................................518
 4054: 31 Primarytypecategorypredicates....................................559
 4055: 32 Compositetypecategorypredicates ..................................560
 4056: 33 Typepropertypredicates ........................................560
 4057: 34 Typepropertyqueries ..........................................563
 4058: 35 Typerelationshippredicates.......................................563
 4059: 36 Const-volatilemodifications.......................................565
 4060: 37 Referencemodifications .........................................565
 4061: 38 Signmodifications ............................................566
 4062: 39 Arraymodifications ...........................................566
 4063: ListofTables ListofTables x
 4064: 
 4065: c. ISO/IEC N2800=08-0310 
 4066: 40 Pointermodifications...........................................567
 4067: 41 Othertransformations ..........................................567
 4068: 42 ConstructibleWithAllocator conceptmapconstraintpatterns ..................600
 4069: 43 Header<cstdlib> synopsis .......................................635
 4070: 44 Header<cstring> synopsis .......................................636
 4071: 45 Clockrequirements............................................638
 4072: 46 Header<ctime> synopsis ........................................649
 4073: 47 Stringslibrarysummary.........................................650
 4074: 48 Charactertraitsrequirements......................................651
 4075: 49 basic_string(const Allocator&) effects ..............................664
 4076: 50 basic_string(const basic_string&) effects ............................665
 4077: 51 basic_string(const basic_string&, size_type, size_type, const Allocator&) effects .665
 4078: 52 basic_string(const charT*, size_type, const Allocator&) effects..............665
 4079: 53 basic_string(const charT*, const Allocator&) effects.....................666
 4080: 54 basic_string(size_t, charT, const Allocator&) effects ....................666
 4081: 55 basic_string(const basic_string&, const Allocator&) andbasic_string(basic_string&&,
 4082: const Allocator&) effects .......................................666
 4083: 56 operator=(const basic_string<charT, traits, Allocator>&) effects.............667
 4084: 57 operator=(const basic_string<charT, traits, Allocator>&&) effects ............667
 4085: 58 compare() results ............................................679
 4086: 59 Header<cctype> synopsis........................................688
 4087: 60 Header<cwctype> synopsis .......................................689
 4088: 61 Header<cstring> synopsis .......................................689
 4089: 62 Header<cwchar> synopsis........................................689
 4090: 63 Header<cstdlib> synopsis .......................................689
 4091: 64 Header<cuchar> synopsis........................................690
 4092: 65 Localizationlibrarysummary......................................691
 4093: 66 Localecategoryfacets ..........................................695
 4094: 67 Requiredspecializations .........................................695
 4095: 68 do_in/do_out resultvalues .......................................714
 4096: 69 do_unshift resultvalues ........................................714
 4097: 70 Integerconversions............................................718
 4098: 71 Lengthmodifier..............................................718
 4099: 72 Integerconversions............................................722
 4100: 73 Floating-pointconversions........................................722
 4101: 74 Lengthmodifier..............................................723
 4102: 75 Numericconversions ...........................................723
 4103: 76 Fillpadding................................................724
 4104: 77 do_get_date effects ...........................................731
 4105: 78 Header<clocale> synopsis .......................................746
 4106: 79 Containerslibrarysummary.......................................747
 4107: 80 Containerrequirements .........................................748
 4108: 81 Reversiblecontainerrequirements....................................750
 4109: 82 Allocator-awarecontainerrequirements ................................751
 4110: 83 Sequencecontainerrequirements(inadditiontocontainer) .....................753
 4111: 84 Optionalsequencecontaineroperations ................................754
 4112: 85 Associativecontainerrequirements(inadditiontocontainer) ....................756
 4113: 86 Containerrequirementsthatarenotrequiredforunorderedassociativecontainers.........761
 4114: ListofTables ListofTables xi
 4115: 
 4116: c. ISO/IEC N2800=08-0310 
 4117: 87 Unorderedassociativecontainerrequirements(inadditiontocontainer) ..............762
 4118: 88 Iteratorslibrarysummary........................................858
 4119: 89 Relationsamongiteratorcategories...................................859
 4120: 90 Algorithmslibrarysummary ......................................894
 4121: 91 Header<cstdlib> synopsis .......................................935
 4122: 92 Numericslibrarysummary .......................................937
 4123: 93 Uniformrandomnumbergeneratorrequirements ...........................950
 4124: 94 Randomnumberenginerequirements .................................951
 4125: 95 Randomnumberengineadaptorrequirements.............................953
 4126: 96 Randomnumberdistributionrequirements ..............................954
 4127: 97 Header<cmath> synopsis ........................................1015
 4128: 98 Header<cstdlib> synopsis .......................................1015
 4129: 99 Input/outputlibrarysummary .....................................1020
 4130: 100 fmtflags effects .............................................1029
 4131: 101 fmtflags constants ...........................................1029
 4132: 102 iostate effects..............................................1030
 4133: 103 openmode effects .............................................1030
 4134: 104 seekdir effects..............................................1030
 4135: 105 Positiontyperequirements .......................................1035
 4136: 106 basic_ios::init() effects .......................................1037
 4137: 107 seekoff positioning ...........................................1085
 4138: 108 newoff values...............................................1086
 4139: 109 Fileopenmodes .............................................1096
 4140: 110 seekoff effects..............................................1099
 4141: 111 Header<cstdio> synopsis........................................1107
 4142: 112 Header<cinttypes> synopsis......................................1107
 4143: 113 Regularexpressiontraitsclassrequirements..............................1109
 4144: 114 syntax_option_type effects ......................................1118
 4145: 115 regex_constants::match_flag_type effectswhenobtainingamatchagainstacharactercon
 4146: tainersequence[
 4147: first,last). .....................................1118
 4148: 116 error_type valuesintheClocale ...................................1120
 4149: 117 match_results assignmentoperatoreffects ..............................1135
 4150: 118 Effectsofregex_match algorithm ...................................1138
 4151: 119 Effectsofregex_search algorithm...................................1140
 4152: 120 Atomicslibrarysummary ........................................1150
 4153: 121 Atomicsforbuilt-intypes ........................................1157
 4154: 122 Atomicsforstandardtypedeftypes...................................1158
 4155: 123 Atomicarithmeticcomputations ....................................1162
 4156: 124 Threadsupportlibrarysummary....................................1166
 4157: 125 Standardmacros .............................................1235
 4158: 126 Standardvalues..............................................1235
 4159: 127 Standardtypes ..............................................1235
 4160: 128 Standardstructs .............................................1235
 4161: 129 Standardfunctions............................................1236
 4162: ListofTables ListofTables xii
 4163: 
 4164: . ISO/IEC N2800=08-0310 
 4165: 130 Cheaders .................................................1239
 4166: 131 strstreambuf(streamsize) effects ..................................1243
 4167: 132 strstreambuf(void* (*)(size_t), void (*)(void*)) effects ..................1243
 4168: 133 strstreambuf(charT*, streamsize, charT*) effects........................1243
 4169: 134 seekoff positioning ...........................................1246
 4170: 135 newoff values...............................................1246
 4171: ListofTables ListofTables 
 4172: 
 4173: c
 4174: . ISO/IEC N2800=08-0310 
 4175: 1 General [intro]
 4176: 1.1 Scope [intro.scope] 
 4177: 1 This International Standard specifies requirements for implementations of the C++ programming language. 
 4178: The first such requirement is that they implement the language, and so this International Standard also 
 4179: defines C++. Other requirements and relaxations of the first requirement appear at various places within 
 4180: this International Standard. 
 4181: 2 C++ is a general purpose programming language based on the C programming language as described in 
 4182: ISO/IEC 9899:1990 Programming languages 〞 C (1.2). In addition to the facilities provided by C, C 
 4183: ++ provides additional data types, classes, templates, exceptions, namespaces, inline functions, operator 
 4184: overloading, function name overloading, references, free store management operators, and additional library 
 4185: facilities. 
 4186: 1.2 Normative references [intro.refs] 
 4187: 1 The following standards contain provisions which, through reference in this text, constitute provisions of 
 4188: this International Standard. At the time of publication, the editions indicated were valid. All standards 
 4189: are subject to revision, and parties to agreements based on this International Standard are encouraged to 
 4190: investigate the possibility of applying the most recent editions of the standards indicated below. Members 
 4191: of IEC and ISO maintain registers of currently valid International Standards. 
 4192: 〞 Ecma International, ECMAScript Language Specification, Standard Ecma-262, third edition, 1999. 
 4193: 〞 ISO/IEC 2382 (all parts), Information technology 〞 Vocabulary 
 4194: 〞 ISO/IEC 9899:1990, Programming languages 〞 C 
 4195: 〞 ISO/IEC 9899/Amd.1:1995, Programming languages 〞 C, AMENDMENT 1: C Integrity 
 4196: 〞 ISO/IEC 9899:1999, Programming languages 〞 C 
 4197: 〞 ISO/IEC 9899:1999/Cor.1:2001, Programming languages 〞 C 
 4198: 〞 ISO/IEC 9899:1999/Cor.2:2004, Programming languages 〞 C 
 4199: 〞 ISO/IEC 9945:2003, Information Technology 〞 Portable Operating System Interface (POSIX) 
 4200: 〞 ISO/IEC TR 10176:2003, Information technology 〞 Guidelines for the preparation of programming 
 4201: language standards 
 4202: 〞 ISO/IEC 10646-1:1993, Information technology 〞 Universal Multiple-Octet Coded Character Set (UCS) 
 4203: 〞 Part 1: Architecture and Basic Multilingual Plane 
 4204: 〞 ISO/IEC TR 19769:2004, Information technology 〞 Programming languages, their environments and 
 4205: system software interfaces 〞 Extensions for the progrmming language C to support new character data 
 4206: types 
 4207: 2 The library described in Clause 7 of ISO/IEC 9899:1990 and Clause 7 of ISO/IEC 9899/Amd.1:1995 is 
 4208: 1
 4209: hereinafter called the C standard library.
 4210: 1) With the qualifications noted in Clauses 17 through 27, and in C.2, the C standard library is a subset of the C++ standard 
 4211: library. 
 4212: ∫ 1.2 1 
 4213: 
 4214: c
 4215: . ISO/IEC N2800=08-0310 
 4216: 3 The library described in Clause 7 of ISO/IEC 9899:1999 and Clause 7 of ISO/IEC 9899:1999/Cor.1:2001 
 4217: and Clause 7 of ISO/IEC 9899:1999/Cor.2:2003 is hereinafter called the C99 standard library. 
 4218: 4 The library described in ISO/IEC TR 19769:2004 is hereinafter called the C Unicode TR. 
 4219: 5 The operating system interface described in ISO/IEC 9945:2003 is hereinafter called POSIX. 
 4220: 6 The ECMAScript Language Specification described in Standard Ecma-262 is hereinafter called ECMA-262. 
 4221: 1.3 Definitions [intro.defs] 
 4222: 1 For the purposes of this International Standard, the definitions given in ISO/IEC 2382 and the following 
 4223: definitions apply. 17.3 defines additional terms that are used only in Clauses 17 through 27 and Annex D. 
 4224: 2 Terms that are used only in a small portion of this International Standard are defined where they are used 
 4225: and italicized where they are defined. 
 4226: 1.3.1 [defns.argument] 
 4227: argument 
 4228: an expression in the comma-separated list bounded by the parentheses in a function call expression; a 
 4229: sequence of preprocessing tokens in the comma-separated list bounded by the parentheses in a function-like 
 4230: macro invocation; the operand of throw; or an expression, type-id or template-name in the comma-separated 
 4231: list bounded by the angle brackets in a template instantiation. Also known as an actual argument or actual 
 4232: parameter. 
 4233: 1.3.2 [defns.cond.supp] 
 4234: conditionally-supported 
 4235: a program construct that an implementation is not required to support. [ Note: Each implementation 
 4236: documents all conditionally-supported constructs that it does not support. 〞end note ] 
 4237: 1.3.3 [defns.diagnostic] 
 4238: diagnostic message 
 4239: a message belonging to an implementation-defined subset of the implementation＊s output messages. 
 4240: 1.3.4 [defns.dynamic.type] 
 4241: dynamic type 
 4242: the type of the most derived object (1.8) to which the lvalue denoted by an lvalue expression refers. [ Example: 
 4243: if a pointer (8.3.1) p whose static type is ※pointer to class B§ is pointing to an object of class D, derived from 
 4244: B (Clause 10), the dynamic type of the expression *p is ※D.§ References (8.3.2) are treated similarly. 〞end 
 4245: example ] The dynamic type of an rvalue expression is its static type. 
 4246: 1.3.5 
 4247: ill-formed program 
 4248: input to a C++ implementation that is not a well-formed program. 
 4249: 1.3.6 
 4250: implementation-defined behavior 
 4251: ∫ 1.3 
 4252: [defns.ill.formed] 
 4253: [defns.impl.defined] 
 4254: 
 4255: c. ISO/IEC N2800=08-0310 
 4256: behavior, for a well-formed program construct and correct data, that depends on the implementation and 
 4257: that each implementation documents. 
 4258: 1.3.7 [defns.impl.limits] 
 4259: implementation limits 
 4260: restrictions imposed upon programs by the implementation. 
 4261: 1.3.8 [defns.locale.specific] 
 4262: locale-specific behavior 
 4263: behavior that depends on local conventions of nationality, culture, and language that each implementation 
 4264: documents. 
 4265: 1.3.9 [defns.multibyte] 
 4266: multibyte character 
 4267: a sequence of one or more bytes representing a member of the extended character set of either the source or 
 4268: the execution environment. The extended character set is a superset of the basic character set (2.2). 
 4269: 1.3.10 [defns.parameter] 
 4270: parameter 
 4271: an object or reference declared as part of a function declaration or definition, or in the catch Clause of an 
 4272: exception handler, that acquires a value on entry to the function or handler; an identifier from the comma-
 4273: separated list bounded by the parentheses immediately following the macro name in a function-like macro 
 4274: definition; or a template-parameter. Parameters are also known as formal arguments or formal parameters. 
 4275: 1.3.11 [defns.signature] 
 4276: signature 
 4277: the name and the parameter-type-list (8.3.5) of a function, as well as the class, concept, concept map, or 
 4278: namespace of which it is a member. If a function or function template is a class member its signature 
 4279: additionally includes the cv-qualifiers (if any) and the ref-qualifier (if any) on the function or function 
 4280: template itself. The signature of a constrained member (9.2) includes its template requirements. The 
 4281: signature of a function template additionally includes its return type, its template parameter list, and its 
 4282: template requirements (if any). The signature of a function template specialization includes the signature 
 4283: of the template of which it is a specialization and its template arguments (whether explicitly specified or 
 4284: deduced). [ Note: Signatures are used as a basis for name mangling and linking. 〞end note ] 
 4285: 1.3.12 [defns.static.type] 
 4286: static type 
 4287: the type of an expression (3.9), which type results from analysis of the program without considering execution 
 4288: semantics. The static type of an expression depends only on the form of the program in which the expression 
 4289: appears, and does not change while the program is executing. 
 4290: 1.3.13 [defns.undefined] 
 4291: undefined behavior 
 4292: behavior, such as might arise upon use of an erroneous program construct or erroneous data, for which 
 4293: this International Standard imposes no requirements. Undefined behavior may also be expected when this 
 4294: International Standard omits the description of any explicit definition of behavior. [ Note: permissible 
 4295: undefined behavior ranges from ignoring the situation completely with unpredictable results, to behaving 
 4296: ∫ 1.3 3 
 4297: 
 4298: c
 4299: . ISO/IEC N2800=08-0310 
 4300: during translation or program execution in a documented manner characteristic of the environment (with or 
 4301: without the issuance of a diagnostic message), to terminating a translation or execution (with the issuance 
 4302: of a diagnostic message). Many erroneous program constructs do not engender undefined behavior; they are 
 4303: required to be diagnosed. 〞end note ] 
 4304: 1.3.14 [defns.unspecified] 
 4305: unspecified behavior 
 4306: behavior, for a well-formed program construct and correct data, that depends on the implementation. The 
 4307: implementation is not required to document which behavior occurs. [ Note: usually, the range of possible 
 4308: behaviors is delineated by this International Standard. 〞end note ] 
 4309: 1.3.15 [defns.well.formed] 
 4310: well-formed program 
 4311: a C++ program constructed according to the syntax rules, diagnosable semantic rules, and the One Definition 
 4312: Rule (3.2). 
 4313: 1.4 Implementation compliance [intro.compliance] 
 4314: 1 The set of diagnosable rules consists of all syntactic and semantic rules in this International Standard except 
 4315: for those rules containing an explicit notation that ※no diagnostic is required§ or which are described as 
 4316: resulting in ※undefined behavior.§ 
 4317: 2 Although this International Standard states only requirements on C++ implementations, those requirements 
 4318: are often easier to understand if they are phrased as requirements on programs, parts of programs, or 
 4319: execution of programs. Such requirements have the following meaning: 
 4320: 〞 If a program contains no violations of the rules in this International Standard, a conforming imple-
 4321: mentation shall, within its resource limits, accept and correctly execute2 that program. 
 4322: 〞 If a program contains a violation of any diagnosable rule or an occurrence of a construct described in 
 4323: this Standard as ※conditionally-supported§ when the implementation does not support that construct, 
 4324: a conforming implementation shall issue at least one diagnostic message. 
 4325: 〞 If a program contains a violation of a rule for which no diagnostic is required, this International 
 4326: Standard places no requirement on implementations with respect to that program. 
 4327: 3 For classes and class templates, the library Clauses specify partial definitions. Private members (Clause 11) 
 4328: are not specified, but each implementation shall supply them to complete the definitions according to the 
 4329: description in the library Clauses. 
 4330: 4 For functions, function templates, objects, and values, the library Clauses specify declarations. Implemen-
 4331: tations shall supply definitions consistent with the descriptions in the library Clauses. 
 4332: 5 The names defined in the library have namespace scope (7.3). A C++ translation unit (2.1) obtains access 
 4333: to these names by including the appropriate standard library header (16.2). 
 4334: 6 The templates, classes, functions, and objects in the library have external linkage (3.5). The implementation 
 4335: provides definitions for standard library entities, as necessary, while combining translation units to form a 
 4336: complete C++ program (2.1). 
 4337: 7 Two kinds of implementations are defined: hosted and freestanding. For a hosted implementation, this 
 4338: International Standard defines the set of available libraries. A freestanding implementation is one in which 
 4339: 2) ※Correct execution§ can include undefined behavior, depending on the data being processed; see 1.3 and 1.9. 
 4340: ∫ 1.4 4 
 4341: 
 4342: c
 4343: . ISO/IEC N2800=08-0310 
 4344: execution may take place without the benefit of an operating system, and has an implementation-defined 
 4345: set of libraries that includes certain language-support libraries (17.6.2.4). 
 4346: 8 A conforming implementation may have extensions (including additional library functions), provided they do 
 4347: not alter the behavior of any well-formed program. Implementations are required to diagnose programs that 
 4348: use such extensions that are ill-formed according to this International Standard. Having done so, however, 
 4349: they can compile and execute such programs. 
 4350: 9 Each implementation shall include documentation that identifies all conditionally-supported constructs that 
 4351: it does not support and defines all locale-specific characteristics.3 
 4352: 1.5 Structure of this International Standard [intro.structure] 
 4353: 1 Clauses 2 through 16 describe the C++ programming language. That description includes detailed syntactic 
 4354: specifications in a form described in 1.6. For convenience, Annex A repeats all such syntactic specifications. 
 4355: 2 Clauses 18 through 30 and Annex D (the library Clauses) describe the Standard C++ library, which provides 
 4356: definitions for the following kinds of entities: macros (16.3), values (Clause 3), types (8.1, 8.3), templates 
 4357: (Clause 14), classes (Clause 9), functions (8.3.5), and objects (Clause 7). 
 4358: 3 Annex B recommends lower bounds on the capacity of conforming implementations. 
 4359: 4 Annex C summarizes the evolution of C++ since its first published description, and explains in detail the 
 4360: differences between C++ and C. Certain features of C++ exist solely for compatibility purposes; Annex D 
 4361: describes those features. 
 4362: 5 Throughout this International Standard, each example is introduced by ※[ Example:§ and terminated by 
 4363: ※ 〞end example ]§. Each note is introduced by ※[ Note:§ and terminated by ※ 〞end note ]§. Examples and 
 4364: notes may be nested. 
 4365: 1.6 Syntax notation [syntax] 
 4366: 1 In the syntax notation used in this International Standard, syntactic categories are indicated by italic type, 
 4367: and literal words and characters in constant width type. Alternatives are listed on separate lines except 
 4368: in a few cases where a long set of alternatives is presented on one line, marked by the phrase ※one of.§ An 
 4369: optional terminal or nonterminal symbol is indicated by the subscript ※ opt §, so 
 4370: { expressionopt } 
 4371: indicates an optional expression enclosed in braces. 
 4372: 2 Names for syntactic categories have generally been chosen according to the following rules: 
 4373: 〞 X-name is a use of an identifier in a context that determines its meaning (e.g. class-name, typedef-
 4374: name). 
 4375: 〞 X-id is an identifier with no context-dependent meaning (e.g. qualified-id). 
 4376: 〞 X-seq is one or more X ＊s without intervening delimiters (e.g. declaration-seq is a sequence of declara-
 4377: tions). 
 4378: 〞 X-list is one or more X＊s separated by intervening commas (e.g. expression-list is a sequence of 
 4379: expressions separated by commas). 
 4380: 3) This documentation also defines implementation-defined behavior; see 1.9. 
 4381: ∫ 1.6 5 
 4382: 
 4383: c
 4384: . ISO/IEC N2800=08-0310 
 4385: 1.7 The C++ memory model [intro.memory] 
 4386: 1 The fundamental storage unit in the C++ memory model is the byte. A byte is at least large enough to 
 4387: contain any member of the basic execution character set and the eight-bit code units of the Unicode UTF-8 
 4388: encoding form and is composed of a contiguous sequence of bits, the number of which is implementation-
 4389: defined. The least significant bit is called the low-order bit; the most significant bit is called the high-order 
 4390: bit. The memory available to a C++ program consists of one or more sequences of contiguous bytes. Every 
 4391: byte has a unique address. 
 4392: 2 [ Note: the representation of types is described in 3.9. 〞end note ] 
 4393: 3 A memory location is either an object of scalar type or a maximal sequence of adjacent bit-fields all having 
 4394: non-zero width. [ Note: Various features of the language, such as references and virtual functions, might 
 4395: involve additional memory locations that are not accessible to programs but are managed by the implemen-
 4396: tation. 〞end note ] Two threads of execution can update and access separate memory locations without 
 4397: interfering with each other. 
 4398: 4 [ Note: Thus a bit-field and an adjacent non-bit-field are in separate memory locations, and therefore can be 
 4399: concurrently updated by two threads of execution without interference. The same applies to two bit-fields, 
 4400: if one is declared inside a nested struct declaration and the other is not, or if the two are separated by 
 4401: a zero-length bit-field declaration, or if they are separated by a non-bit-field declaration. It is not safe to 
 4402: concurrently update two bit-fields in the same struct if all fields between them are also bit-fields, no matter 
 4403: what the sizes of those intervening bit-fields happen to be. 〞end note ] 
 4404: 5 [ Example: A structure declared as 
 4405: struct {
 4406: char a;
 4407: int b:5,
 4408: c:11,
 4409: :0,
 4410: d:8;
 4411: struct {int ee:8;} e;
 4412: } 
 4413: contains four separate memory locations: The field a and bit-fields d and e.ee are each separate memory 
 4414: locations, and can be modified concurrently without interfering with each other. The bit-fields b and c 
 4415: together constitute the fourth memory location. The bit-fields b and c cannot be concurrently modified, but 
 4416: b and a, for example, can be. 〞end example ] 
 4417: 1.8 The C++ object model [intro.object] 
 4418: 1 The constructs in a C++ program create, destroy, refer to, access, and manipulate objects. An object is a 
 4419: region of storage. [ Note: A function is not an object, regardless of whether or not it occupies storage in the 
 4420: way that objects do. 〞end note ] An object is created by a definition (3.1), by a new-expression (5.3.4) or 
 4421: by the implementation (12.2) when needed. The properties of an object are determined when the object is 
 4422: created. An object can have a name (Clause 3). An object has a storage duration (3.7) which influences 
 4423: its lifetime (3.8). An object has a type (3.9). The term object type refers to the type with which the object 
 4424: is created. Some objects are polymorphic (10.3); the implementation generates information associated with 
 4425: each such object that makes it possible to determine that object＊s type during program execution. For other 
 4426: objects, the interpretation of the values found therein is determined by the type of the expressions (Clause 5) 
 4427: used to access them. 
 4428: ∫ 1.8 6 
 4429: 
 4430: c
 4431: . ISO/IEC N2800=08-0310 
 4432: 2 Objects can contain other objects, called subobjects. A subobject can be a member subobject (9.2), a base 
 4433: class subobject (Clause 10), or an array element. An object that is not a subobject of any other object is 
 4434: called a complete object. 
 4435: 3 For every object x, there is some object called the complete object of x, determined as follows: 
 4436: 〞 If x is a complete object, then x is the complete object of x. 
 4437: 〞 Otherwise, the complete object of x is the complete object of the (unique) object that contains x. 
 4438: 4 If a complete object, a data member (9.2), or an array element is of class type, its type is considered the 
 4439: most derived class, to distinguish it from the class type of any base class subobject; an object of a most 
 4440: derived class type or of a non-class type is called a most derived object. 
 4441: 5 Unless it is a bit-field (9.6), a most derived object shall have a non-zero size and shall occupy one or more 
 4442: bytes of storage. Base class subobjects may have zero size. An object of trivially copyable or standard-layout 
 4443: type (3.9) shall occupy contiguous bytes of storage. 
 4444: 6 [ Note: C++ provides a variety of built-in types and several ways of composing new types from existing 
 4445: types (3.9). 〞end note ] 
 4446: 1.9 Program execution [intro.execution] 
 4447: 1 The semantic descriptions in this International Standard define a parameterized nondeterministic abstract 
 4448: machine. This International Standard places no requirement on the structure of conforming implementations. 
 4449: In particular, they need not copy or emulate the structure of the abstract machine. Rather, conforming 
 4450: implementations are required to emulate (only) the observable behavior of the abstract machine as explained 
 4451: below.4 
 4452: 2 Certain aspects and operations of the abstract machine are described in this International Standard as 
 4453: implementation-defined (for example, sizeof(int)). These constitute the parameters of the abstract ma-
 4454: chine. Each implementation shall include documentation describing its characteristics and behavior in these 
 4455: respects.5 Such documentation shall define the instance of the abstract machine that corresponds to that 
 4456: implementation (referred to as the ※corresponding instance§ below). 
 4457: 3 Certain other aspects and operations of the abstract machine are described in this International Standard as 
 4458: unspecified (for example, order of evaluation of arguments to a function). Where possible, this International 
 4459: Standard defines a set of allowable behaviors. These define the nondeterministic aspects of the abstract 
 4460: machine. An instance of the abstract machine can thus have more than one possible execution sequence for 
 4461: a given program and a given input. 
 4462: 4 Certain other operations are described in this International Standard as undefined (for example, the effect of 
 4463: dereferencing the null pointer). [ Note: this International Standard imposes no requirements on the behavior 
 4464: of programs that contain undefined behavior. 〞 end note ] 
 4465: 5 A conforming implementation executing a well-formed program shall produce the same observable behavior 
 4466: as one of the possible execution sequences of the corresponding instance of the abstract machine with the 
 4467: same program and the same input. However, if any such execution sequence contains an undefined operation, 
 4468: this International Standard places no requirement on the implementation executing that program with that 
 4469: input (not even with regard to operations preceding the first undefined operation). 
 4470: 4) This provision is sometimes called the ※as-if§ rule, because an implementation is free to disregard any requirement of this 
 4471: International Standard as long as the result is as if the requirement had been obeyed, as far as can be determined from the 
 4472: observable behavior of the program. For instance, an actual implementation need not evaluate part of an expression if it can 
 4473: deduce that its value is not used and that no side effects affecting the observable behavior of the program are produced. 
 4474: 5) This documentation also includes conditonally-supported constructs and locale-specific behavior. See 1.4. 
 4475: ∫ 1.9 7 
 4476: 
 4477: c
 4478: . ISO/IEC N2800=08-0310 
 4479: 6 The observable behavior of the abstract machine is its sequence of reads and writes to volatile data and 
 4480: calls to library I/O functions.6 
 4481: 7 When the processing of the abstract machine is interrupted by receipt of a signal, the values of objects which 
 4482: are neither 
 4483: 〞 of type volatile std::sig_atomic_t nor 
 4484: 〞 lock-free atomic objects (29.2) 
 4485: are unspecified, and the value of any object not in either of these two categories that is modified by the 
 4486: handler becomes undefined. 
 4487: 8 An instance of each object with automatic storage duration (3.7.3) is associated with each entry into its 
 4488: block. Such an object exists and retains its last-stored value during the execution of the block and while the 
 4489: block is suspended (by a call of a function or receipt of a signal). 
 4490: 9 The least requirements on a conforming implementation are: 
 4491: 〞 Access to volatile objects are evaluated strictly according to the rules of the abstract machine. 
 4492: 〞 At program termination, all data written into files shall be identical to one of the possible results that 
 4493: execution of the program according to the abstract semantics would have produced. 
 4494: 〞 The input and output dynamics of interactive devices shall take place in such a fashion that prompting 
 4495: messages actually appear prior to a program waiting for input. What constitutes an interactive device 
 4496: is implementation-defined. 
 4497: [ Note: more stringent correspondences between abstract and actual semantics may be defined by each 
 4498: implementation. 〞end note ] 
 4499: 10 [ Note: operators can be regrouped according to the usual mathematical rules only where the operators really 
 4500: are associative or commutative.7 For example, in the following fragment 
 4501: int a, b; 
 4502: /. ... / 
 4503: a = a + 32760 + b + 5; 
 4504: the expression statement behaves exactly the same as 
 4505: a = (((a + 32760) + b) + 5); 
 4506: due to the associativity and precedence of these operators. Thus, the result of the sum (a + 32760) is next 
 4507: added to b, and that result is then added to 5 which results in the value assigned to a. On a machine in which 
 4508: overflows produce an exception and in which the range of values representable by an int is [-32768,+32767], 
 4509: the implementation cannot rewrite this expression as 
 4510: a = ((a + b) + 32765); 
 4511: since if the values for a and b were, respectively, -32754 and -15, the sum a+b would produce an exception 
 4512: while the original expression would not; nor can the expression be rewritten either as 
 4513: a = ((a + 32765) + b); 
 4514: or 
 4515: 6) An implementation can offer additional library I/O functions as an extension. Implementations that do so should treat 
 4516: calls to those functions as ※observable behavior§ as well. 
 4517: 7) Overloaded operators are never assumed to be associative or commutative. 
 4518: ∫ 1.9 8 
 4519: 
 4520: c
 4521: . ISO/IEC N2800=08-0310 
 4522: a = (a + (b + 32765)); 
 4523: since the values for a and b might have been, respectively, 4 and -8 or -17 and 12. However on a machine in 
 4524: which overflows do not produce an exception and in which the results of overflows are reversible, the above 
 4525: expression statement can be rewritten by the implementation in any of the above ways because the same 
 4526: result will occur. 〞 end note ] 
 4527: 11 A full-expression is an expression that is not a subexpression of another expression. If a language construct 
 4528: is defined to produce an implicit call of a function, a use of the language construct is considered to be an 
 4529: expression for the purposes of this definition. A call to a destructor generated at the end of the lifetime of 
 4530: an object other than a temporary object is an implicit full-expression. Conversions applied to the result of 
 4531: an expression in order to satisfy the requirements of the language construct in which the expression appears 
 4532: are also considered to be part of the full-expression. 
 4533: [ Example: 
 4534: struct S {
 4535: S(int i): I(i) { }
 4536: int& v() { return I; }
 4537: private:
 4538: int I;
 4539: };
 4540: S s1(1); 
 4541: S s2 = 2; 
 4542: void f() { 
 4543: if (S(3).v()) 
 4544: { }
 4545: }
 4546: 〞end example ] 
 4547: // full-expression is call of S::S(int) 
 4548: // full-expression is call of S::S(int) 
 4549: // full-expression includes lvalue-to-rvalue and 
 4550: // int to bool conversions, performed before 
 4551: // temporary is deleted at end of full-expression 
 4552: 12 [ Note: the evaluation of a full-expression can include the evaluation of subexpressions that are not lexically 
 4553: part of the full-expression. For example, subexpressions involved in evaluating default argument expres-
 4554: sions (8.3.6) are considered to be created in the expression that calls the function, not the expression that 
 4555: defines the default argument. 〞 end note ] 
 4556: 13 Accessing an object designated by a volatile lvalue (3.10), modifying an object, calling a library I/O 
 4557: function, or calling a function that does any of those operations are all side effects, which are changes in the 
 4558: state of the execution environment. Evaluation of an expression (or a sub-expression) in general includes 
 4559: both value computations (including determining the identity of an object for lvalue evaluation and fetching 
 4560: a value previously assigned to an object for rvalue evaluation) and initiation of side effects. When a call to 
 4561: a library I/O function returns or an access to a volatile object is evaluated the side effect is considered 
 4562: complete, even though some external actions implied by the call (such as the I/O itself) or by the volatile 
 4563: access may not have completed yet. 
 4564: 14 Sequenced before is an asymmetric, transitive, pair-wise relation between evaluations executed by a single 
 4565: thread, which induces a partial order among those evaluations. Given any two evaluations A and B, if A is 
 4566: sequenced before B, then the execution of A shall precede the execution of B. If A is not sequenced before 
 4567: B and B is not sequenced before A, then A and B are unsequenced.[ Note: The execution of unsequenced 
 4568: evaluations can overlap. 〞 end note ] Evaluations A and B are indeterminately sequenced when either A 
 4569: ∫ 1.9 9 
 4570: 
 4571: c
 4572: . ISO/IEC N2800=08-0310 
 4573: is sequenced before B or B is sequenced before A, but it is unspecified which. [ Note: Indeterminately 
 4574: sequenced evaluations cannot overlap, but either could be executed first. 〞end note ] 
 4575: 15 Every value computation and side effect associated with a full-expression is sequenced before every value 
 4576: computation and side effect associated with the next full-expression to be evaluated.8. 
 4577: 16 Except where noted, evaluations of operands of individual operators and of subexpressions of individual 
 4578: expressions are unsequenced. [ Note: In an expression that is evaluated more than once during the execution 
 4579: of a program, unsequenced and indeterminately sequenced evaluations of its subexpressions need not be 
 4580: performed consistently in different evaluations. 〞 end note ] The value computations of the operands of an 
 4581: operator are sequenced before the value computation of the result of the operator. If a side effect on a scalar 
 4582: object is unsequenced relative to either another side effect on the same scalar object or a value computation 
 4583: using the value of the same scalar object, the behavior is undefined. 
 4584: [ Example: 
 4585: void f(int, int); 
 4586: void g(int i, int *v) {
 4587: i = v[i++]; // the behavior is undefined
 4588: i = 7, i++, i++; // i becomes 9
 4589: i = i++ + 1; // the behavior is undefined
 4590: i = i + 1; // the value of i is incremented
 4591: f(i = -1, i = -1); // the behavior is undefined
 4592: }
 4593: 〞end example ] 
 4594: When calling a function (whether or not the function is inline), every value computation and side effect 
 4595: associated with any argument expression, or with the postfix expression designating the called function, is 
 4596: sequenced before execution of every expression or statement in the body of the called function. [ Note: Value 
 4597: computations and side effects associated with different argument expressions are unsequenced. 〞end note ] 
 4598: Every evaluation in the calling function (including other function calls) that is not otherwise specifically 
 4599: sequenced before or after the execution of the body of the called function is indeterminately sequenced with 
 4600: respect to the execution of the called function.9 Several contexts in C++ cause evaluation of a function call, 
 4601: even though no corresponding function call syntax appears in the translation unit. [ Example: Evaluation of 
 4602: a new expression invokes one or more allocation and constructor functions; see 5.3.4. For another example, 
 4603: invocation of a conversion function (12.3.2) can arise in contexts in which no function call syntax appears. 
 4604: 〞end example ] The sequencing constraints on the execution of the called function (as described above) 
 4605: are features of the function calls as evaluated, whatever the syntax of the expression that calls the function 
 4606: might be. 
 4607: 1.10 Multi-threaded executions and data races [intro.multithread] 
 4608: 1 Under a hosted implementation, a C++ program can have more than one thread of execution (a.k.a. thread) 
 4609: running concurrently. The execution of each thread proceeds as defined by the remainder of this standard. 
 4610: The execution of the entire program consists of an execution of all of its threads. [ Note: Usually the 
 4611: execution can be viewed as an interleaving of all its threads. However, some kinds of atomic operations, for 
 4612: example, allow executions inconsistent with a simple interleaving, as described below. 〞end note ] Under 
 4613: 8) As specified in 12.2, after a full-expression is evaluated, a sequence of zero or more invocations of destructor functions for 
 4614: temporary objects takes place, usually in reverse order of the construction of each temporary object. 
 4615: 9) In other words, function executions do not interleave with each other. 
 4616: ∫ 1.10 10 
 4617: 
 4618: c
 4619: . ISO/IEC N2800=08-0310 
 4620: a freestanding implementation, it is implementation-defined whether a program can have more than one 
 4621: thread of execution. 
 4622: 2 The value of an object visible to a thread T at a particular point might be the initial value of the object, a 
 4623: value assigned to the object by T, or a value assigned to the object by another thread, according to the rules 
 4624: below. [ Note: In some cases, there may instead be undefined behavior. Much of this section is motivated 
 4625: by the desire to support atomic operations with explicit and detailed visibility constraints. However, it also 
 4626: implicitly supports a simpler view for more restricted programs. 〞end note ] 
 4627: 3 Two expression evaluations conflict if one of them modifies a memory location and the other one accesses or 
 4628: modifies the same memory location. 
 4629: 4 The library defines a number of atomic operations (Clause 29) and operations on locks (Clause 30) that are 
 4630: specially identified as synchronization operations. These operations play a special role in making assignments 
 4631: in one thread visible to another. A synchronization operation on one or more memory locations is either a 
 4632: consume operation, an acquire operation, a release operation, or both an acquire and release operation. A 
 4633: synchronization operation without an associated memory location is a fence and can be either an acquire 
 4634: fence, a release fence, or both an acquire and release fence. In addition, there are relaxed atomic operations, 
 4635: which are not synchronization operations, and atomic read-modify-write operations, which have special 
 4636: characteristics. [ Note: For example, a call that acquires a lock will perform an acquire operation on the 
 4637: locations comprising the lock. Correspondingly, a call that releases the same lock will perform a release 
 4638: operation on those same locations. Informally, performing a release operation on A forces prior side effects 
 4639: on other memory locations to become visible to other threads that later perform a consume or an acquire 
 4640: operation on A. We do not include ※relaxed§ atomic operations as synchronization operations although, like 
 4641: synchronization operations, they cannot contribute to data races. 〞end note ] 
 4642: 5 All modifications to a particular atomic object M occur in some particular total order, called the modification 
 4643: order of M . If A and B are modifications of an atomic object M and A happens before (as defined below) 
 4644: B, then A shall precede B in the modification order of M , which is defined below. [ Note: This states that 
 4645: the modification orders must respect happens before. 〞end note ][ Note: There is a separate order for each 
 4646: scalar object. There is no requirement that these can be combined into a single total order for all objects. 
 4647: In general this will be impossible since different threads may observe modifications to different variables in 
 4648: inconsistent orders. 〞end note ] 
 4649: 6 A release sequence on an atomic object M is a maximal contiguous sub-sequence of side effects in the 
 4650: modification order of M , where the first operation is a release, and every subsequent operation 
 4651: 〞 is performed by the same thread that performed the release, or 
 4652: 〞 is an atomic read-modify-write operation. 
 4653: 7 Certain library calls synchronize with other library calls performed by another thread. In particular, an 
 4654: atomic operation A that performs a release operation on an object M synchronizes with an atomic operation 
 4655: B that performs an acquire operation on M and reads a value written by any side effect in the release 
 4656: sequence headed by A.[ Note: Except in the specified cases, reading a later value does not necessarily ensure 
 4657: visibility as described below. Such a requirement would sometimes interfere with efficient implementation. 
 4658: 〞end note ][ Note: The specifications of the synchronization operations define when one reads the value 
 4659: written by another. For atomic variables, the definition is clear. All operations on a given lock occur in a 
 4660: single total order. Each lock acquisition ※reads the value written§ by the last lock release. 〞 end note ] 
 4661: 8 An evaluation A carries a dependency to an evaluation B if 
 4662: 〞 the value of A is used as an operand of B, unless: 
 4663: 〞 B is an invocation of any specialization of std::kill_dependency (29.1), or 
 4664: ∫ 1.10 11 
 4665: 
 4666: c
 4667: . ISO/IEC N2800=08-0310 
 4668: 〞 A is the left operand of a built-in logical AND (&&, see 5.14) or logical OR (||, see 5.15) operator, 
 4669: or 
 4670: 〞 A is the left operand of a conditional (?:, see 5.16) operator, or 
 4671: 〞 A is the left operand of the built-in comma (,) operator (5.18);
 4672: or
 4673: 〞 A writes a scalar object or bit-field M , B reads the value written by A from M , and A is sequenced 
 4674: before B, or 
 4675: 〞 for some evaluation X, A carries a dependency to X, and X carries a dependency to B. 
 4676: [ Note: ※Carries a dependency to§ is a subset of ※is sequenced before§, and is similarly strictly intra-thread. 
 4677: 〞end note ]
 4678: 9 An evaluation A is dependency-ordered before an evaluation B if
 4679: 〞 A performs a release operation on an atomic object M , and B performs a consume operation on M 
 4680: and reads a value written by any side effect in the release sequence headed by A, or 
 4681: 〞 for some evaluation X, A is dependency-ordered before X and X carries a dependency to B. 
 4682: [ Note: The relation ※is dependency-ordered before§ is analogous to ※synchronizes with§, but uses release/-
 4683: consume in place of release/acquire. 〞end note ] 
 4684: 10 An evaluation A inter-thread happens before an evaluation B if 
 4685: 〞 A synchronizes with B, or 
 4686: 〞 A is dependency-ordered before B, or 
 4687: 〞 for some evaluation X 
 4688: 〞 A synchronizes with X and X is sequenced before B, or 
 4689: 〞 A is sequenced before X and X inter-thread happens before B, or 
 4690: 〞 A inter-thread happens before X and X inter-thread happens before B. 
 4691: [ Note: The ※inter-thread happens before§ relation describes arbitrary concatenations of ※sequenced before§, 
 4692: ※synchronizes with§ and ※dependency-ordered before§ relationships, with two exceptions. The first exception 
 4693: is that a concatenation is not permitted to end with ※dependency-ordered before§ followed by ※sequenced 
 4694: before§. The reason for this limitation is that a consume operation participating in a ※dependency-ordered 
 4695: before§ relationship provides ordering only with respect to operations to which this consume operation 
 4696: actually carries a dependency. The reason that this limitation applies only to the end of such a concatenation 
 4697: is that any subsequent release operation will provide the required ordering for a prior consume operation. 
 4698: The second exception is that a concatenation is not permitted to consist entirely of ※sequenced before§. 
 4699: The reasons for this limitation are (1) to permit ※inter-thread happens before§ to be transitively closed and 
 4700: (2) the ※happens before§ relation, defined below, provides for relationships consisting entirely of ※sequenced 
 4701: before§. 〞end note ] 
 4702: 11 An evaluation A happens before an evaluation B if: 
 4703: 〞 A is sequenced before B, or 
 4704: 〞 A inter-thread happens before B. 
 4705: 12 A visible side effect A on an object M with respect to a value computation B of M satisfies the conditions: 
 4706: 〞 A happens before B, and 
 4707: ∫ 1.10 12 
 4708: 
 4709: c
 4710: . ISO/IEC N2800=08-0310 
 4711: 〞 there is no other side effect X to M such that A happens before X and X happens before B. 
 4712: The value of a non-atomic scalar object M , as determined by evaluation B, shall be the value stored by the 
 4713: visible side effect A.[ Note: If there is ambiguity about which side effect to a non-atomic object is visible, 
 4714: then there is a data race, and the behavior is undefined. 〞 end note ][ Note: This states that operations 
 4715: on ordinary variables are not visibly reordered. This is not actually detectable without data races, but it 
 4716: is necessary to ensure that data races, as defined here, and with suitable restrictions on the use of atomics, 
 4717: correspond to data races in a simple interleaved (sequentially consistent) execution. 〞end note ] 
 4718: 13 The visible sequence of side effects on an atomic object M , with respect to a value computation B of M , is 
 4719: a maximal contiguous sub-sequence of side effects in the modification order of M , where the first side effect 
 4720: is visible with respect to B, and for every subsequent side effect, it is not the case that B happens before it. 
 4721: The value of an atomic object M , as determined by evaluation B, shall be the value stored by some operation 
 4722: in the visible sequence of M with respect to B. Furthermore, if a value computation A of an atomic object M 
 4723: happens before a value computation B of M , and the value computed by A corresponds to the value stored 
 4724: by side effect X, then the value computed by B shall either equal the value computed by A, or be the value 
 4725: stored by side effect Y , where Y follows X in the modification order of M .[ Note: This effectively disallows 
 4726: compiler reordering of atomic operations to a single object, even if both operations are ※relaxed§ loads. By 
 4727: doing so, we effectively make the ※cache coherence§ guarantee provided by most hardware available to C++ 
 4728: atomic operations. 〞end note ][ Note: The visible sequence depends on the happens before relation, which 
 4729: depends on the values observed by loads of atomics, which we are restricting here. The intended reading 
 4730: is that there must exist an association of atomic loads with modifications they observe that, together with 
 4731: suitably chosen modification orders and the happens before relation derived as described above, satisfy the 
 4732: resulting constraints as imposed here. 〞end note ] 
 4733: 14 The execution of a program contains a data race if it contains two conflicting actions in different threads, 
 4734: at least one of which is not atomic, and neither happens before the other. Any such data race results in 
 4735: undefined behavior. [ Note: It can be shown that programs that correctly use simple locks to prevent all data 
 4736: races, and use no other synchronization operations, behave as though the executions of their constituent 
 4737: threads were simply interleaved, with each observed value of an object being the last value assigned in that 
 4738: interleaving. This is normally referred to as ※sequential consistency§. However, this applies only to race-free 
 4739: programs, and race-free programs cannot observe most program transformations that do not change single-
 4740: threaded program semantics. In fact, most single-threaded program transformations continue to be allowed, 
 4741: since any program that behaves differently as a result must perform an undefined operation. 〞end note ] 
 4742: 15 [ Note: Compiler transformations that introduce assignments to a potentially shared memory location that 
 4743: would not be modified by the abstract machine are generally precluded by this standard, since such an 
 4744: assignment might overwrite another assignment by a different thread in cases in which an abstract machine 
 4745: execution would not have encountered a data race. This includes implementations of data member assign-
 4746: ment that overwrite adjacent members in separate memory locations. We also generally preclude reordering 
 4747: of atomic loads in cases in which the atomics in question may alias, since this may violate the ※visible 
 4748: sequence§ rules. 〞end note ] 
 4749: 16 [ Note: Transformations that introduce a speculative read of a potentially shared memory location may not 
 4750: preserve the semantics of the C++ program as defined in this standard, since they potentially introduce a 
 4751: data race. However, they are typically valid in the context of an optimizing compiler that targets a specific 
 4752: machine with well-defined semantics for data races. They would be invalid for a hypothetical machine that 
 4753: is not tolerant of races or provides hardware race detection. 〞 end note ] 
 4754: 1.11 Acknowledgments [intro.ack] 
 4755: 1 The C++ programming language as described in this International Standard is based on the language as 
 4756: described in Chapter R (Reference Manual) of Stroustrup: The C++ Programming Language (second edition, 
 4757: ∫ 1.11 13 
 4758: 
 4759: c
 4760: . ISO/IEC N2800=08-0310 
 4761: Addison-Wesley Publishing Company, ISBN 0-201-53992-6, copyright c
 4762: 1991 AT&T). That, in turn, is based 
 4763: on the C programming language as described in Appendix A of Kernighan and Ritchie: The C Programming 
 4764: Language (Prentice-Hall, 1978, ISBN 0-13-110163-3, copyright c
 4765: 1978 AT&T). 
 4766: 2 Portions of the library Clauses of this International Standard are based on work by P.J. Plauger, which was 
 4767: published as The Draft Standard C++ Library (Prentice-Hall, ISBN 0-13-117003-1, copyright 1995 P.J. 
 4768: c
 4769: Plauger).
 4770: 3 All rights in these originals are reserved. 
 4771: ∫ 1.11 14 
 4772: 
 4773: c
 4774: . ISO/IEC N2800=08-0310 
 4775: 2 Lexical conventions [lex]
 4776: 1 The text of the program is kept in units called source files in this International Standard. A source file 
 4777: together with all the headers (17.6.2.3) and source files included (16.2) via the preprocessing directive 
 4778: #include, less any source lines skipped by any of the conditional inclusion (16.1) preprocessing directives, is 
 4779: called a translation unit.[ Note: a C++ program need not all be translated at the same time. 〞end note ] 
 4780: 2 [ Note: previously translated translation units and instantiation units can be preserved individually or in 
 4781: libraries. The separate translation units of a program communicate (3.5) by (for example) calls to functions 
 4782: whose identifiers have external linkage, manipulation of objects whose identifiers have external linkage, or 
 4783: manipulation of data files. Translation units can be separately translated and then later linked to produce 
 4784: an executable program (3.5). 〞end note ] 
 4785: 2.1 Phases of translation [lex.phases] 
 4786: 1 The precedence among the syntax rules of translation is specified by the following phases.10 
 4787: 1. Physical source file characters are mapped, in an implementation-defined manner, to the basic source 
 4788: character set (introducing new-line characters for end-of-line indicators) if necessary. The set of phys-
 4789: ical source file characters accepted is implementation-defined. Trigraph sequences (2.3) are replaced 
 4790: by corresponding single-character internal representations. Any source file character not in the basic 
 4791: source character set (2.2) is replaced by the universal-character-name that designates that charac-
 4792: ter. (An implementation may use any internal encoding, so long as an actual extended character 
 4793: encountered in the source file, and the same extended character expressed in the source file as a 
 4794: universal-character-name (i.e. using the \uXXXX notation), are handled equivalently.) 
 4795: 2. Each instance of a backslash character (\) immediately followed by a new-line character is deleted, 
 4796: splicing physical source lines to form logical source lines. Only the last backslash on any physical 
 4797: source line shall be eligible for being part of such a splice. If, as a result, a character sequence that 
 4798: matches the syntax of a universal-character-name is produced, the behavior is undefined. If a source 
 4799: file that is not empty does not end in a new-line character, or ends in a new-line character immediately 
 4800: preceded by a backslash character before any such splicing takes place, the behavior is undefined. 
 4801: 3. The source file is decomposed into preprocessing tokens (2.4) and sequences of white-space characters 
 4802: (including comments). A source file shall not end in a partial preprocessing token or in a partial 
 4803: comment.11 Each comment is replaced by one space character. New-line characters are retained. 
 4804: Whether each nonempty sequence of white-space characters other than new-line is retained or replaced 
 4805: by one space character is implementation-defined. The process of dividing a source file＊s characters 
 4806: into preprocessing tokens is context-dependent. [ Example: see the handling of < within a #include 
 4807: preprocessing directive. 〞 end example ] 
 4808: 4. Preprocessing directives are executed, macro invocations are expanded, and _Pragma unary operator 
 4809: expressions are executed. If a character sequence that matches the syntax of a universal-character-name 
 4810: is produced by token concatenation (16.3.3), the behavior is undefined. A #include preprocessing di-
 4811: 10) Implementations must behave as if these separate phases occur, although in practice different phases might be folded 
 4812: together. 
 4813: 11) A partial preprocessing token would arise from a source file ending in the first portion of a multi-character token that 
 4814: requires a terminating sequence of characters, such as a header-name that is missing the closing " or >. A partial comment 
 4815: would arise from a source file ending with an unclosed /* comment. 
 4816: ∫ 2.1 15 
 4817: 
 4818: c
 4819: . ISO/IEC N2800=08-0310 
 4820: rective causes the named header or source file to be processed from phase 1 through phase 4, recursively. 
 4821: All preprocessing directives are then deleted. 
 4822: 5. Each source character set member and universal-character-name in a character literal or a string literal, 
 4823: as well as each escape sequence in a character literal or a non-raw string literal, is converted to the 
 4824: corresponding member of the execution character set (2.13.2, 2.13.4); if there is no corresponding 
 4825: member, it is converted to an implementation-defined member other than the null (wide) character.12 
 4826: 6. Adjacent literal tokens are concatenated. 
 4827: 7. White-space characters separating tokens are no longer significant. Each preprocessing token is con-
 4828: verted into a token. (2.6). The resulting tokens are syntactically and semantically analyzed and trans-
 4829: lated as a translation unit. [ Note: The process of analyzing and translating the tokens may occasionally 
 4830: result in one token being replaced by a sequence of other tokens (14.2). 〞end note ][ Note: Source 
 4831: files, translation units and translated translation units need not necessarily be stored as files, nor need 
 4832: there be any one-to-one correspondence between these entities and any external representation. The 
 4833: description is conceptual only, and does not specify any particular implementation. 〞end note ] 
 4834: 8. Translated translation units and instantiation units are combined as follows: [ Note: some or all of 
 4835: these may be supplied from a library. 〞 end note ] Each translated translation unit is examined to 
 4836: produce a list of required instantiations. [ Note: this may include instantiations which have been 
 4837: explicitly requested (14.7.2). 〞end note ] The definitions of the required templates are located. 
 4838: It is implementation-defined whether the source of the translation units containing these definitions 
 4839: is required to be available. [ Note: an implementation could encode sufficient information into the 
 4840: translated translation unit so as to ensure the source is not required here. 〞 end note ] All the 
 4841: required instantiations are performed to produce instantiation units.[ Note: these are similar to 
 4842: translated translation units, but contain no references to uninstantiated templates and no template 
 4843: definitions. 〞end note ] The program is ill-formed if any instantiation fails. 
 4844: 9. All external object and function references are resolved. Library components are linked to satisfy 
 4845: external references to functions and objects not defined in the current translation. All such transla-
 4846: tor output is collected into a program image which contains information needed for execution in its 
 4847: execution environment. 
 4848: 2.2 Character sets [lex.charset] 
 4849: 1 The basic source character set consists of 96 characters: the space character, the control characters repre-
 4850: senting horizontal tab, vertical tab, form feed, and new-line, plus the following 91 graphical characters:13 
 4851: abcdefghijklmnopqrstuvwxyz 
 4852: ABCDEFGHIJKLMNOPQRSTUVWXYZ 
 4853: 0123456789 
 4854: _{}[]#()<>%:;.?*+-/^&|‵ !=,\"＊ 
 4855: 2 The universal-character-name construct provides a way to name other characters. 
 4856: hex-quad:
 4857: hexadecimal-digit hexadecimal-digit hexadecimal-digit hexadecimal-digit
 4858: 12) An implementation need not convert all non-corresponding source characters to the same execution character. 
 4859: 13) The glyphs for the members of the basic source character set are intended to identify characters from the subset of 
 4860: ISO/IEC 10646 which corresponds to the ASCII character set. However, because the mapping from source file characters to the 
 4861: source character set (described in translation phase 1) is specified as implementation-defined, an implementation is required to 
 4862: document how the basic source characters are represented in source files. 
 4863: ∫ 2.2 16 
 4864: 
 4865: c
 4866: . ISO/IEC N2800=08-0310 
 4867: universal-character-name:
 4868: \u hex-quad
 4869: \U hex-quad hex-quad
 4870: The character designated by the universal-character-name \UNNNNNNNN is that character whose character 
 4871: short name in ISO/IEC 10646 is NNNNNNNN; the character designated by the universal-character-name \uNNNN 
 4872: is that character whose character short name in ISO/IEC 10646 is 0000NNNN. If the hexadecimal value for a 
 4873: universal-character-name corresponds to a surrogate code point (in the range 0xD800每0xDFFF, inclusive), 
 4874: the program is ill-formed. Additionally, if the hexadecimal value for a universal-character-name outside a 
 4875: character or string literal corresponds to a control character (in either of the ranges 0x00每0x1F or 0x7F每0x9F, 
 4876: both inclusive) or to a character in the basic source character set, the program is ill-formed. 
 4877: 3 The basic execution character set and the basic execution wide-character set shall each contain all the 
 4878: members of the basic source character set, plus control characters representing alert, backspace, and carriage 
 4879: return, plus a null character (respectively, null wide character), whose representation has all zero bits. For 
 4880: each basic execution character set, the values of the members shall be non-negative and distinct from one 
 4881: another. In both the source and execution basic character sets, the value of each character after 0 in the 
 4882: above list of decimal digits shall be one greater than the value of the previous. The execution character 
 4883: set and the execution wide-character set are supersets of the basic execution character set and the basic 
 4884: execution wide-character set, respectively. The values of the members of the execution character sets are 
 4885: implementation-defined, and any additional members are locale-specific. 
 4886: 2.3 Trigraph sequences [lex.trigraph] 
 4887: 1 Before any other processing takes place, each occurrence of one of the following sequences of three characters 
 4888: (※trigraph sequences§) is replaced by the single character indicated in Table 1. 
 4889: Table 1 〞 Trigraph sequences 
 4890: Trigraph Replacement Trigraph Replacement Trigraph Replacement 
 4891: ??= # ??( [ ??< { 
 4892: ??/ \ ??) ] ??> } 
 4893: ??＊ . ??! | ??-‵ 
 4894: 2 [ Example: 
 4895: ??=define arraycheck(a,b) a??(b??) ??!??! b??(a??) 
 4896: becomes 
 4897: #define arraycheck(a,b) a[b] || b[a] 
 4898: 〞end example ] 
 4899: 3 No other trigraph sequence exists. Each ? that does not begin one of the trigraphs listed above is not 
 4900: changed. 
 4901: ∫ 2.3 17 
 4902: 
 4903: c
 4904: . ISO/IEC N2800=08-0310 
 4905: 2.4 Preprocessing tokens [lex.pptoken] 
 4906: preprocessing-token:
 4907: header-name
 4908: identifier
 4909: pp-number
 4910: character-literal
 4911: user-defined-character-literal
 4912: string-literal
 4913: user-defined-string-literal
 4914: preprocessing-op-or-punc
 4915: each non-white-space character that cannot be one of the above 
 4916: 1 Each preprocessing token that is converted to a token (2.6) shall have the lexical form of a keyword, an 
 4917: identifier, a literal, an operator, or a punctuator. 
 4918: 2 
 4919: A preprocessing token is the minimal lexical element of the language in translation phases 3 through 6. The 
 4920: categories of preprocessing token are: header names, identifiers, preprocessing numbers, character literals 
 4921: (including user-defined character literals), string literals (including user-defined string literals), preprocessing 
 4922: operators and punctuators, and single non-white-space characters that do not lexically match the other 
 4923: preprocessing token categories. If a ＊ or a " character matches the last category, the behavior is undefined. 
 4924: Preprocessing tokens can be separated by white space; this consists of comments (2.7), or white-space 
 4925: characters (space, horizontal tab, new-line, vertical tab, and form-feed), or both. As described in Clause 16, 
 4926: in certain circumstances during translation phase 4, white space (or the absence thereof) serves as more 
 4927: than preprocessing token separation. White space can appear within a preprocessing token only as part of 
 4928: a header name or between the quotation characters in a character literal or string literal. 
 4929: 3 If the input stream has been parsed into preprocessing tokens up to a given character, the next preprocessing 
 4930: token is the longest sequence of characters that could constitute a preprocessing token, even if that would 
 4931: cause further lexical analysis to fail. 
 4932: 4 [ Example: The program fragment 1Ex is parsed as a preprocessing number token (one that is not a valid 
 4933: floating or integer literal token), even though a parse as the pair of preprocessing tokens 1 and Ex might 
 4934: produce a valid expression (for example, if Ex were a macro defined as +1). Similarly, the program fragment 
 4935: 1E1 is parsed as a preprocessing number (one that is a valid floating literal token), whether or not E is a 
 4936: macro name. 〞end example ] 
 4937: 5 [ Example: The program fragment x+++++y is parsed as x ++ ++ + y, which, if x and y are of built-in types, 
 4938: violates a constraint on increment operators, even though the parse x ++ + ++ y might yield a correct 
 4939: expression. 〞 end example ] 
 4940: 2.5 Alternative tokens [lex.digraph] 
 4941: 1 Alternative token representations are provided for some operators and punctuators.14 
 4942: 2 In all respects of the language, each alternative token behaves the same, respectively, as its primary token, 
 4943: ∫ 2.5 18 
 4944: 
 4945: . ISO/IEC N2800=08-0310 
 4946: Table 2 〞 Alternative tokens 
 4947: Alternative Primary Alternative Primary Alternative Primary 
 4948: <% { and && and_eq &= 
 4949: %> } bitor | or_eq |= 
 4950: <: [ or || xor_eq .= 
 4951: :> ] xor . not ! 
 4952: %: # compl ‵ not_eq != 
 4953: %:%: ## bitand & 
 4954: except for its spelling.15 The set of alternative tokens is defined in Table 2. 
 4955: 2.6 Tokens [lex.token] 
 4956: token:
 4957: identifier
 4958: keyword
 4959: literal
 4960: operator
 4961: punctuator
 4962: 1 There are five kinds of tokens: identifiers, keywords, literals,16 operators, and other separators. Blanks, 
 4963: horizontal and vertical tabs, newlines, formfeeds, and comments (collectively, ※white space§), as described 
 4964: below, are ignored except as they serve to separate tokens. [ Note: Some white space is required to sepa-
 4965: rate otherwise adjacent identifiers, keywords, numeric literals, and alternative tokens containing alphabetic 
 4966: characters. 〞end note ] 
 4967: 2.7 Comments [lex.comment] 
 4968: 1 The characters /* start a comment, which terminates with the characters */. These comments do not 
 4969: nest. The characters // start a comment, which terminates with the next new-line character. If there is a 
 4970: form-feed or a vertical-tab character in such a comment, only white-space characters shall appear between it 
 4971: and the new-line that terminates the comment; no diagnostic is required. [ Note: The comment characters 
 4972: //, /*, and */ have no special meaning within a // comment and are treated just like other characters. 
 4973: Similarly, the comment characters // and /* have no special meaning within a /* comment. 〞end note ] 
 4974: 2.8 Header names [lex.header] 
 4975: header-name:
 4976: < h-char-sequence >
 4977: " q-char-sequence "
 4978: h-char-sequence:
 4979: h-char
 4980: h-char-sequence h-char
 4981: h-char: 
 4982: any member of the source character set except new-line and > 
 4983: 14) These include ※digraphs§ and additional reserved words. The term ※digraph§ (token consisting of two characters) is not 
 4984: perfectly descriptive, since one of the alternative preprocessing-tokens is %:%: and of course several primary tokens contain two 
 4985: characters. Nonetheless, those alternative tokens that aren＊t lexical keywords are colloquially known as ※digraphs§. 
 4986: 15) Thus the ※stringized§ values (16.3.2) of [ and <: will be different, maintaining the source spelling, but the tokens can 
 4987: otherwise be freely interchanged. 
 4988: 16) Literals include strings and character and numeric literals. 
 4989: ∫ 2.8 19 
 4990: 
 4991: c
 4992: . ISO/IEC N2800=08-0310 
 4993: q-char-sequence:
 4994: q-char
 4995: q-char-sequence q-char
 4996: q-char: 
 4997: any member of the source character set except new-line and " 
 4998: 1 Header name preprocessing tokens shall only appear within a #include preprocessing directive (16.2). The 
 4999: sequences in both forms of header-names are mapped in an implementation-defined manner to headers or 
 5000: to external source file names as specified in 16.2. 
 5001: 2 If either of the characters ＊ or \, or either of the character sequences /* or // appears in a q-char-sequence 
 5002: or a h-char-sequence, or the character " appears in a h-char-sequence, the behavior is undefined.17 
 5003: 2.9 Preprocessing numbers [lex.ppnumber] 
 5004: pp-number:
 5005: digit
 5006: .digit
 5007: pp-number digit
 5008: pp-number identifier-nondigit
 5009: pp-number esign
 5010: pp-number Esign
 5011: pp-number .
 5012: 1 Preprocessing number tokens lexically include all integral literal tokens (2.13.1) and all floating literal to-
 5013: kens (2.13.3). 
 5014: 2 A preprocessing number does not have a type or a value; it acquires both after a successful conversion (as 
 5015: part of translation phase 7, 2.1) to an integral literal token or a floating literal token. 
 5016: 2.10 Identifiers [lex.name] 
 5017: identifier:
 5018: identifier-nondigit
 5019: identifier identifier-nondigit
 5020: identifier digit
 5021: identifier-nondigit:
 5022: nondigit
 5023: universal-character-name
 5024: other implementation-defined characters
 5025: nondigit: one of
 5026: abcdefghijklm
 5027: nopqrstuvwxyz
 5028: ABCDEFGHIJKLM
 5029: NOPQRSTUVWXYZ_
 5030: digit: one of 
 5031: 0123456789 
 5032: 1 An identifier is an arbitrarily long sequence of letters and digits. Each universal-character-name in an 
 5033: identifier shall designate a character whose encoding in ISO 10646 falls into one of the ranges specified in 
 5034: Annex A of TR 10176:2003. Upper-and lower-case letters are different. All characters are significant.18 
 5035: 17) Thus, sequences of characters that resemble escape sequences cause undefined behavior. 
 5036: 18) On systems in which linkers cannot accept extended characters, an encoding of the universal-character-name may be used 
 5037: in forming valid external identifiers. For example, some otherwise unused character or sequence of characters may be used to 
 5038: encode the \u in a universal-character-name. Extended characters may produce a long external identifier, but C++ does not 
 5039: place a translation limit on significant characters for external identifiers. In C++, upper-and lower-case letters are considered 
 5040: different for all identifiers, including external identifiers. 
 5041: ∫ 2.10 20 
 5042: 
 5043: c
 5044: . ISO/IEC N2800=08-0310 
 5045: 2 In addition, some identifiers are reserved for use by C++ implementations and standard libraries (17.6.4.3.3) 
 5046: and shall not be used otherwise; no diagnostic is required. 
 5047: 2.11 Keywords [lex.key] 
 5048: 1 The identifiers shown in Table 3 are reserved for use as keywords (that is, they are unconditionally treated 
 5049: as keywords in phase 7) except in an attribute-token (7.6.1): 
 5050: Table 3 〞 Keywords 
 5051: const for register true 
 5052: alignof const_cast friend reinterpret_cast try 
 5053: asm continue goto requires typedef 
 5054: auto decltype if return typeid 
 5055: axiom default inline short typename 
 5056: bool delete int signed union 
 5057: break double late_check sizeof unsigned 
 5058: case do long static using 
 5059: catch dynamic_cast mutable static_assert virtual 
 5060: char16_t else namespace static_cast void 
 5061: char32_t enum new struct volatile 
 5062: char explicit nullptr switch wchar_t 
 5063: class export operator template while 
 5064: concept extern private this 
 5065: concept_map false protected thread_local 
 5066: constexpr float public throw 
 5067: Furthermore, the alternative representations shown in Table 4 for certain operators and punctuators (2.5) 
 5068: are reserved and shall not be used otherwise: 
 5069: Table 4 〞 Alternative representations 
 5070: and and_eq bitand bitor compl not 
 5071: not_eq or or_eq xor xor_eq 
 5072: 2.12 Operators and punctuators [lex.operators] 
 5073: The lexical representation of C++ programs includes a number of preprocessing tokens which are used in 
 5074: the syntax of the preprocessor or are converted into tokens for operators and punctuators: 
 5075: preprocessing-op-or-punc: one of 
 5076: {} [ ] # ##( ) 
 5077: <::> <% %> %: %:%:; : ... 
 5078: new delete ? :: . .* 
 5079: +-* / % . & |  > +=-=*=/=%= 
 5080: .=&= |= << >> >>= <<= == != 
 5081: <=>= && || ++ --, ->*-> 
 5082: and and_eq bitand bitor compl not not_eq 
 5083: or or_eq xor xor_eq 
 5084: ∫ 2.12 21 
 5085: 
 5086: c
 5087: . ISO/IEC N2800=08-0310 
 5088: Each preprocessing-op-or-punc is converted to a single token in translation phase 7 (2.1). 
 5089: 2.13 Literals [lex.literal] 
 5090: 1 There are several kinds of literals.19 
 5091: literal:
 5092: integer-literal
 5093: character-literal
 5094: floating-literal
 5095: string-literal
 5096: boolean-literal
 5097: pointer-literal
 5098: user-defined-literal
 5099: 2.13.1 Integer literals [lex.icon] 
 5100: integer-literal:
 5101: decimal-literal integer-suffixopt
 5102: octal-literal integer-suffixopt
 5103: hexadecimal-literal integer-suffixopt
 5104: decimal-literal:
 5105: nonzero-digit
 5106: decimal-literal digit
 5107: octal-literal: 
 5108: 0 
 5109: octal-literal octal-digit 
 5110: hexadecimal-literal:
 5111: 0xhexadecimal-digit
 5112: 0Xhexadecimal-digit
 5113: hexadecimal-literal hexadecimal-digit
 5114: nonzero-digit: one of 
 5115: 123456789 
 5116: octal-digit: one of 
 5117: 01234567 
 5118: hexadecimal-digit: one of 
 5119: 0123456789
 5120: abcdef
 5121: ABCDEF
 5122: integer-suffix:
 5123: unsigned-suffix long-suffixopt
 5124: unsigned-suffix long-long-suffixopt
 5125: long-suffix unsigned-suffixopt
 5126: long-long-suffix unsigned-suffixopt
 5127: unsigned-suffix: one of 
 5128: uU 
 5129: long-suffix: one of 
 5130: lL 
 5131: long-long-suffix: one of 
 5132: llLL 
 5133: 1 An integer literal is a sequence of digits that has no period or exponent part. An integer literal may have 
 5134: a prefix that specifies its base and a suffix that specifies its type. The lexically first digit of the sequence 
 5135: 19) The term ※literal§ generally designates, in this International Standard, those tokens that are called ※constants§ in ISO C. 
 5136: ∫ 2.13.1 22 
 5137: 
 5138: c
 5139: . ISO/IEC N2800=08-0310 
 5140: of digits is the most significant. A decimal integer literal (base ten) begins with a digit other than 0 and 
 5141: consists of a sequence of decimal digits. An octal integer literal (base eight) begins with the digit 0 and 
 5142: consists of a sequence of octal digits.20 A hexadecimal integer literal (base sixteen) begins with 0x or 0X and 
 5143: consists of a sequence of hexadecimal digits, which include the decimal digits and the letters a through f 
 5144: and A through F with decimal values ten through fifteen. [ Example: the number twelve can be written 12, 
 5145: 014, or 0XC. 〞end example ] 
 5146: 2 The type of an integer literal is the first of the corresponding list in Table 5 in which its value can be 
 5147: represented. 
 5148: Table 5 〞 Types of integer constants 
 5149: Suffix Decimal constant Octal or hexadecimal constant 
 5150: none int int 
 5151: long int 
 5152: long long int 
 5153: unsigned int 
 5154: long int 
 5155: unsigned long int 
 5156: long long int 
 5157: unsigned long long int 
 5158: u or U unsigned int unsigned int 
 5159: unsigned long int unsigned long int 
 5160: unsigned long long int unsigned long long int 
 5161: l or L long int long int 
 5162: long long int unsigned long int 
 5163: long long int 
 5164: unsigned long int 
 5165: Both u or U 
 5166: and l or L 
 5167: unsigned long int 
 5168: unsigned long long int 
 5169: unsigned long int 
 5170: unsigned long long int 
 5171: ll or LL long long int long long int 
 5172: unsigned long int 
 5173: Both u or U 
 5174: and ll or LL 
 5175: unsigned long long int unsigned long long int 
 5176: 3 If an integer literal cannot be represented by any type in its list and an extended integer type can represent 
 5177: its value, it may have that extended integer type. If all of the types in the list for the literal are signed, the 
 5178: extended integer type shall be signed. If all of the types in the list for the literal are unsigned, the extended 
 5179: integer type shall be unsigned. If the list contains both signed and unsigned types, the extended integer 
 5180: type may be signed or unsigned. A program is ill-formed if one of its translation units contains an integer 
 5181: literal that cannot be represented by any of the allowed types. 
 5182: 2.13.2 Character literals [lex.ccon] 
 5183: character-literal:
 5184: ＊ c-char-sequence ＊
 5185: u＊ c-char-sequence ＊
 5186: U＊ c-char-sequence ＊
 5187: L＊ c-char-sequence ＊
 5188: c-char-sequence:
 5189: c-char
 5190: c-char-sequence c-char
 5191: 20) The digits 8 and 9 are not octal digits. 
 5192: ∫ 2.13.2 23 
 5193: 
 5194: c
 5195: . ISO/IEC N2800=08-0310 
 5196: c-char: 
 5197: any member of the source character set except
 5198: the single-quote ＊, backslash \, or new-line character
 5199: escape-sequence
 5200: universal-character-name
 5201: escape-sequence:
 5202: simple-escape-sequence
 5203: octal-escape-sequence
 5204: hexadecimal-escape-sequence
 5205: simple-escape-sequence: one of 
 5206: \＊\"\? \\
 5207: \a \b \f \n \r \t \v
 5208: octal-escape-sequence:
 5209: \ octal-digit
 5210: \ octal-digit octal-digit
 5211: \ octal-digit octal-digit octal-digit
 5212: hexadecimal-escape-sequence:
 5213: \x hexadecimal-digit
 5214: hexadecimal-escape-sequence hexadecimal-digit
 5215: 1 A character literal is one or more characters enclosed in single quotes, as in ＊x＊, optionally preceded by 
 5216: one of the letters u, U, or L, as in u＊y＊, U＊z＊, or L＊x＊, respectively. A character literal that does not begin 
 5217: with u, U, or L is an ordinary character literal, also referred to as a narrow-character literal. An ordinary 
 5218: character literal that contains a single c-char has type char, with value equal to the numerical value of the 
 5219: encoding of the c-char in the execution character set. An ordinary character literal that contains more than 
 5220: one c-char is a multicharacter literal. A multicharacter literal has type int and implementation-defined 
 5221: value. 
 5222: 2 A character literal that begins with the letter u, such as u＊y＊, is a character literal of type char16_t. The 
 5223: value of a char16_t literal containing a single c-char is equal to its ISO 10646 code point value, provided that 
 5224: the code point is representable with a single 16-bit code unit. (That is, provided it is a basic multi-lingual 
 5225: plane code point.) If the value is not representable within 16 bits, the program is ill-formed. A char16_t 
 5226: literal containing multiple c-chars is ill-formed. A character literal that begins with the letter U, such as 
 5227: U＊z＊, is a character literal of type char32_t. The value of a char32_t literal containing a single c-char is 
 5228: equal to its ISO 10646 code point value. A char32_t literal containing multiple c-chars is ill-formed. A 
 5229: character literal that begins with the letter L, such as L＊x＊, is a wide-character literal. A wide-character 
 5230: literal has type wchar_t.21 The value of a wide-character literal containing a single c-char has value equal 
 5231: to the numerical value of the encoding of the c-char in the execution wide-character set. The value of a 
 5232: wide-character literal containing multiple c-chars is implementation-defined. 
 5233: 3 Certain nongraphic characters, the single quote ＊, the double quote ", the question mark ?, and the backslash 
 5234: \, can be represented according to Table 6. The double quote " and the question mark ?, can be represented 
 5235: as themselves or by the escape sequences \" and \? respectively, but the single quote ＊ and the backslash 
 5236: \ shall be represented by the escape sequences \＊ and \\ respectively. Escape sequences in which the 
 5237: character following the backslash is not listed in Table 6 are conditionally-supported, with implementation-
 5238: defined semantics. An escape sequence specifies a single character. 
 5239: 4 The escape \ooo consists of the backslash followed by one, two, or three octal digits that are taken to specify 
 5240: the value of the desired character. The escape \xhhh consists of the backslash followed by x followed by one 
 5241: or more hexadecimal digits that are taken to specify the value of the desired character. There is no limit to 
 5242: the number of digits in a hexadecimal sequence. A sequence of octal or hexadecimal digits is terminated by 
 5243: the first character that is not an octal digit or a hexadecimal digit, respectively. The value of a character 
 5244: 21) They are intended for character sets where a character does not fit into a single byte. 
 5245: ∫ 2.13.2 24 
 5246: 
 5247: . ISO/IEC N2800=08-0310 
 5248: Table 6 〞 Escape sequences 
 5249: new-line NL(LF) \n 
 5250: horizontal tab HT \t 
 5251: vertical tab VT \v 
 5252: backspace BS \b 
 5253: carriage return CR \r 
 5254: form feed FF \f 
 5255: alert BEL \a 
 5256: backslash \ \\ 
 5257: question mark ? \? 
 5258: single quote ＊ \＊ 
 5259: double quote " \" 
 5260: octal number ooo \ooo 
 5261: hex number hhh \xhhh 
 5262: literal is implementation-defined if it falls outside of the implementation-defined range defined for char (for 
 5263: literals with no prefix), char16_t (for literals prefixed by ＊u＊), char32_t (for literals prefixed by ＊U＊), or 
 5264: wchar_t (for literals prefixed by ＊L＊). 
 5265: 5 A universal-character-name is translated to the encoding, in the execution character set, of the character 
 5266: named. If there is no such encoding, the universal-character-name is translated to an implementation-
 5267: defined encoding. [ Note: in translation phase 1, a universal-character-name is introduced whenever an 
 5268: actual extended character is encountered in the source text. Therefore, all extended characters are described 
 5269: in terms of universal-character-names. However, the actual compiler implementation may use its own native 
 5270: character set, so long as the same results are obtained. 〞end note ] 
 5271: 2.13.3 Floating literals [lex.fcon] 
 5272: floating-literal:
 5273: fractional-constant exponent-partopt floating-suffixopt
 5274: digit-sequence exponent-part floating-suffixopt
 5275: fractional-constant:
 5276: digit-sequenceopt .digit-sequence
 5277: digit-sequence .
 5278: exponent-part:
 5279: esignopt digit-sequence
 5280: Esignopt digit-sequence
 5281: sign: one of 
 5282: +-
 5283: digit-sequence:
 5284: digit
 5285: digit-sequence digit
 5286: floating-suffix: one of 
 5287: flFL 
 5288: 1 A floating literal consists of an integer part, a decimal point, a fraction part, an e or E, an optionally signed 
 5289: integer exponent, and an optional type suffix. The integer and fraction parts both consist of a sequence of 
 5290: decimal (base ten) digits. Either the integer part or the fraction part (not both) can be omitted; either the 
 5291: decimal point or the letter e (or E ) and the exponent (not both) can be omitted. The integer part, the 
 5292: optional decimal point and the optional fraction part form the significant part of the floating literal. The 
 5293: exponent, if present, indicates the power of 10 by which the significant part is to be scaled. If the scaled 
 5294: ∫ 2.13.3 25 
 5295: 
 5296: c
 5297: . ISO/IEC N2800=08-0310 
 5298: value is in the range of representable values for its type, the result is the scaled value if representable, else the 
 5299: larger or smaller representable value nearest the scaled value, chosen in an implementation-defined manner. 
 5300: The type of a floating literal is double unless explicitly specified by a suffix. The suffixes f and F specify 
 5301: float, the suffixes l and L specify long double. If the scaled value is not in the range of representable 
 5302: values for its type, the program is ill-formed. 
 5303: 2.13.4 String literals [lex.string] 
 5304: string-literal:
 5305: " s-char-sequenceopt "
 5306: u8" s-char-sequenceopt "
 5307: u" s-char-sequenceopt "
 5308: U" s-char-sequenceopt "
 5309: L" s-char-sequenceopt "
 5310: R raw-string
 5311: u8R raw-string
 5312: uR raw-string
 5313: UR raw-string
 5314: LR raw-string
 5315: s-char-sequence:
 5316: s-char
 5317: s-char-sequence s-char
 5318: s-char: 
 5319: any member of the source character set except
 5320: the double-quote ", backslash \, or new-line character
 5321: escape-sequence
 5322: universal-character-name
 5323: raw-string:
 5324: " d-char-sequenceopt [ r-char-sequenceopt ] d-char-sequenceopt "
 5325: r-char-sequence:
 5326: r-char
 5327: r-char-sequence r-char
 5328: r-char: 
 5329: any member of the source character set, except 
 5330: (1), a backslash \followed by a u or U, or 
 5331: (2), a right square bracket ] followed by the initial d-char-sequence 
 5332: (which may be empty) followed by a double quote ". 
 5333: universal-character-name 
 5334: d-char-sequence:
 5335: d-char
 5336: d-char-sequence d-char
 5337: d-char: 
 5338: any member of the basic source character set except:
 5339: space, the left square bracket [, the right square bracket ],
 5340: and the control characters representing horizontal tab,
 5341: vertical tab, form feed, and newline.
 5342: 1 A string literal is a sequence of characters (as defined in 2.13.2) surrounded by double quotes, optionally 
 5343: prefixed by R, u8, u8R, u, uR, U, UR, L, or LR, as in "...", R"...", u8"...", u8R"**[...]**", u"...", 
 5344: uR"*[...]*‵ ", U"...", UR"zzz[...]zzz", L"...", or LR"[...]", respectively. 
 5345: ∫ 2.13.4 26 
 5346: 
 5347: c
 5348: . ISO/IEC N2800=08-0310 
 5349: 2 A string literal that has an R in the prefix is a raw string literal. The terminating d-char-sequence of a 
 5350: raw-string is the same sequence of characters as the initial d-char-sequence. A d-char-sequence shall consist 
 5351: of at most 16 characters. 
 5352: 3 [ Note: A source-file new-line in a raw string literal results in a new-line in the resulting execution string-
 5353: literal, unless preceded by a backslash. Assuming no whitespace at the beginning of lines in the following 
 5354: example, the assert will succeed: 
 5355: const char *p = R"[a
 5356: b
 5357: c]";
 5358: assert(std::strcmp(p, "ab\nc") == 0);
 5359: 〞end note ] 
 5360: 4 A string literal that does not begin with u8, u, U, or L is an ordinary string literal, and is initialized with 
 5361: the given characters. 
 5362: 5 A string literal that begins with u8, such as u8"asdf", is a UTF-8 string literal and is initialized with the 
 5363: given characters as encoded in UTF-8. 
 5364: 6 Ordinary string literals and UTF-8 string literals are also referred to as narrow string literals. A narrow 
 5365: string literal has type ※array of n const char§, where n is the size of the string as defined below, and has 
 5366: static storage duration (3.7). 
 5367: 7 A string literal that begins with u, such as u"asdf", is a char16_t string literal. A char16_t string literal 
 5368: has type ※array of n const char16_t§, where n is the size of the string as defined below; it has static storage 
 5369: duration and is initialized with the given characters. A single c-char may produce more than one char16_t 
 5370: character in the form of surrogate pairs. 
 5371: 8 A string literal that begins with U, such as U"asdf",is a char32_t string literal. A char32_t string literal 
 5372: has type ※array of n const char32_t§, where n is the size of the string as defined below; it has static storage 
 5373: duration and is initialized with the given characters. 
 5374: 9 A string literal that begins with L, such as L"asdf", is a wide string literal. A wide string literal has type 
 5375: ※array of n const wchar_t§, where n is the size of the string as defined belowit has static storage duration 
 5376: and is initialized with the given characters. 
 5377: 10 Whether all string literals are distinct (that is, are stored in nonoverlapping objects) is implementation-
 5378: defined. The effect of attempting to modify a string literal is undefined. 
 5379: 11 In translation phase 6 (2.1), adjacent string literals are concatenated. If both string literals have the same 
 5380: prefix, the resulting concatenated string literal has that prefix. If one string literal has no prefix, it is treated 
 5381: as a string literal of the same prefix as the other operand. If a UTF-8 string literal token is adjacent to a 
 5382: wide string literal token, the program is ill-formed. Any other concatenations are conditionally supported 
 5383: with implementation-defined behavior. [ Note: This concatenation is an interpretation, not a conversion. 
 5384: 〞end note ][ Example: Here are some examples of valid concatenations: 
 5385: Table 7 〞 String literal concatenations 
 5386: Source Means Source Means Source Means 
 5387: u"a" u"b" u"ab" U"a" U"b" U"ab" L"a" L"b" L"ab" 
 5388: u"a" "b" u"ab" U"a" "b" U"ab" L"a" "b" L"ab" 
 5389: "a" u"b" u"ab" "a" U"b" U"ab" "a" L"b" L"ab" 
 5390: 〞 end example ] 
 5391: ∫ 2.13.4 27 
 5392: 
 5393: c
 5394: . ISO/IEC N2800=08-0310 
 5395: Characters in concatenated strings are kept distinct. 
 5396: [ Example: 
 5397: "\xA" "B" 
 5398: contains the two characters ＊\xA＊ and ＊B＊ after concatenation (and not the single hexadecimal character 
 5399: ＊\xAB＊). 〞end example ] 
 5400: 12 After any necessary concatenation, in translation phase 7 (2.1), ＊\0＊ is appended to every string literal so 
 5401: that programs that scan a string can find its end. 
 5402: 13 Escape sequences in non-raw string literals and universal-character-names in string literals have the same 
 5403: meaning as in character literals (2.13.2), except that the single quote ＊ is representable either by itself or 
 5404: by the escape sequence \＊, and the double quote " shall be preceded by a \. In a narrow string literal, a 
 5405: universal-character-name may map to more than one char element due to multibyte encoding. The size of 
 5406: a char32_t or wide string literal is the total number of escape sequences, universal-character-names, and 
 5407: other characters, plus one for the terminating U＊\0＊ or L＊\0＊. The size of a char16_t string literal is 
 5408: the total number of escape sequences, universal-character-names, and other characters, plus one for each 
 5409: character requiring a surrogate pair, plus one for the terminating u＊\0＊.[ Note: The size of a char16_t 
 5410: string literal is the number of code units, not the number of characters. 〞end note ] Within char32_t and 
 5411: char16_t literals, any universal-character-names shall be within the range 0x0 to 0x10FFFF. The size of a 
 5412: narrow string literal is the total number of escape sequences and other characters, plus at least one for the 
 5413: multibyte encoding of each universal-character-name, plus one for the terminating ＊\0＊. 
 5414: 2.13.5 Boolean literals [lex.bool] 
 5415: boolean-literal: 
 5416: false
 5417: true
 5418: 1 The Boolean literals are the keywords false and true. Such literals have type bool. They are not lvalues. 
 5419: 2.13.6 Pointer literals [lex.nullptr] 
 5420: pointer-literal: 
 5421: nullptr 
 5422: 1 The pointer literal is the keyword nullptr. It is an rvalue of type std::nullptr_t. 
 5423: 2.13.7 User-defined literals [lex.ext] 
 5424: user-defined-literal:
 5425: user-defined-integer-literal
 5426: user-defined-floating-literal
 5427: user-defined-string-literal
 5428: user-defined-character-literal
 5429: user-defined-integer-literal:
 5430: decimal-literal ud-suffix
 5431: octal-literal ud-suffix
 5432: hexadecimal-literal ud-suffix
 5433: user-defined-floating-literal:
 5434: fractional-constant exponent-partopt ud-suffix
 5435: digit-sequence exponent-part ud-suffix
 5436: user-defined-string-literal:
 5437: string-literal ud-suffix
 5438: ∫ 2.13.7 28 
 5439: 
 5440: c
 5441: . ISO/IEC N2800=08-0310 
 5442: user-defined-character-literal:
 5443: character-literal ud-suffix
 5444: ud-suffix:
 5445: identifier
 5446: 1 If a token matches both user-defined-literal and another literal kind, it is treated as the latter. [ Example: 
 5447: 123_km, 1.2LL, "Hello"s are all user-defined-literals, but 12LL is an integer-literal. 〞end example ] 
 5448: 2 A user-defined-literal is treated as a call to a literal operator or literal operator template (13.5.8). To 
 5449: determine the form of this call for a given user-defined-literal L with ud-suffix X, the literal-operator-id 
 5450: whose literal suffix identifier is X is looked up in the context of L using the rules for unqualified name 
 5451: lookup (3.4.1). Let S be the set of declarations found by this lookup. S shall not be empty. 
 5452: 3 If L is a user-defined-integer-literal, let n be the literal without its ud-suffix. If S contains a literal operator 
 5453: with parameter type unsigned long long, the literal L is treated as a call of the form 
 5454: operator "" X (nULL) 
 5455: Otherwise, S shall contain a raw literal operator or a literal operator template (13.5.8) but not both. If S 
 5456: contains a raw literal operator the literal L is treated as a call of the form 
 5457: operator "" X ("n") 
 5458: Otherwise (S contains a literal operator template), L is treated as a call of the form 
 5459: operator "" X <＊c1＊, ＊c2＊, ... ＊ck＊>() 
 5460: where n is the source character sequence c1c2...ck.[ Note: the sequence c1c2...ck can only contain characters 
 5461: from the basic source character set. 〞end note ] 
 5462: 4 If L is a user-defined-floating-literal, let f be the literal without its ud-suffix. If S contains a literal operator 
 5463: with parameter type long double, the literal L is treated as a call of the form 
 5464: operator "" X (fL) 
 5465: Otherwise, S shall contain a raw literal operator or a literal operator template (13.5.8) but not both. If S 
 5466: contains a raw literal operator the literal L is treated as a call of the form 
 5467: operator "" X ("f") 
 5468: Otherwise (S contains a literal operator template), L is treated as a call of the form 
 5469: operator "" X <＊c1＊, ＊c2＊, ... ＊ck＊>() 
 5470: where f is the source character sequence c1c2...ck .[ Note: the sequence c1c2...ck can only contain characters 
 5471: from the basic source character set. 〞end note ] 
 5472: 5 If L is a user-defined-string-literal, let str be the literal without its ud-suffix and let len be the number of 
 5473: characters (or code points) in str (i.e., its length excluding the terminating null character). The literal L is 
 5474: treated as a call of the form 
 5475: operator "" X (str , len) 
 5476: 6 If L is a user-defined-character-literal, let ch be the literal without its ud-suffix. The literal L is treated as 
 5477: a call of the form 
 5478: operator "" X (ch) 
 5479: 7 [ Example: 
 5480: ∫ 2.13.7 29 
 5481: 
 5482: c
 5483: . ISO/IEC N2800=08-0310 
 5484: long double operator "" w(long double);
 5485: std::string operator "" w(const char16_t*, size_t);
 5486: unsigned operator "" w(const char*);
 5487: int main() {
 5488: 1.2w; // calls operator "" w(1.2L)
 5489: u"one"w; // calls operator "" w(u"one", 3)
 5490: 12w; // calls operator "" w("12")
 5491: "two"w; // error: no applicable literal operator
 5492: } 
 5493: 〞end example ] 
 5494: 8 In translation phase 6 (2.1), adjacent string literals are concatenated and user-defined-string-literals are 
 5495: considered string literals for that purpose. During concatenation, ud-suffixes are removed and ignored and 
 5496: the concatenation process occurs as described in 2.13.4. At the end of phase 6, if a string literal is the result 
 5497: of a concatenation involving at lease one user-defined-string-literal, all the participating user-defined-string-
 5498: literals shall have the same ud-suffix and that suffix is applied to the result of the concatenation. 
 5499: 9 [ Example: 
 5500: int main() {
 5501: L"A" "B" "C"x; // OK: same as L"ABC"x
 5502: "P"x "Q" "R"y; // error: two different ud-suffixes
 5503: } 
 5504: 〞end example ] 
 5505: ∫ 2.13.7 30 
 5506: 
 5507: c
 5508: . ISO/IEC N2800=08-0310 
 5509: 3 Basic concepts [basic]
 5510: 1 [ Note: this Clause presents the basic concepts of the C++ language. It explains the difference between an 
 5511: object and a name and how they relate to the notion of an lvalue. It introduces the concepts of a declaration 
 5512: and a definition and presents C++＊s notion of type, scope, linkage, and storage duration. The mechanisms 
 5513: for starting and terminating a program are discussed. Finally, this Clause presents the fundamental types 
 5514: of the language and lists the ways of constructing compound types from these. 〞end note ] 
 5515: 2 [ Note: this Clause does not cover concepts that affect only a single part of the language. Such concepts are 
 5516: discussed in the relevant Clauses. 〞end note ] 
 5517: 3 An entity is a value, object, variable, reference, function, enumerator, type, class member, template, template 
 5518: specialization, namespace, parameter pack, concept, or concept map. 
 5519: 4 A name is a use of an identifier (2.10), operator-function-id (13.5), conversion-function-id (12.3.2), or 
 5520: template-id (14.2) that denotes an entity or label (6.6.4, 6.1). 
 5521: 5 Every name that denotes an entity is introduced by a declaration. Every name that denotes a label is 
 5522: introduced either by a goto statement (6.6.4) or a labeled-statement (6.1). 
 5523: 6 A variable is introduced by the declaration of an object. The variable＊s name denotes the object. 
 5524: 7 Some names denote types, concepts, concept maps, or templates. In general, it is necessary to determine 
 5525: whether a name denotes one of these entities before parsing the program that contains it. The process that 
 5526: determines this is called name lookup (3.4). 
 5527: 8 Two names are the same if 
 5528: 〞 they are identifiers composed of the same character sequence, or 
 5529: 〞 they are operator-function-id s formed with the same operator, or 
 5530: 〞 they are conversion-function-id s formed with the same type, or 
 5531: 〞 they are template-id s that refer to the same class or function (14.4), or 
 5532: 〞 they are the names of literal operators (13.5.8) formed with the same literal suffix identifier. 
 5533: 9 A name used in more than one translation unit can potentially refer to the same entity in these translation 
 5534: units depending on the linkage (3.5) of the name specified in each translation unit. 
 5535: 3.1 Declarations and definitions [basic.def] 
 5536: 1 A declaration (Clause 7) introduces names into a translation unit or redeclares names introduced by previous 
 5537: declarations. A declaration specifies the interpretation and attributes of these names. 
 5538: 2 A declaration is a definition unless it declares a function without specifying the function＊s body (8.4), it 
 5539: contains the extern specifier (7.1.1) or a linkage-specification22 (7.5) and neither an initializer nor a function-
 5540: body, it declares a static data member in a class definition (9.4), it is a class name declaration (9.1), it is 
 5541: an opaque-enum-declaration (7.2), or it is a typedef declaration (7.1.3), a using-declaration (7.3.3), or a 
 5542: using-directive (7.3.4). 
 5543: 22) Appearing inside the braced-enclosed declaration-seq in a linkage-specification does not affect whether a declaration is a 
 5544: definition. 
 5545: ∫ 3.1 31 
 5546: 
 5547: c
 5548: . ISO/IEC N2800=08-0310 
 5549: [ Example: all but one of the following are definitions: 
 5550: int a;
 5551: extern const int c = 1;
 5552: int f(int x) { return x+a; }
 5553: struct S { int a; int b; };
 5554: struct X {
 5555: int x;
 5556: static int y;
 5557: X(): x(0) { }
 5558: };
 5559: int X::y = 1;
 5560: enum { up, down };
 5561: namespace N { int d; }
 5562: namespace N1 = N;
 5563: X anX;
 5564: // defines a 
 5565: // defines c 
 5566: // defines f and defines x 
 5567: // defines S, S::a, and S::b 
 5568: // defines X 
 5569: // defines non-static data member x 
 5570: // declares static data member y 
 5571: // defines a constructor of X 
 5572: // defines X::y 
 5573: // defines up and down 
 5574: // defines N and N::d 
 5575: // defines N1 
 5576: // defines anX 
 5577: whereas these are just declarations: 
 5578: extern int a;
 5579: extern const int c;
 5580: int f(int);
 5581: struct S;
 5582: typedef int Int;
 5583: extern X anotherX;
 5584: using N::d;
 5585: // declares a 
 5586: // declares c 
 5587: // declares f 
 5588: // declares S 
 5589: // declares Int 
 5590: // declares anotherX 
 5591: // declares N::d 
 5592: 〞end example ] 
 5593: 3 [ Note: in some circumstances, C++ implementations implicitly define the default constructor (12.1), copy 
 5594: constructor (12.8), assignment operator (12.8), or destructor (12.4) member functions. [ Example: given 
 5595: #include <string> 
 5596: struct C {
 5597: std::string s; // std::string is the standard library class (Clause 21)
 5598: };
 5599: int main() {
 5600: C a;
 5601: C b = a;
 5602: b = a;
 5603: } 
 5604: the implementation will implicitly define functions to make the definition of C equivalent to 
 5605: struct C {
 5606: std::string s;
 5607: C(): s() { }
 5608: C(const C& x): s(x.s) { }
 5609: C& operator=(const C& x) { s = x.s; return *this; }
 5610: ~C() { }
 5611: }; 
 5612: 〞end example ] 〞end note ] 
 5613: 4 [ Note: a class name can also be implicitly declared by an elaborated-type-specifier (7.1.6.3). 〞end note ] 
 5614: ∫ 3.1 32 
 5615: 
 5616: c
 5617: . ISO/IEC N2800=08-0310 
 5618: 5 A program is ill-formed if the definition of any object gives the object an incomplete type (3.9). 
 5619: 3.2 One definition rule [basic.def.odr] 
 5620: 1 No translation unit shall contain more than one definition of any variable, function, class type, concept, 
 5621: concept map, enumeration type, or template. 
 5622: 2 An expression is potentially evaluated unless it is an unevaluated operand (Clause 5) or a subexpression 
 5623: thereof. An object or non-overloaded function whose name appears as a potentially-evaluated expression 
 5624: is used unless it is an object that satisfies the requirements for appearing in a constant expression (5.19) 
 5625: and the lvalue-to-rvalue conversion (4.1) is immediately applied. A virtual member function is used if it is 
 5626: not pure. An overloaded function is used if it is selected by overload resolution when referred to from a 
 5627: potentially-evaluated expression. [ Note: this covers calls to named functions (5.2.2), operator overloading 
 5628: (Clause 13), user-defined conversions (12.3.2), allocation function for placement new (5.3.4), as well as non-
 5629: default initialization (8.5). A copy constructor is used even if the call is actually elided by the implementation. 
 5630: 〞end note ] An allocation or deallocation function for a class is used by a new expression appearing in a 
 5631: potentially-evaluated expression as specified in 5.3.4 and 12.5. A deallocation function for a class is used 
 5632: by a delete expression appearing in a potentially-evaluated expression as specified in 5.3.5 and 12.5. A 
 5633: non-placement allocation or deallocation function for a class is used by the definition of a constructor of that 
 5634: class. A non-placement deallocation function for a class is used by the definition of the destructor of that 
 5635: class, or by being selected by the lookup at the point of definition of a virtual destructor (12.4).23 A copy-
 5636: assignment function for a class is used by an implicitly-defined copy-assignment function for another class 
 5637: as specified in 12.8. A default constructor for a class is used by default initialization or value initialization 
 5638: as specified in 8.5. A constructor for a class is used as specified in 8.5. A destructor for a class is used as 
 5639: specified in 12.4. 
 5640: 3 Every program shall contain exactly one definition of every non-inline function or object that is used in that 
 5641: program; no diagnostic required. The definition can appear explicitly in the program, it can be found in the 
 5642: standard or a user-defined library, or (when appropriate) it is implicitly defined (see 12.1, 12.4 and 12.8). 
 5643: An inline function shall be defined in every translation unit in which it is used. 
 5644: 4 Exactly one definition of a class is required in a translation unit if the class is used in a way that requires the 
 5645: class type to be complete. [ Example: the following complete translation unit is well-formed, even though it 
 5646: never defines X: 
 5647: struct X; // declare X as a struct type
 5648: struct X* x1; // use X in pointer formation
 5649: X* x2; // use X in pointer formation
 5650: 〞end example ][ Note: the rules for declarations and expressions describe in which contexts complete class 
 5651: types are required. A class type T must be complete if: 
 5652: 〞 an object of type T is defined (3.1), or 
 5653: 〞 a non-static class data member of type T is declared (9.2), or 
 5654: 〞 T is used as the object type or array element type in a new-expression (5.3.4), or 
 5655: 〞 an lvalue-to-rvalue conversion is applied to an lvalue referring to an object of type T (4.1), or 
 5656: 〞 an expression is converted (either implicitly or explicitly) to type T (Clause 4, 5.2.3, 5.2.7, 5.2.9, 5.4), 
 5657: or 
 5658: 23) An implementation is not required to call allocation and deallocation functions from constructors or destructors; however, 
 5659: this is a permissible implementation technique. 
 5660: ∫ 3.2 33 
 5661: 
 5662: c
 5663: . ISO/IEC N2800=08-0310 
 5664: 〞 an expression that is not a null pointer constant, and has type other than void*, is converted to the 
 5665: type pointer to T or reference to T using an implicit conversion (Clause 4), a dynamic_cast (5.2.7) or 
 5666: a static_cast (5.2.9), or 
 5667: 〞 a class member access operator is applied to an expression of type T (5.2.5), or 
 5668: 〞 the typeid operator (5.2.8) or the sizeof operator (5.3.3) is applied to an operand of type T, or 
 5669: 〞 a function with a return type or argument type of type T is defined (3.1) or called (5.2.2), or 
 5670: 〞 a class with a base class of type T is defined (10), or 
 5671: 〞 an lvalue of type T is assigned to (5.17), or 
 5672: 〞 the type T is the subject of an alignof expression (5.3.6). 
 5673: 〞end note ] 
 5674: 5 There can be more than one definition of a class type (Clause 9), concept (14.9), concept map (14.9.2), 
 5675: enumeration type (7.2), inline function with external linkage (7.1.2), class template (Clause 14), non-static 
 5676: function template (14.5.6), static data member of a class template (14.5.1.3), member function of a class 
 5677: template (14.5.1.1), or template specialization for which some template parameters are not specified (14.7, 
 5678: 14.5.5) in a program provided that each definition appears in a different translation unit, and provided 
 5679: the definitions satisfy the following requirements. Given such an entity named D defined in more than one 
 5680: translation unit, then 
 5681: 〞 each definition of D shall consist of the same sequence of tokens; and 
 5682: 〞 in each definition of D, corresponding names, looked up according to 3.4, shall refer to an entity defined 
 5683: within the definition of D, or shall refer to the same entity, after overload resolution (13.3) and after 
 5684: matching of partial template specialization (14.8.3), except that a name can refer to a const object 
 5685: with internal or no linkage if the object has the same literal type in all definitions of D, and the object 
 5686: is initialized with a constant expression (5.19), and the value (but not the address) of the object is 
 5687: used, and the object has the same value in all definitions of D; and 
 5688: 〞 in each definition of D, the overloaded operators referred to, the implicit calls to conversion functions, 
 5689: constructors, operator new functions and operator delete functions, shall refer to the same function, 
 5690: or to a function defined within the definition of D; and 
 5691: 〞 in each definition of D, a default argument used by an (implicit or explicit) function call is treated as 
 5692: if its token sequence were present in the definition of D; that is, the default argument is subject to 
 5693: the three requirements described above (and, if the default argument has sub-expressions with default 
 5694: arguments, this requirement applies recursively).24 
 5695: 〞 if D is a class with an implicitly-declared constructor (12.1), it is as if the constructor was implicitly 
 5696: defined in every translation unit where it is used, and the implicit definition in every translation unit 
 5697: shall call the same constructor for a base class or a class member of D.[ Example: 
 5698: //translation unit 1: 
 5699: struct X {
 5700: X(int);
 5701: X(int, int);
 5702: }; 
 5703: X::X(int = 0) { } 
 5704: class D: public X { }; 
 5705: D d2; // X(int) called by D() 
 5706: 24) 8.3.6 describes how default argument names are looked up. 
 5707: ∫ 3.2 34 
 5708: 
 5709: c
 5710: . ISO/IEC N2800=08-0310 
 5711: //translation unit 2: 
 5712: struct X {
 5713: X(int);
 5714: X(int, int);
 5715: };
 5716: X::X(int = 0, int = 0) { }
 5717: class D: public X { }; // X(int, int) called by D();
 5718: // D()＊s implicit definition 
 5719: // violates the ODR 
 5720: 〞end example ] 
 5721: If D is a template and is defined in more than one translation unit, then the last four requirements from the 
 5722: list above shall apply to names from the template＊s enclosing scope used in the template definition (14.6.3), 
 5723: and also to dependent names at the point of instantiation (14.6.2). If the definitions of D satisfy all these 
 5724: requirements, then the program shall behave as if there were a single definition of D. If the definitions of D 
 5725: do not satisfy these requirements, then the behavior is undefined. 
 5726: 3.3 Declarative regions and scopes [basic.scope] 
 5727: 1 Every name isintroduced in some portion of program text called a declarative region, which is the largest part 
 5728: of the program in which that name is valid, that is, in which that name may be used as an unqualified name 
 5729: to refer to the same entity. In general, each particular name is valid only within some possibly discontiguous 
 5730: portion of program text called its scope. To determine the scope of a declaration, it is sometimes convenient 
 5731: to refer to the potential scope of a declaration. The scope of a declaration is the same as its potential scope 
 5732: unless the potential scope contains another declaration of the same name. In that case, the potential scope 
 5733: of the declaration in the inner (contained) declarative region is excluded from the scope of the declaration 
 5734: in the outer (containing) declarative region. 
 5735: 2 [ Example: in 
 5736: int j = 24; 
 5737: int main() {
 5738: int i = j, j;
 5739: j = 42;
 5740: } 
 5741: the identifier j is declared twice as a name (and used twice). The declarative region of the first j includes 
 5742: the entire example. The potential scope of the first j begins immediately after that j and extends to the 
 5743: end of the program, but its (actual) scope excludes the text between the , and the }. The declarative region 
 5744: of the second declaration of j (the j immediately before the semicolon) includes all the text between { and 
 5745: }, but its potential scope excludes the declaration of i. The scope of the second declaration of j is the same 
 5746: as its potential scope. 〞end example ] 
 5747: 3 The names declared by a declaration are introduced into the scope in which the declaration occurs, except 
 5748: that the presence of a friend specifier (11.4), certain uses of the elaborated-type-specifier (7.1.6.3), and 
 5749: using-directives (7.3.4) alter this general behavior. 
 5750: 4 Given a set of declarations in a single declarative region, each of which specifies the same unqualified name, 
 5751: 〞 they shall all refer to the same entity, or all refer to functions and function templates; or 
 5752: 〞 exactly one declaration shall declare a class name or enumeration name that is not a typedef name 
 5753: and the other declarations shall all refer to the same object or enumerator, or all refer to functions 
 5754: and function templates; in this case the class name or enumeration name is hidden (3.3.10). [ Note: a 
 5755: ∫ 3.3 35 
 5756: 
 5757: c
 5758: . ISO/IEC N2800=08-0310 
 5759: namespace name or a class template name must be unique in its declarative region (7.3.2, Clause 14). 
 5760: 〞 end note ] 
 5761: [ Note: these restrictions apply to the declarative region into which a name is introduced, which is not neces-
 5762: sarily the same as the region in which the declaration occurs. In particular, elaborated-type-specifiers (7.1.6.3) 
 5763: and friend declarations (11.4) may introduce a (possibly not visible) name into an enclosing namespace; these 
 5764: restrictions apply to that region. Local extern declarations (3.5) may introduce a name into the declarative 
 5765: region where the declaration appears and also introduce a (possibly not visible) name into an enclosing 
 5766: namespace; these restrictions apply to both regions. 〞end note ] 
 5767: 5 [ Note: the name lookup rules are summarized in 3.4. 〞end note ] 
 5768: 3.3.1 Point of declaration [basic.scope.pdecl] 
 5769: 1 The point of declaration for a name is immediately after its complete declarator (Clause 8) and before its 
 5770: initializer (if any), except as noted below. [ Example: 
 5771: int x = 12;
 5772: { int x = x; }
 5773: Here the second x is initialized with its own (indeterminate) value. 〞end example ] 
 5774: 2 [ Note: a nonlocal name remains visible up to the point of declaration of the local name that hides 
 5775: it.[ Example: 
 5776: const int i = 2;
 5777: { int i[i]; }
 5778: declares a local array of two integers. 〞end example ] 〞 end note ] 
 5779: 3 The point of declaration for a class first declared by a class-specifier is immediately after the identifier or 
 5780: simple-template-id (if any) in its class-head (Clause 9). The point of declaration for an enumeration is imme-
 5781: diately after the identifier (if any) in either its enum-specifier (7.2) or its first opaque-enum-declaration (7.2), 
 5782: whichever comes first. The point of declaration of a template alias immediately follows the identifier for the 
 5783: alias being declared. 
 5784: 4 The point of declaration for an enumerator is immediately after its enumerator-definition.[ Example: 
 5785: const int x = 12;
 5786: { enum { x = x }; }
 5787: Here, the enumerator x is initialized with the value of the constant x, namely 12. 〞 end example ] 
 5788: 5 After the point of declaration of a class member, the member name can be looked up in the scope of its 
 5789: class. [ Note: this is true even if the class is an incomplete class. For example, 
 5790: struct X {
 5791: enum E { z = 16 };
 5792: int b[X::z]; // OK
 5793: }; 
 5794: 〞end note ] 
 5795: 6 The point of declaration of a class first declared in an elaborated-type-specifier is as follows: 
 5796: 〞 for a declaraton of the form 
 5797: class-key identifier attribute-specifieropt ; 
 5798: ∫ 3.3.1 36 
 5799: 
 5800: c
 5801: . ISO/IEC N2800=08-0310 
 5802: the identifier is declared to be a class-name in the scope that contains the declaration, otherwise 
 5803: 〞 for an elaborated-type-specifier of the form 
 5804: class-key identifier 
 5805: if the elaborated-type-specifier is used in the decl-specifier-seq or parameter-declaration-clause of a 
 5806: function defined in namespace scope, the identifier is declared as a class-name in the namespace that 
 5807: contains the declaration; otherwise, except as a friend declaration, the identifier is declared in the 
 5808: smallest non-class, non-function-prototype scope that contains the declaration. [ Note: these rules also 
 5809: apply within templates. 〞end note ][ Note: other forms of elaborated-type-specifier do not declare a 
 5810: new name, and therefore must refer to an existing type-name. See 3.4.4 and 7.1.6.3. 〞end note ] 
 5811: 7 The point of declaration for an injected-class-name (9) is immediately following the opening brace of the 
 5812: class definition. 
 5813: 8 The point of declaration for a function-local predefined variable (8.4) is immediately before the function-body 
 5814: of a function definition. 
 5815: 9 [ Note: friend declarations refer to functions or classes that are members of the nearest enclosing namespace, 
 5816: but they do not introduce new names into that namespace (7.3.1.2). Function declarations at block scope 
 5817: and object declarations with the extern specifier at block scope refer to declarations that are members of 
 5818: an enclosing namespace, but they do not introduce new names into that scope. 〞end note ] 
 5819: 10 The point of declaration for a concept (14.9) is immediately after the identifier in the concept-definition. 
 5820: The point of declaration for a concept map (14.9.2) is immediately after the concept-id in the concept-map-
 5821: definition. 
 5822: 11 The point of declaration for a template requirement (14.10.1) is immediately after the corresponding require-
 5823: ment in a requires-clause or the constrained-template-parameter in a template-parameter-list. The point of 
 5824: declaration of an implied template requirement (14.10.1.2) is the point of declaration of the template re-
 5825: quirement from which it was implied or immediately after the declaration of the entity from which the 
 5826: requirement was implied. 
 5827: 12 The point of declaration for the identifier in a concept-instance-alias-def is immediately after the concept-id 
 5828: of its requirement or refinement-specifier. 
 5829: 13 [ Note: for point of instantiation of a template, see 14.6.4.1. 〞 end note ] 
 5830: 3.3.2 Local scope [basic.scope.local] 
 5831: 1 A name declared in a block (6.3) is local to that block. Its potential scope begins at its point of declara-
 5832: tion (3.3.1) and ends at the end of its declarative region. 
 5833: 2 The potential scope of a function parameter name (including one appearing in a lambda-parameter-declaration-
 5834: clause) or of a function-local predefined variable in a function definition (8.4) begins atits point of declaration. 
 5835: If the function has a function-try-block the potential scope of a parameter or of a function-local predefined 
 5836: variable ends at the end of the last associated handler, otherwise it ends at the end of the outermost block 
 5837: of the function definition. A parameter name shall not be redeclared in the outermost block of the function 
 5838: definition nor in the outermost block of any handler associated with a function-try-block. 
 5839: 3 The name in a catch exception-declaration islocal to the handler and shall not be redeclared in the outermost 
 5840: block of the handler. 
 5841: 4 Names declared in the for-init-statement, the for-range-declaration, and in the condition of if, while, for, 
 5842: and switch statements are local to the if, while, for, or switch statement (including the controlled 
 5843: ∫ 3.3.2 37 
 5844: 
 5845: c
 5846: . ISO/IEC N2800=08-0310 
 5847: statement), and shall not be redeclared in a subsequent condition of that statement nor in the outermost 
 5848: block (or, for the if statement, any of the outermost blocks) of the controlled statement; see 6.4. 
 5849: 3.3.3 Function prototype scope [basic.scope.proto] 
 5850: 1 In a function declaration, or in any function declarator except the declarator of a function definition (8.4), 
 5851: names of parameters (if supplied) have function prototype scope, which terminates at the end of the nearest 
 5852: enclosing function declarator. 
 5853: 3.3.4 Function scope [basic.funscope] 
 5854: 1 Labels (6.1) have function scope and may be used anywhere in the function in which they are declared. Only 
 5855: labels have function scope. 
 5856: 3.3.5 Namespace scope [basic.scope.namespace] 
 5857: 1 The declarative region of a namespace-definition is its namespace-body. The potential scope denoted by 
 5858: an original-namespace-name is the concatenation of the declarative regions established by each of the 
 5859: namespace-definitions in the same declarative region with that original-namespace-name. Entities declared 
 5860: in a namespace-body are said to be members of the namespace, and names introduced by these declarations 
 5861: into the declarative region of the namespace are said to be member names of the namespace. A namespace 
 5862: member name has namespace scope. Its potential scope includes its namespace from the name＊s point of 
 5863: declaration (3.3.1) onwards; and for each using-directive (7.3.4) that nominates the member＊s namespace, 
 5864: the member＊s potential scope includes that portion of the potential scope of the using-directive that follows 
 5865: the member＊s point of declaration. [ Example: 
 5866: namespace N {
 5867: int i;
 5868: int g(int a) { return a; }
 5869: int j();
 5870: void q();
 5871: }
 5872: namespace { int l=1; }
 5873: // the potential scope of l is from its point of declaration
 5874: // to the end of the translation unit
 5875: namespace N { 
 5876: int g(char a) { 
 5877: return l+a; 
 5878: } 
 5879: int i; 
 5880: int j(); 
 5881: int j() { 
 5882: return g(i); 
 5883: } 
 5884: int q(); 
 5885: } 
 5886: 〞end example ] 
 5887: // overloads N::g(int) 
 5888: // l is from unnamed namespace 
 5889: // error: duplicate definition 
 5890: // OK: duplicate function declaration 
 5891: // OK: definition of N::j() 
 5892: // calls N::g(int) 
 5893: // error: different return type 
 5894: 2 A namespace member can also be referred to after the :: scope resolution operator (5.1) applied to the name 
 5895: of its namespace or the name of a namespace which nominates the member＊s namespace in a using-directive; 
 5896: see 3.4.3.2. 
 5897: ∫ 3.3.5 38 
 5898: 
 5899: c
 5900: . ISO/IEC N2800=08-0310 
 5901: 3 The outermost declarative region of a translation unit is also a namespace, called the global namespace. A 
 5902: name declared in the global namespace has global namespace scope (also called global scope). The potential 
 5903: scope of such a name begins at its point of declaration (3.3.1) and ends at the end of the translation unit 
 5904: that is its declarative region. Names with global namespace scope are said to be global. 
 5905: 3.3.6 Class scope [basic.scope.class] 
 5906: 1 The following rules describe the scope of names declared in classes. 
 5907: 1) The potential scope of a name declared in a class consists not only of the declarative region following 
 5908: the name＊s point of declaration, but also of all function bodies, brace-or-equal-initializers of non-static 
 5909: data members, and default arguments in that class (including such things in nested classes). 
 5910: 2) A name N used in a class S shall refer to the same declaration in its context and when re-evaluated in 
 5911: the completed scope of S. No diagnostic is required for a violation of this rule. 
 5912: 3) If reordering member declarations in a class yields an alternate valid program under (1) and (2), the 
 5913: program is ill-formed, no diagnostic is required. 
 5914: 4) A name declared within a member function hides a declaration of the same name whose scope extends 
 5915: to or past the end of the member function＊s class. 
 5916: 5) The potential scope of a declaration that extends to or past the end of a class definition also ex-
 5917: tends to the regions defined by its member definitions, even if the members are defined lexically 
 5918: outside the class (this includes static data member definitions, nested class definitions, member func-
 5919: tion definitions (including the member function body and any portion of the declarator part of such 
 5920: definitions which follows the declarator-id, including a parameter-declaration-clause and any default 
 5921: arguments (8.3.6).[ Example: 
 5922: typedef int c;
 5923: enum { i = 1 };
 5924: class X {
 5925: char v[i]; // error: i refers to ::i
 5926: // but when reevaluated is X::i
 5927: int f() { return sizeof(c); } // OK: X::c
 5928: char c;
 5929: enum { i = 2 };
 5930: }; 
 5931: typedef char* T;
 5932: struct Y {
 5933: T a; // error: T refers to ::T
 5934: // but when reevaluated is Y::T
 5935: typedef long T;
 5936: T b;
 5937: }; 
 5938: typedef int I; 
 5939: class D { 
 5940: typedef I I; // error, even though no reordering involved 
 5941: }; 
 5942: 〞end example ] 
 5943: 2 The name of a class member shall only be used as follows: 
 5944: ∫ 3.3.6 39 
 5945: 
 5946: c
 5947: . ISO/IEC N2800=08-0310 
 5948: 〞 in the scope of its class (as described above) or a class derived (Clause 10) from its class, 
 5949: 〞 after the . operator applied to an expression of the type of its class (5.2.5) or a class derived from its 
 5950: class, 
 5951: 〞 after the -> operator applied to a pointer to an object of its class (5.2.5) or a class derived from its 
 5952: class, 
 5953: 〞 after the :: scope resolution operator (5.1) applied to the name of its class or a class derived from its 
 5954: class. 
 5955: 3.3.7 Concept scope [basic.scope.concept] 
 5956: 1 The following rules describe the scope of names declared in concepts and concept maps. 
 5957: 1) The potential scope of a name declared in a concept or concept map consists not only of the declarative 
 5958: region following the name＊s point of declaration, but also of all associated function bodies in that 
 5959: concept or concept map. 
 5960: 2) A name N used in a concept or concept map S shall refer to the same declaration in its context and 
 5961: when re-evaluated in the completed scope of S. No diagnostic is required for a violation of this rule. 
 5962: 3) If reordering declarations in a concept or concept map yields an alternate valid program under (1), the 
 5963: program is ill-formed, no diagnostic is required. 
 5964: 4) A name declared within an associated function definition hides a declaration of the same name whose 
 5965: scope extends to or past the end of the associated function＊s concept or concept map. 
 5966: 3.3.8 Requirements scope [basic.scope.req] 
 5967: 1 A template requirement has requirements scope. Its potential scope begins immediately after its concept-id 
 5968: and terminates at the end of the constrained template (14.10) or constrained member (9.2). 
 5969: 2 In a constrained context (14.10), the names of all associated functions inside the concepts named by the 
 5970: concept requirements in the template＊s requirements are declared in the same scope as the constrained 
 5971: template＊s template parameters. Each of these names refers to one or more members of the concept map 
 5972: archetypes (14.10.2) that correspond to the concept requirements. [ Note: The declaration of these names 
 5973: in the scope of the template parameters does not establish archetypes unless name lookup finds these 
 5974: declarations. 〞end note ][ Example: 
 5975: concept A<class B> {
 5976: void g(const B&);
 5977: }
 5978: template<class T, class U>
 5979: requires A<U>
 5980: void f(T & x, U & y) {
 5981: g(y); // binds to A<U0>0::g(const U. &)
 5982: g(x); // error: no overload of g takes T. values.
 5983: }
 5984: ∫ 3.3.8 40 
 5985: 
 5986: c. ISO/IEC N2800=08-0310 
 5987: 〞 end example ] 
 5988: 3.3.9 Enumeration scope [basic.scope.enum] 
 5989: 1 The name of a scoped enumerator (7.2) has enumeration scope. 
 5990: declaration and terminates at the end of the enum-specifier. 
 5991: Its potential scope begins at its point of 
 5992: 3.3.10 Name hiding [basic.scope.hiding] 
 5993: 1 A name can be hidden by an explicit declaration of that same name in a nested declarative region, more 
 5994: refined concept (14.9.3), or derived class (10.2). 
 5995: 2 A class name (9.1) or enumeration name (7.2) can be hidden by the name of an object, function, or enu-
 5996: merator declared in the same scope. If a class or enumeration name and an object, function, or enumerator 
 5997: are declared in the same scope (in any order) with the same name, the class or enumeration name is hidden 
 5998: wherever the object, function, or enumerator name is visible. 
 5999: 3 In a member function definition, the declaration of a local name hides the declaration of a member of the 
 6000: class with the same name; see 3.3.6. The declaration of a member in a derived class (Clause 10) hides the 
 6001: declaration of a member of a base class of the same name; see 10.2. 
 6002: 4 During the lookup of a name qualified by a namespace name, declarations that would otherwise be made 
 6003: visible by a using-directive can be hidden by declarations with the same name in the namespace containing 
 6004: the using-directive; see (3.4.3.2). 
 6005: 5 If a name is in scope and is not hidden it is said to be visible. 
 6006: 6 In an associated function definition, the declaration of a local name hides the declaration of a member of 
 6007: the concept or concept map with the same name; see 3.3.7. 
 6008: 3.4 Name lookup [basic.lookup] 
 6009: 1 The name lookup rules apply uniformly to all names (including typedef-names (7.1.3), namespace-names (7.3), 
 6010: concept-names (14.9), concept-map-names (14.9.2), and class-names (9.1)) wherever the grammar allows 
 6011: such names in the context discussed by a particular rule. Name lookup associates the use of a name with a 
 6012: declaration (3.1) of that name. Name lookup shall find an unambiguous declaration for the name (see 10.2). 
 6013: Name lookup may associate more than one declaration with a name if it finds the name to be a function 
 6014: name; the declarations are said to form a set of overloaded functions (13.1). Overload resolution (13.3) takes 
 6015: place after name lookup has succeeded. The access rules (Clause 11) are considered only once name lookup 
 6016: and function overload resolution (if applicable) have succeeded. Only after name lookup, function overload 
 6017: resolution (if applicable) and access checking have succeeded are the attributes introduced by the name＊s 
 6018: declaration used further in expression processing (Clause 5). 
 6019: 2 A name ※looked up in the context of an expression§ is looked up as an unqualified name in the scope where 
 6020: the expression is found. 
 6021: 3 The injected-class-name of a class (Clause 9) is also considered to be a member of that class for the purposes 
 6022: of name hiding and lookup. 
 6023: 4 [ Note: 3.5 discusses linkage issues. The notions of scope, point of declaration and name hiding are discussed 
 6024: in 3.3. 〞end note ] 
 6025: 3.4.1 Unqualified name lookup [basic.lookup.unqual] 
 6026: 1 In all the cases listed in 3.4.1, the scopes are searched for a declaration in the order listed in each of the 
 6027: respective categories; name lookup ends as soon as a declaration is found for the name. If no declaration is 
 6028: found, the program is ill-formed. 
 6029: ∫ 3.4.1 41 
 6030: 
 6031: c
 6032: . ISO/IEC N2800=08-0310 
 6033: 2 The declarations from the namespace nominated by a using-directive become visible in a namespace enclosing 
 6034: the using-directive; see 7.3.4. For the purpose of the unqualified name lookup rules described in 3.4.1, the 
 6035: declarations from the namespace nominated by the using-directive are considered members of that enclosing 
 6036: namespace. 
 6037: 3 The lookup for an unqualified name used as the postfix-expression of a function call is described in 3.4.2. 
 6038: [ Note: for purposes of determining (during parsing) whether an expression is a postfix-expression for a func-
 6039: tion call, the usual name lookup rules apply. The rules in 3.4.2 have no effect on the syntactic interpretation 
 6040: of an expression. For example, 
 6041: typedef int f;
 6042: namespace N {
 6043: struct A {
 6044: friend void f(A &);
 6045: operator int();
 6046: void g(A a) {
 6047: int i = f(a); // f is the typedef, not the friend
 6048: // function: equivalent to int(a)
 6049: }
 6050: };
 6051: }
 6052: Because the expression is not a function call, the argument-dependent name lookup (3.4.2) does not apply 
 6053: and the friend function f is not found. 〞 end note ] 
 6054: 4 A name used in global scope, outside of any function, class or user-declared namespace, shall be declared 
 6055: before its use in global scope. 
 6056: 5 A name used in a user-declared namespace outside of the definition of any function or class shall be declared 
 6057: before its use in that namespace or before its use in a namespace enclosing its namespace. 
 6058: 6 A name used in the definition of a function following the function＊s declarator-id25 that is a member of 
 6059: namespace N (where, only for the purpose of exposition, N could represent the global scope) shall be declared 
 6060: before its use in the block in which it is used or in one of its enclosing blocks (6.3) or, shall be declared 
 6061: before its use in namespace N or, if N is a nested namespace, shall be declared before its use in one of N＊s 
 6062: enclosing namespaces. [ Example: 
 6063: namespace A {
 6064: namespace N {
 6065: void f();
 6066: }
 6067: }
 6068: void A::N::f() {
 6069: i = 5;
 6070: // The following scopes are searched for a declaration of i:
 6071: // 1) outermost block scope of A::N::f, before the use of i
 6072: // 2) scope of namespace N
 6073: // 3) scope of namespace A
 6074: // 4) global scope, before the definition of A::N::f
 6075: } 
 6076: 〞end example ] 
 6077: 25) This refers to unqualified names that occur, for instance, in a type or default argument expression in the parameter-
 6078: declaration-clause or used in the function body. 
 6079: ∫ 3.4.1 42 
 6080: 
 6081: c
 6082: . ISO/IEC N2800=08-0310 
 6083: 7 A name used in the definition of a class X outside of a member function body or nested class definition26 
 6084: shall be declared in one of the following ways: 
 6085: 〞 before its use in class X or be a member of a base class of X (10.2), or 
 6086: 〞 if X is a nested class of class Y (9.7), before the definition of X in Y, or shall be a member of a base 
 6087: class of Y (this lookup applies in turn to Y ＊s enclosing classes, starting with the innermost enclosing 
 6088: class),27 or 
 6089: 〞 if X is a local class (9.8) or is a nested class of a local class, before the definition of class X in a block 
 6090: enclosing the definition of class X, or 
 6091: 〞 if X is a member of namespace N, or is a nested class of a class that is a member of N, or is a local class 
 6092: or a nested class within a local class of a function that is a member of N, before the definition of class 
 6093: X in namespace N or in one of N ＊s enclosing namespaces. 
 6094: [ Example: 
 6095: namespace M {
 6096: class B { };
 6097: }
 6098: namespace N {
 6099: class Y : public M::B {
 6100: class X {
 6101: int a[i];
 6102: };
 6103: };
 6104: }
 6105: // The following scopes are searched for a declaration of i:
 6106: // 1) scope of class N::Y::X, before the use of i
 6107: // 2) scope of class N::Y, before the definition of N::Y::X
 6108: // 3) scope of N::Y＊s base class M::B
 6109: // 4) scope of namespace N, before the definition of N::Y
 6110: // 5) global scope, before the definition of N
 6111: 〞end example ][ Note: when looking for a prior declaration of a class or function introduced by a friend 
 6112: declaration, scopes outside of the innermost enclosing namespace scope are not considered; see 7.3.1.2. 〞 
 6113: end note ][ Note: 3.3.6 further describes the restrictions on the use of names in a class definition. 9.7 further 
 6114: describes the restrictions on the use of names in nested class definitions. 9.8 further describes the restrictions 
 6115: on the use of names in local class definitions. 〞end note ] 
 6116: 8 A name used in the definition of a member function (9.3) of class X following the function＊s declarator-id 28 
 6117: or in the brace-or-equal-initializer of a non-static data member (9.2) of class X shall be declared in one of 
 6118: the following ways: 
 6119: 〞 before its use in the block in which it is used or in an enclosing block (6.3), or 
 6120: 〞 shall be a member of class X or be a member of a base class of X (10.2), or 
 6121: 26) This refers to unqualified names following the class name; such a name may be used in the base-clause or may be used in 
 6122: the class definition. 
 6123: 27) This lookup applies whether the definition of X is nested within Y＊s definition or whether X＊s definition appears in a 
 6124: namespace scope enclosing Y ＊s definition (9.7). 
 6125: 28) That is, an unqualified name that occurs, for instance, in a type or default argument expression in the parameter-
 6126: declaration-clause or in the function body. 
 6127: ∫ 3.4.1 43 
 6128: 
 6129: c
 6130: . ISO/IEC N2800=08-0310 
 6131: 〞 if X is a nested class of class Y (9.7), shall be a member of Y, or shall be a member of a base class of Y 
 6132: (this lookup applies in turn to Y＊s enclosing classes, starting with the innermost enclosing class),29 or 
 6133: 〞 if X is a local class (9.8) or is a nested class of a local class, before the definition of class X in a block 
 6134: enclosing the definition of class X, or 
 6135: 〞 if X is a member of namespace N, or is a nested class of a class that is a member of N, or is a local class 
 6136: or a nested class within a local class of a function that is a member of N, before the use of the name, 
 6137: in namespace N or in one of N ＊s enclosing namespaces. 
 6138: [ Example: 
 6139: class B { };
 6140: namespace M {
 6141: namespace N {
 6142: class X : public B {
 6143: void f();
 6144: };
 6145: }
 6146: }
 6147: void M::N::X::f() {
 6148: i = 16;
 6149: }
 6150: // The following scopes are searched for a declaration of i:
 6151: // 1) outermost block scope of M::N::X::f, before the use of i
 6152: // 2) scope of class M::N::X
 6153: // 3) scope of M::N::X＊s base class B
 6154: // 4) scope of namespace M::N
 6155: // 5) scope of namespace M
 6156: // 6) global scope, before the definition of M::N::X::f
 6157: 〞end example ][ Note: 9.3 and 9.4 further describe the restrictions on the use of names in member function 
 6158: definitions. 9.7 further describes the restrictions on the use of names in the scope of nested classes. 9.8 
 6159: further describes the restrictions on the use of names in local class definitions. 〞end note ] 
 6160: 9 Name lookup for a name used in the definition of a friend function (11.4) defined inline in the class granting 
 6161: friendship shall proceed as described for lookup in member function definitions. If the friend function is 
 6162: not defined in the class granting friendship, name lookup in the friend function definition shall proceed as 
 6163: described for lookup in namespace member function definitions. 
 6164: 10 In a friend declaration naming a member function, a name used in the function declarator and not part 
 6165: of a template-argument in a template-id is first looked up in the scope of the member function＊s class. If it 
 6166: is not found, or if the name is part of a template-argument in a template-id, the look up is as described for 
 6167: unqualified names in the definition of the class granting friendship. [ Example: 
 6168: struct A {
 6169: typedef int AT;
 6170: void f1(AT);
 6171: void f2(float);
 6172: }; 
 6173: struct B {
 6174: typedef float BT;
 6175: friend void A::f1(AT); // parameter type is A::AT
 6176: 29) This lookup applies whether the member function is defined within the definition of class X or whether the member function 
 6177: is defined in a namespace scope enclosing X＊s definition. 
 6178: ∫ 3.4.1 44 
 6179: 
 6180: c
 6181: . ISO/IEC N2800=08-0310 
 6182: friend void A::f2(BT); // parameter type is B::BT
 6183: };
 6184: 〞end example ] 
 6185: 11 During the lookup for a name used as a default argument (8.3.6) in a function parameter-declaration-clause 
 6186: or used in the expression of a mem-initializer for a constructor (12.6.2), the function parameter names are 
 6187: visible and hide the names of entities declared in the block, class or namespace scopes containing the function 
 6188: declaration. [ Note: 8.3.6 further describes the restrictions on the use of names in default arguments. 12.6.2 
 6189: further describes the restrictions on the use of names in a ctor-initializer. 〞end note ] 
 6190: 12 During thelookup of a name used in the constant-expression of an enumerator-definition, previously declared 
 6191: enumerators of the enumeration are visible and hide the names of entities declared in the block, class, or 
 6192: namespace scopes containing the enum-specifier. 
 6193: 13 A name used in the definition of a static data member of class X (9.4.2) (after the qualified-id of the static 
 6194: member) is looked up as if the name was used in a member function of X.[ Note: 9.4.2 further describes the 
 6195: restrictions on the use of names in the definition of a static data member. 〞end note ] 
 6196: 14 If a variable member of a namespace is defined outside of the scope of its namespace then any name used in 
 6197: the definition of the variable member (after the declarator-id) is looked up as if the definition of the variable 
 6198: member occurred in its namespace. [ Example: 
 6199: namespace N {
 6200: int i = 4;
 6201: extern int j;
 6202: } 
 6203: int i = 2; 
 6204: int N::j = i; // N::j == 4 
 6205: 〞end example ] 
 6206: 15 A name used in the handler for a function-try-block (Clause 15) is looked up as if the name was used in 
 6207: the outermost block of the function definition. In particular, the function parameter names shall not be 
 6208: redeclared in the exception-declaration nor in the outermost block of a handler for the function-try-block. 
 6209: Names declared in the outermost block of the function definition are not found when looked up in the scope 
 6210: of a handler for the function-try-block.[ Note: but function parameter names are found. 〞 end note ] 
 6211: 16 A name used in the definition of a concept or concept map X outside of an associated function body shall 
 6212: be declared in one of the following ways: 
 6213: 〞 before its use in the concept or concept map X or be a member of a less refined concept of X, or 
 6214: 〞 if X is a member of namespace N, before the definition of concept or concept map X in namespace N or 
 6215: in one of N＊s enclosing namespaces. 
 6216: [ Example: 
 6217: typedef int result_type; 
 6218: concept C<class F, class T1> {
 6219: result_type operator() (F&, T1);
 6220: typename result_type; // error result_type used before declared
 6221: } 
 6222: 〞end example ] 
 6223: ∫ 3.4.1 45 
 6224: 
 6225: c
 6226: . ISO/IEC N2800=08-0310 
 6227: 17 A name used in the definition of an associated function (14.9.1.1) of a concept or concept map X following 
 6228: the associated function＊s declarator-id shall be declared in one of the following ways: 
 6229: 〞 before its use in the block in which it is used or in an enclosing block (6.3), or 
 6230: 〞 shall be a member of concept or concept map X or be a member of a less refined concept of X, or 
 6231: 〞 if X is a member of namespace N, before the associated function definition, in namespace N or in one 
 6232: of N＊s enclosing namespaces. 
 6233: 18 [ Note: the rules for name lookup in template definitions are described in 14.6. 〞end note ] 
 6234: 3.4.2 Argument-dependent name lookup [basic.lookup.argdep] 
 6235: 1 When an unqualified name is used as the postfix-expression in a function call (5.2.2), other namespaces not 
 6236: considered during the usual unqualifiedlookup (3.4.1) may be searched, andin those namespaces, namespace-
 6237: scope friend function declarations (11.4) not otherwise visible may be found. These modifications to the 
 6238: search depend on the types of the arguments (and for template template arguments, the namespace of the 
 6239: template argument). 
 6240: 2 For each argument type T in the function call, there is a set of zero or more associated namespaces and a 
 6241: set of zero or more associated classes to be considered. The sets of namespaces and classes is determined 
 6242: entirely by the types of the function arguments (and the namespace of any template template argument). 
 6243: Typedef names and using-declarations used to specify the types do not contribute to this set. The sets of 
 6244: namespaces and classes are determined in the following way: 
 6245: 〞 If T is a fundamental type, its associated sets of namespaces and classes are both empty. 
 6246: 〞 If T is a non-archetype class type (including unions), its associated classes are: the class itself; the class 
 6247: of which it is a member, if any; and its direct and indirect base classes. Its associated namespaces are 
 6248: the namespaces of which its associated classes are members. Furthermore, if T is a class template spe-
 6249: cialization, its associated namespaces and classes also include: the namespaces and classes associated 
 6250: with the types of the template arguments provided for template type parameters (excluding template 
 6251: template parameters); the namespaces of which any template template arguments are members; and 
 6252: the classes of which any member templates used as template template arguments are members. [ Note: 
 6253: non-type template arguments do not contribute to the set of associated namespaces. 〞end note ] 
 6254: 〞 If T is an enumeration type, its associated namespace is the namespace in which it is defined. If it is 
 6255: class member, its associated class is the member＊s class; else it has no associated class. 
 6256: 〞 If T is a pointer to U or an array of U, its associated namespaces and classes are those associated with 
 6257: U. 
 6258: 〞 If T is a function type, its associated namespaces and classes are those associated with the function 
 6259: parameter types and those associated with the return type. 
 6260: 〞 If T is a pointer to a member function of a class X, its associated namespaces and classes are those 
 6261: associated with the function parameter types and return type, together with those associated with X. 
 6262: 〞 If T is a pointer to a data member of class X, its associated namespaces and classes are those associated 
 6263: with the member type together with those associated with X. 
 6264: If an associated namespace is an inline namespace (7.3.1), its enclosing namespace is also included in the set. 
 6265: If an associated namespace directly contains inline namespaces, those inline namespaces are also included 
 6266: in the set. In addition, if the argument is the name or address of a set of overloaded functions and/or 
 6267: function templates, its associated classes and namespaces are the union of those associated with each of the 
 6268: ∫ 3.4.2 46 
 6269: 
 6270: c
 6271: . ISO/IEC N2800=08-0310 
 6272: members of the set: the namespace in which the function or function template is defined and the classes and 
 6273: namespaces associated with its (non-dependent) parameter types and return type. 
 6274: 3 Let X be the lookup set produced by unqualified lookup (3.4.1) and let Y be the lookup set produced by 
 6275: argument dependent lookup (defined as follows). If X contains 
 6276: 〞 a declaration of a class member, or 
 6277: 〞 a block-scope function declaration that is not a using-declaration, or 
 6278: 〞 a declaration that is neither a function or a function template 
 6279: then Y is empty. Otherwise Y is the set of declarations found in the namespaces associated with the 
 6280: argument types as described below. The set of declarations found by the lookup of the name is the union of 
 6281: X and Y .[ Note: the namespaces and classes associated with the argument types can include namespaces 
 6282: and classes already considered by the ordinary unqualified lookup. 〞end note ][ Example: 
 6283: namespace NS {
 6284: class T { };
 6285: void f(T);
 6286: void g(T, int);
 6287: }
 6288: NS::T parm;
 6289: void g(NS::T, float);
 6290: int main() {
 6291: f(parm); // OK: calls NS::f
 6292: extern void g(NS::T, float);
 6293: g(parm, 1); // OK: calls g(NS::T, float)
 6294: } 
 6295: 〞end example ] 
 6296: 4 When considering an associated namespace, the lookup is the same as the lookup performed when the 
 6297: associated namespace is used as a qualifier (3.4.3.2) except that: 
 6298: 〞 Any using-directives in the associated namespace are ignored. 
 6299: 〞 Any namespace-scope friend functions or friend function templates declared in associated classes are 
 6300: visible within their respective namespaces even if they are not visible during an ordinary lookup (11.4). 
 6301: 〞 All names except those of (possibly overloaded) functions and function templates are ignored. 
 6302: 3.4.3 Qualified name lookup [basic.lookup.qual] 
 6303: 1 The name of a class, concept map (but not a concept), or namespace member or enumerator can be referred 
 6304: to after the :: scope resolution operator (5.1) applied to a nested-name-specifier that nominates its class, 
 6305: concept map, namespace, or enumeration. During the lookup for a name preceding the :: scope resolution 
 6306: operator, object, function, and enumerator names are ignored. If the name found does not designate a 
 6307: namespace, concept map, or a class, enumeration, or dependent type, the program is ill-formed.[ Example: 
 6308: class A {
 6309: public:
 6310: static int n;
 6311: };
 6312: int main() {
 6313: int A;
 6314: A::n = 42; // OK
 6315: A b; // ill-formed: A does not name a type
 6316: ∫ 3.4.3 47 
 6317: 
 6318: c
 6319: . ISO/IEC N2800=08-0310 
 6320: } 
 6321: 〞end example ] 
 6322: 2 [ Note: multiply qualified names, such as N1::N2::N3::n, can be used to refer to members of nested 
 6323: classes (9.7) or members of nested namespaces. 〞 end note ] 
 6324: 3 In a declaration in which the declarator-id is a qualified-id, names used before the qualified-id being declared 
 6325: are looked up in the defining namespace scope; names following the qualified-id are looked up in the scope 
 6326: of the member＊s class or namespace. [ Example: 
 6327: class X { }; 
 6328: class C {
 6329: class X { };
 6330: static const int number = 50;
 6331: static X arr[number];
 6332: }; 
 6333: X C::arr[number]; // ill-formed:
 6334: // equivalent to: ::X C::arr[C::number];
 6335: // not to: C::X C::arr[C::number];
 6336: 〞end example ] 
 6337: 4 A name prefixed by the unary scope operator :: (5.1) is looked up in global scope, in the translation unit 
 6338: where it is used. The name shall be declared in global namespace scope or shall be a name whose declaration 
 6339: is visible in global scope because of a using-directive (3.4.3.2). The use of :: allows a global name to be 
 6340: referred to even if its identifier has been hidden (3.3.10). 
 6341: 5 A name prefixed by a nested-name-specifier that nominates an enumeration type shall represent an enumer-
 6342: ator of that enumeration. 
 6343: 6 If a pseudo-destructor-name (5.2.4) contains a nested-name-specifier, the type-names are looked up as types 
 6344: in the scope designated by the nested-name-specifier. Similarly, in a qualified-id of the form: 
 6345: ::opt nested-name-specifieropt class-name :: ‵ class-name 
 6346: the second class-name is looked up in the same scope as the first. [ Example: 
 6347: struct C { 
 6348: typedef int I;
 6349: };
 6350: typedef int I1, I2;
 6351: extern int* p;
 6352: extern int* q;
 6353: p->C::I::~I(); // I is looked up in the scope of C
 6354: q->I1::~I2(); // I2 is looked up in the scope of
 6355: // the postfix-expression 
 6356: struct A { 
 6357: ~A();
 6358: };
 6359: typedef A AB;
 6360: int main() {
 6361: AB *p;
 6362: p->AB::~AB(); // explicitly calls the destructor for A
 6363: }
 6364: ∫ 3.4.3 48 
 6365: 
 6366: c
 6367: . ISO/IEC N2800=08-0310 
 6368: 〞end example ][ Note: 3.4.5 describes how name lookup proceeds after the . and -> operators. 〞end 
 6369: note ] 
 6370: 7 In a constrained context (14.10), a name prefixed by a nested-name-specifier that nominates a template type 
 6371: parameter T is looked up as follows: for each template requirement C<args> whose template argument list 
 6372: references T, the name is looked up as if the nested-name-specifier referenced C<args> instead of T (3.4.3.3), 
 6373: except that only the names of associated types are visible during this lookup. If an associated type of at least 
 6374: one requirement is found, then each name found shall refer to the same type. Otherwise, if the reference 
 6375: to the name occurs within a constrained context, the name is looked up within the scope of the archetype 
 6376: associated with T (and no special restriction on name visibility is in effect for this lookup). [ Example: 
 6377: concept C<typename T> {
 6378: typename assoc_type;
 6379: } 
 6380: template<typename T, typename U> requires C<T> && C<U>
 6381: T::assoc_type // okay: refers to C<T>::assoc_type
 6382: f();
 6383: 〞end example ] 
 6384: 3.4.3.1 Class members [class.qual] 
 6385: 1 If the nested-name-specifier of a qualified-id nominates a class, the name specified after the nested-name-
 6386: specifier is looked up in the scope of the class (10.2), except for the cases listed below. The name shall 
 6387: represent one or more members of that class or of one of its base classes (Clause 10). [ Note: a class member 
 6388: can be referred to using a qualified-id at any point in its potential scope (3.3.6). 〞 end note ] The exceptions 
 6389: to the name lookup rule above are the following: 
 6390: 〞 a destructor name is looked up as specified in 3.4.3; 
 6391: 〞a conversion-type-id of an conversion-function-id is looked up both in the scope of the class and in the 
 6392: context in which the entire postfix-expression occurs and shall refer to the same type in both contexts; 
 6393: 〞 the names in a template-argument of a template-id are looked up in the context in which the entire 
 6394: postfix-expression occurs. 
 6395: 〞 the lookup for a name specified in a using-declaration (7.3.3) also finds class or enumeration names 
 6396: hidden within the same scope (3.3.10). 
 6397: 2 In a lookup in which the constructor is an acceptable lookup result and the nested-name-specifier nominates 
 6398: a class C: 
 6399: 〞 if the name specified after the nested-name-specifier, when looked up in C, is the injected-class-name 
 6400: of C (Clause 9), or 
 6401: 〞 if the name specified after the nested-name-specifier is the same as the identifier or the simple-template-
 6402: id＊s template-name in the last component of the nested-name-specifier, 
 6403: the name is instead considered to name the constructor of class C.[ Note: for example, the constructor is 
 6404: not an acceptable lookup result in an elaborated-type-specifier so the constructor would not be used in place 
 6405: of the injected-class-name. 〞end note ] Such a constructor name shall be used only in the declarator-id of 
 6406: a declaration that names a constructor or in a using-declaration.[ Example: 
 6407: struct A { A(); };
 6408: struct B: public A { B(); };
 6409: A::A() { } 
 6410: ∫ 3.4.3.1 49 
 6411: 
 6412: c
 6413: . ISO/IEC N2800=08-0310 
 6414: B::B() { } 
 6415: B::A ba; // object of type A
 6416: A::A a; // error, A::A is not a type name
 6417: struct A::A a2; // object of type A
 6418: 〞end example ] 
 6419: 3 A class member name hidden by a name in a nested declarative region or by the name of a derived class 
 6420: member can still be found if qualified by the name of its class followed by the :: operator. 
 6421: 3.4.3.2 Namespace members [namespace.qual] 
 6422: 1 If the nested-name-specifier of a qualified-id nominates a namespace, the name specified after the nested-
 6423: name-specifier is looked up in the scope of the namespace, except that the names in a template-argument of 
 6424: a template-id are looked up in the context in which the entire postfix-expression occurs. 
 6425: 2 Given X::m (where X is a user-declared namespace), or given ::m (where X is the global namespace), 
 6426: let S be the set of all declarations of m in X and in the transitive closure of all namespaces nominated 
 6427: by using-directives in X and its used namespaces, except that using-directives that nominate non-inline 
 6428: namespaces (7.3.1) are ignored in any namespace, including X, directly containing one or more declarations 
 6429: of m. No namespace is searched more than once in the lookup of a name. If S is the empty set, the 
 6430: program is ill-formed. Otherwise, if S has exactly one member, or if the context of the reference is a using-
 6431: declaration (7.3.3), S is the required set of declarations of m. Otherwise if the use of m is not one that allows 
 6432: a unique declaration to be chosen from S, the program is ill-formed. [ Example: 
 6433: int x; 
 6434: namespace Y {
 6435: void f(float);
 6436: void h(int);
 6437: } 
 6438: namespace Z {
 6439: void h(double);
 6440: }
 6441: namespace A {
 6442: using namespace Y;
 6443: void f(int);
 6444: void g(int);
 6445: int i;
 6446: } 
 6447: namespace B {
 6448: using namespace Z;
 6449: void f(char);
 6450: int i;
 6451: } 
 6452: namespace AB {
 6453: using namespace A;
 6454: using namespace B;
 6455: void g();
 6456: } 
 6457: ∫ 3.4.3.2 50 
 6458: 
 6459: c
 6460: . ISO/IEC N2800=08-0310 
 6461: void h()
 6462: {
 6463: AB::g(); // g is declared directly in AB,
 6464: // therefore S is { AB::g() } and AB::g() is chosen
 6465: AB::f(1); // f is not declared directly in AB so the rules are
 6466: // applied recursively to A and B;
 6467: // namespace Y is not searched and Y::f(float)
 6468: // is not considered;
 6469: // S is { A::f(int), B::f(char) } and overload
 6470: // resolution chooses A::f(int)
 6471: AB::f(＊c＊); // as above but resolution chooses B::f(char) 
 6472: AB::x++; // x is not declared directly in AB, and
 6473: // is not declared in A or B , so the rules are
 6474: // applied recursively to Y and Z,
 6475: // S is { } so the program is ill-formed
 6476: AB::i++; // i is not declared directly in AB so the rules are
 6477: // applied recursively to A and B,
 6478: // S is { A::i , B::i } so the use is ambiguous
 6479: // and the program is ill-formed
 6480: AB::h(16.8); // h is not declared directly in AB and
 6481: // not declared directly in A or B so the rules are
 6482: // applied recursively to Y and Z,
 6483: // S is { Y::h(int), Z::h(double) } and overload
 6484: // resolution chooses Z::h(double)
 6485: } 
 6486: 3 The same declaration found more than once is not an ambiguity (because it is still a unique declaration). 
 6487: For example: 
 6488: namespace A {
 6489: int a;
 6490: }
 6491: namespace B {
 6492: using namespace A;
 6493: }
 6494: namespace C {
 6495: using namespace A;
 6496: }
 6497: namespace BC {
 6498: using namespace B;
 6499: using namespace C;
 6500: } 
 6501: void f()
 6502: {
 6503: BC::a++; // OK: S is { A::a, A::a }
 6504: }
 6505: namespace D {
 6506: using A::a;
 6507: }
 6508: ∫ 3.4.3.2 51 
 6509: 
 6510: c
 6511: . ISO/IEC N2800=08-0310 
 6512: namespace BD {
 6513: using namespace B;
 6514: using namespace D;
 6515: } 
 6516: void g()
 6517: {
 6518: BD::a++; // OK: S is { A::a, A::a }
 6519: }
 6520: 4 Because each referenced namespace is searched at most once, the following is well-defined: 
 6521: namespace B {
 6522: int b;
 6523: }
 6524: namespace A {
 6525: using namespace B;
 6526: int a;
 6527: } 
 6528: namespace B {
 6529: using namespace A;
 6530: }
 6531: void f() 
 6532: {
 6533: A::a++; // OK: a declared directly in A, S is { A::a}
 6534: B::a++; // OK: both A and B searched (once), S is { A::a}
 6535: A::b++; // OK: both A and B searched (once), S is { B::b}
 6536: B::b++; // OK: b declared directly in B, S is { B::b}
 6537: } 
 6538: 〞end example ] 
 6539: 5 During the lookup of a qualified namespace member name, if the lookup finds more than one declaration of 
 6540: the member, and if one declaration introduces a class name or enumeration name and the other declarations 
 6541: either introduce the same object, the same enumerator or a set of functions, the non-type name hides the 
 6542: class or enumeration name if and only if the declarations are from the same namespace; otherwise (the 
 6543: declarations are from different namespaces), the program is ill-formed. [ Example: 
 6544: namespace A {
 6545: struct x { };
 6546: int x;
 6547: int y;
 6548: } 
 6549: namespace B {
 6550: struct y { };
 6551: }
 6552: namespace C {
 6553: using namespace A;
 6554: using namespace B;
 6555: int i = C::x; // OK, A::x (of type int )
 6556: int j = C::y; // ambiguous, A::y or B::y
 6557: ∫ 3.4.3.2 52 
 6558: 
 6559: c
 6560: . ISO/IEC N2800=08-0310 
 6561: } 
 6562: 〞end example ] 
 6563: 6 In a declaration for a namespace member in which the declarator-id is a qualified-id, given that the qualified-id 
 6564: for the namespace member has the form 
 6565: nested-name-specifier unqualified-id 
 6566: the unqualified-id shall name a member of the namespace designated by the nested-name-specifier.[ Example: 
 6567: namespace A {
 6568: namespace B {
 6569: void f1(int);
 6570: }
 6571: using namespace B;
 6572: }
 6573: void A::f1(int){ } // ill-formed, f1 is not a member of A
 6574: 〞end example ] However, in such namespace member declarations, the nested-name-specifier may rely on 
 6575: using-directives to implicitly provide the initial part of the nested-name-specifier.[ Example: 
 6576: namespace A {
 6577: namespace B {
 6578: void f1(int);
 6579: }
 6580: }
 6581: namespace C {
 6582: namespace D {
 6583: void f1(int);
 6584: }
 6585: }
 6586: using namespace A;
 6587: using namespace C::D;
 6588: void B::f1(int){ } // OK, defines A::B::f1(int)
 6589: 〞end example ] 
 6590: 3.4.3.3 Concept map members [concept.qual] 
 6591: 1 If the nested-name-specifier of a qualified-id nominates a concept instance, the name specified after the 
 6592: nested-name-specifier is looked up as follows: 
 6593: 〞 If the template argument list of the concept instance depends on a template parameter, and if the name, 
 6594: when looked up within the scope of the concept (not the concept instance), refers to an associated type 
 6595: or class template, the result of name lookup is a dependent type composed of the concept instance and 
 6596: the associated type or class template. [ Note: this implies that, given two distinct type parameters T 
 6597: and U, C<T>::type and C<U>::type are distinct types (although they may alias the same archetype). 
 6598: Also, lookup of ＊type＊ within C<T> and C<U> does not require the creation of a concept map archetype 
 6599: for C<T> or C<U>. 〞end note ] 
 6600: 〞 Otherwise, concept map lookup (14.10.1.1) first determines which concept map is referred to by the 
 6601: nested-name-specifier. Then concept member lookup (14.9.3.1) is used to find the name within the 
 6602: scope of the concept map. The name shall represent one or more members of that concept map or 
 6603: the concept maps corresponding to the concept＊s less refined concepts. [ Note: this lookup requires 
 6604: ∫ 3.4.3.3 53 
 6605: 
 6606: c
 6607: . ISO/IEC N2800=08-0310 
 6608: a concept map definition, so if the template argument list of the concept instance is dependent on a 
 6609: template parameter (and, therefore, the name does not refer to an associated type or class template〞a 
 6610: case which would have been handled by the previous bullet), a concept map archetype definition is 
 6611: required. 〞 end note ] 
 6612: [ Note: Outside of a constrained context, this means that one or more requirement members (14.9.2) will be 
 6613: found, and since those names are synonyms for sets of other names, the result of name lookup is the union 
 6614: of each of those sets. 〞 end note ]. [ Note: a concept map member can be referred to using a qualified-id 
 6615: at any point in its potential scope (3.3.7). [ Example: 
 6616: concept C<typename F, typename T1> {
 6617: typename type;
 6618: type operator()(F&, T1);
 6619: } 
 6620: template<typename F, typename T1>
 6621: requires C<F, T1>
 6622: C<F, T1>::result_type g(F& f, const T1& t1) {
 6623: return f(t1);
 6624: }
 6625: 〞end example ] 〞end note ] 
 6626: 2 A concept map member name hidden by a name in a nested declarative region or by the name of a more 
 6627: refined concept＊s member can still be found if qualified by the name of its concept map followed by the :: 
 6628: operator. 
 6629: 3.4.4 Elaborated type specifiers [basic.lookup.elab] 
 6630: 1 An elaborated-type-specifier (7.1.6.3) may be used to refer to a previously declared class-name or enum-name 
 6631: even though the name has been hidden by a non-type declaration (3.3.10). 
 6632: 2 If the elaborated-type-specifier has no nested-name-specifier, and unless the elaborated-type-specifier appears 
 6633: in a declaration with the following form: 
 6634: class-key identifier attribute-specifieropt ; 
 6635: the identifier is looked up according to 3.4.1 but ignoring any non-type names that have been declared. If 
 6636: the elaborated-type-specifier is introduced by the enum keyword and this lookup does not find a previously 
 6637: declared type-name, the elaborated-type-specifier is ill-formed. If the elaborated-type-specifier is introduced by 
 6638: the class-key and this lookup does not find a previously declared type-name, or if the elaborated-type-specifier 
 6639: appears in a declaration with the form: 
 6640: class-key identifier attribute-specifieropt ; 
 6641: the elaborated-type-specifier is a declaration that introduces the class-name as described in 3.3.1. 
 6642: 3 If the elaborated-type-specifier has a nested-name-specifier, qualified name lookup is performed, as described 
 6643: in 3.4.3, but ignoring any non-type names that have been declared. If the name lookup does not find a 
 6644: previously declared type-name, the elaborated-type-specifier is ill-formed. [ Example: 
 6645: struct Node {
 6646: struct Node* Next; // OK: Refers to Node at global scope
 6647: struct Data* Data; // OK: Declares type Data
 6648: // at global scope and member Data
 6649: };
 6650: ∫ 3.4.4 54 
 6651: 
 6652: c
 6653: . ISO/IEC N2800=08-0310 
 6654: struct Data {
 6655: struct Node* Node; // OK: Refers to Node at global scope
 6656: friend struct ::Glob; // error: Glob is not declared
 6657: // cannot introduce a qualified type (7.1.6.3)
 6658: friend struct Glob; // OK: Refers to (as yet) undeclared Glob
 6659: // at global scope.
 6660: ... /
 6661: /. 
 6662: }; 
 6663: struct Base {
 6664: struct Data; // OK: Declares nested Data
 6665: struct ::Data* thatData; // OK: Refers to ::Data
 6666: struct Base::Data* thisData; // OK: Refers to nested Data
 6667: friend class ::Data; // OK: global Data is a friend
 6668: friend class Data; // OK: nested Data is a friend
 6669: struct Data { /* ... */ }; // Defines nested Data
 6670: }; 
 6671: struct Data; // OK: Redeclares Data at global scope
 6672: struct ::Data; // error: cannot introduce a qualified type (7.1.6.3)
 6673: struct Base::Data; // error: cannot introduce a qualified type (7.1.6.3)
 6674: struct Base::Datum; // error: Datum undefined
 6675: struct Base::Data* pBase; // OK: refers to nested Data
 6676: 〞end example ] 
 6677: 3.4.5 Class member access [basic.lookup.classref] 
 6678: 1 In a class member access expression (5.2.5), if the . or -> token is immediately followed by an identifier 
 6679: followed by a <, the identifier must be looked up to determine whether the < is the beginning of a template 
 6680: argument list (14.2) or a less-than operator. The identifier is first looked up in the class of the object 
 6681: expression. If the identifier is not found, it is then looked up in the context of the entire postfix-expression 
 6682: and shall name a class template. If the lookup in the class of the object expression finds a template, the 
 6683: name is also looked up in the context of the entire postfix-expression and 
 6684: 〞 if the name is not found, the name found in the class of the object expression is used, otherwise 
 6685: 〞 if the name is found in the context of the entire postfix-expression and does not name a class template, 
 6686: the name found in the class of the object expression is used, otherwise 
 6687: 〞 if the name found is a class template, it shall refer to the same entity as the one found in the class of 
 6688: the object expression, otherwise the program is ill-formed. 
 6689: 2 If the id-expression in a class member access (5.2.5) is an unqualified-id, and the type of the object expression 
 6690: is of a class type C, the unqualified-id is looked up in the scope of class C. If the type of the object expression 
 6691: is of pointer to scalar type, the unqualified-id is looked up in the context of the complete postfix-expression. 
 6692: 3 If the unqualified-id is type-name, the type-name is looked up in the context of the entire postfix-expression. 
 6693: If the type T of the object expression is of a class type C, the type-name is also looked up in the scope of 
 6694: class C. At least one of the lookups shall find a name that refers to (possibly cv-qualified) T.[ Example: 
 6695: struct A { }; 
 6696: struct B {
 6697: struct A { };
 6698: void f(::A* a);
 6699: }; 
 6700: ∫ 3.4.5 55 
 6701: 
 6702: c
 6703: . ISO/IEC N2800=08-0310 
 6704: void B::f(::A* a) { 
 6705: a->~A(); // OK: lookup in *a finds the injected-class-name
 6706: }
 6707: 〞end example ] 
 6708: 4 If the id-expression in a class member access is a qualified-id of the form 
 6709: class-name-or-namespace-name::... 
 6710: the class-name-or-namespace-name following the . or -> operator is looked up both in the context of the 
 6711: entire postfix-expression and in the scope of the class of the object expression. If the name is found only in 
 6712: the scope of the class of the object expression, the name shall refer to a class-name. If the name is found 
 6713: only in the context of the entire postfix-expression, the name shall refer to a class-name or namespace-name. 
 6714: If the name is found in both contexts, the class-name-or-namespace-name shall refer to the same entity. 
 6715: 5 If the qualified-id has the form 
 6716: ::class-name-or-namespace-name::... 
 6717: the class-name-or-namespace-name is looked up in global scope as a class-name or namespace-name. 
 6718: 6 If the nested-name-specifier contains a simple-template-id (14.2), the names in its template-arguments are 
 6719: looked up in the context in which the entire postfix-expression occurs. 
 6720: 7 If the id-expression is a conversion-function-id, its conversion-type-id shall denote the same type in both the 
 6721: context in which the entire postfix-expression occurs and in the context of the class of the object expression 
 6722: (or the class pointed to by the pointer expression). 
 6723: 3.4.6 Using-directives and namespace aliases [basic.lookup.udir] 
 6724: 1 When looking up a namespace-name in a using-directive or namespace-alias-definition, only namespace 
 6725: names are considered. 
 6726: 3.5 Program and linkage [basic.link] 
 6727: 1 A program consists of one or more translation units (Clause 2) linked together. A translation unit consists 
 6728: of a sequence of declarations. 
 6729: translation-unit:
 6730: declaration-seqopt
 6731: 2 A name is said to have linkage when it might denote the same object, reference, function, type, template, 
 6732: namespace or value as a name introduced by a declaration in another scope: 
 6733: 〞 When a name has external linkage, the entity it denotes can be referred to by names from scopes of 
 6734: other translation units or from other scopes of the same translation unit. 
 6735: 〞 When a name has internal linkage, the entity it denotes can be referred to by names from other scopes 
 6736: in the same translation unit. 
 6737: 〞 When a name has no linkage, the entity it denotes cannot be referred to by names from other scopes. 
 6738: 3 A name having namespace scope (3.3.5) has internal linkage if it is the name of 
 6739: 〞 an object, reference, function or function template that is explicitly declared static or, 
 6740: 〞 an object or reference that is explicitly declared const and neither explicitly declared extern nor 
 6741: previously declared to have external linkage; or 
 6742: ∫ 3.5 56 
 6743: 
 6744: c
 6745: . ISO/IEC N2800=08-0310 
 6746: 〞 a data member of an anonymous union. 
 6747: 4 A name having namespace scope has external linkage if it is the name of 
 6748: 〞 an object or reference, unless it has internal linkage; or 
 6749: 〞 a function, unless it has internal linkage; or 
 6750: 〞 a named class (Clause 9), or an unnamed class defined in a typedef declaration in which the class has 
 6751: the typedef name for linkage purposes (7.1.3); or 
 6752: 〞 a named enumeration (7.2), or an unnamed enumeration defined in a typedef declaration in which the 
 6753: enumeration has the typedef name for linkage purposes (7.1.3); or 
 6754: 〞 an enumerator belonging to an enumeration with external linkage; or 
 6755: 〞 a template, unless it is a function template that has internal linkage (Clause 14); or 
 6756: 〞 a namespace (7.3), unless it is declared within an unnamed namespace. 
 6757: 5 In addition, a member function, static data member, a named class or enumeration of class scope, or an 
 6758: unnamed class or enumeration defined in a class-scope typedef declaration such that the class or enumeration 
 6759: has the typedef name for linkage purposes (7.1.3), has external linkage if the name of the class has external 
 6760: linkage. 
 6761: 6 
 6762: The name of a function declared in block scope and the name of an object declared by a block scope extern 
 6763: declaration have linkage. If there is a visible declaration of an entity with linkage having the same name and 
 6764: type, ignoring entities declared outside the innermost enclosing namespace scope, the block scope declaration 
 6765: declares that same entity and receives the linkage of the previous declaration. If there is more than one such 
 6766: matching entity, the program is ill-formed. Otherwise, if no matching entity is found, the block scope entity 
 6767: receives external linkage.[ Example: 
 6768: static void f();
 6769: static int i = 0; // 1
 6770: void g() {
 6771: extern void f(); // internal linkage
 6772: int i; // 2: i has no linkage
 6773: {
 6774: extern void f(); // internal linkage
 6775: extern int i; // 3: external linkage
 6776: }
 6777: }
 6778: There are three objects named i in this program. The object with internal linkage introduced by the 
 6779: declaration in global scope (line //1 ), the object with automatic storage duration and no linkage introduced 
 6780: by the declaration on line //2, and the object with static storage duration and external linkage introduced 
 6781: by the declaration on line //3. 〞 end example ] 
 6782: 7 When a block scope declaration of an entity with linkage is not found to refer to some other declaration, 
 6783: then that entity is a member of the innermost enclosing namespace. However such a declaration does not 
 6784: introduce the member name in its namespace scope. [ Example: 
 6785: namespace X { 
 6786: void p() {
 6787: q(); // error: q not yet declared
 6788: extern void q(); // q is a member of namespace X
 6789: } 
 6790: ∫ 3.5 57 
 6791: 
 6792: c
 6793: . ISO/IEC N2800=08-0310 
 6794: void middle() {
 6795: q(); // error: q not yet declared
 6796: }
 6797: void q() { /*... */ } // definition of X::q
 6798: }
 6799: void q() { /*... */ } // some other, unrelated q 
 6800: 〞end example ] 
 6801: 8 Names not covered by these rules have no linkage. Moreover, except as noted, a name declared in a local 
 6802: scope (3.3.2) has no linkage. A type is said to have linkage if and only if: 
 6803: 〞 it is a class or enumeration type that is named (or has a name for linkage purposes (7.1.3)) and the 
 6804: name has linkage; or 
 6805: 〞 it is a specialization of a class template (14)30; or 
 6806: 〞 it is a fundamental type (3.9.1); or 
 6807: 〞 it is a compound type (3.9.2) other than a class or enumeration, compounded exclusively from types 
 6808: that have linkage; or 
 6809: 〞 it is a cv-qualified (3.9.3) version of a type that has linkage.
 6810: A type without linkage shall not be used as the type of a variable or function with linkage, unless
 6811: 〞 the variable or function has extern "C" linkage (7.5), or 
 6812: 〞 the type without linkage was named using a dependent type (14.6.2.1). 
 6813: [ Note: in other words, a type without linkage contains a class or enumeration that cannot be named outside 
 6814: its translation unit. An entity with external linkage declared using such a type could not correspond to any 
 6815: other entity in another translation unit of the program and thus is not permitted. Also note that classes 
 6816: with linkage may contain members whose types do not have linkage, and that typedef names are ignored in 
 6817: the determination of whether a type has linkage. 〞end note ][ Example: 
 6818: void f() {
 6819: struct A { int x; }; // no linkage
 6820: extern A a; // ill-formed
 6821: typedef A B;
 6822: extern B b; // ill-formed
 6823: } 
 6824: 〞end example ]
 6825: [ Example:
 6826: template <class T> struct A {
 6827: // in A<X>, the following is allowed because the type with no linkage
 6828: // X is named using template parameter T.
 6829: friend void f(A, T){}
 6830: }; 
 6831: 30) A class template always has external linkage, and the requirements of 14.3.1 and 14.3.2 ensure that the template arguments 
 6832: will also have appropriate linkage. 
 6833: ∫ 3.5 58 
 6834: 
 6835: c
 6836: . ISO/IEC N2800=08-0310 
 6837: template <class T> void g(T t) {
 6838: A<T> at;
 6839: f(at, t);
 6840: } 
 6841: int main() {
 6842: class X {} x;
 6843: g(x);
 6844: } 
 6845: 〞end example ] 
 6846: 9 Two names that are the same (Clause 3) and that are declared in different scopes shall denote the same 
 6847: object, reference, function, type, enumerator, template or namespace if 
 6848: 〞 both names have external linkage or else both names have internal linkage and are declared in the 
 6849: same translation unit; and 
 6850: 〞 both names refer to members of the same namespace or to members, not by inheritance, of the same 
 6851: class; and 
 6852: 〞 when both names denote functions, the parameter-type-lists of the functions (8.3.5) are identical; and 
 6853: 〞 when both names denote function templates, the signatures (14.5.6.1) are the same. 
 6854: 10 After all adjustments of types (during which typedefs (7.1.3) are replaced by their definitions), the types 
 6855: specified by all declarations referring to a given object or function shall be identical, except that declara-
 6856: tions for an array object can specify array types that differ by the presence or absence of a major array 
 6857: bound (8.3.4). A violation of this rule on type identity does not require a diagnostic. 
 6858: 11 [ Note: linkage to non-C++ declarations can be achieved using a linkage-specification (7.5). 〞end note ] 
 6859: 3.6 Start and termination [basic.start] 
 6860: 3.6.1 Main function [basic.start.main] 
 6861: 1 A program shall contain a global function called main, which is the designated start of the program. It 
 6862: is implementation-defined whether a program in a freestanding environment is required to define a main 
 6863: function. [ Note: in a freestanding environment, start-up and termination is implementation-defined; start-
 6864: up contains the execution of constructors for objects of namespace scope with static storage duration; 
 6865: termination contains the execution of destructors for objects with static storage duration. 〞end note ] 
 6866: 2 An implementation shall not predefine the main function. This function shall not be overloaded. It shall 
 6867: have a return type of type int, but otherwise its type is implementation-defined. All implementations shall 
 6868: allow both of the following definitions of main: 
 6869: int main() { /* ... */ } 
 6870: and 
 6871: int main(int argc, char* argv[]) { /* ... */ } 
 6872: In the latter form argc shall be the number of arguments passed to the program from the environ-
 6873: ment in which the program is run. If argc is nonzero these arguments shall be supplied in argv[0] 
 6874: through argv[argc-1] as pointers to the initial characters of null-terminated multibyte strings (ntmbs 
 6875: s) (17.5.3.2.4.3) and argv[0] shall be the pointer to the initial character of a ntmbs that represents the 
 6876: name used to invoke the program or "". The value of argc shall be nonnegative. The value of argv[argc] 
 6877: ∫ 3.6.1 59 
 6878: 
 6879: c
 6880: . ISO/IEC N2800=08-0310 
 6881: shall be 0. [ Note: it is recommended that any further (optional) parameters be added after argv. 〞end 
 6882: note ] 
 6883: 3 The function main shall not be used (3.2) within a program. The linkage (3.5) of main is implementation-
 6884: defined. A program that declares main to be inline or static is ill-formed. The name main is not otherwise 
 6885: reserved. [ Example: member functions, classes, and enumerations can be called main, as can entities in other 
 6886: namespaces. 〞end example ] 
 6887: 4 Calling the function std::exit(int) declared in <cstdlib> (18.4) terminates the program without leaving 
 6888: the current block and hence without destroying any objects with automatic storage duration (12.4). If 
 6889: std::exit is called to end a program during the destruction of an object with static or thread storage 
 6890: duration, the program has undefined behavior. 
 6891: 5 A return statement in main has the effect of leaving the main function (destroying any objects with automatic 
 6892: storage duration) and calling std::exit with the return value as the argument. If control reaches the end 
 6893: of main without encountering a return statement, the effect is that of executing 
 6894: return 0; 
 6895: 3.6.2 Initialization of non-local objects [basic.start.init] 
 6896: 1 There are two broad classes of named non-local objects: those with static storage duration (3.7.1) and 
 6897: those with thread storage duration (3.7.2). Non-local objects with static storage duration are initialized 
 6898: as a consequence of program initiation. Non-local objects with thread storage duration are initialized as a 
 6899: consequence of thread execution. Within each of these phases of initiation, initialization occurs as follows. 
 6900: 2 Objects with static storage duration (3.7.1) or thread storage duration (3.7.2) shall be zero-initialized (8.5) 
 6901: before any other initialization takes place. 
 6902: Constant initialization is performed: 
 6903: 〞 if each full-expression (including implicit conversions) that appears in the initializer of a reference with 
 6904: static or thread storage duration is a constant expression (5.19) and the reference is bound to an lvalue 
 6905: designating an object with static storage duration or to a temporary (see 12.2) 
 6906: 〞 if an object with static or thread storage duration is initialized such that the initialization satisfies the 
 6907: requirements for the object being declared with constexpr (7.1.5). 
 6908: Together, zero-initialization and constant initialization are called static initialization;allother initialization is 
 6909: dynamic initialization. Static initialization shall be performed before any dynamic initialization takes place. 
 6910: Dynamic initialization of a non-local object with static storage duration is either ordered or unordered. 
 6911: Definitions of explicitly specialized class template static data members have ordered initialization. Other 
 6912: class template static data members (i.e., implicitly or explicitly instantiated specializations) have unordered 
 6913: initialization. Other objects defined in namespace scope have ordered initialization. Objects with ordered 
 6914: initialization defined within a single translation unit shall be initialized in the order of their definitions 
 6915: in the translation unit. If a program starts a thread (30.2), the subsequent initialization of an object is 
 6916: unsequenced with respect to the initialization of an object defined in a different translation unit. Otherwise, 
 6917: the initialization of an object is indeterminately sequenced with respect to the initialization of an object 
 6918: defined in a different translation unit. If a program starts a thread, the subsequent unordered initialization 
 6919: of an object is unsequenced with respect to every other dynamic initialization. Otherwise, the unordered 
 6920: initialization of an object is indeterminately sequenced with respect to every other dynamic initialization. 
 6921: [ Note: This definition permits initialization of a sequence of ordered objects concurrently with another 
 6922: sequence. 〞end note ][ Note: 8.5.1 describes the order in which aggregate members are initialized. The 
 6923: initialization of local static objects is described in 6.7. 〞end note ] 
 6924: ∫ 3.6.2 60 
 6925: 
 6926: c
 6927: . ISO/IEC N2800=08-0310 
 6928: 3 An implementation is permitted to perform the initialization of an object of namespace scope as a static 
 6929: initialization even if such initialization is not required to be done statically, provided that 
 6930: 〞 the dynamic version of the initialization does not change the value of any other object of namespace 
 6931: scope prior to its initialization, and 
 6932: 〞 the static version of the initialization produces the same value in the initialized object as would be 
 6933: produced by the dynamic initialization if all objects not required to be initialized statically were 
 6934: initialized dynamically. 
 6935: 〞[ Note: as a consequence, if the initialization of an object obj1 refers to an object obj2 of namespace 
 6936: scope potentially requiring dynamic initialization and defined later in the same translation unit, it is 
 6937: unspecified whether the value of obj2 used will be the value of the fully initialized obj2 (because obj2 
 6938: was statically initialized) or will be the value of obj2 merely zero-initialized. For example, 
 6939: inline double fd() { return 1.0; }
 6940: extern double d1;
 6941: double d2 = d1; // unspecified:
 6942: // may be statically initialized to 0.0 or
 6943: // dynamically initialized to 1.0
 6944: double d1 = fd(); // may be initialized statically to 1.0
 6945: 〞end note ] 
 6946: 4 It is implementation-defined whether the dynamic initialization (8.5, 9.4, 12.1, 12.6.1) of an object of name-
 6947: space scope with static storage duration is done before the first statement of main. If the initialization is 
 6948: deferred to some point in time after the first statement of main, it shall occur before the first use of any 
 6949: function or object defined in the same translation unit as the object to be initialized.31 [ Example: 
 6950: // -File 1 -
 6951: #include "a.h"
 6952: #include "b.h"
 6953: B b;
 6954: A::A(){
 6955: b.Use();
 6956: }
 6957: // -File 2 -
 6958: #include "a.h"
 6959: A a;
 6960: // -File 3 -
 6961: #include "a.h"
 6962: #include "b.h"
 6963: extern A a;
 6964: extern B b;
 6965: int main() {
 6966: a.Use();
 6967: b.Use();
 6968: } 
 6969: It is implementation-defined whether either a or b is initialized before main is entered or whether the 
 6970: initializations are delayed until a is first used in main. In particular, if a is initialized before main is entered, 
 6971: 31) An object defined in namespace scope having initialization with side-effects must be initialized even if it is not used (3.7.1). 
 6972: ∫ 3.6.2 61 
 6973: 
 6974: c
 6975: . ISO/IEC N2800=08-0310 
 6976: it is not guaranteed that b will be initialized before it is used by the initialization of a, that is, before A::A 
 6977: is called. If, however, a is initialized at some point after the first statement of main, b will be initialized 
 6978: prior to its use in A::A. 〞end example ] 
 6979: 5 It is implementation-defined whether the dynamic initialization (8.5, 9.4, 12.1, 12.6.1) of an object of name-
 6980: space scope and with thread storage duration is done before the first statement of the initial function of the 
 6981: thread. If the initialization is deferred to some point in time after the first statement of the initial function 
 6982: of the thread, it shall occur before the first use of any object with thread storage duration defined in the 
 6983: same translation unit as the object to be initialized. 
 6984: 6 If construction or destruction of a non-local static or thread duration object ends in throwing an uncaught 
 6985: exception, the result is to call std::terminate (18.7.3.3). 
 6986: 3.6.3 Termination [basic.start.term] 
 6987: 1 Destructors (12.4) for initialized objects with static storage duration are called as a result of returning from 
 6988: main and as a result of calling std::exit (18.4). Destructors for initialized objects with thread storage 
 6989: duration within a given thread are called as a result of returning from the initial function of that thread and 
 6990: as a result of that thread calling std::exit. The completions of the destructors for all initialized objects 
 6991: with thread storage duration within that thread are sequenced before the initiation of the destructors of 
 6992: any object with static storage duration. If the completion of the constructor or dynamic initialization of an 
 6993: object with thread storage duration is sequenced before that of another, the completion of the destructor of 
 6994: the second is sequenced before the initiation of the destructor of the first. If the completion of the constructor 
 6995: or dynamic initialization of an object with static storage duration is sequenced before that of another, the 
 6996: completion of the destructor of the second is sequenced before the initiation of the destructor of the first. 
 6997: [ Note: this definition permits concurrent destruction. 〞 end note ] If an object is initialized statically, the 
 6998: object is destroyed in the same order as if the object was dynamically initialized. For an object of array or 
 6999: class type, all subobjects of that object are destroyed before any local object with static storage duration 
 7000: initialized during the construction of the subobjects is destroyed. 
 7001: 2 If a function contains a local object of static or thread storage duration that has been destroyed and the 
 7002: function is called during the destruction of an object with static or thread storage duration, the program 
 7003: has undefined behavior if the flow of control passes through the definition of the previously destroyed local 
 7004: object. Likewise, the behavior is undefined if the function-local object is used indirectly (i.e. through a 
 7005: pointer) after its destruction. 
 7006: 3 If the completion of the initialization of a non-local object with static storage duration is sequenced before 
 7007: a call to std::atexit (see <cstdlib>, 18.4), the call to the function passed to std::atexit is sequenced 
 7008: before the call to the destructor for the object. If a call to std::atexit is sequenced before the completion 
 7009: of the initialization of a non-local object with static storage duration, the call to the destructor for the 
 7010: object is sequenced before the call to the function passed to std::atexit. If a call to std::atexit is 
 7011: sequenced before another call to std::atexit, the call to the function passed to the second std::atexit 
 7012: call is sequenced before the call to the function passed to the first std::atexit call. 
 7013: 4 If there is a use of a standard library object or function not permitted within signal handlers (18.9) that does 
 7014: not happen before (1.10) completion of destruction of objects with static storage duration and execution of 
 7015: std::atexit registered functions (18.4), the program has undefined behavior. [ Note: if there is a use of 
 7016: an object with static storage duration that does not happen before the object＊s destruction, the program 
 7017: has undefined behavior. Terminating every thread before a call to std::exit or the exit from main is 
 7018: sufficient, but not necessary, to satisfy these requirements. These requirements permit thread managers as 
 7019: static-storage-duration objects. 〞 end note ] 
 7020: ∫ 3.6.3 62 
 7021: 
 7022: c
 7023: . ISO/IEC N2800=08-0310 
 7024: 5 Calling the function std::abort() declared in <cstdlib> terminates the program without executing any 
 7025: destructors and without calling the functions passed to std::atexit() or std::at_quick_exit(). 
 7026: 3.7 Storage duration [basic.stc] 
 7027: 1 Storage duration is the property of an object that defines the minimum potential lifetime of the storage 
 7028: containing the object. The storage duration is determined by the construct used to create the object and is 
 7029: one of the following: 
 7030: 〞 static storage duration 
 7031: 〞 thread storage duration 
 7032: 〞 automatic storage duration 
 7033: 〞 dynamic storage duration 
 7034: 2 Static, thread, and automatic storage durations are associated with objects introduced by declarations (3.1) 
 7035: and implicitly created by the implementation (12.2). The dynamic storage duration is associated with objects 
 7036: created with operator new (5.3.4). 
 7037: 3 The storage duration categories apply to references as well. The lifetime of a reference is its storage duration. 
 7038: 3.7.1 Static storage duration [basic.stc.static] 
 7039: 1 All objects which do not have dynamic storage duration, do not have thread storage duration, and are 
 7040: not local have static storage duration. The storage for these objects shall last for the duration of the 
 7041: program (3.6.2, 3.6.3). 
 7042: 2 If an object of static storage duration has initialization or a destructor with side effects, it shall not be 
 7043: eliminated even if it appears to be unused, except that a class object or its copy may be eliminated as 
 7044: specified in 12.8. 
 7045: 3 The keyword static can be used to declare a local variable with static storage duration. [ Note: 6.7describes 
 7046: the initialization of local static variables; 3.6.3 describes the destruction of local static variables. 〞end 
 7047: note ] 
 7048: 4 The keyword static applied to a class data member in a class definition gives the data member static 
 7049: storage duration. 
 7050: 3.7.2 Thread storage duration [basic.stc.thread] 
 7051: 1 All objects and references declared with the thread_local keyword have thread storage duration. The 
 7052: storage for these objects and references shall last for the duration of the thread in which they are created. 
 7053: There is a distinct object or reference per thread, and use of the declared name refers to the object or 
 7054: reference associated with the current thread. 
 7055: 2 An object or reference with thread storage duration shall be initialized before its first use and, if constructed, 
 7056: shall be destroyed on thread exit. 
 7057: 3.7.3 Automatic storage duration [basic.stc.auto] 
 7058: 1 Local objects explicitly declared register or not explicitly declared static or extern have automatic 
 7059: storage duration. The storage for these objects lasts until the block in which they are created exits. 
 7060: 2 [ Note: these objects are initialized and destroyed as described in 6.7. 〞end note ] 
 7061: ∫ 3.7.3 63 
 7062: 
 7063: c
 7064: . ISO/IEC N2800=08-0310 
 7065: 3 If a named automatic object has initialization or a destructor with side effects, it shall not be destroyed 
 7066: before the end of its block, nor shall it be eliminated as an optimization even if it appears to be unused, 
 7067: except that a class object or its copy may be eliminated as specified in 12.8. 
 7068: 3.7.4 Dynamic storage duration [basic.stc.dynamic] 
 7069: 1 Objects can be created dynamically during program execution (1.9), using new-expressions (5.3.4), and 
 7070: destroyed using delete-expressions (5.3.5). A C++ implementation provides access to, and management 
 7071: of, dynamic storage via the global allocation functions operator new and operator new[] and the global 
 7072: deallocation functions operator delete and operator delete[]. 
 7073: 2 The library provides default definitions for the global allocation and deallocation functions. Some global 
 7074: allocation and deallocation functions are replaceable (18.5.1). A C++ program shall provide at most one 
 7075: definition of a replaceable allocation or deallocation function. Any such function definition replaces the 
 7076: default version provided in the library (17.6.4.6). The following allocation and deallocation functions (18.5) 
 7077: are implicitly declared in global scope in each translation unit of a program. 
 7078: void* operator new(std::size_t) throw(std::bad_alloc);
 7079: void* operator new[](std::size_t) throw(std::bad_alloc);
 7080: void operator delete(void*) throw();
 7081: void operator delete[](void*) throw();
 7082: These implicit declarations introduce only the function names operator new, operator new[], operator 
 7083: delete, operator delete[].[ Note: the implicit declarations do not introduce the names std, std::bad_-
 7084: alloc, and std::size_t, or any other names that the library uses to declare these names. Thus, a new-
 7085: expression, delete-expression or function call that refers to one of these functions without including the 
 7086: header <new> is well-formed. However, referring to std, std::bad_alloc, and std::size_t is ill-formed 
 7087: unless the name has been declared by including the appropriate header. 〞end note ] Allocation and/or 
 7088: deallocation functions can also be declared and defined for any class (12.5). 
 7089: 3 Any allocation and/or deallocation functions defined in a C++ program, including the default versions in 
 7090: the library, shall conform to the semantics specified in 3.7.4.1 and 3.7.4.2. 
 7091: 3.7.4.1 Allocation functions [basic.stc.dynamic.allocation] 
 7092: 1 An allocation function shall be a class member function or a global function; a program is ill-formed if an 
 7093: allocation function is declared in a namespace scope other than global scope or declared static in global 
 7094: scope. The return type shall be void*. The first parameter shall have type std::size_t (18.1). The first 
 7095: parameter shall not have an associated default argument (8.3.6). The value of the first parameter shall be 
 7096: interpreted as the requested size of the allocation. An allocation function can be a function template. Such 
 7097: a template shall declare its return type and first parameter as specified above (that is, template parameter 
 7098: types shall not be used in the return type and first parameter type). Template allocation functions shall 
 7099: have two or more parameters. 
 7100: 2 The allocation function attempts to allocate the requested amount of storage. If it is successful, it shall 
 7101: return the address of the start of a block of storage whose length in bytes shall be at least as large as 
 7102: the requested size. There are no constraints on the contents of the allocated storage on return from the 
 7103: allocation function. The order, contiguity, and initial value of storage allocated by successive calls to an 
 7104: allocation function are unspecified. The pointer returned shall be suitably aligned so that it can be converted 
 7105: to a pointer of any complete object type with a fundamental alignment requirement (3.11) and then used 
 7106: to access the object or array in the storage allocated (until the storage is explicitly deallocated by a call to 
 7107: a corresponding deallocation function). Even if the size of the space requested is zero, the request can fail. 
 7108: If the request succeeds, the value returned shall be a non-null pointer value (4.10) p0 different from any 
 7109: ∫ 3.7.4.1 64 
 7110: 
 7111: c
 7112: . ISO/IEC N2800=08-0310 
 7113: previously returned value p1, unless that value p1 was subsequently passed to an operator delete. The 
 7114: effect of dereferencing a pointer returned as a request for zero size is undefined.32 
 7115: 3 An allocation function that fails to allocate storage can invoke the currently installed new-handler func-
 7116: tion (18.5.2.2), if any. [ Note: A program-supplied allocation function can obtain the address of the currently 
 7117: installed new_handler using the std::set_new_handler function (18.5.2.3). 〞end note ] If an allocation 
 7118: function declared with an empty exception-specification (15.4), throw(), fails to allocate storage, it shall 
 7119: return a null pointer. Any other allocation function that fails to allocate storage shall indicate failure only 
 7120: by throwing an exception of a type that would match a handler (15.3) of type std::bad_alloc (18.5.2.1). 
 7121: 4 A global allocation function is only called as the result of a new expression (5.3.4), or called directly using the 
 7122: function call syntax (5.2.2), or called indirectly through calls to the functions in the C++ standard library. 
 7123: [ Note: in particular, a global allocation function is not called to allocate storage for objects with static 
 7124: storage duration (3.7.1), for objects or references with thread storage duration (3.7.2) for objects of type 
 7125: std::type_info (5.2.8), or for the copy of an object thrown by a throw expression (15.1). 〞 end note ] 
 7126: 3.7.4.2 Deallocation functions [basic.stc.dynamic.deallocation] 
 7127: 1 Deallocation functions shall be class member functions or global functions; a program is ill-formed if deal-
 7128: location functions are declared in a namespace scope other than global scope or declared static in global 
 7129: scope. 
 7130: 2 Each deallocation function shall return void and its first parameter shall be void*. A deallocation function 
 7131: can have more than one parameter. If a class T has a member deallocation function named operator delete 
 7132: with exactly one parameter, then that function is a usual (non-placement) deallocation function. If class T 
 7133: does not declare such an operator delete but does declare a member deallocation function named operator 
 7134: delete with exactly two parameters, the second of which has type std::size_t (18.1), then this function 
 7135: is a usual deallocation function. Similarly, if a class T has a member deallocation function named operator 
 7136: delete[] with exactly one parameter, then that function is a usual (non-placement) deallocation function. 
 7137: If class T does not declare such an operator delete[] but does declare a member deallocation function 
 7138: named operator delete[] with exactly two parameters, the second of which has type std::size_t, then 
 7139: this function is a usual deallocation function. A deallocation function can be an instance of a function 
 7140: template. Neither the first parameter nor the return type shall depend on a template parameter. [ Note: 
 7141: that is, a deallocation function template shall have a first parameter of type void* and a return type of 
 7142: void (as specified above). 〞end note ] A deallocation function template shall have two or more function 
 7143: parameters. A template instance is never a usual deallocation function, regardless of its signature. 
 7144: 3 If a deallocation function terminates by throwing an exception, the behavior is undefined. The value of the 
 7145: first argument supplied to a deallocation function may be a null pointer value; if so, and if the deallocation 
 7146: function is one supplied in the standard library, the call has no effect. Otherwise, the value supplied 
 7147: to operator delete(void*) in the standard library shall be one of the values returned by a previous 
 7148: invocation of either operator new(std::size_t) or operator new(std::size_t, const std::nothrow_-
 7149: t&) in the standard library, and the value supplied to operator delete[](void*) in the standard library 
 7150: shall be one of the values returned by a previous invocation of either operator new[](std::size_t) or 
 7151: operator new[](std::size_t, const std::nothrow_t&) in the standard library. 
 7152: 4 If the argument given to a deallocation function in the standardlibraryis a pointer thatis not the null pointer 
 7153: value (4.10), the deallocation function shall deallocate the storage referenced by the pointer, rendering invalid 
 7154: 32) The intent is to have operator new() implementable by calling std::malloc() or std::calloc(), so the rules are sub-
 7155: stantially the same. C++ differs from C in requiring a zero request to return a non-null pointer. 
 7156: ∫ 3.7.4.2 65 
 7157: 
 7158: c
 7159: . ISO/IEC N2800=08-0310 
 7160: all pointers referring to any part of the deallocated storage. The effect of using an invalid pointer value 
 7161: (including passing it to a deallocation function) is undefined.33 
 7162: 3.7.4.3 Safely-derived pointers [basic.stc.dynamic.safety] 
 7163: 1 A traceable pointer object is 
 7164: 〞 an object of pointer-to-object type, or 
 7165: 〞 an object of an integral type that is at least as large as std::intptr_t, or 
 7166: 〞 a sequence of elements in an array of character type, where the size and alignment of the sequence 
 7167: match that of some pointer-to-object type. 
 7168: 2 A pointer value is a safely-derived pointer to a dynamic object only if it has pointer-to-object type and it is 
 7169: one of the following: 
 7170: 〞 the value returned by a call to the C++ standard library implementation of ::operator new(std::size_-
 7171: t);34 
 7172: 〞 the result of taking the address of a subobject of an lvalue resulting from dereferencing a safely-derived 
 7173: pointer value; 
 7174: 〞 the result of well-defined pointer arithmetic using a safely-derived pointer value; 
 7175: 〞 the result of a well-defined pointer conversion of a safely-derived pointer value; 
 7176: 〞 the result of a reinterpret_cast of a safely-derived pointer value; 
 7177: 〞 the result of a reinterpret_cast of an integer representation of a safely-derived pointer value; 
 7178: 〞 the value of an object whose value was copied from a traceable pointer object, where at the time of 
 7179: the copy the source object contained a copy of a safely-derived pointer value. 
 7180: 3 An integer value is an integer representation of a safely-derived pointer only if its type is at least as large as 
 7181: std::intptr_t and it is one of the following: 
 7182: 〞 the result of a reinterpret_cast of a safely-derived pointer value; 
 7183: 〞 the result of a valid conversion of an integer representation of a safely-derived pointer value; 
 7184: 〞 the value of an object whose value was copied from a traceable pointer object, where at the time of 
 7185: the copy the source object contained an integer representation of a safely-derived pointer value; 
 7186: 〞 the result of an additive or bitwise operation, one of whose operands is an integer representation of a 
 7187: safely-derived pointer value P, if that result converted by reinterpret_cast<void*> would compare 
 7188: equal to a safely-derived pointer computable from reinterpret_cast<void*>(P). 
 7189: 4 If a pointer value that is not a safely-derived pointer value is dereferenced or deallocated, and the referenced 
 7190: complete object is of dynamic storage duration and has not previously been declared reachable (20.7.13.7), 
 7191: the behavior is undefined. [ Note: this is true even if the unsafely-derived pointer value might compare equal 
 7192: to some safely-derived pointer value. 〞 end note ] 
 7193: 33) On some implementations, it causes a system-generated runtime fault. 
 7194: 34) This section does not impose restrictions on dereferencing pointers to memory not allocated by ::operator new. This 
 7195: maintains the ability of many C++ implementations to use binary libraries and components written in other languages. In 
 7196: particular, this applies to C binaries, because dereferencing pointers to memory allocated by malloc is not restricted. 
 7197: ∫ 3.7.4.3 66 
 7198: 
 7199: c
 7200: . ISO/IEC 
 7201: 3.7.5 Duration of subobjects 
 7202: 1 The storage duration of member subobjects, base class subobobject (1.8). 
 7203: 3.8 Object lifetime 
 7204: N2800=08-0310 
 7205: [basic.stc.inherit] 
 7206: jects and array elements is that of their complete 
 7207: [basic.life] 
 7208: 1 The lifetime of an object is a runtime property of the object. An object is said to have non-trivial initialization 
 7209: if it is of a class or aggregate type and it or one of its members is initialized by a constructor other than 
 7210: a trivial default constructor. [ Note: initialization by a trivial copy constructor is non-trivial initialization. 
 7211: 〞end note ] The lifetime of an object of type T begins when: 
 7212: 〞 storage with the proper alignment and size for type T is obtained, and 
 7213: 〞 if the object has non-trivial initialization, its initialization is complete.
 7214: The lifetime of an object of type T ends when:
 7215: 〞 if T is a class type with a non-trivial destructor (12.4), the destructor call starts, or 
 7216: 〞 the storage which the object occupies is reused or released. 
 7217: 2 [ Note: the lifetime of an array object starts as soon as storage with proper size and alignment is obtained, 
 7218: and its lifetime ends when the storage which the array occupies is reused or released. 12.6.2 describes the 
 7219: lifetime of base and member subobjects. 〞end note ] 
 7220: 3 The properties ascribed to objects throughout this International Standard apply for a given object only 
 7221: during its lifetime. [ Note: in particular, before the lifetime of an object starts and after its lifetime ends 
 7222: there are significant restrictions on the use of the object, as described below, in 12.6.2 and in 12.7. Also, 
 7223: the behavior of an object under construction and destruction might not be the same as the behavior of an 
 7224: object whose lifetime has started and not ended. 12.6.2 and 12.7 describe the behavior of objects during the 
 7225: construction and destruction phases. 〞end note ] 
 7226: 4 A program may end the lifetime of any object by reusing the storage which the object occupies or by 
 7227: explicitly calling the destructor for an object of a class type with a non-trivial destructor. For an object 
 7228: of a class type with a non-trivial destructor, the program is not required to call the destructor explicitly 
 7229: before the storage which the object occupies is reused or released; however, if there is no explicit call to 
 7230: the destructor or if a delete-expression (5.3.5) is not used to release the storage, the destructor shall not be 
 7231: implicitly called and any program that depends on the side effects produced by the destructor has undefined 
 7232: behavior. 
 7233: 5 Before the lifetime of an object has started but after the storage which the object will occupy has been 
 7234: allocated35 or, after the lifetime of an object has ended and before the storage which the object occupied is 
 7235: reused or released, any pointer that refers to the storage location where the object will be or was located 
 7236: may be used but only in limited ways. Such a pointer refers to allocated storage (3.7.4.2), and using the 
 7237: pointer as if the pointer were of type void*, is well-defined. Such a pointer may be dereferenced but the 
 7238: resulting lvalue may only be used in limited ways, as described below. The program has undefined behavior 
 7239: if: 
 7240: 〞 the object will be or was of a class type with a non-trivial destructor and the pointer is used as the 
 7241: operand of a delete-expression, 
 7242: 〞 the pointer is used to access a non-static data member or call a non-static member function of the 
 7243: object, or 
 7244: 〞 the pointer is implicitly converted (4.10) to a pointer to a base class type, or 
 7245: 35) For example, before the construction of a global object of non-POD class type (12.7). 
 7246: ∫ 3.8 67 
 7247: 
 7248: c
 7249: . ISO/IEC N2800=08-0310 
 7250: 〞 the pointer is used as the operand of a static_cast (5.2.9) (except when the conversion is to void*, 
 7251: or to void* and subsequently to char*, or unsigned char*), or 
 7252: 〞 the pointer is used as the operand of a dynamic_cast (5.2.7). [ Example: 
 7253: #include <cstdlib> 
 7254: struct B { 
 7255: virtual void f(); 
 7256: void mutate(); 
 7257: virtual ~B(); 
 7258: }; 
 7259: struct D1 : B { void f(); };
 7260: struct D2 : B { void f(); };
 7261: void B::mutate() { 
 7262: new (this) D2; // reuses storage 〞 ends the lifetime of *this 
 7263: f(); // undefined behavior 
 7264: ... = this; // OK, this points to valid memory 
 7265: } 
 7266: void g() { 
 7267: void* p = std::malloc(sizeof(D1) + sizeof(D2)); 
 7268: B* pb = new (p) D1; 
 7269: pb->mutate(); 
 7270: &pb; // OK: pb points to valid memory 
 7271: void* q = pb; // OK: pb points to valid memory 
 7272: pb->f(); // undefined behavior, lifetime of *pb has ended 
 7273: } 
 7274: 〞end example ] 
 7275: 6 Similarly, before the lifetime of an object has started but after the storage which the object will occupy 
 7276: has been allocated or, after the lifetime of an object has ended and before the storage which the object 
 7277: occupied is reused or released, any lvalue which refers to the original object may be used but only in limited 
 7278: ways. Such an lvalue refers to allocated storage (3.7.4.2), and using the properties of the lvalue which do 
 7279: not depend on its value is well-defined. The program has undefined behavior if: 
 7280: 〞 an lvalue-to-rvalue conversion (4.1) is applied to such an lvalue, 
 7281: 〞 the lvalue is used to access a non-static data member or call a non-static member function of the 
 7282: object, or 
 7283: 〞 the lvalue is implicitly converted (4.10) to a reference to a base class type, or 
 7284: 〞 the lvalue is used as the operand of a static_cast (5.2.9) except when the conversion is ultimately 
 7285: to cv char& or cv unsigned char&, or 
 7286: 〞 the lvalue is used as the operand of a dynamic_cast (5.2.7) or as the operand of typeid. 
 7287: 7 If, after the lifetime of an object has ended and before the storage which the object occupied is reused or 
 7288: released, a new object is created at the storage location which the original object occupied, a pointer that 
 7289: pointed to the original object, a reference that referred to the original object, or the name of the original 
 7290: object will automatically refer to the new object and, once the lifetime of the new object has started, can 
 7291: be used to manipulate the new object, if: 
 7292: ∫ 3.8 68 
 7293: 
 7294: c
 7295: . ISO/IEC N2800=08-0310 
 7296: 〞 the storage for the new object exactly overlays the storage location which the original object occupied, 
 7297: and 
 7298: 〞 the new object is of the same type as the original object (ignoring the top-level cv-qualifiers), and 
 7299: 〞 the type of the original object is not const-qualified, and, if a class type, does not contain any non-static 
 7300: data member whose type is const-qualified or a reference type, and 
 7301: 〞 the original object was a most derived object (1.8) of type T and the new object is a most derived 
 7302: object of type T (that is, they are not base class subobjects). [ Example: 
 7303: struct C {
 7304: int i;
 7305: void f();
 7306: const C& operator=( const C& );
 7307: }; 
 7308: const C& C::operator=( const C& other) { 
 7309: if ( this != &other ) {
 7310: this->~C(); // lifetime of *this ends
 7311: new (this) C(other); // new object of type C created
 7312: f(); // well-defined
 7313: }
 7314: return *this;
 7315: }
 7316: C c1;
 7317: C c2;
 7318: c1 = c2; // well-defined
 7319: c1.f(); // well-defined; c1 refers to a new object of type C
 7320: 〞end example ] 
 7321: 8 If a program ends the lifetime of an object of type T with static (3.7.1), thread (3.7.2), or automatic (3.7.3) 
 7322: storage duration and if T has a non-trivial destructor,36 the program must ensure that an object of the 
 7323: original type occupies that same storage location when the implicit destructor call takes place; otherwise the 
 7324: behavior of the program is undefined. This is true even if the block is exited with an exception. [ Example: 
 7325: class T { };
 7326: struct B {
 7327: ~B();
 7328: };
 7329: void h() {
 7330: B b;
 7331: new (&b) T;
 7332: } // undefined behavior at block exit 
 7333: 〞end example ] 
 7334: 9 Creating a new object at the storage location that a const object with static, thread, or automatic storage 
 7335: duration occupies or, at the storage location that such a const object used to occupy before its lifetime 
 7336: ended results in undefined behavior. [ Example: 
 7337: 36) That is, an object for which a destructor will be called implicitly〞upon exit from the block for an object with automatic 
 7338: storage duration, upon exit from the thread for an object with thread storage duration, or upon exit from the program for an 
 7339: object with static storage duration. 
 7340: ∫ 3.8 69 
 7341: 
 7342: c
 7343: . ISO/IEC N2800=08-0310 
 7344: struct B {
 7345: B();
 7346: ~B();
 7347: }; 
 7348: const B b; 
 7349: void h() {
 7350: b.~B();
 7351: new (&b) const B; // undefined behavior
 7352: } 
 7353: 〞end example ] 
 7354: 3.9 Types [basic.types] 
 7355: 1 [ Note: 3.9 and the subclauses thereof impose requirements on implementations regarding the representation 
 7356: of types. There are two kinds of types: fundamental types and compound types. Types describe objects 
 7357: (1.8), references (8.3.2), or functions (8.3.5). In a constrained context (14.10), type archetypes are class 
 7358: types; however, a type archetype that has a compiler-supported requirement (i.e., a type archetype T＊ in a 
 7359: context where some requirement C<T> is in scope) may be used in certain contexts where a class type is 
 7360: normallly not permitted or may be disallowed in certain contexts where a class type is normally permitted. 
 7361: Such contexts are explicitly noted in this International Standard. 〞end note ] 
 7362: 2 For any object (other than a base-class subobject) of trivially copyable type T, whether the object holds a 
 7363: valid value of type T, the underlying bytes (1.7) making up the object can be copied into an array of char 
 7364: or unsigned char.37 If the content of the array of char or unsigned char is copied back into the object, 
 7365: the object shall subsequently hold its original value. [ Example: 
 7366: #define N sizeof(T)
 7367: char buf[N];
 7368: T obj; // obj initialized to its original value
 7369: std::memcpy(buf, &obj, N); // between these two calls to std::memcpy,
 7370: // obj might be modified
 7371: std::memcpy(&obj, buf, N); // at this point, each subobject of obj of scalar type
 7372: // holds its original value
 7373: 〞end example ] 
 7374: 3 For any trivially copyable type T, if two pointers to T point to distinct T objects obj1 and obj2, where neither 
 7375: obj1 nor obj2 is a base-class subobject, if the value of obj1 is copied into obj2, using the std::memcpy 
 7376: library function, obj2 shall subsequently hold the same value as obj1.[ Example: 
 7377: T* t1p;
 7378: T* t2p;
 7379: // provided that t2p points to an initialized object ...
 7380: std::memcpy(t1p, t2p, sizeof(T));
 7381: // at this point, every subobject of trivially copyable type in *t1p contains
 7382: // the same value as the corresponding subobject in *t2p
 7383: 〞end example ] 
 7384: 4 The object representation of an object of type T is the sequence of N unsigned char objects taken up by 
 7385: the object of type T, where N equals sizeof(T). The value representation of an object is the set of bits that 
 7386: 37) By using, for example, the library functions (17.6.2.3) std::memcpy or std::memmove. 
 7387: ∫ 3.9 70 
 7388: 
 7389: c
 7390: . ISO/IEC N2800=08-0310 
 7391: hold the value of type T. For trivially copyable types, the value representation is a set of bits in the object 
 7392: representation that determines a value, which is one discrete element of an implementation-defined set of 
 7393: values.38 
 7394: 5 A class that has been declared but not defined, or an array of unknown size or of incomplete element type, is
 7395: an incompletely-defined object type.39 Incompletely-defined object types and the void types are incomplete
 7396: types (3.9.1). Objects shall not be defined to have an incomplete type.
 7397: 6 A class type (such as ※class X§) might be incomplete at one point in a translation unit and complete later
 7398: on; the type ※class X§ is the same type at both points. The declared type of an array object might be
 7399: an array of incomplete class type and therefore incomplete; if the class type is completed later on in the
 7400: translation unit, the array type becomes complete; the array type at those two points is the same type. The
 7401: declared type of an array object might be an array of unknown size and therefore be incomplete at one point
 7402: in a translation unit and complete later on; the array types at those two points (※array of unknown bound
 7403: of T§ and ※array of N T§) are different types. The type of a pointer to array of unknown size, or of a type
 7404: defined by a typedef declaration to be an array of unknown size, cannot be completed. [ Example:
 7405: class X; // X is an incomplete type
 7406: extern X* xp; // xp is a pointer to an incomplete type
 7407: extern int arr[]; // the type of arr is incomplete
 7408: typedef int UNKA[]; // UNKA is an incomplete type
 7409: UNKA* arrp; // arrp is a pointer to an incomplete type
 7410: UNKA** arrpp;
 7411: void foo() {
 7412: xp++; // ill-formed: X is incomplete
 7413: arrp++; // ill-formed: incomplete type
 7414: arrpp++; // OK: sizeof UNKA* is known
 7415: } 
 7416: struct X { int i; }; // now X is a complete type
 7417: int arr[10]; // now the type of arr is complete
 7418: X x; 
 7419: void bar() {
 7420: xp = &x; // OK; type is ※pointer to X§
 7421: arrp = &arr; // ill-formed: different types
 7422: xp++; // OK: X is complete
 7423: arrp++; // ill-formed: UNKA can＊t be completed
 7424: } 
 7425: 〞end example ]
 7426: 7 [ Note: the rules for declarations and expressions describe in which contexts incomplete types are prohibited.
 7427: 〞end note ] 
 7428: 8 An object type is a (possibly cv-qualified) type that is not a function type, not a reference type, and not a
 7429: void type.
 7430: 9 An effective object type T is a non-archetype object type or a (possibly cv-qualified) type archetype (14.10.2)
 7431: that has the requirement std::ObjectType<T>.
 7432: 10 Arithmetic types (3.9.1), enumeration types, pointer types, pointer to member types (3.9.2), and std::nullptr_-
 7433: t, and cv-qualified versions of these types (3.9.3) are collectively called scalar types. Scalar types, POD 
 7434: 38) The intent is that the memory model of C++ is compatible with that of ISO/IEC 9899 Programming Language C. 
 7435: 39) The size and layout of an instance of an incompletely-defined object type is unknown. 
 7436: ∫ 3.9 71 
 7437: 
 7438: c
 7439: . ISO/IEC N2800=08-0310 
 7440: classes (Clause 9), arrays of such types and cv-qualified versions of these types (3.9.3) are collectively called 
 7441: POD types. Scalar types, trivially copyable class types (Clause 9), arrays of such types, and cv-qualified 
 7442: versions of these types (3.9.3) are collectively called trivially copyable types. Scalar types, trivial class types 
 7443: (Clause 9), arrays of such types and cv-qualified versions of these types (3.9.3) are collectively called trivial 
 7444: types. Scalar types, standard-layout class types (Clause 9), arrays of such types and cv-qualified versions of 
 7445: these types (3.9.3) are collectively called standard-layout types. 
 7446: 11 An effective trivial type T is a trivial type or a (possibly cv-qualified) type archetype (14.10.2) that has the 
 7447: requirement std::TrivialType<T>. 
 7448: 12 A type is a literal type if it is: 
 7449: 〞 a scalar type; or 
 7450: 〞 a class type (Clause 9) with 
 7451: 〞 a trivial copy constructor, 
 7452: 〞 a trivial destructor, 
 7453: 〞 a trivial default constructor or at least one constexpr constructor other than the copy constructor, 
 7454: and 
 7455: 〞 all non-static data members and base classes of literal types; or 
 7456: 〞 an array of literal type. 
 7457: 13 An effective literal type T is a non-archetype literal type or a (possibly cv-qualified) type archetype (14.10.2) 
 7458: that has the requirement std::LiteralType<T>. 
 7459: 14 If two types T1 and T2 are the same type, then T1 and T2 are layout-compatible types. [ Note: Layout-
 7460: compatible enumerations are described in 7.2. Layout-compatible standard-layout structs and standard-
 7461: layout unions are described in 9.2. 〞end note ] 
 7462: 3.9.1 Fundamental types [basic.fundamental] 
 7463: 1 Objects declared as characters (char) shall be large enough to store any member of the implementation＊s ba-
 7464: sic character set. If a character from this set is stored in a character object, the integral value of that character 
 7465: object is equal to the value of the single character literal form of that character. It is implementation-defined 
 7466: whether a char object can hold negative values. Characters can be explicitly declared unsigned or signed. 
 7467: Plain char, signed char, and unsigned char are three distinct types. A char, a signed char, and an 
 7468: unsigned char occupy the same amount of storage and have the same alignment requirements (3.11); that 
 7469: is, they have the same object representation. For character types, all bits of the object representation par-
 7470: ticipate in the value representation. For unsigned character types, all possible bit patterns of the value 
 7471: representation represent numbers. These requirements do not hold for other types. In any particular imple-
 7472: mentation, a plain char object can take on either the same values as a signed char or an unsigned char; 
 7473: which one is implementation-defined. 
 7474: 2 There are five standard signed integer types : ※signed char§, ※short int§, ※int§, ※long int§, and ※long 
 7475: long int§. In this list, each type provides at least as much storage as those preceding it in the list. There 
 7476: may also be implementation-defined extended signed integer types. The standard and extended signed 
 7477: integer types are collectively called signed integer types. Plain ints have the natural size suggested by the 
 7478: architecture of the execution environment40; the other signed integer types are provided to meet special 
 7479: needs. 
 7480: 40) that is, large enough to contain any value in the range of INT_MIN and INT_MAX, as defined in the header <climits>. 
 7481: ∫ 3.9.1 72 
 7482: 
 7483: c
 7484: . ISO/IEC N2800=08-0310 
 7485: 3 For each of the standard signed integer types, there exists a corresponding (but different) standard un-
 7486: signed integer type:※unsigned char§, ※unsigned short int§, ※unsigned int§, ※unsigned long int§, 
 7487: and ※unsigned long long int§, each of which occupies the same amount of storage and has the same 
 7488: alignment requirements (3.11) as the corresponding signed integer type41; that is, each signed integer type 
 7489: has the same object representation as its corresponding unsigned integer type. Likewise, for each of the 
 7490: extended signed integer types there exists a corresponding extended unsigned integer type with the same 
 7491: amount of storage and alignment requirements. The standard and extended unsigned integer types are 
 7492: collectively called unsigned integer types. The range of nonnegative values of a signed integer type is a 
 7493: subrange of the corresponding unsigned integer type, and the value representation of each corresponding 
 7494: signed/unsigned type shall be the same. The standard signed integer types and standard unsigned integer 
 7495: types are collectively called the standard integer types, and the extended signed integer types and extended 
 7496: unsigned integer types are collectively called the extended integer types. 
 7497: 4 Unsigned integers, declared unsigned, shall obey the laws of arithmetic modulo 2n where n is the number 
 7498: of bits in the value representation of that particular size of integer.42 
 7499: 5 Type wchar_t is a distinct type whose values can represent distinct codes for all members of the largest 
 7500: extended character set specified among the supported locales (22.1.1). Type wchar_t shall have the same 
 7501: size, signedness, and alignment requirements (3.11) as one of the other integral types, called its underlying 
 7502: type. Types char16_t and char32_t denote distinct types with the same size, signedness, and alignment as 
 7503: uint_least16_t and uint_least32_t, respectively, in <stdint.h>, called the underlying types. 
 7504: 6 Values of type bool are either true or false.43 [ Note: there are no signed, unsigned, short, or long 
 7505: bool types or values. 〞end note ] Values of type bool participate in integral promotions (4.5). 
 7506: 7 Types bool, char, char16_t, char32_t, wchar_t, and the signed and unsigned integer types are collectively 
 7507: called integral types.44 A synonym for integral type is integer type. The representations of integral types 
 7508: shall define values by use of a pure binary numeration system.45 [ Example: this International Standard 
 7509: permits 2＊s complement, 1＊s complement and signed magnitude representations for integral types. 〞end 
 7510: example ] 
 7511: 8 An effective integral type T is an integral type or a (possibly cv-qualified) type archetype (14.10.2) that has 
 7512: the requirement std::IntegralType<T>. 
 7513: 9 There are three floating point types: float, double, and long double. The type double provides at least 
 7514: as much precision as float, and the type long double provides at least as much precision as double. 
 7515: The set of values of the type float is a subset of the set of values of the type double; the set of values 
 7516: of the type double is a subset of the set of values of the type long double. The value representation of 
 7517: floating-point types is implementation-defined. Integral and floating types are collectively called arithmetic 
 7518: types. Specializations of the standard template std::numeric_limits (18.2) shall specify the maximum 
 7519: and minimum values of each arithmetic type for an implementation. 
 7520: 10 The void type has an empty set of values. The void type is an incomplete type that cannot be completed. It 
 7521: is used as the return type for functions that do not return a value. Any expression can be explicitly converted 
 7522: to type cv void (5.4). An expression of type void shall be used only as an expression statement (6.2), as an 
 7523: 41) See 7.1.6.2 regarding the correspondence between types and the sequences of type-specifiers that designate them. 
 7524: 42) This implies that unsigned arithmetic does not overflow because a result that cannot be represented by the resulting 
 7525: unsigned integer type is reduced modulo the number that is one greater than the largest value that can be represented by the 
 7526: resulting unsigned integer type. 
 7527: 43) Using a bool value in ways described by this International Standard as ※undefined,§ such as by examining the value of an 
 7528: uninitialized automatic variable, might cause it to behave as if it is neither true nor false. 
 7529: 44) Therefore, enumerations (7.2) are not integral; however, enumerations can be promoted to integral types as specified in 4.5. 
 7530: 45) A positional representation for integers that uses the binary digits 0 and 1, in which the values represented by successive 
 7531: bits are additive, begin with 1, and are multiplied by successive integral power of 2, except perhaps for the bit with the highest 
 7532: position. (Adapted from the American National Dictionary for Information Processing Systems.) 
 7533: ∫ 3.9.1 73 
 7534: 
 7535: c
 7536: . ISO/IEC N2800=08-0310 
 7537: operand of a comma expression (5.18), as a second or third operand of ?: (5.16), as the operand of typeid, 
 7538: or as the expression in a return statement (6.6.3) for a function with the return type void. 
 7539: 11 A value of type std::nullptr_t is a null pointer constant (4.10). Such values participate in the pointer and 
 7540: the pointer to member conversions (4.10, 4.11). sizeof(std::nullptr_t) shall be equal to sizeof(void*). 
 7541: 12 [ Note: even if the implementation defines two or more basic types to have the same value representation, 
 7542: they are nevertheless different types. 〞 end note ] 
 7543: 3.9.2 Compound types [basic.compound] 
 7544: 1 Compound types can be constructed in the following ways: 
 7545: 〞 arrays of objects of a given type, 8.3.4; 
 7546: 〞 functions, which have parameters of given types and return void or references or objects of a given 
 7547: type, 8.3.5; 
 7548: 〞 pointers to void or objects or functions (including static members of classes) of a given type, 8.3.1; 
 7549: 〞 references to objects or functions of a given type, 8.3.2. There are two types of references: 
 7550: 〞 lvalue reference 
 7551: 〞 rvalue reference 
 7552: 〞 classes containing a sequence of objects of various types (Clause 9), a set of types, enumerations and 
 7553: functions for manipulating these objects (9.3), and a set of restrictions on the access to these entities 
 7554: (Clause 11); 
 7555: 〞 unions, which are classes capable of containing objects of different types at different times, 9.5; 
 7556: 〞 enumerations, which comprise a set of named constant values. Each distinct enumeration constitutes 
 7557: a different enumerated type, 7.2; 
 7558: 〞 pointers to non-static 46 class members, which identify members of a given type within objects of a 
 7559: given class, 8.3.3. 
 7560: 2 These methods of constructing types can be applied recursively; restrictions are mentioned in 8.3.1, 8.3.4, 
 7561: 8.3.5, and 8.3.2. 
 7562: 3 A pointer to objects of type T is referred to as a ※pointer to T.§ [ Example: a pointer to an object of type 
 7563: int is referred to as ※pointer to int § and a pointer to an object of class X is called a ※pointer to X.§ 〞end 
 7564: example ] Except for pointers to static members, text referring to ※pointers§ does not apply to pointers to 
 7565: members. Pointers to incomplete types are allowed although there are restrictions on what can be done with 
 7566: them (3.11). A valid value of an object pointer type represents either the address of a byte in memory (1.7) 
 7567: or a null pointer (4.10). If an object of type T is located at an address A, a pointer of type cv T* whose 
 7568: value is the address A is said to point to that object, regardless of how the value was obtained. [ Note: 
 7569: for instance, the address one past the end of an array (5.7) would be considered to point to an unrelated 
 7570: object of the array＊s element type that might be located at that address. There are further restrictions 
 7571: on pointers to objects with dynamic storage duration; see 3.7.4.3. 〞 end note ] The value representation 
 7572: of pointer types is implementation-defined. Pointers to cv-qualified and cv-unqualified versions (3.9.3) of 
 7573: layout-compatible types shall have the same value representation and alignment requirements (3.11). [ Note: 
 7574: pointers to over-aligned types have no special representation, but their range of valid values is restricted 
 7575: by the extended alignment requirement. This International Standard specifies only two ways of obtaining 
 7576: such a pointer: taking the address of a valid object with an over-aligned type, and using one of the runtime 
 7577: 46) Static class members are objects or functions, and pointers to them are ordinary pointers to objects or functions. 
 7578: ∫ 3.9.2 74 
 7579: 
 7580: c
 7581: . ISO/IEC N2800=08-0310 
 7582: pointer alignment functions. An implementation may provide other means of obtaining a valid pointer value 
 7583: for an over-aligned type. 〞 end note ] 
 7584: 4 Objects of cv-qualified (3.9.3) or cv-unqualified type void* (pointer to void), can be used to point to objects 
 7585: of unknown type. A void* shall be able to hold any object pointer. A cv-qualified or cv-unqualified (3.9.3) 
 7586: void* shall have the same representation and alignment requirements as a cv-qualified or cv-unqualified 
 7587: char*. 
 7588: 3.9.3 CV-qualifiers [basic.type.qualifier] 
 7589: 1 A type mentioned in 3.9.1 and 3.9.2 is a cv-unqualified type. Each type which is a cv-unqualified complete 
 7590: or incomplete object type or is void (3.9) has three corresponding cv-qualified versions of its type: a 
 7591: const-qualified version, a volatile-qualified version, and a const-volatile-qualified version. The term object 
 7592: type (1.8) includes the cv-qualifiers specified when the object is created. The presence of a const specifier 
 7593: in a decl-specifier-seq declares an object of const-qualified object type; such object is called a const object. 
 7594: The presence of a volatile specifier in a decl-specifier-seq declares an object of volatile-qualified object type; 
 7595: such object is called a volatile object. The presence of both cv-qualifiers in a decl-specifier-seq declares an 
 7596: object of const-volatile-qualified object type; such object is called a const volatile object. The cv-qualified or 
 7597: cv-unqualified versions of a type are distinct types; however, they shall have the same representation and 
 7598: alignment requirements (3.9).47 
 7599: 2 A compound type (3.9.2) is not cv-qualified by the cv-qualifiers (if any) of the types from which it is com-
 7600: pounded. Any cv-qualifiers applied to an array type affect the array element type, not the array type (8.3.4). 
 7601: 3 Each non-static, non-mutable, non-reference data member of a const-qualified class object is const-quali-
 7602: fied, each non-static, non-reference data member of a volatile-qualified class object is volatile-qualified and 
 7603: similarly for members of a const-volatile class. See 8.3.5 and 9.3.2 regarding cv-qualified function types. 
 7604: 4 There is a (partial) ordering on cv-qualifiers, so that a type can be said to be more cv-qualified than another. 
 7605: Table 8 shows the relations that constitute this ordering. 
 7606: Table 8 〞 Relations on const and volatile 
 7607: no cv-qualifier < const 
 7608: no cv-qualifier < volatile 
 7609: no cv-qualifier < const volatile 
 7610: const < const volatile 
 7611: volatile < const volatile 
 7612: 5 In this International Standard, the notation cv (or cv1, cv2, etc.), used in the description of types, represents 
 7613: an arbitrary set of cv-qualifiers, i.e., one of {const }, {volatile }, {const, volatile}, or the empty set. 
 7614: Cv-qualifiers applied to an array type attach to the underlying element type, so the notation ※cv T,§ where 
 7615: T is an array type, refers to an array whose elements are so-qualified. Such array types can be said to be 
 7616: more (or less) cv-qualified than other types based on the cv-qualification of the underlying element types. 
 7617: 3.10 Lvalues and rvalues [basic.lval] 
 7618: 1 Every expression is either an lvalue or an rvalue. 
 7619: 47) The same representation and alignment requirements are meant to imply interchangeability as arguments to functions, 
 7620: return values from functions, and members of unions. 
 7621: ∫ 3.10 75 
 7622: 
 7623: c
 7624: . ISO/IEC N2800=08-0310 
 7625: 2 An lvalue refers to an object or function. Some rvalue expressions〞those of (possibly cv-qualified) class or 
 7626: array type〞also refer to objects.48 
 7627: 3 [ Note: some built-in operators and function calls yield lvalues. [ Example: if E is an expression of pointer 
 7628: type, then *E is an lvalue expression referring to the object or function to which E points. As another 
 7629: example, the function 
 7630: int& f(); 
 7631: yields an lvalue, so the call f() is an lvalue expression. 〞end example ] 〞end note ] 
 7632: 4 [ Note: some built-in operators expect lvalue operands. [ Example: built-in assignment operators all expect 
 7633: their left-hand operands to be lvalues. 〞end example ] Other built-in operators yield rvalues, and some 
 7634: expect them. [ Example: the unary and binary + operators expect rvalue arguments and yield rvalue results. 
 7635: 〞end example ] The discussion of each built-in operator in Clause 5 indicates whether it expects lvalue 
 7636: operands and whether it yields an lvalue. 〞end note ] 
 7637: 5 The result of calling a function that does not return an lvalue reference is an rvalue. User defined operators 
 7638: are functions, and whether such operators expect or yield lvalues is determined by their parameter and 
 7639: return types. 
 7640: 6 An expression which holds a temporary object resulting from a cast to a type other than an lvalue reference 
 7641: type is an rvalue (this includes the explicit creation of an object using functional notation (5.2.3)). 
 7642: 7 Whenever an lvalue appears in a context where an rvalue is expected, the lvalue is converted to an rvalue; 
 7643: see 4.1, 4.2, and 4.3. 
 7644: 8 The discussion of reference initialization in 8.5.3 and of temporaries in 12.2 indicates the behavior of lvalues 
 7645: and rvalues in other significant contexts. 
 7646: 9 Class rvalues can have cv-qualified types; non-class rvalues always have cv-unqualified types. Rvalues shall 
 7647: always have complete types or the void type; in addition to these types, lvalues can also have incomplete 
 7648: types. 
 7649: 10 An lvalue for an object is necessary in order to modify the object except that an rvalue of class type can 
 7650: also be used to modify its referent under certain circumstances. [ Example: a member function called for an 
 7651: object (9.3) can modify the object. 〞end example ] 
 7652: 11 Functions cannot be modified, but pointers to functions can be modifiable. 
 7653: 12 A pointer to an incomplete type can be modifiable. At some point in the program when the pointed to type 
 7654: is complete, the object at which the pointer points can also be modified. 
 7655: 13 The referent of a const-qualified expression shall not be modified (through that expression), except that if 
 7656: it is of class type and has a mutable component, that component can be modified (7.1.6.1). 
 7657: 14 If an expression can be used to modify the object to which it refers, the expression is called modifiable. A 
 7658: program that attempts to modify an object through a nonmodifiable lvalue or rvalue expression is ill-formed. 
 7659: 15 If a program attempts to access the stored value of an object through an lvalue of other than one of the 
 7660: following types the behavior is undefined49 
 7661: 〞 the dynamic type of the object, 
 7662: 〞 a cv-qualified version of the dynamic type of the object, 
 7663: 48) Expressions such as invocations of constructors and of functions that return a class type refer to objects, and the imple-
 7664: mentation can invoke a member function upon such objects, but the expressions are not lvalues. 
 7665: 49) The intent of this list is to specify those circumstances in which an object may or may not be aliased. 
 7666: ∫ 3.10 76 
 7667: 
 7668: c
 7669: . ISO/IEC N2800=08-0310 
 7670: 〞 a type similar (as defined in 4.4) to the dynamic type of the object, 
 7671: 〞 a type that is the signed or unsigned type corresponding to the dynamic type of the object, 
 7672: 〞 a type that is the signed or unsigned type corresponding to a cv-qualified version of the dynamic type 
 7673: of the object, 
 7674: 〞 an aggregate or union type that includes one of the aforementioned types among its members (including, 
 7675: recursively, a member of a subaggregate or contained union), 
 7676: 〞 a type that is a (possibly cv-qualified) base class type of the dynamic type of the object, 
 7677: 〞 a char or unsigned char type. 
 7678: 3.11 Alignment [basic.align] 
 7679: 1 Object types have alignment requirements (3.9.1, 3.9.2) which place restrictions on the addressses at which 
 7680: an object of that type may be allocated. An aligment is an implementation-defined integer value representing 
 7681: the number of bytes between successive addresses at which a given object can be allocated. An object type 
 7682: imposes an alignment requirement on every object of that type; stricter alignment can be requested using 
 7683: the alignment attribute (7.6.2). 
 7684: 2 A fundamental alignment is represented by an alignment less than or equal to the greatest alignment sup-
 7685: ported by the implementation in all contexts, which is equal to alignof(std::max_align_t) (18.1). 
 7686: 3 An extended alignment is represented by an alignment greater than alignof(std::max_align_t). It is 
 7687: implementation-defined whether any extended alignments are supported and the contexts in which they are 
 7688: supported (7.6.2). A type having an extended alignment requirement is an over-aligned type.[ Note: every 
 7689: over-aligned type is or contains a class type with a non-static data member to which an extended alignment 
 7690: has been applied. 〞end note ] 
 7691: 4 Alignments are represented as values of the type std::size_t. Valid alignments include only those values 
 7692: returned by an alignof expression for the fundamental types plus an additional implementation-defined set 
 7693: of values which may be empty.50 
 7694: 5 Alignments have an order from weaker to stronger or stricter alignments. Stricter alignments have larger 
 7695: alignment values. An address that satisfies an alignment requirement also satisfies any weaker valid alignment 
 7696: requirement. 
 7697: 6 The alignment requirement of a complete type can be queried using an alignof expression (5.3.6). Fur-
 7698: thermore, the types char, signed char, and unsigned char shall have the weakest alignment require-
 7699: ment. [ Note: this enables the character types to be used as the underlying type for an aligned memory 
 7700: area (7.6.2). 〞 end note ] 
 7701: 7 Comparing alignments is meaningful and provides the obvious results: 
 7702: 〞 Two alignments are equal when their numeric values are equal. 
 7703: 〞 Two alignments are different when their numeric values are not equal. 
 7704: 〞 When an alignment is larger than another it represents a stricter alignment. 
 7705: 8 [ Note: the runtime pointer alignment function (20.7.14) can be used to obtain an aligned pointer within a 
 7706: buffer; the aligned-storage templates in the library (20.5.7) can be used to obtain aligned storage. 〞end 
 7707: note ] 
 7708: 50) It is intended that every valid alignment value be an integral power of two. 
 7709: ∫ 3.11 77 
 7710: 
 7711: c
 7712: . ISO/IEC N2800=08-0310 
 7713: 9 If a request for a specific extended alignment in a specific context is not supported by an implementation, 
 7714: the program is ill-formed. Additionally, a request for runtime allocation of dynamic storage for which the 
 7715: requested alignment cannot be honored shall be treated as an allocation failure. 
 7716: ∫ 3.11 78 
 7717: 
 7718: c
 7719: . ISO/IEC N2800=08-0310 
 7720: 4 Standard conversions [conv]
 7721: 1 Standard conversions are implicit conversions defined for built-in types. Clause 4 enumerates the full set 
 7722: of such conversions. A standard conversion sequence is a sequence of standard conversions in the following 
 7723: order: 
 7724: 〞 Zero or one conversion from the following set: lvalue-to-rvalue conversion, array-to-pointer conversion, 
 7725: and function-to-pointer conversion. 
 7726: 〞 Zero or one conversion from the following set: integral promotions, floating point promotion, integral 
 7727: conversions, floating point conversions, floating-integral conversions, pointer conversions, pointer to 
 7728: member conversions, and boolean conversions. 
 7729: 〞 Zero or one qualification conversion. 
 7730: [ Note: a standard conversion sequence can be empty, i.e., it can consist of no conversions. 〞 end note ] 
 7731: A standard conversion sequence will be applied to an expression if necessary to convert it to a required 
 7732: destination type. 
 7733: 2 [ Note: expressions with a given type will be implicitly converted to other types in several contexts: 
 7734: 〞 When used as operands of operators. The operator＊s requirements for its operands dictate the desti-
 7735: nation type (Clause 5). 
 7736: 〞 When used in the condition of an if statement or iteration statement (6.4, 6.5). The destination type 
 7737: is bool. 
 7738: 〞 When used in the expression of a switch statement. The destination type is integral (6.4). 
 7739: 〞 When used as the source expression for an initialization (which includes use as an argument in a 
 7740: function call and use as the expression in a return statement). The type of the entity being initialized 
 7741: is (generally) the destination type. See 8.5, 8.5.3. 
 7742: 〞end note ] 
 7743: 3 An expression e can be implicitly converted to a type T if and only if the declaration T t=e; is well-formed, 
 7744: for some invented temporary variable t (8.5). Certain language constructs require that an expression be 
 7745: converted to a Boolean value. An expression e appearing in such a context is said to be contextually 
 7746: converted to bool and is well-formed if and only if the declaration bool t(e); is well-formed, for some 
 7747: invented temporary variable t (8.5). The effect of either implicit conversion is the same as performing the 
 7748: declaration and initialization and then using the temporary variable as the result of the conversion. The 
 7749: result is an lvalue if T is an lvalue reference type (8.3.2), and an rvalue otherwise. The expression e is used 
 7750: as an lvalue if and only if the initialization uses it as an lvalue. 
 7751: 4 [ Note: For user-defined types, user-defined conversions are considered as well; see 12.3. In general, an 
 7752: implicit conversion sequence (13.3.3.1) consists of a standard conversion sequence followed by a user-defined 
 7753: conversion followed by another standard conversion sequence. 〞end note ] 
 7754: 5 [ Note: There are some contexts where certain conversions are suppressed. For example, the lvalue-to-
 7755: rvalue conversion is not done on the operand of the unary & operator. Specific exceptions are given in the 
 7756: descriptions of those operators and contexts. 〞end note ] 
 7757: 79 
 7758: 
 7759: c
 7760: . ISO/IEC N2800=08-0310 
 7761: 4.1 Lvalue-to-rvalue conversion [conv.lval] 
 7762: 1 An lvalue (3.10) of a non-function, non-array type T can be converted to an rvalue. If T is an incomplete 
 7763: type, a program that necessitates this conversion is ill-formed. If the object to which the lvalue refers is not 
 7764: an object of type T and is not an object of a type derived from T, or if the object is uninitialized, a program 
 7765: that necessitates this conversion has undefined behavior. If T is not an effective class type, the type of the 
 7766: 51
 7767: rvalue is the cv-unqualified version of T. Otherwise, the type of the rvalue is T.
 7768: 2 When an lvalue-to-rvalue conversion occurs in an unevaluated operand or a subexpression thereof (Clause 5) 
 7769: the value contained in the referenced object is not accessed. Otherwise, if the lvalue has a class type, the 
 7770: conversion copy-initializes a temporary of type T from the lvalue and the result of the conversion is an rvalue 
 7771: for the temporary. Otherwise, if the lvalue has (possibly cv-qualified) type std::nullptr_t, the rvalue 
 7772: result is a null pointer constant (4.10). Otherwise, the value contained in the object indicated by the lvalue 
 7773: is the rvalue result. 
 7774: 3 [ Note: See also 3.10. 〞end note ] 
 7775: 4.2 Array-to-pointer conversion [conv.array] 
 7776: 1 An lvalue or rvalue of type ※array of N T§ or ※array of unknown bound of T§ can be converted to an rvalue 
 7777: of type ※pointer to T§. The result is a pointer to the first element of the array. 
 7778: 2 A string literal (2.13.4) with no prefix, with a u prefix, with a U prefix, or with an L prefix can be converted to 
 7779: an rvalue of type ※pointer to char§, ※pointer to char16_t§, ※pointer to char32_t§, or ※pointer to wchar_-
 7780: t§, respectively. In any case, the result is a pointer to the first element of the array. This conversion is 
 7781: considered only when there is an explicit appropriate pointer target type, and not when there is a general 
 7782: need to convert from an lvalue to an rvalue. [ Note: this conversion is deprecated. See Annex D. 〞end 
 7783: note ] For the purpose of ranking in overload resolution (13.3.3.1.1), this conversion is considered an array-to-
 7784: pointer conversion followed by a qualification conversion (4.4). [ Example: "abc" is converted to ※pointer to 
 7785: const char§ as an array-to-pointer conversion, and then to ※pointer to char§ as a qualification conversion. 
 7786: 〞end example ] 
 7787: 4.3 Function-to-pointer conversion [conv.func] 
 7788: 1 An lvalue of function type T can be converted to an rvalue of type ※pointer to T .§ The result is a pointer to 
 7789: the function.52 
 7790: 2 [ Note: See 13.4 for additional rules for the case where the function is overloaded. 〞end note ] 
 7791: 4.4 Qualification conversions [conv.qual] 
 7792: 1 An rvalue of type ※pointer to cv1 T § can be converted to an rvalue of type ※pointer to cv2 T § if ※cv2 T § 
 7793: is more cv-qualified than ※cv1 T .§ 
 7794: 2 An rvalue of type ※pointer to member of X of type cv1 T § can be converted to an rvalue of type ※pointer to 
 7795: member of X of type cv2 T § if ※cv2 T § is more cv-qualified than ※cv1 T .§ 
 7796: 3 [ Note: Function types (including those used in pointer to member function types) are never cv-qualified (8.3.5). 
 7797: 〞end note ] 
 7798: 4 A conversion can add cv-qualifiers at levels other than the firstin multi-level pointers, subject to the following 
 7799: rules:53 
 7800: 51) In C++ class rvalues can have cv-qualified types (because they are objects). This differs from ISO C, in which non-lvalues 
 7801: never have cv-qualified types. 
 7802: 52) This conversion never applies to non-static member functions because an lvalue that refers to a non-static member function 
 7803: cannot be obtained. 
 7804: 53) These rules ensure that const-safety is preserved by the conversion. 
 7805: ∫ 4.4 80 
 7806: 
 7807: c
 7808:ISO/IEC N2800=08-0310 
 7809: Two pointer types T1 and T2 are similar if there exists a type T and integer n>0 such that: 
 7810: T1 is cv 1,0 pointer to cv 1,1 pointer to ﹞﹞﹞ cv 1,n.1 pointer to cv 1,n T 
 7811: and 
 7812: T2 is cv 2,0 pointer to cv 2,1 pointer to ﹞﹞﹞ cv 2,n.1 pointer to cv 2,n T 
 7813: where each cv i,j is const, volatile, const volatile, or nothing. The n-tuple of cv-qualifiers after the 
 7814: first in a pointer type, e.g., cv 1,1, cv 1,2, ﹞﹞﹞, cv 1,n in the pointer type T1, is called the cv-qualification 
 7815: signature of the pointer type. An expression of type T1 can be converted to type T2 if and only if the 
 7816: following conditions are satisfied: 
 7817: 〞 the pointer types are similar. 
 7818: 〞 for every j>0, if const is in cv 1,j then const is in cv 2,j , and similarly for volatile. 
 7819: 〞 if the cv 1,j and cv 2,j are different, then const is in every cv 2,k for 0 <k<j. 
 7820: [ Note: if a program could assign a pointer of type T** to a pointer of type const T** (that is, if line //1 
 7821: below were allowed), a program could inadvertently modify a const object (as it is done on line //2). For 
 7822: example, 
 7823: int main() {
 7824: const char c = ＊c＊;
 7825: char* pc;
 7826: const char** pcc = &pc; // 1: not allowed
 7827: *pcc = &c;
 7828: *pc = ＊C＊; // 2: modifies a const object
 7829: } 
 7830: 〞end note ] 
 7831: 5 A multi-level pointer to member type, or a multi-level mixed pointer and pointer to member type has the 
 7832: form: 
 7833: cv 0P0 to cv 1Pcv n.1Pn.1 to cv n T
 7834: 1 to ﹞﹞﹞ 
 7835: where Pi is either a pointer or pointer to member and where T is not a pointer type or pointer to member 
 7836: type. 
 7837: 6 Two multi-level pointer to member types or two multi-level mixed pointer and pointer to member types T1 
 7838: and T2 are similar if there exists a type T and integer n>0 such that: 
 7839: T1 is cv 1,0P0 to cv 1,1Pcv 1,n.1Pn.1 to cv 1,n T
 7840: 1 to ﹞﹞﹞
 7841: and
 7842: T2 is cv2,0P0 to cv 2,1Pcv 2,n.1Pn.1 to cv 2,n T
 7843: 1 to ﹞﹞﹞ 
 7844: 7 For similar multi-level pointer to member types and similar multi-level mixed pointer and pointer to member 
 7845: types, the rules for adding cv-qualifiers are the same as those used for similar pointer types. 
 7846: 4.5 Integral promotions [conv.prom] 
 7847: 1 An rvalue of an integer type other than bool, char16_t, char32_t, or wchar_t whose integer conversion 
 7848: rank (4.13) is less than the rank of int can be converted to an rvalue of type int if int can represent all 
 7849: the values of the source type; otherwise, the source rvalue can be converted to an rvalue of type unsigned 
 7850: int. 
 7851: ∫ 4.5 81 
 7852: 
 7853: c
 7854: . ISO/IEC N2800=08-0310 
 7855: 2 An rvalue of type char16_t, char32_t, or wchar_t (3.9.1) can be converted to an rvalue of the first of 
 7856: the following types that can represent all the values of its underlying type: int, unsigned int, long int, 
 7857: unsigned long int, long long int, or unsigned long long int. If none of the types in that list can 
 7858: represent all the values of its underlying type, an rvalue of type char16_t, char32_t, or wchar_t can be 
 7859: converted to an rvalue of its underlying type. An rvalue of an unscoped enumeration type (7.2) can be 
 7860: converted to an rvalue of the first of the following types that can represent all the values of the enumeration 
 7861: (i.e. the values in the range bmin to bmax as described in 7.2): int, unsigned int, long int, unsigned 
 7862: long int, long long int, or unsigned long long int. If none of the types in that list can represent all 
 7863: the values of the enumeration, an rvalue of an unscoped enumeration type can be converted to an rvalue of 
 7864: the extended integer type with lowest integer conversion rank (4.13) greater than the rank of long long in 
 7865: which all the values of the enumeration can be represented. If there are two such extended types, the signed 
 7866: one is chosen. 
 7867: 3 An rvalue for an integral bit-field (9.6) can be converted to an rvalue of type int if int can represent all 
 7868: the values of the bit-field; otherwise, it can be converted to unsigned int if unsigned int can represent 
 7869: all the values of the bit-field. If the bit-field is larger yet, no integral promotion applies to it. If the bit-field 
 7870: has an enumerated type, it is treated as any other value of that type for promotion purposes. 
 7871: 4 An rvalue of type bool can be converted to an rvalue of type int, with false becoming zero and true 
 7872: becoming one. 
 7873: 5 These conversions are called integral promotions. 
 7874: 4.6 Floating point promotion [conv.fpprom] 
 7875: 1 An rvalue of type float can be converted to an rvalue of type double. The value is unchanged. 
 7876: 2 This conversion is called floating point promotion. 
 7877: 4.7 Integral conversions [conv.integral] 
 7878: 1 An rvalue of an integer type can be converted to an rvalue of another integer type. An rvalue of an unscoped 
 7879: enumeration type can be converted to an rvalue of an integer type. 
 7880: 2 If the destination type is unsigned, the resulting value is the least unsigned integer congruent to the source 
 7881: integer (modulo 2n where n is the number of bits used to represent the unsigned type). [ Note: In a two＊s 
 7882: complement representation, this conversion is conceptual and there is no change in the bit pattern (if there 
 7883: is no truncation). 〞 end note ] 
 7884: 3 If the destination type is signed, the value is unchanged if it can be represented in the destination type (and 
 7885: bit-field width); otherwise, the value is implementation-defined. 
 7886: 4 If the destination type is bool, see 4.12. If the source type is bool, the value false is converted to zero and 
 7887: the value true is converted to one. 
 7888: 5 The conversions allowed as integral promotions are excluded from the set of integral conversions. 
 7889: 4.8 Floating point conversions [conv.double] 
 7890: 1 An rvalue of floating point type can be converted to an rvalue of another floating point type. If the 
 7891: source value can be exactly represented in the destination type, the result of the conversion is that exact 
 7892: representation. If the source value is between two adjacent destination values, the result of the conversion 
 7893: is an implementation-defined choice of either of those values. Otherwise, the behavior is undefined. 
 7894: ∫ 4.8 82 
 7895: 
 7896: c
 7897: . ISO/IEC N2800=08-0310 
 7898: 2 The conversions allowed as floating point promotions are excluded from the set of floating point conversions. 
 7899: 4.9 Floating-integral conversions [conv.fpint] 
 7900: 1 An rvalue of a floating point type can be converted to an rvalue of an integer type. The conversion trun-
 7901: cates; that is, the fractional part is discarded. The behavior is undefined if the truncated value cannot be 
 7902: represented in the destination type. [ Note: If the destination type is bool, see 4.12. 〞 end note ] 
 7903: 2 An rvalue of an integer type or of an unscoped enumeration type can be converted to an rvalue of a floating 
 7904: point type. The result is exact if possible. Otherwise, it is an implementation-defined choice of either the 
 7905: next lower or higher representable value. [ Note: loss of precision occurs if the integral value cannot be 
 7906: represented exactly as a value of the floating type. 〞 end note ] If the source type is bool, the value false 
 7907: is converted to zero and the value true is converted to one. 
 7908: 4.10 Pointer conversions [conv.ptr] 
 7909: 1 A null pointer constant is an integral constant expression (5.19) rvalue of integer type that evaluates to zero 
 7910: or an rvalue of type std::nullptr_t. A null pointer constant can be converted to a pointer type; the result 
 7911: is the null pointer value of that type and is distinguishable from every other value of pointer to object or 
 7912: pointer to function type. Two null pointer values of the same type shall compare equal. The conversion of 
 7913: a null pointer constant to a pointer to cv-qualified type is a single conversion, and not the sequence of a 
 7914: pointer conversion followed by a qualification conversion (4.4). A null pointer constant of integral type can 
 7915: be converted to an rvalue of type std::nullptr_t.[ Note: The resulting rvalue is not a null pointer value. 
 7916: 〞end note ] 
 7917: 2 An rvalue of type ※pointer to cv T ,§ where T is an effective object type, can be converted to an rvalue of 
 7918: type ※pointer to cv void§. The result of converting a ※pointer to cv T§ to a ※pointer to cv void§ points 
 7919: to the start of the storage location where the object of type T resides, as if the object is a most derived 
 7920: object (1.8) of type T (that is, not a base class subobject). The null pointer value is converted to the null 
 7921: pointer value of the destination type. 
 7922: 3 An rvalue of type ※pointer to cv D§, where D is a class type, can be converted to an rvalue of type ※pointer 
 7923: to cv B§, where B is a base class (Clause 10) of D. If B is an inaccessible (Clause 11) or ambiguous (10.2) 
 7924: base class of D, a program that necessitates this conversion is ill-formed. The result of the conversion is a 
 7925: pointer to the base class subobject of the derived class object. The null pointer value is converted to the 
 7926: null pointer value of the destination type. 
 7927: 4.11 Pointer to member conversions [conv.mem] 
 7928: 1 A null pointer constant (4.10) can be converted to a pointer to member type; the result is the null member 
 7929: pointer value of that type and is distinguishable from any pointer to member not created from a null pointer 
 7930: constant. Two null member pointer values of the same type shall compare equal. The conversion of a null 
 7931: pointer constant to a pointer to member of cv-qualified type is a single conversion, and not the sequence of 
 7932: a pointer to member conversion followed by a qualification conversion (4.4). 
 7933: 2 An rvalue of type ※pointer to member of B of type cv T§, where B is a class type, can be converted to an 
 7934: rvalue of type ※pointer to member of D of type cv T§, where D is a derived class (Clause 10) of B. If B is an 
 7935: inaccessible (Clause 11), ambiguous (10.2), or virtual (10.1) base class of D, or a base class of a virtual base 
 7936: class of D, a program that necessitates this conversion is ill-formed. The result of the conversion refers to 
 7937: the same member as the pointer to member before the conversion took place, but it refers to the base class 
 7938: member as if it were a member of the derived class. The result refers to the member in D＊s instance of B. 
 7939: Since the result has type ※pointer to member of D of type cv T§, it can be dereferenced with a D object. The 
 7940: ∫ 4.11 83 
 7941: 
 7942: c
 7943: . ISO/IEC N2800=08-0310 
 7944: result is the same as if the pointer to member of B were dereferenced with the B subobject of D. The null 
 7945: member pointer value is converted to the null member pointer value of the destination type.54 
 7946: 4.12 Boolean conversions [conv.bool] 
 7947: 1 An rvalue of arithmetic, unscoped enumeration, pointer, or pointer to member type can be converted to an 
 7948: rvalue of type bool. A zero value, null pointer value, or null member pointer value is converted to false; 
 7949: any other value is converted to true. An rvalue of type std::nullptr_t can be converted to an rvalue of 
 7950: type bool; the resulting value is false. 
 7951: 4.13 Integer conversion rank [conv.rank] 
 7952: 1 Every integer type has an integer conversion rank defined as follows: 
 7953: 〞 No two signed integer types shall have the same rank, even if they have the same represesentation. 
 7954: 〞 The rank of a signed integer type shall be greater than the rank of any signed integer type with a 
 7955: smaller size. 
 7956: 〞 The rank of long long int shall be greater than the rank of long int, which shall be greater than 
 7957: the rank of int, which shall be greater than the rank of short int, which shall be greater than the 
 7958: rank of signed char. 
 7959: 〞 The rank of any unsigned integer type shall equal the rank of the corresponding signed integer type. 
 7960: 〞 The rank of any standard integer type shall be greater than the rank of any extended integer type 
 7961: with the same size. 
 7962: 〞 the rank of char shall equal the rank of signed char and unsigned char. 
 7963: 〞 The rank of bool shall be less than the rank of all other standard integer types. 
 7964: 〞 The ranks of char16_t, char32_t, and wchar_t shall equal the ranks of their underlying types (3.9.1). 
 7965: 〞 The rank of any extended signed integer type relative to another extended signed integer type with 
 7966: the same size is implementation-defined, but still subject to the other rules for determining the integer 
 7967: conversion rank. 
 7968: 〞 For all integer types T1, T2, and T3, if T1 has greater rank than T2 and T2 has greater rank than T3, 
 7969: then T1 shall have greater rank than T3. 
 7970: [ Note: The integer conversion rank is used in the definition of the integral promotions (4.5) and the usual 
 7971: arithmetic conversions (5). 〞end note ] 
 7972: 54) The rule for conversion of pointers to members (from pointer to member of base to pointer to member of derived) appears 
 7973: inverted compared to the rule for pointers to objects (from pointer to derived to pointer to base) (4.10, Clause 10). This 
 7974: inversion is necessary to ensure type safety. Note that a pointer to member is not a pointer to object or a pointer to function 
 7975: and the rules for conversions of such pointers do not apply to pointers to members. In particular, a pointer to member cannot 
 7976: be converted to a void*. 
 7977: ∫ 4.13 84 
 7978: 
 7979: c
 7980: . ISO/IEC N2800=08-0310 
 7981: 5 Expressions [expr]
 7982: 1 [ Note: Clause 5 defines the syntax, order of evaluation, and meaning of expressions.55 An expression is a 
 7983: sequence of operators and operands that specifies a computation. An expression can result in a value and 
 7984: can cause side effects. 〞end note ] 
 7985: 2 [ Note: Operators can be overloaded, thatis, given meaning when applied to expressions of class type (Clause9) 
 7986: or enumeration type (7.2). Uses of overloaded operators are transformed into function calls as described 
 7987: in 13.5. Overloaded operators obey the rules for syntax specified in Clause 5, but the requirements of operand 
 7988: type, lvalue, and evaluation order are replaced by the rules for function call. Relations between operators, 
 7989: such as ++a meaning a+=1, are not guaranteed for overloaded operators (13.5), and are not guaranteed for 
 7990: operands of type bool. 〞end note ] 
 7991: 3 Clause 5 defines the effects of operators when applied to types for which they have not been overloaded. 
 7992: Operator overloading shall not modify the rules for the built-in operators, that is, for operators applied to 
 7993: types for which they are defined by this Standard. However, these built-in operators participate in overload 
 7994: resolution, and as part of that process user-defined conversions will be considered where necessary to convert 
 7995: the operands to types appropriate for the built-in operator. If a built-in operator is selected, such conversions 
 7996: will be applied to the operands before the operation is considered further according to the rules in Clause 5; 
 7997: see 13.3.1.2, 13.6. 
 7998: 4 If during the evaluation of an expression, the result is not mathematically defined or not in the range of 
 7999: representable values for its type, the behavior is undefined, unless such an expression appears where an 
 8000: integral constant expression is required (5.19), in which case the program is ill-formed. [ Note: most existing 
 8001: implementations of C++ ignore integer overflows. Treatment of division by zero, forming a remainder using 
 8002: a zero divisor, and all floating point exceptions vary among machines, and is usually adjustable by a library 
 8003: function. 〞 end note ] 
 8004: 5 If an expression initially has the type ※lvalue reference to T§ (8.3.2, 8.5.3), the type is adjusted to T prior to 
 8005: any further analysis, the expression designates the object or function denoted by the lvalue reference, and 
 8006: the expression is an lvalue. 
 8007: 6 If an expression initially has the type ※rvalue reference to T§ (8.3.2, 8.5.3), the type is adjusted to ※T§ prior 
 8008: to any further analysis, and the expression designates the object or function denoted by the rvalue reference. 
 8009: If the expression is the result of calling a function, whether implicitly or explicitly, it is an rvalue; otherwise, 
 8010: it is an lvalue. [ Note: In general, the effect of this rule is that named rvalue references are treated as lvalues 
 8011: and unnamed rvalue references are treated as rvalues. 〞 end note ] 
 8012: [ Example: 
 8013: struct A { }; 
 8014: A&& operator+(A, A); 
 8015: A&& f(); 
 8016: A a;
 8017: A&& ar = a;
 8018: The expressions f() and a 
 8019: example ] 
 8020: +a are rvalues of type A. The expression ar is an lvalue of type A. 〞end 
 8021: 55) The precedence of operators is not directly specified, but it can be derived from the syntax. 
 8022: 
 8023: c
 8024: . ISO/IEC N2800=08-0310 
 8025: 7 An expression designating an object is called an object-expression. 
 8026: 8 In some contexts, unevaluated operands appear (5.2.8, 5.3.3, 7.1.6.2). An unevaluated operand is not eval-
 8027: uated. [ Note: In an unevaluated operand, a non-static class member may be named (5.1) and naming of 
 8028: objects or functions does not, by itself, require that a definition be provided (3.2). 〞end note ] 
 8029: 9 Whenever an lvalue expression appears as an operand of an operator that expects an rvalue for that operand, 
 8030: the lvalue-to-rvalue (4.1), array-to-pointer (4.2), or function-to-pointer (4.3) standard conversions are applied 
 8031: to convert the expression to an rvalue. [ Note: because cv-qualifiers are removed from the type of an 
 8032: expression of non-class type when the expression is converted to an rvalue, an lvalue expression of type 
 8033: const int can, for example, be used where an rvalue expression of type int is required. 〞end note ] 
 8034: 10 Many binary operators that expect operands of arithmetic or enumeration type cause conversions and yield 
 8035: result types in a similar way. The purpose is to yield a common type, which is also the type of the result. 
 8036: This pattern is called the usual arithmetic conversions, which are defined as follows: 
 8037: 〞 If either operand is of type long double, the other shall be converted to long double. 
 8038: 〞 Otherwise, if either operand is double, the other shall be converted to double. 
 8039: 〞 Otherwise, if either operand is float, the other shall be converted to float. 
 8040: 〞 Otherwise, the integral promotions (4.5) shall be performed on both operands.56 Then the following 
 8041: rules shall be applied to the promoted operands: 
 8042: 〞 If both operands have the same type, no further conversion is needed. 
 8043: 〞 Otherwise, if both operands have signed integer types or both have unsigned integer types, the operand 
 8044: with the type of lesser integer conversion rank shall be converted to the type of the operand with greater 
 8045: rank. 
 8046: 〞 Otherwise, if the operand that has unsigned integer type has rank greater than or equal to the rank 
 8047: of the type of the other operand, the operand with signed integer type shall be converted to the type 
 8048: of the operand with unsigned integer type. 
 8049: 〞 Otherwise, if the type of the operand with signed integer type can represent all of the values of the type 
 8050: of the operand with unsigned integer type, the operand with unsigned integer type shall be converted 
 8051: to the type of the operand with signed integer type. 
 8052: 〞 Otherwise, both operands shall be converted to the unsigned integer type corresponding to the type 
 8053: of the operand with signed integer type. 
 8054: 11 The values of the floating operands and the results of floating expressions may be represented in greater 
 8055: precision and range than that required by the type; the types are not changed thereby.57 
 8056: 5.1 Primary expressions [expr.prim] 
 8057: 1 Primary expressions are literals, names, names qualified by the scope resolution operator ::, and lambda 
 8058: expressions. 
 8059: 56) As a consequence, operands of type bool, char16_t, char32_t, wchar_t, or an enumerated type are converted to some 
 8060: integral type. 
 8061: 57) The cast and assignment operators must still perform their specific conversions as described in 5.4, 5.2.9 and 5.17. 
 8062: ∫ 5.1 86 
 8063: 
 8064: c
 8065: . ISO/IEC N2800=08-0310 
 8066: primary-expression:
 8067: literal
 8068: this
 8069: ( expression )
 8070: id-expression
 8071: lambda-expression
 8072: id-expression:
 8073: unqualified-id
 8074: qualified-id
 8075: unqualified-id:
 8076: identifier
 8077: operator-function-id
 8078: conversion-function-id
 8079: literal-operator-id
 8080: ‵ class-name
 8081: template-id
 8082: 2 A literal is a primary expression. Its type depends on its form (2.13). A string literal is an lvalue; all other 
 8083: literals are rvalues. 
 8084: 3 The keyword this names a pointer to the object for which a non-static member function (9.3.2) is invoked 
 8085: or a non-static data member＊s initializer (9.2) is evaluated. The keyword this shall be used only inside a 
 8086: non-static class member function body (9.3) or in a brace-or-equal-initializer for a non-static data member. 
 8087: The type of the expression is a pointer to the class of the function or non-static data member, possibly with 
 8088: cv-qualifiers on the class type. The expression is an rvalue. 
 8089: 4 The operator :: followed by an identifier, a qualified-id, or an operator-function-id is a primary-expression. 
 8090: Its type is specified by the declaration of the identifier, qualified-id, or operator-function-id. The result is 
 8091: the entity denoted by the identifier, qualified-id, or operator-function-id. The result is an lvalue if the entity 
 8092: is a function or variable. The identifier, qualified-id, or operator-function-id shall have global namespace 
 8093: scope or be visible in global scope because of a using-directive (7.3.4). [ Note: the use of :: allows a type, 
 8094: an object, a function, an enumerator, or a namespace declared in the global namespace to be referred to 
 8095: even if its identifier has been hidden (3.4.3). 〞end note ] 
 8096: 5 A parenthesized expression is a primary expression whose type and value are identical to those of the 
 8097: enclosed expression. The presence of parentheses does not affect whether the expression is an lvalue. The 
 8098: parenthesized expression can be used in exactly the same contexts as those where the enclosed expression 
 8099: can be used, and with the same meaning, except as otherwise indicated. 
 8100: 6 An id-expression is a restricted form of a primary-expression.[ Note: an id-expression can appear after . 
 8101: and -> operators (5.2.5). 〞end note ] 
 8102: 7 An identifier is an id-expression provided it has been suitably declared (Clause 7). [ Note: for operator-
 8103: function-ids, see 13.5; for conversion-function-ids, see 12.3.2; for literal-operator-ids, see 13.5.8; for template-
 8104: ids, see 14.2. A class-name prefixed by ‵ denotes a destructor; see 12.4. Within the definition of a non-static 
 8105: member function, an identifier that names a non-static member is transformed to a class member access 
 8106: expression (9.3.1). 〞end note ] The type of the expression is the type of the identifier. The result is the 
 8107: entity denoted by the identifier. The result is an lvalue if the entity is a function, variable, or data member. 
 8108: qualified-id:
 8109: ::opt nested-name-specifier templateopt unqualified-id
 8110: :: identifier
 8111: :: operator-function-id
 8112: :: template-id
 8113: ∫ 5.1 87 
 8114: 
 8115: c
 8116: . ISO/IEC N2800=08-0310 
 8117: nested-name-specifier:
 8118: type-name ::
 8119: namespace-name ::
 8120: nested-name-specifier identifier ::
 8121: nested-name-specifier templateopt simple-template-id ::
 8122: nested-name-specifieropt concept-id ::
 8123: A nested-name-specifier that names a class, optionally followed by the keyword template (14.2), and then 
 8124: followed by the name of a member of either that class (9.2) or one of its base classes (Clause 10), is a qualified-
 8125: id; 3.4.3.1 describes name lookup for class members that appear in qualified-ids. The result is the member. 
 8126: The type of the result is the type of the member. The result is an lvalue if the member is a static member 
 8127: function or a data member. [ Note: a class member can be referred to using a qualified-id at any point in 
 8128: its potential scope (3.3.6). 〞end note ] Where class-name :: class-name is used, and the two class-names 
 8129: refer to the same class, this notation names the constructor (12.1). Where class-name ::‵ class-name is 
 8130: used, the two class-names shall refer to the same class; this notation names the destructor (12.4). [ Note: a 
 8131: typedef-name that names a class is a class-name (9.1). 〞end note ] 
 8132: 8 A nested-name-specifier that names a namespace (7.3), followed by the name of a member of that namespace 
 8133: (or the name of a member of a namespace made visible by a using-directive) is a qualified-id; 3.4.3.2 describes 
 8134: name lookup for namespace members that appear in qualified-ids. The result is the member. The type of 
 8135: the result is the type of the member. The result is an lvalue if the member is a function or a variable. 
 8136: 9 A nested-name-specifier that names an enumeration (7.2), followed by the name of an enumerator of that 
 8137: enumeration, is a qualified-id that refers to the enumerator. The result is the enumerator. The type of the 
 8138: result is the type of the enumeration. The result is an rvalue. 
 8139: 10 In a qualified-id, if the id-expression is a conversion-function-id, its conversion-type-id shall denote the same 
 8140: type in both the context in which the entire qualified-id occurs and in the context of the class denoted by 
 8141: the nested-name-specifier. 
 8142: 11 An id-expression that denotes a non-static data member or non-static member function of a class can only 
 8143: be used: 
 8144: 〞 as part of a class member access (5.2.5) in which the object-expression refers to the member＊s class or 
 8145: a class derived from that class, or 
 8146: 〞 to form a pointer to member (5.3.1), or 
 8147: 〞 in the body of a non-static member function of that class or of a class derived from that class (9.3.1), 
 8148: or 
 8149: 〞 in a mem-initializer for a constructor for that class or for a class derived from that class (12.6.2), or 
 8150: 〞 in a brace-or-equal-initializer for a non-static data member of that class or of a class derived from that 
 8151: class (12.6.2), or 
 8152: 〞 if that id-expression denotes a non-static data member and it is the sole constituent of an unevaluated 
 8153: operand, except for optional enclosing parentheses. [ Example: 
 8154: struct S { 
 8155: int m; 
 8156: }; 
 8157: int i = sizeof(S::m); // OK 
 8158: int j = sizeof(S::m + 42); // error: reference to non-static member in subexpression 
 8159: 〞end example ] 
 8160: ∫ 5.1 88 
 8161: 
 8162: c
 8163: . ISO/IEC N2800=08-0310 
 8164: 5.1.1 Lambda expressions [expr.prim.lambda] 
 8165: lambda-expression:
 8166: lambda-introducer lambda-parameter-declarationopt compound-statement
 8167: lambda-introducer:
 8168: [ lambda-captureopt ]
 8169: lambda-capture:
 8170: capture-default
 8171: capture-list
 8172: capture-default , capture-list
 8173: capture-default: 
 8174: &
 8175: =
 8176: capture-list:
 8177: capture
 8178: capture-list , capture
 8179: capture:
 8180: identifier
 8181: & identifier
 8182: this
 8183: lambda-parameter-declaration:
 8184: ( lambda-parameter-declaration-listopt ) mutableopt attribute-specifieropt
 8185: exception-specificationopt lambda-return-type-clauseopt
 8186: lambda-parameter-declaration-list:
 8187: lambda-parameter
 8188: lambda-parameter , lambda-parameter-declaration-list
 8189: lambda-parameter:
 8190: decl-specifier-seq attribute-specifieropt declarator
 8191: lambda-return-type-clause:
 8192: -> attribute-specifieropt type-id
 8193: 1 In a lambda-parameter-declaration the attribute-specifier appertains to the lambda. In a lambda-return-type-
 8194: clause the attribute appertains to the lambda return type. 
 8195: 2 The evaluation of a lambda-expression results in a closure object, which is an rvalue. Invoking the closure 
 8196: object executes the statements specified in the lambda-expression＊s compound-statement. Each lambda 
 8197: expression has a unique type. Except as specified below, the type of the closure object is unspecified. [ Note: 
 8198: A closure object behaves as a function object (20.6) whose function call operator, constructors, and data 
 8199: members are defined by the lambda-expression and its context. 〞end note ] 
 8200: 3 A name in the lambda-capture shall be in scope in the context of the lambda expression, and shall be this 
 8201: or shall refer to a local variable or reference with automatic storage duration. [ Note: A member of an 
 8202: anonymous union is not a variable. 〞end note ] The same name shall not appear more than once in a 
 8203: lambda-capture. In a lambda-introducer of the form [ capture-default , capture-list ], if the capture-default 
 8204: is &, the capture-list shall not contain a capture having the prefix &, otherwise each capture in the capture-list 
 8205: other than this shall have the prefix &. 
 8206: 4 An effective capture set is defined as follows: 
 8207: 〞 For a lambda-introducer of the form [ ], the effective capture set is empty. 
 8208: 〞 For a lambda-introducer of the form [ capture-list ], the effective capture set consists of the captures 
 8209: in the capture-list. 
 8210: ∫ 5.1.1 89 
 8211: 
 8212: c
 8213: . ISO/IEC N2800=08-0310 
 8214: 〞 For a lambda-introducer of the form [ capture-default ] or [ capture-default , capture-list ], the effective 
 8215: capture set consists of 
 8216: 〞 the captures in the capture-list, if any, and 
 8217: 〞 for each name v that appears in the lambda expression and denotes a local variable or reference 
 8218: with automatic storage duration in the context where the lambda expression appears and that 
 8219: does not appear in the capture-list or as a parameter name in the lambda-parameter-declaration-
 8220: list, &v if the capture-default is & and v otherwise, and 
 8221: 〞 this if the lambda expression contains a member access expression referring to this (implicitly 
 8222: or explicitly). 
 8223: 5 The compound-statement of a lambda expression shall use (3.2) an automatic variable or reference from the 
 8224: context where the lambda expression appears only if the name of the variable or reference is a member of 
 8225: the effective capture set, and shall reference this (implicitly or explicitly) only if this is a member of the 
 8226: effective capture set. The compound-statement of a lambda expression shall not refer to a member of an 
 8227: anonymous union with automatic storage duration. 
 8228: 6 A lambda-expression defines a function and the compound-statement of a lambda-expression has an associated 
 8229: function scope (3.3). 
 8230: 7 The type of the closure object is a class with a unique name, call it F, considered to be defined at the point 
 8231: where the lambda expression occurs. 
 8232: 8 Each name N in the effective capture set is looked up in the context where the lambda expression appears 
 8233: to determine its object type; in the case of a reference, the object type is the type to which the reference 
 8234: refers. For each element in the effective capture set, F has a private non-static data member as follows: 
 8235: 〞 if the element is this, the data member has some unique name, call it t, and is of the type of 
 8236: this (9.3.2); 
 8237: 〞 if the element is of the form & N, the data member has the name N and type ※reference to object type 
 8238: of N§; 
 8239: 〞 otherwise, the element is of the form N, and the data member has the name N and type ※cv-unqualified 
 8240: object type of N§. 
 8241: 9 The declaration order of the data members is unspecified. 
 8242: 10 F has a public function call operator (13.5.4) with the following properties: 
 8243: 〞 The parameter-declaration-clause is the lambda-parameter-declaration-list. 
 8244: 〞 The return type is the type denoted by the type-id in the lambda-return-type-clause; for a lambda 
 8245: expression that does not contain a lambda-return-type-clause the return type is void, unless the 
 8246: compound-statement is of the form { return expression ; }, in which case the return type is the 
 8247: type of expression. 
 8248: 〞 The cv-qualifier-seq is absent if the lambda expression is mutable, and it is const otherwise. 
 8249: 〞 The exception-specification is the lambda expression＊s exception-specification, if any. 
 8250: 〞 The compound-statement is obtained from the lambda expression＊s compound-statement as follows: If 
 8251: the lambda expression is within a non-static member function of some class X, transform id-expressions 
 8252: to class member access syntax as specified in 9.3.1, then replace all occurrences of this by t.[ Note: 
 8253: References to captured variables or references within the compound-statement refer to the data mem-
 8254: bers of F. 〞end note ] 
 8255: ∫ 5.1.1 90 
 8256: 
 8257: c
 8258: . ISO/IEC N2800=08-0310 
 8259: 11 F has an implicitly-declared copy constructor (12.8), and it has a public move constructor that performs a 
 8260: member-wise move. The copy assignment operator in F is defined as deleted. The size of F is unspecified. 
 8261: 12 If every name in the effective capture set is preceded by & and the lambda expression is not mutable, F is 
 8262: publicly derived from std::reference_closure<R(P)> (20.6.18), where R is the return type and P is the 
 8263: parameter-type-list of the lambda expression. Converting an object of type F to type std::reference_-
 8264: closure<R(P)> and invoking its function call operator shall have the same effect as invoking the function 
 8265: call operator of F.[ Note: This requirement effectively means that such F＊s must be implemented using a 
 8266: pair of a function pointer and a static scope pointer. 〞end note ] 
 8267: 13 The closure object is initialized by direct-initializing each member N of F with the local variable or reference 
 8268: named N; the member t is initialized with this. If one or more names in the effective capture set are 
 8269: preceded by &, the effect of invoking a closure object or a copy after the innermost block scope of the context 
 8270: of the lambda expression has been exited is undefined. 
 8271: 5.2 Postfix expressions [expr.post] 
 8272: 1 Postfix expressions group left-to-right. 
 8273: postfix-expression:
 8274: primary-expression
 8275: postfix-expression [ expression ]
 8276: postfix-expression [ braced-init-list ]
 8277: postfix-expression ( expression-listopt )
 8278: simple-type-specifier ( expression-listopt )
 8279: typename-specifier ( expression-listopt )
 8280: simple-type-specifier braced-init-list
 8281: typename-specifier braced-init-list
 8282: postfix-expression . templateopt id-expression
 8283: postfix-expression -> templateopt id-expression
 8284: postfix-expression . pseudo-destructor-name
 8285: postfix-expression -> pseudo-destructor-name
 8286: postfix-expression ++
 8287: postfix-expression -
 8288: dynamic_
 8289: cast < type-id > ( expression )
 8290: static_cast < type-id > ( expression )
 8291: reinterpret_cast < type-id > ( expression )
 8292: const_cast < type-id >( expression )
 8293: typeid ( expression )
 8294: typeid ( type-id )
 8295: expression-list:
 8296: initializer-list
 8297: pseudo-destructor-name:
 8298: ::opt nested-name-specifieropt type-name :: ‵ type-name
 8299: ::opt nested-name-specifier template simple-template-id :: ‵ type-name
 8300: ::opt nested-name-specifieropt ‵ type-name
 8301: 2 [ Note: The > token following the type-id in a dynamic_cast, static_cast, reinterpret_cast, or const_-
 8302: cast may be the product of replacing a >> token by two consecutive > tokens (14.2). 〞end note ] 
 8303: 3 An assignment-expression followed by an ellipsis is a pack expansion (14.5.3). 
 8304: 5.2.1 Subscripting [expr.sub] 
 8305: 1 A postfix expression followed by an expression in square brackets is a postfix expression. One of the expres-
 8306: sions shall have the type ※pointer to T§ and the other shall have enumeration or integral type. The result 
 8307: ∫ 5.2.1 91 
 8308: 
 8309: c
 8310: . ISO/IEC N2800=08-0310 
 8311: is an lvalue of type ※T.§ The type ※T§ shall be a completely-defined effective object type.58 The expression 
 8312: E1[E2] is identical (by definition) to *((E1)+(E2)) [ Note: see 5.3 and 5.7 for details of * and + and 8.3.4 
 8313: for details of arrays. 〞end note ] 
 8314: 2 A braced-init-list may appear as a subscript for a user-defined operator[]. In that case, the initializer list 
 8315: is treated as the initializer for the subscript argument of the operator[]. An initializer list shall not be 
 8316: used with the built-in subscript operator. 
 8317: [ Example: 
 8318: struct X { 
 8319: Z operator[](std::initializer_list<int>); 
 8320: }; 
 8321: X x; 
 8322: x[{1,2,3}] = 7; // OK: meaning x.operator[]({1,2,3}) 
 8323: int a[10]; 
 8324: a[{1,2,3}] = 7; // error: built-in subscript operator 
 8325: 〞end example ] 
 8326: 5.2.2 Function call [expr.call] 
 8327: 1 There are two kinds of function call: ordinary function call and member function59 (9.3) call. A function 
 8328: call is a postfix expression followed by parentheses containing a possibly empty, comma-separated list of 
 8329: expressions which constitute the arguments to the function. For an ordinary function call, the postfix 
 8330: expression shall be either an lvalue that refers to a function (in which case the function-to-pointer standard 
 8331: conversion (4.3) is suppressed on the postfix expression), or it shall have pointer to function type. Calling 
 8332: a function through an expression whose function type has a language linkage that is different from the 
 8333: language linkage of the function type of the called function＊s definition is undefined (7.5). For a member 
 8334: function call, the postfix expression shall be an implicit (9.3.1, 9.4) or explicit class member access (5.2.5) 
 8335: whose id-expression is a function member name, or a pointer-to-member expression (5.5) selecting a function 
 8336: member; the call is as a member of the object pointed to or referred to by the object expression (5.2.5, 5.5). 
 8337: In the case of an implicit class member access, the implied object is the one pointed to by this.[ Note: a 
 8338: member function call of the form f() is interpreted as (*this).f() (see 9.3.1). 〞end note ] If a function 
 8339: or member function name is used, the name can be overloaded (Clause 13), in which case the appropriate 
 8340: function shall be selected according to the rules in 13.3. If the selected function is non-virtual, or if the 
 8341: id-expression in the class member access expression is a qualified-id, that function is called. Otherwise, its 
 8342: final overrider (10.3) in the dynamic type of the object expression is called. [ Note: the dynamic type is 
 8343: the type of the object pointed or referred to by the current value of the object expression. 12.7 describes 
 8344: the behavior of virtual function calls when the object-expression refers to an object under construction or 
 8345: destruction. 〞end note ] 
 8346: 2 [ Note: if a function or member function name is used, and name lookup (3.4) does not find a declaration of 
 8347: that name, the program is ill-formed. No function is implicitly declared by such a call. 〞end note ] 
 8348: 3 The type of the function call expression is the return type of the statically chosen function (i.e., ignoring the 
 8349: virtual keyword), even if the type of the function actually called is different. This type shall be a complete 
 8350: effective object type, a reference type or the type void. 
 8351: 4 When a function is called, each parameter (8.3.5) shall be initialized (8.5, 12.8, 12.1) with its corresponding 
 8352: argument. If the function is a non-static member function, the this parameter of the function (9.3.2) shall 
 8353: be initialized with a pointer to the object of the call, converted as if by an explicit type conversion (5.4). 
 8354: 58) This is true even if the subscript operator is used in the following common idiom: &x[0].
 8355: 59) A static member function (9.4) is an ordinary function.
 8356: ∫ 5.2.2 92 
 8357: 
 8358: c
 8359: . ISO/IEC N2800=08-0310 
 8360: [ Note: There is no access or ambiguity checking on this conversion; the access checking and disambiguation 
 8361: are done as part of the (possibly implicit) class member access operator. See 10.2, 11.2, and 5.2.5. 〞end 
 8362: note ] When a function is called, the parameters that have effective object type shall have completely-defined 
 8363: object type. [ Note: this still allows a parameter to be a pointer or reference to an incomplete class type. 
 8364: However, it prevents a passed-by-value parameter to have an incomplete class type. 〞 end note ] During 
 8365: the initialization of a parameter, an implementation may avoid the construction of extra temporaries by 
 8366: combining the conversions on the associated argument and/or the construction of temporaries with the 
 8367: initialization of the parameter (see 12.2). The lifetime of a parameter ends when the function in which it 
 8368: is defined returns. The initialization and destruction of each parameter occurs within the context of the 
 8369: calling function. [ Example: the access of the constructor, conversion functions or destructor is checked at 
 8370: the point of call in the calling function. If a constructor or destructor for a function parameter throws an 
 8371: exception, the search for a handler starts in the scope of the calling function; in particular, if the function 
 8372: called has a function-try-block (Clause 15) with a handler that could handle the exception, this handler is 
 8373: not considered. 〞end example ] The value of a function call is the value returned by the called function 
 8374: except in a virtual function call if the return type of the final overrider is different from the return type of 
 8375: the statically chosen function, the value returned from the final overrider is converted to the return type of 
 8376: the statically chosen function. 
 8377: 5 [ Note: a function can change the values of its non-const parameters, but these changes cannot affect the 
 8378: values of the arguments except where a parameter is of a reference type (8.3.2); if the reference is to a 
 8379: const-qualified type, const_cast is required to be used to cast away the constness in order to modify 
 8380: the argument＊s value. Where a parameter is of const reference type a temporary object is introduced if 
 8381: needed (7.1.6, 2.13, 2.13.4, 8.3.4, 12.2). In addition, it is possible to modify the values of nonconstant objects 
 8382: through pointer parameters. 〞end note ] 
 8383: 6 A function can be declared to accept fewer arguments (by declaring default arguments (8.3.6)) or more 
 8384: arguments (by using the ellipsis, ..., or a function parameter pack (8.3.5)) than the number of parameters 
 8385: in the function definition (8.4). [ Note: this implies that, except where the ellipsis (...) or a function 
 8386: parameter pack is used, a parameter is available for each argument. 〞end note ] 
 8387: 7 When there is no parameter for a given argument, the argument is passed in such a way that the receiv-
 8388: ing function can obtain the value of the argument by invoking va_arg (18.9). The lvalue-to-rvalue (4.1), 
 8389: array-to-pointer (4.2), and function-to-pointer (4.3) standard conversions are performed on the argument 
 8390: expression. After these conversions, if the argument does not have arithmetic, enumeration, pointer, pointer 
 8391: to member, or effective class type, the program is ill-formed. Passing a potentially-evaluated argument of 
 8392: class type (Clause 9) with a non-trivial copy constructor or a non-trivial destructor with no corresponding 
 8393: parameter is conditionally-supported, with implementation-defined semantics. If the argument has integral 
 8394: or enumeration type that is subject to the integral promotions (4.5), or a floating point type that is subject 
 8395: to the floating point promotion (4.6), the value of the argument is converted to the promoted type before 
 8396: the call. These promotions are referred to as the default argument promotions. 
 8397: 8 [ Note: The evaluations of the postfix expression and of the argument expressions are all unsequenced 
 8398: relative to one another. All side effects of argument expression evaluations are sequenced before the function 
 8399: is entered (see 1.9). 〞 end note ] 
 8400: 9 Recursive calls are permitted, except to the function named main (3.6.1). 
 8401: 10 A function call is an lvalue if and only if the result type is an lvalue reference. 
 8402: 5.2.3 Explicit type conversion (functional notation) [expr.type.conv] 
 8403: 1 A simple-type-specifier (7.1.6.2) or typename-specifier (14.6) followed by a parenthesized expression-list con-
 8404: structs a value of the specified type given the expression list. If the expression list is a single expression, the 
 8405: type conversion expression is equivalent (in definedness, and if defined in meaning) to the corresponding cast 
 8406: ∫ 5.2.3 93 
 8407: 
 8408: c
 8409: . ISO/IEC N2800=08-0310 
 8410: expression (5.4). If the type specified is a class type, the class type shall be complete. If the expression list 
 8411: specifies more than a single value, the type shall be a class with a suitably declared constructor (8.5, 12.1), 
 8412: and the expression T(x1, x2, ...) is equivalent in effect to the declaration T t(x1, x2, ...); for some 
 8413: invented temporary variable t, with the result being the value of t as an rvalue. 
 8414: 2 The expression T(), where T is a simple-type-specifier or typename-specifier for a non-array complete effective 
 8415: object type or the (possibly cv-qualified) void type, creates an rvalue of the specified type, which is value-
 8416: initialized (8.5; no initialization is done for the void() case). [ Note: if T is a non-class type that is 
 8417: cv-qualified, the cv-qualifiers are ignored when determining the type of the resulting rvalue (3.10). 〞end 
 8418: note ] 
 8419: 3 Similarly, a simple-type-specifier or typename-specifier followed by a braced-init-list creates a temporary 
 8420: object of the specified type direct-list-initialized (8.5.4) with the specified braced-init-list, and its value is 
 8421: that temporary object as an rvalue. 
 8422: 5.2.4 Pseudo destructor call [expr.pseudo] 
 8423: 1 The use of a pseudo-destructor-name after a dot . or arrow -> operator represents the destructor for the non-
 8424: class type named by type-name. The result shall only be used as the operand for the function call operator 
 8425: (), and the result of such a call has type void. The only effect is the evaluation of the postfix-expression 
 8426: before the dot or arrow. 
 8427: 2 The left-hand side of the dot operator shall be of scalar type. The left-hand side of the arrow operator shall 
 8428: be of pointer to scalar type. This scalar type is the object type. The cv-unqualified versions of the object 
 8429: type and of the type designated by the pseudo-destructor-name shall be the same type. Furthermore, the 
 8430: two type-names in a pseudo-destructor-name of the form 
 8431: ::opt nested-name-specifieropt type-name :: ‵ type-name 
 8432: shall designate the same scalar type. 
 8433: 5.2.5 Class member access [expr.ref] 
 8434: 1 A postfix expression followed by a dot . or an arrow ->, optionally followed by the keyword template (14.8.1), 
 8435: and then followed by an id-expression, is a postfix expression. The postfix expression before the dot or ar-
 8436: row is evaluated;60 the result of that evaluation, together with the id-expression, determine the result of the 
 8437: entire postfix expression. 
 8438: 2 For the first option (dot) the type of the first expression (the object expression ) shall be ※class object§ (of a 
 8439: complete type). For the second option (arrow) the type of the first expression (the pointer expression ) shall 
 8440: be ※pointer to class object§ (of a complete type). In these cases, the id-expression shall name a member 
 8441: of the class or of one of its base classes. [ Note: because the name of a class is inserted in its class scope 
 8442: (Clause 9), the name of a class is also considered a nested member of that class. 〞end note ][ Note: 3.4.5 
 8443: describes how names are looked up after the . and -> operators. 〞end note ] 
 8444: 3 If E1 has the type ※pointer to class X,§ then the expression E1->E2 is converted to the equivalent form 
 8445: (*(E1)).E2;the remainder of5.2.5will address only the first option (dot)61. Abbreviating object-expression.id-
 8446: expression as E1.E2, then the type and lvalue properties of this expression are determined as follows. In the 
 8447: remainder of 5.2.5, cq represents either const or the absence of const vq represents either volatile or the 
 8448: absence of volatile. cv represents an arbitrary set of cv-qualifiers, as defined in 3.9.3. 
 8449: 4 If E2 is declared to have type ※reference to T,§ then E1.E2 is an lvalue; the type of E1.E2 is T. Otherwise, 
 8450: one of the following rules applies. 
 8451: 60) This evaluation happens even if the result is unnecessary to determine the value of the entire postfix expression, for example 
 8452: if the id-expression denotes a static member.
 8453: 61) Note that if E1 has the type ※pointer to class X,§ then (*(E1)) is an lvalue.
 8454: ∫ 5.2.5 94 
 8455: 
 8456: c
 8457: . ISO/IEC N2800=08-0310 
 8458: 〞 If E2 is a static data member, and the type of E2 is T, then E1.E2 is an lvalue; the expression designates 
 8459: the named member of the class. The type of E1.E2 is T. 
 8460: 〞 If E2 is a non-static data member, and the type of E1 is ※cq1 vq1 X§, and the type of E2 is ※cq2 vq2 
 8461: T§, the expression designates the named member of the object designated by the first expression. If 
 8462: E1 is an lvalue, then E1.E2 is an lvalue; otherwise, it is an rvalue. Let the notation vq12 stand for the 
 8463: ※union§ of vq1 and vq2; that is, if vq1 or vq2 is volatile, then vq12 is volatile. Similarly, let the 
 8464: notation cq12 stand for the ※union§ of cq1 and cq2; that is, if cq1 or cq2 is const, then cq12 is const. 
 8465: If E2 is declared to be a mutable member, then the type of E1.E2 is ※vq12 T§. If E2 is not declared to 
 8466: be a mutable member, then the type of E1.E2 is ※cq12 vq12 T§. 
 8467: 〞 If E2 is a (possibly overloaded) member function, function overload resolution (13.3) is used to deter-
 8468: mine whether E1.E2 refers to a static or a non-static member function. 
 8469: 〞 If it refers to a static member function, and the type of E2 is ※function of parameter-type-list 
 8470: returning T§, then E1.E2 is an lvalue; the expression designates the static member function. The 
 8471: type of E1.E2 is the same type as that of E2, namely ※function of parameter-type-list returning 
 8472: T§. 
 8473: 〞 Otherwise, if E1.E2 refers to a non-static member function, and the type of E2 is ※function of 
 8474: parameter-type-list cv returning T§, then E1.E2 is not an lvalue. The expression designates a 
 8475: non-static member function. The expression can be used only as the left-hand operand of a 
 8476: member function call (9.3). [ Note: any redundant set of parentheses surrounding the expression 
 8477: is ignored (5.1). 〞end note ] The type of E1.E2 is ※function of parameter-type-list cv returning 
 8478: T§. 
 8479: 〞 If E2 is a nested type, the expression E1.E2 is ill-formed. 
 8480: 〞 If E2 is a member enumerator, and the type of E2 is T, the expression E1.E2 is not an lvalue. The 
 8481: type of E1.E2 is T. 
 8482: 5 If E2 is a non-static data member or a non-static member function, the program is ill-formed if the class of 
 8483: which E2 is directly a member is an ambiguous base (10.2) of the naming class (11.2) of E2. 
 8484: 5.2.6 Increment and decrement [expr.post.incr] 
 8485: 1 The value of a postfix ++ expression is the value of its operand. [ Note: the value obtained is a copy of 
 8486: the original value 〞end note ] The operand shall be a modifiable lvalue. The type of the operand shall 
 8487: be an arithmetic type or a pointer to a complete effective object type. The value of the operand object is 
 8488: modified by adding 1 to it, unless the object is of type bool, in which case it is set to true.[ Note: this use 
 8489: is deprecated, see Annex D. 〞end note ] The value computation of the ++ expression is sequenced before 
 8490: the modification of the operand object. With respect to an indeterminately-sequenced function call, the 
 8491: operation of postfix ++ is a single evaluation. [ Note: Therefore, a function call shall not intervene between 
 8492: the lvalue-to-rvalue conversion and the side effect associated with any single postfix ++ operator. 〞end 
 8493: note ] The result is an rvalue. The type of the result is the cv-unqualified version of the type of the operand. 
 8494: See also 5.7 and 5.17. 
 8495: The operand of postfix --is decremented analogously to the postfix ++ operator, except that the operand 
 8496: shall not be of type bool.[ Note: For prefix increment and decrement, see 5.3.2. 〞end note ] 
 8497: 5.2.7 Dynamic cast [expr.dynamic.cast] 
 8498: 1 The result of the expression dynamic_cast<T>(v) is the result of converting the expression v to type T. T 
 8499: shall be a pointer or reference to a complete effective class type, or ※pointer to cv void.§ The dynamic_cast 
 8500: operator shall not cast away constness (5.2.11). 
 8501: ∫ 5.2.7 95 
 8502: 
 8503: c
 8504: . ISO/IEC N2800=08-0310 
 8505: 2 If T is a pointer type, v shall be an rvalue of a pointer to complete effective class type, and the result is an 
 8506: rvalue of type T. If T is an lvalue reference type, v shall be an lvalue of a complete effective class type, and 
 8507: the result is an lvalue of the type referred to by T. If T is an rvalue reference type, v shall be an expression 
 8508: having a complete effective class type, and the result is an rvalue of the type referred to by T. 
 8509: 3 If the type of v is the same as the required result type (which, for convenience, will be called R in this 
 8510: description), or it is the same as R except that the class object type in R is more cv-qualified than the class 
 8511: object type in v, the result is v (converted if necessary). 
 8512: 4 If the value of v is a null pointer value in the pointer case, the result is the null pointer value of type R. 
 8513: 5 If T is ※pointer to cv1 B§ and v has type ※pointer to cv2 D§ such that B is a base class of D, the result is a 
 8514: pointer to the unique B subobject of the D object pointed to by v. Similarly, if T is ※reference to cv1 B§ and 
 8515: v has type cv2 D such that B is a base class of D, the result is the unique B subobject of the D object referred 
 8516: to by v. 62 The result is an lvalue if T is an lvalue reference, or an rvalue if T is an rvalue reference. In both 
 8517: the pointer and reference cases, cv1 shall be the same cv-qualification as, or greater cv-qualification than, 
 8518: cv2, and B shall be an accessible unambiguous base class of D.[ Example: 
 8519: struct B { };
 8520: struct D : B { };
 8521: void foo(D* dp) {
 8522: B* bp = dynamic_cast<B*>(dp); // equivalent to B* bp = dp;
 8523: }
 8524: 〞end example ] 
 8525: 6 Otherwise, v shall be a pointer to or an lvalue of a polymorphic type (10.3). 
 8526: 7 If T is ※pointer to cv void,§ then the result is a pointer to the most derived object pointed to by v. Otherwise, 
 8527: a run-time check is applied to see if the object pointed or referred to by v can be converted to the type 
 8528: pointed or referred to by T. 
 8529: 8 The run-time check logically executes as follows: 
 8530: 〞 If, in the most derived object pointed (referred) to by v, v points (refers) to a public base class 
 8531: subobject of a T object, and if only one object of type T is derived from the subobject pointed (referred) 
 8532: to by v the result is a pointer (an lvalue referring) to that T object. 
 8533: 〞 Otherwise, if v points (refers) to a public base class subobject of the most derived object, and the 
 8534: type of the most derived object has a base class, of type T, that is unambiguous and public, the result 
 8535: is a pointer (an lvalue referring) to the T subobject of the most derived object. 
 8536: 〞 Otherwise, the run-time check fails. 
 8537: 9 The value of a failed cast to pointer type is the null pointer value of the required result type. A failed cast 
 8538: to reference type throws std::bad_cast (18.6.3). 
 8539: [ Example: 
 8540: class A { virtual void f(); };
 8541: class B { virtual void g(); };
 8542: class D : public virtual A, private B { };
 8543: void g() {
 8544: D d;
 8545: B* bp = (B*)&d; // cast needed to break protection
 8546: A* ap=&d; // public derivation, no cast needed
 8547: D& dr = dynamic_cast<D&>(*bp); // fails
 8548: 62) The most derived object (1.8) pointed or referred to by v can contain other B objects as base classes, but these are ignored. 
 8549: ∫ 5.2.7 96 
 8550: 
 8551: c
 8552: . ISO/IEC N2800=08-0310 
 8553: ap = dynamic_cast<A*>(bp); // fails
 8554: bp = dynamic_cast<B*>(ap); // fails
 8555: ap = dynamic_cast<A*>(&d); //succeeds
 8556: bp = dynamic_cast<B*>(&d); //fails
 8557: } 
 8558: class E : public D, public B { };
 8559: class F : public E, public D { };
 8560: void h() {
 8561: F f;
 8562: A* ap =&f; // succeeds: finds unique A
 8563: D* dp = dynamic_cast<D*>(ap); // fails: yields 0
 8564: // f has two D subobjects
 8565: E* ep = (E*)ap; // ill-formed: cast from virtual base
 8566: E* ep1 = dynamic_cast<E*>(ap); // succeeds
 8567: } 
 8568: 〞end example ][ Note: 12.7 describes the behavior of a dynamic_cast applied to an object under construc-
 8569: tion or destruction. 〞end note ] 
 8570: 5.2.8 Type identification [expr.typeid] 
 8571: 1 The result of a typeid expression is an lvalue of static type const std::type_info (18.6.1) and dynamic 
 8572: type const std::type_info or const name where name is an implementation-defined class derived from 
 8573: std :: type_info which preserves the behavior described in18.6.1.63 The lifetime of the object referred to by 
 8574: the lvalue extends to the end of the program. Whether or not the destructor is called for the std::type_info 
 8575: object at the end of the program is unspecified. 
 8576: 2 When typeid is applied to an lvalue expression whose type is a polymorphic class type (10.3), the result refers 
 8577: to a std::type_info object representing the type of the most derived object (1.8) (that is, the dynamic 
 8578: type) to which the lvalue refers. If the lvalue expression is obtained by applying the unary * operator to a 
 8579: pointer64 and the pointer is a null pointer value (4.10), the typeid expression throws the std::bad_typeid 
 8580: exception (18.6.4). 
 8581: 3 When typeid is applied to an expression other than an lvalue of a polymorphic class type, the result refers 
 8582: to a std::type_info object representing the static type of the expression. Lvalue-to-rvalue (4.1), array-to-
 8583: pointer (4.2), and function-to-pointer (4.3) conversions are not applied to the expression. If the type of the 
 8584: expression is a class type, the class shall be completely-defined. The expression is an unevaluated operand 
 8585: (Clause 5). 
 8586: 4 When typeid is applied to a type-id, the result refers to a std::type_info object representing the type of 
 8587: the type-id. If the type of the type-id is a reference to a possibly cv-qualified type, the result of the typeid 
 8588: expression refers to a std::type_info object representing the cv-unqualified referenced type. If the type of 
 8589: the type-id is a class type or a reference to a class type, the class shall be completely-defined. 
 8590: 5 The top-level cv-qualifiers of the lvalue expression or the type-id that is the operand of typeid are always 
 8591: ignored. [ Example: 
 8592: class D { ... };
 8593: D d1;
 8594: const D d2;
 8595: 63) The recommended name for such a class is extended_type_info.
 8596: 64) If p is an expression of pointer type, then *p, (*p), *(p), ((*p)), *((p)), and so on all meet this requirement.
 8597: ∫ 5.2.8 97 
 8598: 
 8599: c
 8600: . ISO/IEC N2800=08-0310 
 8601: typeid(d1) == typeid(d2); // yields true
 8602: typeid(D) == typeid(const D); // yields true
 8603: typeid(D) == typeid(d2); // yields true
 8604: typeid(D) == typeid(const D&); // yields true
 8605: 〞end example ] 
 8606: 6 If the header <typeinfo> (18.6.1) is not included prior to a use of typeid, the program is ill-formed. 
 8607: 7 [ Note: 12.7 describes the behavior of typeid applied to an object under construction or destruction. 〞end 
 8608: note ] 
 8609: 5.2.9 Static cast [expr.static.cast] 
 8610: 1 The result of the expression static_cast<T>(v) is the result of converting the expression v to type T. If 
 8611: T is an lvalue reference type, the result is an lvalue; otherwise, the result is an rvalue. The static_cast 
 8612: operator shall not cast away constness (5.2.11). 
 8613: 2 An lvalue of type ※cv1 B,§ where B is a class type, can be cast to type ※reference to cv2 D,§ where D is a class 
 8614: derived (Clause 10) from B, if a valid standard conversion from ※pointer to D§ to ※pointer to B§ exists (4.10), 
 8615: cv2 is the same cv-qualification as, or greater cv-qualification than, cv1, and B is neither a virtual base class 
 8616: of D nor a base class of a virtual base class of D. The result has type ※cv2 D.§ It is an lvalue if the type cast 
 8617: to is an lvalue reference; otherwise, it is an rvalue. An rvalue of type ※cv1 B§ may be cast to type ※rvalue 
 8618: reference to cv2 D§ with the same constraints as for an lvalue of type ※cv1 B.§ The result is an rvalue. If the 
 8619: object of type ※cv1 B§ is actually a subobject of an object of type D, the result refers to the enclosing object 
 8620: of type D. Otherwise, the result of the cast is undefined. [ Example: 
 8621: struct B { };
 8622: struct D : public B { };
 8623: D d;
 8624: B &br = d;
 8625: static_cast<D&>(br); // produces lvalue to the original d object 
 8626: 〞end example ] 
 8627: 3 Otherwise, an expression e can be explicitly converted to a type T using a static_cast of the form static_-
 8628: cast<T>(e) if the declaration T t(e); is well-formed, for some invented temporary variable t (8.5). The 
 8629: effect of such an explicit conversion is the same as performing the declaration and initialization and then 
 8630: using the temporary variable as the result of the conversion. The result is an lvalue if T is an lvalue reference 
 8631: type (8.3.2), and an rvalue otherwise. The expression e is used as an lvalue if and only if the initialization 
 8632: uses it as an lvalue. 
 8633: 4 Otherwise, the static_cast shall perform one of the conversions listed below. No other conversion shall be 
 8634: performed explicitly using a static_cast. 
 8635: 5 Any expression can be explicitly converted to type cv void. The expression value is discarded. [ Note: 
 8636: however, if the value is in a temporary variable (12.2), the destructor for that variable is not executed until 
 8637: the usual time, and the value of the variable is preserved for the purpose of executing the destructor. 〞end 
 8638: note ] The lvalue-to-rvalue (4.1), array-to-pointer (4.2), and function-to-pointer (4.3) standard conversions 
 8639: are not applied to the expression. 
 8640: 6 The inverse of any standard conversion sequence (Clause 4), other than the lvalue-to-rvalue (4.1), array-to-
 8641: pointer (4.2), function-to-pointer (4.3), and boolean (4.12) conversions, can be performed explicitly using 
 8642: static_cast. A program is ill-formed if it uses static_cast to perform the inverse of an ill-formed standard 
 8643: conversion sequence. [ Example: 
 8644: ∫ 5.2.9 98 
 8645: 
 8646: c
 8647: . ISO/IEC N2800=08-0310 
 8648: struct B { };
 8649: struct D : private B { };
 8650: void f() {
 8651: static_cast<D*>((B*)0); // Error: B is a private base of D.
 8652: static_cast<int B::*>((int D::*)0); // Error: B is a private base of D.
 8653: } 
 8654: 〞end example ] 
 8655: 7 The lvalue-to-rvalue (4.1), array-to-pointer (4.2), and function-to-pointer (4.3) conversions are applied to 
 8656: the operand. Such a static_cast is subject to the restriction that the explicit conversion does not cast 
 8657: away constness (5.2.11), and the following additional rules for specific cases: 
 8658: 8 A value of a scoped enumeration type (7.2) can be explicitly converted to an integral type. The value is 
 8659: unchanged if the original value can be represented by the specified type. Otherwise, the resulting value is 
 8660: unspecified. 
 8661: 9 A value of integral or enumeration type can be explicitly converted to an enumeration type. The value is 
 8662: unchanged if the original value is within the range of the enumeration values (7.2). Otherwise, the resulting 
 8663: enumeration value is unspecified. 
 8664: 10 An rvalue of type ※pointer to cv1 B,§ where B is a class type, can be converted to an rvalue of type ※pointer 
 8665: to cv2 D,§ where D is a class derived (Clause 10) from B, if a valid standard conversion from ※pointer to D§ to 
 8666: ※pointer to B§ exists (4.10), cv2 is the same cv-qualification as, or greater cv-qualification than, cv1, and B 
 8667: is neither a virtual base class of D nor a base class of a virtual base class of D. The null pointer value (4.10) 
 8668: is converted to the null pointer value of the destination type. If the rvalue of type ※pointer to cv1 B§ points 
 8669: to a B that is actually a subobject of an object of type D, the resulting pointer points to the enclosing object 
 8670: of type D. Otherwise, the result of the cast is undefined. 
 8671: 11 An rvalue of type ※pointer to member of D of type cv1 T§ can be converted to an rvalue of type ※pointer to 
 8672: member of B§ of type cv2 T, where B is a base class (Clause 10) of D, if a valid standard conversion from 
 8673: ※pointer to member of B of type T§ to ※pointer to member of D of type T§ exists (4.11), and cv2 is the same 
 8674: cv-qualification as, or greater cv-qualification than, cv1.65 The null member pointer value (4.11) is converted 
 8675: to the null member pointer value of the destination type. If class B contains the original member, or is a base 
 8676: or derived class of the class containing the original member, the resulting pointer to member points to the 
 8677: original member. Otherwise, the result of the cast is undefined. [ Note: although class B need not contain 
 8678: the original member, the dynamic type of the object on which the pointer to member is dereferenced must 
 8679: contain the original member; see 5.5. 〞end note ] 
 8680: 12 An rvalue of type ※pointer to cv1 void§ can be converted to an rvalue of type ※pointer to cv2 T,§ where 
 8681: T is an object type and cv2 is the same cv-qualification as, or greater cv-qualification than, cv1. The null 
 8682: pointer value is converted to the null pointer value of the destination type. A value of type pointer to object 
 8683: converted to ※pointer to cv void§ and back, possibly with different cv-qualification, shall have its original 
 8684: value. [ Example: 
 8685: T* p1 = new T;
 8686: const T* p2 = static_cast<const T*>(static_cast<void*>(p1));
 8687: bool b = p1 == p2; // b will have the value true.
 8688: 〞end example ] 
 8689: 5.2.10 Reinterpret cast [expr.reinterpret.cast] 
 8690: 1 The result of the expression reinterpret_cast<T>(v) is the result of converting the expression v to type 
 8691: 65) Function types (including those used in pointer to member function types) are never cv-qualified; see 8.3.5. 
 8692: ∫ 5.2.10 99 
 8693: 
 8694: c
 8695: . ISO/IEC N2800=08-0310 
 8696: T. If T is an lvalue reference type, the result is an lvalue; otherwise, the result is an rvalue and the lvalue-to-
 8697: rvalue (4.1), array-to-pointer (4.2), and function-to-pointer (4.3) standard conversions are performed on the 
 8698: the expression v. Conversions that can be performed explicitly using reinterpret_cast are listed below. 
 8699: No other conversion can be performed explicitly using reinterpret_cast. 
 8700: 2 The reinterpret_cast operator shall not cast away constness. [ Note: see 5.2.11 for the definition of 
 8701: ※casting away constness§. Subject to the restrictions in this section, an expression may be cast to its own 
 8702: type using a reinterpret_cast operator. 〞end note ] 
 8703: 3 The mapping performed by reinterpret_cast is implementation-defined. [ Note: it might, or might not, 
 8704: produce a representation different from the original value. 〞end note ] 
 8705: 4 A pointer can be explicitly converted to any integral type large enough to hold it. The mapping function is 
 8706: implementation-defined. [ Note: it is intended to be unsurprising to those who know the addressing structure 
 8707: of the underlying machine. 〞end note ] A value of type std::nullptr_t can be converted to an integral 
 8708: type; the conversion has the same meaning and validity as a conversion of (void*)0 to the integral type. 
 8709: [ Note: a reinterpret_cast cannot be used to convert a value of any type to the type std::nullptr_t. 
 8710: 〞end note ] 
 8711: 5 A value of integral type or enumeration type can be explicitly converted to a pointer. A pointer converted 
 8712: to an integer of sufficient size (if any such exists on the implementation) and back to the same pointer type 
 8713: will have its original value; mappings between pointers and integers are otherwise implementation-defined. 
 8714: 6 A pointer to a function can be explicitly converted to a pointer to a function of a different type. The effect 
 8715: of calling a function through a pointer to a function type (8.3.5) that is not the same as the type used in 
 8716: the definition of the function is undefined. Except that converting an rvalue of type ※pointer to T1§ to the 
 8717: type ※pointer to T2§ (where T1 and T2 are function types) and back to its original type yields the original 
 8718: pointer value, the result of such a pointer conversion is unspecified. [ Note: see also 4.10 for more details of 
 8719: pointer conversions. 〞end note ] 
 8720: 7 A pointer to an effective object can be explicitly converted to a pointer to a different effective object type.66 
 8721: Except that converting an rvalue of type ※pointer to T1§ to the type ※pointer to T2§ (where T1 and T2 are 
 8722: object types and where the alignment requirements of T2 are no stricter than those of T1) and back to its 
 8723: original type yields the original pointer value, the result of such a pointer conversion is unspecified. 
 8724: 8 Converting a pointer to a function into a pointer to an object type or vice versa is conditionally-supported. 
 8725: The meaning of such a conversion is implementation defined, except that if an implementation supports 
 8726: conversions in both directions, converting an rvalue of one type to the other type and back, possibly with 
 8727: different cv-qualification, shall yield the original pointer value. 
 8728: 9 The null pointer value (4.10) is converted to the null pointer value of the destination type. [ Note: A null 
 8729: pointer constant of type std::nullptr_t cannot be converted to a pointer type, and a null pointer constant 
 8730: of integral type is not necessarily converted to a null pointer value. 〞end note ] 
 8731: 10 An rvalue of type ※pointer to member of X of type T1§ can be explicitly converted to an rvalue of type 
 8732: ※pointer to member of Y of type T2§ if T1 and T2 are both function types or both effective object types.67 
 8733: The null member pointer value (4.11) is converted to the null member pointer value of the destination type. 
 8734: The result of this conversion is unspecified, except in the following cases: 
 8735: 〞 converting an rvalue of type ※pointer to member function§ to a different pointer to member function 
 8736: type and back to its original type yields the original pointer to member value. 
 8737: 66) The types may have different cv-qualifiers, subject to the overall restriction that a reinterpret_cast cannot cast away 
 8738: constness. 
 8739: 67) T1 and T2 may have different cv-qualifiers, subject to the overall restriction that a reinterpret_cast cannot cast away 
 8740: constness. 
 8741: ∫ 5.2.10 100 
 8742: 
 8743: c
 8744: ISO/IEC N2800=08-0310 
 8745: 〞 converting an rvalue of type ※pointer to data member of X of type T1§ to the type ※pointer to data 
 8746: member of Y of type T2§ (where the alignment requirements of T2 are no stricter than those of T1) 
 8747: and back to its original type yields the original pointer to member value. 
 8748: 11 An lvalue expression of type T1 can be cast to the type ※reference to T2§ if an expression of type ※pointer to 
 8749: T1§ can be explicitly converted to the type ※pointer to T2§ using a reinterpret_cast. That is, a reference 
 8750: cast reinterpret_cast<T&>(x) has the same effect as the conversion *reinterpret_cast<T*>(&x) with 
 8751: the built-in & and * operators (and similarly for reinterpret_cast<T&&>(x)). The result refers to the 
 8752: same object as the source lvalue, but with a different type. The result is an lvalue for lvalue references or an 
 8753: rvalue for rvalue references. No temporary is created, no copy is made, and constructors (12.1) or conversion 
 8754: functions (12.3) are not called.68 
 8755: 5.2.11 Const cast [expr.const.cast] 
 8756: 1 The result of the expression const_cast<T>(v) is of type T. If T is an lvalue reference type, the result 
 8757: is an lvalue; otherwise, the result is an rvalue and the lvalue-to-rvalue (4.1), array-to-pointer (4.2), and 
 8758: function-to-pointer (4.3) standard conversions are performed on the expression v. Conversions that can be 
 8759: performed explicitly using const_cast are listed below. No other conversion shall be performed explicitly 
 8760: using const_cast. 
 8761: 2 [ Note: Subject to the restrictions in this section, an expression may be cast to its own type using a const_-
 8762: cast operator. 〞end note ] 
 8763: 3 For two pointer types T1 and T2 where 
 8764: T1 is cv 1,0 pointer to cv 1,1 pointer to ﹞﹞﹞cv 1,n.1 pointer to cv 1,n T 
 8765: and 
 8766: T2 is cv2,0 pointer to cv 2,1 pointer to ﹞﹞﹞cv 2,n.1 pointer to cv 2,n T 
 8767: where T is any effective object type or the void type and where cv1,k and cv 2,k may be different cv-
 8768: qualifications, an rvalue of type T1 may be explicitly converted to the type T2 using a const_cast. The 
 8769: result of a pointer const_cast refers to the original object. 
 8770: 4 An lvalue of type T1 can be explicitly converted to an lvalue of type T2 using the cast const_cast<T2&> 
 8771: (where T1 and T2 are effective object types) if a pointer to T1 can be explicitly converted to the type ※pointer 
 8772: to T2§ using a const_cast. Similarly, for two effective object types T1 and T2, an expression of type T1 can 
 8773: be explicitly converted to an rvalue of type T2 using the cast const_cast<T2&&> if a pointer to T1 can be 
 8774: explicitly converted to the type ※pointer to T2§ using a const_cast. The result of a reference const_cast 
 8775: refers to the original object. 
 8776: 5 For a const_cast involving pointers to data members, multi-level pointers to data members and multi-level 
 8777: mixed pointers and pointers to data members (4.4), the rules for const_cast are the same as those used for 
 8778: pointers; the ※member§ aspect of a pointer to member is ignored when determining where the cv-qualifiers 
 8779: are added or removed by the const_cast. The result of a pointer to data member const_cast refers to the 
 8780: same member as the original (uncast) pointer to data member. 
 8781: 6 A null pointer value (4.10) is converted to the null pointer value of the destination type. The null member 
 8782: pointer value (4.11) is converted to the null member pointer value of the destination type. 
 8783: 7 [ Note: Depending on the type of the object, a write operation through the pointer, lvalue or pointer 
 8784: to data member resulting from a const_cast that casts away a const-qualifier69 may produce undefined 
 8785: behavior (7.1.6.1). 〞end note ] 
 8786: 68) This is sometimes referred to as a type pun.
 8787: 69) const_cast is not limited to conversions that cast away a const-qualifier.
 8788: ∫ 5.2.11 101 
 8789: 
 8790: c
 8791: ISO/IEC N2800=08-0310 
 8792: 8 The following rules define the process known as casting away constness. In these rules Tn and Xn represent 
 8793: types. For two pointer types: 
 8794: X1 is T1cv 1,1 * cv 1,N * where T1 is not a pointer type 
 8795: ﹞﹞﹞ 
 8796: X2 is T2cv 2,1 * cv 2,M * where T2 is not a pointer type 
 8797: ﹞﹞﹞ 
 8798: K is min(N, M) 
 8799: casting from X1 to X2 casts away constness if, for a non-pointer type T there does not exist an implicit 
 8800: conversion (Clause 4) from: 
 8801: Tcv 1,(N .K+1) * cv 1,(N .K+2) * cv 1,N * 
 8802: ﹞﹞﹞ 
 8803: to 
 8804: Tcv 2,(M .K+1) * cv 2,(M .K+2) * cv 2,M * 
 8805: ﹞﹞﹞ 
 8806: 9 Casting from an lvalue of type T1 to an lvalue of type T2 using a reference cast casts away constness if a 
 8807: cast from an rvalue of type ※pointer to T1§ to the type ※pointer to T2§ casts away constness. 
 8808: 10 Casting from an rvalue of type ※pointer to data member of X of type T1§ to the type ※pointer to data member 
 8809: of Y of type T2§ casts away constness if a cast from an rvalue of type ※pointer to T1§ to the type ※pointer 
 8810: to T2§ casts away constness. 
 8811: 11 For multi-level pointer to members and multi-level mixed pointers and pointer to members (4.4), the ※mem-
 8812: ber§ aspect of a pointer to member level is ignored when determining if a const cv-qualifier has been cast 
 8813: away. 
 8814: 12 [ Note: some conversions which involve only changes in cv-qualification cannot be done using const_cast. 
 8815: For instance, conversions between pointers to functions are not covered because such conversions lead to 
 8816: values whose use causes undefined behavior. For the same reasons, conversions between pointers to member 
 8817: functions, and in particular, the conversion from a pointer to a const member function to a pointer to a 
 8818: non-const member function, are not covered. 〞end note ] 
 8819: 5.3 Unary expressions [expr.unary] 
 8820: 1 Expressions with unary operators group right-to-left. 
 8821: unary-expression:
 8822: postfix-expression
 8823: ++ cast-expression
 8824: --cast-expression
 8825: unary-operator cast-expression
 8826: sizeof unary-expression
 8827: sizeof ( type-id )
 8828: sizeof ... ( identifier )
 8829: alignof ( type-id )
 8830: new-expression
 8831: delete-expression
 8832: unary-operator: one of 
 8833: * & + -! ‵ 
 8834: 5.3.1 Unary operators [expr.unary.op] 
 8835: 1 The unary * operator performs indirection: the expression to which it is applied shall be a pointer to an 
 8836: effective object type, or a pointer to a function type and the result is an lvalue referring to the object or 
 8837: ∫ 5.3.1 102 
 8838: 
 8839: c
 8840: . ISO/IEC N2800=08-0310 
 8841: function to which the expression points. If the type of the expression is ※pointer to T,§ the type of the 
 8842: result is ※T.§ [ Note: a pointer to an incomplete type (other than cv void) can be dereferenced. The lvalue 
 8843: thus obtained can be used in limited ways (to initialize a reference, for example); this lvalue must not be 
 8844: converted to an rvalue, see 4.1. 〞end note ] 
 8845: 2 The result of the unary & operator is a pointer to its operand. The operand shall be an lvalue or a qualified-
 8846: id. In the first case, if the type of the expression is ※T,§ the type of the result is ※pointer to T.§ In particular, 
 8847: the address of an object of type ※cv T§ is ※pointer to cv T,§ with the same cv-qualifiers. For a qualified-id, 
 8848: if the member is a static member of type ※T§, the type of the result is plain ※pointer to T.§ If the member 
 8849: is a non-static member of class C of type T, the type of the result is ※pointer to member of class C of type 
 8850: T.§ The address of a member of a concept map (14.9.2) shall not be taken, either implicitly or explicitly, nor 
 8851: shall a member of a concept map be bound to a reference. [ Example: 
 8852: struct A { int i; };
 8853: struct B : A { };
 8854: ... &B::i ... // has type int A::*
 8855: 〞end example ][ Note: a pointer to member formed from a mutable non-static data member (7.1.1) does 
 8856: not reflect the mutable specifier associated with the non-static data member. 〞end note ] 
 8857: 3 A pointer to member is only formed when an explicit & is used and its operand is a qualified-id not enclosed 
 8858: in parentheses. [ Note: that is, the expression &(qualified-id), where the qualified-id is enclosed in 
 8859: parentheses, does not form an expression of type ※pointer to member.§ Neither does qualified-id, because 
 8860: there is no implicit conversion from a qualified-id for a non-static member function to the type ※pointer to 
 8861: member function§ as there is from an lvalue of function type to the type ※pointer to function§ (4.3). Nor is 
 8862: &unqualified-id a pointer to member, even within the scope of the unqualified-id＊s class. 〞end note ] 
 8863: 4 The address of an object of incomplete type can be taken, but if the complete type of that object is a class 
 8864: type that declares operator&() as a member function, then the behavior is undefined (and no diagnostic is 
 8865: required). The operand of & shall not be a bit-field. 
 8866: 5 The address of an overloaded function (Clause 13) can be taken only in a context that uniquely determines 
 8867: which version of the overloaded function is referred to (see 13.4). [ Note: since the context might determine 
 8868: whether the operand is a static or non-static member function, the context can also affect whether the 
 8869: expression has type ※pointer to function§ or ※pointer to member function.§ 〞end note ] 
 8870: 6 The operand of the unary + operator shall have arithmetic, enumeration, or pointer type and the result is 
 8871: the value of the argument. Integral promotion is performed on integral or enumeration operands. The type 
 8872: of the result is the type of the promoted operand. 
 8873: 7 The operand of the unary -operator shall have arithmetic or enumeration type and the result is the negation 
 8874: of its operand. Integral promotion is performed on integral or enumeration operands. The negative of an 
 8875: unsigned quantity is computed by subtracting its value from 2n, where n is the number of bits in the 
 8876: promoted operand. The type of the result is the type of the promoted operand. 
 8877: 8 The operand of the logical negation operator ! is contextually converted to bool (Clause 4); its value is 
 8878: true if the converted operand is false and false otherwise. The type of the result is bool. 
 8879: 9 The operand of . shall have integral or enumeration type; the result is the one＊s complement of its operand. 
 8880: Integral promotions are performed. The type of the result is the type of the promoted operand. There is 
 8881: an ambiguity in the unary-expression .X(), where X is a class-name. The ambiguity is resolved in favor of 
 8882: treating . as a unary complement rather than treating .X as referring to a destructor. 
 8883: 5.3.2 Increment and decrement [expr.pre.incr] 
 8884: 1 The operand of prefix ++ is modified by adding 1, or set to true if it is bool (this use is deprecated). The 
 8885: ∫ 5.3.2 103 
 8886: 
 8887: c
 8888: . ISO/IEC N2800=08-0310 
 8889: operand shall be a modifiable lvalue. The type of the operand shall be an arithmetic type or a pointer to 
 8890: a completely-defined effective object type. The result is the updated operand; it is an lvalue, and it is a 
 8891: bit-field if the operand is a bit-field. If x is not of type bool, the expression ++x is equivalent to x+=1 [ Note: 
 8892: see the discussions of addition (5.7) and assignment operators (5.17) for information on conversions. 〞end 
 8893: note ] 
 8894: 2 The operand of prefix --is modified by subtracting 1. The operand shall not be of type bool. The 
 8895: requirements on the operand of prefix --and the properties of its result are otherwise the same as those of 
 8896: prefix ++.[ Note: For postfix increment and decrement, see 5.2.6. 〞end note ] 
 8897: 5.3.3 Sizeof [expr.sizeof] 
 8898: 1 The sizeof operator yields the number of bytes in the object representation of its operand. The operand is 
 8899: either an expression, which is an unevaluated operand (Clause 5), or a parenthesized type-id. The sizeof 
 8900: operator shall not be applied to an expression that has function or incomplete type, or to an enumeration 
 8901: type before all its enumerators have been declared, or to the parenthesized name of such types, or to 
 8902: an lvalue that designates a bit-field. sizeof(char), sizeof(signed char) and sizeof(unsigned char) 
 8903: are 1. The result of sizeof applied to any other fundamental type (3.9.1) is implementation-defined. 
 8904: [ Note: in particular, sizeof(bool), sizeof(char16_t), sizeof(char32_t), and sizeof(wchar_t) are 
 8905: implementation-defined.70 〞end note ][ Note: See 1.7 for the definition of byte and 3.9 for the definition 
 8906: of object representation. 〞 end note ] 
 8907: 2 When applied to a reference or a reference type, the result is the size of the referenced type. When applied 
 8908: to a class, the result is the number of bytes in an object of that class including any padding required for 
 8909: placing objects of that type in an array. The size of a most derived class shall be greater than zero (1.8). 
 8910: The result of applying sizeof to a base class subobject is the size of the base class type.71 When applied 
 8911: to an array, the result is the total number of bytes in the array. This implies that the size of an array of n 
 8912: elements is n times the size of an element. 
 8913: 3 The sizeof operator can be applied to a pointer to a function, but shall not be applied directly to a function. 
 8914: 4 The lvalue-to-rvalue (4.1), array-to-pointer (4.2), and function-to-pointer (4.3) standard conversions are not 
 8915: applied to the operand of sizeof. 
 8916: 5 The identifier in a sizeof... expression shall name a parameter pack. The sizeof... operator yields the 
 8917: number of arguments provided for the parameter pack identifier. The parameter pack is expanded (14.5.3) 
 8918: by the sizeof... operator. [ Example: 
 8919: template<class... Types>
 8920: struct count {
 8921: static const std::size_t value = sizeof...(Types);
 8922: };
 8923: 〞end example ] 
 8924: 6 The result of sizeof and sizeof... is a constant of type std::size_t.[ Note: std::size_t is defined in 
 8925: the standard header <cstddef> (18.1). 〞 end note ] 
 8926: 5.3.4 New [expr.new] 
 8927: 1 The new-expression attempts to create an object of the type-id (8.1) or new-type-id to which it is applied. 
 8928: The type of that object is the allocated type. This type shall be a complete object type, but not an 
 8929: 70) sizeof(bool) is not required to be 1. 
 8930: 71) The actual size of a base class subobject may be less than the result of applying sizeof to the subobject, due to virtual 
 8931: base classes and less strict padding requirements on base class subobjects. 
 8932: ∫ 5.3.4 104 
 8933: 
 8934: c
 8935: . ISO/IEC N2800=08-0310 
 8936: abstract class type or array thereof (1.8, 3.9, 10.4). It is implementation-defined whether over-aligned types 
 8937: are supported (3.11). [ Note: because references are not objects, references cannot be created by new-
 8938: expressions. 〞end note ][ Note: the type-id may be a cv-qualified type, in which case the object created 
 8939: by the new-expression has a cv-qualified type. 〞end note ] 
 8940: new-expression:
 8941: ::opt new new-placementopt new-type-id new-initializeropt
 8942: ::opt new new-placementopt ( type-id ) new-initializeropt
 8943: new-placement:
 8944: ( expression-list )
 8945: new-type-id:
 8946: type-specifier-seq new-declaratoropt
 8947: new-declarator:
 8948: ptr-operator new-declaratoropt
 8949: noptr-new-declarator
 8950: noptr-new-declarator:
 8951: [ expression ]
 8952: noptr-new-declarator [ constant-expression ]
 8953: new-initializer:
 8954: ( expression-listopt )
 8955: braced-init-list
 8956: Entities created by a new-expression have dynamic storage duration (3.7.4). [ Note: the lifetime of such an 
 8957: entity is not necessarily restricted to the scope in which it is created. 〞end note ] If the entity is a non-
 8958: array object, the new-expression returns a pointer to the object created. If it is an array, the new-expression 
 8959: returns a pointer to the initial element of the array. 
 8960: 2 If the auto type-specifier appears in the type-specifier-seq of a new-type-id or type-id of a new-expression, the 
 8961: new-expression shall contain a new-initializer of the form 
 8962: ( assignment-expression ) 
 8963: The allocated type is deduced from the new-initializer as follows: Let (e) be the new-initializer and T be the 
 8964: new-type-id or type-id of the new-expression, then the allocated type is the type deduced for the variable x in 
 8965: the invented declaration (7.1.6.4): 
 8966: T x = e; 
 8967: [ Example: 
 8968: new auto(1); // allocated type is int
 8969: auto x = new auto(＊a＊); // allocated type is char, x is of type char*
 8970: 〞end example ] 
 8971: 3 The new-type-id in a new-expression is the longest possible sequence of new-declarators. [ Note: this prevents 
 8972: ambiguities between declarator operators &, *, [], and their expression counterparts. 〞end note ][ Example: 
 8973: new int * i; // syntax error: parsed as (new int*) i, not as (new int)*i 
 8974: The * is the pointer declarator and not the multiplication operator. 〞end example ] 
 8975: 4 [ Note: parentheses in a new-type-id of a new-expression can have surprising effects. [ Example: 
 8976: new int(*[10])(); // error 
 8977: is ill-formed because the binding is 
 8978: ∫ 5.3.4 105 
 8979: 
 8980: c
 8981: . ISO/IEC N2800=08-0310 
 8982: (new int) (*[10])(); // error 
 8983: Instead, the explicitly parenthesized version of the new operator can be used to create objects of compound 
 8984: types (3.9.2): 
 8985: new (int (*[10])()); 
 8986: allocates an array of 10 pointers to functions (taking no argument and returning int. 〞 end example ] 
 8987: 〞end note ] 
 8988: 5 When the allocated object is an array (that is, the noptr-new-declarator syntax is used or the new-type-id or 
 8989: type-id denotes an array type), the new-expression yields a pointer to the initial element (if any) of the array. 
 8990: [ Note: both new int and new int[10] have type int* and the type of new int[i][10] is int (*)[10] 
 8991: 〞end note ] 
 8992: 6 Every constant-expression in a noptr-new-declarator shall be an integral constant expression (5.19) and 
 8993: evaluate to a strictly positive value. The expression in a noptr-new-declarator shall be of integral type, 
 8994: enumeration type, or a class type for which a single non-explicit conversion function to integral or enu-
 8995: meration type exists (12.3). If the expression is of class type, the expression is converted by calling that 
 8996: conversion function, and the result of the conversion is used in place of the original expression. If the value 
 8997: of the expression is negative, the behavior is undefined. [ Example: given the definition int n = 42, new 
 8998: float[n][5] is well-formed (because n is the expression of a noptr-new-declarator), but new float[5][n] 
 8999: is ill-formed (because n is not a constant expression). If n is negative, the effect of new float[n][5] is 
 9000: undefined. 〞 end example ] 
 9001: 7 When the value of the expression in a noptr-new-declarator is zero, the allocation function is called to 
 9002: allocate an array with no elements. If the value of that expression is such that the size of the allocated object 
 9003: would exceed the implementation-defined limit, no storage is obtained and the new-expression terminates 
 9004: by throwing an exception of a type that would match a handler (15.3) of type std::length_error (19.1.4). 
 9005: 8 A new-expression obtains storage for the object by calling an allocation function (3.7.4.1). If the new-
 9006: expression terminates by throwing an exception, it may release storage by calling a deallocation func-
 9007: tion (3.7.4.2). If the allocated type is a non-array type, the allocation function＊s name is operator new and 
 9008: the deallocation function＊s name is operator delete. If the allocated type is an array type, the allocation 
 9009: function＊s name is operator new[] and the deallocation function＊s name is operator delete[].[ Note: an 
 9010: implementation shall provide default definitions for the global allocation functions (3.7.4, 18.5.1.1, 18.5.1.2). 
 9011: A C++ program can provide alternative definitions of these functions (17.6.4.6) and/or class-specific ver-
 9012: sions (12.5). 〞end note ] 
 9013: 9 If the new-expression begins with a unary :: operator, the allocation function＊s name is looked up in the 
 9014: global scope. Otherwise, if the allocated type is a class type T or array thereof, the allocation function＊s 
 9015: name is looked up in the scope of T If this lookup fails to find the name, or if the allocated type is not a 
 9016: class type, the allocation function＊s name is looked up in the global scope. 
 9017: 10 A new-expression passes the amount of space requested to the allocation function as the first argument of 
 9018: type std::size_t. That argument shall be no less than the size of the object being created; it may be 
 9019: greater than the size of the object being created only if the object is an array. For arrays of char and 
 9020: unsigned char, the difference between the result of the new-expression and the address returned by the 
 9021: allocation function shall be an integral multiple of the strictest fundamental alignment requirement (3.11) of 
 9022: any object type whose size is no greater than the size of the array being created. [ Note: Because allocation 
 9023: functions are assumed to return pointers to storage that is appropriately aligned for objects of any type with 
 9024: fundamental alignment, this constraint on array allocation overhead permits the common idiom of allocating 
 9025: character arrays into which objects of other types will later be placed. 〞end note ] 
 9026: ∫ 5.3.4 106 
 9027: 
 9028: c
 9029: . ISO/IEC N2800=08-0310 
 9030: 11 The new-placement syntax is used to supply additional arguments to an allocation function. If used, overload 
 9031: resolution is performed on a function call created by assembling an argument list consisting of the amount of 
 9032: space requested (the first argument) and the expressions in the new-placement part of the new-expression (the 
 9033: second and succeeding arguments). The first of these arguments has type std::size_t and the remaining 
 9034: arguments have the corresponding types of the expressions in the new-placement. 
 9035: 12 [ Example: 
 9036: 〞 new T results in a call of operator new(sizeof(T)), 
 9037: 〞 new(2,f) T results in a call of operator new(sizeof(T),2,f), 
 9038: 〞 new T[5] results in a call of operator new[](sizeof(T)*5+x), and 
 9039: 〞 new(2,f) T[5] results in a call of operator new[](sizeof(T)*5+y,2,f). 
 9040: Here, x and y are non-negative unspecified values representing array allocation overhead; the result of the 
 9041: new-expression will be offset by this amount from the value returned by operator new[]. This overhead 
 9042: may be applied in all array new-expressions, including those referencing the library function operator 
 9043: new[](std::size_t, void*) and other placement allocation functions. The amount of overhead may vary 
 9044: from one invocation of new to another. 〞end example ] 
 9045: 13 [ Note: unless an allocation function is declared with an empty exception-specification (15.4), throw(), it 
 9046: indicates failure to allocate storage by throwing a std::bad_alloc exception (Clause 15, 18.5.2.1); it returns 
 9047: a non-null pointer otherwise. If the allocation function is declared with an empty exception-specification, 
 9048: throw(), it returns null to indicate failure to allocate storage and a non-null pointer otherwise. 〞end note ] 
 9049: If the allocation function returns null, initialization shall not be done, the deallocation function shall not be 
 9050: called, and the value of the new-expression shall be null. 
 9051: 14 [ Note: when the allocation function returns a value other than null, it must be a pointer to a block of storage 
 9052: in which space for the object has been reserved. The block of storage is assumed to be appropriately aligned 
 9053: and of the requested size. The address of the created object will not necessarily be the same as that of the 
 9054: block if the object is an array. 〞end note ] 
 9055: 15 A new-expression that creates an object of type T initializes that object as follows: 
 9056: 〞 If the new-initializer is omitted, the object is default-initialized (8.5); if no initialization is performed, 
 9057: the object has inteterminate value. 
 9058: 〞 Otherwise, the new-initializer is interpreted according to the initialization rules of 8.5 for direct-
 9059: initialization. 
 9060: 16 If the new-expression creates an object or an array of objects of class type, access and ambiguity control 
 9061: are done for the allocation function, the deallocation function (12.5), and the constructor (12.1). If the 
 9062: new expression creates an array of objects of class type, access and ambiguity control are done for the 
 9063: destructor (12.4). 
 9064: 17 If any part of the object initialization described above72 terminates by throwing an exception and a suitable 
 9065: deallocation function can be found, the deallocation function is called to free the memory in which the object 
 9066: was being constructed, after which the exception continues to propagate in the context of the new-expression. 
 9067: If no unambiguous matching deallocation function can be found, propagating the exception does not cause 
 9068: the object＊s memory to be freed. [ Note: This is appropriate when the called allocation function does not 
 9069: allocate memory; otherwise, it is likely to result in a memory leak. 〞end note ] 
 9070: 18 If the new-expression begins with a unary :: operator, the deallocation function＊s name is looked up in the 
 9071: global scope. Otherwise, if the allocated type is a class type T or an array thereof, the deallocation function＊s 
 9072: 72) This may include evaluating a new-initializer and/or calling a constructor. 
 9073: ∫ 5.3.4 107 
 9074: 
 9075: c
 9076: . ISO/IEC N2800=08-0310 
 9077: name is looked up in the scope of T. If this lookup fails to find the name, or if the allocated type is not a 
 9078: class type or array thereof, the deallocation function＊s name is looked up in the global scope. 
 9079: 19 A declaration of a placement deallocation function matches the declaration of a placement allocation function 
 9080: if it has the same number of parameters and, after parameter transformations (8.3.5), all parameter types 
 9081: except the first are identical. Any non-placement deallocation function matches a non-placement allocation 
 9082: function. If the lookup finds a single matching deallocation function, that function will be called; otherwise, 
 9083: no deallocation function will be called. If the lookup finds the two-parameter form of a usual deallocation 
 9084: function (3.7.4.2) and that function, considered as a placement deallocation function, would have been 
 9085: selected as a match for the allocation function, the program is ill-formed. [ Example: 
 9086: struct S { 
 9087: // Placement allocation function: 
 9088: static void* operator new(std::size_t, std::size_t); 
 9089: // Usual (non-placement) deallocation function: 
 9090: static void operator delete(void*, std::size_t);
 9091: };
 9092: S* p = new (0) S; // ill-formed: non-placement deallocation function matches
 9093: // placement allocation function
 9094: 〞end example ] 
 9095: 20 If a new-expression calls a deallocation function, it passes the value returned from the allocation function 
 9096: call as the first argument of type void*. If a placement deallocation function is called, it is passed the same 
 9097: additional arguments as were passed to the placement allocation function, that is, the same arguments as 
 9098: those specified with the new-placement syntax. If the implementation is allowed to make a copy of any 
 9099: argument as part of the call to the allocation function, it is allowed to make a copy (of the same original 
 9100: value) as part of the call to the deallocation function or to reuse the copy made as part of the call to the 
 9101: allocation function. If the copy is elided in one place, it need not be elided in the other. 
 9102: 21 Whether the allocation function is called before evaluating the constructor arguments or after evaluating the 
 9103: constructor arguments but before entering the constructor is unspecified. It is also unspecified whether the 
 9104: arguments to a constructor are evaluated if the allocation function returns the null pointer or exits using an 
 9105: exception. 
 9106: 5.3.5 Delete [expr.delete] 
 9107: 1 The delete-expression operator destroys a most derived object (1.8) or array created by a new-expression. 
 9108: delete-expression:
 9109: ::opt delete cast-expression
 9110: ::opt delete [ ] cast-expression
 9111: The first alternative is for non-array objects, and the second is for arrays. Whenever the delete keyword 
 9112: is immediately followed by empty square brackets, it shall be interpreted as the second alternative.73 The 
 9113: operand shall have a pointer type, or a class type having a single non-explicit conversion function (12.3.2) 
 9114: to a pointer type. The result has type void. 
 9115: 2 If the operand has a class type, the operand is converted to a pointer type by calling the above-mentioned 
 9116: conversion function, and the converted operand is used in place of the original operand for the remainder of 
 9117: this section. In either alternative, the value of the operand of delete may be a null pointer value. If it is 
 9118: 73) A lambda expression with a lambda-introducer that consists of empty square brackets can follow the delete keyword if 
 9119: the lambda expression is enclosed in parentheses. 
 9120: ∫ 5.3.5 108 
 9121: 
 9122: c
 9123: . ISO/IEC N2800=08-0310 
 9124: not a null pointer value, in the first alternative (delete object), the value of the operand of delete shall be 
 9125: a pointer to a non-array object or a pointer to a subobject (1.8) representing a base class of such an object 
 9126: (Clause 10). If not, the behavior is undefined. In the second alternative (delete array), the value of the 
 9127: operand of delete shall be the pointer value which resulted from a previous array new-expression.74 If not, 
 9128: the behavior is undefined. [ Note: this means that the syntax of the delete-expression must match the type 
 9129: of the object allocated by new, not the syntax of the new-expression. 〞end note ][ Note: a pointer to a 
 9130: const type can be the operand of a delete-expression; it is not necessary to cast away the constness (5.2.11) 
 9131: of the pointer expression before it is used as the operand of the delete-expression. 〞end note ] 
 9132: 3 In the first alternative (delete object), if the static type of the object to be deleted is different from its 
 9133: dynamic type, the static type shall be a base class of the dynamic type of the object to be deleted and the 
 9134: static type shall have a virtual destructor or the behavior is undefined. In the second alternative (delete 
 9135: array) if the dynamic type of the object to be deleted differs from its static type, the behavior is undefined.75 
 9136: 4 The cast-expression in a delete-expression shall be evaluated exactly once. 
 9137: 5 If the object being deleted has incomplete class type at the point of deletion and the complete class has a 
 9138: non-trivial destructor or a deallocation function, the behavior is undefined. 
 9139: 6 If the value of the operand of the delete-expression is not a null pointer value, the delete-expression will 
 9140: invoke the destructor (if any) for the object or the elements of the array being deleted. In the case of an 
 9141: array, the elements will be destroyed in order of decreasing address (that is, in reverse order of the completion 
 9142: of their constructor; see 12.6.2). 
 9143: 7 If the value of the operand of the delete-expression is not a null pointer value, the delete-expression will 
 9144: call a deallocation function (3.7.4.2). Otherwise, it is unspecified whether the deallocation function will be 
 9145: called. [ Note: The deallocation function is called regardless of whether the destructor for the object or some 
 9146: element of the array throws an exception. 〞end note ] 
 9147: 8 [ Note: Animplementation provides default definitions of the global deallocation functions operator delete() 
 9148: for non-arrays (18.5.1.1) and operator delete[]() for arrays (18.5.1.2). A C++ program can provide al-
 9149: ternative definitions of these functions (17.6.4.6), and/or class-specific versions (12.5). 〞end note ] When 
 9150: the keyword delete in a delete-expression is preceded by the unary :: operator, the global deallocation 
 9151: function is used to deallocate the storage. 
 9152: 9 Access and ambiguity control are done for both the deallocation function and the destructor (12.4, 12.5). 
 9153: 5.3.6 Alignof [expr.alignof] 
 9154: 1 An alignof expression yields the alignment requirement of its operand type. The operand shall be a type-id 
 9155: representing a complete effective object type or a reference to a complete effective object type. 
 9156: 2 The result is an integral constant of type std::size_t. 
 9157: 3 When alignof is applied to a reference type, the result shall be the alignment of the referenced type. When 
 9158: alignof is applied to an array type, the result shall be the alignment of the element type. 
 9159: 5.4 Explicit type conversion (cast notation) [expr.cast] 
 9160: 1 The result of the expression (T) cast-expression is of type T. The result is an lvalue if T is an lvalue reference 
 9161: type, otherwise the result is an rvalue. [ Note: if T is a non-class type that is cv-qualified, the cv-qualifiers 
 9162: are ignored when determining the type of the resulting rvalue; see 3.10. 〞 end note ] 
 9163: 74) For non-zero-length arrays, this is the same as a pointer to the first element of the array created by that new-expression. 
 9164: Zero-length arrays do not have a first element. 
 9165: 75) This implies that an object cannot be deleted using a pointer of type void* because there are no objects of type void. 
 9166: ∫ 5.4 109 
 9167: 
 9168: c
 9169: . ISO/IEC N2800=08-0310 
 9170: 2 An explicit type conversion can be expressed using functional notation (5.2.3), a type conversion operator 
 9171: (dynamic_cast, static_cast, reinterpret_cast, const_cast), or the cast notation. 
 9172: cast-expression:
 9173: unary-expression
 9174: ( type-id ) cast-expression
 9175: 3 Any type conversion not mentioned below and not explicitly defined by the user (12.3) is ill-formed. 
 9176: 4 The conversions performed by 
 9177: 〞 a const_cast (5.2.11), 
 9178: 〞 a static_cast (5.2.9), 
 9179: 〞 a static_cast followed by a const_cast, 
 9180: 〞 a reinterpret_cast (5.2.10), or 
 9181: 〞 a reinterpret_cast followed by a const_cast, 
 9182: can be performed using the cast notation of explicit type conversion. The same semantic restrictions and be-
 9183: haviors apply, with the exception that in performing a static_cast in the following situations the conversion 
 9184: is valid even if the base class is inaccessible: 
 9185: 〞 a pointer to an object of derived class type or an lvalue or rvalue of derived class type may be explicitly 
 9186: converted to a pointer or reference to an unambiguous base class type, respectively; 
 9187: 〞 a pointer to member of derived class type may be explicitly converted to a pointer to member of an 
 9188: unambiguous non-virtual base class type; 
 9189: 〞 a pointer to an object of an unambiguous non-virtual base class type, an lvalue or rvalue of an unam-
 9190: biguous non-virtual base class type, or a pointer to member of an unambiguous non-virtual base class 
 9191: type may be explicitly converted to a pointer, a reference, or a pointer to member of a derived class 
 9192: type, respectively. 
 9193: If a conversion can be interpreted in more than one of the ways listed above, the interpretation that appears 
 9194: first in the list is used, even if a cast resulting from that interpretation is ill-formed. If a conversion can be 
 9195: interpreted in more than one way as a static_cast followed by a const_cast, the conversion is ill-formed. 
 9196: [ Example: 
 9197: struct A { };
 9198: struct I1 : A { };
 9199: struct I2 : A { };
 9200: struct D : I1, I2 { };
 9201: A *foo( D *p ) {
 9202: return (A*)( p ); // ill-formed static_cast interpretation
 9203: }
 9204: 〞end example ] 
 9205: 5 The operand of a cast using the cast notation can be an rvalue of type ※pointer to incomplete class type§. 
 9206: The destination type of a cast using the cast notation can be ※pointer to incomplete class type§. If both the 
 9207: operand and destination types are class types and one or both are incomplete, it is unspecified whether the 
 9208: static_cast or the reinterpret_cast interpretation is used, even if there is an inheritance relationship 
 9209: between the two classes. [ Note: For example, if the classes were defined later in the translation unit, a 
 9210: multi-pass compiler would be permitted to interpret a cast between pointers to the classes as if the class 
 9211: types were complete at the point of the cast. 〞end note ] 
 9212: ∫ 5.4 110 
 9213: 
 9214: c
 9215: . ISO/IEC N2800=08-0310 
 9216: 5.5 Pointer-to-member operators [expr.mptr.oper] 
 9217: 1 The pointer-to-member operators ->* and .* group left-to-right. 
 9218: pm-expression:
 9219: cast-expression
 9220: pm-expression .* cast-expression
 9221: pm-expression ->* cast-expression
 9222: 2 The binary operator .* binds its second operand, which shall be of type ※pointer to member of T§ (where T 
 9223: is a completely-defined effective class type) to its first operand, which shall be of class T or of a class of which 
 9224: T is an unambiguous and accessible base class. The result is an object or a function of the type specified by 
 9225: the second operand. 
 9226: 3 The binary operator ->* binds its second operand, which shall be of type ※pointer to member of T§ (where 
 9227: T is a completely-defined effective class type) to its first operand, which shall be of type ※pointer to T§ or 
 9228: ※pointer to a class of which T is an unambiguous and accessible base class.§ The result is an object or a 
 9229: function of the type specified by the second operand. 
 9230: 4 The first operand is called the object expression. If the dynamic type of the object expression does not 
 9231: contain the member to which the pointer refers, the behavior is undefined. 
 9232: 5 The restrictions on cv-qualification, and the manner in which the cv-qualifiers of the operands are combined 
 9233: to produce the cv-qualifiers of the result, are the same as the rules for E1.E2 given in 5.2.5. [ Note: it is not 
 9234: possible to use a pointer to member that refers to a mutable member to modify a const class object. For 
 9235: example, 
 9236: struct S {
 9237: S() : i(0) { }
 9238: mutable int i;
 9239: };
 9240: void f()
 9241: {
 9242: const S cs;
 9243: int S::* pm = &S::i; // pm refers to mutable member S::i
 9244: cs.*pm = 88; // ill-formed: cs is a const object
 9245: }
 9246: 〞end note ] 
 9247: 6 If the result of .* or ->* is a function, then that result can be used only as the operand for the function call 
 9248: operator ().[ Example: 
 9249: (ptr_to_obj->*ptr_to_mfct)(10); 
 9250: calls the member function denoted by ptr_to_mfct for the object pointed to by ptr_to_obj. 〞end 
 9251: example ] The result of a .* expression is an lvalue only if its first operand is an lvalue and its second 
 9252: operand is a pointer to data member. The result of an ->* expression is an lvalue only if its second operand 
 9253: is a pointer to data member. If the second operand is the null pointer to member value (4.11), the behavior 
 9254: is undefined. 
 9255: 5.6 Multiplicative operators [expr.mul] 
 9256: 1 The multiplicative operators *, /, and % group left-to-right. 
 9257: ∫ 5.6 111 
 9258: 
 9259: . ISO/IEC 
 9260: multiplicative-expression: 
 9261: pm-expression 
 9262: multiplicative-expression * pm-expression 
 9263: multiplicative-expression / pm-expression 
 9264: multiplicative-expression % pm-expression 
 9265: N2800=08-0310 
 9266: 2 The operands of * and / shall have arithmetic or enumeration type; the operands of % shall have integral or 
 9267: enumeration type. The usual arithmetic conversions are performed on the operands and determine the type 
 9268: of the result. 
 9269: 3 The binary * operator indicates multiplication. 
 9270: 4 The binary / operator yields the quotient, and the binary % operator yields the remainder from the division 
 9271: of the first expression by the second. If the second operand of / or % is zero the behavior is undefined. For 
 9272: integeral operands the / operator yields the algebraic quotient with any fractional part discarded;76 if the 
 9273: quotient a/b is representable in the type of the result, (a/b)*b + a%b is equal to a. 
 9274: 5.7 Additive operators [expr.add] 
 9275: 1 The additive operators + and -group left-to-right. The usual arithmetic conversions are performed for 
 9276: operands of arithmetic or enumeration type. 
 9277: additive-expression:
 9278: multiplicative-expression
 9279: additive-expression + multiplicative-expression
 9280: additive-expression -multiplicative-expression
 9281: For addition, either both operands shall have arithmetic or enumeration type, or one operand shall be a 
 9282: pointer to a completely-defined effective object type and the other shall have integral or enumeration type. 
 9283: 2 For subtraction, one of the following shall hold: 
 9284: 〞 both operands have arithmetic or enumeration type; or 
 9285: 〞 both operands are pointers to cv-qualified or cv-unqualified versions of the same completely-defined 
 9286: effective object type; or 
 9287: 〞 the left operand is a pointer to a completely-defined effective object type and the right operand has 
 9288: integral or enumeration type. 
 9289: 3 The result of the binary + operator is the sum of the operands. The result of the binary -operator is the 
 9290: difference resulting from the subtraction of the second operand from the first. 
 9291: 4 For the purposes of these operators, a pointer to a nonarray object behaves the same as a pointer to the 
 9292: first element of an array of length one with the type of the object as its element type. 
 9293: 5 When an expression that has integral type is added to or subtracted from a pointer, the result has the type 
 9294: of the pointer operand. If the pointer operand points to an element of an array object, and the array is 
 9295: large enough, the result points to an element offset from the original element such that the difference of 
 9296: the subscripts of the resulting and original array elements equals the integral expression. In other words, if 
 9297: the expression P points to the i-th element of an array object, the expressions (P)+N (equivalently, N+(P)) 
 9298: and (P)-N (where N has the value n) point to, respectively, the i + n-th and i . n-th elements of the array 
 9299: object, provided they exist. Moreover, if the expression P points to the last element of an array object, 
 9300: the expression (P)+1 points one past the last element of the array object, and if the expression Q points 
 9301: one past the last element of an array object, the expression (Q)-1 points to the last element of the array 
 9302: 76) This is often called truncation towards zero. 
 9303: ∫ 5.7 112 
 9304: 
 9305: c
 9306: . ISO/IEC N2800=08-0310 
 9307: object. If both the pointer operand and the result point to elements of the same array object, or one past 
 9308: the last element of the array object, the evaluation shall not produce an overflow; otherwise, the behavior is 
 9309: undefined. 
 9310: 6 When two pointers to elements of the same array object are subtracted, the result is the difference of the 
 9311: subscripts of the two array elements. The type of the result is an implementation-defined signed integral 
 9312: type; this type shall be the same type that is defined as std::ptrdiff_t in the <cstddef> header (18.1). As 
 9313: with any other arithmetic overflow, if the result does not fit in the space provided, the behavior is undefined. 
 9314: In other words, if the expressions P and Q point to, respectively, the i-th and j-th elements of an array object, 
 9315: the expression (P)-(Q) has the value i . j provided the value fits in an object of type std::ptrdiff_t. 
 9316: Moreover, if the expression P points either to an element of an array object or one past the last element of 
 9317: an array object, and the expression Q points to the last element of the same array object, the expression 
 9318: ((Q)+1)-(P) has the same value as ((Q)-(P))+1 and as -((P)-((Q)+1)), and has the value zero if the 
 9319: expression P points one past the last element of the array object, even though the expression (Q)+1 does not 
 9320: point to an element of the array object. Unless both pointers point to elements of the same array object, or 
 9321: one past the last element of the array object, the behavior is undefined.77 
 9322: 7 If the value 0 is added to or subtracted from a pointer value, the result compares equal to the original pointer 
 9323: value. If two pointers point to the same object or both point one past the end of the same array or both 
 9324: are null, and the two pointers are subtracted, the result compares equal to the value 0 converted to the type 
 9325: std::ptrdiff_t. 
 9326: 5.8 Shift operators [expr.shift] 
 9327: 1 The shift operators << and >> group left-to-right. 
 9328: shift-expression:
 9329: additive-expression
 9330: shift-expression << additive-expression
 9331: shift-expression >> additive-expression
 9332: The operands shall be of integral or enumeration type and integral promotions are performed. The type of 
 9333: the result is that of the promoted left operand. The behavior is undefined if the right operand is negative, 
 9334: or greater than or equal to the length in bits of the promoted left operand. 
 9335: 2 The value of E1 <<E2 is E1 (interpreted as a bit pattern) left-shifted E2 bit positions; vacated bits are 
 9336: zero-filled. If E1 has an unsigned type, the value of the result is E1 multiplied by the quantity 2 raised 
 9337: to the power E2, reduced modulo ULLONG_MAX+1 if E1 has type unsigned long long int, ULONG_MAX+1 if 
 9338: E1 has type unsigned long int, UINT_MAX+1 otherwise. [ Note: the constants ULLONG_MAX, ULONG_MAX, and 
 9339: UINT_MAX are defined in the header <climits>. 〞end note ] 
 9340: 3 The value of E1 >>E2 is E1 right-shifted E2 bit positions. If E1 has an unsigned type or if E1 has a signed 
 9341: type and a nonnegative value, the value of the result is the integral part of the quotient of E1 divided by 
 9342: 77) Another way to approach pointer arithmetic is first to convert the pointer(s) to character pointer(s): In this scheme the 
 9343: integral value of the expression added to or subtracted from the converted pointer is first multiplied by the size of the object 
 9344: originally pointed to, and the resulting pointer is converted back to the original type. For pointer subtraction, the result of the 
 9345: difference between the character pointers is similarly divided by the size of the object originally pointed to. 
 9346: When viewed in this way, an implementation need only provide one extra byte (which might overlap another object in the 
 9347: program) just after the end of the object in order to satisfy the ※one past the last element§ requirements. 
 9348: ∫ 5.8 113 
 9349: 
 9350: c
 9351: . ISO/IEC N2800=08-0310 
 9352: the quantity 2 raised to the power E2. If E1 has a signed type and a negative value, the resulting value is 
 9353: implementation-defined. 
 9354: 5.9 Relational operators [expr.rel] 
 9355: 1 The relational operators group left-to-right. [ Example: a<b<c means (a<b)<c and not (a<b)&&(b<c). 
 9356: 〞end example ] 
 9357: relational-expression:
 9358: shift-expression
 9359: relational-expression < shift-expression
 9360: relational-expression > shift-expression
 9361: relational-expression <= shift-expression
 9362: relational-expression >= shift-expression
 9363: The operands shall have arithmetic, enumeration, or pointer type, or type std::nullptr_t. The operators 
 9364: < (less than), > (greater than), <= (less than or equal to), and >= (greater than or equal to) all yield false 
 9365: or true. The type of the result is bool. 
 9366: 2 The usual arithmetic conversions are performed on operands of arithmetic or enumeration type. Pointer 
 9367: conversions (4.10) and qualification conversions (4.4) are performed on pointer operands (or on a pointer 
 9368: operand and a null pointer constant) to bring them to their composite pointer type. If one operand is a 
 9369: null pointer constant, the composite pointer type is the type of the other operand. Otherwise, if one of the 
 9370: operands has type ※pointer to cv1 void,§ then the other has type ※pointer to cv2 T § and the composite 
 9371: pointer type is ※pointer to cv12 void,§ where cv12 is the union of cv1 and cv2. Otherwise, the composite 
 9372: pointer type is a pointer type similar (4.4) to the type of one of the operands, with a cv-qualification 
 9373: signature (4.4) that is the union of the cv-qualification signatures of the operand types. [ Note: this implies 
 9374: that any pointer can be compared to a null pointer constant and that any object pointer can be compared 
 9375: to a pointer to (possibly cv-qualified) void. 〞end note ][ Example: 
 9376: void *p;
 9377: const int *q;
 9378: int **pi;
 9379: const int *const *pci;
 9380: void ct() {
 9381: p <= q; // Both converted to const void* before comparison
 9382: pi <= pci; // Both converted to const int *const * before comparison
 9383: }
 9384: 〞end example ] Pointers to objects or functions of the same type (after pointer conversions) can be com-
 9385: pared, with a result defined as follows: 
 9386: 〞 If two pointers p and q of the same type point to the same object or function, or both point one past 
 9387: the end of the same array, or are both null, then p<=q and p>=q both yield true and p<q and p>q 
 9388: both yield false. 
 9389: 〞 If two pointers p and q of the same type point to different objects that are not members of the same 
 9390: object or elements of the same array or to different functions, or if only one of them is null, the results 
 9391: of p<q, p>q, p<=q, and p>=q are unspecified. 
 9392: 〞 If two pointers point to non-static data members of the same object, or to subobjects or array elements 
 9393: of such members, recursively, the pointer to the later declared member compares greater provided the 
 9394: two members have the same access control (Clause 11) and provided their class is not a union. 
 9395: 〞 If two pointers point to non-static data members of the same object with different access control 
 9396: (Clause 11) the result is unspecified. 
 9397: ∫ 5.9 114 
 9398: 
 9399: c
 9400: . ISO/IEC N2800=08-0310 
 9401: 〞 If two pointers point to data members of the same union object, they compare equal (after conversion 
 9402: to void*, if necessary). If two pointers point to elements of the same array or one beyond the end of 
 9403: the array, the pointer to the object with the higher subscript compares higher. 
 9404: 〞 Other pointer comparisons are unspecified. 
 9405: 3 If two operands of type std::nullptr_t are compared, the result is true if the operator is <= or >=, and 
 9406: false otherwise. 
 9407: 4 If both operands (after conversions) are of arithmetic type, each of the operators shall yield true if the 
 9408: specified relationship is true and false if it is false. 
 9409: 5.10 Equality operators [expr.eq] 
 9410: equality-expression:
 9411: relational-expression
 9412: equality-expression == relational-expression
 9413: equality-expression != relational-expression
 9414: 1 The == (equal to) and the != (not equal to) operators have the same semantic restrictions, conversions, 
 9415: and result type as the relational operators except for their lower precedence and truth-value result. [ Note: 
 9416: a<b == c<d is true whenever a<b and c<d have the same truth-value. 〞 end note ] Pointers to objects or 
 9417: functions of the same type (after pointer conversions) can be compared for equality. Two pointers of the 
 9418: same type compare equal if and only if they are both null, both point to the same function, or both represent 
 9419: the same address (3.9.2). 
 9420: 2 In addition, pointers to members can be compared, or a pointer to member and a null pointer constant. 
 9421: Pointer to member conversions (4.11) and qualification conversions (4.4) are performed to bring them to a 
 9422: common type. If one operand is a null pointer constant, the common type is the type of the other operand. 
 9423: Otherwise, the common type is a pointer to member type similar (4.4) to the type of one of the operands, 
 9424: with a cv-qualification signature (4.4) that is the union of the cv-qualification signatures of the operand 
 9425: types. [ Note: this implies that any pointer to member can be compared to a null pointer constant. 〞end 
 9426: note ] If both operands are null, they compare equal. Otherwise if only one is null, they compare unequal. 
 9427: Otherwise if either is a pointer to a virtual member function, the result is unspecified. Otherwise they 
 9428: compare equal if and only if they would refer to the same member of the same most derived object (1.8) 
 9429: or the same subobject if they were dereferenced with a hypothetical object of the associated class type. 
 9430: [ Example: 
 9431: struct B { 
 9432: int f(); 
 9433: }; 
 9434: struct L : B { }; 
 9435: struct R : B { }; 
 9436: struct D : L, R { }; 
 9437: int (B::*pb)() = &B::f;
 9438: int (L::*pl)() = pb;
 9439: int (R::*pr)() = pb;
 9440: int (D::*pdl)() = pl;
 9441: int (D::*pdr)() = pr;
 9442: bool x = (pdl == pdr); // false
 9443: 〞end example ] 
 9444: ∫ 5.10 115 
 9445: 
 9446: c
 9447: . ISO/IEC N2800=08-0310 
 9448: 3 If two operands of type std::nullptr_t are compared, the result is true if the operator is ==, and false 
 9449: otherwise. 
 9450: 4 Each of the operators shall yield true if the specified relationship is true and false if it is false. 
 9451: 5.11 Bitwise AND operator [expr.bit.and] 
 9452: and-expression: 
 9453: equality-expression 
 9454: and-expression & equality-expression 
 9455: 1 The usual arithmetic conversions are performed; the result is the bitwise AND function of the operands. The 
 9456: operator applies only to integral or enumeration operands. 
 9457: 5.12 Bitwise exclusive OR operator [expr.xor] 
 9458: exclusive-or-expression: 
 9459: and-expression 
 9460: exclusive-or-expression . and-expression 
 9461: 1 The usual arithmetic conversions are performed; the result is the bitwise exclusive OR function of the 
 9462: operands. The operator applies only to integral or enumeration operands. 
 9463: 5.13 Bitwise inclusive OR operator 
 9464: inclusive-or-expression: 
 9465: exclusive-or-expression 
 9466: inclusive-or-expression | exclusive-or-expression 
 9467: The usual arithmetic conversions are performed; the result is the bitwise 
 9468: The operator applies only to integral or enumeration operands. 
 9469: 5.14 Logical AND operator 
 9470: logical-and-expression: 
 9471: inclusive-or-expression 
 9472: logical-and-expression && inclusive-or-expression 
 9473: [expr.or] 
 9474: inclusive OR function of its operands. 
 9475: [expr.log.and] 
 9476: 1 The && operator groups left-to-right. The operands are both contextually converted to type bool (Clause 4). 
 9477: The result is true if both operands are true and false otherwise. Unlike &, && guarantees left-to-right 
 9478: evaluation: the second operand is not evaluated if the first operand is false. 
 9479: 2 The result is a bool. If the second expression is evaluated, every value computation and side effect associated 
 9480: with the first expression is sequenced before every value computation and side effect associated with the 
 9481: second expression. 
 9482: 5.15 Logical OR operator [expr.log.or] 
 9483: logical-or-expression:
 9484: logical-and-expression
 9485: logical-or-expression || logical-and-expression
 9486: 1 The || operator groups left-to-right. The operands are both contextually converted to bool (Clause 4). It 
 9487: returns true if either of its operands is true, and false otherwise. Unlike , || guarantees left-to-right 
 9488: |
 9489: evaluation; moreover, the second operand is not evaluated if the first operand evaluates to true. 
 9490: ∫ 5.15 116 
 9491: 
 9492: c
 9493: . ISO/IEC N2800=08-0310 
 9494: 2 The result is a bool. All side effects of the first expression except for destruction of temporaries (12.2) 
 9495: happen before the second expression is evaluated. 
 9496: 5.16 Conditional operator [expr.cond] 
 9497: conditional-expression:
 9498: logical-or-expression
 9499: logical-or-expression ? expression : assignment-expression
 9500: 1 Conditional expressions group right-to-left. The first expression is contextually converted to bool (Clause4). 
 9501: It is evaluated and if it is true, the result of the conditional expression is the value of the second expression, 
 9502: otherwise that of the third expression. Only one of the second and third expressions is evaluated. Every value 
 9503: computation and side effect associated with the first expression is sequenced before every value computation 
 9504: and side effect associated with the second or third expression. 
 9505: 2 If either the second or the third operand has type (possibly cv-qualified) void, then the lvalue-to-rvalue (4.1), 
 9506: array-to-pointer (4.2), and function-to-pointer (4.3) standard conversions are performed on the second and 
 9507: third operands, and one of the following shall hold: 
 9508: 〞 The second or the third operand (but not both) is a throw-expression (15.1); the result is of the type 
 9509: of the other and is an rvalue. 
 9510: 〞 Both the second and the third operands have type void; the result is of type void and is an rvalue. 
 9511: [ Note: this includes the case where both operands are throw-expressions. 〞end note ] 
 9512: 3 Otherwise, if the second and third operand have different types, and either has (possibly cv-qualified) class 
 9513: type, an attempt is made to convert each of those operands to the type of the other. The process for 
 9514: determining whether an operand expression E1 of type T1 can be converted to match an operand expression 
 9515: E2 of type T2 is defined as follows: 
 9516: 〞 If E2 is an lvalue: E1 can be converted to match E2 if E1 can be implicitly converted (Clause 4) to the 
 9517: type ※lvalue reference to T2§, subject to the constraint that in the conversion the reference must bind 
 9518: directly (8.5.3) to E1. 
 9519: 〞 If E2 is an rvalue, or if the conversion above cannot be done: 
 9520: 〞 if E1 and E2 have class type, and the underlying class types are the same or one is a base class 
 9521: of the other: E1 can be converted to match E2 if the class of T2 is the same type as, or a base 
 9522: class of, the class of T1, and the cv-qualification of T2 is the same cv-qualification as, or a greater 
 9523: cv-qualification than, the cv-qualification of T1. If the conversion is applied, E1 is changed to an 
 9524: rvalue of type T2 by copy-initializing a temporary of type T2 from E1 and using that temporary 
 9525: as the converted operand. 
 9526: 〞 Otherwise (i.e., if E1 or E2 has a nonclass type, or if they both have class types but the underlying 
 9527: classes are not either the same or one a base class of the other): E1 can be converted to match E2 
 9528: if E1 can be implicitly converted to the type that expression E2 would have if E2 were converted 
 9529: to an rvalue (or the type it has, if E2 is an rvalue). 
 9530: Using this process, it is determined whether the second operand can be converted to match the third 
 9531: operand, and whether the third operand can be converted to match the second operand. If both can 
 9532: be converted, or one can be converted but the conversion is ambiguous, the program is ill-formed. 
 9533: If neither can be converted, the operands are left unchanged and further checking is performed as 
 9534: described below. If exactly one conversion is possible, that conversion is applied to the chosen operand 
 9535: and the converted operand is used in place of the original operand for the remainder of this section. 
 9536: 4 If the second and third operands are lvalues and have the same type, the result is of that type and is an 
 9537: lvalue and it is a bit-field if the second or the third operand is a bit-field, or if both are bit-fields. 
 9538: ∫ 5.16 117 
 9539: 
 9540: c
 9541: . ISO/IEC N2800=08-0310 
 9542: 5 Otherwise, the result is an rvalue. If the second and third operands do not have the same type, and either 
 9543: has (possibly cv-qualified) class type, overload resolution is used to determine the conversions (if any) to be 
 9544: applied to the operands (13.3.1.2, 13.6). If the overload resolution fails, the program is ill-formed. Otherwise, 
 9545: the conversions thus determined are applied, and the converted operands are used in place of the original 
 9546: operands for the remainder of this section. 
 9547: 6 Lvalue-to-rvalue (4.1), array-to-pointer (4.2), and function-to-pointer (4.3) standard conversions are per-
 9548: formed on the second and third operands. After those conversions, one of the following shall hold: 
 9549: 〞 The second and third operands have the same type; the result is of that type. If the operands have 
 9550: class type, the result is an rvalue temporary of the result type, which is copy-initialized from either 
 9551: the second operand or the third operand depending on the value of the first operand. 
 9552: 〞 The second and third operands have arithmetic or enumeration type; the usual arithmetic conversions 
 9553: are performed to bring them to a common type, and the result is of that type. 
 9554: 〞 The second and third operands have pointer type, or one has pointer type and the other is a null 
 9555: pointer constant; pointer conversions (4.10) and qualification conversions (4.4) are performed to bring 
 9556: them to their composite pointer type (5.9). The result is of the composite pointer type. 
 9557: 〞 The second and third operands have pointer to member type, or one has pointer to member type and the 
 9558: other is a null pointer constant; pointer to member conversions (4.11) and qualification conversions (4.4) 
 9559: are performed to bring them to a common type, whose cv-qualification shall match the cv-qualification 
 9560: of either the second or the third operand. The result is of the common type. 
 9561: 5.17 Assignment and compound assignment operators [expr.ass] 
 9562: 1 The assignment operator (=) and the compound assignment operators all group right-to-left. All require a 
 9563: modifiable lvalue as their left operand and return an lvalue referring to the left operand. The result in all 
 9564: cases is a bit-field if the left operand is a bit-field. In all cases, the assignment is sequenced after the value 
 9565: computation of the right and left operands, and before the value computation of the assignment expression. 
 9566: With respect to an indeterminately-sequenced function call, the operation of a compound assignment is 
 9567: a single evaluation. [ Note: Therefore, a function call shall not intervene between the lvalue-to-rvalue 
 9568: conversion and the side effect associated with any single compound assignment operator. 〞end note ] 
 9569: assignment-expression:
 9570: conditional-expression
 9571: logical-or-expression assignment-operator initializer-clause
 9572: throw-expression
 9573: assignment-operator: one of 
 9574: = *= /= %= += -= >>= <<= &= .= |= 
 9575: 2 In simple assignment (=), the value of the expression replaces that of the object referred to by the left 
 9576: operand. 
 9577: 3 If the left operand is not of class type, the expression is implicitly converted (Clause 4) to the cv-unqualified 
 9578: type of the left operand. 
 9579: 4 If the left operand is of class type, the class shall be complete. Assignment to objects of a class is defined 
 9580: by the copy assignment operator (12.8, 13.5.3). 
 9581: 5 [ Note: For class objects, assignment is not in general the same as initialization (8.5, 12.1, 12.6, 12.8). 〞end 
 9582: note ] 
 9583: 6 When the left operand of an assignment operator denotes a reference to T, the operation assigns to the 
 9584: object of type T denoted by the reference. 
 9585: ∫ 5.17 118 
 9586: 
 9587: c
 9588: . ISO/IEC N2800=08-0310 
 9589: 7 The behavior of an expression of the form E1 op = E2 is equivalent to E1 = E1 op E2 except that E1 is 
 9590: evaluated only once. In += and -=, E1 shall either have arithmetic type or be a pointer to a possibly 
 9591: cv-qualified completely-defined effective object type. In all other cases, E1 shall have arithmetic type. 
 9592: 8 If the value being stored in an object is accessed from another object that overlaps in any way the storage 
 9593: of the first object, then the overlap shall be exact and the two objects shall have the same type, otherwise 
 9594: the behavior is undefined. 
 9595: 9 A braced-init-list may appear on the right-hand side of 
 9596: 〞 an assignment to a scalar, in which case the initializer list shall have at most a single element. The 
 9597: meaning of x={v}, where T is the scalar type of the expression x, is that of x=T(v) except that no 
 9598: narrowing conversion (8.5.4) is allowed. The meaning of x={} is x=T(). 
 9599: 〞 an assignment defined by a user-defined assignment operator, in which case the initializer list is passed 
 9600: as the argument to the operator function. 
 9601: [ Example: 
 9602: complex<double> z; 
 9603: z = { 1,2 }; 
 9604: z += { 1, 2 }; 
 9605: a = b = { 1 }; 
 9606: a = { 1 } = b; 
 9607: 〞end example ] 
 9608: // meaning z.operator=(1,2)
 9609: // meaning z.operator+=(1,2)
 9610: // meaning a=b=1;
 9611: // syntax error
 9612: 5.18 Comma operator [expr.comma] 
 9613: 1 The comma operator groups left-to-right. 
 9614: expression:
 9615: assignment-expression
 9616: expression , assignment-expression
 9617: A pair of expressions separated by a comma is evaluated left-to-right and the value of the left expression is 
 9618: discarded. The lvalue-to-rvalue (4.1), array-to-pointer (4.2), and function-to-pointer (4.3) standard conver-
 9619: sions are not applied to the left expression. Every value computation and side effect associated with the left 
 9620: expression is sequenced before every value computation and side effect associated with the right expression. 
 9621: The type and value of the result are the type and value of the right operand; the result is an lvalue if its 
 9622: right operand is an lvalue, and is a bit-field if its right operand is an lvalue and a bit-field. 
 9623: 2 In contexts where comma is given a special meaning, [ Example: in lists of arguments to functions (5.2.2) 
 9624: and lists of initializers (8.5) 〞end example ] the comma operator as described in Clause 5 can appear only 
 9625: in parentheses. [ Example: 
 9626: f(a, (t=3, t+2), c); 
 9627: has three arguments, the second of which has the value 5. 〞end example ] 
 9628: 5.19 Constant expressions [expr.const] 
 9629: 1 Certain contexts require expressions that satisfy additional requirements as detailed in this sub-clause. Such 
 9630: expressions are called constant expressions.[ Note: Those expressions can be evaluated during translation. 〞 
 9631: end note ] 
 9632: constant-expression:
 9633: conditional-expression
 9634: ∫ 5.19 119 
 9635: 
 9636: c
 9637: . ISO/IEC N2800=08-0310 
 9638: 2 A conditional-expression is a constant expression unless it involves one of the following as a potentially evalu-
 9639: ated subexpression (3.2), but subexpressions of logical AND (5.14), logical OR (5.15), and conditional (5.16) 
 9640: operations that are not evaluated are not considered[ Note: an overloaded operator invokes a function. 〞end 
 9641: note ]: 
 9642: 〞 this (5.1) unless it appears as the postfix-expression in a class member access expression, including 
 9643: the result of the implicit transformation in the body of a non-static member function (9.3.1); 
 9644: 〞 an invocation of a function other than a constexpr function or a constexpr constructor [ Note: overload 
 9645: resolution (13.3) is applied as usual 〞end note ]; 
 9646: 〞 a lambda-expression (5.1.1); 
 9647: 〞 an lvalue-to-rvalue conversion (4.1) unless it is applied to 
 9648: 〞 an lvalue of effective integral type that refers to a non-volatile const variable or static data member 
 9649: initialized with constant expressions, or 
 9650: 〞 an lvalue of effective literal type that refers to a non-volatile object defined with constexpr, or 
 9651: that refers to a sub-object of such an object; 
 9652: 〞 an array-to-pointer conversion (4.2) that is applied to an lvalue that designates an object with thread 
 9653: or automatic storage duration; 
 9654: 〞 a unary operator & (5.3.1) that is applied to an lvalue that designates an object with thread or automatic 
 9655: storage duration; 
 9656: 〞 an id-expression that refers to a variable or data member of reference type; 
 9657: 〞 a type conversion from a floating-point type to an integral type (4.9) unless the conversion is directly 
 9658: applied to a floating-point literal; 
 9659: 〞 a dynamic cast (5.2.7); 
 9660: 〞 a type conversion from a pointer or pointer-to-member type to a literal type [ Note: a user-defined 
 9661: conversion invokes a function 〞end note ]; 
 9662: 〞 a pseudo-destructor call (5.2.4); 
 9663: 〞 a class member access (5.2.5) unless its postfix-expression is of effective literal type or of pointer to 
 9664: effective literal type; 
 9665: 〞 increment or decrement operations (5.2.6, 5.3.2); 
 9666: 〞 a typeid expression (5.2.8) whose operand is of a polymorphic class type; 
 9667: 〞 a new-expression (5.3.4); 
 9668: 〞 a delete-expression (5.3.5); 
 9669: 〞 a subtraction (5.7) where both operands are pointers; 
 9670: 〞 a relational (5.9) or equality (5.10) operator where at least one of the operands is a pointer; 
 9671: 〞 an assignment or a compound assignment (5.17); or 
 9672: 〞 a throw-expression (15.1). 
 9673: 3 A constant expression is an integral constant expression if it is of integral or enumeration type or if it 
 9674: is an archetype that has the concept requirement std::IntegralConstantExpressionType<T> (14.9.4). 
 9675: ∫ 5.19 120 
 9676: 
 9677: c
 9678: . ISO/IEC N2800=08-0310 
 9679: [ Note: such expressions may be used as array bounds (8.3.4, 5.3.4), as case expressions (6.4.2), as bit-
 9680: field lengths (9.6), as enumerator initializers (7.2), as static member initializers (9.4.2), and as integral or 
 9681: enumeration non-type template arguments (14.3). 〞end note ] 
 9682: 4 If an expression of effective literal class type is used in a context where an integral constant expression is re-
 9683: quired, then that class type shall have a single non-explicit conversion function to an integral or enumeration 
 9684: type and that conversion function shall be constexpr. [ Example: 
 9685: struct A {
 9686: constexpr A(int i) : val(i) { }
 9687: constexpr operator int() { return val; }
 9688: constexpr operator long() { return 43; }
 9689: private: 
 9690: int val;
 9691: };
 9692: template<int> struct X { };
 9693: constexpr A a = 42;
 9694: X<a> x; // OK: unique conversion to int
 9695: int ary[a]; // error: ambiguous conversion
 9696: 〞end example ] 
 9697: 5 An expression is a potential constant expression if it is a constant expression when all occurrences of function 
 9698: parameters are replaced by arbitrary constant expressions of the appropriate type. 
 9699: ∫ 5.19 121 
 9700: 
 9701: c
 9702: . ISO/IEC N2800=08-0310 
 9703: 6 Statements [stmt.stmt]
 9704: 1 Except as indicated, statements are executed in sequence. 
 9705: statement:
 9706: labeled-statement
 9707: attribute-specifieropt expression-statement
 9708: attribute-specifieropt compound-statement
 9709: attribute-specifieropt selection-statement
 9710: attribute-specifieropt iteration-statement
 9711: attribute-specifieropt jump-statement
 9712: declaration-statement
 9713: attribute-specifieropt try-block
 9714: late-checked-block
 9715: The optional attribute-specifier appertains to the respective statement. 
 9716: 6.1 Labeled statement [stmt.label] 
 9717: 1 A statement can be labeled. 
 9718: labeled-statement:
 9719: attribute-specifieropt identifier : statement
 9720: attribute-specifieropt case constant-expression : statement
 9721: attribute-specifieropt default : statement
 9722: The optional attribute-specifier appertains to the label. An identifier label declares the identifier. The only 
 9723: use of an identifier label is as the target of a goto. The scope of a label is the function in which it appears. 
 9724: Labels shall not be redeclared within a function. A label can be used in a goto statement before its definition. 
 9725: Labels have their own name space and do not interfere with other identifiers. 
 9726: 2 Case labels and default labels shall occur only in switch statements. 
 9727: 6.2 Expression statement [stmt.expr] 
 9728: 1 Expression statements have the form 
 9729: expression-statement:
 9730: expressionopt ;
 9731: The expression is evaluated and its value is discarded. The lvalue-to-rvalue (4.1), array-to-pointer (4.2), and 
 9732: function-to-pointer (4.3) standard conversions are not applied to the expression. All side effects from an 
 9733: expression statement are completed before the next statement is executed. An expression statement with the 
 9734: expression missing is called a null statement. [ Note: Most statements are expression statements 〞 usually 
 9735: assignments or function calls. A null statement is useful to carry a label just before the } of a compound 
 9736: statement and to supply a null body to an iteration statement such as a while statement (6.5.1). 〞end 
 9737: note ] 
 9738: 6.3 Compound statement or block [stmt.block] 
 9739: 1 So that several statements can be used where one is expected, the compound statement (also, and equiva-
 9740: lently, called ※block§) is provided. 
 9741: compound-statement:
 9742: { statement-seqopt }
 9743: ∫ 6.3 122 
 9744: 
 9745: c
 9746: . ISO/IEC N2800=08-0310 
 9747: statement-seq:
 9748: statement
 9749: statement-seq statement
 9750: A compound statement defines a local scope (3.3). [ Note: a declaration is a statement (6.7). 〞end note ] 
 9751: 6.4 Selection statements [stmt.select] 
 9752: 1 Selection statements choose one of several flows of control. 
 9753: selection-statement:
 9754: if ( condition ) statement
 9755: if ( condition ) statement else statement
 9756: switch ( condition ) statement
 9757: condition:
 9758: expression
 9759: type-specifier-seq attribute-specifieropt declarator = initializer-clause
 9760: type-specifier-seq attribute-specifieropt declarator braced-init-list
 9761: See 8.3 for the optional attribute-specifier in a condition. In Clause 6, the term substatement refers to the 
 9762: contained statement or statements that appear in the syntax notation. The substatement in a selection-
 9763: statement (each substatement, in the else form of the if statement) implicitly defines a local scope (3.3). 
 9764: If the substatement in a selection-statement is a single statement and not a compound-statement, itis as if 
 9765: it was rewritten to be a compound-statement containing the original substatement. [ Example: 
 9766: if (x)
 9767: int i;
 9768: can be equivalently rewritten as 
 9769: if (x) {
 9770: int i;
 9771: }
 9772: Thus after the if statement, i is no longer in scope. 〞end example ] 
 9773: 2 The rules for conditions apply both to selection-statements and to the for and while statements (6.5). The 
 9774: declarator shall not specify a function or an array. If the auto type-specifier appears in the type-specifier-seq, 
 9775: the type of the identifier being declared is deduced from the initializer as described in 7.1.6.4. 
 9776: 3 A name introduced by a declaration in a condition (either introduced by the type-specifier-seq or the declara-
 9777: tor of the condition) is in scope from its point of declaration until the end of the substatements controlled 
 9778: by the condition. If the name is re-declared in the outermost block of a substatement controlled by the 
 9779: condition, the declaration that re-declares the name is ill-formed. [ Example: 
 9780: if (int x = f()) { 
 9781: int x; // ill-formed, redeclaration of x
 9782: }
 9783: else {
 9784: int x; // ill-formed, redeclaration of x
 9785: }
 9786: 〞end example ] 
 9787: 4 The value of a condition that is an initialized declaration in a statement other than a switch statement is the 
 9788: value of the declared variable contextually converted to bool (Clause 4). If that conversion is ill-formed, the 
 9789: program is ill-formed. The value of a condition that is an initialized declaration in a switch statement is the 
 9790: value of the declared variable if it has integral or enumeration type, or of that variable implicitly converted 
 9791: ∫ 6.4 123 
 9792: 
 9793: c
 9794: . ISO/IEC N2800=08-0310 
 9795: to integral or enumeration type otherwise. The value of a condition that is an expression is the value of the 
 9796: expression, contextually converted to bool for statements other than switch; if that conversion is ill-formed, 
 9797: the program is ill-formed. The value of the condition will be referred to as simply ※the condition§ where the 
 9798: usage is unambiguous. 
 9799: 5 If a condition can be syntactically resolved as either an expression or the declaration of a local name, it is 
 9800: interpreted as a declaration. 
 9801: 6.4.1 The if statement [stmt.if] 
 9802: 1 If the condition (6.4) yields true the first substatement is executed. If the else part of the selection 
 9803: statement is present and the condition yields false, the second substatement is executed. In the second 
 9804: form of if statement (the one including else), if the first substatement is also an if statement then that 
 9805: inner if statement shall contain an else part.78 
 9806: 6.4.2 The switch statement [stmt.switch] 
 9807: 1 The switch statement causes control to be transferred to one of several statements depending on the value 
 9808: of a condition. 
 9809: 2 The condition shall be of integral type, enumeration type, or of a class type for which a single non-explicit 
 9810: conversion function to integral or enumeration type exists (12.3). If the condition is of class type, the 
 9811: condition is converted by calling that conversion function, and the result of the conversion is used in place of 
 9812: the original condition for the remainder of this section. Integral promotions are performed. Any statement 
 9813: within the switch statement can be labeled with one or more case labels as follows: 
 9814: case constant-expression : 
 9815: where the constant-expression shall be an integral constant expression (5.19). The integral constant expres-
 9816: sion is implicitly converted to the promoted type of the switch condition. No two of the case constants in 
 9817: the same switch shall have the same value after conversion to the promoted type of the switch condition. 
 9818: 3 There shall be at most one label of the form 
 9819: default : 
 9820: within a switch statement. 
 9821: 4 Switch statements can be nested; a case or default label is associated with the smallest switch enclosing 
 9822: it. 
 9823: 5 When the switch statement is executed, its condition is evaluated and compared with each case constant. If 
 9824: one of the case constants is equal to the value of the condition, control is passed to the statement following 
 9825: the matched case label. If no case constant matches the condition, and if there is a default label, control 
 9826: passes to the statement labeled by the default label. If no case matches and if there is no default then 
 9827: none of the statements in the switch is executed. 
 9828: 6 case and default labels in themselves do not alter the flow of control, which continues unimpeded across 
 9829: such labels. To exit from a switch, see break, 6.6.1. [ Note: usually, the substatement that is the subject 
 9830: of a switch is compound and case and default labels appear on the top-level statements contained within 
 9831: the (compound) substatement, but this is not required. Declarations can appear in the substatement of a 
 9832: switch-statement. 〞end note ] 
 9833: 6.5 Iteration statements [stmt.iter] 
 9834: 1 Iteration statements specify looping. 
 9835: 78) In other words, the else is associated with the nearest un-elsed if. 
 9836: ∫ 6.5 124 
 9837: 
 9838: c
 9839: . ISO/IEC N2800=08-0310 
 9840: iteration-statement:
 9841: while ( condition ) statement
 9842: do statement while ( expression ) ;
 9843: for ( for-init-statement conditionopt ; expressionopt ) statement
 9844: for ( for-range-declaration : expression ) statement
 9845: for-init-statement:
 9846: expression-statement
 9847: simple-declaration
 9848: for-range-declaration:
 9849: type-specifier-seq attribute-specifieropt declarator
 9850: [ Note: a for-init-statement ends with a semicolon. 〞end note ] 
 9851: 2 The substatement in an iteration-statement implicitly defines a local scope (3.3) which is entered and exited 
 9852: each time through the loop. 
 9853: If the substatement in an iteration-statement is a single statement and not a compound-statement, it is as if 
 9854: it was rewritten to be a compound-statement containing the original statement. [ Example: 
 9855: while (--x >= 0)
 9856: int i;
 9857: can be equivalently rewritten as 
 9858: while (--x >= 0) {
 9859: int i;
 9860: }
 9861: 3 Thus after the while statement, i is no longer in scope. 〞 end example ]
 9862: 4 [ Note: The requirements on conditions in iteration statements are described in 6.4. 〞 end note ]
 9863: 5 A loop that, outside of the for-init-statement in the case of a for statement,
 9864: 〞 performs no I/O operations, and 
 9865: 〞 does not access or modify volatile objects, and 
 9866: 〞 performs no synchronization or atomic operations 
 9867: may be assumed by the implementation to terminate. [ Note: This is intended to allow compiler transfor-
 9868: mations, such as removal of empty loops, even when termination cannot be proven. 〞 end note ] 
 9869: 6.5.1 The while statement [stmt.while] 
 9870: 1 In the while statement the substatement is executed repeatedly until the value of the condition (6.4) becomes 
 9871: false. The test takes place before each execution of the substatement. 
 9872: 2 When the condition of a while statement is a declaration, the scope of the variable that is declared extends 
 9873: from its point of declaration (3.3.1) to the end of the while statement. A while statement of the form 
 9874: while (T t = x) statement 
 9875: is equivalent to 
 9876: label: 
 9877: { // start of condition scope
 9878: T t = x;
 9879: if (t) {
 9880: ∫ 6.5.1 125 
 9881: 
 9882: . ISO/IEC N2800=08-0310 
 9883: statement 
 9884: goto label;
 9885: }
 9886: } // end of condition scope
 9887: The object created in a condition is destroyed and created with each iteration of the loop. [ Example: 
 9888: struct A { 
 9889: int val; 
 9890: A(int i) : val(i) { } 
 9891: ~A() { } 
 9892: operator bool() { return val != 0; } 
 9893: };
 9894: int i = 1;
 9895: while (A a = i) {
 9896: // ... 
 9897: i = 0; 
 9898: } 
 9899: In the while-loop, the constructor and destructor are each called twice, once for the condition that succeeds 
 9900: and once for the condition that fails. 〞end example ] 
 9901: 6.5.2 The do statement [stmt.do] 
 9902: 1 The expression is contextually converted to bool (Clause 4); if that conversion is ill-formed, the program is 
 9903: ill-formed. 
 9904: 2 In the do statement the substatement is executed repeatedly until the value of the expression becomes false. 
 9905: The test takes place after each execution of the statement. 
 9906: 6.5.3 The for statement 
 9907: The for statement 
 9908: for ( for-init-statement conditionopt 
 9909: is equivalent to 
 9910: { 
 9911: for-init-statement 
 9912: while ( condition ) { 
 9913: statement 
 9914: expression ; 
 9915: }
 9916: }
 9917: [stmt.for] 
 9918: ; expressionopt ) statement 
 9919: except that names declared in the for-init-statement are in the same declarative-region as those declared in 
 9920: the condition, and except that a continue in statement (not enclosed in another iteration statement) will 
 9921: execute expression before re-evaluating condition.[ Note: Thus the first statement specifies initialization for 
 9922: the loop; the condition (6.4) specifies a test, made before each iteration, such that the loop is exited when 
 9923: the condition becomes false; the expression often specifies incrementing that is done after each iteration. 
 9924: 〞end note ] 
 9925: 2 Either or both of the condition and the expression can be omitted. A missing condition makes the implied 
 9926: while Clause equivalent to while(true). 
 9927: 3 If the for-init-statement is a declaration, the scope of the name(s) declared extends to the end of the for-
 9928: statement.[ Example: 
 9929: ∫ 6.5.3 126 
 9930: 
 9931: c
 9932: . ISO/IEC N2800=08-0310 
 9933: int i = 42;
 9934: int a[10];
 9935: for (int i = 0; i < 10; i++)
 9936: a[i] = i;
 9937: int j = i; // j = 42 
 9938: 〞end example ] 
 9939: 6.5.4 The range-based for statement [stmt.ranged] 
 9940: 1 The range-base for statement 
 9941: for ( for-range-declaration : expression ) statement 
 9942: is equivalent to 
 9943: { 
 9944: auto && __range = ( expression ); 
 9945: for ( auto __begin = std::Range<_RangeT>::begin(__range), 
 9946: __end = std::Range<_RangeT>::end(__range); 
 9947: __begin != __end; 
 9948: ++__begin ) { 
 9949: for-range-declaration = *__begin; 
 9950: statement 
 9951: }
 9952: }
 9953: where __range, __begin, and __end are variables defined for exposition only, and _RangeT is the type of 
 9954: the expression. 
 9955: [ Example: 
 9956: int array[5] = { 1, 2, 3, 4, 5 };
 9957: for (int& x : array)
 9958: x *= 2; 
 9959: 〞end example ] 
 9960: 2 If the header <iterator_concepts> (24.1) is not included prior to a use of the range-based for statement, 
 9961: the program is ill-formed. 
 9962: 6.6 Jump statements 
 9963: 1 Jump statements unconditionally transfer control. 
 9964: jump-statement: 
 9965: break ;
 9966: continue ;
 9967: return expressionopt ;
 9968: return braced-init-list ;
 9969: goto identifier ;
 9970: [stmt.jump]
 9971: 2 On exit from a scope (however accomplished), variables with automatic storage duration (3.7.3) that have 
 9972: been constructed in that scope are destroyed in the reverse order of their construction. [ Note: For tem-
 9973: poraries, see 12.2. 〞end note ] Transfer out of a loop, out of a block, or back past an initialized variable 
 9974: with automatic storage duration involves the destruction of variables with automatic storage duration that 
 9975: ∫ 6.6 127 
 9976: 
 9977: c
 9978: . ISO/IEC N2800=08-0310 
 9979: are in scope at the point transferred from but not at the point transferred to. (See 6.7 for transfers into 
 9980: blocks). [ Note: However, the program can be terminated (by calling std::exit() or std::abort() (18.4), 
 9981: for example) without destroying class objects with automatic storage duration. 〞end note ] 
 9982: 6.6.1 The break statement [stmt.break] 
 9983: 1 The break statement shall occur onlyin an iteration-statement or a switch statement and causes termination 
 9984: of the smallest enclosing iteration-statement or switch statement; control passes to the statement following 
 9985: the terminated statement, if any. 
 9986: 6.6.2 The continue statement [stmt.cont] 
 9987: 1 The continue statement shall occur only in an iteration-statement and causes control to pass to the loop-
 9988: continuation portion of the smallest enclosing iteration-statement, that is, to the end of the loop. More 
 9989: precisely, in each of the statements 
 9990: while (foo) { do { for (;;) { 
 9991: { { { 
 9992: // ... // ... // ... 
 9993: } } } 
 9994: contin: ; contin: ; contin: ; 
 9995: } } while (foo); } 
 9996: a continue not contained in an enclosed iteration statement is equivalent to goto contin. 
 9997: 6.6.3 The return statement [stmt.return] 
 9998: 1 A function returns to its caller by the return statement. 
 9999: 2 A return statement without an expression can be used only in functions that do not return a value, that is, 
10000: a function with the return type void, a constructor (12.1), or a destructor (12.4). A return statement with 
10001: an expression of non-void type can be used only in functions returning a value; the value of the expression 
10002: is returned to the caller of the function. The expression is implicitly converted to the return type of the 
10003: function in which it appears. A return statement can involve the construction and copy of a temporary 
10004: object (12.2). [ Note: A copy operation associated with a return statement may be elided or considered as 
10005: an rvalue for the purpose of overload resolution in selecting a constructor (12.8). 〞end note ] A return 
10006: statement with a braced-init-list initializes the object or reference to be returned from the function by 
10007: copy-list-initialization (8.5.4) from the specified initializer list. [ Example: 
10008: std::pair<std::string,int> f(const char* p, int x) {
10009: return {p,x};
10010: } 
10011: 〞end example ] 
10012: Flowing off the end of a function is equivalent to a return with no value; this results in undefined behavior 
10013: in a value-returning function. 
10014: 3 A return statement with an expression of type ※cv void§ can be used only in functions with a return type 
10015: of cv void; the expression is evaluated just before the function returns to its caller. 
10016: 6.6.4 The goto statement [stmt.goto] 
10017: 1 The goto statement unconditionally transfers control to the statement labeled by the identifier. The identifier 
10018: ∫ 6.6.4 128 
10019: 
10020: c
10021: . ISO/IEC N2800=08-0310 
10022: shall be a label (6.1) located in the current function. 
10023: 6.7 Declaration statement [stmt.dcl] 
10024: 1 A declaration statement introduces one or more new identifiers into a block; it has the form 
10025: declaration-statement:
10026: block-declaration
10027: If an identifier introduced by a declaration was previously declared in an outer block, the outer declaration 
10028: is hidden for the remainder of the block, after which it resumes its force. 
10029: 2 Variables with automatic storage duration (3.7.3) are initialized each time their declaration-statement is 
10030: executed. Variables with automatic storage duration declared in the block are destroyed on exit from the 
10031: block (6.6). 
10032: 3 It is possible to transfer into a block, but not in a way that bypasses declarations with initialization. A 
10033: program that jumps79 from a point where a local variable with automatic storage duration is not in scope to 
10034: a point where it is in scope is ill-formed unless the variable has scalar type, class type with a trivial default 
10035: constructor and a trivial destructor, a cv-qualified version of one of these types, or an array of one of the 
10036: preceding types and is declared without an initializer (8.5). [ Example: 
10037: void f() { 
10038: // ...
10039: goto lx; // ill-formed: jump into scope of a
10040: // ...
10041: ly:
10042: X a = 1;
10043: // ... 
10044: lx: 
10045: goto ly; // OK, jump implies destructor
10046: // call for a followed by construction
10047: // again immediately following label ly
10048: } 
10049: 〞end example ] 
10050: 4 The zero-initialization (8.5) of all local objects with static storage duration (3.7.1) or thread storage dura-
10051: tion (3.7.2) is performed before any other initialization takes place. Constant initialization (3.6.2) of a local 
10052: entity with static storage duration, if applicable, is performed before its block is first entered. An implemen-
10053: tation is permitted to perform early initialization of other local objects with static or thread storage duration 
10054: under the same conditions that an implementation is permitted to statically initialize an object with static 
10055: or thread storage duration in namespace scope (3.6.2). Otherwise such an object is initialized the first time 
10056: control passes through its declaration; such an object is considered initialized upon the completion of its 
10057: initialization. If the initialization exits by throwing an exception, the initialization is not complete, so it will 
10058: be tried again the next time control enters the declaration. If control enters the declaration concurrently 
10059: while the object is being initialized, the concurrent execution shall wait for completion of the initialization.80 
10060: If control re-enters the declaration recursively while the object is being initialized, the behavior is undefined. 
10061: [ Example: 
10062: int foo(int i) {
10063: static int s = foo(2*i); // recursive call -undefined
10064: return i+1;
10065: } 
10066: 79) The transfer from the condition of a switch statement to a case label is considered a jump in this respect.
10067: 80) The implementation must not introduce any deadlock around execution of the initializer.
10068: ∫ 6.7 129 
10069: 
10070: c
10071: . ISO/IEC N2800=08-0310 
10072: 〞end example ] 
10073: 5 The destructor for a local object with static or thread storage duration will be executed if and only if the 
10074: variable was constructed. [ Note: 3.6.3 describes the order in which local objects with static and thread 
10075: storage duration are destroyed. 〞 end note ] 
10076: 6.8 Ambiguity resolution [stmt.ambig] 
10077: 1 There is an ambiguity in the grammar involving expression-statements and declarations: An expression-
10078: statement with a function-style explicit type conversion (5.2.3) as its leftmost subexpression can be indis-
10079: tinguishable from a declaration where the first declarator starts with a (. In those cases the statement is a 
10080: declaration.[ Note: To disambiguate, the whole statement might have to be examined to determine if it is 
10081: an expression-statement or a declaration. This disambiguates many examples. [ Example: assuming T is a 
10082: simple-type-specifier (7.1.6), 
10083: T(a)->m = 7; // expression-statement
10084: T(a)++; // expression-statement
10085: T(a,5)<<c; // expression-statement
10086: T(*d)(int); // declaration
10087: T(e)[5]; // declaration
10088: T(f) = { 1, 2 }; // declaration
10089: T(*g)(double(3)); // declaration
10090: In the last example above, g, which is a pointer to T, is initialized to double(3). This is of course ill-formed 
10091: for semantic reasons, but that does not affect the syntactic analysis. 〞end example ] 
10092: 2 The remaining cases are declarations. [ Example: 
10093: class T { 
10094: // ... 
10095: public:
10096: T();
10097: T(int);
10098: T(int, int);
10099: };
10100: T(a); // declaration
10101: T(*b)(); // declaration
10102: T(c)=7; // declaration
10103: T(d),e,f=3; // declaration
10104: extern int h;
10105: T(g)(h,2); // declaration
10106: 〞end example ] 〞end note ] 
10107: 3 The disambiguation is purely syntactic; that is, the meaning of the names occurring in such a statement, 
10108: beyond whether they are type-names or not, is not generally used in or changed by the disambiguation. Class 
10109: templates are instantiated as necessary to determine if a qualified name is a type-name. Disambiguation 
10110: precedes parsing, and a statement disambiguated as a declaration may be an ill-formed declaration. If, 
10111: during parsing, a name in a template parameter is bound differently than it would be bound during a trial 
10112: parse, the program is ill-formed. No diagnostic is required. [ Note: This can occur only when the name is 
10113: declared earlier in the declaration. 〞end note ][ Example: 
10114: struct T1 {
10115: T1 operator()(int x) { return T1(x); }
10116: int operator=(int x) { return x; }
10117: ∫ 6.8 130 
10118: 
10119: c
10120: . ISO/IEC N2800=08-0310 
10121: T1(int) { }
10122: };
10123: struct T2 { T2(int){ } };
10124: int a, (*(*b)(T2))(int), c, d;
10125: void f() { 
10126: // disambiguation requires this to be parsed as a declaration: 
10127: T1(a) = 3,
10128: T2(4), // T2 will be declared as
10129: (*(*b)(T2(c)))(int(d)); // a variable of type T1
10130: // but this will not allow 
10131: // the last part of the 
10132: // declaration to parse 
10133: // properly since it depends 
10134: // on T2 being a type-name 
10135: } 
10136: 〞end example ] 
10137: 6.9 Late-checked block [stmt.late] 
10138: 1 In a constrained context (14.10), a late-checked block treats the enclosed statements as if they were in an 
10139: unconstrained context. Outside of a constrained context, the late-checked block has no effect. [ Note: in 
10140: a late-checked block, template parameters do not behave as if they were replaced with their corresponding 
10141: archetypes. Thus, template parameters imply the existence of dependent types, type-dependent expressions, 
10142: and dependent names as in an unconstrained template. Furthermore, names at requirements scope (3.3.8) 
10143: are not visible. 〞end note ] 
10144: late-checked-block:
10145: late_check compound-statement
10146: 2 [ Example: 
10147: concept Semigroup<typename T> {
10148: T::T(const T&);
10149: T operator+(T, T);
10150: } 
10151: concept_map Semigroup<int> {
10152: int operator+(int x, int y) { return x * y; }
10153: }
10154: template<Semigroup T> 
10155: T add(T x, T y) {
10156: T r = x + y; // uses Semigroup<T>::operator+
10157: late_check {
10158: r = x + y; // uses operator+ found at instantiation time (not considering Semigroup<T>::operator+) 
10159: } 
10160: return r; 
10161: } 
10162: 〞end example ] 
10163: 3 [ Note: within a late-checked block, users should prefer to avoid using operations which, if written outside 
10164: of the late-checked block and in the nearest enclosing unconstrained context, would bind to a member of a 
10165: concept map archetype. If said avoidance is not practical, those operations should be clearly documented. 
10166: ∫ 6.9 131 
10167: 
10168: c
10169: . ISO/IEC N2800=08-0310 
10170: For example, the author of add(T,T) should warn other users against satisfying Semigroup<T>::operator+ 
10171: with anything other than the operator+ that would normally be selected for a given type T. 〞end note ] 
10172: 4 [ Note: a late-checked block should be used only when certain suitably constrained versions of templates 
10173: are not yet available for use from within the body of a constrained template definition and the only viable 
10174: alternative is the use of an unconstrained template. late_check is regarded as an evolutionary tool, to 
10175: mitigate the cost of migrating a template library to use concepts when the library is based on unconstrained 
10176: templates that cannot be constrained at that time. The use of late_check involves a loss of type-checking 
10177: and can circumvent the syntax adaptation capabilities provided by concept maps, leading to instantiations 
10178: that will silently invoke different operations than expected, as in the use of + in the add example above. For 
10179: these reasons, the use of late_check should be avoided whenever possible. 〞end note ] 
10180: ∫ 6.9 132 
10181: 
10182: . ISO/IEC N2800=08-0310 
10183: 7 Declarations [dcl.dcl]
10184: 1 Declarations specify how names are to be interpreted. Declarations have the form 
10185: declaration-seq:
10186: declaration
10187: declaration-seq declaration
10188: declaration:
10189: block-declaration
10190: function-definition
10191: template-declaration
10192: explicit-instantiation
10193: explicit-specialization
10194: linkage-specification
10195: namespace-definition
10196: concept-definition
10197: concept-map-definition
10198: attribute-declaration
10199: block-declaration:
10200: simple-declaration
10201: asm-definition
10202: namespace-alias-definition
10203: using-declaration
10204: using-directive
10205: static_assert-declaration
10206: alias-declaration
10207: opaque-enum-declaration
10208: alias-declaration:
10209: using identifier = type-id ;
10210: simple-declaration:
10211: attribute-specifieropt decl-specifier-seqopt attribute-specifieropt init-declarator-listopt ;
10212: static_assert-declaration:
10213: static_assert ( constant-expression , string-literal ) ;
10214: attribute-declaration:
10215: attribute-specifier ;
10216: [ Note: asm-definitions are described in 7.4, and linkage-specifications are described in 7.5. Function-
10217: definitions are described in 8.4 and template-declarations are described in Clause 14. Namespace-definitions 
10218: are described in 7.3.1, concept-definitions are described in 14.9.1, concept-map-definitions are described 
10219: in 14.9.2, using-declarations are described in 7.3.3 and using-directives are described in 7.3.4. 〞end note ] 
10220: The simple-declaration 
10221: attribute-specifieropt decl-specifier-seqopt attribute-specifieropt init-declarator-listopt ; 
10222: is divided into four parts. decl-specifiers, the components of a decl-specifier-seq, are described in 7.1. The 
10223: two optional attribute-specifiers and declarators, the components of an init-declarator-list, are described in 
10224: Clause 8. 
10225: Except where otherwise specified, the meaning of an attribute-declaration is implementation-defined. 
10226: 133 
10227: 
10228: c
10229: . ISO/IEC N2800=08-0310 
10230: 2 A declaration occurs in a scope (3.3); the scope rules are summarized in 3.4. A declaration that declares 
10231: a function or defines a class, concept, concept map, namespace, template, or function also has one or 
10232: more scopes nested within it. These nested scopes, in turn, can have declarations nested within them. 
10233: Unless otherwise stated, utterances in Clause 7 about components in, of, or contained by a declaration or 
10234: subcomponent thereof refer only to those components of the declaration that are not nested within scopes 
10235: nested within the declaration. 
10236: 3 In a simple-declaration, the optional init-declarator-list can be omitted only when declaring a class (Clause9) 
10237: or enumeration (7.2), that is, when the decl-specifier-seq contains either a class-specifier, an elaborated-
10238: type-specifier with a class-key (9.1), or an enum-specifier. In these cases and whenever a class-specifier or 
10239: enum-specifier is present in the decl-specifier-seq, the identifiers in these specifiers are among the names being 
10240: declared by the declaration (as class-names, enum-names, or enumerators, depending on the syntax). In such 
10241: cases, and except for the declaration of an unnamed bit-field (9.6), the decl-specifier-seq shall introduce one 
10242: or more names into the program, or shall redeclare a name introduced by a previous declaration. [ Example: 
10243: enum { }; // ill-formed
10244: typedef class { }; // ill-formed
10245: 〞end example ] 
10246: 4 In a static_assert-declaration the constant-expression shall be a constant expression (5.19) that can be 
10247: contextually converted to bool (Clause 4). If the value of the expression when so converted is true, the 
10248: declaration has no effect. Otherwise, the program is ill-formed, and the resulting diagnostic message (1.4) 
10249: shall include the text of the string-literal, except that characters not in the basic source character set (2.2) 
10250: are not required to appear in the diagnostic message. [ Example: 
10251: static_assert(sizeof(long) >= 8, "64-bit code generation required for this library."); 
10252: 〞end example ] 
10253: 5 Each init-declarator in the init-declarator-list contains exactly one declarator-id, which is the name declared 
10254: by that init-declarator and hence one of the names declared by the declaration. The type-specifiers (7.1.6) 
10255: in the decl-specifier-seq and the recursive declarator structure of the init-declarator describe a type (8.3), 
10256: which is then associated with the name being declared by the init-declarator. 
10257: 6 If the decl-specifier-seq contains the typedef specifier, the declaration is called a typedef declaration and the 
10258: name of each init-declarator is declared to be a typedef-name, synonymous with its associated type (7.1.3). 
10259: If the decl-specifier-seq contains no typedef specifier, the declaration is called a function declaration if the 
10260: type associated with the name is a function type (8.3.5) and an object declaration otherwise. 
10261: 7 Syntactic components beyond those found in the general form of declaration are added to a function decla-
10262: ration to make a function-definition. An object declaration, however, is also a definition unless it contains 
10263: the extern specifier and has no initializer (3.1). A definition causes the appropriate amount of storage to 
10264: be reserved and any appropriate initialization (8.5) to be done. 
10265: 8 Only in function declarations for constructors, destructors, and type conversions can the decl-specifier-seq 
10266: be omitted.81 If it is omitted, an attribute-specifier shall not appear. 
10267: 7.1 Specifiers [dcl.spec] 
10268: 1 The specifiers that can be used in a declaration are 
10269: 81) The ※implicit int§ rule of C is no longer supported. 
10270: ∫ 7.1 134 
10271: 
10272: c
10273: . ISO/IEC N2800=08-0310 
10274: decl-specifier:
10275: storage-class-specifier
10276: type-specifier
10277: function-specifier
10278: friend
10279: typedef
10280: constexpr
10281: alignment-specifier 
10282: decl-specifier-seq:
10283: decl-specifier-seqopt decl-specifier
10284: 2 The longest sequence of decl-specifiers that could possibly be a type name is taken as the decl-specifier-seq 
10285: of a declaration. The sequence shall be self-consistent as described below. [ Example: 
10286: typedef char* Pc;
10287: static Pc; // error: name missing
10288: Here, the declaration static Pc is ill-formed because no name was specified for the static variable of type Pc. 
10289: To get a variable called Pc, a type-specifier (other than const or volatile) has to be present to indicate that 
10290: the typedef-name Pc is the name being (re)declared, rather than being part of the decl-specifier sequence. 
10291: For another example, 
10292: void f(const Pc); // void f(char* const) (not const char*)
10293: void g(const int Pc); // void g(const int)
10294: 〞end example ] 
10295: 3 [ Note: since signed, unsigned, long, and short by default imply int, a type-name appearing after one of 
10296: those specifiers is treated as the name being (re)declared. [ Example: 
10297: void h(unsigned Pc); // void h(unsigned int)
10298: void k(unsigned int Pc); // void k(unsigned int)
10299: 〞end example ] 〞end note ] 
10300: 7.1.1 Storage class specifiers [dcl.stc] 
10301: 1 The storage class specifiers are 
10302: storage-class-specifier: 
10303: register 
10304: static 
10305: thread_local 
10306: extern 
10307: mutable 
10308: At most one storage-class-specifier shall appear in a given decl-specifier-seq, except that thread_local may 
10309: appear with static or extern. If thread_local appears in any declaration of an object or reference it 
10310: shall be present in all declarations of that object or reference. If a storage-class-specifier appears in a 
10311: decl-specifier-seq, there can be no typedef specifier in the same decl-specifier-seq and the init-declarator-
10312: list of the declaration shall not be empty (except for global anonymous unions, which shall be declared 
10313: static (9.5)). The storage-class-specifier applies to the name declared by each init-declarator in the list 
10314: and not to any names declared by other specifiers. A storage-class-specifier shall not be specified in an 
10315: explicit specialization (14.7.3) or an explicit instantiation (14.7.2) directive. 
10316: 2 The register specifier shall be applied only to names of objects declared in a block (6.3) or to function 
10317: parameters (8.4). It specifies that the named object has automatic storage duration (3.7.3). An object 
10318: ∫ 7.1.1 135 
10319: 
10320: c
10321: . ISO/IEC N2800=08-0310 
10322: declared without a storage-class-specifier at block scope or declared as a function parameter has automatic 
10323: storage duration by default. 
10324: 3 A register specifier is a hint to the implementation that the object so declared will be heavily used. [ Note: 
10325: the hint can be ignored and in most implementations it will be ignored if the address of the object is taken. 
10326: 〞end note ] 
10327: 4 The thread_local specifier shall be applied only to the names of objects or references of namespace scope 
10328: and to the names of objects or references of block scope that also specify static. It specifies that the named 
10329: object or reference has thread storage duration (3.7.2). 
10330: 5 The static specifier can be applied only to names of objects and functions and to anonymous unions (9.5). 
10331: There can be no static function declarations within a block, nor any static function parameters. A static 
10332: specifier used in the declaration of an object declares the object to have static storage duration (3.7.1), 
10333: unless accompanied by the thread_local specifier, which declares the object to have thread storage dura-
10334: tion (3.7.2). A static specifier can be used in declarations of class members; 9.4 describes its effect. For 
10335: the linkage of a name declared with a static specifier, see 3.5. 
10336: 6 The extern specifier can be applied only to the names of objects and functions. The extern specifier cannot 
10337: be used in the declaration of class members or function parameters. For the linkage of a name declared with 
10338: an extern specifier, see 3.5. [ Note: The extern keyword can also be used in explicit-instantiations and 
10339: linkage-specifications, but it is not a storage-class-specifier in such contexts. 〞end note ] 
10340: 7 A name declared in a namespace scope without a storage-class-specifier has external linkage unless it has 
10341: internal linkage because of a previous declaration and provided it is not declared const. Objects declared 
10342: const and not explicitly declared extern have internal linkage. 
10343: 8 The linkages implied by successive declarations for a given entity shall agree. That is, within a given scope, 
10344: each declaration declaring the same object name or the same overloading of a function name shall imply the 
10345: same linkage. Each function in a given set of overloaded functions can have a different linkage, however. 
10346: [ Example: 
10347: static char* f(); // f() has internal linkage 
10348: char* f() // f() still has internal linkage
10349: { /. ... / }
10350: char* g(); // g() has external linkage 
10351: static char* g() // error: inconsistent linkage
10352: { /. ... / }
10353: void h();
10354: inline void h(); // external linkage
10355: inline void l();
10356: void l(); // external linkage
10357: inline void m();
10358: extern void m(); // external linkage
10359: static void n();
10360: inline void n(); // internal linkage
10361: static int a; // a has internal linkage
10362: int a; // error: two definitions
10363: static int b; // b has internal linkage 
10364: ∫ 7.1.1 136 
10365: 
10366: c
10367: . ISO/IEC N2800=08-0310 
10368: extern int b; // b still has internal linkage 
10369: int c; // c has external linkage
10370: static int c; // error: inconsistent linkage
10371: extern int d; // d has external linkage
10372: static int d; // error: inconsistent linkage
10373: 〞end example ] 
10374: 9 The name of a declared but undefined class can be used in an extern declaration. Such a declaration can 
10375: only be used in ways that do not require a complete class type. [ Example: 
10376: struct S;
10377: extern S a;
10378: extern S f();
10379: extern void g(S);
10380: void h() {
10381: g(a); // error: S is incomplete
10382: f(); // error: S is incomplete
10383: } 
10384: 〞end example ] 
10385: 10 The mutable specifier can be applied only to names of class data members (9.2) and cannot be applied to 
10386: names declared const or static, and cannot be applied to reference members. [ Example: 
10387: class X {
10388: mutable const int* p; // OK
10389: mutable int* const q; // ill-formed
10390: }; 
10391: 〞end example ] 
10392: 11 The mutable specifier on a class data member nullifies a const specifier applied to the containing class object 
10393: and permits modification of the mutable class member even though the rest of the object is const (7.1.6.1). 
10394: 7.1.2 Function specifiers [dcl.fct.spec] 
10395: 1 Function-specifiers can be used only in function declarations. 
10396: function-specifier: 
10397: inline
10398: virtual
10399: explicit
10400: 2 A function declaration (8.3.5, 9.3, 11.4) with an inline specifier declares an inline function. The inline 
10401: specifier indicates to the implementation that inline substitution of the function body at the point of call 
10402: is to be preferred to the usual function call mechanism. An implementation is not required to perform this 
10403: inline substitution at the point of call; however, even if this inline substitution is omitted, the other rules 
10404: for inline functions defined by 7.1.2 shall still be respected. 
10405: 3 A function defined within a class definition is an inline function. The inline specifier shall not appear on 
10406: a block scope function declaration.82 If the inline specifier is used in a friend declaration, that declaration 
10407: shall be a definition or the function shall have previously been declared inline. 
10408: 82) The inline keyword has no effect on the linkage of a function. 
10409: ∫ 7.1.2 137 
10410: 
10411: c
10412: . ISO/IEC N2800=08-0310 
10413: 4 An inline function shall be defined in every translation unit in which it is used and shall have exactly 
10414: the same definition in every case (3.2). [ Note: a call to the inline function may be encountered before its 
10415: definition appears in the translation unit. 〞end note ] If the definition of a function appears in a translation 
10416: unit before its first declaration as inline, the program is ill-formed. If a function with external linkage is 
10417: declared inline in one translation unit, it shall be declared inline in all translation units in which it appears; 
10418: no diagnostic is required. An inline function with external linkage shall have the same address in all 
10419: translation units. A static local variable in an extern inline function always refers to the same object. 
10420: A string literal in the body of an extern inline function is the same object in different translation units. 
10421: [ Note: A string literal appearing in a default argument expression is not in the body of an inline function 
10422: merely because the expression is used in a function call from that inline function. 〞 end note ] 
10423: 5 The virtual specifier shall be used only in the initial declaration of a non-static class member function; 
10424: see 10.3. 
10425: 6 The explicit specifier shall be used only in the declaration of a constructor or conversion function within 
10426: its class definition; see 12.3.1 and 12.3.2. 
10427: 7.1.3 The typedef specifier [dcl.typedef] 
10428: 1 Declarations containing the decl-specifier typedef declare identifiers that can be used later for naming 
10429: fundamental (3.9.1) or compound (3.9.2) types. The typedef specifier shall not be used in a function-
10430: definition (8.4), and it shall not be combined in a decl-specifier-seq with any other kind of specifier except 
10431: a type-specifier. 
10432: typedef-name:
10433: identifier
10434: A name declared with the typedef specifier becomes a typedef-name. Within the scope of its declaration, a 
10435: typedef-name is syntactically equivalent to a keyword and names the type associated with the identifier in 
10436: the way described in Clause 8. A typedef-name is thus a synonym for another type. A typedef-name does 
10437: not introduce a new type the way a class declaration (9.1) or enum declaration does. [ Example: after 
10438: typedef int MILES, *KLICKSP; 
10439: the constructions 
10440: MILES distance;
10441: extern KLICKSP metricp;
10442: are all correct declarations; the type of distance is int and that of metricp is ※pointer to int.§ 〞end 
10443: example ] 
10444: 2 A typedef-name can also be introduced by an alias-declaration. The identifier following the using keyword 
10445: becomes a typedef-name. It has the same semantics as if it were introduced by the typedef specifier. In 
10446: particular, it does not define a new type and it shall not appear in the type-id.[ Example: 
10447: using handler_t = void (*)(int);
10448: extern handler_t ignore;
10449: extern void (*ignore)(int); // redeclare ignore
10450: using cell = pair<void*, cell*>; // ill-formed
10451: 〞end example ] 
10452: 3 In a given non-class scope, a typedef specifier can be used to redefine the name of any type declared in that 
10453: scope to refer to the type to which it already refers. [ Example: 
10454: ∫ 7.1.3 138 
10455: 
10456: c
10457: . ISO/IEC N2800=08-0310 
10458: typedef struct s { /. ... / } s;
10459: typedef int I;
10460: typedef int I;
10461: typedef I I;
10462: 〞end example ] 
10463: 4 In a given class scope, a typedef specifier can be used to redefine any class-name declared in that scope 
10464: that is not also a typedef-name to refer to the type to which it already refers. [ Example: 
10465: struct S {
10466: typedef struct A { } A; // OK
10467: typedef struct B B; // OK
10468: typedef A A; // error
10469: 〞end example ] 
10470: 5 In a given scope, a typedef specifier shall not be used to redefine the name of any type declared in that 
10471: scope to refer to a different type. [ Example: 
10472: class complex { /. ... / };
10473: typedef int complex; // error: redefinition
10474: 〞end example ] 
10475: 6 Similarly, in a given scope, a class or enumeration shall not be declared with the same name as a typedef-name 
10476: that is declared in that scope and refers to a type other than the class or enumeration itself. [ Example: 
10477: typedef int complex;
10478: class complex { /* ... */ }; // error: redefinition
10479: 〞end example ] 
10480: 7 [ Note: A typedef-name that names a class type, or a cv-qualified version thereof, is also a class-name (9.1). 
10481: If a typedef-name is used to identify the subject of an elaborated-type-specifier (7.1.6.3), a class definition 
10482: (Clause 9), a constructor declaration (12.1), or a destructor declaration (12.4), the program is ill-formed. 
10483: 〞end note ][ Example: 
10484: struct S {
10485: S();
10486: ~S();
10487: }; 
10488: typedef struct S T; 
10489: S a = T(); // OK
10490: struct T * p; // error
10491: 〞end example ] 
10492: 8 If the typedef declaration defines an unnamed class (or enum), the first typedef-name declared by the dec-
10493: laration to be that class type (or enum type) is used to denote the class type (or enum type) for linkage 
10494: purposes only (3.5). [ Example: 
10495: typedef struct { } *ps, S; // S is the class name for linkage purposes 
10496: 〞end example ] 
10497: ∫ 7.1.3 139 
10498: 
10499: c
10500: . ISO/IEC N2800=08-0310 
10501: 9 If a typedef TD names a type that is a reference to a type T, an attempt to create the type ※lvalue reference 
10502: to cv TD§ creates the type ※lvalue reference to T,§ while an attempt to create the type ※rvalue reference to 
10503: cv TD§ creates the type TD.[ Example: 
10504: int i;
10505: typedef int& LRI;
10506: typedef int&& RRI;
10507: LRI& r1 = i;
10508: const LRI& r2 = i;
10509: const LRI&& r3 = i;
10510: // r1 has the type int& 
10511: // r2 has the type int& 
10512: // r3 has the type int& 
10513: RRI& r4 = i; // r4 has the type int&
10514: RRI&& r5 = i; // r5 has the type int&&
10515: 〞end example ] 
10516: 7.1.4 The friend specifier [dcl.friend] 
10517: The friend specifier is used to specify access to class members; see 11.4. 
10518: 7.1.5 The constexpr specifier [dcl.constexpr] 
10519: 1 The constexpr specifier shall be applied only to the definition of an object, function, or function template, 
10520: or to the declaration of a static data member of an effective literal type (3.9). [ Note: function parameters 
10521: cannot be declared constexpr. 〞end note ][ Example: 
10522: constexpr int square(int x) { // OK 
10523: return x * x; 
10524: } 
10525: constexpr int bufsz = 1024; // OK 
10526: constexpr struct pixel { // error: pixel is a type 
10527: int x; 
10528: int y; 
10529: }; 
10530: int next(constexpr int x) { // error 
10531: return x + 1; 
10532: } 
10533: extern constexpr int memsz; // error: not a definition 
10534: 〞end example ] 
10535: 2 A constexpr specifier used in the declaration of a function that is not a constructor declares that function 
10536: to be a constexpr function. Similarly, a constexpr specifier used in a constructor declaration declares that 
10537: constructor to be a constexpr constructor. Constexpr functions and constexpr constructors are implicitly 
10538: inline (7.1.2). 
10539: 3 The definition of a constexpr function shall satisfy the following constraints: 
10540: 〞 it shall not be virtual (10.3) 
10541: 〞 its return type shall be an effective literal type 
10542: 〞 each of its parameter types shall be an effective literal type 
10543: 〞 its function-body shall be a compound-statement of the form 
10544: { return expression; } 
10545: ∫ 7.1.5 140 
10546: 
10547: c
10548: . ISO/IEC N2800=08-0310 
10549: where expression is a potential constant expression (5.19) 
10550: 〞 every implicit conversion used in converting expression to the function return type (8.5) shall be one 
10551: of those allowed in a constant expression (5.19). 
10552: [ Example: 
10553: constexpr int square(int x)
10554: { return x * x; } // OK
10555: constexpr long long_max()
10556: { return 2147483647; } // OK
10557: constexpr int abs(int x)
10558: { return x < 0 ? -x : x; } // OK
10559: constexpr void f(int x) // error: return type is void
10560: { /. .../ }
10561: constexpr int prev(int x)
10562: { return --x; } // error: use of decrement
10563: constexpr int g(int x, int n) { // error: body not just ※return expr§
10564: int r = 1;
10565: while (--n > 0) r *= x;
10566: return r;
10567: } 
10568: 〞end example ] 
10569: 4 The definition of a constexpr constructor shall satisfy the following constraints: 
10570: 〞 each of its parameter types shall be an effective literal type 
10571: 〞 its function-body shall not be a function-try-block 
10572: 〞 the compound-statement of its function-body shall be empty 
10573: 〞 every non-static data member and base class sub-object shall be initialized (12.6.2) 
10574: 〞 every constructor involved in initializing non-static data members and base class sub-objects invoked 
10575: by a mem-initializer shall be a constexpr constructor. 
10576: 〞 every constructor argument and full-expression in a mem-initializer shall be a potential constant 
10577: expression 
10578: 〞 every implicit conversion used in converting a constructor argument to the corresponding parameter 
10579: type and converting a full-expression to the corresponding member type shall be one of those allowed 
10580: in a constant expression. 
10581: A trivial copy constructor is also a constexpr constructor. 
10582: [ Example: 
10583: struct Length {
10584: explicit constexpr Length(int i = 0) : val(i) { }
10585: private:
10586: int val;
10587: };
10588: 〞end example ] 
10589: 5 If the instantiated template specialization of a constexpr function template would fail to satisfy the require-
10590: ments for a constexpr function or constexpr constructor, the constexpr specifier is ignored.. 
10591: ∫ 7.1.5 141 
10592: 
10593: c
10594: . ISO/IEC N2800=08-0310 
10595: 6 A constexpr specifier for a non-static member function that is not a constructor declares that member 
10596: function to be const (9.3.1). [ Note: the constexpr specifier has no other effect on the function type. 〞end 
10597: note ] The class of which that function is a member shall be a literal type (3.9). [ Example: 
10598: class debug_flag { 
10599: public:
10600: explicit debug_flag(bool);
10601: constexpr bool is_on(); // error: debug_flag not
10602: // literal type 
10603: private: 
10604: bool flag; 
10605: }; 
10606: constexpr int bar(int x, int y) // OK 
10607: { return x + y + x*y; } 
10608: // ... 
10609: int bar(int x, int y) // error: redefinition of bar
10610: { return x * 2 + 3 * y; }
10611: 〞end example ] 
10612: 7 A constexpr specifier used in an object declaration declares the object as const. Such an object shall be 
10613: initialized. If it is initialized by a constructor call, the constructor shall be a constexpr constructor and every 
10614: argument to the constructor shall be a constant expression. Otherwise, every full-expression that appears 
10615: in its initializer shall be a constant expression. Each implicit conversion used in converting the initializer 
10616: expressions and each constructor call used for the initialization shall be one of those allowed in a constant 
10617: expression (5.19). [ Example: 
10618: struct pixel { 
10619: int x, y; 
10620: }; 
10621: constexpr pixel ur = { 1294, 1024 };// OK 
10622: constexpr pixel origin; // error: initializer missing 
10623: 〞end example ] 
10624: 7.1.6 Type specifiers [dcl.type] 
10625: 1 The type-specifiers are 
10626: type-specifier:
10627: simple-type-specifier
10628: class-specifier
10629: enum-specifier
10630: elaborated-type-specifier
10631: typename-specifier
10632: cv-qualifier
10633: type-specifier-seq:
10634: type-specifier type-specifier-seqopt
10635: 2 As a general rule, at most one type-specifier is allowed in the complete decl-specifier-seq of a declaration or 
10636: in a type-specifier-seq. The only exceptions to this rule are the following: 
10637: 〞 const can be combined with any type specifier except itself. 
10638: 〞 volatile can be combined with any type specifier except itself. 
10639: 〞 signed or unsigned can be combined with char, long, short, or int. 
10640: ∫ 7.1.6 142 
10641: 
10642: c
10643: . ISO/IEC N2800=08-0310 
10644: 〞 short or long can be combined with int. 
10645: 〞 long can be combined with double. 
10646: 〞 long can be combined with long. 
10647: 3 At least one type-specifier thatis not a cv-qualifier is requiredin a declaration unless it declares a constructor, 
10648: destructor or conversion function.83 A type-specifier-seq shall not define a class or enumeration unless it 
10649: appears in the type-id of an alias-declaration (7.1.3). 
10650: 4 [ Note: class-specifiers and enum-specifiers are discussed in Clause 9 and 7.2, respectively. The remaining 
10651: type-specifiers are discussed in the rest of this section. 〞end note ] 
10652: 7.1.6.1 The cv-qualifiers [dcl.type.cv] 
10653: 1 There are two cv-qualifiers, const and volatile. If a cv-qualifier appears in a decl-specifier-seq, the init-
10654: declarator-list of the declaration shall not be empty. [ Note: 3.9.3 describes how cv-qualifiers affect object 
10655: and function types. 〞end note ] Redundant cv-qualifications are ignored. [ Note: for example, these could 
10656: be introduced by typedefs. 〞end note ] 
10657: 2 An object declared in namespace scope with a const-qualified type has internal linkage unless it is explicitly 
10658: declared extern or unless it was previously declared to have external linkage. A variable of non-volatile 
10659: const-qualified integral or enumeration type initialized by an integral constant expression can be used in 
10660: integral constant expressions (5.19). [ Note: as described in 8.5, the definition of an object or subobject of 
10661: const-qualified type must specify an initializer or be subject to default-initialization. 〞end note ] 
10662: 3 A pointer or reference to a cv-qualified type need not actually point or refer to a cv-qualified object, but it 
10663: is treated as if it does; a const-qualified access path cannot be used to modify an object even if the object 
10664: referenced is a non-const object and can be modified through some other access path. [ Note: cv-qualifiers 
10665: are supported by the type system so that they cannot be subverted without casting (5.2.11). 〞 end note ] 
10666: 4 Except that any class member declared mutable (7.1.1) can be modified, any attempt to modify a const 
10667: object during its lifetime (3.8) results in undefined behavior. [ Example: 
10668: const int ci = 3; // cv-qualified (initialized as required)
10669: ci = 4; // ill-formed: attempt to modify const
10670: int i = 2; // not cv-qualified
10671: const int* cip; // pointer to const int
10672: cip = &i; // OK: cv-qualified access path to unqualified
10673: *cip = 4; // ill-formed: attempt to modify through ptr to const
10674: int* ip;
10675: ip = const_cast<int*>(cip); // cast needed to convert const int* to int*
10676: *ip = 4; // defined: *ip points to i, a non-const object
10677: const int* ciq = new const int (3); // initialized as required
10678: int* iq = const_cast<int*>(ciq); // cast required
10679: *iq = 4; // undefined: modifies a const object
10680: 5 For another example 
10681: struct X {
10682: mutable int i;
10683: 83) There is no special provision for a decl-specifier-seq that lacks a type-specifier or that has a type-specifier that only specifies 
10684: cv-qualifiers. The ※implicit int§ rule of C is no longer supported. 
10685: ∫ 7.1.6.1 143 
10686: 
10687: . ISO/IEC N2800=08-0310 
10688: int j;
10689: };
10690: struct Y {
10691: X x;
10692: Y();
10693: };
10694: const Y y;
10695: y.x.i++; // well-formed: mutable member can be modified
10696: y.x.j++; // ill-formed: const-qualified member modified
10697: Y* p = const_cast<Y*>(&y); // cast away const-ness of y
10698: p->x.i = 99; // well-formed: mutable member can be modified
10699: p->x.j = 99; // undefined: modifies a const member
10700: 〞end example ] 
10701: 6 If an attempt is made to refer to an object defined with a volatile-qualified type through the use of an lvalue 
10702: with a non-volatile-qualified type, the program behavior is undefined. 
10703: 7 [ Note: volatile is a hint to the implementation to avoid aggressive optimization involving the object 
10704: because the value of the object might be changed by means undetectable by an implementation. See 1.9 for 
10705: detailed semantics. In general, the semantics of volatile are intended to be the same in C++ as they are 
10706: in C. 〞end note ] 
10707: 7.1.6.2 Simple type specifiers [dcl.type.simple] 
10708: 1 The simple type specifiers are 
10709: simple-type-specifier:
10710: ::opt nested-name-specifieropt type-name
10711: ::opt nested-name-specifier template simple-template-id
10712: char
10713: char16_t
10714: char32_t
10715: wchar_t
10716: bool
10717: short
10718: int
10719: long
10720: signed
10721: unsigned
10722: float
10723: double
10724: void
10725: auto
10726: decltype ( expression )
10727: type-name:
10728: class-name
10729: enum-name
10730: typedef-name
10731: 2 The auto specifier is a placeholder for a type to be deduced (7.1.6.4). The other simple-type-specifiers specify 
10732: either a previously-declared user-defined type or one of the fundamental types (3.9.1). Table 9 summarizes 
10733: the valid combinations of simple-type-specifiers and the types they specify. 
10734: ∫ 7.1.6.2 144 
10735: 
10736: . ISO/IEC N2800=08-0310 
10737: Table 9 〞 simple-type-specifiers and the types they specify 
10738: Specifier(s) Type 
10739: type-name 
10740: char 
10741: unsigned char 
10742: signed char 
10743: char16_t 
10744: char32_t 
10745: bool 
10746: unsigned 
10747: unsigned int 
10748: signed 
10749: signed int 
10750: int 
10751: unsigned short int 
10752: unsigned short 
10753: unsigned long int 
10754: unsigned long 
10755: unsigned long long int 
10756: unsigned long long 
10757: signed long int 
10758: signed long 
10759: signed long long int 
10760: signed long long 
10761: long long int 
10762: long long 
10763: long int 
10764: long 
10765: signed short int 
10766: signed short 
10767: short int 
10768: short 
10769: wchar_t 
10770: float 
10771: double 
10772: long double 
10773: void 
10774: auto 
10775: decltype(expression) 
10776: the type named
10777: ※char§
10778: ※unsigned char§
10779: ※signed char§
10780: ※char16_t§
10781: ※char32_t§
10782: ※bool§
10783: ※unsigned int§
10784: ※unsigned int§
10785: ※int§
10786: ※int§
10787: ※int§
10788: ※unsigned short int§
10789: ※unsigned short int§
10790: ※unsigned long int§
10791: ※unsigned long int§
10792: ※unsigned long long int§
10793: ※unsigned long long int§
10794: ※long int§
10795: ※long int§
10796: ※long long int§
10797: ※long long int§
10798: ※long long int§
10799: ※long long int§
10800: ※long int§
10801: ※long int§
10802: ※short int§
10803: ※short int§
10804: ※short int§
10805: ※short int§
10806: ※wchar_t§
10807: ※float§
10808: ※double§
10809: ※long double§
10810: ※void§
10811: placeholder for a type to be deduced
10812: the type as defined below
10813: 3 When multiple simple-type-specifiers are allowed, they can be freely intermixed with other decl-specifiers in 
10814: any order. [ Note: It is implementation-defined whether objects of char type and certain bit-fields (9.6) are 
10815: represented as signed or unsigned quantities. The signed specifier forces char objects and bit-fields to be 
10816: signed; it is redundant in other contexts. 〞end note ] 
10817: 4 The type denoted by decltype(e) is defined as follows: 
10818: 〞 if e is an id-expression or a class member access (5.2.5), decltype(e) is the type of the entity named 
10819: by e. If there is no such entity, or if e names a set of overloaded functions, the program is ill-formed; 
10820: ∫ 7.1.6.2 145 
10821: 
10822: c
10823: . ISO/IEC N2800=08-0310 
10824: 〞 otherwise, if e is a function call (5.2.2) or an invocation of an overloaded operator (parentheses around 
10825: e are ignored), decltype(e) is the return type of the statically chosen function; 
10826: 〞 otherwise, if e is an lvalue, decltype(e) is T&, where T is the type of e; 
10827: 〞 otherwise, decltype(e) is the type of e. 
10828: The operand of the decltype specifier is an unevaluated operand (Clause 5). 
10829: [ Example: 
10830: const int&& foo();
10831: int i;
10832: struct A { double x; };
10833: const A* a = new A();
10834: decltype(foo()) x1; // type is const int&&
10835: decltype(i) x2; // type is int
10836: decltype(a->x) x3; // type is double
10837: decltype((a->x)) x4; // type is const double&
10838: 〞end example ] 
10839: 7.1.6.3 Elaborated type specifiers [dcl.type.elab] 
10840: elaborated-type-specifier:
10841: class-key ::opt nested-name-specifieropt identifier
10842: class-key ::opt nested-name-specifieropt templateopt simple-template-id
10843: enum ::opt nested-name-specifieropt identifier
10844: 1 If an elaborated-type-specifier is the sole constituent of a declaration, the declaration is ill-formed unless it 
10845: is an explicit specialization (14.7.3), an explicit instantiation (14.7.2) or it has one of the following forms: 
10846: class-key identifier attribute-specifieropt ;
10847: friend class-key ::opt identifier ;
10848: friend class-key ::opt simple-template-id ;
10849: friend class-key ::opt nested-name-specifier identifier ;
10850: friend class-key ::opt nested-name-specifier templateopt simple-template-id ;
10851: In the first case, the attribute-specifier, if any, appertains to the class being declared; the attributes in the 
10852: attribute-specifier are thereafter considered attributes of the class whenever it is named. 
10853: 2 3.4.4 describes how name lookup proceeds for the identifier in an elaborated-type-specifier. If the identifier 
10854: resolves to a class-name or enum-name, the elaborated-type-specifier introduces it into the declaration the 
10855: same way a simple-type-specifier introduces its type-name. If the identifier resolves to a typedef-name, the 
10856: elaborated-type-specifier is ill-formed. [ Note: this implies that, within a class template with a template 
10857: type-parameter T, the declaration 
10858: friend class T; 
10859: is ill-formed. 〞end note ] 
10860: 3 The class-key or enum keyword present in the elaborated-type-specifier shall agree in kind with the dec-
10861: laration to which the name in the elaborated-type-specifier refers. This rule also applies to the form of 
10862: elaborated-type-specifier that declares a class-name or friend class since it can be construed as referring to 
10863: the definition of the class. Thus, in any elaborated-type-specifier, the enum keyword shall be used to refer to 
10864: an enumeration (7.2), the union class-key shall be used to refer to a union (Clause 9), and either the class 
10865: or struct class-key shall be used to refer to a class (Clause 9) declared using the class or struct class-key. 
10866: [ Example: 
10867: ∫ 7.1.6.3 146 
10868: 
10869: c
10870: . ISO/IEC N2800=08-0310 
10871: enum class E { a, b };
10872: enum E x = E::a; // OK
10873: 〞end example ] 
10874: 7.1.6.4 auto specifier [dcl.spec.auto] 
10875: 1 The auto type-specifier signifies that the type of an object being declared shall be deduced from its initializer 
10876: or specified explicitly at the end of a function declarator. 
10877: 2 The auto type-specifier may appear with a function declarator with a late-specified return type (8.3.5) in any 
10878: context where such a declarator is valid, and the use of auto is replaced by the type specified at the end of 
10879: the declarator. 
10880: 3 Otherwise, the type of the object is deduced from its initializer. The name of the object being declared shall 
10881: not appear in the initializer expression. This use of auto is allowed when declaring objects in a block (6.3), 
10882: in namespace scope (3.3.5), and in a for-init-statement (6.5.3). The decl-specifier-seq shall be followed by one 
10883: or more init-declarators, each of which shall have a non-empty initializer of either of the following forms: 
10884: = assignment-expression 
10885: ( assignment-expression ) 
10886: [ Example: 
10887: auto x = 5; // OK: x has type int
10888: const auto *v = &x, u = 6; // OK: v has type const int*, u has type const int
10889: static auto y = 0.0; // OK: y has type double
10890: auto int r; // error: auto is not a storage-class-specifier
10891: 〞end example ] 
10892: 4 The auto type-specifier can also be used in declaring an object in the condition of a selection statement (6.4) or 
10893: an iteration statement (6.5), in the type-specifier-seq in a new-type-id (5.3.4), in a for-range-declaration, and in 
10894: declaring a static data member with a brace-or-equal-initializer that appears within the member-specification 
10895: of a class definition (9.4.2). 
10896: 5 A program that uses auto in a context not explicitly allowed in this section is ill-formed. 
10897: 6 Once the type of a declarator-id has been determined according to 8.3, the type of the declared variable 
10898: using the declarator-id is determined from the type of its initializer using the rules for template argument 
10899: deduction. Let T be the type that has been determined for a variable identifier d. Obtain P from T by 
10900: replacing the occurrences of auto with either a new invented type template parameter U or, if the initializer 
10901: is a braced-init-list (8.5.4), with std::initializer_list<U>. The type deduced for the variable d is then 
10902: the deduced type determined using the rules of template argument deduction from a function call (14.8.2.1), 
10903: where P is a function template parameter type and the initializer for d is the corresponding argument. If 
10904: the deduction fails, the declaration is ill-formed. [ Example: 
10905: auto x1 = { 1, 2 }; // decltype(x1) is std::initializer_list<int>
10906: auto x2 = { 1, 2.0 }; // error: cannot deduce element type
10907: 〞end example ] 
10908: 7 If the list of declarators contains more than one declarator, the type of each declared variable is determined 
10909: as described above. If the type deduced for the template parameter U is not the same in each deduction, the 
10910: program is ill-formed. 
10911: [ Example: 
10912: const auto &i = expr; 
10913: ∫ 7.1.6.4 147 
10914: 
10915: c
10916: . ISO/IEC N2800=08-0310 
10917: The type of i is the deduced type of the parameter u in the call f(expr) of the following invented function 
10918: template: 
10919: template <class U> void f(const U& u); 
10920: 〞end example ] 
10921: 7.2 Enumeration declarations [dcl.enum] 
10922: 1 An enumeration is a distinct type (3.9.1) with named constants. Its name becomes an enum-name, within 
10923: its scope. 
10924: enum-name:
10925: identifier
10926: enum-specifier:
10927: enum-head { enumerator-listopt }
10928: enum-head { enumerator-list ,}
10929: enum-head:
10930: enum-key identifieropt attribute-specifieropt enum-baseopt attribute-specifieropt
10931: enum-key nested-name-specifier identifier
10932: attribute-specifieropt enum-baseopt 
10933: opaque-enum-declaration: 
10934: enum-key identifier attribute-specifieropt 
10935: enum-key: 
10936: enum
10937: enum class
10938: enum struct
10939: enum-base: 
10940: : type-specifier-seq 
10941: enumerator-list: 
10942: enumerator-definition 
10943: enumerator-list , enumerator-definition 
10944: enumerator-definition: 
10945: enumerator 
10946: enumerator = constant-expression 
10947: enumerator: 
10948: identifier 
10949: attribute-specifieropt 
10950: enum-baseopt attribute-specifieropt ; 
10951: The first optional attribute-specifier in the enum-head and the opaque-enum-declaration appertains to the 
10952: enumeration; the attributes in that attribute-specifier are thereafter considered attributes of the enumeration 
10953: whenever it is named. The second optional attribute-specifier in the enum-head and the opaque-enum-
10954: declaration shall appear only if the enum-base is present; it appertains to the enum-base. 
10955: 2 The enumeration type declared with an enum-key of only enum is an unscoped enumeration, and its enumer-
10956: ators are unscoped enumerators. The enum-keys enum class and enum struct are semantically equivalent; 
10957: an enumeration type declared with one of these is a scoped enumeration, and its enumerators are scoped 
10958: enumerators. The optional identifier shall not be omitted in the declaration of a scoped enumeration. The 
10959: type-specifier-seq of an enum-base shall name an integral type; any cv-qualification is ignored. An opaque-
10960: enum-declaration declaring an unscoped enumeration shall not omit the enum-base. The identifiers in an 
10961: enumerator-list are declared as constants, and can appear wherever constants are required. An enumerator-
10962: definition with = gives the associated enumerator the value indicated by the constant-expression. The 
10963: constant-expression shall be an integral constant expression (5.19). If the first enumerator has no initializer, 
10964: the value of the corresponding constant is zero. An enumerator-definition without an initializer gives the 
10965: enumerator the value obtained by increasing the value of the previous enumerator by one. 
10966: ∫ 7.2 148 
10967: 
10968: c
10969: . ISO/IEC N2800=08-0310 
10970: [ Example: 
10971: enum { a, b, c=0 };
10972: enum { d, e, f=e+2 };
10973: defines a, c, and d to be zero, b and e to be 1, and f to be 3. 〞end example ] 
10974: 3 An opaque-enum-declaration is either a redeclaration of an enumeration in the current scope or a declaration 
10975: of a new enumeration. [ Note: an enumeration declared by an opaque-enum-declaration has fixed underlying 
10976: type and is a complete type. The list of enumerators can be provided in a later redeclaration with an enum-
10977: specifier. 〞 end note ] A scoped enumeration shall not be later redeclared as unscoped or with a different 
10978: underlying type. An unscoped enumeration shall not be later redeclared as scoped and each redeclaration 
10979: shall include an enum-base specifying the same underlying type. 
10980: 4 If the enum-key is followed by a nested-name-specifier, the enum-specifier shall refer to an enumeration that 
10981: was previously declared directly in the class or namespace to which the nested-name-specifier refers (i.e., 
10982: neither inherited nor introduced by a using-declaration), and the enum-specifier shall appear in a namespace 
10983: enclosing the previous declaration. 
10984: 5 Each enumeration defines a type that is different from all other types. Each enumeration also has an 
10985: underlying type. The underlying type can be explicitly specified using enum-base; if not explicitly specified, 
10986: the underlying type of a scoped enumeration type is int. In these cases, the underlying type is said to be 
10987: fixed. Following the closing brace of an enum-specifier, each enumerator has the type of its enumeration. 
10988: If the underlying type is fixed, the type of each enumerator prior to the closing brace is the underlying 
10989: type; if the initializing value of an enumerator cannot be represented by the underlying type, the program 
10990: is ill-formed. If the underlying type is not fixed, the type of each enumerator is the type of its initializing 
10991: value: 
10992: 〞 If an initializer is specified for an enumerator, the initializing value has the same type as the expression. 
10993: 〞 If no initializer is specified for the first enumerator, the initializing value has an unspecified integral 
10994: type. 
10995: 〞 Otherwise the type of the initializing value is the same as the type of the initializing value of the 
10996: preceding enumerator unless the incremented value is not representable in that type, in which case the 
10997: type is an unspecified integral type sufficient to contain the incremented value. 
10998: 6 For an enumeration whose underlying type is not fixed, the underlying type is an integral type that can 
10999: represent all the enumerator values defined in the enumeration. If no integral type can represent all the 
11000: enumerator values, the enumeration is ill-formed. It is implementation-defined which integral type is used 
11001: as the underlying type except that the underlying type shall not be larger than int unless the value of an 
11002: enumerator cannot fit in an int or unsigned int. If the enumerator-list is empty, the underlying type is 
11003: as if the enumeration had a single enumerator with value 0. 
11004: 7 For an enumeration whose underlying type is fixed, the values of the enumeration are the values of the 
11005: underlying type. Otherwise, for an enumeration where emin is the smallest enumerator and emax is the 
11006: largest, the values of the enumeration are the values in the range bmin to bmax, defined as follows: Let K 
11007: be 1 for a two＊s complement representation and 0 for a one＊s complement or sign-magnitude representation. 
11008: bmax is the smallest value greater than or equal to max(emin. K, emax) and equal to 2M . 1, where 
11009: || |
11010: M is a non-negative integer. bmin is zero if emin is non-negative and |
11011: .(bmax + K) otherwise. The size of 
11012: the smallest bit-field large enough to hold all the values of the enumeration type is max(M, 1) if bmin is 
11013: zero and M + 1 otherwise. It is possible to define an enumeration that has values not defined by any of its 
11014: enumerators. 
11015: 8 Two enumeration types are layout-compatible if they have the same underlying type. 
11016: ∫ 7.2 149 
11017: 
11018: c
11019: . ISO/IEC N2800=08-0310 
11020: 9 The value of an enumerator or an object of an unscoped enumeration type is converted to an integer by 
11021: integral promotion (4.5). [ Example: 
11022: enum color { red, yellow, green=20, blue };
11023: color col = red;
11024: color* cp = &col;
11025: if (*cp == blue) // ...
11026: makes color a type describing various colors, and then declares col as an object of that type, and cp as a 
11027: pointer to an object of that type. The possible values of an object of type color are red, yellow, green, 
11028: blue these values can be converted to the integral values 0, 1, 20, and 21. Since enumerations are distinct 
11029: types, objects of type color can be assigned only values of type color. 
11030: color c = 1; // error: type mismatch,
11031: // no conversion from int to color
11032: int i = yellow; // OK: yellow converted to integral value 1
11033: // integral promotion
11034: Note that this implicit enum to int conversion is not provided for a scoped enumeration: 
11035: enum class Col { red, yellow, green };
11036: int x = Col::red; // error: no Col to int conversion
11037: Col y = Col::red;
11038: if (y) { } // error: no Col to bool conversion
11039: 〞end example ] 
11040: 10 An expression of arithmetic or enumeration type can be converted to an enumeration type explicitly. The 
11041: value is unchanged if it is in the range of enumeration values of the enumeration type; otherwise the resulting 
11042: enumeration value is unspecified. 
11043: 11 Each enum-name and each unscoped enumerator is declared in the scope that immediately contains the 
11044: enum-specifier. Each scoped enumerator is declared in the scope of the enumeration. These names obey the 
11045: scope rules defined for all names in (3.3) and (3.4).[ Example: 
11046: enum direction { left=＊l＊, right=＊r＊ }; 
11047: void g() {
11048: direction d; // OK
11049: d = left; // OK
11050: d = direction::right; // OK
11051: } 
11052: enum class altitude { high=＊h＊, low=＊l＊ }; 
11053: void h() {
11054: altitude a; // OK
11055: a = high; // error: high not in scope
11056: a = altitude::low; // OK
11057: } 
11058: 〞end example ] An enumerator declared in class scope can be referred to using the class member access 
11059: operators (::, . (dot) and -> (arrow)), see 5.2.5. [ Example: 
11060: struct X {
11061: enum direction { left=＊l＊, right=＊r＊ };
11062: ∫ 7.2 150 
11063: 
11064: . ISO/IEC N2800=08-0310 
11065: int f(int i) { return i==left ? 0 : i==right ? 1 : 2; } 
11066: }; 
11067: void g(X* p) { 
11068: direction d; // error: direction not in scope 
11069: int i; 
11070: i = p->f(left); // error: left not in scope 
11071: i = p->f(X::right); // OK 
11072: i = p->f(p->left); // OK 
11073: // ... 
11074: } 
11075: 〞 end example ] 
11076: 7.3 Namespaces [basic.namespace] 
11077: A namespace is an optionally-named declarative region. The name of a namespace can be used to access 
11078: entities declared in that namespace; that is, the members of the namespace. Unlike other declarative regions, 
11079: the definition of a namespace can be split over several parts of one or more translation units. 
11080: 2 The outermost declarative region of a translation unit is a namespace; see 3.3.5. 
11081: 7.3.1 Namespace definition [namespace.def] 
11082: 1 The grammar for a namespace-definition is 
11083: namespace-name: 
11084: original-namespace-name 
11085: namespace-alias 
11086: original-namespace-name: 
11087: identifier 
11088: namespace-definition: 
11089: named-namespace-definition 
11090: unnamed-namespace-definition 
11091: named-namespace-definition: 
11092: original-namespace-definition 
11093: extension-namespace-definition 
11094: original-namespace-definition: 
11095: inlineopt namespace identifier { namespace-body }
11096: extension-namespace-definition:
11097: inlineopt namespace original-namespace-name { namespace-body }
11098: unnamed-namespace-definition:
11099: inlineopt namespace { namespace-body }
11100: namespace-body:
11101: declaration-seqopt
11102: 2 The identifier in an original-namespace-definition shall not have been previously defined in the declarative 
11103: regionin which the original-namespace-definition appears. The identifier in an original-namespace-definition 
11104: is the name of the namespace. Subsequently in that declarative region, it is treated as an original-namespace-
11105: name. 
11106: 3 The original-namespace-name in an extension-namespace-definition shall have previously been defined in an 
11107: original-namespace-definition in the same declarative region. 
11108: 4 Every namespace-definition shall appear in the global scope or in a namespace scope (3.3.5). 
11109: ∫ 7.3.1 151 
11110: 
11111: c
11112: . ISO/IEC N2800=08-0310 
11113: 5 Because a namespace-definition contains declarations in its namespace-body and a namespace-definition is 
11114: itself a declaration, it follows that namespace-definitions can be nested. [ Example: 
11115: namespace Outer {
11116: int i;
11117: namespace Inner {
11118: void f() { i++; } // Outer::i
11119: int i;
11120: void g() { i++; } // Inner::i
11121: }
11122: }
11123: 〞end example ] 
11124: 6 The enclosing namespaces of a declaration are those namespaces in which the declaration lexically appears, 
11125: except for a redeclaration of a namespace member outside its original namespace (e.g., a definition as 
11126: specified in 7.3.1.2). Such a redeclaration has the same enclosing namespaces as the original declaration. 
11127: [ Example: 
11128: namespace Q { 
11129: namespace V {
11130: void f(); // enclosing namespaces are the global namespace, Q, and Q::V
11131: class C { void m(); };
11132: }
11133: void V::f() { // enclosing namespaces are the global namespace, Q, and Q::V
11134: extern void h(); // ... so this declares Q::V::h
11135: }
11136: void V::C::m() { // enclosing namespaces are the global namespace, Q, and Q::V
11137: }
11138: } 
11139: 〞end example ] 
11140: 7 If the optional initial inline keyword appears in a namespace-definition for a particular namespace, that 
11141: namespace is declared to be an inline namespace. The inline keyword may be used on an extension-
11142: namespace-definition only if it was previously used on the original-namespace-definition for that namespace. 
11143: 8 Members of an inline namespace can be used in most respects as though they were members of the enclosing 
11144: namespace. Specifically, the inline namespace and its enclosing namespace are considered to be associated 
11145: namespaces (3.4.2) of one another, and a using-directive (7.3.4) that names the inline namespace is implicitly 
11146: inserted into the enclosing namespace. Furthermore, each member of the inline namespace can subsequently 
11147: be explicitly instantiated (14.7.2) or explicitly specialized (14.7.3) as though it were a member of the enclosing 
11148: namespace. Finally, looking up a name in the enclosing namespace via explicit qualification (3.4.3.2) will 
11149: include members of the inline namespace brought in by the using-directive even if there are declarations of 
11150: that name in the enclosing namespace. 
11151: 9 These properties are transitive: if a namespace N contains an inline namespace M, which in turn contains an 
11152: inline namespace O, then the members of O can be used as though they were members of M or N. The set 
11153: of namespaces consisting of the innermost non-inline namespace enclosing an inline namespace O, together 
11154: with any intervening inline namespaces, is the enclosing namespace set of O. 
11155: 7.3.1.1 Unnamed namespaces [namespace.unnamed] 
11156: 1 An unnamed-namespace-definition behaves as if it were replaced by 
11157: namespace unique { /* empty body */ }
11158: using namespace unique ;
11159: namespace unique { namespace-body }
11160: ∫ 7.3.1.1 152 
11161: 
11162: c
11163: . ISO/IEC N2800=08-0310 
11164: where all occurrences of unique in a translation unit are replaced by the same identifier and this identifier 
11165: differs from all other identifiers in the entire program.84 [ Example: 
11166: namespace { int i; } // unique ::i
11167: void f() { i++; } // unique ::i++
11168: namespace A { 
11169: namespace {
11170: int i; // A:: unique ::i
11171: int j; // A:: unique ::j
11172: }
11173: void g() { i++; } // A:: unique ::i++
11174: }
11175: using namespace A; 
11176: void h() {
11177: i++; // error: unique ::i or A:: unique ::i
11178: A::i++; // A:: unique ::i
11179: j++; // A:: unique ::j
11180: } 
11181: 〞end example ] 
11182: 2 The use of the static keyword is deprecated when declaring objects in a namespace scope (see annex D); 
11183: the unnamed-namespace provides a superior alternative. 
11184: 7.3.1.2 Namespace member definitions [namespace.memdef] 
11185: 1 Members (including explicit specializations of templates (14.7.3)) of a namespace can be defined within that 
11186: namespace. [ Example: 
11187: namespace X {
11188: void f() { /. ... / }
11189: }
11190: 〞end example ] 
11191: 2 Members (including explicit specializations of templates (14.7.3)) of a named namespace can also be defined 
11192: outside that namespace by explicit qualification (3.4.3.2) of the name being defined, provided that the entity 
11193: being defined was already declared in the namespace and the definition appears after the point of declaration 
11194: in a namespace that encloses the declaration＊s namespace. [ Example: 
11195: namespace Q {
11196: namespace V {
11197: void f();
11198: }
11199: void V::f() { /. ... / } // OK
11200: void V::g() { /. ... / } // error: g() is not yet a member of V
11201: namespace V {
11202: void g();
11203: }
11204: }
11205: namespace R { 
11206: 84) Although entities in an unnamed namespace might have external linkage, they are effectively qualified by a name unique 
11207: to their translation unit and therefore can never be seen from any other translation unit. 
11208: ∫ 7.3.1.2 153 
11209: 
11210: c
11211: . ISO/IEC N2800=08-0310 
11212: void Q::V::g() { /. ... / } // error: R doesn＊t enclose Q
11213: }
11214: 〞end example ] 
11215: 3 Every name first declared in a namespace is a member of that namespace. If a friend declaration in a non-
11216: local class first declares a class or function85 the friend class or function is a member of the innermost enclosing 
11217: namespace. The name of the friend is not found by unqualified lookup (3.4.1) or by qualified lookup (3.4.3) 
11218: until a matching declaration is provided in that namespace scope (either before or after the class definition 
11219: granting friendship). If a friend function is called, its name may be found by the name lookup that considers 
11220: functions from namespaces and classes associated with the types of the function arguments (3.4.2). If the 
11221: name in a friend declaration is neither qualified nor a template-id and the declaration is a function or 
11222: an elaborated-type-specifier, the lookup to determine whether the entity has been previously declared shall 
11223: not consider any scopes outside the innermost enclosing namespace. [ Note: the other forms of friend 
11224: declarations cannot declare a new member of the innermost enclosing namespace and thus follow the usual 
11225: lookup rules. 〞 end note ][ Example: 
11226: // Assume f and g have not yet been defined.
11227: void h(int);
11228: template <class T> void f2(T);
11229: namespace A {
11230: class X {
11231: friend void f(X); // A::f(X) is a friend
11232: class Y {
11233: friend void g(); // A::g is a friend
11234: friend void h(int); // A::h is a friend
11235: // ::h not considered
11236: friend void f2<>(int); // ::f2<>(int) is a friend
11237: };
11238: };
11239: // A::f, A::g and A::h are not visible here
11240: X x;
11241: void g() { f(x); } // definition of A::g
11242: void f(X) { /* ... */} // definition of A::f
11243: void h(int) { /* ... */ } // definition of A::h
11244: // A::f, A::g and A::h are visible here and known to be friends
11245: } 
11246: using A::x; 
11247: void h() {
11248: A::f(x);
11249: A::X::f(x); // error: f is not a member of A::X
11250: A::X::Y::g(); // error: g is not a member of A::X::Y
11251: } 
11252: 〞end example ] 
11253: 7.3.2 Namespace alias [namespace.alias] 
11254: 1 A namespace-alias-definition declares an alternate name for a namespace according to the following grammar: 
11255: 85) this implies that the name of the class or function is unqualified. 
11256: ∫ 7.3.2 154 
11257: 
11258: c
11259: . ISO/IEC N2800=08-0310 
11260: namespace-alias:
11261: identifier
11262: namespace-alias-definition:
11263: namespace identifier = qualified-namespace-specifier ;
11264: qualified-namespace-specifier:
11265: ::opt nested-name-specifieropt namespace-name
11266: 2 The identifier in a namespace-alias-definition is a synonym for the name of the namespace denoted by the 
11267: qualified-namespace-specifier and becomes a namespace-alias.[ Note: when looking up a namespace-name 
11268: in a namespace-alias-definition, only namespace names are considered, see 3.4.6. 〞 end note ] 
11269: 3 In a declarative region, a namespace-alias-definition can be used to redefine a namespace-alias declared in 
11270: that declarative region to refer only to the namespace to which it already refers. [ Example: the following 
11271: declarations are well-formed: 
11272: namespace Company_with_very_long_name { /. ... / }
11273: namespace CWVLN = Company_with_very_long_name;
11274: namespace CWVLN = Company_with_very_long_name; // OK: duplicate
11275: namespace CWVLN = CWVLN;
11276: 〞end example ] 
11277: 4 A namespace-name or namespace-alias shall not be declared as the name of any other entity in the same 
11278: declarative region. A namespace-name defined at global scope shall not be declared as the name of any 
11279: other entity in any global scope of the program. No diagnostic is required for a violation of this rule by 
11280: declarations in different translation units. 
11281: 7.3.3 The using declaration [namespace.udecl] 
11282: 1 A using-declaration introduces a name into the declarative region in which the using-declaration appears. 
11283: using-declaration: 
11284: using typenameopt ::opt nested-name-specifier unqualified-id ; 
11285: using :: unqualified-id ; 
11286: using ::opt nested-name-specifieropt concept_map ::opt nested-name-specifieropt concept-id ; 
11287: using ::opt nested-name-specifieropt concept_map ::opt nested-name-specifieropt concept-nameopt ; 
11288: using ::opt nested-name-specifieropt concept-name ; 
11289: The member name specified in a using-declaration is declared in the declarative region in which the using-
11290: declaration appears. [ Note: only the specified name is so declared; specifying an enumeration name in a 
11291: using-declaration does not declare its enumerators in the using-declaration＊s declarative region. 〞end note ] 
11292: If a using-declaration names a constructor (3.4.3.1), it implicitly declares a set of constructors in the class in 
11293: which the using-declaration appears (12.9); otherwise the name specified in a using-declaration is a synonym 
11294: for the name of some entity declared elsewhere. 
11295: 2 Every using-declaration is a declaration and a member-declaration and so can be used in a class definition. 
11296: [ Example: 
11297: struct B {
11298: void f(char);
11299: void g(char);
11300: enum E { e };
11301: union { int x; };
11302: }; 
11303: struct D : B {
11304: using B::f;
11305: void f(int) { f(＊c＊); } // calls B::f(char)
11306: ∫ 7.3.3 155 
11307: 
11308: c
11309: . ISO/IEC N2800=08-0310 
11310: void g(int) { g(＊c＊); } // recursively calls D::g(int)
11311: };
11312: 〞end example ] 
11313: 3 In a using-declaration used as a member-declaration, the nested-name-specifier shall name a base class of the 
11314: class being defined. If such a using-declaration names a constructor, the nested-name-specifier shall name a 
11315: direct base class of the class being defined; otherwise it introduces the set of declarations found by member 
11316: name lookup (10.2, 3.4.3.1). [ Example: 
11317: class C {
11318: int g();
11319: };
11320: class D2 : public B { 
11321: using B::f; 
11322: using B::e; 
11323: using B::x; 
11324: using C::g; 
11325: }; 
11326: 〞end example ] 
11327: // OK: B is a base of D2 
11328: // OK: e is an enumerator of base B 
11329: // OK: x is a union member of base B 
11330: // error: C isn＊t a base of D2 
11331: 4 [ Note: Since destructors do not have names, a using-declaration cannot refer to a destructor for a base 
11332: class. Since specializations of member templates for conversion functions are not found by name lookup, 
11333: they are not considered when a using-declaration specifies a conversion function (14.5.2). 〞end note ] If 
11334: an assignment operator brought from a base class into a derived class scope has the signature of a copy-
11335: assignment operator for the derived class (12.8), the using-declaration does not by itself suppress the implicit 
11336: declaration of the derived class copy-assignment operator; the copy-assignment operator from the base class 
11337: is hidden or overridden by the implicitly-declared copy-assignment operator of the derived class, as described 
11338: below. 
11339: 5 A using-declaration shall not name a template-id.[ Example: 
11340: struct A {
11341: template <class T> void f(T);
11342: template <class T> struct X { };
11343: }; 
11344: struct B : A {
11345: using A::f<double>; // ill-formed
11346: using A::X<int>; // ill-formed
11347: }; 
11348: 〞end example ] 
11349: 6 A using-declaration shall not name a namespace. 
11350: 7 A using-declaration shall not name a scoped enumerator. 
11351: 8 A using-declaration for a class member shall be a member-declaration.[ Example: 
11352: struct X {
11353: int i;
11354: static int s;
11355: }; 
11356: void f() { 
11357: ∫ 7.3.3 156 
11358: 
11359: c
11360: . ISO/IEC N2800=08-0310 
11361: using X::i; // error: X::i is a class member
11362: // and this is not a member declaration.
11363: using X::s; // error: X::s is a class member
11364: // and this is not a member declaration.
11365: } 
11366: 〞end example ] 
11367: 9 Members declared by a using-declaration can be referred to by explicit qualification just like other member 
11368: names (3.4.3.2). In a using-declaration, a prefix :: refers to the global namespace. [ Example: 
11369: void f(); 
11370: namespace A {
11371: void g();
11372: }
11373: namespace X {
11374: using ::f; // global f
11375: using A::g; // A＊s g
11376: } 
11377: void h() 
11378: {
11379: X::f(); // calls ::f
11380: X::g(); // calls A::g
11381: } 
11382: 〞end example ] 
11383: 10 A using-declaration is a declaration and can therefore be used repeatedly where (and only where) multiple 
11384: declarations are allowed. [ Example: 
11385: namespace A {
11386: int i;
11387: }
11388: namespace A1 {
11389: using A::i;
11390: using A::i; // OK: double declaration
11391: } 
11392: void f() {
11393: using A::i;
11394: using A::i; // error: double declaration
11395: } 
11396: struct B {
11397: int i;
11398: };
11399: struct X : B {
11400: using B::i;
11401: using B::i; // error: double member declaration
11402: }; 
11403: ∫ 7.3.3 157 
11404: 
11405: c
11406: . ISO/IEC N2800=08-0310 
11407: 〞end example ] 
11408: 11 The entity declared by a using-declaration shall be known in the context using it according to its definition 
11409: at the point of the using-declaration. Definitions added to the namespace after the using-declaration are not 
11410: considered when a use of the name is made. [ Example: 
11411: namespace A {
11412: void f(int);
11413: }
11414: using A::f; // f is a synonym for A::f;
11415: // that is, for A::f(int).
11416: namespace A {
11417: void f(char);
11418: }
11419: void foo() {
11420: f(＊a＊); // calls f(int),
11421: } // even though f(char) exists.
11422: void bar() {
11423: using A::f; // f is a synonym for A::f;
11424: // that is, for A::f(int) and A::f(char).
11425: f(＊a＊); // calls f(char)
11426: }
11427: 〞end example ] 
11428: 12 [ Note: partial specializations of class templates are found by looking up the primary class template and then 
11429: considering all partial specializations of that template. If a using-declaration names a class template, partial 
11430: specializations introduced after the using-declaration are effectively visible because the primary template is 
11431: visible (14.5.5). 〞end note ] 
11432: 13 Since a using-declaration is a declaration, the restrictions on declarations of the same name in the same 
11433: declarative region (3.3) also apply to using-declarations. [ Example: 
11434: namespace A {
11435: int x;
11436: }
11437: namespace B {
11438: int i;
11439: struct g { };
11440: struct x { };
11441: void f(int);
11442: void f(double);
11443: void g(char); // OK: hides struct g
11444: } 
11445: void func() {
11446: int i;
11447: using B::i; // error: i declared twice
11448: void f(char);
11449: using B::f; // OK: each f is a function
11450: f(3.5); // calls B::f(double)
11451: using B::g;
11452: g(＊a＊); // calls B::g(char)
11453: ∫ 7.3.3 158 
11454: 
11455: c
11456: . ISO/IEC N2800=08-0310 
11457: struct g g1; // g1 has class type B::g
11458: using B::x;
11459: using A::x; // OK: hides struct B::x
11460: x = 99; // assigns to A::x
11461: struct x x1; // x1 has class type B::x
11462: } 
11463: 〞end example ] 
11464: 14 If a function declaration in namespace scope or block scope has the same name and the same parameter 
11465: types as a function introduced by a using-declaration, and the declarations do not declare the same function, 
11466: the program is ill-formed. [ Note: two using-declarations may introduce functions with the same name and 
11467: the same parameter types. If, for a call to an unqualified function name, function overload resolution selects 
11468: the functions introduced by such using-declarations, the function call is ill-formed. [ Example: 
11469: namespace B {
11470: void f(int);
11471: void f(double);
11472: } 
11473: namespace C {
11474: void f(int);
11475: void f(double);
11476: void f(char);
11477: } 
11478: void h() {
11479: using B::f; // B::f(int) and B::f(double)
11480: using C::f; // C::f(int), C::f(double), and C::f(char)
11481: f(＊h＊); // calls C::f(char)
11482: f(1); // error: ambiguous: B::f(int) or C::f(int)?
11483: void f(int); // error: f(int) conflicts with C::f(int) and B::f(int)
11484: } 
11485: 〞end example ] 〞end note ] 
11486: 15 When a using-declaration brings names from a base class into a derived class scope, member functions and 
11487: member function templates in the derived class override and/or hide member functions and member function 
11488: templates with the same name, parameter-type-list (8.3.5), and cv-qualification in a base class (rather than 
11489: conflicting). [ Note: For using-declarations that name a constructor, see 12.9. 〞end note ][ Example: 
11490: struct B {
11491: virtual void f(int);
11492: virtual void f(char);
11493: void g(int);
11494: void h(int);
11495: }; 
11496: struct D : B {
11497: using B::f;
11498: void f(int); // OK: D::f(int) overrides B::f(int);
11499: using B::g;
11500: void g(char); // OK
11501: using B::h;
11502: void h(int); // OK: D::h(int) hides B::h(int)
11503: ∫ 7.3.3 159 
11504: 
11505: c
11506: . ISO/IEC N2800=08-0310 
11507: }; 
11508: void k(D* p) 
11509: {
11510: p->f(1); // calls D::f(int)
11511: p->f(＊a＊); // calls B::f(char)
11512: p->g(1); // calls B::g(int)
11513: p->g(＊a＊); // calls D::g(char)
11514: } 
11515: 〞end example ] 
11516: 16 For the purpose of overload resolution, the functions which are introduced by a using-declaration into a 
11517: derived class will be treated as though they were members of the derived class. In particular, the implicit 
11518: this parameter shall be treated as if it were a pointer to the derived class rather than to the base class. 
11519: This has no effect on the type of the function, and in all other respects the function remains a member of 
11520: the base class. 
11521: 17 The access rules for inheriting constructors are specified in 12.9; otherwise all instances of the name mentioned 
11522: in a using-declaration shall be accessible. In particular, if a derived class uses a using-declaration to access 
11523: a member of a base class, the member name shall be accessible. If the name is that of an overloaded 
11524: member function, then all functions named shall be accessible. The base class members mentioned by a 
11525: using-declaration shall be visible in the scope of at least one of the direct base classes of the class where the 
11526: using-declaration is specified. [ Note: because a using-declaration designates a base class member (and not 
11527: a member subobject or a member function of a base class subobject), a using-declaration cannot be used to 
11528: resolve inherited member ambiguities. For example, 
11529: struct A { int x(); };
11530: struct B : A { };
11531: struct C : A {
11532: using A::x;
11533: int x(int);
11534: };
11535: struct D : B, C {
11536: using C::x;
11537: int x(double);
11538: };
11539: int f(D* d) {
11540: return d->x(); // ambiguous: B::x or C::x
11541: }
11542: 〞end note ] 
11543: 18 The alias created by the using-declaration has the usual accessibility for a member-declaration.[ Note: A 
11544: using-declaration that names a constructor does not create aliases; see 12.9 for the pertinent accessibility 
11545: rules. 〞 end note ][ Example: 
11546: class A {
11547: private:
11548: void f(char);
11549: public:
11550: void f(int);
11551: protected:
11552: void g();
11553: };
11554: ∫ 7.3.3 160 
11555: 
11556: c
11557: . ISO/IEC N2800=08-0310 
11558: class B : public A {
11559: using A::f; // error: A::f(char) is inaccessible
11560: public:
11561: using A::g; // B::g is a public synonym for A::g
11562: };
11563: 〞end example ] 
11564: 19 [ Note: use of access-declarations (11.3) is deprecated; member using-declarations provide a better alterna-
11565: tive. 〞end note ] 
11566: 20 If a using-declaration uses the keyword typename and specifies a dependent name (14.6.2), the name intro-
11567: duced by the using-declaration is treated as a typedef-name (7.1.3). 
11568: 21 A using-declaration for a concept map is an alias to the concept map determined by concept map lookup 
11569: (14.10.1.1) of the concept-id from the specified namespace. [ Example: 
11570: namespace N1 { 
11571: concept C<typename T> { }
11572: }
11573: namespace N2 {
11574: concept_map N1::C<int> { } // A 
11575: template<typename T> concept_map N1::C<T*> { } // B
11576: }
11577: namespace N3 {
11578: using N2::concept_map N1::C<int>; // aliases A
11579: using N2::concept_map N1::C<int*>; // aliases B, instantiated with T=int
11580: }
11581: 〞end example ] 
11582: 22 A using-declaration for a concept map that specifies a concept-name (and not a concept-id) brings all of the 
11583: concept maps and concept map templates from the specified namespace for the given concept into the scope 
11584: in which the using-declaration appears. [ Example: 
11585: namespace N1 {
11586: concept C<typename T> { }
11587: template<C T> void f(T) { }
11588: } 
11589: namespace N2 {
11590: concept_map N1::C<int> { } // A
11591: template<typename T> concept_map N1::C<T*> { } // B
11592: } 
11593: namespace N3 {
11594: using N2::concept_map N1::C; // aliases A and B
11595: void g() {
11596: f(1); // uses concept map N1::C<int> from A
11597: f(new int); // uses concept map N1::C<int*> instantiated from B with T=int
11598: }
11599: }
11600: 〞end example ] 
11601: 23 If no concept is specified in the concept map using-declaration, the following rule applies. Let X be the 
11602: namespace specified in the nested-name-specifier of the using-declaration. Let S be the set of all names of 
11603: concept maps and concept map templates in X and in the transitive closure of all namespaces nominated 
11604: ∫ 7.3.3 161 
11605: 
11606: c
11607: . ISO/IEC N2800=08-0310 
11608: by using-directives in X and its used namespaces, except that using-directives that nominate non-inline 
11609: namespaces (7.3.1.2) are ignored in any namespace, including X, directly containing one or more names of a 
11610: concept map or concept map template. No namespace is considered more than once to see if it contains a 
11611: concept map or concept map template. If S is the empty set, the program is ill-formed. For each element 
11612: in S, a name is introduced into the declarative region in which the using-declaration appears. The name is 
11613: a synonym for the referent concept map or concept map template. 
11614: [ Example: 
11615: namespace N1 {
11616: concept C<typename T> { }
11617: template<C T> void f(T) { }
11618: }
11619: namespace N2 {
11620: concept D<typename T> { }
11621: }
11622: namespace N3 {
11623: concept_map N1::C<int> { } // A
11624: template<typename T> concept_map N1::C<T*> { } // B
11625: concept_map N2::D<int> { } // C
11626: }
11627: namespace N4 {
11628: using N3::concept_map; // aliases A, B, and C
11629: }
11630: 〞end example ] 
11631: 24 If the second nested-name-specifier is specified but no concept is specified, then all concept maps in the 
11632: namespace specified by the first nested-name-specifier for all concepts in the namespace specified by the 
11633: second nested-name-specifier are brought into scope. 
11634: 25 [ Note: a using-directive for a namespace brings the concept maps of that namespace into scope, just like 
11635: other entities. 〞end note ][ Example: 
11636: namespace N1 { 
11637: concept C<typename T> { }
11638: }
11639: namespace N2 {
11640: concept_map N1::C<int> { }
11641: }
11642: namespace N3 {
11643: using namespace N2; 
11644: template<N1::C T> void foo(T) { }; 
11645: void bar() {
11646: foo(17); // OK, finds the concept map from N2
11647: }
11648: }
11649: 〞end example ] 
11650: 7.3.4 Using directive [namespace.udir] 
11651: using-directive: 
11652: attribute-specifieropt using namespace ::opt nested-name-specifieropt namespace-name ; 
11653: ∫ 7.3.4 162 
11654: 
11655: c
11656: . ISO/IEC N2800=08-0310 
11657: 1 A using-directive shall not appear in class scope, but may appear in namespace scope or in block scope. 
11658: [ Note: when looking up a namespace-name in a using-directive, only namespace names are considered, 
11659: see 3.4.6. 〞end note ] The optional attribute-specifier appertains to the using-directive. 
11660: 2 A using-directive specifies that the names in the nominated namespace can be used in the scope in which the 
11661: using-directive appears after the using-directive. During unqualified name lookup (3.4.1), the names appear 
11662: as if they were declared in the nearest enclosing namespace which contains both the using-directive and the 
11663: nominated namespace. [ Note: in this context, ※contains§ means ※contains directly or indirectly§. 〞end 
11664: note ] 
11665: 3 A using-directive does not add any members to the declarative region in which it appears. [ Example: 
11666: namespace A {
11667: int i;
11668: namespace B {
11669: namespace C { 
11670: int i;
11671: }
11672: using namespace A::B::C;
11673: void f1() {
11674: i = 5; // OK, C::i visible in B and hides A::i 
11675: }
11676: }
11677: namespace D {
11678: using namespace B;
11679: using namespace C;
11680: void f2() {
11681: i = 5; // ambiguous, B::C::i or A::i? 
11682: }
11683: }
11684: void f3() {
11685: i = 5; // uses A::i 
11686: }
11687: }
11688: void f4() {
11689: i = 5; // ill-formed; neither i is visible
11690: }
11691: 〞end example ] 
11692: 4 The using-directive is transitive: if a scope contains a using-directive that nominates a second namespace 
11693: that itself contains using-directives, the effect is as if the using-directives from the second namespace also 
11694: appeared in the first. [ Example: 
11695: namespace M {
11696: int i;
11697: }
11698: namespace N {
11699: int i;
11700: using namespace M;
11701: } 
11702: void f() {
11703: using namespace N;
11704: i = 7; // error: both M::i and N::i are visible
11705: } 
11706: ∫ 7.3.4 163 
11707: 
11708: c
11709: . ISO/IEC N2800=08-0310 
11710: For another example, 
11711: namespace A { 
11712: int i;
11713: }
11714: namespace B {
11715: int i;
11716: int j;
11717: namespace C {
11718: namespace D {
11719: using namespace A;
11720: int j;
11721: int k;
11722: int a = i; // B::i hides A::i
11723: }
11724: using namespace D;
11725: int k = 89; // no problem yet
11726: int l = k; // ambiguous: C::k or D::k
11727: int m = i; // B::i hides A::i
11728: int n = j; // D::j hides B::j
11729: }
11730: }
11731: 〞end example ] 
11732: 5 If a namespace is extended by an extension-namespace-definition after a using-directive for that namespace 
11733: is given, the additional members of the extended namespace and the members of namespaces nominated by 
11734: using-directives in the extension-namespace-definition can be used after the extension-namespace-definition. 
11735: 6 If name lookup finds a declaration for a name in two different namespaces, and the declarations do not 
11736: declare the same entity and do not declare functions, the use of the name is ill-formed. [ Note: in particular, 
11737: the name of an object, function or enumerator does not hide the name of a class or enumeration declared in 
11738: a different namespace. For example, 
11739: namespace A {
11740: class X { };
11741: extern "C" int g();
11742: extern "C++" int h();
11743: } 
11744: namespace B {
11745: void X(int);
11746: extern "C" int g();
11747: extern "C++" int h();
11748: }
11749: using namespace A;
11750: using namespace B;
11751: void f() {
11752: X(1); // error: name X found in two namespaces
11753: g(); // okay: name g refers to the same entity
11754: h(); // error: name h found in two namespaces
11755: } 
11756: 〞end note ] 
11757: 7 During overload resolution, all functions from the transitive search are considered for argument matching. 
11758: The set of declarations found by the transitive search is unordered. [ Note: in particular, the order in which 
11759: ∫ 7.3.4 164 
11760: 
11761: c
11762: . ISO/IEC N2800=08-0310 
11763: namespaces were considered and the relationships among the namespaces implied by the using-directives do 
11764: not cause preference to be given to any of the declarations found by the search. 〞 end note ] An ambiguity 
11765: exists if the best match finds two functions with the same signature, even if one is in a namespace reachable 
11766: through using-directives in the namespace of the other.86 [ Example: 
11767: namespace D {
11768: int d1;
11769: void f(char);
11770: }
11771: using namespace D;
11772: int d1; // OK: no conflict with D::d1 
11773: namespace E {
11774: int e;
11775: void f(int);
11776: } 
11777: namespace D { // namespace extension
11778: int d2;
11779: using namespace E;
11780: void f(int);
11781: } 
11782: void f() {
11783: d1++; // error: ambiguous ::d1 or D::d1?
11784: ::d1++; // OK
11785: D::d1++; // OK
11786: d2++; // OK: D::d2
11787: e++; // OK: E::e
11788: f(1); // error: ambiguous: D::f(int) or E::f(int)?
11789: f(＊a＊); // OK: D::f(char)
11790: } 
11791: 〞end example ] 
11792: 7.4 The asm declaration [dcl.asm] 
11793: 1 An asm declaration has the form 
11794: asm-definition:
11795: asm ( string-literal ) ;
11796: The asm declaration is conditionally-supported; its meaning is implementation-defined. [ Note: Typically it 
11797: is used to pass information through the implementation to an assembler. 〞end note ] 
11798: 7.5 Linkage specifications [dcl.link] 
11799: 1 All function types, function names with external linkage, and variable names with external linkage have a 
11800: language linkage.[ Note: Some of the properties associated with an entity with language linkage are specific 
11801: to each implementation and are not described here. For example, a particular language linkage may be 
11802: associated with a particular form of representing names of objects and functions with external linkage, or 
11803: with a particular calling convention, etc. 〞end note ] The default language linkage of all function types, 
11804: 86) During name lookup in a class hierarchy, some ambiguities may be resolved by considering whether one member hides 
11805: the other along some paths (10.2). There is no such disambiguation when considering the set of names found as a result of 
11806: following using-directives. 
11807: ∫ 7.5 165 
11808: 
11809: c
11810: . ISO/IEC N2800=08-0310 
11811: function names, and variable names is C++ language linkage. Two function types with different language 
11812: linkages are distinct types even if they are otherwise identical. 
11813: 2 Linkage (3.5) between C++ and non-C++ code fragments can be achieved using a linkage-specification: 
11814: linkage-specification:
11815: extern string-literal { declaration-seqopt }
11816: extern string-literal declaration
11817: The string-literal indicates the required language linkage. This International Standard specifies the semantics 
11818: for the string-literals "C" and "C++". Use of a string-literal other than "C" or "C++" is conditionally-
11819: supported, with implementation-defined semantics. [ Note: Therefore, a linkage-specification with a string-
11820: literal that is unknown to the implementation requires a diagnostic. 〞end note ][ Note: It is recommended 
11821: that the spelling of the string-literal be taken from the document defining that language. For example, Ada 
11822: (not ADA) and Fortran or FORTRAN, depending on the vintage. 〞end note ] 
11823: 3 Every implementation shall provide for linkage to functions written in the C programming language, "C", 
11824: and linkage to C++ functions, "C++".[ Example: 
11825: complex sqrt(complex); // C++ linkage by default
11826: extern "C" {
11827: double sqrt(double); // C linkage
11828: }
11829: 〞end example ] 
11830: 4 Linkage specifications nest. When linkage specifications nest, the innermost one determines the language 
11831: linkage. A linkage specification does not establish a scope. A linkage-specification shall occur only in 
11832: namespace scope (3.3). In a linkage-specification, the specified language linkage applies to the function 
11833: types of all function declarators, function names with external linkage, and variable names with external 
11834: linkage declared within the linkage-specification.[ Example: 
11835: extern "C" void f1(void(*pf)(int));
11836: // the name f1 and its function type have C language
11837: // linkage; pf is a pointer to a C function
11838: extern "C" typedef void FUNC();
11839: FUNC f2; // the name f2 has C++ language linkage and the
11840: // function＊s type has C language linkage
11841: extern "C" FUNC f3; // the name of function f3 and the function＊s type
11842: // have C language linkage
11843: void (*pf2)(FUNC*); // the name of the variable pf2 has C++ linkage and
11844: // the type of pf2 is pointer to C++ function that
11845: // takes one parameter of type pointer to C function
11846: extern "C" { 
11847: static void f4(); // the name of the function f4 has
11848: // internal linkage (not C language
11849: // linkage) and the function＊s type
11850: // has C language linkage.
11851: } 
11852: extern "C" void f5() { 
11853: extern void f4(); // OK: Name linkage (internal)
11854: // and function type linkage (C
11855: // language linkage) gotten from
11856: // previous declaration.
11857: } 
11858: ∫ 7.5 166 
11859: 
11860: c
11861: . ISO/IEC N2800=08-0310 
11862: extern void f4(); // OK: Name linkage (internal)
11863: // and function type linkage (C
11864: // language linkage) gotten from
11865: // previous declaration.
11866: } 
11867: void f6() { 
11868: extern void f4(); // OK: Name linkage (internal)
11869: // and function type linkage (C
11870: // language linkage) gotten from
11871: // previous declaration.
11872: } 
11873: 〞end example ] A C language linkage is ignored for the names of class members and the member function 
11874: type of class member functions. [ Example: 
11875: extern "C" typedef void FUNC_c();
11876: class C {
11877: void mf1(FUNC_c*); // the name of the function mf1 and the member
11878: // function＊s type have C++ language linkage; the
11879: // parameter has type pointer to C function
11880: FUNC_c mf2; // the name of the function mf2 and the member
11881: // function＊s type have C++ language linkage
11882: static FUNC_c* q; // the name of the data member q has C++ language
11883: // linkage and the data member＊s type is pointer to
11884: // C function
11885: }; 
11886: extern "C" {
11887: class X {
11888: void mf(); // the name of the function mf and the member
11889: // function＊s type have C++ language linkage 
11890: void mf2(void(*)()); // the name of the function mf2 has C++ language
11891: // linkage; the parameter has type pointer to
11892: // C function
11893: };
11894: }
11895: 〞end example ] 
11896: 5 If two declarations of the same function or object specify different linkage-specifications (that is, the linkage-
11897: specifications of these declarations specify different string-literals), the program is ill-formed if the declara-
11898: tions appear in the same translation unit, and the one definition rule (3.2) applies if the declarations appear 
11899: in different translation units. Except for functions with C++ linkage, a function declaration without a linkage 
11900: specification shall not precede the first linkage specification for that function. A function can be declared 
11901: without a linkage specification after an explicit linkage specification has been seen; the linkage explicitly 
11902: specified in the earlier declaration is not affected by such a function declaration. 
11903: 6 At most one function with a particular name can have C language linkage. Two declarations for a function 
11904: with C language linkage with the same function name (ignoring the namespace names that qualify it) 
11905: that appear in different namespace scopes refer to the same function. Two declarations for an object with 
11906: C language linkage with the same name (ignoring the namespace names that qualify it) that appear in 
11907: different namespace scopes refer to the same object. [ Note: because of the one definition rule (3.2), only 
11908: one definition for a function or object with C linkage may appear in the program; that is, such a function 
11909: or object must not be defined in more than one namespace scope. For example, 
11910: ∫ 7.5 167 
11911: 
11912: c
11913: . ISO/IEC N2800=08-0310 
11914: namespace A {
11915: extern "C" int f();
11916: extern "C" int g() { return 1; }
11917: extern "C" int h();
11918: } 
11919: namespace B {
11920: extern "C" int f(); // A::f and B::f refer
11921: // to the same function
11922: extern "C" int g() { return 1; } // ill-formed, the function g
11923: // with C language linkage
11924: // has two definitions
11925: } 
11926: int A::f() { return 98; } //definition for the function f
11927: // with C language linkage
11928: extern "C" int h() { return 97; }
11929: // definition for the function h
11930: // with C language linkage
11931: // A::h and ::h refer to the same function
11932: 〞end note ] 
11933: 7 A declaration directly contained in a linkage-specification is treated as if it contains the extern speci-
11934: fier (7.1.1) for the purpose of determining the linkage of the declared name and whether it is a definition. 
11935: Such a declaration shall not specify a storage class. [ Example: 
11936: extern "C" double f();
11937: static double f(); // error
11938: extern "C" int i; // declaration
11939: extern "C" {
11940: int i; // definition
11941: }
11942: extern "C" static void g(); // error
11943: 〞end example ] 
11944: 8 [ Note: because the language linkage is part of a function type, when a pointer to C function (for example) 
11945: is dereferenced, the function to which it refers is considered a C function. 〞end note ] 
11946: 9 Linkage from C++ to objects defined in other languages and to objects defined in C++ from other languages 
11947: is implementation-defined and language-dependent. Only where the object layout strategies of two language 
11948: implementations are similar enough can such linkage be achieved. 
11949: 7.6 Attributes [dcl.attr] 
11950: 7.6.1 Attribute syntax and semantics [dcl.attr.grammar] 
11951: 1 Attributes specify additional information for various source constructs such as types, variables, names, 
11952: blocks, or translation units. 
11953: attribute-specifier:
11954: [ [ attribute-list ] ]
11955: attribute-list:
11956: attributeopt
11957: attribute-list , attributeopt
11958: ∫ 7.6.1 168 
11959: 
11960: c
11961: . ISO/IEC N2800=08-0310 
11962: attribute:
11963: attribute-token attribute-argument-clauseopt
11964: attribute-token:
11965: identifier
11966: attribute-scoped-token
11967: attribute-scoped-token:
11968: attribute-namespace :: identifier
11969: attribute-namespace:
11970: identifier
11971: attribute-argument-clause:
11972: ( balanced-token-seq )
11973: balanced-token-seq:
11974: balanced-token
11975: balanced-token-seq balanced-token
11976: balanced-token:
11977: ( balanced-token-seq )
11978: [ balanced-token-seq ]
11979: { balanced-token-seq }
11980: any token other than a parenthesis, a bracket, or a brace
11981: 2 [ Note: For each individual attribute, the form of the balanced-token-seq will be specified. 〞end note ] 
11982: 3 An attribute-specifier that contains no attributes has no effect. The order in which the attribute-tokens 
11983: appear in an attribute-list is not significant. A keyword (2.11) contained in an attribute-token is considered 
11984: an identifier. No name lookup (3.4) is performed on any of the identifiers contained in an attribute-token. 
11985: The attribute-token determines additional requirements on the attribute-argument-clause (if any). The use 
11986: of an attribute-scoped-token is conditionally-supported, with implementation-defined behavior. [ Note: Each 
11987: implementation should choose a distinctive name for the attribute-namespace in an attribute-scoped-token. 
11988: 〞end note ] 
11989: 4 Each attribute-specifier is said to appertain to some entity or statement, identified by the syntactic context 
11990: where it appears (clause 7, clause 8). If an attribute-specifier that appertains to some entity or state-
11991: ment contains an attribute that does not apply to that entity or statement, the program is ill-formed. If 
11992: an attribute-specifier appertains to a friend declaration (11.4), that declaration shall be a definition. No 
11993: attribute-specifier shall appertain to an explicit instantiation (14.7.2). 
11994: 5 For an attribute-token not specified in this International Standard, the behavior is implementation-defined. 
11995: 7.6.2 Alignment attribute [dcl.align] 
11996: 1 The attribute-token align specifies alignment. The attribute shall have one of the following forms: 
11997: align ( type-id )
11998: align ( assignment-expression )
11999: The attribute can be applied to a variable that is neither a function parameter nor declared with the register 
12000: storage class specifier and to a class data member that is not a bit-field. 
12001: 2 When the alignment attribute is of the form align(assignment-expression ): 
12002: 〞 the assignment-expression shall be an integral constant expression 
12003: 〞 if the constant expression evaluates to a fundamental alignment, the alignment requirement of the 
12004: declared object shall be the specified fundamental alignment 
12005: ∫ 7.6.2 169 
12006: 
12007: c
12008: . ISO/IEC N2800=08-0310 
12009: 〞 if the constant expression evaluates to an extended alignment and the implementation supports that 
12010: alignment in the context of the declaration, the alignment of the declared object shall be that alignment 
12011: 〞 if the constant expression evaluates to an extended alignment and the implementation does not support 
12012: that alignment in the context of the declaration, the program is ill-formed 
12013: 〞 if the constant expression evaluates to zero, the alignment specifier shall have no effect 
12014: 〞 otherwise, the program is ill-formed. 
12015: 3 When the alignment attribute is of the form align(type-id ), it shall have the same effect as align(alignof(type-
12016: id )) (5.3.6). 
12017: 4 When multiple alignment attributes are specified for an object, the alignment requirement shall be set to 
12018: the strictest specified alignment. 
12019: 5 The combined effect of all alignment attributes in a declaration shall not specify an alignment that is less 
12020: strict than the alignment that would otherwise be required for the object being declared. 
12021: 6 If the defining declaration of an object has an alignment attribute, any non-defining declaration of that 
12022: object shall either specify equivalent alignment or have no alignment attribute. No diagnostic is required if 
12023: declarations of an object have different alignment attributes in different translation units. 
12024: 7 [ Example: An aligned buffer with an alignment requirement of A and holding N elements of type T other 
12025: than char, signed char, or unsigned char can be declared as: 
12026: T buffer [[ align(T), align(A) ]] [N]; 
12027: Specifying align(T) in the attribute-list ensures that the final requested algnment will not be weaker than 
12028: alignof(T), and therefore the program will not be ill-formed. 〞end example ] 
12029: 8 [ Note: the alignment of a union type can be strengthened by applying the alignment attribute to any 
12030: member of the union. 〞 end note ] 
12031: 9 [ Example: 
12032: void f [[ align(double) ]] (); 
12033: unsigned char c 
12034: [[ align(double) ]] [sizeof(double)]; 
12035: extern unsigned char c[sizeof(double)]; 
12036: extern unsigned char c 
12037: [[ align(float) ]] [sizeof(double)]; 
12038: // error: alignment applied to function 
12039: // array of characters, suitably aligned for a double 
12040: // no align necessary 
12041: // error: different alignment in declaration 
12042: 〞 end example ] 
12043: 7.6.3 Noreturn attribute [dcl.attr.noreturn] 
12044: 1 The attribute-token noreturn specifies that a function does not return. It shall appear at most once in each 
12045: attribute-list and no attribute-argument-clause shall be present. The attribute applies to the declarator-id 
12046: in a function declaration. The first declaration of a function shall specify the noreturn attribute if any 
12047: declaration of that function specifies the noreturn attribute. If a function is declared with the noreturn 
12048: attribute in one translation unit and the same function is declared without the noreturn attribute in another 
12049: translation unit, the program is ill-formed; no diagnostic required. 
12050: 2 If a function f is called where f was previously declared with the noreturn attribute and f eventually 
12051: returns, the behavior is undefined. [ Note: The function may terminate by throwing an exception. 〞end 
12052: note ] 
12053: 3 [ Example: 
12054: ∫ 7.6.3 170 
12055: 
12056: c
12057: . ISO/IEC N2800=08-0310 
12058: void f [[ noreturn ]] () {
12059: throw "error"; // OK
12060: } 
12061: void q [[ noreturn ]] (int i) { // behavior is undefined if called with an argument <= 0
12062: if (i > 0)
12063: throw "positive";
12064: }
12065: 〞end example ] 
12066: 7.6.4 Final attribute [dcl.attr.final] 
12067: 1 The attribute-token final specifies overriding semantics for a virtual function. It shall appear at most 
12068: once in each attribute-list and no attribute-argument-clause shall be present. The attribute applies to class 
12069: definitions and to virtual member functions being declared in a class definition. If the attribute is specified 
12070: for a class definition, it is equivalent to being specified for each virtual member function of that class, 
12071: including inherited member functions. 
12072: 2 If a virtual member function f in some class B is marked final and in a class D derived from B a function 
12073: D::f overrides B::f, the program is ill-formed; 
12074: [ Example: 
12075: struct B { 
12076: virtual void f [[ final ]] (); 
12077: }; 
12078: struct D : B { 
12079: void f(); // ill-formed
12080: };
12081: 〞end example ] 
12082: 7.6.5 Carries dependency attribute 
12083: no diagnostic required.87 
12084: [dcl.attr.depend] 
12085: 1 The attribute-token carries_dependency specifies dependency propagation into and out of functions. It shall 
12086: appear at most once in each attribute-list and no attribute-argument-clause shall be present. The attribute 
12087: applies to the declarator-id of a parameter-declaration, in which case it specifies that the initialization of the 
12088: parameter carries a dependency to (1.10) each lvalue-to-rvalue conversion (4.1) of that object. The attribute 
12089: also applies to the declarator-id of a function declaration, in which case it specifies that the return value 
12090: carries a dependency to the evaluation of the function call expression. 
12091: 2 The first declaration of a function shall specify the carries_dependency attribute for its declarator-id if any 
12092: declaration of the function specifies the carries_dependency attribute. Furthermore, the first declaration of 
12093: a function shall specify the carries_dependency attribute for a parameter if any declaration of that function 
12094: specifies the carries_dependency attribute for that parameter. If a function or one of its parameters is 
12095: declared with the carries_dependency attribute in its first declaration in one translation unit and the 
12096: same function or one of its parameters is declared without the carries_dependency attribute in its first 
12097: declaration in another translation unit, the program is ill-formed; no diagnostic required. 
12098: 3 [ Note: the carries_dependency attribute does not change the meaning of the program, but may result in 
12099: generation of more efficient code. 〞end note ] 
12100: 4 [ Example: 
12101: 87) If an implementation does not emit a diagnostic it should execute the program as if final were not present. 
12102: ∫ 7.6.5 171 
12103: 
12104: c
12105: . ISO/IEC N2800=08-0310 
12106: /. Compilation unit A. / 
12107: struct foo { int* a; int* b; };
12108: struct foo* foo_head[10];
12109: struct foo* f [[carries_dependency]] (int i) {
12110: return foo_head[i].load(memory_order_consume);
12111: }
12112: int g(int* x, int* y [[carries_dependency]]) {
12113: return kill_dependency(foo_array[*x][*y]);
12114: }
12115: /. Compilation unit B. / 
12116: struct foo* f [[carries_dependency]] (int i);
12117: int* g(int* x, int* y [[carries_dependency]]);
12118: int c = 3; 
12119: void h(int i) {
12120: struct foo* p;
12121: p = f(i);
12122: do_something_with(g(&c, p->a));
12123: do_something_with(g(p->a, &c));
12124: } 
12125: 5 The annotation on function f means that the return value carries a dependency out of f, so that the 
12126: implementation need not constrain ordering upon return from f. 
12127: 6 Function g＊s second argument is annotated, but its first argument is not. Therefore, function h＊s first call 
12128: to g carries a dependency into g, but its second call does not. The implementation might need to constrain 
12129: ordering prior to the second call to g. 
12130: 〞end example ] 
12131: ∫ 7.6.5 172 
12132: 
12133: . ISO/IEC N2800=08-0310 
12134: 8 Declarators [dcl.decl]
12135: 1 A declarator declares a single object, function, or type, within a declaration. The init-declarator-list appear-
12136: ing in a declaration is a comma-separated sequence of declarators, each of which can have an initializer. 
12137: init-declarator-list:
12138: init-declarator
12139: init-declarator-list , init-declarator
12140: init-declarator:
12141: declarator initializeropt
12142: 2 The two components of a declaration are the specifiers (decl-specifier-seq; 7.1) and the declarators (init-
12143: declarator-list). The specifiers indicate the type, storage class or other properties of the objects, functions 
12144: or typedefs being declared. The declarators specify the names of these objects, functions or typedefs, 
12145: and (optionally) modify the type of the specifiers with operators such as * (pointer to) and () (function 
12146: returning). Initial values can also be specified in a declarator; initializers are discussed in 8.5 and 12.6. 
12147: 3 Each init-declarator in a declaration is analyzed separately as if it was in a declaration by itself.88 
12148: 4 Declarators have the syntax 
12149: declarator:
12150: ptr-declarator
12151: noptr-declarator parameters-and-qualifiers -> attribute-specifieropt type-id
12152: ptr-declarator:
12153: noptr-declarator
12154: ptr-operator ptr-declarator
12155: noptr-declarator:
12156: declarator-id attribute-specifieropt
12157: noptr-declarator parameters-and-qualifiers
12158: noptr-declarator [ constant-expressionopt ] attribute-specifieropt
12159: ( ptr-declarator )
12160: parameters-and-qualifiers:
12161: ( parameter-declaration-clause ) attribute-specifieropt cv-qualifier-seqopt
12162: ref-qualifieropt exception-specificationopt
12163: 88) A declaration with several declarators is usually equivalent to the corresponding sequence of declarations each with a 
12164: single declarator. That is 
12165: T D1, D2, ... Dn; 
12166: is usually equvalent to 
12167: T D1; T D2; ... T Dn; 
12168: where T is a decl-specifier-seq and each Di is an init-declarator. The exception occurs when a name introduced by one of 
12169: the declarators hides a type name used by the dcl-specifiers, so that when the same dcl-specifiers are used in a subsequent 
12170: declaration, they do not have the same meaning, as in 
12171: struct S ... ;
12172: S S, T; // declare two instances of struct S
12173: which is not equivalent to
12174: struct S ... ;
12175: S S;
12176: S T; // error
12177: 
12178: c
12179: . ISO/IEC N2800=08-0310 
12180: ptr-operator: 
12181: * attribute-specifieropt cv-qualifier-seqopt
12182: &
12183: &&
12184: ::opt nested-name-specifier * attribute-specifieropt cv-qualifier-seqopt
12185: cv-qualifier-seq:
12186: cv-qualifier cv-qualifier-seqopt
12187: cv-qualifier: 
12188: const
12189: volatile
12190: ref-qualifier: 
12191: &
12192: &&
12193: declarator-id:
12194: ...opt id-expression
12195: ::opt nested-name-specifieropt class-name
12196: A class-name has special meaning in a declaration of the class of that name and when qualified by that 
12197: name using the scope resolution operator :: (5.1, 12.1, 12.4). 
12198: 8.1 Type names [dcl.name] 
12199: 1 To specify type conversions explicitly, and as an argument of sizeof, alignof, new, or typeid, the name of 
12200: a type shall be specified. This can be done with a type-id, which is syntactically a declaration for an object 
12201: or function of that type that omits the name of the object or function. 
12202: type-id:
12203: type-specifier-seq attribute-specifieropt abstract-declaratoropt
12204: abstract-declarator: 
12205: ptr-abstract-declarator 
12206: noptr-abstract-declaratoropt parameters-and-qualifiers -> attribute-specifieropt type-id 
12207: ... 
12208: ptr-abstract-declarator:
12209: noptr-abstract-declarator
12210: ptr-operator ptr-abstract-declaratoropt
12211: noptr-abstract-declarator:
12212: noptr-abstract-declaratoropt parameters-and-qualifiers
12213: noptr-abstract-declaratoropt [ constant-expression ] attribute-specifieropt
12214: ( ptr-abstract-declarator )
12215: It is possible to identify uniquely the location in the abstract-declarator where the identifier would appear 
12216: if the construction were a declarator in a declaration. The named type is then the same as the type of the 
12217: hypothetical identifier. [ Example: 
12218: int
12219: int *
12220: int *[3]
12221: int (*)[3]
12222: int *()
12223: int (*)(double)
12224: // int i
12225: // int *pi
12226: // int *p[3]
12227: // int (*p3i)[3]
12228: // int *f()
12229: // int (*pf)(double)
12230: name respectively the types ※int,§ ※pointer to int,§ ※array of 3 pointers to int,§ ※pointer to array of 3 int,§ 
12231: ※function of (no parameters) returning pointer to int,§ and ※pointer to a function of (double) returning 
12232: int.§ 〞end example ] 
12233: ∫ 8.1 174 
12234: 
12235: c
12236: . ISO/IEC N2800=08-0310 
12237: 2 A type can also be named (often more easily) by using a typedef (7.1.3). 
12238: 8.2 Ambiguity resolution [dcl.ambig.res] 
12239: 1 The ambiguity arising from the similarity between a function-style cast and a declaration mentioned in 6.8 
12240: can also occur in the context of a declaration. In that context, the choice is between a function declaration 
12241: with a redundant set of parentheses around a parameter name and an object declaration with a function-style 
12242: cast as the initializer. Just as for the ambiguities mentioned in 6.8, the resolution is to consider any construct 
12243: that could possibly be a declaration a declaration. [ Note: a declaration can be explicitly disambiguated by 
12244: a nonfunction-style cast, by an = to indicate initialization or by removing the redundant parentheses around 
12245: the parameter name. 〞end note ][ Example: 
12246: struct S {
12247: S(int);
12248: };
12249: void foo(double a) {
12250: S w(int(a)); // function declaration
12251: S x(int()); // function declaration
12252: S y((int)a); // object declaration
12253: S z = int(a); // object declaration
12254: } 
12255: 〞end example ] 
12256: 2 The ambiguity arising from the similarity between a function-style cast and a type-id can occur in different 
12257: contexts. The ambiguity appears as a choice between a function-style cast expression and a declaration of a 
12258: type. The resolution is that any construct that could possibly be a type-id in its syntactic context shall be 
12259: considered a type-id. 
12260: 3 [ Example: 
12261: #include <cstddef>
12262: char *p;
12263: void *operator new(std::size_t, int);
12264: void foo() {
12265: const int x = 63;
12266: new (int(*p)) int; // new-placement expression
12267: new (int(*[x])); // new type-id
12268: } 
12269: 4 For another example, 
12270: template <class T>
12271: struct S {
12272: T *p;
12273: };
12274: S<int()> x; // type-id
12275: S<int(1)> y; // expression (ill-formed)
12276: 5 For another example, 
12277: void foo() {
12278: sizeof(int(1)); // expression
12279: sizeof(int()); // type-id (ill-formed)
12280: } 
12281: ∫ 8.2 175 
12282: 
12283: c
12284: . ISO/IEC N2800=08-0310 
12285: 6 For another example, 
12286: void foo() {
12287: (int(1)); // expression
12288: (int())1; // type-id (ill-formed)
12289: } 
12290: 〞end example ] 
12291: 7 Another ambiguity arises in a parameter-declaration-clause of a function declaration, or in a type-id that 
12292: is the operand of a sizeof or typeid operator, when a type-name is nested in parentheses. In this case, 
12293: the choice is between the declaration of a parameter of type pointer to function and the declaration of a 
12294: parameter with redundant parentheses around the declarator-id. The resolution is to consider the type-name 
12295: as a simple-type-specifier rather than a declarator-id.[ Example: 
12296: class C { }; 
12297: void f(int(C)) { } // void f(int(*fp)(C c)) { } 
12298: // not: void f(int C); 
12299: int g(C); 
12300: void foo() { 
12301: f(1); // error: cannot convert 1 to function pointer 
12302: f(g); // OK 
12303: } 
12304: For another example, 
12305: class C { }; 
12306: void h(int *(C[10])); // void h(int *(*_fp)(C _parm[10])); 
12307: // not: void h(int *C[10]); 
12308: 〞 end example ] 
12309: 8.3 Meaning of declarators [dcl.meaning] 
12310: 1 A list of declarators appears after an optional (Clause 7) decl-specifier-seq (7.1). Each declarator contains 
12311: exactly one declarator-id; it names the identifier that is declared. An unqualified-id occurring in a declarator-
12312: id shall be a simple identifier except for the declaration of some special functions (12.3, 12.4, 13.5) and for the 
12313: declaration of template specializations or partial specializations (14.7). A declarator-id shall not be qualified 
12314: except for the definition of a member function (9.3) or static data member (9.4) outside of its class, the 
12315: definition or explicit instantiation of a function or variable member of a namespace outside of its namespace, 
12316: or the definition of a previously declared explicit specialization outside of its namespace, or the declaration of 
12317: a friend function that is a member of another class or namespace (11.4). When the declarator-id is qualified, 
12318: the declaration shall refer to a previously declared member of the class or namespace to which the qualifier 
12319: refers (or of an inline namespace within that scope (7.3.1)), and the member shall not have been introduced 
12320: by a using-declaration in the scope of the class or namespace nominated by the nested-name-specifier of the 
12321: declarator-id.[ Note: if the qualifier is the global :: scope resolution operator, the declarator-id refers to 
12322: a name declared in the global namespace scope. 〞end note ] The optional attribute-specifier following a 
12323: declarator-id appertains to the entity that is declared. 
12324: 2 A static, thread_local, extern, register, mutable, friend, inline, virtual, or typedef specifier ap-
12325: plies directly to each declarator-id in an init-declarator-list; the type specified for each declarator-id depends 
12326: on both the decl-specifier-seq and its declarator. 
12327: 3 Thus, a declaration of a particular identifier has the form 
12328: ∫ 8.3 176 
12329: 
12330: c
12331: . ISO/IEC N2800=08-0310 
12332: T D 
12333: where T is of the form attribute-specifieropt decl-specifier-seq attribute-specifieropt and D is a declarator. 
12334: Following is a recursive procedure for determining the type specified for the contained declarator-id by such 
12335: a declaration. 
12336: 4 First, the decl-specifier-seq determines a type. In a declaration 
12337: T D 
12338: the decl-specifier-seq T determines the type T.[ Example: in the declaration 
12339: int unsigned i; 
12340: the type specifiers int unsigned determine the type ※unsigned int§ (7.1.6.2). 〞end example ] 
12341: 5 In a declaration attribute-specifieropt T attribute-specifieropt D where D is an unadorned identifier the type 
12342: of this identifier is ※T§. The first optional attribute-specifier appertains to the entity being declared. The 
12343: second optional attribute-specifier appertains to the type T, but not to the class or enumeration declared in 
12344: the decl-specifier-seq, if any. 
12345: 6 In a declaration T D where D has the form 
12346: ( D1 ) 
12347: the type of the contained declarator-id is the same as that of the contained declarator-id in the declaration 
12348: T D1 
12349: Parentheses do not alter the type of the embedded declarator-id, but they can alter the binding of complex 
12350: declarators. 
12351: 7 In a constrained context (14.10), a type archetype cv T shall be used as the type of a variable only if the 
12352: template has a concept requirement std::VariableType<T>. 
12353: 8.3.1 Pointers [dcl.ptr] 
12354: 1 In a declaration T D where D has the form 
12355: * attribute-specifieropt cv-qualifier-seqopt D1 
12356: and the type of the identifier in the declaration T D1 is ※derived-declarator-type-list T,§ then the type of the 
12357: identifier of D is ※derived-declarator-type-list cv-qualifier-seq pointer to T.§ The cv-qualifiers apply to the pointer 
12358: and not to the object pointed to. Similarly, the optional attribute-specifier (7.6.1) appertains to the pointer 
12359: and not to the object pointed to. 
12360: 2 [ Example: the declarations 
12361: const int ci = 10, *pc = &ci, *const cpc = pc, **ppc;
12362: int i, *p, *const cp = &i;
12363: declare ci, a constant integer; pc, a pointer to a constant integer; cpc, a constant pointer to a constant 
12364: integer; ppc, a pointer to a pointer to a constant integer; i, an integer; p, a pointer to integer; and cp, a 
12365: constant pointer to integer. The value of ci, cpc, and cp cannot be changed after initialization. The value 
12366: of pc can be changed, and so can the object pointed to by cp. Examples of some correct operations are 
12367: i = ci;
12368: *cp = ci;
12369: pc++;
12370: ∫ 8.3.1 177 
12371: 
12372: c
12373: . ISO/IEC N2800=08-0310 
12374: pc = cpc;
12375: pc = p;
12376: ppc = &pc;
12377: Examples of ill-formed operations are 
12378: ci = 1; // error
12379: ci++; // error
12380: *pc = 2; // error
12381: cp = &ci; // error
12382: cpc++; // error
12383: p = pc; // error
12384: ppc = &p; // error
12385: Each is unacceptable because it would either change the value of an object declared const or allow it to be 
12386: changed through a cv-unqualified pointer later, for example: 
12387: *ppc = &ci; // OK, but would make p point to ci ...
12388: // ... because of previous error
12389: *p = 5; // clobber ci
12390: 〞end example ] 
12391: 3 See also 5.17 and 8.5. 
12392: 4 [ Note: there are no pointers to references; see 8.3.2. Since the address of a bit-field (9.6) cannot be taken, 
12393: a pointer can never point to a bit-field. 〞end note ] 
12394: 5 In a constrained context (14.10), a type archetype cv T shall be used to form a type ※pointer to cv T§ only 
12395: if the template has a concept requirement std::PointeeType<T>. 
12396: 8.3.2 References [dcl.ref] 
12397: 1 In a declaration T D where D has either of the forms 
12398: & D1
12399: && D1
12400: and the type of the identifier in the declaration T D1 is ※derived-declarator-type-list T,§ then the type of the 
12401: identifier of D is ※derived-declarator-type-list reference to T.§ Cv-qualified references are ill-formed except when 
12402: the cv-qualifiers are introduced through the use of a typedef (7.1.3) or of a template type argument (14.3), 
12403: in which case the cv-qualifiers are ignored. [ Example: 
12404: typedef int& A;
12405: const A aref = 3; // ill-formed; non-const reference initialized with rvalue
12406: The type of aref is ※reference to int§, not ※const reference to int§. 〞end example ][ Note: a reference 
12407: can be thought of as a name of an object. 〞end note ] A declarator that specifies the type ※reference to cv 
12408: void§ is ill-formed. 
12409: 2 A reference type that is declared using & is called an lvalue reference, and a reference type that is declared 
12410: using && is called an rvalue reference. Lvalue references and rvalue references are distinct types. Except 
12411: where explicitly noted, they are semantically equivalent and commonly referred to as references. 
12412: 3 [ Example: 
12413: ∫ 8.3.2 178 
12414: 
12415: c
12416: . ISO/IEC N2800=08-0310 
12417: void f(double& a) { a += 3.14; } 
12418: // ... 
12419: double d = 0;
12420: f(d);
12421: declares a to be a reference parameter of f so the call f(d) will add 3.14 to d. 
12422: int v[20]; 
12423: // ... 
12424: int& g(int i) { return v[i]; } 
12425: // ... 
12426: g(3) = 7; 
12427: declares the function g() to return a reference to an integer so g(3)=7 will assign 7 to the fourth element 
12428: of the array v. For another example, 
12429: struct link {
12430: link* next;
12431: };
12432: link* first; 
12433: void h(link*& p) { // p is a reference to pointer
12434: p->next = first;
12435: first = p;
12436: p = 0;
12437: } 
12438: void k() {
12439: link* q = new link;
12440: h(q);
12441: } 
12442: declares p to be a reference to a pointer to link so h(q) will leave q with the value zero. See also 8.5.3. 
12443: 〞end example ] 
12444: 4 It is unspecified whether or not a reference requires storage (3.7). 
12445: 5 There shall be no references to references, no arrays of references, and no pointers to references. The 
12446: declaration of a reference shall contain an initializer (8.5.3) except when the declaration contains an explicit 
12447: extern specifier (7.1.1), is a class member (9.2) declaration within a class definition, or is the declaration 
12448: of a parameter or a return type (8.3.5); see 3.1. A reference shall be initialized to refer to a valid object 
12449: or function. [ Note: in particular, a null reference cannot exist in a well-defined program, because the only 
12450: way to create such a reference would be to bind it to the ※object§ obtained by dereferencing a null pointer, 
12451: which causes undefined behavior. As described in 9.6, a reference cannot be bound directly to a bit-field. 
12452: 〞end note ] 
12453: 6 In a constrained context (14.10), a type archetype cv T shall be used to form a type ※reference to cv T§ only 
12454: if the template has a concept requirement std::ReferentType<T>. 
12455: 8.3.3 Pointers to members [dcl.mptr] 
12456: 1 In a declaration T D where D has the form 
12457: ::opt nested-name-specifier * attribute-specifieropt cv-qualifier-seqopt D1 
12458: ∫ 8.3.3 179 
12459: 
12460: c
12461: . ISO/IEC N2800=08-0310 
12462: and the nested-name-specifier names a class, and the type of the identifier in the declaration T D1 is ※derived-
12463: declarator-type-list T§, then the type of the identifier of D is ※derived-declarator-type-list cv-qualifier-seq pointer 
12464: to member of class nested-name-specifier of type T§. The optional attribute-specifier (7.6.1) appertains to the 
12465: pointer-to-member. 
12466: 2 [ Example: 
12467: struct X {
12468: void f(int);
12469: int a;
12470: };
12471: struct Y;
12472: int X::* pmi = &X::a;
12473: void (X::* pmf)(int) = &X::f;
12474: double X::* pmd;
12475: char Y::* pmc;
12476: declares pmi, pmf, pmd and pmc to be a pointer to a member of X of type int, a pointer to a member of 
12477: X of type void(int), a pointer to a member of X of type double and a pointer to a member of Y of type 
12478: char respectively. The declaration of pmd is well-formed even though X has no members of type double. 
12479: Similarly, the declaration of pmc is well-formed even though Y is an incomplete type. pmi and pmf can be 
12480: used like this: 
12481: X obj; 
12482: // ...
12483: obj.*pmi = 7; // assign 7 to an integer
12484: // member of obj
12485: (obj.*pmf)(7); // call a function member of obj
12486: // with the argument 7
12487: 〞end example ] 
12488: 3 A pointer to member shall not point to a static member of a class (9.4), a member with reference type, or 
12489: ※cv void.§ In a constrained context (14.10), a pointer to member shall point to a type archetype cv T only 
12490: if the template has a concept requirement std::MemberPointeeType<T>. 
12491: [ Note: see also 5.3 and 5.5. The type ※pointer to member§ is distinct from the type ※pointer§, that is, a 
12492: pointer to member is declared only by the pointer to member declarator syntax, and never by the pointer 
12493: declarator syntax. There is no ※reference-to-member§ type in C++. 〞end note ] 
12494: 8.3.4 Arrays [dcl.array] 
12495: 1 In a declaration T D where D has the form 
12496: D1 [ constant-expressionopt ] attribute-specifieropt 
12497: and the type of the identifier in the declaration T D1 is ※derived-declarator-type-list T§, then the type of the 
12498: identifier of D is an array type; if the type of the identifier of D contains the auto type-specifier, the program 
12499: is ill-formed. T is called the array element type; this type shall not be a reference type, the (possibly cv-
12500: qualified) type void, a function type or an abstract class type. If the constant-expression (5.19) is present, 
12501: it shall be an integral constant expression and its value shall be greater than zero. The constant expression 
12502: specifies the bound of (number of elements in) the array. If the value of the constant expression is N, the 
12503: array has N elements numbered 0 to N-1, and the type of the identifier of D is ※derived-declarator-type-list 
12504: array of N T§. An object of array type contains a contiguously allocated non-empty set of N subobjects of 
12505: type T. If the constant expression is omitted, the type of the identifier of D is ※derived-declarator-type-list array 
12506: ∫ 8.3.4 180 
12507: 
12508: c
12509: . ISO/IEC N2800=08-0310 
12510: of unknown bound of T§, an incomplete effective object type. The type ※derived-declarator-type-list array of 
12511: N T§ is a different type from the type ※derived-declarator-type-list array of unknown bound of T§, see 3.9. Any 
12512: type of the form ※cv-qualifier-seq array of N T§ is adjusted to ※array of N cv-qualifier-seq T§, and similarly for 
12513: ※array of unknown bound of T§. The optional attribute-specifier appertains to the array. [ Example: 
12514: typedef int A[5], AA[2][3];
12515: typedef const A CA; // type is ※array of 5 const int§
12516: typedef const AA CAA; // type is ※array of 2 array of 3 const int§
12517: 〞end example ][ Note: an ※array of N cv-qualifier-seq T§ has cv-qualified type; see 3.9.3. 〞end note ] 
12518: 2 An array can be constructed from one of the fundamental types (except void), from a pointer, from a pointer 
12519: to member, from a class, from an enumeration type, or from another array. In a constrained context (14.10), 
12520: an array shall be constructed from a type archetype cv T only if the template has a concept requirement 
12521: std::ValueType<T>. 
12522: 3 When several ※array of§ specifications are adjacent, a multidimensional array is created; the constant ex-
12523: pressions that specify the bounds of the arrays can be omitted only for the first member of the sequence. 
12524: [ Note: this elision is useful for function parameters of array types, and when the array is external and the 
12525: definition, which allocates storage, is given elsewhere. 〞end note ] The first constant-expression can also 
12526: be omitted when the declarator is followed by an initializer (8.5). In this case the bound is calculated from 
12527: the number of initial elements (say, N) supplied (8.5.1), and the type of the identifier of D is ※array of N T.§ 
12528: 4 [ Example: 
12529: float fa[17], *afp[17]; 
12530: declares an array of float numbers and an array of pointers to float numbers. For another example, 
12531: static int x3d[3][5][7]; 
12532: declares a static three-dimensional array of integers, with rank 3 ℅ 5 ℅ 7. In complete detail, x3d is an array 
12533: of three items; each item is an array of five arrays; each of the latter arrays is an array of seven integers. Any 
12534: of the expressions x3d, x3d[i], x3d[i][j], x3d[i][j][k] can reasonably appear in an expression. 〞end 
12535: example ] 
12536: 5 [ Note: conversions affecting lvalues of array type are described in 4.2. Objects of array types cannot be 
12537: modified, see 3.10. 〞end note ] 
12538: 6 Except where it has been declared for a class (13.5.5), the subscript operator [] is interpreted in such a 
12539: way that E1[E2] is identical to *((E1)+(E2)). Because of the conversion rules that apply to +, if E1 is an 
12540: array and E2 an integer, then E1[E2] refers to the E2-th member of E1. Therefore, despite its asymmetric 
12541: appearance, subscripting is a commutative operation. 
12542: 7 A consistent rule is followed for multidimensional arrays. If E is an n-dimensional array of rank i ℅j ℅ . . . ℅ k, 
12543: then E appearing in an expression is converted to a pointer to an (n.1)-dimensional array with rank j℅. . .℅k. 
12544: If the * operator, either explicitly or implicitly as a result of subscripting, is applied to this pointer, the 
12545: result is the pointed-to (n . 1)-dimensional array, which itself is immediately converted into a pointer. 
12546: 8 [ Example: consider 
12547: int x[3][5]; 
12548: Here x is a 3 ℅ 5 array of integers. When x appears in an expression, it is converted to a pointer to (the 
12549: first of three) five-membered arrays of integers. In the expression x[i] which is equivalent to *(x+i), x is 
12550: first converted to a pointer as described; then x+i is converted to the type of x, which involves multiplying 
12551: i by the length of the object to which the pointer points, namely five integer objects. The results are added 
12552: ∫ 8.3.4 181 
12553: 
12554: c
12555: . ISO/IEC N2800=08-0310 
12556: and indirection applied to yield an array (of five integers), which in turn is converted to a pointer to the 
12557: first of the integers. If there is another subscript the same argument applies again; this time the result is an 
12558: integer. 〞end example ] 
12559: 9 [ Note: it follows from all this that arrays in C++ are stored row-wise (last subscript varies fastest) and that 
12560: the first subscript in the declaration helps determine the amount of storage consumed by an array but plays 
12561: no other part in subscript calculations. 〞 end note ] 
12562: 8.3.5 Functions [dcl.fct] 
12563: 1 In a declaration T D where D has the form 
12564: D1 ( parameter-declaration-clause ) attribute-specifieropt cv-qualifier-seqopt
12565: ref-qualifieropt exception-specificationopt
12566: and the type of the contained declarator-id in the declaration T D1 is ※derived-declarator-type-list T§, the 
12567: type of the declarator-id in D is ※derived-declarator-type-list function of (parameter-declaration-clause ) cv-qualifier-
12568: seqopt ref-qualifieropt returning T§. The optional attribute-specifier appertains to the function type. 
12569: 2 In a declaration T D where D has the form 
12570: D1 ( parameter-declaration-clause ) attribute-specifieropt cv-qualifier-seqopt
12571: ref-qualifieropt exception-specificationopt -> attribute-specifieropt type-id
12572: and the type of the contained declarator-id in the declaration T D1 is ※derived-declarator-type-list T§, T shall 
12573: be the single type-specifier auto. The type of the declarator-id in D is ※function of (parameter-declaration-
12574: clause) cv-qualifier-seqopt ref-qualifieropt returning type-id§. Such a function type has a late-specified return 
12575: type. The first optional attribute-specifier appertains to the function type. The second optional attribute-
12576: specifier appertains to the return type. 
12577: 3 The type-id in this form includes the longest possible sequence of abstract-declarators. [ Note: This resolves 
12578: the ambiguous binding of array and function declarators. [ Example: 
12579: auto f()->int(*)[4]; // function returning a pointer to array[4] of int
12580: // not function returning array[4] of pointer to int
12581: 〞end example ] 〞end note ] 
12582: 89
12583: 4 A type of either form is a function type.
12584: parameter-declaration-clause:
12585: parameter-declaration-listopt ...opt
12586: parameter-declaration-list , ...
12587: parameter-declaration-list:
12588: parameter-declaration
12589: parameter-declaration-list , parameter-declaration
12590: parameter-declaration:
12591: decl-specifier-seq attribute-specifieropt declarator
12592: decl-specifier-seq attribute-specifieropt declarator = assignment-expression
12593: decl-specifier-seq attribute-specifieropt abstract-declaratoropt
12594: decl-specifier-seq attribute-specifieropt abstract-declaratoropt = assignment-expression
12595: 5 The parameter-declaration-clause determines the arguments that can be specified, and their processing, when 
12596: the function is called. [ Note: the parameter-declaration-clause is used to convert the arguments specified 
12597: on the function call; see 5.2.2. 〞end note ] If the parameter-declaration-clause is empty, the function 
12598: takes no arguments. The parameter list (void) is equivalent to the empty parameter list. Except for this 
12599: special case, void shall not be a parameter type (though types derived from void, such as void*, can). 
12600: 89) As indicated by syntax, cv-qualifiers are a signficant component in function return types. 
12601: ∫ 8.3.5 182 
12602: 
12603: c
12604: . ISO/IEC N2800=08-0310 
12605: If the parameter-declaration-clause terminates with an ellipsis or a function parameter pack (14.5.3), the 
12606: number of arguments shall be equal to or greater than the number of parameters that do not have a default 
12607: argument and are not function parameter packs. Where syntactically correct and where ※...§ is not part of 
12608: an abstract-declarator, ※, ...§ is synonymous with ※...§. [ Example: the declaration 
12609: int printf(const char*, ...); 
12610: declares a function that can be called with varying numbers and types of arguments. 
12611: printf("hello world");
12612: printf("a=%d b=%d", a, b);
12613: However, the first argument must be of a type that can be converted to a const char* 〞end example ] 
12614: [ Note: the standard header <cstdarg> contains a mechanism for accessing arguments passed using the 
12615: ellipsis (see 5.2.2 and 18.9). 〞end note ] 
12616: 6 A single name can be used for several different functions in a single scope; this is function overloading 
12617: (Clause 13). All declarations for a function shall agree exactly in both the return type and the parameter-
12618: type-list. The type of a function is determined using the following rules. The type of each parameter 
12619: (including function parameter packs) is determined from its own decl-specifier-seq and declarator. After 
12620: determining the type of each parameter, any parameter of type ※array of T§ or ※function returning T§ is 
12621: adjusted to be ※pointer to T§ or ※pointer to function returning T,§ respectively. After producing the list 
12622: of parameter types, several transformations take place upon these types to determine the function type. 
12623: Any cv-qualifier modifying a parameter type is deleted. [ Example: the type void(*)(const int) becomes 
12624: void(*)(int) 〞end example ]Such cv-qualifiers affect only the definition of the parameter within the body 
12625: of the function; they do not affect the function type. If a storage-class-specifier modifies a parameter type, 
12626: the specifier is deleted. [ Example: register char* becomes char* 〞end example ] Such storage-class-
12627: specifiers affect only the definition of the parameter within the body of the function; they do not affect the 
12628: function type. The resulting list of transformed parameter types and the presence or absence of the ellipsis 
12629: or a function parameter pack is the function＊s parameter-type-list. 
12630: 7 A cv-qualifier-seq shall only be part of the function type for a non-static member function, the function type 
12631: to which a pointer to member refers, or the top-level function type of a function typedef declaration. The 
12632: effect of a cv-qualifier-seq in a function declarator is not the same as adding cv-qualification on top of the 
12633: function type. In the latter case, the cv-qualifiers are ignored. [ Example: 
12634: typedef void F();
12635: struct S {
12636: const F f; // OK: equivalent to: void f();
12637: };
12638: 〞end example ]A ref-qualifier shall only be part of the function type for a non-static member function, 
12639: the function type to which a pointer to member refers, or the top-level function type of a function typedef 
12640: declaration. The return type, the parameter-type-list, the ref-qualifier, and the cv-qualifier-seq, but not the 
12641: default arguments (8.3.6) or the exception specification (15.4), are part of the function type. [ Note: function 
12642: types are checked during the assignments and initializations of pointer-to-functions, reference-to-functions, 
12643: and pointer-to-member-functions. 〞end note ] 
12644: 8 [ Example: the declaration 
12645: int fseek(FILE*, long, int); 
12646: declares a function taking three arguments of the specified types, and returning int (7.1.6). 〞end example ] 
12647: ∫ 8.3.5 183 
12648: 
12649: c
12650: . ISO/IEC N2800=08-0310 
12651: 9 If the type of a parameter includes a type of the form ※pointer to array of unknown bound of T§ or ※reference 
12652: to array of unknown bound of T,§ the program is ill-formed.90 Functions shall not have a return type of 
12653: type array or function, although they may have a return type of type pointer or reference to such things. 
12654: There shall be no arrays of functions, although there can be arrays of pointers to functions. In a constrained 
12655: context (14.10), a type archetype cv T shall be used as the return type of a functon type if only the template 
12656: has a concept requirement std::Returnable<T>. 
12657: Types shall not be defined in return or parameter types. The type of a parameter or the return type for a 
12658: function definition shall not be an incomplete class type (possibly cv-qualified) unless the function definition 
12659: is nested within the member-specification for that class (including definitions in nested classes defined within 
12660: the class). 
12661: 10 A typedef of function type may be used to declare a function but shall not be used to define a function (8.4). 
12662: [ Example: 
12663: typedef void F();
12664: F fv;
12665: F fv { }
12666: void fv() { }
12667: // OK: equivalent to void fv();
12668: // ill-formed
12669: // OK: definition of fv
12670: 〞end example ] A typedef of a function type whose declarator includes a cv-qualifier-seq shall be used 
12671: only to declare the function type for a non-static member function, to declare the function type to which a 
12672: pointer to member refers, or to declare the top-level function type of another function typedef declaration. 
12673: [ Example: 
12674: typedef int FIC(int) const;
12675: FIC f; // ill-formed: does not declare a member function
12676: struct S {
12677: FIC f; // OK
12678: };
12679: FIC S::*pm = &S::f; // OK
12680: 〞end example ] 
12681: 11 An identifier can optionally be provided as a parameter name; if present in a function definition (8.4), it 
12682: names a parameter (sometimes called ※formal argument§). [ Note: in particular, parameter names are also 
12683: optional in function definitions and names used for a parameter in different declarations and the definition 
12684: of a function need not be the same. If a parameter name is present in a function declaration that is not a 
12685: definition, it cannot be used outside of the parameter-declaration-clause since it goes out of scope at the end 
12686: of the function declarator (3.3). 〞end note ] 
12687: 12 [ Example: the declaration 
12688: int i,
12689: *pi,
12690: f(),
12691: *fpi(int),
12692: (*pif)(const char*, const char*),
12693: (*fpif(int))(int);
12694: declares an integer i, a pointer pi to an integer, a function f taking no arguments and returning an integer, 
12695: a function fpi taking an integer argument and returning a pointer to an integer, a pointer pif to a function 
12696: 90) This excludes parameters of type ※ptr-arr-seq T2§ where T2 is ※pointer to array of unknown bound of T§ and where ptr-
12697: arr-seq means any sequence of ※pointer to§ and ※array of§ derived declarator types. This exclusion applies to the parameters 
12698: of the function, and if a parameter is a pointer to function or pointer to member function then to its parameters also, etc. 
12699: ∫ 8.3.5 184 
12700: 
12701: c
12702: . ISO/IEC N2800=08-0310 
12703: which takes two pointers to constant characters and returns an integer, a function fpif taking an integer 
12704: argument and returning a pointer to a function that takes an integer argument and returns an integer. It 
12705: is especially useful to compare fpi and pif. The binding of *fpi(int) is *(fpi(int)), so the declaration 
12706: suggests, and the same construction in an expression requires, the calling of a function fpi, and then using 
12707: indirection through the (pointer) result to yield an integer. In the declarator (*pif)(const char*, const 
12708: char*), the extra parentheses are necessary to indicate that indirection through a pointer to a function 
12709: yields a function, which is then called. 〞end example ][ Note: typedefs and late-specified return types are 
12710: sometimes convenient when the return type of a function is complex. For example, the function fpif above 
12711: could have been declared 
12712: typedef int IFUNC(int);
12713: IFUNC* fpif(int);
12714: or 
12715: auto fpif(int)->int(*)(int) 
12716: A late-specified return type is most useful for a type that would be more complicated to specify before the 
12717: declarator-id: 
12718: template <class T, class U> auto add(T t, U u) -> decltype(t + u); 
12719: rather than 
12720: template <class T, class U> decltype((*(T*)0) + (*(U*)0)) add(T t, U u); 
12721: 〞end note ] 
12722: 13 A declarator-id or abstract-declarator containing an ellipsis shall only be used in a parameter-declaration. 
12723: Such a parameter-declaration is a parameter pack (14.5.3). When it is part of a parameter-declaration-clause, 
12724: the parameter pack is a function parameter pack (14.5.3). [ Note: Otherwise, the parameter-declaration is 
12725: part of a template-parameter-list and the parameter pack is a template parameter pack; see 14.1. 〞end 
12726: note ] A function parameter pack, if present, shall occur at the end of the parameter-declaration-list. The 
12727: type T of the declarator-id of the function parameter pack shall contain a template parameter pack; each 
12728: template parameter pack in T is expanded by the function parameter pack. [ Example: 
12729: template<typename... T> void f(T (* ...t)(int, int); 
12730: int add(int, int);
12731: float subtract(int, int);
12732: void g() { 
12733: f(add, subtract);
12734: }
12735: 〞end example ] 
12736: 14 There is a syntactic ambiguity when an ellipsis occurs at the end of a parameter-declaration-clause without 
12737: a preceding comma. In this case, the ellipsis is parsed as part of the abstract-declarator if the type of the 
12738: ∫ 8.3.5 185 
12739: 
12740: c
12741: . ISO/IEC N2800=08-0310 
12742: parameter names a template parameter pack that has not been expanded; otherwise, it is parsed as part of 
12743: 91
12744: the parameter-declaration-clause.
12745: 8.3.6 Default arguments [dcl.fct.default] 
12746: 1 If an expression is specified in a parameter declaration this expression is used as a default argument. Default 
12747: arguments will be used in calls where trailing arguments are missing. 
12748: 2 [ Example: the declaration 
12749: void point(int = 3, int = 4); 
12750: declares a function that can be called with zero, one, or two arguments of type int. It can be called in any 
12751: of these ways: 
12752: point(1,2); point(1); point(); 
12753: The last two calls are equivalent to point(1,4) and point(3,4), respectively. 〞end example ] 
12754: 3 A default argument expression shall be specified only in the parameter-declaration-clause of a function 
12755: declaration or in a template-parameter (14.1). It shall not be specified for a parameter pack. If it is 
12756: specified in a parameter-declaration-clause, it shall not occur within a declarator or abstract-declarator of a 
12757: 92
12758: parameter-declaration.
12759: 4 For non-template functions, default arguments can be added in later declarations of a function in the 
12760: same scope. Declarations in different scopes have completely distinct sets of default arguments. That is, 
12761: declarations in inner scopes do not acquire default arguments from declarations in outer scopes, and vice 
12762: versa. In a given function declaration, all parameters subsequent to a parameter with a default argument 
12763: shall have default arguments supplied in this or previous declarations. A default argument shall not be 
12764: redefined by a later declaration (not even to the same value). [ Example: 
12765: void g(int = 0, ...); // OK, ellipsis is not a parameter so it can follow
12766: // a parameter with a default argument
12767: void f(int, int);
12768: void f(int, int = 7);
12769: void h() {
12770: f(3); // OK, calls f(3, 7)
12771: void f(int = 1, int); // error: does not use default
12772: // from surrounding scope
12773: } 
12774: void m() {
12775: void f(int, int); // has no defaults
12776: f(4); // error: wrong number of arguments
12777: void f(int, int = 5); // OK
12778: f(4); // OK, calls f(4, 5);
12779: void f(int, int = 5); // error: cannot redefine, even to
12780: // same value 
12781: }
12782: void n() {
12783: f(6); // OK, calls f(6, 7)
12784: }
12785: 91) One can explicitly disambiguate the parse either by introducing a comma (so the ellipsis will be parsed as part of the 
12786: parameter-declaration-clause) or by introducing a name for the parameter (so the ellipsis will be parsed as part of the declarator-
12787: id). 
12788: 92) This means that default arguments cannot appear, for example, in declarations of pointers to functions, references to 
12789: functions, or typedef declarations. 
12790: ∫ 8.3.6 186 
12791: 
12792: c
12793: . ISO/IEC N2800=08-0310 
12794: 〞end example ] For a given inline function defined in different translation units, the accumulated sets of 
12795: default arguments at the end of the translation units shall be the same; see 3.2. If a friend declaration specifies 
12796: a default argument expression, that declaration shall be a definition and shall be the only declaration of the 
12797: function or function template in the translation unit. 
12798: 5 A default argument expression is implicitly converted (Clause 4) to the parameter type. The default argu-
12799: ment expression has the same semantic constraints as the initializer expression in a declaration of a variable 
12800: of the parameter type, using the copy-initialization semantics (8.5). The names in the expression are bound, 
12801: and the semantic constraints are checked, at the point where the default argument expression appears. 
12802: Name lookup and checking of semantic constraints for default arguments in function templates and in mem-
12803: ber functions of class templates are performed as described in 14.7.1. [ Example: in the following code, g 
12804: will be called with the value f(2): 
12805: int a = 1;
12806: int f(int);
12807: int g(int x = f(a)); // default argument: f(::a)
12808: void h() {
12809: a = 2;
12810: {
12811: int a = 3;
12812: g(); // g(f(::a))
12813: }
12814: } 
12815: 〞end example ][ Note: in member function declarations, names in default argument expressions are looked 
12816: up as described in 3.4.1. Access checking applies to names in default argument expressions as described in 
12817: Clause 11. 〞end note ] 
12818: 6 Except for member functions of class templates, the default arguments in a member function definition that 
12819: appears outside of the class definition are added to the set of default arguments provided by the member 
12820: function declaration in the class definition. Default arguments for a member function of a class template 
12821: shall be specified on the initial declaration of the member function within the class template. [ Example: 
12822: class C {
12823: void f(int i = 3);
12824: void g(int i, int j = 99);
12825: }; 
12826: void C::f(int i = 3) { // error: default argument already
12827: } // specified in class scope
12828: void C::g(int i = 88, int j) { // in this translation unit,
12829: } // C::g can be called with no argument
12830: 〞end example ] 
12831: 7 Local variables shall not be used in default argument expressions. [ Example: 
12832: void f() {
12833: int i;
12834: extern void g(int x = i); //error
12835: // ...
12836: } 
12837: 〞end example ] 
12838: 8 The keyword this shall not be used in a default argument of a member function. [ Example: 
12839: ∫ 8.3.6 187 
12840: 
12841: c
12842: . ISO/IEC N2800=08-0310 
12843: class A {
12844: void f(A* p = this) { } // error
12845: };
12846: 〞end example ] 
12847: 9 Default arguments are evaluated each time the function is called. The order of evaluation of function 
12848: arguments is unspecified. Consequently, parameters of a function shall not be used in default argument 
12849: expressions, even if they are not evaluated. Parameters of a function declared before a default argument 
12850: expression are in scope and can hide namespace and class member names. [ Example: 
12851: int a;
12852: int f(int a, int b = a); // error: parameter a
12853: // used as default argument
12854: typedef int I;
12855: int g(float I, int b = I(2)); // error: parameter I found
12856: int h(int a, int b = sizeof(a)); // error, parameter a used
12857: // in default argument 
12858: 〞end example ] Similarly, a non-static member shall not be used in a default argument expression, even if it 
12859: is not evaluated, unless it appears as the id-expression of a class member access expression (5.2.5) or unless 
12860: it is used to form a pointer to member (5.3.1). [ Example: the declaration of X::mem1() in the following 
12861: example is ill-formed because no object is supplied for the non-static member X::a used as an initializer. 
12862: int b; 
12863: class X {
12864: int a;
12865: int mem1(int i = a); // error: non-static member a
12866: // used as default argument
12867: int mem2(int i = b); // OK; use X::b
12868: static int b;
12869: }; 
12870: The declaration of X::mem2() is meaningful, however, since no object is needed to access the static member 
12871: X::b. Classes, objects, and members are described in Clause 9. 〞end example ] A default argument is not 
12872: part of the type of a function. [ Example: 
12873: int f(int = 0); 
12874: void h() {
12875: int j = f(1);
12876: int k = f(); // OK, means f(0)
12877: } 
12878: int (*p1)(int) = &f;
12879: int (*p2)() = &f; // error: type mismatch
12880: 〞end example ] When a declaration of a function is introduced by way of a using-declaration (7.3.3), any 
12881: default argument information associated with the declaration is made known as well. If the function is 
12882: redeclared thereafter in the namespace with additional default arguments, the additional arguments are also 
12883: known at any point following the redeclaration where the using-declaration is in scope. 
12884: 10 A virtual function call (10.3) uses the default arguments in the declaration of the virtual function determined 
12885: by the static type of the pointer or reference denoting the object. An overriding function in a derived class 
12886: does not acquire default arguments from the function it overrides. [ Example: 
12887: ∫ 8.3.6 188 
12888: 
12889: . ISO/IEC N2800=08-0310 
12890: struct A { 
12891: virtual void f(int a = 7);
12892: };
12893: struct B : public A {
12894: void f(int a);
12895: };
12896: void m() {
12897: B* pb = new B;
12898: A* pa = pb;
12899: pa->f(); // OK, calls pa->B::f(7)
12900: pb->f(); // error: wrong number of arguments for B::f()
12901: } 
12902: 〞end example ] 
12903: 8.4 Function definitions 
12904: 1 Function definitions have the form 
12905: function-definition: 
12906: decl-specifier-seqopt attribute-specifieropt 
12907: decl-specifier-seqopt attribute-specifieropt 
12908: decl-specifier-seqopt attribute-specifieropt 
12909: function-body: 
12910: ctor-initializeropt compound-statement 
12911: function-try-block 
12912: [dcl.fct.def] 
12913: declarator function-body 
12914: declarator = default ; 
12915: declarator = delete ; 
12916: Any informal reference to the body of a function should be interpreted as a reference to the non-terminal 
12917: function-body. 
12918: 2 The declarator in a function-definition shall have the form 
12919: D1 ( parameter-declaration-clause ) cv-qualifier-seqopt ref-qualifieropt exception-specificationopt 
12920: as described in 8.3.5. A function shall be defined only in namespace or class scope. 
12921: 3 [ Example: a simple example of a complete function definition is 
12922: int max(int a, int b, int c) {
12923: int m = (a > b) ? a : b;
12924: return (m > c) ? m : c;
12925: } 
12926: Here int is the decl-specifier-seq; max(int a, int b, int c) is the declarator; { /*... */ } is the 
12927: function-body. 〞 end example ] 
12928: 4 A ctor-initializer is used only in a constructor; see 12.1 and 12.6. 
12929: 5 A cv-qualifier-seq or a ref-qualifier (or both) can be part of a non-static member function declaration, 
12930: non-static member function definition, or pointer to member function only (8.3.5); see 9.3.2. 
12931: 6 [ Note: unused parameters need not be named. For example, 
12932: void print(int a, int) {
12933: std::printf("a = %d\n",a);
12934: }
12935: 〞end note ] 
12936: ∫ 8.4 189 
12937: 
12938: c
12939: . ISO/IEC N2800=08-0310 
12940: 7 In the function-body, a function-local predefined variable denotes a local object of static storage duration 
12941: that is implicitly defined (see 3.3.2). 
12942: 8 The function-local predefined variable __func__ is defined as if a definition of the form 
12943: static const char __func__[] = "function-name"; 
12944: had been provided, where function-name is an implementation-defined string. It is unspecified whether such 
12945: a variable has an address distinct from that of any other object in the program.93 
12946: [ Example: 
12947: struct S {
12948: S() : s(__func__) { } // OK
12949: const char *s;
12950: };
12951: void f(const char * s = __func__); // error: __func__ is undeclared
12952: 〞end example ] 
12953: 9 A function definition of the form: 
12954: decl-specifier-seqopt attribute-specifieropt declarator = default ; 
12955: is called an explicitly-defaulted definition. Only special member functions may be explicitly defaulted, and 
12956: the implementation shall define them as if they had implicit definitions (12.1, 12.4, 12.8). A special member 
12957: function that would be implicitly defined as deleted shall not be explicitly defaulted. A special member 
12958: function is user-provided if it is user-declared and not explicitly defaulted on its first declaration. A user-
12959: provided explicitly-defaulted function is defined at the point where it is explicitly defaulted. [ Note: while 
12960: an implicitly-declared special member function is inline (Clause 12), an explicitly-defaulted definition may 
12961: be non-inline. Non-inline definitions are user-provided, and hence non-trivial (12.1, 12.4, 12.8). This rule 
12962: enables efficient execution and concise definition while enabling a stable binary interface to an evolving code 
12963: base. 〞 end note ][ Example: 
12964: struct trivial {
12965: trivial() = default;
12966: trivial(const trivial&) = default;
12967: trivial& operator =(const trivial&) = default;
12968: ~trivial() = default;
12969: }; 
12970: struct nontrivial1 { 
12971: nontrivial1();
12972: };
12973: nontrivial1::nontrivial1() = default; // not inline
12974: struct nontrivial2 { 
12975: nontrivial2();
12976: };
12977: inline nontrivial2::nontrivial2() = default; // not first declaration
12978: struct nontrivial3 { 
12979: virtual ~nontrivial3() = 0; // virtual
12980: };
12981: inline nontrivial3::~nontrivial3() = default; // not first declaration
12982: 93) Implementations are permitted to provide additional predefined variables with names that are reserved to the implemen-
12983: tation (17.6.4.3.3). If a predefined variable is not used (3.2), its string value need not be present in the program image. 
12984: ∫ 8.4 190 
12985: 
12986: c
12987: . ISO/IEC N2800=08-0310 
12988: 〞end example ] 
12989: 10 A function definition of the form: 
12990: decl-specifier-seqopt attribute-specifieropt declarator = delete ; 
12991: is called a deleted definition. A function with a deleted definition is also called a deleted function. A deleted 
12992: definition of a function shall be the first declaration of the function. [ Example: 
12993: struct sometype { 
12994: sometype(); 
12995: }; 
12996: sometype::sometype() = delete; // ill-formed; not first declaration 
12997: 〞end example ] A deleted function is implicitly inline. [ Note: the one-definition rule (3.2) applies to 
12998: deleted definitions. 〞end note ] A program that refers to a deleted function implicitly or explicitly, other 
12999: than to declare it, is ill-formed. [ Note: this includes calling the function implicitly or explicitly and forming 
13000: a pointer or pointer-to-member to the function. It applies even for references in expressions that are not 
13001: potentially-evaluated. If a function is overloaded, it is referenced only if the function is selected by overload 
13002: resolution. 〞 end note ][ Example: One can enforce non-default initialization and non-integral initialization 
13003: with 
13004: struct sometype {
13005: sometype() = delete; // redundant, but legal
13006: sometype(std::intmax_t) = delete;
13007: sometype(double);
13008: }; 
13009: 〞end example ][ Example: One can prevent use of a class in certain new expressions by using deleted 
13010: definitions of a user-declared operator new for that class. 
13011: struct sometype {
13012: void *operator new(std::size_t) = delete;
13013: void *operator new[](std::size_t) = delete;
13014: }; 
13015: sometype *p = new sometype; // error, deleted class operator new 
13016: sometype *p = new sometype[3]; // error, deleted class operator new[] 
13017: 〞end example ] 
13018: 8.5 Initializers [dcl.init] 
13019: 1 A declarator can specify an initial value for the identifier being declared. The identifier designates an object 
13020: or reference being initialized. The process of initialization described in the remainder of 8.5 applies also to 
13021: initializations specified by other syntactic contexts, such as the initialization of function parameters with 
13022: argument expressions (5.2.2) or the initialization of return values (6.6.3). 
13023: initializer:
13024: brace-or-equal-initializer
13025: ( expression-list )
13026: brace-or-equal-initializer:
13027: = initializer-clause
13028: braced-init-list
13029: initializer-clause:
13030: assignment-expression
13031: braced-init-list
13032: ∫ 8.5 191 
13033: 
13034: c
13035: . ISO/IEC N2800=08-0310 
13036: initializer-list:
13037: initializer-clause ...opt
13038: initializer-list , initializer-clause ...opt
13039: braced-init-list:
13040: { initializer-list ,opt }
13041: { }
13042: 2 Automatic, register, thread_local, static, and namespace-scoped external variables can be initialized by 
13043: arbitrary expressions involving literals and previously declared variables and functions. [ Example: 
13044: int f(int);
13045: int a = 2;
13046: int b = f(a);
13047: int c(b);
13048: 〞end example ] 
13049: 3 [ Note: default argument expressions are more restricted; see 8.3.6. 
13050: 4 The order of initialization of static objects is described in 3.6 and 6.7. 〞end note ] 
13051: 5 To zero-initialize an object or reference of type T means: 
13052: 〞 if T is a scalar type (3.9), the object is set to the value 0 (zero), taken as an integral constant expression, 
13053: 94
13054: converted to T;
13055: 〞 if T is a (possibly cv-qualified) non-union class type, each non-static data member and each base-class 
13056: subobject is zero-initialized; 
13057: 〞 if T is a (possibly cv-qualified) union type, the object＊s first non-static named data member is zero-
13058: initialized; 
13059: 〞 if T is an array type, each element is zero-initialized; 
13060: 〞 if T is a reference type, no initialization is performed. 
13061: 6 To default-initialize an object of type T means: 
13062: 〞 if T is a (possibly cv-qualified) class type (Clause 9), the default constructor for T is called (and the 
13063: initialization is ill-formed if T has no accessible default constructor); 
13064: 〞 if T is an array type, each element is default-initialized; 
13065: 〞 otherwise, no initialization is performed. 
13066: If a program calls for the default initialization of an object of a const-qualified type T, T shall be a class type 
13067: with a user-provided default constructor. 
13068: 7 To value-initialize an object of type T means: 
13069: 〞 if T is a (possibly cv-qualified) class type (Clause 9) with a user-provided constructor (12.1), then the 
13070: default constructor for T is called (and the initialization is ill-formed if T has no accessible default 
13071: constructor); 
13072: 〞 if T is a (possibly cv-qualified) non-union class type without a user-provided constructor, then the object 
13073: is zero-initialized and, if T＊s implicitly-declared default constructor is non-trivial, that constructor is 
13074: called. 
13075: 〞 if T is an array type, then each element is value-initialized; 
13076: 94) As specified in 4.10, converting an integral constant expression whose value is 0 to a pointer type results in a null pointer 
13077: value. 
13078: ∫ 8.5 192 
13079: 
13080: c
13081: . ISO/IEC N2800=08-0310 
13082: 〞 otherwise, the object is zero-initialized. 
13083: 8 A program that calls for default-initialization or value-initialization of an entity of reference type isill-formed. 
13084: 9 [ Note: Every object of static storage duration is zero-initialized at program startup before any other initial-
13085: ization takes place. in some cases, additional initialization is done later. 〞end note ] 
13086: 10 An object whose initializer is an empty set of parentheses, i.e., (), shall be value-initialized. 
13087: [ Note: since () is not permitted by the syntax for initializer, 
13088: X a(); 
13089: is not the declaration of an object of class X, but the declaration of a function taking no argument and 
13090: returning an X. The form () is permitted in certain other initialization contexts (5.3.4, 5.2.3, 12.6.2). 〞end 
13091: note ] 
13092: 11 If no initializer is specified for an object, the object is default-initialized; if no initialization is performed, a 
13093: non-static object has indeterminate value. [ Note: objects with static storage duration are zero-initialized, 
13094: see 3.6.2 〞end note ]. 
13095: 12 An initializer for a static member is in the scope of the member＊s class. [ Example: 
13096: int a; 
13097: struct X {
13098: static int a;
13099: static int b;
13100: }; 
13101: int X::a = 1;
13102: int X::b = a; // X::b = X::a
13103: 〞end example ] 
13104: 13 The form of initialization (using parentheses or =) is generally insignificant, but does matter when the 
13105: initializer or the entity being initialized has a class type; see below. A parenthesized initializer can be a list 
13106: of expressions only when the entity being initialized has a class type. 
13107: 14 The initialization that occurs in the form 
13108: T x = a; 
13109: as well as in argument passing, function return, throwing an exception (15.1), handling an exception (15.3), 
13110: and aggregate member initialization (8.5.1) is called copy-initialization. 
13111: 15 The initialization that occurs in in the forms 
13112: T x(a);
13113: T x{a};
13114: as well as in new expressions (5.3.4), static_cast expressions (5.2.9), functional notation type conversions 
13115: (5.2.3), and base and member initializers (12.6.2) is called direct-initialization. 
13116: 16 The semantics of initializers are as follows. The destination type is the type of the object or reference being 
13117: initialized and the source type is the type of the initializer expression. The source type is not defined when 
13118: the initializer is a braced-init-list or when it is a parenthesized list of expressions. 
13119: 〞 If the destination type is a reference type, see 8.5.3. 
13120: ∫ 8.5 193 
13121: 
13122: c
13123: . ISO/IEC N2800=08-0310 
13124: 〞 If the destination type is an array of characters, an array of char16_t, an array of char32_t, or an 
13125: array of wchar_t, and the initializer is a string literal, see 8.5.2. 
13126: 〞 If the initializer is a braced-init-list, the object is list-initialized (8.5.4). 
13127: 〞 If the initializer is (), the object is value-initialized. 
13128: 〞 Otherwise, if the destination type is an array, the program is ill-formed. 
13129: 〞 If the destination type is a (possibly cv-qualified) class type: 
13130: 〞 If the initialization is direct-initialization, or if it is copy-initialization where the cv-unqualified 
13131: version of the source type is the same class as, or a derived class of, the class of the destination, 
13132: constructors are considered. The applicable constructors are enumerated (13.3.1.3), and the best 
13133: one is chosen through overload resolution (13.3). The constructor so selected is called to initialize 
13134: the object, with the initializer expression(s) as its argument(s). If no constructor applies, or the 
13135: overload resolution is ambiguous, the initialization is ill-formed. 
13136: 〞 Otherwise (i.e., for the remaining copy-initialization cases), user-defined conversion sequences 
13137: that can convert from the source type to the destination type or (when a conversion function 
13138: is used) to a derived class thereof are enumerated as described in 13.3.1.4, and the best one is 
13139: chosen through overload resolution (13.3). If the conversion cannot be done or is ambiguous, the 
13140: initialization is ill-formed. The function selected is called with the initializer expression as its 
13141: argument; if the function is a constructor, the call initializes a temporary of the cv-unqualified 
13142: version of the destination type. The temporary is an rvalue. The result of the call (which is the 
13143: temporary for the constructor case) is then used to direct-initialize, according to the rules above, 
13144: the object that is the destination of the copy-initialization. In certain cases, an implementation 
13145: is permitted to eliminate the copying inherent in this direct-initialization by constructing the 
13146: intermediate result directly into the object being initialized; see 12.2, 12.8. 
13147: 〞 Otherwise, if the source type is a (possibly cv-qualified) class type, conversion functions are considered. 
13148: The applicable conversion functions are enumerated (13.3.1.5), and the best one is chosen through 
13149: overload resolution (13.3). The user-defined conversion so selected is called to convert the initializer 
13150: expression into the object being initialized. If the conversion cannot be done or is ambiguous, the 
13151: initialization is ill-formed. 
13152: 〞 Otherwise, the initial value of the object being initialized is the (possibly converted) value of the ini-
13153: tializer expression. Standard conversions (Clause 4) will be used, if necessary, to convert the initializer 
13154: expression to the cv-unqualified version of the destination type; no user-defined conversions are con-
13155: sidered. If the conversion cannot be done, the initialization is ill-formed. [ Note: an expression of type 
13156: ※cv1 T§ can initialize an object of type ※cv2 T§ independently of the cv-qualifiers cv1 and cv2. 
13157: int a;
13158: const int b = a;
13159: int c = b;
13160: 〞end note ] 
13161: 17 An initializer-clause followed by an ellipsis is a pack expansion (14.5.3). 
13162: 8.5.1 Aggregates [dcl.init.aggr] 
13163: 1 An aggregate is an array or a class (Clause 9) with no user-provided constructors (12.1), no private or 
13164: protected non-static data members (Clause 11), no base classes (Clause 10), and no virtual functions (10.3). 
13165: ∫ 8.5.1 194 
13166: 
13167: c
13168: . ISO/IEC N2800=08-0310 
13169: 2 When an aggregate is initialized by an initializer list, as specified in 8.5.4, the elements of the initializer list 
13170: are taken as initializers for the members of the aggregate, in increasing subscript or member order. Each 
13171: member is copy-initialized from the corresponding initializer-clause. If the initializer-clause is an expression 
13172: and a narrowing conversion (8.5.4) is required to convert the expression, the program is ill-formed. [ Note: 
13173: If an initializer-clause is itself an initializer list, the member is list-initialized, which will result in a recursive 
13174: application of the rules in this section if the member is an aggregate. 〞end note ][ Example: 
13175: struct A {
13176: int x;
13177: struct B {
13178: int i;
13179: int j;
13180: } b;
13181: } a = { 1, { 2, 3 } };
13182: initializes a.x with 1, a.b.i with 2, a.b.j with 3. 〞 end example ] 
13183: 3 An aggregate that is a class can also beinitialized with a single expression not enclosed in braces, as described 
13184: in 8.5. 
13185: 4 An array of unknown size initialized with a brace-enclosed initializer-list containing n initializer-clauses, 
13186: where n shall be greater than zero, is defined as having n elements (8.3.4). [ Example: 
13187: int x[] = { 1, 3, 5 }; 
13188: declares and initializes x as a one-dimensional array that has three elements since no size was specified and 
13189: there are three initializers. 〞end example ] An empty initializer list {} shall not be used as the initializer-
13190: clause for an array of unknown bound.95 
13191: 5 Static data members and anonymous bit fields are not considered members of the class for purposes of 
13192: aggregate initialization. 
13193: struct A {
13194: int i;
13195: static int s;
13196: int j;
13197: int :17;
13198: int k;
13199: } a = { 1, 2, 3 }; 
13200: [ Example: 
13201: Here, the second initializer 2 initializes a.j and not the static data member A::s, and the third initializer 
13202: 3 initializes a.k and not the anonymous bit field before it. 〞end example ] 
13203: 6 An initializer-list is ill-formed if the number of initializer-clauses exceeds the number of members or elements 
13204: to initialize. [ Example: 
13205: char cv[4] = { ＊a＊, ＊s＊, ＊d＊, ＊f＊, 0 }; // error 
13206: is ill-formed. 〞end example ] 
13207: 7 If there are fewer initializer-clauses in the list than there are members in the aggregate, then each member 
13208: not explicitly initialized shall be value-initialized (8.5). [ Example: 
13209: struct S { int a; char* b; int c; };
13210: S ss = { 1, "asdf" };
13211: 95) The syntax provides for empty initializer-lists, but nonetheless C++ does not have zero length arrays. 
13212: ∫ 8.5.1 195 
13213: 
13214: c
13215: . ISO/IEC N2800=08-0310 
13216: initializes ss.a with 1, ss.b with "asdf", and ss.c with the value of an expression of the form int(), that 
13217: is, 0. 〞end example ] 
13218: 8 If an aggregate class C contains a subaggregate member m that has no members for purposes of aggregate 
13219: initialization, the initializer-clause for m shall not be omitted from an initializer-list for an object of type C 
13220: unless the initializer-clauses for all members of C following m are also omitted. [ Example: 
13221: struct S { } s; 
13222: struct A {
13223: S s1;
13224: int i1;
13225: S s2;
13226: int i2;
13227: S s3;
13228: int i3;
13229: }a={
13230: { }, // Required initialization
13231: 0,
13232: s, // Required initialization
13233: 0
13234: }; // Initialization not required for A::s3 because A::i3 is also not initialized 
13235: 〞end example ] 
13236: 9 If an incomplete or empty initializer-list leaves a member of reference type uninitialized, the program is 
13237: ill-formed. 
13238: 10 When initializing a multi-dimensional array, the initializer-clauses initialize the elements with the last (right-
13239: most) index of the array varying the fastest (8.3.4). [ Example: 
13240: int x[2][2] = { 3, 1, 4, 2 }; 
13241: initializes x[0][0] to 3, x[0][1] to 1, x[1][0] to 4, and x[1][1] to 2. On the other hand, 
13242: float y[4][3] = {
13243: { 1 }, { 2 }, { 3 }, { 4 }
13244: };
13245: initializes the first column of y (regarded as a two-dimensional array) and leaves the rest zero. 〞end 
13246: example ] 
13247: 11 In a declaration of the form 
13248: T x = { a }; 
13249: braces can be elided in an initializer-list as follows.96 If the initializer-list begins with a left brace, then 
13250: the succeeding comma-separated list of initializer-clauses initializes the members of a subaggregate; it is 
13251: erroneous for there to be more initializer-clauses than members. If, however, the initializer-list for a sub-
13252: aggregate does not begin with a left brace, then only enough initializer-clauses from the list are taken to 
13253: initialize the members of the subaggregate; any remaining initializer-clauses are left to initialize the next 
13254: member of the aggregate of which the current subaggregate is a member. [ Example: 
13255: float y[4][3] = {
13256: { 1, 3, 5 },
13257: { 2, 4, 6 },
13258: { 3, 5, 7 },
13259: }; 
13260: 96) Braces cannot be elided in other uses of list-initialization. 
13261: ∫ 8.5.1 196 
13262: 
13263: c
13264: . ISO/IEC N2800=08-0310 
13265: is a completely-braced initialization: 1, 3, and 5 initialize the first row of the array y[0], namely y[0][0], 
13266: y[0][1], and y[0][2]. Likewise the next two lines initialize y[1] and y[2]. The initializer ends early and 
13267: therefore y[3]s elements are initialized as if explicitly initialized with an expression of the form float(), 
13268: that is, are initialized with 0.0. In the following example, braces in the initializer-list are elided; however 
13269: the initializer-list has the same effect as the completely-braced initializer-list of the above example, 
13270: float y[4][3] = {
13271: 1, 3, 5, 2, 4, 6, 3, 5, 7
13272: };
13273: The initializer for y begins with a left brace, but the one for y[0] does not, therefore three elements from 
13274: the list are used. Likewise the next three are taken successively for y[1] and y[2]. 〞end example ] 
13275: 12 All implicit type conversions (Clause 4) are considered when initializing the aggregate member with an 
13276: assignment-expression. If the assignment-expression can initialize a member, the member is initialized. 
13277: Otherwise, if the member is itself a subaggregate, brace elision is assumed and the assignment-expression 
13278: is considered for the initialization of the first member of the subaggregate. [ Note: As specified above, 
13279: brace elision cannot apply to subaggregates with no members for purposes of aggregate initialization; an 
13280: initializer-clause for the entire subobject is required. 〞end note ] 
13281: [ Example: 
13282: struct A {
13283: int i;
13284: operator int();
13285: }; 
13286: struct B {
13287: A a1, a2;
13288: int z;
13289: };
13290: A a;
13291: B b = { 4, a, a };
13292: Braces are elided around the initializer-clause for b.a1.i. b.a1.i is initialized with 4, b.a2 is initialized 
13293: with a, b.z is initialized with whatever a.operator int() returns. 〞 end example ] 
13294: 13 [ Note: An aggregate array or an aggregate class may contain members of a class type with a user-provided 
13295: constructor (12.1). Initialization of these aggregate objects is described in 12.6.1. 〞 end note ] 
13296: 14 [ Note: Whether the initialization of aggregates with static storage duration is static or dynamic is specified 
13297: in 3.6.2 and 6.7. 〞end note ] 
13298: 15 When a union is initialized with a brace-enclosed initializer, the braces shall only contain an initializer-clause 
13299: for the first member of the union. [ Example: 
13300: union u { int a; char* b; };
13301: u a = { 1 };
13302: u b = a;
13303: u c = 1; // error
13304: u d = { 0, "asdf" }; // error
13305: u e = { "asdf" }; // error
13306: 〞end example ] 
13307: 16 [ Note: As described above, the braces around the initializer-clause for a union member can be omitted if 
13308: the union is a member of another aggregate. 〞end note ] 
13309: ∫ 8.5.1 197 
13310: 
13311: c
13312: . ISO/IEC N2800=08-0310 
13313: 17 The full-expressions in an initializer-clause are evaluated in the order in which they appear. 
13314: 8.5.2 Character arrays [dcl.init.string] 
13315: 1 A char array (whether plain char, signed char, or unsigned char), char16_t array, char32_t array, or 
13316: wchar_t array can be initialized by a string-literal (optionally enclosed in braces) with no prefix, with a u 
13317: prefix, with a U prefix, or with an L prefix, respectively; successive characters of the string-literal initialize 
13318: the members of the array. [ Example: 
13319: char msg[] = "Syntax error on line %s\n"; 
13320: shows a character array whose members are initialized with a string-literal. Note that because ＊\n＊ is a 
13321: single character and because a trailing ＊\0＊ is appended, sizeof(msg) is 25. 〞 end example ] 
13322: 2 There shall not be more initializers than there are array elements. [ Example: 
13323: char cv[4] = "asdf"; // error 
13324: is ill-formed since there is no space for the implied trailing ＊\0＊. 〞 end example ] 
13325: 8.5.3 References [dcl.init.ref] 
13326: 1 A variable declared to be a T& or T&&, that is, ※reference to type T§ (8.3.2), shall be initialized by an object, 
13327: or function, of type T or by an object that can be converted into a T.[ Example: 
13328: int g(int); 
13329: void f() {
13330: int i;
13331: int& r = i; // r refers to i
13332: r = 1; // the value of i becomes 1
13333: int* p = &r; // p points to i
13334: int& rr = r; // rr refers to what r refers to, that is, to i
13335: int (&rg)(int) = g; // rg refers to the function g
13336: rg(i); // calls function g
13337: int a[3];
13338: int (&ra)[3] = a; // ra refers to the array a
13339: ra[1] = i; // modifies a[1]
13340: } 
13341: 〞end example ] 
13342: 2 A reference cannot be changed to refer to another object after initialization. Note that initialization of a 
13343: reference is treated very differently from assignment to it. Argument passing (5.2.2) and function value 
13344: return (6.6.3) are initializations. 
13345: 3 The initializer can be omitted for a reference only in a parameter declaration (8.3.5), in the declaration of 
13346: a function return type, in the declaration of a class member within its class definition (9.2), and where the 
13347: extern specifier is explicitly used. [ Example: 
13348: int& r1; // error: initializer missing
13349: extern int& r2; // OK
13350: 〞end example ] 
13351: 4 Given types ※cv1 T1§ and ※cv2 T2,§ ※cv1 T1§ is reference-related to ※cv2 T2§ if T1 is the same type as T2, or 
13352: T1 is a base class of T2. ※cv1 T1§ is reference-compatible with ※cv2 T2§ if T1 is reference-related to T2 and cv1 
13353: is the same cv-qualification as, or greater cv-qualification than, cv2. For purposes of overload resolution, 
13354: ∫ 8.5.3 198 
13355: 
13356: c
13357: . ISO/IEC N2800=08-0310 
13358: cases for which cv1 is greater cv-qualification than cv2 are identified as reference-compatible with added 
13359: qualification (see 13.3.3.2). In all cases where the reference-related or reference-compatible relationship of 
13360: two types is used to establish the validity of a reference binding, and T1 is a base class of T2, a program 
13361: that necessitates such a binding is ill-formed if T1 is an inaccessible (Clause 11) or ambiguous (10.2) base 
13362: class of T2. 
13363: 5 A reference to type ※cv1 T1§ is initialized by an expression of type ※cv2 T2§ as follows: 
13364: 〞 If the initializer expression 
13365: 〞 is an lvalue (but is not a bit-field), and ※cv1 T1§ is reference-compatible with ※cv2 T2,§ or 
13366: 〞 has a class type (i.e., T2 is a class type) and can be implicitly converted to an lvalue of type 
13367: ※cv3 T3,§ where ※cv1 T1§ is reference-compatible with ※cv3 T3§97 (this conversion is selected by 
13368: enumerating the applicable conversion functions (13.3.1.6) and choosing the best one through 
13369: overload resolution (13.3)), 
13370: then the reference is bound directly to the initializer expression lvalue in the first case, and the reference 
13371: is bound to the lvalue result of the conversion in the second case. In these cases the reference is said 
13372: to bind directly to the initializer expression. [ Note: the usual lvalue-to-rvalue (4.1), array-to-pointer 
13373: (4.2), and function-to-pointer (4.3) standard conversions are not needed, and therefore are suppressed, 
13374: when such direct bindings to lvalues are done. 〞end note ] 
13375: [ Example: 
13376: double d = 2.0;
13377: double& rd = d; // rd refers to d
13378: const double& rcd = d; // rcd refers to d
13379: struct A { };
13380: struct B : A { } b;
13381: A& ra = b; // ra refers to A subobject in b
13382: const A& rca = b; // rca refers to A subobject in b
13383: 〞end example ] 
13384: 〞 Otherwise, the reference shall be an lvalue reference to a non-volatile const type (i.e., cv1 shall be 
13385: const), or shall be an rvalue reference. [ Example: 
13386: double& rd2 = 2.0; // error: not an lvalue and reference not const 
13387: int i=2; 
13388: double& rd3 = i; // error: type mismatch and reference not const 
13389: double&& rd4 = i; // OK: reference bound to temporary double 
13390: 〞end example ] 
13391: 〞 If the initializer expression is an rvalue, with T2 a class type, and ※cv1 T1§ is reference-compatible 
13392: with ※cv2 T2,§ the reference is bound to the object represented by the rvalue (see 3.10) or to a 
13393: sub-object within that object. 
13394: [ Example: 
13395: struct A { };
13396: struct B : A { } b;
13397: extern B f();
13398: const A& rca = f(); // Bound to the A subobject of the B rvalue.
13399: A&& rcb = f(); // Same as above
13400: 97) This requires a conversion function (12.3.2) returning a reference type. 
13401: ∫ 8.5.3 199 
13402: 
13403: c
13404: . ISO/IEC N2800=08-0310 
13405: 〞end example ] 
13406: 〞 If the initializer expression is an rvalue, with T2 an array type, and ※cv1 T1§ is reference-compatible 
13407: with ※cv2 T2,§ the reference is bound to the object represented by the rvalue (see 3.10). 
13408: 〞 Otherwise, a temporary of type ※cv1 T1§ is created and initialized from the initializer expression 
13409: using the rules for a non-reference copy initialization (8.5). The reference is then bound to the 
13410: temporary. If T1 is reference-related to T2, cv1 must be the same cv-qualification as, or greater 
13411: cv-qualification than, cv2; otherwise, the program is ill-formed. [ Example: 
13412: const double& rcd2 = 2;
13413: double&& rcd3 = 2;
13414: const volatile int cvi = 1;
13415: const int& r = cvi;
13416: // rcd2 refers to temporary with value 2.0 
13417: // rcd3 refers to temporary with value 2.0 
13418: // error: type qualifiers dropped 
13419: 〞end example ] 
13420: 6 [ Note: 12.2 describes the lifetime of temporaries bound to references. 〞end note ] 
13421: 8.5.4 List-initialization [dcl.init.list] 
13422: 1 List-initialization is initialization of an object or reference from a braced-init-list. Such an initializer is 
13423: called an initializer list, and the comma-separated initializer-clauses of the list are called the elements of the 
13424: initializer list. An initializer list may be empty. List-initialization can occur in direct-initialization or copy-
13425: initialization contexts; list-initialization in a direct-initialization context is called direct-list-initialization and 
13426: list-initialization in a copy-initialization context is called copy-list-initialization.[ Note: List-initialization 
13427: can be used 
13428: 〞 as the initializer in a variable definition (8.5) 
13429: 〞 as the initializer in a new expression (5.3.4) 
13430: 〞 in a return statement (6.6.3) 
13431: 〞 as a function argument (5.2.2) 
13432: 〞 as a subscript (5.2.1) 
13433: 〞 as an argument to a constructor invocation (8.5, 5.2.3) 
13434: 〞 as an initializer for a non-static data member (9.2) 
13435: 〞 as a base-or-member initializer (12.6.2) 
13436: 〞 on the right-hand side of an assignment (5.17)
13437: [ Example:
13438: int a = {1};
13439: std::complex<double> z{1,2};
13440: new std::vector<std::string>{"once", "upon", "a", "time"}; // 4 string elements
13441: f( {"Nicholas","Annemarie"} ); // pass list of two elements
13442: return { "Norah" }; // return list of one element
13443: int* e {}; // initialization to zero / null pointer
13444: x = double{1}; // explicitly construct a double
13445: std::map<std::string,int> anim = { {"bear",4}, {"cassowary",2}, {"tiger",7} };
13446: 〞end example ] 〞end note ] 
13447: ∫ 8.5.4 200 
13448: 
13449: c
13450: . ISO/IEC N2800=08-0310 
13451: 2 A constructor is an initializer-list constructor if its first parameter is of type std::initializer_list<E> 
13452: or reference to possibly cv-qualified std::initializer_list<E> for some type E, and either there are 
13453: no other parameters or else all other parameters have default arguments (8.3.6). [ Note: Initializer-list 
13454: constructors are favored over other constructors in list-initialization (13.3.1.7). 〞end note ] The template 
13455: std::initializer_list is not predefined; if the header <initializer_list> is not included prior to a use 
13456: of std::initializer_list 〞 even an implicit use in which the type is not named (7.1.6.4) 〞 the program 
13457: is ill-formed. 
13458: 3 List-initialization of an object or reference of type T is defined as follows: 
13459: 〞 If T is an aggregate, aggregate initialization is performed (8.5.1).
13460: [ Example:
13461: double ad[] = { 1, 2.0 }; // OK
13462: int ai[] = { 1, 2.0 }; // error: narrowing
13463: 〞end example ] 
13464: 〞 Otherwise, if T is a specialization of std::initializer_list<E>, an initializer_list object is 
13465: constructed as described below and used to initialize the object according to the rules for initialization 
13466: of an object from a class of the same type (8.5). 
13467: 〞 Otherwise, if T is a class type, constructors are considered. If T has an initializer-list constructor, the 
13468: argument list consists of the initializer list as a single argument; otherwise, the argument list consists 
13469: of the elements of the initializer list. The applicable constructors are enumerated (13.3.1.7) and the 
13470: best one is chosen through overload resolution (13.3). If a narrowing conversion (see below) is required 
13471: to convert any of the arguments, the program is ill-formed. 
13472: [ Example: 
13473: struct S {
13474: S(std::initializer_list<double>); // #1
13475: S(std::initializer_list<int>); // #2
13476: // ...
13477: }; 
13478: S s1 = { 1.0, 2.0, 3.0 }; // invoke #1 
13479: S s2 = { 1, 2, 3 }; // invoke #2 
13480: 〞end example ]
13481: [ Example:
13482: struct Map { 
13483: Map(std::initializer_list<std::pair<std::string,int>>); 
13484: }; 
13485: Map ship = {{"Sophie",14}, {"Surprise",28}}; 
13486: 〞end example ]
13487: [ Example:
13488: struct S { 
13489: // no initializer-list constructors
13490: S(int, double, double); // #1
13491: S(); // #2
13492: // ...
13493: }; 
13494: ∫ 8.5.4 201 
13495: 
13496: c
13497: . ISO/IEC N2800=08-0310 
13498: S s1 = { 1, 2, 3.0 }; // OK: invoke #1
13499: S s2 { 1.0, 2, 3 }; // error: narrowing
13500: S s3 { }; // OK: invoke #2
13501: struct S2 {
13502: int m1;
13503: double m2,m3;
13504: };
13505: S2 s21 = { 1, 2, 3.0 }; // OK
13506: S2 s22 { 1.0, 2, 3 }; // error: narrowing
13507: S2 s23 {}; // OK: default to 0,0,0
13508: 〞end example ] 
13509: 〞 Otherwise, if T is a reference type, an rvalue temporary of the type referenced by T is list-initialized, 
13510: and the reference is bound to that temporary. [ Note: As usual, the binding will fail and the program 
13511: is ill-formed if the reference type is an lvalue reference to a non-const type. 〞end note ] 
13512: [ Example: 
13513: struct S {
13514: S(std::initializer_list<double>); // #1
13515: S(const std::string&); // #2
13516: // ...
13517: };
13518: const S& r1 = { 1, 2, 3.0 };
13519: const S& r2 { "Spinach" };
13520: S& r3 = { 1, 2, 3 };
13521: // OK: invoke #1 
13522: // OK: invoke #2 
13523: // error: initializer is not an lvalue 
13524: 〞end example ] 
13525: 〞 Otherwise (i.e., if T is not an aggregate, class type, or reference), if the initializer list has a single 
13526: element, the object is initialized from that element; if a narrowing conversion (see below) is required 
13527: to convert the element to T, the program is ill-formed. 
13528: [ Example: 
13529: int x1 {2}; // OK
13530: int x2 {2.0}; // error: narrowing
13531: 〞end example ] 
13532: 〞 Otherwise, if the initializer list has no elements, the object is value-initialized.
13533: [ Example:
13534: int** pp {}; // initialized to null pointer 
13535: 〞end example ] 
13536: 〞 Otherwise, the program is ill-formed.
13537: [ Example:
13538: struct A { int i; int j; };
13539: A a1 { 1, 2 }; // aggregate initialization
13540: A a2 { 1.2 }; // error: narrowing
13541: struct B {
13542: B(std::initializer_list<int>); 
13543: ∫ 8.5.4 202 
13544: 
13545: c
13546: . ISO/IEC N2800=08-0310 
13547: }; 
13548: B b1 { 1, 2 }; // creates initializer_list<int> and calls constructor 
13549: B b2 { 1, 2.0 }; // error: narrowing 
13550: struct C { 
13551: C(int i, double j); 
13552: }; 
13553: C c1 = { 1, 2.2 }; // calls constructor with arguments (1, 2.2) 
13554: C c2 = { 1.1, 2 }; // error: narrowing 
13555: int j { 1 }; // initialize to 1
13556: int k { }; // initialize to 0
13557: 〞end example ] 
13558: 4 When an initializer list is implicitly converted to a std::initializer_list<E>, the object passed is con-
13559: structed as if the implementation allocated an array of N elements of type E, where N is the number of 
13560: elements in the initializer list. Each element of that array is initialized with the corresponding element of the 
13561: initializer list converted to E, and the std::initializer_list<E> object is constructed to refer to that array. 
13562: If a narrowing conversion is required to convert the element to E, the program is ill-formed.[ Example: 
13563: struct X { 
13564: X(std::initializer_list<double> v);
13565: };
13566: X x{ 1,2,3 };
13567: The initialization will be implemented in a way roughly equivalent to this: 
13568: double __a[3] = {double{1}, double{2}, double{3}};
13569: X x(std::initializer_list<double>(__a, __a+3));
13570: assuming that theimplementation can construct an initializer_list object with a pair of pointers. 〞end 
13571: example ] 
13572: 5 The lifetime of the array is the same as that of the initializer_list object. [ Example: 
13573: typedef std::complex<double> cmplx;
13574: std::vector<cmplx> v1 = { 1, 2, 3 };
13575: void f() {
13576: std::vector<cmplx> v2{ 1, 2, 3 };
13577: std::initializer_list<int> i3 = { 1, 2, 3 };
13578: } 
13579: For v1 and v2, the initializer_list object and array created for { 1, 2, 3 } have full-expression lifetime. 
13580: For i3, the initializer_list object and array have automatic lifetime. 〞 end example ][ Note: The 
13581: implementation is free to allocate the array in read-only memory if an explicit array with the same initializer 
13582: could be so allocated. 〞 end note ] 
13583: 6 A narrowing conversion is an implicit conversion 
13584: 〞 from a floating-point type to an integer type, or 
13585: 〞 from long double to double or float, or from double to float, except where the source is a constant 
13586: expression and the actual value after conversion will fit into the target type and will produce the original 
13587: value when converted back to the original type, or 
13588: ∫ 8.5.4 203 
13589: 
13590: c
13591: . ISO/IEC N2800=08-0310 
13592: 〞 from an integer type or unscoped enumeration type to a floating-point type, except where the source 
13593: is a constant expression and the actual value after conversion will fit into the target type and will 
13594: produce the original value when converted back to the original type, or 
13595: 〞 from an integer type or unscoped enumeration type to an integer type that cannot represent all the 
13596: values of the original type, except where the source is a constant expression and the actual value after 
13597: conversion will fit into the target type and will produce the original value when converted back to the 
13598: original type. 
13599: [ Note: As indicated above, such conversions are not allowed at the top level in list-initializations. [ Example: 
13600: int x = 999; // x is not a constant expression
13601: const int y = 999;
13602: const int z = 99;
13603: char c1 = x; // OK, though it might narrow (in this case, it does narrow)
13604: char c2{x}; // error, might narrow
13605: char c3{y}; // error: narrows
13606: char c4{z}; // OK, no narrowing needed
13607: unsigned char uc1 = {5}; // OK: no narrowing needed
13608: unsigned char uc2 = {-1}; // error: narrows
13609: unsigned int ui1 = {-1}; // error: narrows
13610: signed int si1 =
13611: { (unsigned int)-1 }; // error: narrows
13612: int ii = {2.0}; // error: narrows
13613: float f1 { x }; // error: narrows
13614: float f2 { 7 }; // OK: 7 can be exactly represented as a float
13615: int f(int);
13616: int a[] =
13617: { 2, f(2), f(2.0) }; // OK: the double-to-int conversion is not at the top level 
13618: 〞end example ] 
13619: ∫ 8.5.4 204 
13620: 
13621: c
13622: . ISO/IEC N2800=08-0310 
13623: 9 Classes [class]
13624: 1 A class is a type. Its name becomes a class-name (9.1) within its scope. 
13625: class-name:
13626: identifier
13627: simple-template-id
13628: Class-specifiers and elaborated-type-specifiers (7.1.6.3) are used to make class-names. An object of a class 
13629: consists of a (possibly empty) sequence of members and base class objects. 
13630: class-specifier:
13631: class-head { member-specificationopt }
13632: class-head: 
13633: class-key identifieropt attribute-specifieropt base-clauseopt 
13634: class-key nested-name-specifier identifier attribute-specifieropt base-clauseopt 
13635: class-key nested-name-specifieropt simple-template-id attribute-specifieropt base-clauseopt 
13636: class-key: 
13637: class
13638: struct
13639: union
13640: A class-specifier where the class-head omits the optional identifier defines an unnamed class. 
13641: 2 A class-name is inserted into the scope in which it is declared immediately after the class-name is seen. 
13642: The class-name is also inserted into the scope of the class itself; this is known as the injected-class-name. 
13643: For purposes of access checking, the injected-class-name is treated as if it were a public member name. A 
13644: class-specifier is commonly referred to as a class definition. A class is considered defined after the closing 
13645: brace of its class-specifier has been seen even though its member functions are in general not yet defined. 
13646: The optional attribute-specifier appertains to the class; the attributes in the attribute-specifier are thereafter 
13647: considered attributes of the class whenever it is named. 
13648: 3 Complete objects and member subobjects of class type shall have nonzero size.98 [ Note: class objects can 
13649: be assigned, passed as arguments to functions, and returned by functions (except objects of classes for which 
13650: copying has been restricted; see 12.8). Other plausible operators, such as equality comparison, can be defined 
13651: by the user; see 13.5. 〞end note ] 
13652: 4 A union is a class defined with the class-key union; it holds only one data member at a time (9.5). [ Note: 
13653: aggregates of class type are described in 8.5.1. 〞end note ] 
13654: 5 An effective class T is a non-archetype class or a type archetype (14.10.2) that has the requirement std:: 
13655: ClassType<T>. 
13656: 6 A trivially copyable class is a class that: 
13657: 〞 has no non-trivial copy constructors (12.8), 
13658: 〞 has no non-trivial copy assignment operators (13.5.3, 12.8), and 
13659: 〞 has a trivial destructor (12.4). 
13660: 98) Base class subobjects are not so constrained. 
13661: 205 
13662: 
13663: c
13664: . ISO/IEC N2800=08-0310 
13665: A trivial class is a class that has a trivial default constructor (12.1) and is trivially copyable. 
13666: [ Note: in particular, a trivially copyable or trivial class does not have virtual functions or virtual base 
13667: classes. 〞end note ] 
13668: 7 A standard-layout class is a class that: 
13669: 〞 has no non-static data members of type non-standard-layout class (or array of such types) or reference, 
13670: 〞 has no virtual functions (10.3) and no virtual base classes (10.1), 
13671: 〞 has the same access control (Clause 11) for all non-static data members, 
13672: 〞 has no non-standard-layout base classes, 
13673: 〞 either has no non-static data members in the most-derived class and at most one base class with 
13674: non-static data members, or has no base classes with non-static data members, and 
13675: 〞 has no base classes of the same type as the first non-static data member.99 
13676: 8 A standard-layout struct is a standard-layout class defined with the class-key struct or the class-key class. 
13677: A standard-layout union is a standard-layout class defined with the class-key union. 
13678: 9 [ Note: standard-layout classes are useful for communicating with code written in other programming lan-
13679: guages. Their layout is specified in 9.2. 〞end note ] 
13680: 10 A POD struct is a class that is both a trivial class and a standard-layout class, and has no non-static data 
13681: members of type non-POD struct, non-POD union (or array of such types). Similarly, a POD union is a 
13682: union that is both a trivial class and a standard layout class, and has no non-static data members of type 
13683: non-POD struct, non-POD union (or array of such types). A POD class is a class that is either a POD 
13684: struct or a POD union. 
13685: [ Example: 
13686: struct N { // neither trivial nor standard-layout
13687: int i;
13688: int j;
13689: virtual ~N();
13690: }; 
13691: struct T { // trivial but not standard-layout
13692: int i;
13693: private:
13694: int j;
13695: };
13696: struct SL { // standard-layout but not trivial
13697: int i;
13698: int j;
13699: ~SL();
13700: }; 
13701: struct POD { // both trivial and standard-layout
13702: int i;
13703: int j;
13704: }; 
13705: 99) This ensures that two subobjects that have the same class type and that belong to the same most-derived object are not 
13706: allocated at the same address (5.10). 
13707: 206 
13708: 
13709: c
13710: . ISO/IEC N2800=08-0310 
13711: 〞end example ] 
13712: 11 If a class-head contains a nested-name-specifier, the class-specifier shall refer to a class that was previously 
13713: declared directly in the class or namespace to which the nested-name-specifier refers (i.e., neither inherited 
13714: nor introduced by a using-declaration), and the class-specifier shall appear in a namespace enclosing the 
13715: previous declaration. 
13716: 9.1 Class names [class.name] 
13717: 1 A class definition introduces a new type. [ Example: 
13718: struct X { int a; };
13719: struct Y { int a; };
13720: X a1;
13721: Y a2;
13722: int a3;
13723: declares three variables of three different types. This implies that 
13724: a1 = a2; // error: Y assigned to X
13725: a1 = a3; // error: int assigned to X
13726: are type mismatches, and that 
13727: int f(X);
13728: int f(Y);
13729: declare an overloaded (Clause 13) function f() and not simply a single function f() twice. For the same 
13730: reason, 
13731: struct S { int a; };
13732: struct S { int a; }; // error, double definition
13733: is ill-formed because it defines S twice. 〞 end example ] 
13734: 2 A class declaration introduces the class name into the scope where it is declared and hides any class, object, 
13735: function, or other declaration of that name in an enclosing scope (3.3). If a class name is declared in a scope 
13736: where an object, function, or enumerator of the same name is also declared, then when both declarations 
13737: are in scope, the class can be referred to only using an elaborated-type-specifier (3.4.4). [ Example: 
13738: struct stat { 
13739: // ... 
13740: }; 
13741: stat gstat; // use plain stat to
13742: // define variable
13743: int stat(struct stat*); // redeclare stat as function 
13744: void f() {
13745: struct stat* ps; // struct prefix needed
13746: // to name struct stat
13747: stat(ps); // call stat()
13748: }
13749: ∫ 9.1 207 
13750: 
13751: c
13752: . ISO/IEC N2800=08-0310 
13753: 〞end example ]A declaration consisting solely of class-key identifier; is either a redeclaration of the name 
13754: in the current scope or a forward declaration of the identifier as a class name. It introduces the class name 
13755: into the current scope. [ Example: 
13756: struct s { int a; }; 
13757: void g() {
13758: struct s; // hide global struct s
13759: // with a local declaration
13760: s* p; // refer to local struct s
13761: struct s { char* p; }; // define local struct s
13762: struct s; // redeclaration, has no effect
13763: } 
13764: 〞end example ][ Note: Such declarations allow definition of classes that refer to each other. [ Example: 
13765: class Vector; 
13766: class Matrix { 
13767: // ... 
13768: friend Vector operator*(const Matrix&, const Vector&);
13769: };
13770: class Vector { 
13771: // ... 
13772: friend Vector operator*(const Matrix&, const Vector&);
13773: };
13774: Declaration of friends is described in 11.4, operator functions in 13.5. 〞end example ] 〞end note ] 
13775: 3 [ Note: An elaborated-type-specifier (7.1.6.3) can also be used as a type-specifier as part of a declaration. It 
13776: differs from a class declaration in that if a class of the elaborated name is in scope the elaborated name will 
13777: refer to it. 〞end note ][ Example: 
13778: struct s { int a; }; 
13779: void g(int s) {
13780: struct s* p = new struct s; // global s
13781: p->a = s; // local s
13782: } 
13783: 〞end example ] 
13784: 4 [ Note: The declaration of a class name takes effect immediately after the identifier is seen in the class 
13785: definition or elaborated-type-specifier. For example, 
13786: class A * A; 
13787: first specifies A to be the name of a class and then redefines it as the name of a pointer to an object of that 
13788: class. This means that the elaborated form class A must be used to refer to the class. Such artistry with 
13789: names can be confusing and is best avoided. 〞end note ] 
13790: 5 A typedef-name (7.1.3) that names a class type, or a cv-qualified version thereof, is also a class-name. If a 
13791: typedef-name that names a cv-qualified class type is used where a class-name is required, the cv-qualifiers 
13792: ∫ 9.1 208 
13793: 
13794: c
13795: . ISO/IEC N2800=08-0310 
13796: are ignored. A typedef-name shall not be used as the identifier in a class-head. 
13797: 9.2 Class members [class.mem] 
13798: member-specification:
13799: member-declaration member-specificationopt
13800: access-specifier : member-specificationopt
13801: member-declaration:
13802: member-requirementopt decl-specifier-seqopt
13803: attribute-specifieropt member-declarator-listopt ;
13804: member-requirementopt function-definition ;opt
13805: ::opt nested-name-specifier templateopt unqualified-id ;
13806: using-declaration
13807: static_assert-declaration
13808: template-declaration
13809: member-requirement:
13810: requires-clause
13811: member-declarator-list:
13812: member-declarator
13813: member-declarator-list , member-declarator
13814: member-declarator:
13815: declarator pure-specifieropt
13816: declarator brace-or-equal-initializeropt
13817: identifieropt attribute-specifieropt : constant-expression
13818: pure-specifier: 
13819: =0 
13820: 1 The member-specification in a class definition declares the full set of members of the class; no member 
13821: can be added elsewhere. Members of a class are data members, member functions (9.3), nested types, 
13822: and enumerators. Data members and member functions are static or non-static; see 9.4. Nested types are 
13823: classes (9.1, 9.7) and enumerations (7.2) defined in the class, and arbitrary types declared as members by use 
13824: of a typedef declaration (7.1.3). The enumerators of an enumeration (7.2) defined in the class are members 
13825: of the class. Except when used to declare friends (11.4) or to introduce the name of a member of a base 
13826: class into a derived class (7.3.3, 11.3), member-declarations declare members of the class, and each such 
13827: member-declaration shall declare at least one member name of the class. A member shall not be declared 
13828: twice in the member-specification, except that a nested class or member class template can be declared and 
13829: then later defined. 
13830: 2 A non-archetype class is considered a completely-defined object type (3.9) (or complete type) at the closing } 
13831: of the class-specifier.[ Note: Each type archetype (14.10.2) is considered to be a unique generated class type 
13832: and is considered to be defined when it is established. 〞end note ] Within the class member-specification, 
13833: the class is regarded as complete within function bodies, default arguments, exception-specifications, and 
13834: brace-or-equal-initializers for non-static data members (including such things in nested classes). Otherwise 
13835: it is regarded as incomplete within its own class member-specification. 
13836: 3 [ Note: a single name can denote several function members provided their types are sufficiently different 
13837: (Clause 13). 〞end note ] 
13838: 4 A member can be initialized using a constructor; see 12.1. [ Note: see Clause 12 for a description of 
13839: constructors and other special member functions. 〞end note ] 
13840: 5 A member can be initialized using a brace-or-equal-initializer. (For static data members, see 9.4.2; for 
13841: non-static data members, see 12.6.2). 
13842: ∫ 9.2 209 
13843: 
13844: c
13845: . ISO/IEC N2800=08-0310 
13846: 6 A member shall not be declared with the extern or register storage-class-specifier. Within a class definition, 
13847: a member shall not be declared with the thread_local storage-class-specifier unless also declared static. 
13848: 7 The decl-specifier-seq is omitted in constructor, destructor, and conversion function declarations only. The 
13849: member-declarator-list can be omitted only after a class-specifier or an enum-specifier or in a friend dec-
13850: laration (11.4). A pure-specifier shall be used only in the declaration of a virtual function (10.3). 
13851: 8 Non-static (9.4) data members shall not have incomplete types. In particular, a class C shall not contain 
13852: a non-static member of class C, but it can contain a pointer or reference to an object of class C. 
13853: 9 [ Note: See 5.1 for restrictions on the use of non-static data members and non-static member functions. 
13854: 〞end note ] 
13855: 10 [ Note: the type of a non-static member function is an ordinary function type, and the type of a non-static 
13856: data member is an ordinary object type. There are no special member function types or data member types. 
13857: 〞end note ] 
13858: 11 [ Example: A simple example of a class definition is 
13859: struct tnode {
13860: char tword[20];
13861: int count;
13862: tnode *left;
13863: tnode *right;
13864: }; 
13865: which contains an array of twenty characters, an integer, and two pointers to objects of the same type. Once 
13866: this definition has been given, the declaration 
13867: tnode s, *sp; 
13868: declares s to be a tnode and sp to be a pointer to a tnode. With these declarations, sp->count refers to 
13869: the count member of the object to which sp points; s.left refers to the left subtree pointer of the object 
13870: s; and s.right->tword[0] refers to the initial character of the tword member of the right subtree of s. 
13871: 〞end example ] 
13872: 12 Nonstatic data members of a (non-union) class with the same access control (Clause 11) are allocated so 
13873: that later members have higher addresses within a class object. The order of allocation of non-static data 
13874: members with different access control is unspecified (11). Implementation alignment requirements might 
13875: cause two adjacent members not to be allocated immediately after each other; so might requirements for 
13876: space for managing virtual functions (10.3) and virtual base classes (10.1). 
13877: 13 If T is the name of a class, then each of the following shall have a name different from T: 
13878: 〞 every static data member of class T; 
13879: 〞 every member function of class T [ Note: this restriction does not apply to constructors, which do not 
13880: have names (12.1) 〞end note ]; 
13881: 〞 every member of class T that is itself a type; 
13882: 〞 every enumerator of every member of class T that is an enumerated type; and 
13883: 〞 every member of every anonymous union that is a member of class T. 
13884: 14 In addition, if class T has a user-declared constructor (12.1), every non-static data member of class T shall 
13885: have a name different from T. 
13886: ∫ 9.2 210 
13887: 
13888: c
13889: . ISO/IEC N2800=08-0310 
13890: 15 Two standard-layout struct (Clause9) types are layout-compatibleif they have the same number of non-static 
13891: data members and corresponding non-static data members (in declaration order) have layout-compatible 
13892: types (3.9). 
13893: 16 Two standard-layout union (Clause 9) types are layout-compatible if they have the same number of non-
13894: static data members and corresponding non-static data members (in any order) have layout-compatible 
13895: types (3.9). 
13896: 17 If a standard-layout union contains two or more standard-layout structs that share a common initialsequence, 
13897: and if the standard-layout union object currently contains one of these standard-layout structs,it is permitted 
13898: to inspect the common initial part of any of them. Two standard-layout structs share a common initial 
13899: sequence if corresponding members have layout-compatible types (and, for bit-fields, the same widths) for a 
13900: sequence of one or more initial members. 
13901: 18 A pointer to a standard-layout struct object, suitably converted using a reinterpret_cast, points to its 
13902: initial member (or if that member is a bit-field, then to the unit in which it resides) and vice versa. [ Note: 
13903: There might therefore be unnamed padding within a standard-layout struct object, but not at its beginning, 
13904: as necessary to achieve appropriate alignment. 〞end note ] 
13905: 19 A non-template member-declaration that has a member-requirement (14.10.1) is a constrained member and 
13906: shall occur only in a class template (14.5.1) or nested class thereof. The member-declaration for a constrained 
13907: member shall declare a member function. A constrained member is treated as a constrained template (14.10) 
13908: whose template requirements include the requirements specified in its member-requirement clause and the 
13909: requirements of each enclosing constrained template. 
13910: 9.3 Member functions [class.mfct] 
13911: 1 Functions declared in the definition of a class, excluding those declared with a friend specifier (11.4), are 
13912: called member functions of that class. A member function may be declared static in which case it is a static 
13913: member function of its class (9.4); otherwise it is a non-static member function of its class (9.3.1, 9.3.2). 
13914: 2 A member function may be defined (8.4) in its class definition, in which case it is an inline member func-
13915: tion (7.1.2), or it may be defined outside of its class definition if it has already been declared but not defined 
13916: in its class definition. A member function definition that appears outside of the class definition shall appear 
13917: in a namespace scope enclosing the class definition. Except for member function definitions that appear 
13918: outside of a class definition, and except for explicit specializations of member functions of class templates 
13919: and member function templates (14.7) appearing outside of the class definition, a member function shall not 
13920: be redeclared. 
13921: 3 An inline member function (whether static or non-static) may also be defined outside of its class definition 
13922: provided either its declaration in the class definition or its definition outside of the class definition declares 
13923: the function as inline.[ Note: member functions of a class in namespace scope have external linkage. 
13924: Member functions of a local class (9.8) have no linkage. See 3.5. 〞 end note ] 
13925: 4 There shall be at most one definition of a non-inline member function in a program; no diagnostic is required. 
13926: There may be more than one inline member function definition in a program. See 3.2 and 7.1.2. 
13927: 5 If the definition of a member function is lexically outside its class definition, the member function name 
13928: shall be qualified by its class name using the :: operator. [ Note: a name used in a member function 
13929: definition (that is, in the parameter-declaration-clause including the default arguments (8.3.6) or in the 
13930: member function body) is looked up as described in 3.4. 〞end note ][ Example: 
13931: struct X {
13932: typedef int T;
13933: static T count;
13934: ∫ 9.3 211 
13935: 
13936: c
13937: . ISO/IEC N2800=08-0310 
13938: void f(T);
13939: };
13940: void X::f(T t = count) { }
13941: The member function f of class X is defined in global scope; the notation X::f specifies that the function f 
13942: is a member of class X and in the scope of class X. In the function definition, the parameter type T refers to 
13943: the typedef member T declared in class X and the default argument count refers to the static data member 
13944: count declared in class X. 〞end example ] 
13945: 6 A static local variable in a member function always refers to the same object, whether or not the member 
13946: function is inline. 
13947: 7 Member functions may be mentioned in friend declarations after their class has been defined. 
13948: 8 Member functions of a local class shall be defined inline in their class definition, if they are defined at all. 
13949: 9 [ Note: a member function can be declared (but not defined) using a typedef for a function type. The 
13950: resulting member function has exactly the same type as it would have if the function declarator were 
13951: provided explicitly, see 8.3.5. For example, 
13952: typedef void fv(void);
13953: typedef void fvc(void) const;
13954: struct S {
13955: fv memfunc1; // equivalent to: void memfunc1(void);
13956: void memfunc2();
13957: fvc memfunc3; // equivalent to: void memfunc3(void) const;
13958: };
13959: fv S::* pmfv1 = &S::memfunc1;
13960: fv S::* pmfv2 = &S::memfunc2;
13961: fvc S::* pmfv3 = &S::memfunc3;
13962: Also see 14.3. 〞end note ] 
13963: 9.3.1 Nonstatic member functions [class.mfct.non-static] 
13964: 1 A non-static member function may be called for an object of its class type, or for an object of a class derived 
13965: (Clause 10) from its class type, using the class member access syntax (5.2.5, 13.3.1.1). A non-static member 
13966: function may also be called directly using the function call syntax (5.2.2, 13.3.1.1) from within the body of 
13967: a member function of its class or of a class derived from its class. 
13968: 2 If a non-static member function of a class X is called for an object that is not of type X, or of a type derived 
13969: from X, the behavior is undefined. 
13970: 3 When an id-expression (5.1) that is not part of a class member access syntax (5.2.5) and not used to 
13971: form a pointer to member (5.3.1) is used in the body of a non-static member function of class X, if name 
13972: lookup (3.4.1) resolves the name in the id-expression to a non-static non-type member of some class C, 
13973: the id-expression is transformed into a class member access expression (5.2.5) using (*this) (9.3.2) as the 
13974: postfix-expression to the left of the . operator. [ Note: if C is not X or a base class of X, the class member 
13975: access expression is ill-formed. 〞end note ] Similarly during name lookup, when an unqualified-id (5.1) 
13976: used in the definition of a member function for class X resolves to a static member, an enumerator or a 
13977: nested type of class X or of a base class of X, the unqualified-id is transformed into a qualified-id (5.1) in 
13978: which the nested-name-specifier names the class of the member function. [ Example: 
13979: struct tnode {
13980: char tword[20];
13981: int count;
13982: tnode *left;
13983: ∫ 9.3.1 212 
13984: 
13985: c
13986: . ISO/IEC N2800=08-0310 
13987: tnode *right;
13988: void set(char*, tnode* l, tnode* r);
13989: };
13990: void tnode::set(char* w, tnode* l, tnode* r) {
13991: count = strlen(w)+1;
13992: if (sizeof(tword)<=count)
13993: perror("tnode string too long");
13994: strcpy(tword,w);
13995: left = l;
13996: right = r;
13997: } 
13998: void f(tnode n1, tnode n2) {
13999: n1.set("abc",&n2,0);
14000: n2.set("def",0,0);
14001: } 
14002: In the body of the member function tnode::set, the member names tword, count, left, and right refer to 
14003: members of the object for which the function is called. Thus, in the call n1.set("abc",&n2,0), tword refers 
14004: to n1.tword, and in the call n2.set("def",0,0), it refers to n2.tword. The functions strlen, perror, 
14005: and strcpy are not members of the class tnode and should be declared elsewhere.100 〞end example ] 
14006: 4 A non-static member function may be declared const, volatile, or const volatile. These cv-qualifiers 
14007: affect the type of the this pointer (9.3.2). They also affect the function type (8.3.5) of the member function; 
14008: a member function declared const is a const member function, a member function declared volatile is 
14009: a volatile member function and a member function declared const volatile is a const volatile member 
14010: function. [ Example: 
14011: struct X {
14012: void g() const;
14013: void h() const volatile;
14014: }; 
14015: X::g is a const member function and X::h is a const volatile member function. 〞end example ] 
14016: 5 A non-static member function may be declared with a ref-qualifier (8.3.5); see 13.3.1. 
14017: 6 A non-static member function may be declared virtual (10.3) or pure virtual (10.4). 
14018: 9.3.2 The this pointer [class.this] 
14019: 1 In the body of a non-static (9.3) member function, the keyword this is an rvalue expression whose value 
14020: is the address of the object for which the function is called. The type of this in a member function of 
14021: a class X is X*. If the member function is declared const, the type of this is const X*, if the member 
14022: function is declared volatile, the type of this is volatile X*, and if the member function is declared 
14023: const volatile, the type of this is const volatile X*. 
14024: 2 In a const member function, the object for which the function is called is accessed through a const access 
14025: path; therefore, a const member function shall not modify the object and its non-static data members. 
14026: [ Example: 
14027: struct s {
14028: int a;
14029: int f() const;
14030: 100) See, for example, <cstring> (21.5). 
14031: ∫ 9.3.2 213 
14032: 
14033: c
14034: . ISO/IEC N2800=08-0310 
14035: int g() { return a++; }
14036: int h() const { return a++; } // error
14037: };
14038: int s::f() const { return a; } 
14039: The a++ in the body of s::h is ill-formed because it tries to modify (a part of) the object for which s::h() 
14040: is called. This is not allowed in a const member function because this is a pointer to const; that is, *this 
14041: has const type. 〞end example ] 
14042: 3 Similarly, volatile semantics (7.1.6.1) apply in volatile member functions when accessing the object and 
14043: its non-static data members. 
14044: 4 A cv-qualified member function can be called on an object-expression (5.2.5) only if the object-expression is 
14045: as cv-qualified or less-cv-qualified than the member function. [ Example: 
14046: void k(s& x, const s& y) {
14047: x.f();
14048: x.g();
14049: y.f();
14050: y.g(); // error
14051: } 
14052: The call y.g() is ill-formed because y is const and s::g() is a non-const member function, that is, s::g() 
14053: is less-qualified than the object-expression y. 〞end example ] 
14054: 5 Constructors (12.1) and destructors (12.4) shall not be declared const, volatile or const volatile.[ Note: 
14055: However, these functions can be invoked to create and destroy objects with cv-qualified types, see (12.1) 
14056: and (12.4). 〞end note ] 
14057: 9.4 Static members [class.static] 
14058: 1 A data or function member of a class may be declared static in a class definition, in which case it is a 
14059: static member of the class. 
14060: 2 A static member s of class X may be referred to using the qualified-id expression X::s; it is not necessary to 
14061: use the class member access syntax (5.2.5) to refer to a static member. A static member may be referred 
14062: to using the class member access syntax, in which case the object-expression is evaluated. [ Example: 
14063: struct process { 
14064: static void reschedule();
14065: };
14066: process& g();
14067: void f() {
14068: process::reschedule(); // OK: no object necessary
14069: g().reschedule(); // g() is called
14070: } 
14071: 〞end example ] 
14072: 3 A static member may be referred to directly in the scope of its class or in the scope of a class derived 
14073: (Clause 10) from its class; in this case, the static member is referred to as if a qualified-id expression was 
14074: used, with the nested-name-specifier of the qualified-id naming the class scope from which the static member 
14075: is referenced. [ Example: 
14076: ∫ 9.4 214 
14077: 
14078: c
14079: . ISO/IEC N2800=08-0310 
14080: int g();
14081: struct X {
14082: static int g();
14083: };
14084: struct Y : X {
14085: static int i;
14086: };
14087: int Y::i = g(); // equivalent to Y::g();
14088: 〞end example ] 
14089: 4 If an unqualified-id (5.1) is used in the definition of a static member following the member＊s declarator-id, 
14090: and name lookup (3.4.1) finds that the unqualified-id refers to a static member, enumerator, or nested 
14091: type of the member＊s class (or of a base class of the member＊s class), the unqualified-id is transformed into 
14092: a qualified-id expression in which the nested-name-specifier names the class scope from which the member 
14093: is referenced. [ Note: See 5.1 for restrictions on the use of non-static data members and non-static member 
14094: functions. 〞end note ] 
14095: 5 Static members obey the usual class member access rules (Clause 11). When used in the declaration of 
14096: a class member, the static specifier shall only be used in the member declarations that appear within 
14097: the member-specification of the class definition. [ Note: it cannot be specified in member declarations that 
14098: appear in namespace scope. 〞end note ] 
14099: 9.4.1 Static member functions [class.static.mfct] 
14100: 1 [ Note: the rules described in 9.3 apply to static member functions. 〞end note ] 
14101: 2 [ Note: a static member function does not have a this pointer (9.3.2). 〞end note ]A static member 
14102: function shall not be virtual. There shall not be a static and a non-static member function with the 
14103: same name and the same parameter types (13.1). A static member function shall not be declared const, 
14104: volatile, or const volatile. 
14105: 9.4.2 Static data members [class.static.data] 
14106: 1 A static data member is not part of the subobjects of a class. If a static data member is declared 
14107: thread_local there is one copy of the member per thread. If a static data member is not declared 
14108: thread_local there is one copy of the data member that is shared by all the objects of the class. 
14109: 2 The declaration of a static data member in its class definition is not a definition and may be of anincomplete 
14110: type other than cv-qualified void. The definition for a static data member shall appear in a namespace 
14111: scope enclosing the member＊s class definition. In the definition at namespace scope, the name of the static 
14112: data member shall be qualified by its class name using the :: operator. The initializer expression in the 
14113: definition of a static data member is in the scope of its class (3.3.6). [ Example: 
14114: class process {
14115: static process* run_chain;
14116: static process* running;
14117: }; 
14118: process* process::running = get_main();
14119: process* process::run_chain = running;
14120: The static data member run_chain of class process is defined in global scope; the notation process::run_-
14121: chain specifies that the member run_chain is a member of class process and in the scope of class process. 
14122: In the static data member definition, the initializer expression refers to the static data member running 
14123: of class process. 〞end example ] 
14124: ∫ 9.4.2 215 
14125: 
14126: c
14127: . ISO/IEC N2800=08-0310 
14128: [ Note: once the static data member has been defined, it exists even if no objects of its class have been 
14129: created. [ Example: in the example above, run_chain and running exist even if no objects of class process 
14130: are created by the program. 〞end example ] 〞end note ] 
14131: 3 If a static data member is of const effective literal type, its declaration in the class definition can specify a 
14132: constant-initializer brace-or-equal-initializer with an initializer-clause that is an integral constant expression. 
14133: A static data member of effective literal type can be declared in the class definition with the constexpr 
14134: specifier; if so, its declaration shall specify a constant-initializer brace-or-equal-initializer with an initializer-
14135: clause that is an integral constant expression. In both these cases, the member may appear in integral 
14136: constant expressions. The member shall still be defined in a namespace scope if it is used in the program 
14137: and the namespace scope definition shall not contain an initializer. 
14138: 4 There shall be exactly one definition of a static data member that is used in a program; no diagnostic is 
14139: required; see 3.2. Unnamed classes and classes contained directly or indirectly within unnamed classes shall 
14140: not contain static data members. 
14141: 5 Static data members of a class in namespace scope have external linkage (3.5). A local class shall not have 
14142: static data members. 
14143: 6 Static data members are initialized and destroyed exactly like non-local objects (3.6.2, 3.6.3). 
14144: 7 A static data member shall not be mutable (7.1.1). 
14145: 9.5 Unions [class.union] 
14146: 1 In a union, at most one of the data members can be active at any time, that is, the value of at most one 
14147: of the data members can be stored in a union at any time. [ Note: one special guarantee is made in order 
14148: to simplify the use of unions: If a standard-layout union contains several standard-layout structs that share 
14149: a common initial sequence (9.2), and if an object of this standard-layout union type contains one of the 
14150: standard-layout structs, it is permitted to inspect the common initial sequence of any of standard-layout 
14151: struct members; see 9.2. 〞end note ] The size of a union is sufficient to contain the largest of its data 
14152: members. Each data member is allocated as if it were the sole member of a struct. A union can have 
14153: member functions (including constructors and destructors), but not virtual (10.3) functions. A union shall 
14154: not have base classes. A union shall not be used as a base class. If a union contains a non-static data 
14155: member of reference type the program is ill-formed. [ Note: if any non-static data member of a union 
14156: has a non-trivial default constructor (12.1), copy constructor (12.8), copy assignment operator (12.8), or 
14157: destructor (12.4), the corresponding member function of the union must be user-declared user-provided or 
14158: it will be implicitly deleted (8.4) for the union. 〞 end note ] 
14159: [ Example: Consider the following union: 
14160: union U {
14161: int i;
14162: float f;
14163: std::string s;
14164: }; 
14165: Since std::string (21.2) declares non-trivial versions of all of the special member functions, U will have an 
14166: implicitly deleted default constructor, copy constructor, copy assignment operator, and destructor. To use 
14167: U, some or all of these member functions must be user-declared. 
14168: Consider an object u of a union type U having non-static data members m of type M and n of type N. If M has 
14169: a non-trivial destructor and N has a non-trivial constructor (for instance, if they declare or inherit virtual 
14170: functions), the active member of u can be safely switched from m to n using the destructor and placement 
14171: new operator as follows: 
14172: ∫ 9.5 216 
14173: 
14174: c
14175: . ISO/IEC N2800=08-0310 
14176: u.m.~M();
14177: new (&u.n) N;
14178: 〞end example ] 
14179: 2 A union of the form 
14180: union { member-specification } ; 
14181: is called an anonymous union; it defines an unnamed object of unnamed type. The member-specification of 
14182: an anonymous union shall only define non-static data members. [ Note: nested types and functions cannot 
14183: be declared within an anonymous union. 〞 end note ] The names of the members of an anonymous union 
14184: shall be distinct from the names of any other entity in the scope in which the anonymous union is declared. 
14185: For the purpose of name lookup, after the anonymous union definition, the members of the anonymous union 
14186: are considered to have been defined in the scope in which the anonymous union is declared. [ Example: 
14187: void f() {
14188: union { int a; char* p; };
14189: a = 1;
14190: p = "Jennifer";
14191: } 
14192: 3 Here a and p are used like ordinary (nonmember) variables, but since they are union members they have 
14193: the same address. 〞end example ] 
14194: Anonymous unions declared in a named namespace or in the global namespace shall be declared static. 
14195: Anonymous unions declared at block scope shall be declared with any storage class allowed for a block-scope 
14196: variable, or with no storage class. A storage class is not allowed in a declaration of an anonymous union 
14197: in a class scope. An anonymous union shall not have private or protected members (Clause 11). An 
14198: anonymous union shall not have function members. 
14199: 4 A union for which objects or pointers are declared is not an anonymous union. [ Example: 
14200: union { int aa; char* p; } obj, *ptr = &obj;
14201: aa = 1; // error
14202: ptr->aa = 1; // OK
14203: The assignment to plain aa is ill-formed since the member name is not visible outside the union, and even 
14204: if it were visible, it is not associated with any particular object. 〞end example ][ Note: Initialization of 
14205: unions with no user-declared constructors is described in (8.5.1). 〞end note ] 
14206: 5 A union-like class is a union or a class that has an anonymous union as a direct member. A union-like 
14207: class X has a set of variant members. If X is a union its variant members are the non-static data members; 
14208: otherwise, its variant members are the non-static data members of all anonymous unions that are members 
14209: of X. 
14210: 9.6 Bit-fields [class.bit] 
14211: 1 A member-declarator of the form 
14212: identifieropt attribute-specifieropt : constant-expression 
14213: specifies a bit-field; its length is set off from the bit-field name by a colon. The optional attribute-specifier 
14214: appertains to the entity being declared. The bit-field attribute is not part of the type of the class member. 
14215: The constant-expression shall be an integral constant expression with a value greater than or equal to 
14216: zero. The value of the integral constant expression may be larger than the number of bits in the object 
14217: representation (3.9) of the bit-field＊s type; in such cases the extra bits are used as padding bits and do not 
14218: ∫ 9.6 217 
14219: 
14220: c
14221: . ISO/IEC N2800=08-0310 
14222: participate in the value representation (3.9) of the bit-field. Allocation of bit-fields within a class object is 
14223: implementation-defined. Alignment of bit-fields is implementation-defined. Bit-fields are packed into some 
14224: addressable allocation unit. [ Note: bit-fields straddle allocation units on some machines and not on others. 
14225: Bit-fields are assigned right-to-left on some machines, left-to-right on others. 〞 end note ] 
14226: 2 A declaration for a bit-field that omits the identifier declares an unnamed bit-field. Unnamed bit-fields 
14227: are not members and cannot be initialized. [ Note: an unnamed bit-field is useful for padding to conform 
14228: to externally-imposed layouts. 〞end note ] As a special case, an unnamed bit-field with a width of zero 
14229: specifies alignment of the next bit-field at an allocation unit boundary. Only when declaring an unnamed 
14230: bit-field may the value of the constant-expression be equal to zero. 
14231: 3 A bit-field shall not be a static member. A bit-field shall have integral or enumeration type (3.9.1). It is 
14232: implementation-defined whether a plain (neither explicitly signed nor unsigned) char, short, int or long 
14233: bit-field is signed or unsigned. A bool value can successfully be stored in a bit-field of any nonzero size. The 
14234: address-of operator & shall not be applied to a bit-field, so there are no pointers to bit-fields. A non-const 
14235: reference shall not be bound to a bit-field (8.5.3). [ Note: if the initializer for a reference of type const T& is 
14236: an lvalue that refers to a bit-field, the reference is bound to a temporary initialized to hold the value of the 
14237: bit-field; the reference is not bound to the bit-field directly. See 8.5.3. 〞end note ] 
14238: 4 If the value true or false is stored into a bit-field of type bool of any size (including a one bit bit-field), 
14239: the original bool value and the value of the bit-field shall compare equal. If the value of an enumerator is 
14240: stored into a bit-field of the same enumeration type and the number of bits in the bit-field is large enough 
14241: to hold all the values of that enumeration type (7.2), the original enumerator value and the value of the 
14242: bit-field shall compare equal. [ Example: 
14243: enum BOOL { FALSE=0, TRUE=1 };
14244: struct A {
14245: BOOL b:1;
14246: };
14247: A a;
14248: void f() {
14249: a.b = TRUE;
14250: if (a.b == TRUE) // yields true
14251: { /. ... / }
14252: }
14253: 〞end example ] 
14254: 9.7 Nested class declarations [class.nest] 
14255: 1 A class can be declared within another class. A class declared within another is called a nested class. The 
14256: name of a nested class is local to its enclosing class. The nested class is in the scope of its enclosing class. 
14257: [ Note: see 5.1 for restrictions on the use of non-static data members and non-static member functions. 
14258: 〞end note ]
14259: [ Example:
14260: int x;
14261: int y;
14262: struct enclose {
14263: int x;
14264: static int s;
14265: struct inner {
14266: void f(int i) {
14267: ∫ 9.7 218 
14268: 
14269: c
14270: . ISO/IEC N2800=08-0310 
14271: int a = sizeof(x); // OK: operand of sizeof is an unevaluated operand 
14272: x = i; // error: assign to enclose::x 
14273: s = i; // OK: assign to enclose::s 
14274: ::x = i; // OK: assign to global x 
14275: y = i; // OK: assign to global y 
14276: }
14277: void g(enclose* p, int i) {
14278: p->x = i; // OK: assign to enclose::x
14279: }
14280: };
14281: };
14282: inner* p = 0; // error: inner not in scope 
14283: 〞end example ] 
14284: 2 Member functions and static data members of a nested class can be defined in a namespace scope enclosing 
14285: the definition of their class. [ Example: 
14286: struct enclose { 
14287: struct inner {
14288: static int x;
14289: void f(int i);
14290: };
14291: };
14292: int enclose::inner::x = 1; 
14293: void enclose::inner::f(int i) { /. ... / } 
14294: 〞end example ] 
14295: 3 If class X is defined in a namespace scope, a nested class Y may be declared in class X and later defined in the 
14296: definition of class X or be later defined in a namespace scope enclosing the definition of class X.[ Example: 
14297: class E {
14298: class I1; // forward declaration of nested class
14299: class I2;
14300: class I1 { }; // definition of nested class
14301: };
14302: class E::I2 { }; // definition of nested class
14303: 〞end example ] 
14304: 4 Like a member function, a friend function (11.4) defined within a nested class is in the lexical scope of that 
14305: class; it obeys the same rules for name binding as a static member function of that class (9.4), but it has no 
14306: special access rights to members of an enclosing class. 
14307: 9.8 Local class declarations [class.local] 
14308: 1 A class can be declared within a function definition; such a class is called a local class. The name of a 
14309: local class is local to its enclosing scope. The local class is in the scope of the enclosing scope, and has the 
14310: same access to names outside the function as does the enclosing function. Declarations in a local class can 
14311: use only type names, static variables, extern variables and functions, and enumerators from the enclosing 
14312: scope. [ Example: 
14313: ∫ 9.8 219 
14314: 
14315: c
14316: . ISO/IEC N2800=08-0310 
14317: int x; 
14318: void f() {
14319: static int s ;
14320: int x;
14321: extern int g();
14322: struct local {
14323: int g() { return x; } // error: x has automatic storage duration
14324: int h() { return s; } // OK
14325: int k() { return ::x; } // OK
14326: int l() { return g(); } // OK
14327: };
14328: }
14329: local* p = 0; // error: local not in scope 
14330: 〞end example ] 
14331: 2 An enclosing function has no special access to members of the local class; it obeys the usual access rules 
14332: (Clause 11). Member functions of a local class shall be defined within their class definition, if they are 
14333: defined at all. 
14334: 3 If class X is a local class a nested class Y may be declared in class X and later defined in the definition of 
14335: class X or be later defined in the same scope as the definition of class X. A class nested within a local class 
14336: is a local class. 
14337: 4 A local class shall not have static data members. 
14338: 9.9 Nested type names [class.nested.type] 
14339: 1 Type names obey exactly the same scope rules as other names. In particular, type names defined within a 
14340: class definition cannot be used outside their class without qualification. [ Example: 
14341: struct X {
14342: typedef int I;
14343: class Y { /. ... / };
14344: I a;
14345: }; 
14346: I b; // error
14347: Y c; // error
14348: X::Y d; // OK
14349: X::I e; // OK
14350: 〞end example ] 
14351: ∫ 9.9 220 
14352: 
14353: . ISO/IEC N2800=08-0310 
14354: 10 Derived classes [class.derived]
14355: 1 A list of base classes can be specified in a class definition using the notation: 
14356: base-clause:
14357: : base-specifier-list
14358: base-specifier-list:
14359: base-specifier ...opt
14360: base-specifier-list , base-specifier ...opt
14361: base-specifier: 
14362: ::opt nested-name-specifieropt class-name attribute-specifieropt 
14363: virtual access-specifieropt ::opt nested-name-specifieropt class-name attribute-specifieropt 
14364: access-specifier virtualopt ::opt nested-name-specifieropt class-name attribute-specifieropt 
14365: access-specifier: 
14366: private
14367: protected
14368: public
14369: The optional attribute-specifier appertains to the base-specifier. 
14370: 2 The class-name in a base-specifier shall not be an incompletely defined class (Clause class); this class is 
14371: called a direct base class for the class being defined. During the lookup for a base class name, non-type 
14372: names are ignored (3.3.10). If the name found is not a class-name, the program is ill-formed. A class B is 
14373: a base class of a class D if it is a direct base class of D or a direct base class of one of D＊s base classes. A 
14374: class is an indirect base class of another if it is a base class but not a direct base class. A class is said to be 
14375: (directly or indirectly) derived from its (direct or indirect) base classes. [ Note: see Clause class.access for 
14376: the meaning of access-specifier. 〞end note ] Unless redeclared in the derived class, members of a base class 
14377: are also considered to be members of the derived class. The base class members are said to be inherited by 
14378: the derived class. Inherited members can be referred to in expressions in the same manner as other members 
14379: of the derived class, unless their names are hidden or ambiguous (10.2). [ Note: the scope resolution operator 
14380: :: (5.1) can be used to refer to a direct or indirect base member explicitly. This allows access to a name 
14381: that has been redeclared in the derived class. A derived class can itself serve as a base class subject to 
14382: access control; see 11.2. A pointer to a derived class can be implicitly converted to a pointer to an accessible 
14383: unambiguous base class (4.10). An lvalue of a derived class type can be bound to a reference to an accessible 
14384: unambiguous base class (8.5.3). 〞end note ] 
14385: 3 The base-specifier-list specifies the type of the base class subobjects contained in an object of the derived 
14386: class type. [ Example: 
14387: struct Base {
14388: int a, b, c;
14389: }; 
14390: struct Derived : Base {
14391: int b;
14392: }; 
14393: struct Derived2 : Derived {
14394: int c;
14395: }; 
14396: 221 
14397: 
14398: c
14399: . ISO/IEC N2800=08-0310 
14400: Here, an object of class Derived2 will have a subobject of class Derived which in turn will have a subobject 
14401: of class Base. 〞end example ] 
14402: 4 A base-specifier followed by an ellipsis is a pack expansion (14.5.3). 
14403: 5 The order in which the base class subobjects are allocated in the most derived object (1.8) is unspecified. 
14404: [ Note: a derived class and its base class subobjects can be represented by a directed acyclic graph (DAG) 
14405: where an arrow means ※directly derived from.§ A DAG of subobjects is often referred to as a ※subobject 
14406: lattice.§ 
14407: Base 
14408: 6 
14409: Derived1 
14410: 6 
14411: Derived2 
14412: Figure 1 〞 Directed acyclic graph 
14413: 6 The arrows need not have a physical representation in memory. 〞end note ] 
14414: 7 [ Note: initialization of objects representing base classes can be specified in constructors; see 12.6.2. 〞end 
14415: note ] 
14416: 8 [ Note: A base class subobject might have a layout (3.7) different from the layout of a most derived object 
14417: of the same type. A base class subobject might have a polymorphic behavior (12.7) different from the 
14418: polymorphic behavior of a most derived object of the same type. A base class subobject may be of zero size 
14419: (Clause class); however, two subobjects that have the same class type and that belong to the same most 
14420: derived object must not be allocated at the same address (5.10). 〞end note ] 
14421: 10.1 Multiple base classes [class.mi] 
14422: 1 A class can be derived from any number of base classes. [ Note: the use of more than one direct base class 
14423: is often called multiple inheritance. 〞end note ][ Example: 
14424: class A { /. ... / };
14425: class B { /. ... / };
14426: class C { /. ... / };
14427: class D : public A, public B, public C { /. ... / };
14428: 〞end example ] 
14429: 2 [ Note: the order of derivation is not significant except as specified by the semantics of initialization by 
14430: constructor (12.6.2), cleanup (12.4), and storage layout (9.2, class.access.spec). 〞end note ] 
14431: 3 A class shall not be specified as a direct base class of a derived class more than once. [ Note: a class can 
14432: be an indirect base class more than once and can be a direct and an indirect base class. There are limited 
14433: things that can be done with such a class. The non-static data members and member functions of the direct 
14434: base class cannot be referred to in the scope of the derived class. However, the static members, enumerations 
14435: and types can be unambiguously referred to. 〞end note ][ Example: 
14436: class X { /. .../ };
14437: class Y : public X, public X { /. ... / }; // ill-formed
14438: ∫ 10.1 222 
14439: 
14440: c
14441: . ISO/IEC N2800=08-0310 
14442: class L { public: int next; /. ... / };
14443: class A : public L { /. ... / };
14444: class B : public L { /. ... / };
14445: class C : public A, public B { void f(); /. ... / }; // well-formed
14446: class D : public A, public L { void f(); /. ... / }; // well-formed
14447: 〞end example ] 
14448: 4 A base class specifier that does not contain the keyword virtual, specifies a non-virtual base class. A base 
14449: class specifier that contains the keyword virtual, specifies a virtual base class. For each distinct occurrence 
14450: of a non-virtual base class in the class lattice of the most derived class, the most derived object (1.8) shall 
14451: contain a corresponding distinct base class subobject of that type. For each distinct base class that is 
14452: specified virtual, the most derived object shall contain a single base class subobject of that type. [ Example: 
14453: for an object of class type C, each distinct occurrence of a (non-virtual) base class L in the class lattice of 
14454: C corresponds one-to-one with a distinct L subobject within the object of type C. Given the class C defined 
14455: above, an object of class C will have two subobjects of class L as shown below. 
14456: L L 
14457: 6 6 
14458: A B
14459: Q
14460: kQ
14461: Q
14462: Q
14463: 
14464: 3 
14465: 
14466: C 
14467: Figure 2 〞 Non-virtual base 
14468: 5 In such lattices, explicit qualification can be used to specify which subobject is meant. The body of function 
14469: C::f could refer to the member next of each L subobject: 
14470: void C::f() { A::next = B::next; } // well-formed 
14471: Without the A:: or B:: qualifiers, the definition of C::f above would be ill-formed because of ambigu-
14472: ity (10.2). 
14473: 6 For another example, 
14474: class V { /. ... / };
14475: class A : virtual public V { /. ... / };
14476: class B : virtual public V { /. ... / };
14477: class C : public A, public B { /. ... / };
14478: for an object c of class type C, a single subobject of type V is shared by every base subobject of c that has 
14479: a virtual base class of type V. Given the class C defined above, an object of class C will have one subobject 
14480: of class V, as shown below. 
14481: 7 A class can have both virtual and non-virtual base classes of a given type. 
14482: class B { /. ... / };
14483: class X : virtual public B { /. ... / };
14484: class Y : virtual public B { /. ... / };
14485: class Z : public B { /. ... / };
14486: class AA : public X, public Y, public Z { /. ... / };
14487: For an object of class AA, all virtual occurrences of base class B in the class lattice of AA correspond to a 
14488: single B subobject within the object of type AA, and every other occurrence of a (non-virtual) base class B 
14489: ∫ 10.1 223 
14490: 
14491: . ISO/IEC N2800=08-0310 
14492: V 
14493: k
14494: 3 
14495: QQ
14496: Q
14497: Q 
14498: A B
14499: k 
14500: 3
14501: QQ
14502: Q
14503: Q 
14504: 
14505: C 
14506: Figure 3 〞 Virtual base 
14507: in the class lattice of AA corresponds one-to-one with a distinct B subobject within the object of type AA. 
14508: Given the class AA defined above, class AA has two subobjects of class B: Z＊s B and the virtual B shared by X 
14509: and Y, as shown below. 
14510: B B 
14511: k
14512: 3 
14513: QQ
14514: Q
14515: Q 
14516: 6 
14517: 1 Z
14518: X 
14519: QQ
14520: Q
14521: Q 
14522: Y 
14523: 
14524: k 
14525: 3 
14526: AA 
14527: Figure 4 〞 Virtual and non-virtual base 
14528: 〞end example ] 
14529: 10.2 Member name lookup [class.member.lookup] 
14530: 1 Member name lookup determines the meaning of a name (id-expression) in a class scope (3.3.6). Name 
14531: lookup can result in an ambiguity, in which case the program is ill-formed. For an id-expression, name 
14532: lookup begins in the class scope of this; for a qualified-id, name lookup begins in the scope of the nested-
14533: name-specifier. Name lookup takes place before access control (3.4, Clause class.access). 
14534: 2 The following steps define the result of name lookup for a member name f in a class scope C. 
14535: 3 The lookup set for f in C, called S(f, C), consists of two component sets: the declaration set, a set of members 
14536: named f; and the subobject set, a set of subobjects where declarations of these members (possibly including 
14537: using-declarations) were found. In the declaration set, using-declarations are replaced by the members they 
14538: designate, and type declarations (including injected-class-names) are replaced by the types they designate. 
14539: S(f, C) is calculated as follows: 
14540: 4 If C contains a declaration of the name f, the declaration set contains every declaration of f declared in 
14541: C that satisfies the requirements of the language construct in which the lookup occurs. [ Note: Looking 
14542: up a name in an elaborated-type-specifier (3.4.4) or base-specifier (Clause 10), for instance, ignores all non-
14543: type declarations, while looking up a name in a nested-name-specifier (3.4.3) ignores function, object, and 
14544: enumerator declarations. As another example, looking up a name in a using-declaration (7.3.3) includes the 
14545: declaration of a class or enumeration that would ordinarily be hidden by another declaration of that name 
14546: in the same scope. 〞end note ] If the resulting declaration set is not empty, the subobject set contains C 
14547: itself, and calculation is complete. 
14548: 5 Otherwise (i.e., C does not contain a declaration of f or the resulting declaration set is empty), S(f, C) is 
14549: initially empty. If C has base classes, calculate the lookup set for f in each direct base class subobject Bi, 
14550: and merge each such lookup set S(f, Bi) in turn into S(f, C). 
14551: ∫ 10.2 224 
14552: 
14553: c
14554: . ISO/IEC N2800=08-0310 
14555: 6 The following steps define the result of merging lookup set S(f, Bi) into the intermediate S(f, C): 
14556: 〞 If each of the subobject members of S(f, Bi) is a base class subobject of at least one of the subobject 
14557: members of S(f, C), or if S(f, Bi) is empty, S(f, C) is unchanged and the merge is complete. Con-
14558: versely, if each of the subobject members of S(f, C) is a base class subobject of at least one of the 
14559: subobject members of S(f, Bi), or if S(f, C) is empty, the new S(f, C) is a copy of S(f, Bi). 
14560: 〞 Otherwise, if the declaration sets of S(f, Bi) and S(f, C) differ, the merge is ambiguous: the new 
14561: S(f, C) is a lookup set with an invalid declaration set and the union of the subobject sets. In subsequent 
14562: merges, an invalid declaration set is considered different from any other. 
14563: 〞 Otherwise, the new S(f, C) is a lookup set with the shared set of declarations and the union of the 
14564: subobject sets. 
14565: 7 The result of name lookup for f in C is the declaration set of S(f, C). If it is an invalid set, the program is 
14566: ill-formed. [ Example: 
14567: struct A { int x; }; // S(x,A) = { { A::x }, { A } }
14568: struct B { float x; }; // S(x,B) = { { B::x }, { B } }
14569: struct C: public A, public B { }; // S(x,C) = { invalid, { A in C, B in C } }
14570: struct D: public virtual C { }; // S(x,D) = S(x,C)
14571: struct E: public virtual C { char x; }; // S(x,E) = { { E::x }, { E } }
14572: struct F: public D, public E { }; // S(x,F) = S(x,E)
14573: int main() {
14574: F f; 
14575: f.x = 0; // OK, lookup finds E::x
14576: }
14577: S(x, F) is unambiguous because the A and B base subobjects of D are also base subobjects of E, so S(x, D) 
14578: is discarded in the first merge step. 〞end example ] 
14579: 8 If the name of an overloaded function is unambiguously found, overloading resolution (13.3) also takes 
14580: place before access control. Ambiguities can often be resolved by qualifying a name with its class name. 
14581: [ Example: 
14582: struct A {
14583: int f();
14584: };
14585: struct B {
14586: int f();
14587: };
14588: struct C : A, B {
14589: int f() { return A::f() + B::f(); }
14590: };
14591: 〞end example ] 
14592: 9 [ Note: A static member, a nested type or an enumerator defined in a base class T can unambiguously be 
14593: found even if an object has more than one base class subobject of type T. Two base class subobjects share 
14594: the non-static member subobjects of their common virtual base classes. 〞end note ][ Example: 
14595: struct V { 
14596: int v;
14597: };
14598: struct A {
14599: ∫ 10.2 225 
14600: 
14601: c
14602: . ISO/IEC N2800=08-0310 
14603: int a;
14604: static int s;
14605: enum { e };
14606: };
14607: struct B : A, virtual V { };
14608: struct C : A, virtual V { };
14609: struct D : B, C { };
14610: void f(D* pd) {
14611: pd->v++; // OK: only one v (virtual)
14612: pd->s++; // OK: only one s (static)
14613: int i = pd->e; // OK: only one e (enumerator)
14614: pd->a++; // error, ambiguous: two as in D
14615: } 
14616: 〞end example ] 
14617: 10 [ Note: When virtual base classes are used, a hidden declaration can be reached along a path through the 
14618: subobject lattice that does not pass through the hiding declaration. This is not an ambiguity. The identical 
14619: use with non-virtual base classes is an ambiguity; in that case there is no unique instance of the name that 
14620: hides all the others. 〞end note ][ Example: 
14621: struct V { int f(); int x; };
14622: struct W { int g(); int y; };
14623: struct B : virtual V, W {
14624: int f(); int x; 
14625: int g(); int y;
14626: };
14627: struct C : virtual V, W { };
14628: struct D : B, C { void glorp(); }; 
14629: WV W
14630: kk 
14631: 3 3
14632: QQ
14633: Q
14634: Q 
14635: QQ
14636: Q
14637: Q 
14638: 
14639: B C
14640: k 
14641: 3
14642: QQ
14643: Q
14644: Q 
14645: 
14646: D 
14647: Figure 5 〞 Name lookup 
14648: 〞end example ] 
14649: 11 [ Note: The names declared in V and the left-hand instance of W are hidden by those in B, but the names 
14650: declared in the right-hand instance of W are not hidden at all. 〞 end note ] 
14651: void D::glorp() {
14652: x++; // OK: B::x hides V::x
14653: f(); // OK: B::f() hides V::f()
14654: y++; // error: B::y and C＊s W::y
14655: g(); // error: B::g() and C＊s W::g()
14656: } 
14657: 〞end example ] 
14658: ∫ 10.2 226 
14659: 
14660: c
14661: . ISO/IEC N2800=08-0310 
14662: 12 An explicit or implicit conversion from a pointer to or an lvalue of a derived class to a pointer or reference to 
14663: one of its base classes shall unambiguously refer to a unique object representing the base class. [ Example: 
14664: struct V { };
14665: struct A { };
14666: struct B : A, virtual V { };
14667: struct C : A, virtual V { };
14668: struct D : B, C { };
14669: void g() {
14670: D d;
14671: B* pb = &d;
14672: A* pa = &d; // error, ambiguous: C＊s A or B＊s A?
14673: V* pv = &d; // OK: only one V subobject
14674: } 
14675: 〞end example ] 
14676: 13 [ Note: Even if the result of name lookup is unambiguous, use of a name found in multiple subobjects might 
14677: still be ambiguous (4.11, 5.2.5, 11.2). 〞end note ][ Example: 
14678: struct B1 {
14679: void f();
14680: static void f(int);
14681: int i;
14682: };
14683: struct B2 {
14684: void f(double);
14685: };
14686: struct I1: B1 { };
14687: struct I2: B1 { };
14688: struct D: I1, I2, B2 {
14689: using B1::f;
14690: using B2::f;
14691: void g() {
14692: f(); // Ambiguous conversion of this
14693: f(0); // Unambiguous (static)
14694: f(0.0); // Unambiguous (only one B2)
14695: int B1::* mpB1 = &D::i; // Unambiguous
14696: int D::* mpD = &D::i; // Ambiguous conversion
14697: }
14698: };
14699: 〞end example ] 
14700: 10.3 Virtual functions [class.virtual] 
14701: 1 Virtual functions support dynamic binding and object-oriented programming. A class that declares or 
14702: inherits a virtual function is called a polymorphic class. 
14703: 2 If a virtual member function vf is declared in a class Base and in a class Derived, derived directly or indirectly 
14704: from Base, a member function vf with the same name, parameter-type-list (8.3.5), cv-qualification, and ref-
14705: qualifier (or absence of same) as Base::vf is declared, then Derived::vf is also virtual (whether or not 
14706: ∫ 10.3 227 
14707: 
14708: c
14709: . ISO/IEC N2800=08-0310 
14710: it is so declared) and it overrides101 Base::vf. For convenience we say that any virtual function overrides 
14711: itself. Then in any well-formed class, for each virtual function declared in that class or any of its direct or 
14712: indirect base classes there is a unique final overrider that overrides that function and every other overrider 
14713: of that function. The rules for member lookup (10.2) are used to determine the final overrider for a virtual 
14714: function in the scope of a derived class but ignoring names introduced by using-declarations. [ Example: 
14715: struct A { 
14716: virtual void f();
14717: };
14718: struct B : virtual A {
14719: virtual void f();
14720: };
14721: struct C : B , virtual A {
14722: using A::f;
14723: };
14724: void foo() {
14725: C c;
14726: c.f(); // calls B::f, the final overrider
14727: c.C::f(); // calls A::f because of the using-declaration
14728: } 
14729: 〞end example ] 
14730: 3 [ Note: a virtual member function does not have to be visible to be overridden, for example, 
14731: struct B { 
14732: virtual void f();
14733: };
14734: struct D : B {
14735: void f(int);
14736: };
14737: struct D2 : D {
14738: void f();
14739: };
14740: the function f(int) in class D hides the virtual function f() in its base class B; D::f(int) is not a virtual 
14741: function. However, f() declared in class D2 has the same name and the same parameter list as B::f(), and 
14742: therefore is a virtual function that overrides the function B::f() even though B::f() is not visible in class 
14743: D2. 〞end note ] 
14744: 4 Even though destructors are not inherited, a destructor in a derived class overrides a base class destructor 
14745: declared virtual; see class.dtor and class.free. 
14746: 5 The return type of an overriding function shall be either identical to the return type of the overridden 
14747: function or covariant with the classes of the functions. If a function D::f overrides a function B::f, the 
14748: return types of the functions are covariant if they satisfy the following criteria: 
14749: 〞 both are pointers to classes or references to classes102 
14750: 〞 the class in the return type of B::f is the same class as the class in the return type of D::f, or is an 
14751: unambiguous and accessible direct or indirect base class of the class in the return type of D::f 
14752: 101) A function with the same name but a different parameter list (Clause over) as a virtual function is not necessarily virtual 
14753: and does not override. The use of the virtual specifier in the declaration of an overriding function is legal but redundant (has 
14754: empty semantics). Access control (Clause class.access) is not considered in determining overriding. 
14755: 102) Multi-level pointers to classes or references to multi-level pointers to classes are not allowed. 
14756: ∫ 10.3 228 
14757: 
14758: c
14759: . ISO/IEC N2800=08-0310 
14760: 〞 both pointers or references have the same cv-qualification and the class type in the return type of D::f 
14761: has the same cv-qualification as or less cv-qualification than the class type in the return type of B::f. 
14762: 6 If the return type of D::f differs from the return type of B::f, the class type in the return type of D::f shall 
14763: be complete at the point of declaration of D::f or shall be the class type D. When the overriding function 
14764: is called as the final overrider of the overridden function, its result is converted to the type returned by the 
14765: (statically chosen) overridden function (5.2.2). [ Example: 
14766: class B { };
14767: class D : private B { friend class Derived; };
14768: struct Base {
14769: virtual void vf1();
14770: virtual void vf2();
14771: virtual void vf3();
14772: virtual B* vf4();
14773: virtual B* vf5();
14774: void f();
14775: }; 
14776: struct No_good : public Base {
14777: D* vf4(); // error: B (base class of D) inaccessible
14778: };
14779: class A; 
14780: struct Derived : public Base {
14781: void vf1(); // virtual and overrides Base::vf1()
14782: void vf2(int); // not virtual, hides Base::vf2()
14783: char vf3(); // error: invalid difference in return type only
14784: D* vf4(); // OK: returns pointer to derived class
14785: A* vf5(); // error: returns pointer to incomplete class
14786: void f();
14787: }; 
14788: void g() {
14789: Derived d;
14790: Base* bp = &d; // standard conversion:
14791: // Derived* to Base*
14792: bp->vf1(); // calls Derived::vf1()
14793: bp->vf2(); // calls Base::vf2()
14794: bp->f(); // calls Base::f() (not virtual)
14795: B* p = bp->vf4(); // calls Derived::pf() and converts the
14796: // result to B*
14797: Derived* dp = &d;
14798: D* q = dp->vf4(); // calls Derived::pf() and does not
14799: // convert the result to B*
14800: dp->vf2(); // ill-formed: argument mismatch
14801: }
14802: 〞end example ] 
14803: 7 [ Note: the interpretation of the call of a virtual function depends on the type of the object for which it is 
14804: called (the dynamic type), whereas the interpretation of a call of a non-virtual member function depends 
14805: only on the type of the pointer or reference denoting that object (the static type) (5.2.2). 〞end note ] 
14806: 8 [ Note: the virtual specifier implies membership, so a virtual function cannot be a nonmember (7.1.2) 
14807: function. Nor can a virtual function be a static member, since a virtual function call relies on a specific 
14808: ∫ 10.3 229 
14809: 
14810: c
14811: . ISO/IEC N2800=08-0310 
14812: object for determining which function to invoke. A virtual function declared in one class can be declared a 
14813: friend in another class. 〞end note ] 
14814: 9 A virtual function declared in a class shall be defined, or declared pure (10.4) in that class, or both; but no 
14815: diagnostic is required (3.2). 
14816: 10 [ Example: here are some uses of virtual functions with multiple base classes: 
14817: struct A {
14818: virtual void f();
14819: };
14820: struct B1 : A { // note non-virtual derivation
14821: void f();
14822: };
14823: struct B2 : A {
14824: void f();
14825: };
14826: struct D : B1, B2 { // D has two separate A subobjects
14827: };
14828: void foo() {
14829: D d;
14830: // A* ap = &d; // would be ill-formed: ambiguous
14831: B1* b1p = &d;
14832: A* ap=b1p;
14833: D* dp=&d;
14834: ap->f(); // calls D::B1::f
14835: dp->f(); // ill-formed: ambiguous
14836: } 
14837: In class D above there are two occurrences of class A and hence two occurrences of the virtual member 
14838: function A::f. The final overrider of B1::A::f is B1::f and the final overrider of B2::A::f is B2::f. 
14839: 11 The following example shows a function that does not have a unique final overrider: 
14840: struct A {
14841: virtual void f();
14842: };
14843: struct VB1 : virtual A { // note virtual derivation
14844: void f();
14845: };
14846: struct VB2 : virtual A {
14847: void f();
14848: };
14849: struct Error : VB1, VB2 { // ill-formed
14850: };
14851: struct Okay : VB1, VB2 {
14852: void f();
14853: };
14854: ∫ 10.3 230 
14855: 
14856: c
14857: . ISO/IEC N2800=08-0310 
14858: Both VB1::f and VB2::f override A::f but there is no overrider of both of them in class Error. This 
14859: example is therefore ill-formed. Class Okay is well formed, however, because Okay::f is a final overrider. 
14860: 12 The following example uses the well-formed classes from above. 
14861: struct VB1a : virtual A { // does not declare f
14862: };
14863: struct Da : VB1a, VB2 {
14864: };
14865: void foe() {
14866: VB1a* vb1ap = new Da;
14867: vb1ap->f(); // calls VB2::f
14868: } 
14869: 〞end example ] 
14870: 13 Explicit qualification with the scope operator (5.1) suppresses the virtual call mechanism. [ Example: 
14871: class B { public: virtual void f(); };
14872: class D : public B { public: void f(); };
14873: void D::f() { /. ... / B::f(); } 
14874: Here, the function call in D::f really does call B::f and not D::f. 〞end example ] 
14875: 14 A function with a deleted definition (8.4) shall not override a function that does not have a deleted definition. 
14876: Likewise, a function that does not have a deleted definition shall not override a function with a deleted 
14877: definition. 
14878: 10.4 Abstract classes [class.abstract] 
14879: 1 The abstract class mechanism supports the notion of a general concept, such as a shape, of which only more 
14880: concrete variants, such as circle and square, can actually be used. An abstract class can also be used to 
14881: define an interface for which derived classes provide a variety of implementations. 
14882: 2 An abstract class is a class that can be used only as a base class of some other class; no objects of an abstract 
14883: class can be created except as subobjects of a class derived from it. A class is abstract if it has at least 
14884: one pure virtual function.[ Note: such a function might be inherited: see below. 〞end note ] A virtual 
14885: function is specified pure by using a pure-specifier (9.2) in the function declaration in the class definition. A 
14886: pure virtual function need be defined only if called with, or as if with (12.4), the qualified-id syntax (5.1). 
14887: [ Example: 
14888: class point { /. ... / };
14889: class shape { // abstract class
14890: point center;
14891: public:
14892: point where() { return center; }
14893: void move(point p) { center=p; draw(); }
14894: virtual void rotate(int) = 0; // pure virtual
14895: virtual void draw() = 0; // pure virtual
14896: }; 
14897: 〞end example ][ Note: a function declaration cannot provide both a pure-specifier and a definition 〞end 
14898: note ][ Example: 
14899: ∫ 10.4 231 
14900: 
14901: c
14902: . ISO/IEC N2800=08-0310 
14903: struct C { 
14904: virtual void f() = 0 { }; // ill-formed
14905: };
14906: 〞end example ] 
14907: 3 An abstract class shall not be used as a parameter type, as a function return type, or as the type of an 
14908: explicit conversion. Pointers and references to an abstract class can be declared. [ Example: 
14909: shape x; // error: object of abstract class
14910: shape* p; // OK
14911: shape f(); // error
14912: void g(shape); // error
14913: shape& h(shape&); // OK
14914: 〞end example ] 
14915: 4 A class is abstract if it contains or inherits at least one pure virtual function for which the final overrider is 
14916: pure virtual. [ Example: 
14917: class ab_circle : public shape { 
14918: int radius;
14919: public:
14920: void rotate(int) { } 
14921: // ab_circle::draw() is a pure virtual 
14922: }; 
14923: Since shape::draw() is a pure virtual function ab_circle::draw() is a pure virtual by default. The 
14924: alternative declaration, 
14925: class circle : public shape { 
14926: int radius;
14927: public:
14928: void rotate(int) { } 
14929: void draw(); // a definition is required somewhere 
14930: }; 
14931: would make class circle nonabstract and a definition of circle::draw() must be provided. 〞end exam-
14932: ple ] 
14933: 5 [ Note: an abstract class can be derived from a class that is not abstract, and a pure virtual function may 
14934: override a virtual function which is not pure. 〞end note ] 
14935: 6 Member functions can be called from a constructor (or destructor) of an abstract class; the effect of making a 
14936: virtual call (10.3) to a pure virtual function directly or indirectly for the object being created (or destroyed) 
14937: from such a constructor (or destructor) is undefined. 
14938: ∫ 10.4 232 
14939: 
14940: c
14941: . ISO/IEC N2800=08-0310 
14942: 11 Member access control [class.access]
14943: 1 A member of a class can be 
14944: 〞 private; that is, its name can be used only by members and friends of the class in which it is declared. 
14945: 〞 protected; that is, its name can be used only by members and friends of the class in which it is 
14946: declared, by classes derived from that class, and by their friends (see 11.5). 
14947: 〞 public; that is, its name can be used anywhere without access restriction. 
14948: 2 A member of a class can also access all the names to which the class has access. A local class of a member 
14949: function may access the same names that the member function itself may access.103 
14950: 3 Members of a class defined with the keyword class are private by default. Members of a class defined 
14951: with the keywords struct or union are public by default. [ Example: 
14952: class X { 
14953: int a; // X::a is private by default
14954: };
14955: struct S { 
14956: int a; // S::a is public by default
14957: };
14958: 〞end example ] 
14959: 4 Access control is applied uniformly to all names, whether the names are referred to from declarations or 
14960: expressions. [ Note: access control applies to names nominated by friend declarations (11.4) and using-
14961: declarations (7.3.3). 〞 end note ] In the case of overloaded function names, access control is applied to the 
14962: function selected by overload resolution. [ Note: because access control applies to names, if access control is 
14963: applied to a typedef name, only the accessibility of the typedef name itself is considered. The accessibility 
14964: of the entity referred to by the typedef is not considered. For example, 
14965: class A { 
14966: class B { };
14967: public:
14968: typedef B BB;
14969: };
14970: void f() { 
14971: A::BB x; // OK, typedef name A::BB is public 
14972: A::B y; // access error, A::B is private 
14973: } 
14974: 〞end note ] 
14975: 5 It should be noted that it is access to members and base classes that is controlled, not their visibility. Names 
14976: of members are still visible, and implicit conversions to base classes are still considered, when those members 
14977: and base classes are inaccessible. The interpretation of a given construct is established without regard to 
14978: 103) Access permissions are thus transitive and cumulative to nested and local classes. 
14979: 233 
14980: 
14981: c
14982: . ISO/IEC N2800=08-0310 
14983: access control. If the interpretation established makes use of inaccessible member names or base classes, the 
14984: construct is ill-formed. 
14985: 6 All access controls in Clause 11 affect the ability to access a class member name from a particular scope. 
14986: For purposes of access control, the base-specifiers of a class and the definitions of class members that appear 
14987: outside of the class definition are considered to be within the scope of that class. In particular, access 
14988: controls apply as usual to member names accessed as part of a function return type, even though it is not 
14989: possible to determine the access privileges of that use without first parsing the rest of the function declarator. 
14990: Similarly, access control for implicit calls to the constructors, the conversion functions, or the destructor 
14991: called to create and destroy a static data member is performed as if these calls appeared in the scope of the 
14992: member＊s class. [ Example: 
14993: class A {
14994: typedef int I; // private member
14995: I f();
14996: friend I g(I);
14997: static I x;
14998: protected:
14999: struct B { };
15000: };
15001: A::I A::f() { return 0; }
15002: A::I g(A::I p = A::x);
15003: A::I g(A::I p) { return 0; }
15004: A::I A::x = 0;
15005: struct D: A::B, A { }; 
15006: 7 Here, all the uses of A::I are well-formed because A::f and A::x are members of class A and g is a friend 
15007: of class A. This implies, for example, that access checking on the first use of A::I must be deferred until it 
15008: is determined that this use of A::I is as the return type of a member of class A. Similarly, the use of A::B 
15009: as a base-specifier is well-formed because D is derived from A, so checking of base-specifiers must be deferred 
15010: until the entire base-specifier-list has been seen. 〞end example ] 
15011: 8 The names in a default argument expression (8.3.6) are bound at the point of declaration, and access is 
15012: checked at that point rather than at any points of use of the default argument expression. Access checking 
15013: for default arguments in function templates and in member functions of class templates is performed as 
15014: described in 14.7.1. 
15015: 9 The names in a default template-argument (14.1) have their access checked in the context in which they 
15016: appear rather than at any points of use of the default template-argument.[ Example: 
15017: class B { };
15018: template <class T> class C {
15019: protected:
15020: typedef T TT;
15021: };
15022: template <class U, class V = typename U::TT>
15023: class D : public U { };
15024: D <C<B> >* d; // access error, C::TT is protected 
15025: 〞end example ] 
15026: 234 
15027: 
15028: c
15029: . ISO/IEC N2800=08-0310 
15030: 11.1 Access specifiers [class.access.spec] 
15031: 1 Member declarations can be labeled by an access-specifier (Clause 10): 
15032: access-specifier : member-specificationopt 
15033: An access-specifier specifies the access rules for members following it until the end of the class or until 
15034: another access-specifier is encountered. [ Example: 
15035: class X {
15036: int a; // X::a is private by default: class used
15037: public:
15038: int b; // X::b is public
15039: int c; // X::c is public
15040: }; 
15041: 〞end example ] 
15042: 2 Any number of access specifiers is allowed and no particular order is required. [ Example: 
15043: struct S {
15044: int a; // S::a is public by default: struct used
15045: protected:
15046: int b; // S::b is protected
15047: private:
15048: int c; // S::c is private
15049: public:
15050: int d; // S::d is public
15051: };
15052: 〞end example ] 
15053: 3 [ Note: the effect of access control on the order of allocation of data members is described in 9.2. 〞 end note ] 
15054: 4 When a member is redeclared within its class definition, the access specified at its redeclaration shall be the 
15055: same as at its initial declaration. [ Example: 
15056: struct S {
15057: class A;
15058: private:
15059: class A { }; // error: cannot change access
15060: };
15061: 〞end example ] 
15062: 5 [ Note: In a derived class, the lookup of a base class name will find the injected-class-name instead of the 
15063: name of the base class in the scope in which it was declared. The injected-class-name might be less accessible 
15064: than the name of the base class in the scope in which it was declared. 〞end note ] 
15065: [ Example: 
15066: class A { };
15067: class B : private A { };
15068: class C : public B {
15069: A *p; // error: injected-class-name A is inaccessible
15070: ::A *q; // OK
15071: };
15072: ∫ 11.1 235 
15073: 
15074: c
15075: . ISO/IEC N2800=08-0310 
15076: 〞end example ] 
15077: 11.2 Accessibility of base classes and base class members [class.access.base] 
15078: 1 If a class is declared to be a base class (Clause 10) for another class using the public access specifier, the 
15079: public members of the base class are accessible as public members of the derived class and protected 
15080: members of the base class are accessible as protected members of the derived class. If a class is declared to 
15081: be a base class for another class using the protected access specifier, the public and protected members 
15082: of the base class are accessible as protected members of the derived class. If a class is declared to be a base 
15083: class for another class using the private access specifier, the public and protected members of the base 
15084: class are accessible as private members of the derived class104. 
15085: 2 In the absence of an access-specifier for a base class, public is assumed when the derived class is defined with 
15086: the class-key struct and private is assumed when the class is defined with the class-key class.[ Example: 
15087: class B { /. ... / };
15088: class D1 : private B { /. ... / };
15089: class D2 : public B { /. .../ };
15090: class D3 : B { /. ... / }; // B private by default
15091: struct D4 : public B { /. ... / };
15092: struct D5 : private B { /. ... / };
15093: struct D6 : B { /. ... / }; // B public by default
15094: class D7 : protected B { /. ... / };
15095: struct D8 : protected B { /. ... / };
15096: Here B is a public base of D2, D4, and D6, a private base of D1, D3, and D5, and a protected base of D7 and 
15097: D8. 〞end example ] 
15098: 3 [ Note: A member of a private base class might be inaccessible as an inherited member name, but accessible 
15099: directly. Because of the rules on pointer conversions (4.10) and explicit casts (5.4), a conversion from 
15100: a pointer to a derived class to a pointer to an inaccessible base class might be ill-formed if an implicit 
15101: conversion is used, but well-formed if an explicit cast is used. For example, 
15102: class B { 
15103: public:
15104: int mi; // non-static member
15105: static int si; // static member
15106: };
15107: class D : private B {
15108: };
15109: class DD : public D {
15110: void f();
15111: };
15112: void DD::f() {
15113: mi = 3;
15114: si = 3;
15115: ::B b;
15116: b.mi = 3;
15117: b.si = 3;
15118: ::B::si = 3;
15119: ::B* bp1 = this;
15120: ::B* bp2 = (::B*)this;
15121: // error: mi is private in D
15122: // error: si is private in D
15123: // OK ( b.mi is different from this->mi)
15124: // OK ( b.si is different from this->si)
15125: // OK
15126: // error: B is a private base class
15127: // OK with cast
15128: 104) As specified previously in Clause 11, private members of a base class remain inaccessible even to derived classes unless 
15129: friend declarations within the base class definition are used to grant access explicitly. 
15130: ∫ 11.2 236 
15131: 
15132: c
15133: . ISO/IEC N2800=08-0310 
15134: bp2->mi = 3; // OK: access through a pointer to B.
15135: }
15136: 〞end note ] 
15137: 4 A base class B of N is accessible at R, if 
15138: 〞 an invented public member of B would be a public member of N, or 
15139: 〞 R occurs in a member or friend of class N, and an invented public member of B would be a private or 
15140: protected member of N, or 
15141: 〞 R occurs in a member or friend of a class P derived from N, and an invented public member of B would 
15142: be a private or protected member of P, or 
15143: 〞 there exists a class S such that B is a base class of S accessible at R and S is a base class of N accessible 
15144: at R. 
15145: [ Example: 
15146: class B {
15147: public:
15148: int m;
15149: };
15150: class S: private B {
15151: friend class N;
15152: };
15153: class N: private S {
15154: void f() {
15155: B* p = this; // OK because class S satisfies the fourth condition
15156: // above: B is a base class of N accessible in f() because
15157: // B is an accessible base class of S and S is an accessible
15158: // base class of N.
15159: }
15160: };
15161: 〞end example ] 
15162: 5 If a base class is accessible, one can implicitly convert a pointer to a derived class to a pointer to that base 
15163: class (4.10, 4.11). [ Note: it follows that members and friends of a class X can implicitly convert an X* to a 
15164: pointer to a private or protected immediate base class of X. 〞end note ] The access to a member is affected 
15165: by the class in which the member is named. This naming class is the class in which the member name was 
15166: looked up and found. [ Note: this class can be explicit, e.g., when a qualified-id is used, or implicit, e.g., 
15167: when a class member access operator (5.2.5) is used (including cases where an implicit ※this->§ is added). 
15168: If both a class member access operator and a qualified-id are used to name the member (as in p->T::m), 
15169: the class naming the member is the class named by the nested-name-specifier of the qualified-id (that is, T). 
15170: 〞end note ] A member m is accessible at the point R when named in class N if 
15171: 〞 m as a member of N is public, or 
15172: 〞 m as a member of N is private, and R occurs in a member or friend of class N, or 
15173: 〞 m as a member of N is protected, and R occurs in a member or friend of class N, or in a member or 
15174: friend of a class P derived from N, where m as a member of P is public, private, or protected, or 
15175: ∫ 11.2 237 
15176: 
15177: c
15178: . ISO/IEC N2800=08-0310 
15179: 〞 there exists a base class B of N that is accessible at R, and m is accessible at R when named in class B. 
15180: [ Example: 
15181: class B;
15182: class A {
15183: private:
15184: int i; 
15185: friend void f(B*);
15186: };
15187: class B : public A { };
15188: void f(B* p) {
15189: p->i = 1; // OK: B* can be implicitly converted to A*,
15190: // and f has access to i in A
15191: }
15192: 〞end example ] 
15193: 6 If a class member access operator, including an implicit ※this->,§ is used to access a non-static data member 
15194: or non-static member function, the reference is ill-formed if the left operand (considered as a pointer in the 
15195: ※.§ operator case) cannot be implicitly converted to a pointer to the naming class of the right operand. 
15196: [ Note: this requirement is in addition to the requirement that the member be accessible as named. 〞end 
15197: note ] 
15198: 11.3 Access declarations [class.access.dcl] 
15199: 1 The access of a member of a base class can be changed in the derived class by mentioning its qualified-id in 
15200: the derived class definition. Such mention is called an access declaration. The effect of an access declaration 
15201: 105 
15202: qualified-id ; is defined to be equivalent to the declaration using qualified-id ;.
15203: [ Example:
15204: class A { 
15205: public:
15206: int z;
15207: int z1;
15208: }; 
15209: class B : public A {
15210: int a;
15211: public:
15212: int b, c;
15213: int bf();
15214: protected:
15215: int x;
15216: int y;
15217: }; 
15218: class D : private B {
15219: int d;
15220: public:
15221: B::c; // adjust access to B::c
15222: 105) Access declarations are deprecated; member using-declarations (7.3.3) provide a better means of doing the same things. 
15223: In earlier versions of the C++ language, access declarations were more limited; they were generalized and made equivalent to 
15224: using-declarations in the interest of simplicity. Programmers are encouraged to use using-declarations, rather than the new 
15225: capabilities of access declarations, in new code. 
15226: ∫ 11.3 238 
15227: 
15228: c
15229: . ISO/IEC N2800=08-0310 
15230: B::z; // adjust access to A::z
15231: A::z1; // adjust access to A::z1
15232: int e;
15233: int df();
15234: protected:
15235: B::x; // adjust access to B::x
15236: int g;
15237: }; 
15238: class X : public D {
15239: int xf();
15240: };
15241: int ef(D&);
15242: int ff(X&);
15243: The external function ef can use only the names c, z, z1, e, and df. Being a member of D, the function df 
15244: can use the names b, c, z, z1, bf, x, y, d, e, df, and g, but not a. Being a member of B, the function bf 
15245: can use the members a, b, c, z, z1, bf, x, and y. The function xf can use the public and protected names 
15246: from D, that is, c, z, z1, e, and df (public), and x, and g (protected). Thus the external function ff has 
15247: access only to c, z, z1, e, and df. If D were a protected or private base class of X, xf would have the same 
15248: privileges as before, but ff would have no access at all. 〞end example ] 
15249: 11.4 Friends [class.friend] 
15250: 1 A friend of a class is a function or class that is given permission to use the private and protected member 
15251: names from the class. A class specifies its friends, if any, by way of friend declarations. Such declarations give 
15252: special access rights to the friends, but they do not make the nominated friends members of the befriending 
15253: class. [ Example: the following example illustrates the differences between members and friends: 
15254: class X {
15255: int a;
15256: friend void friend_set(X*, int);
15257: public:
15258: void member_set(int);
15259: };
15260: void friend_set(X* p, int i) { p->a = i; }
15261: void X::member_set(int i) { a = i; }
15262: void f() {
15263: X obj;
15264: friend_set(&obj,10);
15265: obj.member_set(10);
15266: } 
15267: 〞end example ] 
15268: 2 Declaring a class to be a friend implies that the names of private and protected members from the class 
15269: granting friendship can be accessed in the base-specifiers and member declarations of the befriended class. 
15270: [ Example: 
15271: class A {
15272: class B { };
15273: friend class X;
15274: }; 
15275: ∫ 11.4 239 
15276: 
15277: c
15278: . ISO/IEC N2800=08-0310 
15279: struct X : A::B { // OK: A::B accessible to friend
15280: A::B mx; // OK: A::B accessible to member of friend
15281: class Y {
15282: A::B my; // OK: A::B accessible to nested member of friend
15283: };
15284: };
15285: 〞end example ] A class shall not be defined in a friend declaration. [ Example: 
15286: class X {
15287: enum { a=100 };
15288: friend class Y;
15289: }; 
15290: class Y {
15291: int v[X::a]; // OK, Y is a friend of X
15292: };
15293: class Z {
15294: int v[X::a]; // error: X::a is private
15295: };
15296: 〞end example ] 
15297: 3 A friend declaration that does not declare a function shall have one of the following forms: 
15298: friend elaborated-type-specifier ;
15299: friend simple-type-specifier ;
15300: friend typename-specifier ;
15301: [ Note: a friend declaration may be the declaration in a template-declaration (Clause 14, 14.5.4). 〞end 
15302: note ] If the type specifier in a friend declaration designates a (possibly cv-qualified) class type, that class 
15303: is declared as a friend; otherwise, the friend declaration is ignored. [ Example: 
15304: class C;
15305: typedef C Ct;
15306: class X1 {
15307: friend C; // OK: class C is a friend
15308: };
15309: class X2 {
15310: friend Ct; // OK: class C is a friend
15311: friend D; // error: no type-name D in scope
15312: friend class D; // OK: elaborated-type-specifier declares new class
15313: }; 
15314: template <typename T> class R {
15315: friend T;
15316: };
15317: R<C> rc; // class C is a friend of R<C>
15318: R<int> Ri; // OK: "friend int;" is ignored
15319: 〞end example ] 
15320: ∫ 11.4 240 
15321: 
15322: c
15323: . ISO/IEC N2800=08-0310 
15324: 4 A function first declared in a friend declaration has external linkage (3.5). Otherwise, the function retains 
15325: its previous linkage (7.1.1). 
15326: 5 When a friend declaration refers to an overloaded name or operator, only the function specified by the 
15327: parameter types becomes a friend. A member function of a class X can be a friend of a class Y.[ Example: 
15328: class Y { 
15329: friend char* X::foo(int); 
15330: friend X::X(char); // constructors can be friends 
15331: friend X::~X(); // destructors can be friends 
15332: }; 
15333: 〞end example ] 
15334: 6 A function can be defined in a friend declaration of a class if and only if the class is a non-local class (9.8), 
15335: the function name is unqualified, and the function has namespace scope. [ Example: 
15336: class M {
15337: friend void f() { } // definition of global f, a friend of M,
15338: // not the definition of a member function
15339: }; 
15340: 〞end example ] 
15341: 7 Such a function is implicitly inline.A friend function defined in a class is in the (lexical) scope of the 
15342: class in which it is defined. A friend function defined outside the class is not (3.4.1). 
15343: 8 No storage-class-specifier shall appear in the decl-specifier-seq of a friend declaration. 
15344: 9 A name nominated by a friend declaration shall be accessible in the scope of the class containing the friend 
15345: declaration. The meaning of the friend declaration is the same whether the friend declaration appears in 
15346: the private, protected or public (9.2) portion of the class member-specification. 
15347: 10 Friendship is neither inherited nor transitive. [ Example: 
15348: class A { 
15349: friend class B; 
15350: int a; 
15351: }; 
15352: class B { 
15353: friend class C;
15354: };
15355: class C {
15356: void f(A* p) {
15357: p->a++; // error: C is not a friend of A
15358: // despite being a friend of a friend
15359: }
15360: };
15361: class D : public B {
15362: void f(A* p) {
15363: p->a++; // error: D is not a friend of A
15364: // despite being derived from a friend
15365: }
15366: };
15367: ∫ 11.4 241 
15368: 
15369: c
15370: . ISO/IEC N2800=08-0310 
15371: 〞end example ] 
15372: 11 If a friend declaration appears in a local class (9.8) and the name specified is an unqualified name, a prior 
15373: declaration is looked up without considering scopes that are outside the innermost enclosing non-class scope. 
15374: For a friend function declaration, if there is no prior declaration, the program is ill-formed. For a friend class 
15375: declaration, if there is no prior declaration, the class that is specified belongs to the innermost enclosing 
15376: non-class scope, but if it is subsequently referenced, its name is not found by name lookup until a matching 
15377: declaration is provided in the innermost enclosing nonclass scope. [ Example: 
15378: class X;
15379: void a();
15380: void f() {
15381: class Y;
15382: extern void b();
15383: class A {
15384: friend class X; // OK, but X is a local class, not ::X
15385: friend class Y; // OK
15386: friend class Z; // OK, introduces local class Z
15387: friend void a(); // error, ::a is not considered
15388: friend void b(); // OK
15389: friend void c(); // error
15390: };
15391: X *px; // OK, but ::X is found
15392: Z *pz; // error, no Z is found
15393: } 
15394: 〞end example ] 
15395: 11.5 Protected member access [class.protected] 
15396: 1 An additional access check beyond those described earlier in Clause 11 is applied when a non-static data 
15397: member or non-static member function is a protected member of its naming class (11.2)106 As described 
15398: earlier, access to a protected member is granted because the reference occurs in a friend or member of some 
15399: class C. If the access is to form a pointer to member (5.3.1), the nested-name-specifier shall name C or a 
15400: class derived from C. All other accesses involve a (possibly implicit) object expression (5.2.5). In this case, 
15401: the class of the object expression shall be C or a class derived from C.[ Example: 
15402: class B { 
15403: protected:
15404: int i;
15405: static int j;
15406: }; 
15407: class D1 : public B {
15408: };
15409: class D2 : public B {
15410: friend void fr(B*,D1*,D2*);
15411: void mem(B*,D1*);
15412: }; 
15413: void fr(B* pb, D1* p1, D2* p2) {
15414: pb->i = 1; // ill-formed
15415: p1->i = 2; // ill-formed
15416: 106) This additional check does not apply to other members, e.g. static data members or enumerator member constants. 
15417: ∫ 11.5 242 
15418: 
15419: c
15420: . ISO/IEC N2800=08-0310 
15421: p2->i = 3; // OK (access through a D2)
15422: p2->B::i = 4; // OK (access through a D2, even though
15423: // naming class is B)
15424: int B::* pmi_B = &B::i; // ill-formed
15425: int B::* pmi_B2 = &D2::i; // OK (type of &D2::i is int B::*)
15426: B::j = 5; // OK (because refers to static member)
15427: D2::j =6; // OK (because refers to static member)
15428: } 
15429: void D2::mem(B* pb, D1* p1) {
15430: pb->i = 1; // ill-formed
15431: p1->i = 2; // ill-formed
15432: i = 3; // OK (access through this)
15433: B::i = 4; // OK (access through this, qualification ignored)
15434: int B::* pmi_B = &B::i; // ill-formed
15435: int B::* pmi_B2 = &D2::i; // OK
15436: j = 5; // OK (because j refers to static member)
15437: B::j = 6; // OK (because B::j refers to static member)
15438: } 
15439: void g(B* pb, D1* p1, D2* p2) {
15440: pb->i = 1; // ill-formed
15441: p1->i = 2; // ill-formed
15442: p2->i = 3; // ill-formed
15443: } 
15444: 〞end example ] 
15445: 11.6 Access to virtual functions [class.access.virt] 
15446: 1 The access rules (Clause 11) for a virtual function are determined by its declaration and are not affected by 
15447: the rules for a function that later overrides it. [ Example: 
15448: class B {
15449: public:
15450: virtual int f();
15451: };
15452: class D : public B {
15453: private:
15454: int f();
15455: };
15456: void f() {
15457: D d;
15458: B* pb = &d;
15459: D* pd = &d;
15460: pb->f(); // OK: B::f() is public,
15461: // D::f() is invoked
15462: pd->f(); // error: D::f() is private
15463: }
15464: 〞end example ] 
15465: ∫ 11.6 243 
15466: 
15467: c
15468: . ISO/IEC N2800=08-0310 
15469: 2 Access is checked at the call point using the type of the expression used to denote the object for which the 
15470: member function is called (B* in the example above). The access of the member function in the class in 
15471: which it was defined (D in the example above) is in general not known. 
15472: 11.7 Multiple access [class.paths] 
15473: 1 If a name can be reached by several paths through a multiple inheritance graph, the access is that of the 
15474: path that gives most access. [ Example: 
15475: class W { public: void f(); };
15476: class A : private virtual W { };
15477: class B : public virtual W { };
15478: class C : public A, public B {
15479: void f() { W::f(); } // OK
15480: };
15481: 2 Since W::f() is available to C::f() along the public path through B, access is allowed. 〞end example ] 
15482: 11.8 Nested classes [class.access.nest] 
15483: 1 A nested class is a member and as such has the same access rights as any other member. The members of 
15484: an enclosing class have no special access to members of a nested class; the usual access rules (Clause 11) 
15485: shall be obeyed. [ Example: 
15486: class E {
15487: int x;
15488: class B { };
15489: class I {
15490: B b; // OK: E::I can access E::B
15491: int y;
15492: void f(E* p, int i) {
15493: p->x = i; // OK: E::I can access E::x
15494: }
15495: };
15496: int g(I* p) {
15497: return p->y; // error: I::y is private
15498: }
15499: };
15500: 〞end example ] 
15501: ∫ 11.8 244 
15502: 
15503: . ISO/IEC N2800=08-0310 
15504: 12 Special member functions [special]
15505: The default constructor (12.1), copy constructor and copy assignment operator (12.8), and destructor (12.4) 
15506: are special member functions.[ Note: The implementation will implicitly declare these member functions 
15507: for some class types when the program does not explicitly declare them. The implementation will implicitly 
15508: define them if they are used. See 12.1, 12.4 and 12.8. 〞end note ] Programs shall not define implicitly-
15509: declared special member functions. Programs may explicitly refer to implicitly-declared special member 
15510: functions. [ Example: a program may explicitly call, take the address of or form a pointer to member to an 
15511: implicitly-declared special member function. 
15512: struct A { }; 
15513: struct B : A { 
15514: B& operator=(const B &); 
15515: }; 
15516: B& B::operator=(const B& s) { 
15517: this->A::operator=(s); 
15518: return *this; 
15519: } 
15520: 〞end example ] 
15521: // implicitly-declared A::operator= 
15522: // well-formed 
15523: 2 [ Note: the special member functions affect the way objects of class type are created, copied, and destroyed, 
15524: and how values can be converted to values of other types. Often such special member functions are called 
15525: implicitly. 〞end note ] 
15526: 3 Special member functions obey the usual access rules (Clause 11). [ Example: declaring a constructor 
15527: protected ensures that only derived classes and friends can create objects using it. 〞end example ] 
15528: 12.1 Constructors [class.ctor] 
15529: 1 Constructors do not have names. A special declarator syntax using an optional sequence of function-
15530: specifiers (7.1.2) followed by the constructor＊s class name followed by a parameter list is used to declare or 
15531: define the constructor. In such a declaration, optional parentheses around the constructor class name are 
15532: ignored. [ Example: 
15533: struct S {
15534: S(); // declares the constructor
15535: };
15536: S::S() { } // defines the constructor 
15537: 〞end example ] 
15538: 2 A constructor is used to initialize objects of its class type. Because constructors do not have names, they are 
15539: never found during name lookup; however an explicit type conversion using the functional notation (5.2.3) 
15540: will cause a constructor to be called to initialize an object. [ Note: for initialization of objects of class type 
15541: see 12.6. 〞end note ] 
15542: 3 A typedef-name shall not be used as the class-name in the declarator-id for a constructor declaration. 
15543: 4 A constructor shall not be virtual (10.3) or static (9.4). A constructor can be invoked for a const, 
15544: volatile or const volatile object. A constructor shall not be declared const, volatile, or const 
15545: ∫ 12.1 245 
15546: 
15547: c
15548: . ISO/IEC N2800=08-0310 
15549: volatile (9.3.2). const and volatile semantics (7.1.6.1) are not applied on an object under construction. 
15550: They come into effect when the constructor for the most derived object (1.8) ends. A constructor shall not 
15551: be declared with a ref-qualifier. 
15552: 5 A default constructor for a class X is a constructor of class X that can be called without an argument. If 
15553: there is no user-declared constructor for class X, a constructor having no parameters is implicitly declared. 
15554: An implicitly-declared default constructor is an inline public member of its class. A default constructor 
15555: is trivial if it is not user-provided (8.4) and if: 
15556: 〞 its class has no virtual functions (10.3) and no virtual base classes (10.1), and 
15557: 〞 no non-static data member of its class has a brace-or-equal-initializer, and 
15558: 〞 all the direct base classes of its class have trivial default constructors, and 
15559: 〞 for all the non-static data members of its class that are of class type (or array thereof), each such class 
15560: has a trivial default constructor. 
15561: An implicitly-declared default constructor for class X is defined as deleted if: 
15562: 〞 X is a union-like class that has a variant member with a non-trivial default constructor, 
15563: 〞 any non-static data member is of reference type, 
15564: 〞 any non-static data member of const-qualified type (or array thereof) does not have a user-provided 
15565: default constructor, or 
15566: 〞 any non-static data member or direct or virtual base class has class type M (or array thereof) and 
15567: M has no default constructor, or if overload resolution (13.3) as applied to M＊s default constructor, 
15568: results in an ambiguity or a function that is deleted or inaccessible from the implicitly-declared default 
15569: constructor. 
15570: Otherwise, the default constructor is non-trivial. 
15571: 6 A non-user-provided default constructor for a class is implicitly defined when it is used (3.2) to create 
15572: an object of its class type (1.8). If the implicitly-defined default constructor is explicitly defaulted but 
15573: the corresponding implicit declaration would have been deleted, the program is ill-formed. The implicitly-
15574: defined or explicitly-defaulted default constructor performs the set of initializations of the class that would be 
15575: performed by a user-written default constructor for that class with no ctor-initializer (12.6.2) and an empty 
15576: compound-statement. If that user-written default constructor would be ill-formed, the program is ill-formed. 
15577: If that user-written default constructor would satisfy the requirements of a constexpr constructor (7.1.5), 
15578: the implicitly-defined default constructor is constexpr. Before the non-user-provided default constructor for 
15579: a class is implicitly defined, all the non-user-provided default constructors for its base classes and its non-
15580: static data members shall have been implicitly defined. [ Note: an implicitly-declared default constructor has 
15581: an exception-specification (15.4). An explicitly-defaulted definition has no implicit exception-specification. 
15582: 〞end note ] 
15583: 7 Default constructors are called implicitly to create class objects of static, thread, or automatic storage 
15584: duration (3.7.1, 3.7.2, 3.7.3) defined without an initializer (8.5), are called to create class objects of dynamic 
15585: storage duration (3.7.4) created by a new-expression in which the new-initializer is omitted (5.3.4), or 
15586: are called when the explicit type conversion syntax (5.2.3) is used. A program is ill-formed if the default 
15587: constructor for an object is implicitly used and the constructor is not accessible (Clause 11). 
15588: 8 [ Note: 12.6.2 describes the order in which constructors for base classes and non-static data members are 
15589: called and describes how arguments can be specified for the calls to these constructors. 〞end note ] 
15590: 9 A copy constructor (12.8) is used to copy objects of class type. 
15591: ∫ 12.1 246 
15592: 
15593: c
15594: . ISO/IEC N2800=08-0310 
15595: 10 No return type (not even void) shall be specified for a constructor. A return statement in the body of a 
15596: constructor shall not specify a return value. The address of a constructor shall not be taken. 
15597: 11 A functional notation type conversion (5.2.3) can be used to create new objects of its type. [ Note: The 
15598: syntax looks like an explicit call of the constructor. 〞end note ][ Example: 
15599: complex zz = complex(1,2.3);
15600: cprint( complex(7.8,1.2) );
15601: 〞end example ] 
15602: 12 An object created in this way is unnamed. [ Note: 12.2 describes the lifetime of temporary objects. 〞end 
15603: note ][ Note: explicit constructor calls do not yield lvalues, see 3.10. 〞end note ] 
15604: 13 [ Note: some language constructs have special semantics when used during construction; see 12.6.2 and 12.7. 
15605: 〞end note ] 
15606: 14 During the construction of a const object, if the value of the object or any of its subobjects is accessed 
15607: through an lvalue that is not obtained, directly or indirectly, from the constructor＊s this pointer, the value 
15608: of the object or subobject thus obtained is unspecified. [ Example: 
15609: struct C;
15610: void no_opt(C*);
15611: struct C {
15612: int c;
15613: C() : c(0) { no_opt(this); }
15614: }; 
15615: const C cobj; 
15616: void no_opt(C* cptr) {
15617: int i = cobj.c * 100; // value of cobj.c is unspecified
15618: cptr->c = 1;
15619: cout << cobj.c * 100 // value of cobj.c is unspecified
15620: << ＊\n＊;
15621: }
15622: 〞end example ] 
15623: 12.2 Temporary objects [class.temporary] 
15624: 1 Temporaries of class type are created in various contexts: binding an rvalue to a reference (8.5.3), returning 
15625: an rvalue (6.6.3), a conversion that creates an rvalue (4.1, 5.2.9, 5.2.11, 5.4), throwing an exception (15.1), 
15626: entering a handler (15.3), and in some initializations (8.5). [ Note: the lifetime of exception objects is 
15627: described in 15.1. 〞end note ] Even when the creation of the temporary object is avoided (12.8), all the 
15628: semantic restrictions shall be respected as if the temporary object had been created. [ Example: even if 
15629: the copy constructor is not called, all the semantic restrictions, such as accessibility (Clause 11), shall be 
15630: satisfied. 〞 end example ] 
15631: [ Example: 
15632: class X { 
15633: public:
15634: X(int);
15635: X(const X&);
15636: ~X();
15637: ∫ 12.2 247 
15638: 
15639: c
15640: . ISO/IEC N2800=08-0310 
15641: }; 
15642: X f(X); 
15643: void g() {
15644: X a(1);
15645: X b = f(X(2));
15646: a = f(a);
15647: } 
15648: 2 Here, an implementation might use a temporary in which to construct X(2) before passing it to f() using 
15649: X＊s copy-constructor; alternatively, X(2) might be constructed in the space used to hold the argument. Also, 
15650: a temporary might be used to hold the result of f(X(2)) before copying it to b using X＊s copy-constructor; 
15651: alternatively, f()＊s result might be constructed in b. On the other hand, the expression a=f(a) requires a 
15652: temporary for the result of f(a), which is then assigned to a. 〞 end example ] 
15653: 3 When an implementation introduces a temporary object of a class that has a non-trivial constructor (12.1, 
15654: 12.8), it shall ensure that a constructor is called for the temporary object. Similarly, the destructor shall be 
15655: called for a temporary with a non-trivial destructor (12.4). Temporary objects are destroyed as the last step 
15656: in evaluating the full-expression (1.9) that (lexically) contains the point where they were created. This is true 
15657: even if that evaluation ends in throwing an exception. The value computations and side effects of destroying 
15658: a temporary object are associated only with the full-expression, not with any specific subexpression. 
15659: 4 There are two contexts in which temporaries are destroyed at a different point than the end of the full-
15660: expression. The first context is when a default constructor is called to initialize an element of an array. If 
15661: the constructor has one or more default arguments, the destruction of every temporary created in a default 
15662: argument expression is sequenced before the construction of the next array element, if any. 
15663: 5 The second context is when a reference is bound to a temporary. The temporary to which the reference is 
15664: bound or the temporary that is the complete object of a subobject to which the reference is bound persists 
15665: for the lifetime of the reference except as specified below. A temporary bound to a reference member in a 
15666: constructor＊s ctor-initializer (12.6.2) persists until the constructor exits. A temporary bound to a reference 
15667: parameter in a function call (5.2.2) persists until the completion of the full-expression containing the call. 
15668: A temporary bound to the returned value in a function return statement (6.6.3) persists until the function 
15669: exits. A temporary bound to a reference in a new-initializer (5.3.4) persists until the completion of the 
15670: full-expression containing the new-initializer.[ Example: 
15671: struct S { int mi; const std::pair<int,int>& mp; };
15672: S a { 1, {2,3} };
15673: S* p = new S{ 1, {2,3} }; // Creates dangling reference
15674: 〞end example ][ Note: This may introduce a dangling reference, and implementations are encouraged to 
15675: issue a warning in such a case. 〞end note ] The destruction of a temporary whose lifetime is not extended 
15676: by being bound to a reference is sequenced before the destruction of every temporary which is constructed 
15677: earlier in the same full-expression. If the lifetime of two or more temporaries to which references are bound 
15678: ends at the same point, these temporaries are destroyed at that point in the reverse order of the completion of 
15679: their construction. In addition, the destruction of temporaries bound to references shall take into account the 
15680: ordering of destruction of objects with static, thread, or automatic storage duration (3.7.1, 3.7.2, 3.7.3); that 
15681: is, if obj1 is an object with the same storage duration as the temporary and created before the temporary is 
15682: created the temporary shall be destroyed before obj1 is destroyed; if obj2 is an object with the same storage 
15683: duration as the temporary and created after the temporary is created the temporary shall be destroyed after 
15684: obj2 is destroyed. [ Example: 
15685: struct S { 
15686: ∫ 12.2 248 
15687: 
15688: c
15689: . ISO/IEC N2800=08-0310 
15690: S();
15691: S(int);
15692: friend S operator+(const S&, const S&);
15693: ~S();
15694: };
15695: S obj1;
15696: const S& cr = S(16)+S(23);
15697: S obj2;
15698: the expression C(16)+C(23) creates three temporaries. A first temporary T1 to hold the result of the 
15699: expression C(16), a second temporary T2 to hold the result of the expression C(23), and a third temporary 
15700: T3 to hold the result of the addition of these two expressions. The temporary T3 is then bound to the reference 
15701: cr. It is unspecified whether T1 or T2 is created first. On an implementation where T1 is created before 
15702: T2, it is guaranteed that T2 is destroyed before T1. The temporaries T1 and T2 are bound to the reference 
15703: parameters of operator+; these temporaries are destroyed at the end of the full-expression containing the 
15704: call to operator+. The temporary T3 bound to the reference cr is destroyed at the end of cr＊s lifetime, 
15705: that is, at the end of the program. In addition, the order in which T3 is destroyed takes into account the 
15706: destruction order of other objects with static storage duration. That is, because obj1 is constructed before 
15707: T3, and T3 is constructed before obj2, it is guaranteed that obj2 is destroyed before T3, and that T3 is 
15708: destroyed before obj1. 〞end example ] 
15709: 12.3 Conversions [class.conv] 
15710: 1 Type conversions of class objects can be specified by constructors and by conversion functions. These 
15711: conversions are called user-defined conversions and are used for implicit type conversions (Clause 4), for 
15712: initialization (8.5), and for explicit type conversions (5.4, 5.2.9). 
15713: 2 User-defined conversions are applied only where they are unambiguous (10.2, 12.3.2). Conversions obey the 
15714: access control rules (Clause 11). Access control is applied after ambiguity resolution (3.4). 
15715: 3 [ Note: See 13.3 for a discussion of the use of conversions in function calls as well as examples below. 〞end 
15716: note ] 
15717: 4 At most one user-defined conversion (constructor or conversion function) is implicitly applied to a single 
15718: value. 
15719: [ Example: 
15720: struct X {
15721: operator int();
15722: };
15723: struct Y {
15724: operator X();
15725: };
15726: Y a;
15727: int b = a; // error
15728: // a.operator X().operator int() not tried
15729: int c = X(a); // OK: a.operator X().operator int()
15730: 〞end example ] 
15731: 5 User-defined conversions are used implicitly only if they are unambiguous. A conversion function in a 
15732: derived class does not hide a conversion function in a base class unless the two functions convert to the same 
15733: ∫ 12.3 249 
15734: 
15735: c
15736: . ISO/IEC N2800=08-0310 
15737: type. Function overload resolution (13.3.3) selects the best conversion function to perform the conversion. 
15738: [ Example: 
15739: struct X {
15740: operator int();
15741: };
15742: struct Y : X {
15743: operator char();
15744: };
15745: void f(Y& a) {
15746: if (a) { // ill-formed:
15747: // X::operator int() or Y::operator char()
15748: }
15749: }
15750: 〞end example ] 
15751: 12.3.1 Conversion by constructor [class.conv.ctor] 
15752: 1 A constructor declared without the function-specifier explicit specifies a conversion from the types of its 
15753: parameters to the type of its class. Such a constructor is called a converting constructor.[ Example: 
15754: struct X {
15755: X(int);
15756: X(const char*, int =0);
15757: }; 
15758: void f(X arg) {
15759: X a = 1; // a = X(1)
15760: X b = "Jessie"; // b = X("Jessie",0)
15761: a = 2; // a = X(2)
15762: f(3); // f(X(3))
15763: } 
15764: 〞end example ] 
15765: 2 An explicit constructor constructs objects just like non-explicit constructors, but does so only where the 
15766: direct-initialization syntax (8.5) or where casts (5.2.9, 5.4) are explicitly used. A default constructor 
15767: may be an explicit constructor; such a constructor will be used to perform default-initialization or value-
15768: initialization (8.5). [ Example: 
15769: struct Z {
15770: explicit Z();
15771: explicit Z(int);
15772: }; 
15773: Z a;
15774: Z a1 = 1;
15775: Z a3 = Z(1);
15776: Z a2(1);
15777: Z* p = new Z(1);
15778: Z a4 = (Z)1;
15779: Z a5 = static_cast<Z>(1);
15780: // OK: default-initialization performed 
15781: // error: no implicit conversion 
15782: // OK: direct initialization syntax used 
15783: // OK: direct initialization syntax used 
15784: // OK: direct initialization syntax used 
15785: // OK: explicit cast used 
15786: // OK: explicit cast used 
15787: 〞end example ] 
15788: ∫ 12.3.1 250 
15789: 
15790: c
15791: . ISO/IEC N2800=08-0310 
15792: 3 A non-explicit copy-constructor (12.8) is a converting constructor. An implicitly-declared copy constructor 
15793: is not an explicit constructor; it may be called for implicit type conversions. 
15794: 12.3.2 Conversion functions [class.conv.fct] 
15795: 1 A member function of a class X having no parameters, or an associated function of a concept whose sole 
15796: parameter is of type X, with a name of the form 
15797: conversion-function-id:
15798: operator conversion-type-id
15799: conversion-type-id:
15800: type-specifier-seq attribute-specifieropt conversion-declaratoropt
15801: conversion-declarator:
15802: ptr-operator conversion-declaratoropt
15803: specifies a conversion from X to the type specified by the conversion-type-id. Such functions are called 
15804: conversion functions. No return type can be specified. If a conversion function is a member function, the 
15805: type of the conversion function (8.3.5) is ※function taking no parameter returning conversion-type-id§; if 
15806: a conversion function is an associated function, the type of the conversion function is ※function taking a 
15807: parameter of type X returning conversion-type-id§. A conversion function is never used to convert a (possibly 
15808: cv-qualified) object to the (possibly cv-qualified) same object type (or a reference to it), to a (possibly cv-
15809: qualified) base class of that type (or a reference to it), or to (possibly cv-qualified) void.107 
15810: [ Example: 
15811: struct X {
15812: operator int();
15813: };
15814: void f(X a) {
15815: int i = int(a);
15816: i = (int)a;
15817: i = a;
15818: } 
15819: In all three cases the value assigned will be converted by X::operator int(). 〞end example ] 
15820: 2 A conversion function may be explicit (7.1.2), in which case it is only considered as a user-defined conversion 
15821: for direct-initialization (8.5). Otherwise, user-defined conversions are not restricted to use in assignments 
15822: and initializations. [ Example: 
15823: class Y { };
15824: struct Z {
15825: explicit operator Y() const;
15826: };
15827: void h(Z z) {
15828: Y y1(z); // OK: direct-initialization
15829: Y y2 = z; // ill-formed: copy-initialization
15830: Y y3 = (Y)z; // OK: cast notation
15831: } 
15832: void g(X a, X b) {
15833: int i = (a) ? 1+a : 0;
15834: 107) Even though never directly called to perform a conversion, such conversion functions can be declared and can potentially 
15835: be reached through a call to a virtual conversion function in a base class 
15836: ∫ 12.3.2 251 
15837: 
15838: c
15839: . ISO/IEC N2800=08-0310 
15840: int j = (a&&b) ? a+b : i;
15841: if (a) {
15842: }
15843: } 
15844: 〞end example ] 
15845: 3 The conversion-type-id shall not represent a function type nor an array type. The conversion-type-id in 
15846: a conversion-function-id is the longest possible sequence of conversion-declarators. [ Note: this prevents 
15847: ambiguities between the declarator operator * and its expression counterparts. [ Example: 
15848: &ac.operator int*i; // syntax error: 
15849: // parsed as: &(ac.operator int *)i 
15850: // not as: &(ac.operator int)*i 
15851: The * is the pointer declarator and not the multiplication operator. 〞 end example ] 〞 end note ] 
15852: 4 Conversion functions are inherited. 
15853: 5 Conversion functions can be virtual. 
15854: 6 Conversion functions cannot be declared static. 
15855: 12.4 Destructors [class.dtor] 
15856: 1 A special declarator syntax using an optional function-specifier (7.1.2) followed by . followed by the destruc-
15857: tor＊s class name followed by an empty parameter list is used to declare the destructor in a class definition. 
15858: In such a declaration, the . followed by the destructor＊s class name can be enclosed in optional parentheses; 
15859: such parentheses are ignored. A typedef-name shall not be used as the class-name following the ‵ in the 
15860: declarator for a destructor declaration. 
15861: 2 A destructor is used to destroy objects of its class type. A destructor takes no parameters, and no return type 
15862: can be specified for it (not even void). The address of a destructor shall not be taken. A destructor shall 
15863: not be static. A destructor can be invoked for a const, volatile or const volatile object. A destructor 
15864: shall not be declared const, volatile or const volatile (9.3.2). const and volatile semantics (7.1.6.1) 
15865: are not applied on an object under destruction. They stop being in effect when the destructor for the most 
15866: derived object (1.8) starts. A destructor shall not be declared with a ref-qualifier. 
15867: 3 If a class has no user-declared destructor, a destructor is declared implicitly. An implicitly-declared destructor 
15868: is an inline public member of its class. If the class is a union-like class that has a variant member with a 
15869: non-trivial destructor, an implicitly-declared destructor is defined as deleted (8.4). A destructor is trivial if 
15870: it is not user-provided and if: 
15871: 〞 the destructor is not virtual, 
15872: 〞 all of the direct base classes of its class have trivial destructors, and 
15873: 〞 for all of the non-static data members of its class that are of class type (or array thereof), each such 
15874: class has a trivial destructor. 
15875: An implicitly-declared destructor for a class X is defined as deleted if: 
15876: 〞 X is a union-like class that has a variant member with a non-trivial destructor, 
15877: 〞 any of the non-static data members has class type M (or array thereof) and M has an deleted destructor 
15878: or a destructor that is inaccessible from the implicitly-declared destructor, or 
15879: 〞 any direct or virtual base class has a deleted destructor or a destructor that is inaccessible from the 
15880: implicitly-declared destructor. 
15881: ∫ 12.4 252 
15882: 
15883: c
15884: . ISO/IEC N2800=08-0310 
15885: Otherwise, the destructor is non-trivial. 
15886: 4 A non-user-provided destructor is implicitly defined whenit is used to destroy an object of its class type (3.7). 
15887: A program is ill-formed if the class for which a destructor is implicitly defined or explicitly defaulted has: 
15888: if the implicitly-defined destructor is explicitly defaulted, but the corresponding implicit declaration would 
15889: have been deleted. 
15890: 〞 a non-static data member of class type (or array thereof) with an inaccessible destructor, or 
15891: 〞 a base class with an inaccessible destructor. 
15892: Before the non-user-provided destructor for a class is implicitly defined, all the non-user-defined destructors 
15893: for its base classes and its non-static data members shall have been implicitly defined. [ Note: an implicitly-
15894: declared destructor has an exception-specification (15.4). An explictly defaulted definition has no implicit 
15895: exception-specification. 〞end note ] 
15896: 5 After executing the body of the destructor and destroying any automatic objects allocated within the body, 
15897: a destructor for class X calls the destructors for X＊s direct non-variant members, the destructors for X＊s direct 
15898: base classes and, if X is the type of the most derived class (12.6.2), its destructor calls the destructors for 
15899: X＊s virtual base classes. All destructors are called as if they were referenced with a qualified name, that is, 
15900: ignoring any possible virtual overriding destructors in more derived classes. Bases and members are destroyed 
15901: in the reverse order of the completion of their constructor (see 12.6.2). A return statement (6.6.3) in a 
15902: destructor might not directly return to the caller; before transferring control to the caller, the destructors 
15903: for the members and bases are called. Destructors for elements of an array are called in reverse order of 
15904: their construction (see 12.6). 
15905: 6 A destructor can be declared virtual (10.3) or pure virtual (10.4); if any objects of that class or any 
15906: derived class are created in the program, the destructor shall be defined. If a class has a base class with a 
15907: virtual destructor, its destructor (whether user-or implicitly-declared) is virtual. 
15908: 7 [ Note: some language constructs have special semantics when used during destruction; see 12.7. 〞end 
15909: note ] 
15910: 8 Destructors are invoked implicitly 
15911: 〞 for constructed objects with static storage duration (3.7.1) at program termination (3.6.3), 
15912: 〞 for constructed objects with thread storage duration (3.7.2) at thread exit, 
15913: 〞 for constructed objects with automatic storage duration (3.7.3) when the block in which an object is 
15914: created exits (6.7), 
15915: 〞 for constructed temporary objects when the lifetime of a temporary object ends (12.2), 
15916: 〞 for constructed objects allocated by a new-expression (5.3.4), through use of a delete-expression (5.3.5), 
15917: 〞 in several situations due to the handling of exceptions (15.3). 
15918: A program is ill-formed if an object of class type or array thereof is declared and the destructor for the class 
15919: is not accessible at the point of the declaration. Destructors can also be invoked explicitly. 
15920: 9 At the point of definition of a virtual destructor (including an implicit definition (12.8)), the non-array 
15921: deallocation function is looked up in the scope of the destructor＊s class (10.2), and, if no declaration is 
15922: found, the function is looked up in the global scope. If the result of this lookup is ambiguous or inaccessible, 
15923: or if the lookup selects a placement deallocation function or a function with a deleted definition (8.4), the 
15924: program is ill-formed. [ Note: this assures that a deallocation function corresponding to the dynamic type 
15925: of an object is available for the delete-expression (12.5). 〞end note ] 
15926: ∫ 12.4 253 
15927: 
15928: c
15929: . ISO/IEC N2800=08-0310 
15930: 10 In an explicit destructor call, the destructor name appears as a . followed by a type-name that names the 
15931: destructor＊s class type. The invocation of a destructor is subject to the usual rules for member functions (9.3), 
15932: that is, if the object is not of the destructor＊s class type and not of a class derived from the destructor＊s class 
15933: type, the program has undefined behavior (except that invoking delete on a null pointer has no effect). 
15934: [ Example: 
15935: struct B { 
15936: virtual ~B() { }
15937: };
15938: struct D : B {
15939: ~D() { }
15940: };
15941: D D_object;
15942: typedef B B_alias;
15943: B* B_ptr = &D_object;
15944: void f() {
15945: D_object.B::~B(); // calls B＊s destructor
15946: B_ptr->~B(); // calls D＊s destructor
15947: B_ptr->~B_alias(); // calls D＊s destructor
15948: B_ptr->B_alias::~B(); // calls B＊s destructor
15949: B_ptr->B_alias::~B_alias(); // calls B＊s destructor
15950: } 
15951: 〞end example ][ Note: an explicit destructor call must always be written using a member access opera-
15952: tor (5.2.5) or a qualified-id (5.1); in particular, the unary-expression .X() in a member function is not an 
15953: explicit destructor call (5.3.1). 〞end note ] 
15954: 11 [ Note: explicit calls of destructors are rarely needed. One use of such calls is for objects placed at specific 
15955: addresses using a new-expression with the placement option. Such use of explicit placement and destruction 
15956: of objects can be necessary to cope with dedicated hardware resources and for writing memory management 
15957: facilities. For example, 
15958: void* operator new(std::size_t, void* p) { return p; } 
15959: struct X {
15960: X(int);
15961: ~X();
15962: };
15963: void f(X* p);
15964: void g() { // rare, specialized use:
15965: char* buf = new char[sizeof(X)];
15966: X* p = new(buf) X(222); // use buf[] and initialize
15967: f(p);
15968: p->X::~X(); // cleanup
15969: } 
15970: 〞end note ] 
15971: 12 Once a destructor is invoked for an object, the object no longer exists; the behavior is undefined if the 
15972: destructor is invoked for an object whose lifetime has ended (3.8). [ Example: if the destructor for an 
15973: automatic object is explicitly invoked, and the block is subsequently left in a manner that would ordinarily 
15974: invoke implicit destruction of the object, the behavior is undefined. 〞end example ] 
15975: ∫ 12.4 254 
15976: 
15977: c
15978: . ISO/IEC N2800=08-0310 
15979: 13 [ Note: the notation for explicit call of a destructor can be used for any scalar type name (5.2.4). Allowing 
15980: this makes it possible to write code without having to know if a destructor exists for a given type. For 
15981: example, 
15982: typedef int I;
15983: I* p;
15984: p->I::~I();
15985: 〞end note ] 
15986: 12.5 Free store [class.free] 
15987: 1 Any allocation function for a class T is a static member (even if not explicitly declared static). 
15988: 2 [ Example: 
15989: class Arena;
15990: struct B {
15991: void* operator new(std::size_t, Arena*);
15992: };
15993: struct D1 : B {
15994: };
15995: Arena* ap;
15996: void foo(int i) { 
15997: new (ap) D1; 
15998: new D1[i]; 
15999: new D1; 
16000: } 
16001: 〞end example ] 
16002: // calls B::operator new(std::size_t, Arena*) 
16003: // calls ::operator new[](std::size_t) 
16004: // ill-formed: ::operator new(std::size_t) hidden 
16005: 3 When an object is deleted with a delete-expression (5.3.5), a deallocation function (operator delete() for 
16006: non-array objects or operator delete[]() for arrays) is (implicitly) called to reclaim the storage occupied 
16007: by the object (3.7.4.2). 
16008: 4 If a delete-expression begins with a unary :: operator, the deallocation function＊s name is looked up in 
16009: global scope. Otherwise, if the delete-expression is used to deallocate a class object whose static type has 
16010: a virtual destructor, the deallocation function is the one selected at the point of definition of the dynamic 
16011: type＊s virtual destructor (12.4).108 Otherwise, if the delete-expression is used to deallocate an object of 
16012: class T or array thereof, the static and dynamic types of the object shall be identical and the deallocation 
16013: function＊s name is looked up in the scope of T. If this lookup fails to find the name, the name is looked up in 
16014: the global scope. If the result of the lookup is ambiguous or inaccessible, or if the lookup selects a placement 
16015: deallocation function, the program is ill-formed. 
16016: 5 When a delete-expression is executed, the selected deallocation function shall be called with the address of 
16017: the block of storage to be reclaimed as its first argument and (if the two-parameter style is used) the size of 
16018: the block as its second argument.109 
16019: 6 Any deallocation function for a class X is a static member (even if not explicitly declared static). [ Example: 
16020: 108) A similar provision is not needed for the array version of operator delete because 5.3.5 requires that in this situation,
16021: the static type of the object to be deleted be the same as its dynamic type.
16022: 109) If the static type of the object to be deleted is different from the dynamic type and the destructor is not virtual the size
16023: might be incorrect, but that case is already undefined; see 5.3.5.
16024: ∫ 12.5 255 
16025: 
16026: c
16027: . ISO/IEC N2800=08-0310 
16028: class X { 
16029: void operator delete(void*); 
16030: void operator delete[](void*, std::size_t); 
16031: }; 
16032: class Y { 
16033: void operator delete(void*, std::size_t); 
16034: void operator delete[](void*); 
16035: }; 
16036: 〞end example ] 
16037: 7 Since member allocation and deallocation functions are static they cannot be virtual. [ Note: however, 
16038: when the cast-expression of a delete-expression refers to an object of class type, because the deallocation 
16039: function actually called is looked up in the scope of the class that is the dynamic type of the object, if the 
16040: destructor is virtual, the effect is the same. For example, 
16041: struct B { 
16042: virtual ~B(); 
16043: void operator delete(void*, std::size_t); 
16044: }; 
16045: struct D : B { 
16046: void operator delete(void*);
16047: };
16048: void f() { 
16049: B* bp = new D; 
16050: delete bp; // 1: uses D::operator delete(void*) 
16051: } 
16052: Here, storage for the non-array object of class D is deallocated by D::operator delete(), due to the virtual 
16053: destructor. 〞 end note ][ Note: virtual destructors have no effect on the deallocation function actually called 
16054: when the cast-expression of a delete-expression refers to an array of objects of class type. For example, 
16055: struct B { 
16056: virtual ~B(); 
16057: void operator delete[](void*, std::size_t); 
16058: }; 
16059: struct D : B { 
16060: void operator delete[](void*, std::size_t);
16061: };
16062: void f(int i) { 
16063: D* dp = new D[i]; 
16064: delete [] dp; // uses D::operator delete[](void*, std::size_t) 
16065: B* bp = new D[i]; 
16066: delete[] bp; // undefined behavior 
16067: } 
16068: 〞end note ] 
16069: 8 Access to the deallocation function is checked statically. Hence, even though a different one might actually 
16070: be executed, the statically visible deallocation function is required to be accessible. [ Example: for the call 
16071: ∫ 12.5 256 
16072: 
16073: c
16074: . ISO/IEC N2800=08-0310 
16075: on line //1 above, if B::operator delete() had been private, the delete expression would have been 
16076: ill-formed. 〞 end example ] 
16077: 12.6 Initialization [class.init] 
16078: 1 When no initializer is specified for an object of (possibly cv-qualified) class type (or array thereof), or the 
16079: initializer has the form (), the object is initialized as specified in 8.5. 
16080: 2 An object of class type (or array thereof) can be explicitly initialized; see 12.6.1 and 12.6.2. 
16081: 3 When an array of class objects is initialized (either explicitly or implicitly), the constructor shall be called for 
16082: each element of the array, following the subscript order; see 8.3.4. [ Note: destructors for the array elements 
16083: are called in reverse order of their construction. 〞end note ] 
16084: 12.6.1 Explicit initialization [class.expl.init] 
16085: 1 An object of class type can be initialized with a parenthesized expression-list, where the expression-list 
16086: is construed as an argument list for a constructor that is called to initialize the object. Alternatively, a 
16087: single assignment-expression can be specified as an initializer using the = form of initialization. Either 
16088: direct-initialization semantics or copy-initialization semantics apply; see 8.5. [ Example: 
16089: struct complex {
16090: complex();
16091: complex(double);
16092: complex(double,double);
16093: }; 
16094: complex sqrt(complex,complex); 
16095: complex a(1); // initialize by a call of 
16096: // complex(double)
16097: complex b = a; // initialize by a copy of a
16098: complex c = complex(1,2); // construct complex(1,2)
16099: // using complex(double,double)
16100: // copy it into c
16101: complex d = sqrt(b,c); // call sqrt(complex,complex)
16102: // and copy the result into d
16103: complex e; // initialize by a call of
16104: // complex()
16105: complex f = 3; // construct complex(3) using
16106: // complex(double)
16107: // copy it into f
16108: complex g = { 1, 2 }; // error: constructor is required 
16109: 〞end example ][ Note: overloading of the assignment operator (13.5.3) has no effect on initialization. 〞end 
16110: note ] 
16111: 2 An object of class type can also be initialized by a braced-init-list. List-initialization semantics apply; see 8.5 
16112: and 8.5.4. [ Example: 
16113: complex v[6] = { 1, complex(1,2), complex(), 2 }; 
16114: Here, complex::complex(double) is called for the initialization of v[0] and v[3], complex::complex(double, 
16115: double) is called for the initialization of v[1], complex::complex() is called for the initialization v[2], 
16116: v[4], and v[5]. For another example, 
16117: ∫ 12.6.1 257 
16118: 
16119: c
16120: . ISO/IEC N2800=08-0310 
16121: struct X {
16122: int i;
16123: float f;
16124: complex c;
16125: } x = { 99, 88.8, 77.7 }; 
16126: Here, x.i is initialized with 99, x.f is initialized with 88.8, and complex::complex(double) is called for the 
16127: initialization of x.c. 〞end example ][ Note: braces can be elided in the initializer-list for any aggregate, 
16128: even if the aggregate has members of a class type with user-defined type conversions; see 8.5.1. 〞 end note ] 
16129: 3 [ Note: if T is a class type with no default constructor, any declaration of an object of type T (or array 
16130: thereof) is ill-formed if no initializer is explicitly specified (see 12.6 and 8.5). 〞end note ] 
16131: 4 [ Note: the order in which objects with static or thread storage duration are initialized is described in 3.6.2 
16132: and 6.7. 〞 end note ] 
16133: 12.6.2 Initializing bases and members [class.base.init] 
16134: 1 In the definition of a constructor for a class, initializers for direct and virtual base subobjects and non-static 
16135: data members can be specified by a ctor-initializer, which has the form 
16136: ctor-initializer:
16137: : mem-initializer-list
16138: mem-initializer-list:
16139: mem-initializer ...opt
16140: mem-initializer , mem-initializer-list ...opt
16141: mem-initializer:
16142: mem-initializer-id ( expression-listopt )
16143: mem-initializer-id braced-init-list
16144: mem-initializer-id:
16145: ::opt nested-name-specifieropt class-name
16146: identifier
16147: 2 Names in a mem-initializer-id are looked up in the scope of the constructor＊s class and, if not found in that 
16148: scope, are looked up in the scope containing the constructor＊s definition. [ Note: if the constructor＊s class 
16149: contains a member with the same name as a direct or virtual base class of the class, a mem-initializer-id 
16150: naming the member or base class and composed of a single identifier refers to the class member. A mem-
16151: initializer-id for the hidden base class may be specified using a qualified name. 〞 end note ] Unless the 
16152: mem-initializer-id names the constructor＊s class, a non-static data member of the constructor＊s class or a 
16153: direct or virtual base of that class, the mem-initializer is ill-formed. A mem-initializer-list can initialize a 
16154: base class using any name that denotes that base class type. [ Example: 
16155: struct A { A(); };
16156: typedef A global_A;
16157: struct B { };
16158: struct C: public A, public B { C(); };
16159: C::C(): global_A() { } // mem-initializer for base A
16160: 〞end example ] 
16161: A mem-initializer-list can delegate to another constructor of the constructor＊s class using any name that 
16162: denotes the constructor＊s class itself. If a mem-initializer-id designates the constructor＊s class, it shall be 
16163: the only mem-initializer; the constructor is a delegating constructor, and the constructor selected by the 
16164: mem-initializer is the target constructor. The principal constructor is the first constructor invoked in the 
16165: construction of an object (that is, not a target constructor for that object＊s construction). The target 
16166: constructor is selected by overload resolution. Once the target constructor returns, the body of the delegating 
16167: ∫ 12.6.2 258 
16168: 
16169: c
16170: . ISO/IEC N2800=08-0310 
16171: constructor is executed. If a constructor delegates to itself directly or indirectly, the program is ill-formed; 
16172: no diagnostic is required. [ Example: 
16173: struct C {
16174: C( int ) { } // 1: non-delegating constructor
16175: C(): C(42) { } // 2: delegates to 1
16176: C( char c ) : C(42.0) { } // 3: ill-formed due to recursion with 4
16177: C( double d ) : C(＊a＊) { } // 4: ill-formed due to recursion with 3
16178: }; 
16179: 〞end example ] If a mem-initializer-id is ambiguous because it designates both a direct non-virtual base 
16180: class and an inherited virtual base class, the mem-initializer is ill-formed. [ Example: 
16181: struct A { A(); };
16182: struct B: public virtual A { };
16183: struct C: public A, public B { C(); };
16184: C::C(): A() { } // ill-formed: which A?
16185: 〞end example ]A ctor-initializer may initialize the member of an anonymous union that is a member of 
16186: the constructor＊s class. If a ctor-initializer specifies more than one mem-initializer for the same member, for 
16187: the same base class or for multiple members of the same union (including members of anonymous unions), 
16188: the ctor-initializer is ill-formed. 
16189: 3 The expression-list or braced-init-list in a mem-initializer is used to initialize the base class or non-static 
16190: data member subobject denoted by the mem-initializer-id according to the initialization rules of 8.5 for 
16191: direct-initialization. 
16192: [ Example: 
16193: struct B1 { B1(int); /. ... / };
16194: struct B2 { B2(int); /. ... / };
16195: struct D : B1, B2 {
16196: D(int);
16197: B1 b;
16198: const int c;
16199: }; 
16200: D::D(int a) : B2(a+1), B1(a+2), c(a+3), b(a+4)
16201: { /. ... / }
16202: D d(10);
16203: 〞end example ] The initialization of each base and member constitutes a full-expression. Any expression 
16204: in a mem-initializer is evaluated as part of the full-expression that performs the initialization. 
16205: 4 If a given non-static data member or base class is not named by a mem-initializer-id (including the case 
16206: where there is no mem-initializer-list because the constructor has no ctor-initializer), then 
16207: 〞 if the entity is a non-static data member that has a brace-or-equal-initializer, the entity is initialized 
16208: as specified in 8.5; 
16209: 〞 otherwise, if the entity is a variant member (9.5), no initialization is performed; 
16210: 〞 otherwise, the entity is default-initialized (8.5). 
16211: After the call to a constructor for class X has completed, if a member of X is neither initialized nor given a value 
16212: during execution of the compound-statement of the body of the constructor, the member has indeterminate 
16213: value. [ Example: 
16214: ∫ 12.6.2 259 
16215: 
16216: c
16217: . ISO/IEC N2800=08-0310 
16218: struct A {
16219: A();
16220: };
16221: struct B {
16222: B(int);
16223: };
16224: struct C {
16225: C() { } // initializes members as follows:
16226: A a; // OK: calls A::A()
16227: const B b; // error: B has no default constructor
16228: int i; // OK: i has indeterminate value
16229: int j = 5; // OK: j has the value 5
16230: }; 
16231: 〞end example ] 
16232: 5 If a given non-static data member has both a brace-or-equal-initializer and a mem-initializer, the initializa-
16233: tion specified by the mem-initializer is performed, and the non-static data member＊s brace-or-equal-initializer 
16234: is ignored. [ Example: Given 
16235: struct A {
16236: int i = /. some integer expression with side effects / ;
16237: A(int arg) : i(arg) { }
16238: // ... 
16239: }; 
16240: the A(int) constructor will simply initialize i to the value of arg, and the side effects in i＊s brace-or-equal-
16241: initializer will not take place. 〞end example ] 
16242: 6 Initialization shall proceed in the following order: 
16243: 〞 First, and only for the constructor of the most derived class as described below, virtual base classes 
16244: shall be initialized in the order they appear on a depth-first left-to-right traversal of the directed acyclic 
16245: graph of base classes, where ※left-to-right§ is the order of appearance of the base class names in the 
16246: derived class base-specifier-list. 
16247: 〞 Then, direct base classes shall be initialized in declaration order as they appear in the base-specifier-list 
16248: (regardless of the order of the mem-initializers). 
16249: 〞 Then, non-static data members shall be initialized in the order they were declared in the class definition 
16250: (again regardless of the order of the mem-initializers). 
16251: 〞 Finally, the compound-statement of the constructor body is executed. 
16252: [ Note: the declaration order is mandated to ensure that base and member subobjects are destroyed in the 
16253: reverse order of initialization. 〞end note ] 
16254: 7 All subobjects representing virtual base classes are initialized by the constructor of the most derived 
16255: class (1.8). If the constructor of the most derived class does not specify a mem-initializer for a virtual 
16256: base class V, then V＊s default constructor is called to initialize the virtual base class subobject. If V does not 
16257: have an accessible default constructor, the initialization is ill-formed. A mem-initializer naming a virtual 
16258: base class shall be ignored during execution of the constructor of any class that is not the most derived class. 
16259: [ Example: 
16260: struct V { 
16261: ∫ 12.6.2 260 
16262: 
16263: c
16264: . ISO/IEC N2800=08-0310 
16265: V();
16266: V(int);
16267: };
16268: struct A : virtual V {
16269: A();
16270: A(int);
16271: }; 
16272: struct B : virtual V {
16273: B();
16274: B(int);
16275: }; 
16276: struct C : A, B, virtual V {
16277: C();
16278: C(int);
16279: }; 
16280: A::A(int i) : V(i) { /. ... / }
16281: B::B(int i) { /. ... / }
16282: C::C(int i) { /. ... / }
16283: V v(1); // use V(int)
16284: A a(2); // use V(int)
16285: B b(3); // use V()
16286: C c(4); // use V()
16287: 〞end example ] 
16288: 8 Names in the expression-list of a mem-initializer are evaluated in the scope of the constructor for which the 
16289: mem-initializer is specified. [ Example: 
16290: class X {
16291: int a;
16292: int b;
16293: int i;
16294: int j;
16295: public:
16296: const int& r;
16297: X(int i): r(a), b(i), i(i), j(this->i) { }
16298: }; 
16299: initializes X::r to refer to X::a, initializes X::b with the value of the constructor parameter i, initializes X::i 
16300: with the value of the constructor parameter i, and initializes X::j with the value of X::i; this takes place 
16301: each time an object of class X is created. 〞 end example ][ Note: because the mem-initializer are evaluated 
16302: in the scope of the constructor, the this pointer can be used in the expression-list of a mem-initializer to 
16303: refer to the object being initialized. 〞end note ] 
16304: 9 Member functions (including virtual member functions, 10.3) can be called for an object under construction. 
16305: Similarly, an object under construction can be the operand of the typeid operator (5.2.8) or of a dynamic_-
16306: cast (5.2.7). However, if these operations are performed in a ctor-initializer (or in a function called directly 
16307: or indirectly from a ctor-initializer) before all the mem-initializers for base classes have completed, the result 
16308: of the operation is undefined. [ Example: 
16309: class A { 
16310: ∫ 12.6.2 261 
16311: 
16312: c
16313: . ISO/IEC N2800=08-0310 
16314: public:
16315: A(int);
16316: };
16317: class B : public A {
16318: int j;
16319: public:
16320: int f();
16321: B() : A(f()), // undefined: calls member function
16322: // but base A not yet initialized
16323: j(f()) { } // well-defined: bases are all initialized
16324: };
16325: class C {
16326: public:
16327: C(int);
16328: };
16329: class D : public B, C {
16330: int i;
16331: public:
16332: D() : C(f()), // undefined: calls member function
16333: // but base C not yet initialized
16334: i(f()) { } // well-defined: bases are all initialized
16335: };
16336: 〞end example ] 
16337: 10 [ Note: 12.7 describes the result of virtual function calls, typeid and dynamic_casts during construction for 
16338: the well-defined cases; that is, describes the polymorphic behavior of an object under construction. 〞end 
16339: note ] 
16340: 11 A mem-initializer followed by an ellipsis is a pack expansion (14.5.3) that initializes the base classes specified 
16341: by a pack expansion in the base-specifier-list for the class. [ Example: 
16342: template<class... Mixins>
16343: class X : public Mixins... {
16344: public:
16345: X(const Mixins&... mixins) : Mixins(mixins)... { }
16346: };
16347: 〞end example ] 
16348: 12.7 Construction and destruction [class.cdtor] 
16349: 1 For an object with a non-trivial constructor, referring to any non-static member or base class of the object 
16350: before the constructor begins execution results in undefined behavior. For an object with a non-trivial 
16351: destructor, referring to any non-static member or base class of the object after the destructor finishes 
16352: execution results in undefined behavior. [ Example: 
16353: struct X { int i; };
16354: struct Y : X { Y(); }; // non-trivial
16355: struct A { int a; };
16356: struct B : public A { int j; Y y; }; // non-trivial
16357: extern B bobj; 
16358: ∫ 12.7 262 
16359: 
16360: c
16361: . ISO/IEC N2800=08-0310 
16362: B* pb = &bobj; // OK
16363: int* p1 = &bobj.a; // undefined, refers to base class member
16364: int* p2 = &bobj.y.i; // undefined, refers to member＊s member
16365: A* pa = &bobj; // undefined, upcast to a base class type
16366: B bobj; // definition of bobj
16367: extern X xobj;
16368: int* p3 = &xobj.i; //OK, X is a trivial class
16369: X xobj;
16370: 2 For another example, 
16371: struct W { int j; };
16372: struct X : public virtual W { };
16373: struct Y {
16374: int *p;
16375: X x;
16376: Y() : p(&x.j) { // undefined, x is not yet constructed
16377: }
16378: };
16379: 〞end example ] 
16380: 3 To explicitly or implicitly convert a pointer (an lvalue) referring to an object of class X to a pointer (reference) 
16381: to a direct or indirect base class B of X, the construction of X and the construction of all of its direct or 
16382: indirect bases that directly or indirectly derive from B shall have started and the destruction of these classes 
16383: shall not have completed, otherwise the conversion results in undefined behavior. To form a pointer to (or 
16384: access the value of) a direct non-static member of an object obj, the construction of obj shall have started 
16385: and its destruction shall not have completed, otherwise the computation of the pointer value (or accessing 
16386: the member value) results in undefined behavior. [ Example: 
16387: struct A { };
16388: struct B : virtual A { };
16389: struct C : B { };
16390: struct D : virtual A { D(A*); };
16391: struct X { X(A*); };
16392: struct E : C, D, X {
16393: E() : D(this), // undefined: upcast from E* to A*
16394: // might use path E* D* A*
16395: !
16396: // but D is not constructed ↙
16397: // D((C*)this), // defined:
16398: // E* C* defined because E() has started
16399: // and !C* A* defined because
16400: !
16401: // C fully constructed
16402: X(this) { // defined: upon construction of X,
16403: // C/B/D/A sublattice is fully constructed
16404: }
16405: };
16406: 〞end example ] 
16407: 4 Member functions, including virtual functions (10.3), can be called during construction or destruction (12.6.2). 
16408: When a virtual function is called directly or indirectly from a constructor (including the mem-initializer or 
16409: brace-or-equal-initializer for a non-static data member) or from a destructor, and the object to which the 
16410: ∫ 12.7 263 
16411: 
16412: c. ISO/IEC N2800=08-0310 
16413: call applies is the object under construction or destruction, the function called is the one defined in the 
16414: constructor or destructor＊s own class or in one of its bases, but not a function overriding it in a class derived 
16415: from the constructor or destructor＊s class, or overriding it in one of the other base classes of the most derived 
16416: object (1.8). If the virtual function call uses an explicit class member access (5.2.5) and the object-expression 
16417: refers to the object under construction or destruction but its type is neither the constructor or destructor＊s 
16418: own class or one of its bases, the result of the call 
16419: struct V {
16420: virtual void f();
16421: virtual void g();
16422: }; 
16423: struct A : virtual V {
16424: virtual void f();
16425: };
16426: struct B : virtual V {
16427: virtual void g();
16428: B(V*, A*);
16429: }; 
16430: struct D : A, B {
16431: virtual void f();
16432: virtual void g();
16433: D() : B((A*)this, this) { }
16434: }; 
16435: B::B(V* v, A* a) {
16436: f(); // calls V::f, not A::f
16437: g(); // calls B::g, not D::g
16438: is undefined. [ Example: 
16439: v->g(); // v is base of B, the call is well-defined, calls B::g
16440: a->f(); // undefined behavior, a＊s type not a base of B
16441: } 
16442: 〞end example ] 
16443: 5 The typeid operator (5.2.8) can be used during construction or destruction (12.6.2). When typeid is used 
16444: in a constructor (including the mem-initializer or brace-or-equal-initializer for a non-static data member) or 
16445: in a destructor, or used in a function called (directly or indirectly) from a constructor or destructor, if the 
16446: operand of typeid refers to the object under construction or destruction, typeid yields the std::type_info 
16447: object representing the constructor or destructor＊s class. If the operand of typeid refers to the object under 
16448: construction or destruction and the static type of the operand is neither the constructor or destructor＊s class 
16449: nor one of its bases, the result of typeid is undefined. 
16450: 6 Dynamic_casts (5.2.7) can be used during construction or destruction (12.6.2). When a dynamic_cast 
16451: is used in a constructor (including the mem-initializer or brace-or-equal-initializer for a non-static data 
16452: member) or in a destructor, or used in a function called (directly or indirectly) from a constructor or 
16453: destructor, if the operand of the dynamic_cast refers to the object under construction or destruction, this 
16454: object is considered to be a most derived object that has the type of the constructor or destructor＊s class. If 
16455: the operand of the dynamic_cast refers to the object under construction or destruction and the static type 
16456: of the operand is not a pointer to or object of the constructor or destructor＊s own class or one of its bases, 
16457: the dynamic_cast results in undefined behavior. 
16458: [ Example: 
16459: struct V { 
16460: ∫ 12.7 264 
16461: 
16462: c
16463: . ISO/IEC N2800=08-0310 
16464: virtual void f();
16465: };
16466: struct A : virtual V { }; 
16467: struct B : virtual V {
16468: B(V*, A*);
16469: };
16470: struct D : A, B {
16471: D() : B((A*)this, this) { }
16472: };
16473: B::B(V* v, A* a) {
16474: typeid(*this); // type_info for B
16475: typeid(*v); // well-defined: *v has type V, a base of B
16476: // yields type_info for B
16477: typeid(*a); // undefined behavior: type A not a base of B
16478: dynamic_cast<B*>(v); // well-defined: v of type V*, V base of B
16479: // results in B*
16480: dynamic_cast<B*>(a); // undefined behavior,
16481: // a has type A*, A not a base of B
16482: }
16483: 〞end example ] 
16484: 12.8 Copying class objects [class.copy] 
16485: 1 A class object can be copied in two ways, by initialization (12.1, 8.5), including for function argument 
16486: passing (5.2.2) and for function value return (6.6.3), and by assignment (5.17). Conceptually, these two 
16487: operations are implemented by a copy constructor (12.1) and copy assignment operator (13.5.3). 
16488: 2 A non-template constructor for class X is a copy constructor if its first parameter is of type X&, const X&, 
16489: volatile X& or const volatile X&, and either there are no other parameters or else all other parameters 
16490: have default arguments (8.3.6).110 [ Example: X::X(const X&) and X::X(X&,int=1) are copy constructors. 
16491: struct X {
16492: X(int);
16493: X(const X&, int = 1);
16494: };
16495: X a(1); // calls X(int);
16496: X b(a, 0); // calls X(const X&, int);
16497: X c = b; // calls X(const X&, int);
16498: 〞end example ][ Note: all forms of copy constructor may be declared for a class. [ Example: 
16499: struct X {
16500: X(const X&);
16501: X(X&); // OK
16502: }; 
16503: 110) Because a template constructor or a constructor whose first parameter is an rvalue reference is never a copy constructor, 
16504: the presence of such a constructor does not suppress the implicit declaration of a copy constructor. Such constructors participate 
16505: in overload resolution with other constructors, including copy constructors, and, if selected, will be used to copy an object. 
16506: ∫ 12.8 265 
16507: 
16508: c
16509: . ISO/IEC N2800=08-0310 
16510: 〞end example ] 〞end note ][ Note: if a class X only has a copy constructor with a parameter of type X&, 
16511: an initializer of type const X or volatile X cannot initialize an object of type (possibly cv-qualified) X. 
16512: [ Example: 
16513: struct X { 
16514: X(); // default constructor 
16515: X(X&); // copy constructor with a nonconst parameter 
16516: };
16517: const X cx;
16518: X x = cx; // error: X::X(X&) cannot copy cx into x
16519: 〞end example ] 〞end note ] 
16520: 3 A declaration of a constructor for a class X is ill-formedif its first parameter is of type (optionally cv-qualified) 
16521: X and either there are no other parameters or else all other parameters have default arguments. A member 
16522: function template is never instantiated to perform the copy of a class object to an object of its class type. 
16523: [ Example: 
16524: struct S { 
16525: template<typename T> S(T);
16526: };
16527: S f(); 
16528: void g() { 
16529: S a( f() ); // does not instantiate member template
16530: }
16531: 〞end example ] 
16532: 4 If the class definition does not explicitly declare a copy constructor, one is declared implicitly. Thus, for the 
16533: class definition 
16534: struct X { 
16535: X(const X&, int);
16536: };
16537: a copy constructor is implicitly-declared. If the user-declared constructor is later defined as 
16538: X::X(const X& x, int i =0) { /. ...  / } 
16539: then any use of X＊s copy constructor is ill-formed because of the ambiguity; no diagnostic is required. 
16540: 5 The implicitly-declared copy constructor for a class X will have the form 
16541: X::X(const X&) 
16542: if 
16543: 〞 each direct or virtual base class B of X has a copy constructor whose first parameter is of type const 
16544: B& or const volatile B&, and 
16545: 〞 for all the non-static data members of X that are of a class type M (or array thereof), each such class 
16546: 111 
16547: type has a copy constructor whose first parameter is of type const M& or const volatile M&.
16548: Otherwise, the implicitly-declared copy constructor will have the form
16549: 111) This implies that the reference parameter of the implicitly-declared copy constructor cannot bind to a volatile lvalue; 
16550: see C.1.8. 
16551: ∫ 12.8 266 
16552: 
16553: c
16554: . ISO/IEC N2800=08-0310 
16555: X::X(X&) 
16556: An implicitly-declared copy constructor is an inline public member of its class. An implicitly-declared 
16557: copy constructor for a class X is defined as deleted if X has: 
16558: 〞 a variant member with a non-trivial copy constructor and X is a union-like class, 
16559: 〞 a non-static data member of class type M (or array thereof) that cannot be copied because overload 
16560: resolution (13.3), as applied to M＊s copy constructor, results in an ambiguity or a function that is 
16561: deleted or inaccessible from the implicitly-declared copy constructor, or 
16562: 〞 a direct or virtual base class B that cannot be copied because overload resolution (13.3), as applied 
16563: to B＊s copy constructor, results in an ambiguity or a function that is deleted or inaccessible from the 
16564: implicitly-declared copy constructor. 
16565: 6 A copy constructor for class X is trivial if it is not user-provided (8.4) and if 
16566: 〞 class X has no virtual functions (10.3) and no virtual base classes (10.1), and 
16567: 〞 the constructor selected to copy each direct base class subobject is trivial, and 
16568: 〞 for each non-static data memberof X that is of class type (or array thereof), the constructor selected 
16569: to copy that member is trivial; 
16570: otherwise the copy constructor is non-trivial. 
16571: 7 A non-user-provided copy constructor is implicitly defined if it is used to initialize an object of its class type 
16572: from a copy of an object of its class type or of a class type derived from its class type112.[ Note: the copy 
16573: constructor is implicitly defined even if the implementation elided its use (12.2). 〞end note ] A program 
16574: is ill-formed if the implicitly-defined copy constructor is explicitly defaulted, but the corresponding implicit 
16575: declaration would have been deleted. 
16576: Before the non-user-provided copy constructor for a class is implicitly defined, all non-user-provided copy 
16577: constructors for its direct and virtual base classes and its non-static data members shall have been implicitly 
16578: defined. [ Note: an implicitly-declared copy constructor has an exception-specification (15.4). An explicitly-
16579: defaulted definition has no implicit exception-specification. 〞end note ] 
16580: 8 The implicitly-defined or explicitly-defaulted copy constructor for class X performs a memberwise copy of its 
16581: subobjects. [ Note: brace-or-equal-initializers of non-static data members are ignored. See also the example 
16582: in 12.6.2. 〞end note ] The order of copying is the same as the order of initialization of bases and members 
16583: in a user-defined constructor (see 12.6.2). Each subobject is copied in the manner appropriate to its type: 
16584: 〞 if the subobject is of class type, the copy constructor for the class is used; 
16585: 〞 if the subobject is an array, each element is copied, in the manner appropriate to the element type; 
16586: 〞 if the subobject is of scalar type, the built-in assignment operator is used. 
16587: Virtual base class subobjects shall be copied only once by the implicitly-defined copy constructor (see12.6.2). 
16588: 9 A user-declared copy assignment operator X::operator= is a non-static non-template member function of 
16589: class X with exactly one parameter of type X, X&, const X&, volatile X& or const volatile X&.113 [ Note: 
16590: an overloaded assignment operator must be declared to have only one parameter; see 13.5.3. 〞end note ] 
16591: [ Note: more than one form of copy assignment operator may be declared for a class. 〞end note ][ Note: 
16592: 112) See 8.5 for more details on direct and copy initialization. 
16593: 113) Because a template assignment operator or an assignment operator taking an rvalue reference parameter is never a 
16594: copy assignment operator, the presence of such an assignment operator does not suppress the implicit declaration of a copy 
16595: assignment operator. Such assignment operators participate in overload resolution with other assignment operators, including 
16596: copy assignment operators, and, if selected, will be used to assign an object. 
16597: ∫ 12.8 267 
16598: 
16599: c
16600: . ISO/IEC N2800=08-0310 
16601: if a class X only has a copy assignment operator with a parameter of type X&, an expression of type const X 
16602: cannot be assigned to an object of type X.[ Example: 
16603: struct X { 
16604: X(); 
16605: X& operator=(X&); 
16606: };
16607: const X cx;
16608: X x;
16609: void f() {
16610: x = cx; // error: X::operator=(X&) cannot assign cx into x
16611: }
16612: 〞end example ] 〞end note ] 
16613: 10 If the class definition does not explicitly declare a copy assignment operator, one is declared implicitly. The 
16614: implicitly-declared copy assignment operator for a class X will have the form 
16615: X& X::operator=(const X&) 
16616: if 
16617: 〞 each direct base class B of X has a copy assignment operator whose parameter is of type const B&, 
16618: const volatile B& or B, and 
16619: 〞 for all the non-static data members of X that are of a class type M (or array thereof), each such class 
16620: 114 
16621: type has a copy assignment operator whose parameter is of type const M&, const volatile M& or M.
16622: Otherwise, the implicitly-declared copy assignment operator will have the form 
16623: X& X::operator=(X&) 
16624: The implicitly-declared copy assignment operator for class X has the return type X&; it returns the object 
16625: for which the assignment operator is invoked, that is, the object assigned to. An implicitly-declared copy 
16626: assignment operator is an inline public member of its class. An implicitly-declared copy assignment 
16627: operator for class X is defined as deleted if X has: 
16628: 〞 a variant member with a non-trivial copy assignment operator and X is a union-like class, 
16629: 〞 a non-static data member of const non-class type (or array thereof), or 
16630: 〞 a non-static data member of reference type, or 
16631: 〞 a non-static data member of class type M (or array thereof) that cannot be copied because overload 
16632: resolution (13.3), as applied to M＊s copy assignment operator, results in an ambiguity or a function 
16633: that is deleted or inaccessible from the implicitly-declared copy assignment operator, or 
16634: 〞 a direct or virtual base class B that cannot be copied because overload resolution (13.3), as applied to 
16635: B＊s copy assignment operator, results in an ambiguity or a function that is deleted or inaccessible from 
16636: the implicitly-declared copy assignment operator. 
16637: Because a copy assignment operator is implicitly declared for a class if not declared by the user, a base class 
16638: copy assignment operator is always hidden by the copy assignment operator of a derived class (13.5.3). A 
16639: using-declaration (7.3.3) that brings in from a base class an assignment operator with a parameter type that 
16640: could be that of a copy-assignment operator for the derived class is not considered an explicit declaration 
16641: 114) This implies that the reference parameter of the implicitly-declared copy assignment operator cannot bind to a volatile 
16642: lvalue; see C.1.8. 
16643: ∫ 12.8 268 
16644: 
16645: c
16646: . ISO/IEC N2800=08-0310 
16647: of a copy-assignment operator and does not suppress the implicit declaration of the derived class copy-
16648: assignment operator; the operator introduced by the using-declaration is hidden by the implicitly-declared 
16649: copy-assignment operator in the derived class. 
16650: 11 A copy assignment operator for class X is trivial if it is not user-provided and if 
16651: 〞 class X has no virtual functions (10.3) and no virtual base classes (10.1), and 
16652: 〞 the assignment operator selected to copy each direct base class subobject is trivial, and 
16653: 〞 for each non-static data memberof X that is of class type (or array thereof), the assignment operator 
16654: selected to copy that member is trivial; 
16655: otherwise the copy assignment operator is non-trivial. 
16656: 12 A non-user-provided copy assignment operator is implicitly defined when an object of its class type is assigned 
16657: a value of its class type or a value of a class type derived from its class type. A program is ill-formed if the 
16658: implicitly-defined copy assignment operator is explicitly defaulted, but the corresponding implicit declaration 
16659: would have been deleted. 
16660: Before the non-user-provided copy assignment operator for a class is implicitly defined, all non-user-provided 
16661: copy assignment operators for its direct base classes and its non-static data members shall have been implic-
16662: itly defined. [ Note: an implicitly-declared copy assignment operator has an exception-specification (15.4). 
16663: An explicitly-defaulted definition has no implicit exception-specification. 〞end note ] 
16664: 13 The implicitly-defined or explicitly-defaulted copy assignment operator for class X performs memberwise 
16665: assignment of its subobjects. The direct base classes of X are assigned first, in the order of their declaration 
16666: in the base-specifier-list, and then the immediate non-static data members of X are assigned, in the order in 
16667: which they were declared in the class definition. Each subobject is assigned in the manner appropriate to 
16668: its type: 
16669: 〞 if the subobject is of class type, the copy assignment operator for the class is used (as if by explicit 
16670: qualification; that is, ignoring any possible virtual overriding functions in more derived classes); 
16671: 〞 if the subobject is an array, each element is assigned, in the manner appropriate to the element type; 
16672: 〞 if the subobject is of scalar type, the built-in assignment operator is used. 
16673: It is unspecified whether subobjects representing virtual base classes are assigned more than once by the 
16674: implicitly-defined or explicitly-defaulted copy assignment operator. [ Example: 
16675: struct V { };
16676: struct A : virtual V { };
16677: struct B : virtual V { };
16678: struct C : B, A { };
16679: It is unspecified whether the virtual base class subobject V is assigned twice by the implicitly-defined copy 
16680: assignment operator for C. 〞end example ] 
16681: 14 A program is ill-formed if the copy constructor or the copy assignment operator for an object is implicitly 
16682: used and the special member function is not accessible (Clause 11). [ Note: Copying one object into another 
16683: using the copy constructor or the copy assignment operator does not change the layout or size of either 
16684: object. 〞end note ] 
16685: 15 When certain criteria are met, an implementation is allowed to omit the copy construction of a class object, 
16686: even if the copy constructor and/or destructor for the object have side effects. In such cases, the implemen-
16687: tation treats the source and target of the omitted copy operation as simply two different ways of referring 
16688: to the same object, and the destruction of that object occurs at the later of the times when the two objects 
16689: ∫ 12.8 269 
16690: 
16691: c
16692: . ISO/IEC N2800=08-0310 
16693: would have been destroyed without the optimization.115 This elision of copy operations is permitted in the 
16694: following circumstances (which may be combined to eliminate multiple copies): 
16695: 〞 in a return statement in a function with a class return type, when the expression is the name of a 
16696: non-volatile automatic object with the same cv-unqualified type as the function return type, the copy 
16697: operation can be omitted by constructing the automatic object directly into the function＊s return value 
16698: 〞 in a throw-expression, when the operand is the name of a non-volatile automatic object, the copy 
16699: operation from the operand to the exception object (15.1) can be omitted by constructing the automatic 
16700: object directly into the exception object 
16701: 〞 when a temporary class object that has not been bound to a reference (12.2) would be copied to a 
16702: class object with the same cv-unqualified type, the copy operation can be omitted by constructing the 
16703: temporary object directly into the target of the omitted copy 
16704: 〞 when the exception-declaration of an exception handler (Clause 15) declares an object of the same type 
16705: (except for cv-qualification) as the exception object (15.1), the copy operation can be omitted by 
16706: treating the exception-declaration as an alias for the exception object if the meaning of the program will 
16707: be unchanged except for the execution of constructors and destructors for the object declared by the 
16708: exception-declaration. 
16709: [ Example: 
16710: class Thing { 
16711: public:
16712: Thing();
16713: ~Thing();
16714: Thing(const Thing&);
16715: }; 
16716: Thing f() {
16717: Thing t;
16718: return t;
16719: } 
16720: Thing t2 = f(); 
16721: Here the criteria for elision can be combined to eliminate two calls to the copy constructor of class Thing: 
16722: the copying of the local automatic object t into the temporary object for the return value of function f() 
16723: and the copying of that temporary object into object t2. Effectively, the construction of the local object 
16724: t can be viewed as directly initializing the global object t2, and that object＊s destruction will occur at 
16725: program exit. 〞end example ] 
16726: 16 When the criteria for elision of a copy operation are met and the object to be copied is designated by an 
16727: lvalue, overload resolution to select the constructor for the copy is first performed as if the object were 
16728: designated by an rvalue. If overload resolution fails, or if the type of the first parameter of the selected 
16729: constructor is not an rvalue reference to the object＊s type (possibly cv-qualified), overload resolution is 
16730: performed again, considering the object as an lvalue. [ Note: This two-stage overload resolution must be 
16731: performed regardless of whether copy elision will occur. It determines the constructor to be called if elision 
16732: is not performed, and the selected constructor must be accessible even if the call is elided. 〞 end note ] 
16733: [ Example: 
16734: 115) Because only one object is destroyed instead of two, and one copy constructor is not executed, there is still one object 
16735: destroyed for each one constructed. 
16736: ∫ 12.8 270 
16737: 
16738: c
16739: . ISO/IEC N2800=08-0310 
16740: class Thing { 
16741: public:
16742: Thing();
16743: ~Thing();
16744: Thing(Thing&&);
16745: private:
16746: Thing(const Thing&);
16747: };
16748: Thing f(bool b) {
16749: Thing t;
16750: if (b)
16751: throw t; // OK: Thing(Thing&&) used (or elided) to throw t
16752: return t; // OK: Thing(Thing&&) used (or elided) to return t
16753: }
16754: Thing t2 = f(false); // OK: Thing(Thing&&) used (or elided) to construct of t2 
16755: 〞end example ] 
16756: 12.9 Inheriting Constructors [class.inhctor] 
16757: 1 A using-declaration (7.3.3) that names a constructor implicitly declares a set of inheriting constructors. The 
16758: candidate set of inherited constructors from the class X named in the using-declaration consists of actual 
16759: constructors and notional constructors that result from the transformation of defaulted parameters as follows: 
16760: 〞 all non-template constructors of X, and 
16761: 〞 for each non-template constructor of X that has at least one parameter with a default argument, the set 
16762: of constructors that results from omitting any ellipsis parameter specification and successively omitting 
16763: parameters with a default argument from the end of the parameter-type-list, and 
16764: 〞 all constructor templates of X, and 
16765: 〞 for each constructor template of X that has at least one parameter with a default argument, the set of 
16766: constructor templates that results from omitting any ellipsis parameter specification and successively 
16767: omitting parameters with a default argument from the end of the parameter-type-list. 
16768: 2 The constructor characteristics of a constructor or constructor template are 
16769: 〞 the template parameter list (14.1), if any, 
16770: 〞 the template requirements (14.10.1), if any, 
16771: 〞 the parameter-type-list (8.3.5), 
16772: 〞 the exception-specification (15.4), 
16773: 〞 absence or presence of explicit (12.3.1), and 
16774: 〞 absence or presence of constexpr (7.1.5). 
16775: 3 For each non-template constructor in the candidate set of inherited constructors other than a constructor 
16776: having no parameters or a copy constructor having a single parameter, a constructor is implicitly declared 
16777: with the same constructor characteristics unless there is a user-declared constructor with the same signature 
16778: in the class where the using-declaration appears. Similarly, for each constructor template in the candidate 
16779: ∫ 12.9 271 
16780: 
16781: c
16782: . ISO/IEC N2800=08-0310 
16783: set of inherited constructors, a constructor template is implicitly declared with the same constructor char-
16784: acteristics unless there is an equivalent user-declared constructor template (14.5.6.1) in the class where the 
16785: using-declaration appears. [ Note: Default arguments are not inherited. 〞end note ] 
16786: 4 A constructor so declared has the same access as the corresponding constructor in X. It is deleted if the 
16787: corresponding constructor in X is deleted (8.4). 
16788: 5 [ Note: Default and copy constructors may be implicitly declared as specified in 12.1 and 12.8. 〞end note ] 
16789: 6 [ Example: 
16790: struct B1 {
16791: B1(int);
16792: };
16793: struct B2 {
16794: B2(int = 13, int = 42);
16795: };
16796: struct D1 : B1 {
16797: using B1::B1;
16798: };
16799: struct D2 : B2 {
16800: using B2::B2;
16801: };
16802: The candidate set of inherited constructors in D1 for B1 is 
16803: 〞 B1(const B1&) 
16804: 〞 B1(int)
16805: The set of constructors present in D1 is
16806: 〞 D1(), implicitly-declared default constructor, ill-formed if used 
16807: 〞 D1(const D1&), implicitly-declared copy constructor, not inherited 
16808: 〞 D1(int), implicitly-declared inheriting constructor
16809: The candidate set of inherited constructors in D2 for B2 is
16810: 〞 B2(const B2&) 
16811: 〞 B2(int = 13, int = 42) 
16812: 〞 B2(int = 13) 
16813: 〞 B2()
16814: The set of constructors present in D2 is
16815: 〞 D2(), implicitly-declared default constructor, not inherited 
16816: 〞 D2(const D2&), implicitly-declared copy constructor, not inherited 
16817: 〞 D2(int, int), implicitly-declared inheriting constructor 
16818: 〞 D2(int), implicitly-declared inheriting constructor 
16819: ∫ 12.9 272 
16820: 
16821: c
16822: . ISO/IEC N2800=08-0310 
16823: 〞end example ] 
16824: 7 [ Note: If two using-declarations declare inheriting constructors with the same signatures, the program is 
16825: ill-formed (9.2, 13.1), because an implicitly-declared constructor introduced by the first using-declaration is 
16826: not a user-declared constructor and thus does not preclude another declaration of a constructor with the 
16827: same signature by a subsequent using-declaration.[ Example: 
16828: struct B1 {
16829: B1(int);
16830: };
16831: struct B2 {
16832: B2(int);
16833: };
16834: struct D1 : B1, B2 {
16835: using B1::B1;
16836: using B2::B2;
16837: }; // ill-formed: attempts to declare D1(int) twice 
16838: struct D2 : B1, B2 {
16839: using B1::B1;
16840: using B2::B2;
16841: D2(int); // OK: user declaration supersedes both implicit declarations
16842: }; 
16843: 〞end example ] 〞end note ] 
16844: 8 An inheriting constructor for a class is implicitly defined when it is used (3.2) to create an object of its class 
16845: type (1.8). An implicitly-defined inheriting constructor performs the set of initializations of the class that 
16846: would be performed by a user-written inline constructor for that class with a mem-initializer-list whose 
16847: only mem-initializer has a mem-initializer-id that names the base class named in the nested-name-specifier 
16848: of the using-declaration and an expression-list as specified below, and where the compound-statement in 
16849: its function body is empty (12.6.2). If that user-written constructor would be ill-formed, the program is 
16850: ill-formed. Each expression in the expression-list is of the form static_cast<T&&>(p), where p is the name 
16851: of the corresponding constructor parameter and T is the declared type of p. 
16852: 9 [ Example: 
16853: struct B1 {
16854: B1(int) { }
16855: };
16856: struct B2 {
16857: B2(double) { }
16858: };
16859: struct D1 : B1 {
16860: using B1::B1; // implicitly declares D1(int)
16861: int x;
16862: }; 
16863: void test() {
16864: D1 d(6); // OK: d.x is not initialized
16865: D1 e; // error: D1 has no default constructor
16866: } 
16867: ∫ 12.9 273 
16868: 
16869: . ISO/IEC N2800=08-0310 
16870: struct D2 : B2 {
16871: using B2::B2; // OK: implicitly declares D2(double)
16872: B1 b;
16873: }; 
16874: D2 f(1.0); // error: B1 has no default constructor 
16875: template< class T > 
16876: struct D : T {
16877: using T::T; // declares all constructors from class T
16878: ~D() { std::clog << "Destroying wrapper" << std::endl; }
16879: }; 
16880: Class template D wraps any class and forwards all of its contructors, while writing a message to the standard 
16881: log whenever an object of class D is destroyed. 〞end example ] 
16882: ∫ 12.9 274 
16883: 
16884: c
16885: . ISO/IEC N2800=08-0310 
16886: 13 Overloading [over]
16887: 1 When two or more different declarations are specified for a single name in the same scope, that name is said 
16888: to be overloaded. By extension, two declarations in the same scope that declare the same name but with 
16889: different types are called overloaded declarations. Only function declarations can be overloaded; object and 
16890: type declarations cannot be overloaded. 
16891: 2 When an overloaded function name is used in a call, which overloaded function declaration is being referenced 
16892: is determined by comparing the types of the arguments at the point of use with the types of the parameters 
16893: in the overloaded declarations that are visible at the point of use. This function selection process is called 
16894: overload resolution and is defined in 13.3. [ Example: 
16895: double abs(double);
16896: int abs(int);
16897: abs(1); // calls abs(int);
16898: abs(1.0); // calls abs(double);
16899: 〞end example ] 
16900: 13.1 Overloadable declarations [over.load] 
16901: 1 Not all function declarations can be overloaded. Those that cannot be overloaded are specified here. A 
16902: program is ill-formed if it contains two such non-overloadable declarations in the same scope. [ Note: this 
16903: restriction applies to explicit declarations in a scope, and between such declarations and declarations made 
16904: through a using-declaration (7.3.3). It does not apply to sets of functions fabricated as a result of name 
16905: lookup (e.g., because of using-directives) or overload resolution (e.g., for operator functions). 〞end note ] 
16906: 2 Certain function declarations cannot be overloaded: 
16907: 〞 Function declarations that differ only in the return type cannot be overloaded. 
16908: 〞 Member function declarations with the same name, the same parameter-type-list, and the same tem-
16909: plate requirements (if any) cannot be overloaded if any of them is a static member function declara-
16910: tion (9.4). Likewise, member function template declarations with the same name, the same parameter-
16911: type-list, the same template parameter lists, and the same template requirements (if any) cannot be 
16912: overloaded if any of them is a static member function template declaration. The types of the implicit 
16913: object parameters constructed for the member functions for the purpose of overload resolution (13.3.1) 
16914: are not considered when comparing parameter-type-lists for enforcement of this rule. In contrast, if 
16915: there is no static member function declaration among a set of member function declarations with the 
16916: same name and the same parameter-type-list, then these member function declarations can be over-
16917: loaded if they differ in the type of their implicit object parameter. [ Example: the following illustrates 
16918: this distinction: 
16919: class X {
16920: static void f();
16921: void f(); // ill-formed
16922: void f() const; // ill-formed
16923: void f() const volatile; // ill-formed
16924: void g();
16925: void g() const; // OK: no static g
16926: ∫ 13.1 275 
16927: 
16928: . ISO/IEC N2800=08-0310 
16929: void g() const volatile; // OK: no static g
16930: };
16931: 〞end example ] 
16932: 〞 Member function declarations with the same name and the same parameter-type-list as well as member 
16933: function template declarations with the same name, the same parameter-type-list, the same template 
16934: parameter lists, and the same template requirements cannot be overloaded if any of them, but not all, 
16935: have a ref-qualifier (8.3.5). [ Example: 
16936: class Y {
16937: void h() &;
16938: void h() const &; // OK
16939: void h() &&; // OK, all declarations have a ref-qualifier
16940: void i() &;
16941: void i() const; // ill-formed, prior declaration of i
16942: // has a ref-qualifier 
16943: }; 
16944: 〞end example ] 
16945: 3 [ Note: as specified in 8.3.5, function declarations that have equivalent parameter declarations declare the 
16946: same function and therefore cannot be overloaded: 
16947: 〞 Parameter declarations that differ only in the use of equivalent typedef ※types§ are equivalent. A 
16948: typedef is not a separate type, but only a synonym for another type (7.1.3). [ Example: 
16949: typedef int Int; 
16950: void f(int i);
16951: void f(Int i); // OK: redeclaration of f(int)
16952: void f(int i) { /* ... */ }
16953: void f(Int i) { /* ... */ } // error: redefinition of f(int)
16954: 〞end example ] 
16955: Enumerations, on the other hand, are distinct types and can be used to distinguish overloaded function 
16956: declarations. [ Example: 
16957: enum E { a }; 
16958: void f(int i) { /. ...  / }
16959: void f(E i) { /. ...  / }
16960: 〞end example ] 
16961: 〞 Parameter declarations that differ only in a pointer * versus an array [] are equivalent. That is, the 
16962: array declaration is adjusted to become a pointer declaration (8.3.5). Only the second and subsequent 
16963: array dimensions are significant in parameter types (8.3.4). [ Example: 
16964: int f(char*);
16965: int f(char[]); // same as f(char*);
16966: int f(char[7]); // same as f(char*);
16967: int f(char[9]); // same as f(char*);
16968: int g(char(*)[10]);
16969: int g(char[5][10]); // same as g(char(*)[10]);
16970: int g(char[7][10]); // same as g(char(*)[10]);
16971: ∫ 13.1 276 
16972: 
16973: c
16974: . ISO/IEC N2800=08-0310 
16975: int g(char(*)[20]); // different from g(char(*)[10]); 
16976: 〞end example ] 
16977: 〞 Parameter declarations that differ only in that one is a function type and the other is a pointer to 
16978: the same function type are equivalent. That is, the function type is adjusted to become a pointer to 
16979: function type (8.3.5). [ Example: 
16980: void h(int());
16981: void h(int (*)());
16982: void h(int x()) { }
16983: void h(int (*x)()) { }
16984: // redeclaration of h(int()) 
16985: // definition of h(int()) 
16986: // ill-formed: redefinition of h(int()) 
16987: 〞end example ] 
16988: 〞 Parameter declarations that differ only in the presence or absence of const and/or volatile are 
16989: equivalent. That is, the const and volatile type-specifiers for each parameter type are ignored when 
16990: determining which function is being declared, defined, or called. [ Example: 
16991: typedef const int cInt; 
16992: int f (int);
16993: int f (const int);
16994: int f (int) { ... }
16995: int f (cInt) { ... }
16996: // redeclaration of f(int) 
16997: // definition of f(int) 
16998: // error: redefinition of f(int) 
16999: 〞end example ] 
17000: Only the const and volatile type-specifiers at the outermost level of the parameter type specifica-
17001: tion are ignored in this fashion; const and volatile type-specifiers buried within a parameter type 
17002: specification are significant and can be used to distinguish overloaded function declarations.116 In 
17003: particular, for any type T, ※pointer to T,§ ※pointer to const T,§ and ※pointer to volatile T§ are 
17004: considered distinct parameter types, as are ※reference to T,§ ※reference to const T,§ and ※reference to 
17005: volatile T.§ 
17006: 〞 Two parameter declarations that differ only in their default arguments are equivalent. [ Example: 
17007: consider the following: 
17008: void f (int i, int j);
17009: void f (int i, int j = 99); // OK: redeclaration of f(int, int)
17010: void f (int i = 88, int j); // OK: redeclaration of f(int, int)
17011: void f (); // OK: overloaded declaration of f
17012: void prog () {
17013: f (1, 2); // OK: call f(int, int)
17014: f (1); // OK: call f(int, int)
17015: f (); // Error: f(int, int) or f()?
17016: } 
17017: 〞end example ] 〞end note ] 
17018: 116) When a parameter type includes a function type, such as in the case of a parameter type that is a pointer to function, 
17019: the const and volatile type-specifiers at the outermost level of the parameter type specifications for the inner function type 
17020: are also ignored. 
17021: ∫ 13.1 277 
17022: 
17023: c
17024: . ISO/IEC N2800=08-0310 
17025: 13.2 Declaration matching [over.dcl] 
17026: 1 Two function declarations of the same name refer to the same function if they are in the same scope and 
17027: have equivalent parameter declarations (13.1). A function member of a derived class is not in the same scope 
17028: as a function member of the same name in a base class. [ Example: 
17029: struct B {
17030: int f(int);
17031: };
17032: struct D : B {
17033: int f(char*);
17034: };
17035: Here D::f(char*) hides B::f(int) rather than overloading it. 
17036: void h(D* pd) {
17037: pd->f(1); // error:
17038: // D::f(char*) hides B::f(int)
17039: pd->B::f(1); // OK
17040: pd->f("Ben"); // OK, calls D::f
17041: } 
17042: 〞end example ] 
17043: 2 A locally declared function is not in the same scope as a function in a containing scope. [ Example: 
17044: void f(char*); 
17045: void g() {
17046: extern void f(int);
17047: f("asdf"); // error: f(int) hides f(char*)
17048: // so there is no f(char*) in this scope
17049: }
17050: void caller () {
17051: extern void callee(int, int);
17052: {
17053: extern void callee(int); // hides callee(int, int)
17054: callee(88, 99); // error: only callee(int) in scope
17055: }
17056: }
17057: 〞end example ] 
17058: 3 Different versions of an overloaded member function can be given different access rules. [ Example: 
17059: class buffer { 
17060: private:
17061: char* p;
17062: int size;
17063: protected:
17064: buffer(int s, char* store) { size = s; p = store; }
17065: public:
17066: buffer(int s) { p = new char[size = s]; }
17067: };
17068: ∫ 13.2 278 
17069: 
17070: c
17071: . ISO/IEC N2800=08-0310 
17072: 〞end example ] 
17073: 13.3 Overload resolution [over.match] 
17074: 1 Overload resolution is a mechanism for selecting the best function to call given a list of expressions that are 
17075: to be the arguments of the call and a set of candidate functions that can be called based on the context of 
17076: the call. The selection criteria for the best function are the number of arguments, how well the arguments 
17077: match the parameter-type-list of the candidate function, how well (for non-static member functions) the 
17078: object matches the implied object parameter, and certain other properties of the candidate function. [ Note: 
17079: the function selected by overload resolution is not guaranteed to be appropriate for the context. Other 
17080: restrictions, such as the accessibility of the function, can make its use in the calling context ill-formed. 
17081: 〞end note ] 
17082: 2 Overload resolution selects the function to call in seven distinct contexts within the language: 
17083: 〞 invocation of a function named in the function call syntax (13.3.1.1.1); 
17084: 〞 invocation of a function call operator, a pointer-to-function conversion function, a reference-to-pointer-
17085: to-function conversion function, or a reference-to-function conversion function on a class object named 
17086: in the function call syntax (13.3.1.1.2); 
17087: 〞 invocation of the operator referenced in an expression (13.3.1.2); 
17088: 〞 invocation of a constructor for direct-initialization (8.5) of a class object (13.3.1.3); 
17089: 〞 invocation of a user-defined conversion for copy-initialization (8.5) of a class object (13.3.1.4); 
17090: 〞 invocation of a conversion function for initialization of an object of a nonclass type from an expression 
17091: of class type (13.3.1.5); and 
17092: 〞 invocation of a conversion function for conversion to an lvalue to which a reference (8.5.3) will be 
17093: directly bound (13.3.1.6). 
17094: Each of these contexts defines the set of candidate functions and the list of arguments in its own unique way. 
17095: But, once the candidate functions and argument lists have been identified, the selection of the best function 
17096: is the same in all cases: 
17097: 〞 First, a subset of the candidate functions (those that have the proper number of arguments and meet 
17098: certain other conditions) is selected to form a set of viable functions (13.3.2). 
17099: 〞 Then the best viable function is selected based on the implicit conversion sequences (13.3.3.1) needed 
17100: to match each argument to the corresponding parameter of each viable function. 
17101: 3 If a best viable function exists and is unique, overload resolution succeeds and produces it as the result. 
17102: Otherwise overload resolution fails and the invocation is ill-formed. When overload resolution succeeds, and 
17103: the best viable function is not accessible (Clause 11) in the context in which it is used, the program is 
17104: ill-formed. 
17105: 13.3.1 Candidate functions and argument lists [over.match.funcs] 
17106: 1 The subclauses of 13.3.1 describe the set of candidate functions and the argument list submitted to overload 
17107: resolution in each of the seven contexts in which overload resolution is used. [ Note: With concepts (14.9) and 
17108: constrained templates, the set of candidate functions can be determined by an associated function candidate 
17109: set or a retained candidate set (14.10.3). 〞end note ] The source transformations and constructions defined 
17110: in these subclauses are only for the purpose of describing the overload resolution process. An implementation 
17111: is not required to use such transformations and constructions. 
17112: ∫ 13.3.1 279 
17113: 
17114: c
17115: . ISO/IEC N2800=08-0310 
17116: 2 The set of candidate functions can contain both member and non-member functions to be resolved against 
17117: the same argument list. So that argument and parameter lists are comparable within this heterogeneous 
17118: set, a member function is considered to have an extra parameter, called the implicit object parameter, which 
17119: represents the object for which the member function has been called. For the purposes of overload resolution, 
17120: both static and non-static member functions have an implicit object parameter, but constructors do not. 
17121: 3 Similarly, when appropriate, the context can construct an argument list that contains an implied object 
17122: argument to denote the object to be operated on. Since arguments and parameters are associated by 
17123: position within their respective lists, the convention is that the implicit object parameter, if present, is 
17124: always the first parameter and the implied object argument, if present, is always the first argument. 
17125: 4 For non-static member functions, the type of the implicit object parameter is 
17126: 〞 ※lvalue reference to cv X§ for functions declared without a ref-qualifier or with the & ref-qualifier 
17127: 〞 ※rvalue reference to cv X§ for functions declared with the && ref-qualifier 
17128: where X is the class of which the function is a member and cv is the cv-qualification on the member function 
17129: declaration. [ Example: for a const member function of class X, the extra parameter is assumed to have 
17130: type ※reference to const X§. 〞end example ] For conversion functions, the function is considered to be a 
17131: member of the class of the implicit object argument for the purpose of defining the type of the implicit 
17132: object parameter. For non-conversion functions introduced by a using-declaration into a derived class, the 
17133: function is considered to be a member of the derived class for the purpose of defining the type of the implicit 
17134: object parameter. For static member functions, the implicit object parameter is considered to match any 
17135: object (since if the function is selected, the object is discarded). [ Note: no actual type is established for 
17136: the implicit object parameter of a static member function, and no attempt will be made to determine a 
17137: conversion sequence for that parameter (13.3.3). 〞end note ] 
17138: 5 During overload resolution, the implied object argument is indistinguishable from other arguments. The 
17139: implicit object parameter, however, retains its identity since conversions on the corresponding argument 
17140: shall obey these additional rules: 
17141: 〞 no temporary object can be introduced to hold the argument for the implicit object parameter; and 
17142: 〞 no user-defined conversions can be applied to achieve a type match with it.
17143: For non-static member functions declared without a ref-qualifier, an additional rule applies:
17144: 〞 even if the implicit object parameter is not const-qualified, an rvalue temporary can be bound to the 
17145: parameter as long as in all other respects the temporary can be converted to the type of the implicit 
17146: object parameter. [ Note: The fact that such a temporary is an rvalue does not affect the ranking of 
17147: implicit conversion sequences (13.3.3.2). 〞 end note ] 
17148: 6 Because other than in list-initialization only one user-defined conversion is allowed in an implicit conversion 
17149: sequence, special rules apply when selecting the best user-defined conversion (13.3.3, 13.3.3.1). [ Example: 
17150: class T {
17151: public:
17152: T();
17153: };
17154: class C : T {
17155: public:
17156: C(int);
17157: };
17158: T a = 1; // ill-formed: T(C(1)) not tried
17159: 〞end example ] 
17160: ∫ 13.3.1 280 
17161: 
17162: c
17163: . ISO/IEC N2800=08-0310 
17164: 7 In each case where a candidate is a function template, candidate function template specializations are gen-
17165: erated using template argument deduction (14.8.3, 14.8.2). Those candidates are then handled as candidate 
17166: functions in the usual way.117 A given name can refer to one or more function templates and also to a set 
17167: of overloaded non-template functions. In such a case, the candidate functions generated from each function 
17168: template are combined with the set of non-template candidate functions. 
17169: 13.3.1.1 Function call syntax [over.match.call] 
17170: 1 Recall from 5.2.2, that a function call is a postfix-expression, possibly nested arbitrarily deep in parentheses, 
17171: followed by an optional expression-list enclosed in parentheses: 
17172: ( ... (opt postfix-expression ) ... )opt ( expression-listopt ) 
17173: Overload resolution is requiredif the postfix-expression is the name of a function, a function template (14.5.6), 
17174: an object of class type, or a set of pointers-to-function. 
17175: 2 13.3.1.1.1 describes how overload resolution is used in the first two of the above cases to determine the 
17176: function to call. 13.3.1.1.2 describes how overload resolution is used in the third of the above cases to 
17177: determine the function to call. 
17178: 3 The fourth case arises from a postfix-expression of the form &F, where F names a set of overloaded functions. 
17179: In the context of a function call, &F is treated the same as the name F by itself. Thus, (&F)( expression-
17180: listopt ) is simply (F)( expression-listopt ), which is discussed in 13.3.1.1.1. If the function selected by 
17181: overload resolution according to 13.3.1.1.1 is a non-static member function, the program is ill-formed.118 
17182: (The resolution of &F in other contexts is described in 13.4.) 
17183: 13.3.1.1.1 Call to named function [over.call.func] 
17184: 1 Of interest in 13.3.1.1.1 are only those function calls in which the postfix-expression ultimately contains a 
17185: name that denotes one or more functions that might be called. Such a postfix-expression, perhaps nested 
17186: arbitrarily deep in parentheses, has one of the following forms: 
17187: postfix-expression:
17188: postfix-expression . id-expression
17189: postfix-expression -> id-expression
17190: primary-expression
17191: These represent two syntactic subcategories of function calls: qualified function calls and unqualified function 
17192: calls. 
17193: 2 In qualified function calls, the name to be resolved is an id-expression and is preceded by an -> or . operator. 
17194: Since the construct A->B is generally equivalent to (*A).B, the rest of Clause 13 assumes, without loss of 
17195: generality, that all member function calls have been normalized to the form that uses an object and the 
17196: . operator. Furthermore, Clause 13 assumes that the postfix-expression that is the left operand of the . 
17197: operator has type ※cv T§ where T denotes a class119. Under this assumption, the id-expression in the call 
17198: is looked up as a member function of T following the rules for looking up names in classes (10.2). The 
17199: function declarations found by that lookup constitute the set of candidate functions. The argument list 
17200: is the expression-list in the call augmented by the addition of the left operand of the . operator in the 
17201: normalized member function call as the implied object argument (13.3.1). 
17202: 117) The process of argument deduction fully determines the parameter types of the function template specializations, i.e.,
17203: the parameters of function template specializations contain no template parameter types. Therefore the function template
17204: specializations can be treated as normal (non-template) functions for the remainder of overload resolution.
17205: 118) When F is a non-static member function, a reference of the form &A::f is a pointer-to-member, which cannot be used with
17206: the function-call syntax, and a reference of the form &F is an invalid use of the ※&§ operator on a non-static member function.
17207: 119) Note that cv-qualifiers on the type of objects are significant in overload resolution for both lvalue and class rvalue objects.
17208: ∫ 13.3.1.1.1 281 
17209: 
17210: c
17211: . ISO/IEC N2800=08-0310 
17212: 3 In unqualified function calls, the name is not qualified by an -> or . operator and has the more general form 
17213: of a primary-expression. The name is looked up in the context of the function call following the normal rules 
17214: for name lookup in function calls (3.4). The function declarations found by that lookup constitute the set of 
17215: candidate functions. Because of the rules for name lookup, the set of candidate functions consists (1) entirely 
17216: of non-member functions or (2) entirely of member functions of some class T. In case (1), the argument list 
17217: is the same as the expression-list in the call. In case (2), the argument list is the expression-list in the call 
17218: augmented by the addition of an implied object argument as in a qualified function call. If the keyword 
17219: this (9.3.2) is in scope and refers to class T, or a derived class of T, then the implied object argument is 
17220: (*this). If the keyword this is not in scope or refers to another class, then a contrived object of type 
17221: T becomes the implied object argument120. If the argument list is augmented by a contrived object and 
17222: overload resolution selects one of the non-static member functions of T, the call is ill-formed. 
17223: 13.3.1.1.2 Call to object of class type [over.call.object] 
17224: 1 If the primary-expression E in the function call syntax evaluates to a class object of type ※cv T§, then the 
17225: set of candidate functions includes at least the function call operators of T. The function call operators of T 
17226: are obtained by ordinary lookup of the name operator() in the context of (E).operator(). 
17227: 2 In addition, for each non-explicit conversion function declared in T of the form 
17228: operator conversion-type-id ( ) attribute-specifieropt cv-qualifier ; 
17229: where cv-qualifier is the same cv-qualification as, or a greater cv-qualification than, cv, and where conversion-
17230: type-id denotes the type ※pointer to function of (P1,...,Pn) returning R§, or the type ※reference to pointer to 
17231: function of (P1,...,Pn) returning R§, or the type ※reference to function of (P1,...,Pn) returning R§, a surrogate 
17232: call function with the unique name call-function and having the form 
17233: R call-function ( conversion-type-id F, P1 a1, ... ,Pn an) { return F (a1,... ,an); } 
17234: is also considered as a candidate function. Similarly, surrogate call functions are added to the set of candidate 
17235: functions for each non-explicit conversion function declared in a base class of T provided the function is not 
17236: hidden within T by another intervening declaration121. 
17237: 3 If such a surrogate call function is selected by overload resolution, the corresponding conversion function will 
17238: be called to convert E to the appropriate function pointer or reference, and the function will then be invoked 
17239: with the arguments of the call. If the conversion function cannot be called (e.g., because of an ambiguity), 
17240: the program is ill-formed. 
17241: 4 The argument list submitted to overload resolution consists of the argument expressions present in the 
17242: function call syntax preceded by the implied object argument (E).[ Note: when comparing the call against 
17243: the function call operators, the implied object argument is compared against the implicit object parameter 
17244: of the function call operator. When comparing the call against a surrogate call function, the implied object 
17245: argument is compared against the first parameter of the surrogate call function. The conversion function 
17246: from which the surrogate call function was derived will be used in the conversion sequence for that parameter 
17247: since it converts the implied object argument to the appropriate function pointer or reference required by 
17248: that first parameter. 〞end note ][ Example: 
17249: int f1(int);
17250: int f2(float);
17251: typedef int (*fp1)(int);
17252: 120) An implied object argument must be contrived to correspond to the implicit object parameter attributed to member 
17253: functions during overload resolution. It is not used in the call to the selected function. Since the member functions all have 
17254: the same implicit object parameter, the contrived object will not be the cause to select or reject a function. 
17255: 121) Note that this construction can yield candidate call functions that cannot be differentiated one from the other by overload 
17256: resolution because they have identical declarations or differ only in their return type. The call will be ambiguous if overload 
17257: resolution cannot select a match to the call that is uniquely better than such undifferentiable functions. 
17258: ∫ 13.3.1.1.2 282 
17259: 
17260: c
17261: . ISO/IEC N2800=08-0310 
17262: typedef int (*fp2)(float); 
17263: struct A {
17264: operator fp1() { return f1; }
17265: operator fp2() { return f2; }
17266: } a;
17267: int i = a(1); // calls f1 via pointer returned from
17268: // conversion function
17269: 〞end example ] 
17270: 13.3.1.2 Operators in expressions [over.match.oper] 
17271: 1 If no operand of an operator in an expression has a type that is a class or an enumeration, the operator 
17272: is assumed to be a built-in operator and interpreted according to Clause 5. [ Note: because ., .*, and :: 
17273: cannot be overloaded, these operators are always built-in operators interpreted according to Clause 5. ?: 
17274: cannot be overloaded, but the rules in this subclause are used to determine the conversions to be applied to 
17275: the second and third operands when they have class or enumeration type (5.16). 〞end note ][ Example: 
17276: struct String {
17277: String (const String&);
17278: String (char*);
17279: operator char* ();
17280: };
17281: String operator + (const String&, const String&);
17282: void f(void) {
17283: char* p= "one" + "two"; // ill-formed because neither
17284: // operand has user-defined type
17285: int I = 1 + 1; // Always evaluates to 2 even if
17286: // user-defined types exist which
17287: // would perform the operation.
17288: } 
17289: 〞end example ] 
17290: 2 If either operand has a type that is a class or an enumeration, a user-defined operator function might be 
17291: declared that implements this operator or a user-defined conversion can be necessary to convert the operand 
17292: to a type that is appropriate for a built-in operator. In this case, overload resolution is used to determine 
17293: which operator function or built-in operator is to be invoked to implement the operator. Therefore, the 
17294: operator notation is first transformed to the equivalent function-call notation as summarized in Table 10 
17295: (where @ denotes one of the operators covered in the specified subclause). 
17296: Table 10 〞 Relationship between operator and function call notation 
17297: Subclause Expression As member function As non-member function 
17298: 13.5.1 @a (a).operator@ ( ) operator@ (a) 
17299: 13.5.2 a@b (a).operator@ (b) operator@ (a, b) 
17300: 13.5.3 a=b (a).operator= (b) 
17301: 13.5.5 a[b] (a).operator[](b) 
17302: 13.5.6 a-> (a).operator-> ( ) 
17303: 13.5.7 a@ (a).operator@ (0) operator@ (a, 0) 
17304: 3 For a unary operator @ with an operand of a type whose cv-unqualified version is T1, and for a binary 
17305: operator @ with a left operand of a type whose cv-unqualified version is T1 and a right operand of a type 
17306: ∫ 13.3.1.2 283 
17307: 
17308: c
17309: . ISO/IEC N2800=08-0310 
17310: whose cv-unqualified version is T2, three sets of candidate functions, designated member candidates, non-
17311: member candidates and built-in candidates, are constructed as follows: 
17312: 〞 If T1 is a complete class type, the set of member candidates is the result of the qualified lookup of 
17313: T1::operator@ (13.3.1.1.1); otherwise, the set of member candidates is empty. 
17314: 〞 The set of non-member candidates is the result of the unqualified lookup of operator@ in the context 
17315: of the expression according to the usual rules for name lookup in unqualified function calls (3.4.2) 
17316: except that all member functions are ignored. However, if no operand has a class type, only those 
17317: non-member functions in the lookup set that have a first parameter of type T1 or ※reference to (possibly 
17318: cv-qualified) T1§, when T1 is an enumeration type, or (if there is a right operand) a second parameter 
17319: of type T2 or ※reference to (possibly cv-qualified) T2§, when T2 is an enumeration type, are candidate 
17320: functions. 
17321: 〞 For the operator ,, the unary operator &, or the operator ->, the built-in candidates set is empty. 
17322: For all other operators, the built-in candidates include all of the candidate operator functions defined 
17323: in 13.6 that, compared to the given operator, 
17324: 〞 have the same operator name, and 
17325: 〞 accept the same number of operands, and 
17326: 〞 accept operand types to which the given operand or operands can be converted according to 13.3.3.1, 
17327: and 
17328: 〞 do not have the same parameter-type-list as any non-template non-member candidate. 
17329: 4 For the built-in assignment operators, conversions of the left operand are restricted as follows: 
17330: 〞 no temporaries are introduced to hold the left operand, and 
17331: 〞 no user-defined conversions are applied to the left operand to achieve a type match with the left-most 
17332: parameter of a built-in candidate. 
17333: 5 For all other operators, no such restrictions apply. 
17334: 6 The set of candidate functions for overload resolution is the union of the member candidates, the non-member 
17335: candidates, and the built-in candidates. The argument list contains all of the operands of the operator. The 
17336: best function from the set of candidate functions is selected according to 13.3.2 and 13.3.3.122 [ Example: 
17337: struct A { 
17338: operator int();
17339: };
17340: A operator+(const A&, const A&);
17341: void m() {
17342: A a, b;
17343: a + b; // operator+(a,b) chosen over int(a) + int(b)
17344: }
17345: 〞end example ] 
17346: 7 If a built-in candidate is selected by overload resolution, the operands are converted to the types of the cor-
17347: responding parameters of the selected operation function. Then the operator is treated as the corresponding 
17348: built-in operator and interpreted according to Clause 5. 
17349: 122) If the set of candidate functions is empty, overload resolution is unsuccessful. 
17350: ∫ 13.3.1.2 284 
17351: 
17352: c
17353: . ISO/IEC N2800=08-0310 
17354: 8 The second operand of operator -> is ignored in selecting an operator-> function, and is not an argument 
17355: when the operator-> function is called. When operator-> returns, the operator -> is applied to the value 
17356: returned, with the original second operand.123 
17357: 9 If the operator is the operator ,, the unary operator &, or the operator ->, and there are no viable functions, 
17358: then the operator is assumed to be the built-in operator and interpreted according to Clause 5. 
17359: 10 [ Note: the lookup rules for operators in expressions are different than the lookup rules for operator function 
17360: names in a function call, as shown in the following example: 
17361: struct A { };
17362: void operator + (A, A);
17363: struct B {
17364: void operator + (B);
17365: void f ();
17366: }; 
17367: A a; 
17368: void B::f() {
17369: operator+ (a,a); // error: global operator hidden by member
17370: a + a; // OK: calls global operator+
17371: } 
17372: 〞end note ] 
17373: 13.3.1.3 Initialization by constructor [over.match.ctor] 
17374: 1 When objects of class type are direct-initialized (8.5), or copy-initialized from an expression of the same or 
17375: a derived class type (8.5), overload resolution selects the constructor. For direct-initialization, the candidate 
17376: functions are all the constructors of the class of the object being initialized. For copy-initialization, the 
17377: candidate functions are all the converting constructors (12.3.1) of that class. The argument list is the 
17378: expression-list within the parentheses of the initializer. 
17379: 13.3.1.4 Copy-initialization of class by user-defined conversion [over.match.copy] 
17380: 1 Under the conditions specified in 8.5, as part of a copy-initialization of an object of class type, a user-defined 
17381: conversion can be invoked to convert an initializer expression to the type of the object being initialized. 
17382: Overload resolution is used to select the user-defined conversion to be invoked. Assuming that ※cv1 T§ is 
17383: the type of the object being initialized, with T a class type, the candidate functions are selected as follows: 
17384: 〞 The converting constructors (12.3.1) of T are candidate functions. 
17385: 〞 When the type of the initializer expression is a class type ※cv S§, the non-explicit conversion functions 
17386: of S and its base classes are considered. Those that are not hidden within S and yield a type whose 
17387: cv-unqualified version is the same type as T or is a derived class thereof are candidate functions. 
17388: Conversion functions that return ※reference to X§ return lvalues or rvalues, depending on the type 
17389: of reference, of type X and are therefore considered to yield X for this process of selecting candidate 
17390: functions. 
17391: 2 In both cases, the argument list has one argument, which is the initializer expression. [ Note: this argument 
17392: will be compared against the first parameter of the constructors and against the implicit object parameter 
17393: of the conversion functions. 〞end note ] 
17394: 123) If the value returned by the operator-> function has class type, this may result in selecting and calling another operator-> 
17395: function. The process repeats until an operator-> function returns a value of non-class type. 
17396: ∫ 13.3.1.4 285 
17397: 
17398: c
17399: . ISO/IEC N2800=08-0310 
17400: 13.3.1.5 Initialization by conversion function [over.match.conv] 
17401: 1 Under the conditions specified in 8.5, as part of an initialization of an object of nonclass type, a conversion 
17402: function can be invoked to convert an initializer expression of class type to the type of the object being 
17403: initialized. Overload resolution is used to select the conversion function to be invoked. Assuming that ※cv1 
17404: T§ is the type of the object being initialized, and ※cv S§ is the type of the initializer expression, with S a 
17405: class type, the candidate functions are selected as follows: 
17406: 〞 The conversion functions of S and its base classes are considered. Those non-explicit conversion 
17407: functions that are not hidden within S and yield type T or a type that can be converted to type T 
17408: via a standard conversion sequence (13.3.3.1.1) are candidate functions. For direct-initialization, those 
17409: explicit conversion functions that are not hidden within S and yield type T or a type that can be 
17410: converted to type T with a qualification conversion (4.4) are also candidate functions. Conversion 
17411: functions that return a cv-qualified type are considered to yield the cv-unqualified version of that type 
17412: for this process of selecting candidate functions. Conversion functions that return ※reference to cv2 
17413: X§ return lvalues or rvalues, depending on the type of reference, of type ※cv2 X§ and are therefore 
17414: considered to yield X for this process of selecting candidate functions. 
17415: 2 The argument list has one argument, which is the initializer expression. [ Note: this argument will be 
17416: compared against the implicit object parameter of the conversion functions. 〞end note ] 
17417: 13.3.1.6 Initialization by conversion function for direct reference binding [over.match.ref] 
17418: 1 Under the conditions specified in 8.5.3, a reference can be bound directly to an lvalue that is the result 
17419: of applying a conversion function to an initializer expression. Overload resolution is used to select the 
17420: conversion function to be invoked. Assuming that ※cv1 T§ is the underlying type of the reference being 
17421: initialized, and ※cv S§ is the type of the initializer expression, with S a class type, the candidate functions 
17422: are selected as follows: 
17423: 〞 The conversion functions of S and its base classes are considered, except that for copy-initialization, 
17424: only the non-explicit conversion functions are considered. Those that are not hidden within S and 
17425: yield type ※lvalue reference to cv2 T2§, where ※cv1 T§ is reference-compatible (8.5.3) with ※cv2 T2§, 
17426: are candidate functions. 
17427: 2 The argument list has one argument, which is the initializer expression. [ Note: this argument will be 
17428: compared against the implicit object parameter of the conversion functions. 〞end note ] 
17429: 13.3.1.7 Initialization by list-initialization [over.match.list] 
17430: 1 When objects of non-aggregate class type are list-initialized (8.5.4), overload resolution selects the constructor 
17431: as follows, where T is the cv-unqualified class type of the object being initialized: 
17432: 〞 If T has an initializer-list constructor (8.5.4), the argument list consists of the initializer list as a single 
17433: argument; otherwise, the argument list consists of the elements of the initializer list. 
17434: 〞 For direct-list-initialization, the candidate functions are all the constructors of the class T. 
17435: 〞 For copy-list-initialization, the candidate functions are all the constructors of T. However, if an 
17436: explicit constructor is chosen, the initialization is ill-formed. [ Note: This restriction only applies if 
17437: this initialization is part of the final result of overload resolution 〞end note ] 
17438: ∫ 13.3.1.7 286 
17439: 
17440: c
17441: . ISO/IEC N2800=08-0310 
17442: 13.3.2 Viable functions [over.match.viable] 
17443: 1 From the set of candidate functions constructed for a given context (13.3.1), a set of viable functions is 
17444: chosen, from which the best function will be selected by comparing argument conversion sequences for the 
17445: best fit (13.3.3). The selection of viable functions considers relationships between arguments and function 
17446: parameters other than the ranking of conversion sequences. 
17447: 2 First, to be a viable function, a candidate function shall have enough parameters to agree in number with 
17448: the arguments in the list. 
17449: 〞 If there are m arguments in the list, all candidate functions having exactly m parameters are viable. 
17450: 〞 A candidate function having fewer than m parameters is viable only if it has an ellipsis in its parameter 
17451: list (8.3.5). For the purposes of overload resolution, any argument for which there is no corresponding 
17452: parameter is considered to ※match the ellipsis§ (13.3.3.1.3) . 
17453: 〞 A candidate function having more than m parameters is viable only if the (m+1)-st parameter has a 
17454: default argument (8.3.6).124 For the purposes of overload resolution, the parameter list is truncated 
17455: on the right, so that there are exactly m parameters. 
17456: 3 Second, for F to be a viable function, there shall exist for each argument an implicit conversion se-
17457: quence (13.3.3.1) that converts that argument to the corresponding parameter of F. If the parameter has 
17458: reference type, the implicit conversion sequence includes the operation of binding the reference, and the 
17459: fact that a reference to non-const cannot be bound to an rvalue can affect the viability of the function 
17460: (see 13.3.3.1.4). 
17461: 13.3.3 Best Viable Function [over.match.best] 
17462: 1 Define ICSi(F) as follows: 
17463: 〞 if F is a static member function, ICS1(F) is defined such that ICS1(F) is neither better nor worse than 
17464: ICS1(G) for any function G, and, symmetrically, ICS1(G) is neither better nor worse than ICS1(F)125; 
17465: otherwise, 
17466: 〞 let ICSi(F) denote the implicit conversion sequence that converts the i-th argument in the list to the 
17467: type of the i-th parameter of viable function F. 13.3.3.1 defines the implicit conversion sequences and 
17468: 13.3.3.2 defines what it means for one implicit conversion sequence to be a better conversion sequence 
17469: or worse conversion sequence than another. 
17470: Given these definitions, a viable function F1 is defined to be a better function than another viable function 
17471: F2 if for all arguments i, ICSi(F1) is not a worse conversion sequence than ICSi(F2), and then 
17472: 〞 for some argument j, ICSj(F1) is a better conversion sequence than ICSj(F2), or, if not that, 
17473: 〞 F1 is a non-template function and F2 is a function template specialization, or, if not that, 
17474: 〞 F1 and F2 are function template specializations, and the function template for F1 is more specialized 
17475: than the template for F2 according to the partial ordering rules described in 14.5.6.2, or, if not that, 
17476: 〞 the context is an initialization by user-defined conversion (see 8.5, 13.3.1.5, and 13.3.1.6) and the 
17477: standard conversion sequence from the return type of F1 to the destination type (i.e., the type of the 
17478: entity being initialized) is a better conversion sequence than the standard conversion sequence from 
17479: the return type of F2 to the destination type. [ Example: 
17480: 124) According to 8.3.6, parameters following the (m+1)-st parameter must also have default arguments.
17481: 125) If a function is a static member function, this definition means that the first argument, the implied object parameter, has
17482: no effect in the determination of whether the function is better or worse than any other function.
17483: ∫ 13.3.3 287 
17484: 
17485: c
17486: . ISO/IEC N2800=08-0310 
17487: struct A {
17488: A();
17489: operator int();
17490: operator double();
17491: } a; 
17492: int i = a; // a.operator int() followed by no conversion 
17493: // is better than a.operator double() followed by 
17494: // a conversion to int 
17495: float x = a; // ambiguous: both possibilities require conversions, 
17496: // and neither is better than the other 
17497: 〞end example ] 
17498: 2 If there is exactly one viable function that is a better function than all other viable functions, then it 
17499: is the one selected by overload resolution; otherwise the call is ill-formed126. 
17500: [ Example: 
17501: void Fcn(const int*, short);
17502: void Fcn(int*, int);
17503: int i;
17504: short s = 0;
17505: void f() { 
17506: Fcn(&i, s); // is ambiguous because 
17507: // &i int* is better than &i const int*
17508: ↙ !
17509: // but s short is also better than s int
17510: ↙ ↙ 
17511: Fcn(&i, 1L); // calls Fcn(int*, int), because 
17512: // &i int* is better than &i const int*
17513: !
17514: // and !1L short and 1L int are indistinguishable 
17515: !↙ 
17516: Fcn(&i,＊c＊); // calls Fcn(int*, int), because 
17517: // &i int* is better than &i const int* 
17518: // and !c int is better than c↙ short 
17519: } !↙ 
17520: 〞end example ] 
17521: 3 If the best viable function resolves to a function for which multiple declarations were found, and if at 
17522: least two of these declarations 〞 or the declarations they refer to in the case of using-declarations 〞 
17523: specify a default argument that made the function viable, the program is ill-formed. [ Example: 
17524: namespace A { 
17525: extern "C" void f(int = 5);
17526: }
17527: namespace B {
17528: extern "C" void f(int = 5);
17529: }
17530: 126) The algorithm for selecting the best viable function is linear in the number of viable functions. Run a simple tournament 
17531: to find a function W that is not worse than any opponent it faced. Although another function F that W did not face might be 
17532: at least as good as W, F cannot be the best function because at some point in the tournament F encountered another function 
17533: G such that F was not better than G. Hence, W is either the best function or there is no best function. So, make a second pass 
17534: over the viable functions to verify that W is better than all other functions. 
17535: ∫ 13.3.3 288 
17536: 
17537: . ISO/IEC 
17538: using A::f; 
17539: using B::f; 
17540: void use() { 
17541: f(3); 
17542: f(); 
17543: } 
17544: 〞end example ] 
17545: N2800=08-0310 
17546: // OK, default argument was not used for viability 
17547: // Error: found default argument twice 
17548: 13.3.3.1 Implicit conversion sequences [over.best.ics] 
17549: 1 An implicit conversion sequence is a sequence of conversions used to convert an argument in a function call 
17550: to the type of the corresponding parameter of the function being called. The sequence of conversions is an 
17551: implicit conversion as defined in Clause 4, which means it is governed by the rules for initialization of an 
17552: object or reference by a single expression (8.5, 8.5.3). 
17553: 2 Implicit conversion sequences are concerned only with the type, cv-qualification, and lvalue-ness of the 
17554: argument and how these are converted to match the corresponding properties of the parameter. Other 
17555: properties, such as the lifetime, storage class, alignment, or accessibility of the argument and whether or not 
17556: the argument is a bit-field are ignored. So, although an implicit conversion sequence can be defined for a 
17557: given argument-parameter pair, the conversion from the argument to the parameter might still be ill-formed 
17558: in the final analysis. 
17559: 3 A well-formed implicit conversion sequence is one of the following forms: 
17560: 〞 a standard conversion sequence (13.3.3.1.1), 
17561: 〞 a user-defined conversion sequence (13.3.3.1.2), or 
17562: 〞 an ellipsis conversion sequence (13.3.3.1.3). 
17563: 4 However, when considering the argument of a user-defined conversion function that is a candidate by 13.3.1.3 
17564: when invoked for the copying of the temporary in the second step of a class copy-initialization, by 13.3.1.7 
17565: when passing the initializer list as a single argument or when the initializer list has exactly one element and 
17566: a conversion to some class X or reference to (possibly cv-qualified) X is considered for the first parameter of 
17567: a constructor of X, or by 13.3.1.4, 13.3.1.5, or 13.3.1.6 in all cases, only standard conversion sequences and 
17568: ellipsis conversion sequences are allowed. 
17569: 5 For the case where the parameter type is a reference, see 13.3.3.1.4. 
17570: 6 When the parameter type is not a reference, the implicit conversion sequence models a copy-initialization of 
17571: the parameter from the argument expression. The implicit conversion sequence is the one required to convert 
17572: the argument expression to an rvalue of the type of the parameter. [ Note: when the parameter has a class 
17573: type, this is a conceptual conversion defined for the purposes of Clause 13; the actual initialization is defined 
17574: in terms of constructors and is not a conversion. 〞end note ] Any difference in top-level cv-qualification is 
17575: subsumed by the initialization itself and does not constitute a conversion. [ Example: a parameter of type A 
17576: can be initialized from an argument of type const A. The implicit conversion sequence for that case is the 
17577: identity sequence; it contains no ※conversion§ from const A to A. 〞 end example ] When the parameter has 
17578: a class type and the argument expression has the same type, the implicit conversion sequence is an identity 
17579: conversion. When the parameter has a class type and the argument expression has a derived class type, 
17580: the implicit conversion sequence is a derived-to-base Conversion from the derived class to the base class. 
17581: [ Note: there is no such standard conversion; this derived-to-base Conversion exists only in the description of 
17582: implicit conversion sequences. 〞end note ] A derived-to-base Conversion has Conversion rank (13.3.3.1.1). 
17583: ∫ 13.3.3.1 289 
17584: 
17585: c
17586: . ISO/IEC N2800=08-0310 
17587: 7 In all contexts, when converting to the implicit object parameter or when converting to the left operand of 
17588: an assignment operation only standard conversion sequences that create no temporary object for the result 
17589: are allowed. 
17590: 8 If no conversions are required to match an argument to a parameter type, the implicit conversion sequence 
17591: is the standard conversion sequence consisting of the identity conversion (13.3.3.1.1). 
17592: 9 If no sequence of conversions can be found to convert an argument to a parameter type or the conversion is 
17593: otherwise ill-formed, an implicit conversion sequence cannot be formed. 
17594: 10 If several different sequences of conversions exist that each convert the argument to the parameter type, the 
17595: implicit conversion sequence associated with the parameter is defined to be the unique conversion sequence 
17596: designated the ambiguous conversion sequence. For the purpose of ranking implicit conversion sequences 
17597: as described in 13.3.3.2, the ambiguous conversion sequence is treated as a user-defined sequence that is 
17598: indistinguishable from any other user-defined conversion sequence127. If a function that uses the ambiguous 
17599: conversion sequence is selected as the best viable function, the call will be ill-formed because the conversion 
17600: of one of the arguments in the call is ambiguous. 
17601: 11 The three forms of implicit conversion sequences mentioned above are defined in the following subclauses. 
17602: 13.3.3.1.1 Standard conversion sequences [over.ics.scs] 
17603: 1 Table 11 summarizes the conversions defined in Clause 4 and partitions them into four disjoint categories: 
17604: Lvalue Transformation, Qualification Adjustment, Promotion, and Conversion. [ Note: these categories are 
17605: orthogonal with respect to lvalue-ness, cv-qualification, and data representation: the Lvalue Transformations 
17606: do not change the cv-qualification or data representation of the type; the Qualification Adjustments do not 
17607: change the lvalue-ness or data representation of the type; and the Promotions and Conversions do not change 
17608: the lvalue-ness or cv-qualification of the type. 〞end note ] 
17609: 2 [ Note: As described in Clause 4, a standard conversion sequence is either the Identity conversion by itself 
17610: (that is, no conversion) or consists of one to three conversions from the other four categories. At most one 
17611: conversion from each category is allowed in a single standard conversion sequence. If there are two or more 
17612: conversions in the sequence, the conversions are applied in the canonical order: Lvalue Transformation, 
17613: Promotion or Conversion, Qualification Adjustment. 〞end note ] 
17614: 3 Each conversion in Table 11 also has an associated rank (Exact Match, Promotion, or Conversion). These are 
17615: used to rank standard conversion sequences (13.3.3.2). The rank of a conversion sequence is determined by 
17616: 127) The ambiguous conversion sequence is ranked with user-defined conversion sequences because multiple conversion se-
17617: quences for an argument can exist only if they involve different user-defined conversions. The ambiguous conversion sequence is 
17618: indistinguishable from any other user-defined conversion sequence because it represents at least two user-defined conversion se-
17619: quences, each with a different user-defined conversion, and any other user-defined conversion sequence must be indistinguishable 
17620: from at least one of them. 
17621: This rule prevents a function from becoming non-viable because of an ambiguous conversion sequence for one of its parameters. 
17622: Consider this example, 
17623: class B;
17624: class A { A (B&);};
17625: class B { operator A (); };
17626: class C { C (B&); };
17627: void f(A) { }
17628: void f(C) { }
17629: B b;
17630: f(b); // ambiguous because bC via constructor and
17631: !
17632: // bA via constructor or conversion function. 
17633: !
17634: If it were not for this rule, f(A) would be eliminated as a viable function for the call f(b) causing overload resolution to 
17635: select f(C) as the function to call even though it is not clearly the best choice. On the other hand, if an f(B) were to be 
17636: declared then f(b) would resolve to that f(B) because the exact match with f(B) is better than any of the sequences required 
17637: to match f(A). 
17638: ∫ 13.3.3.1.1 290 
17639: 
17640: . ISO/IEC N2800=08-0310 
17641: considering the rank of each conversion in the sequence and the rank of any reference binding (13.3.3.1.4). If 
17642: any of those has Conversion rank, the sequence has Conversion rank; otherwise, if any of those has Promotion 
17643: rank, the sequence has Promotion rank; otherwise, the sequence has Exact Match rank. 
17644: Table 11 〞 Conversions 
17645: Conversion Category Rank Subclause 
17646: No conversions required Identity 
17647: Exact Match 
17648: Lvalue-to-rvalue conversion 
17649: Lvalue Transformation 
17650: 4.1 
17651: Array-to-pointer conversion 4.2 
17652: Function-to-pointer conversion 4.3 
17653: Qualification conversions Qualification Adjustment 4.4 
17654: Integral promotions Promotion Promotion 4.5 
17655: Floating point promotion 4.6 
17656: Integral conversions 
17657: Conversion Conversion 
17658: 4.7 
17659: Floating point conversions 4.8 
17660: Floating-integral conversions 4.9 
17661: Pointer conversions 4.10 
17662: Pointer to member conversions 4.11 
17663: Boolean conversions 4.12 
17664: 13.3.3.1.2 User-defined conversion sequences [over.ics.user] 
17665: 1 A user-defined conversion sequence consists of an initial standard conversion sequence followed by a user-
17666: defined conversion (12.3) followed by a second standard conversion sequence. If the user-defined conversion 
17667: is specified by a constructor (12.3.1), the initial standard conversion sequence converts the source type to the 
17668: type required by the argument of the constructor. If the user-defined conversion is specified by a conversion 
17669: function (12.3.2), the initial standard conversion sequence converts the source type to the implicit object 
17670: parameter of the conversion function. 
17671: 2 The second standard conversion sequence converts the result of the user-defined conversion to the target type 
17672: for the sequence. Since an implicit conversion sequence is an initialization, the special rules for initialization 
17673: by user-defined conversion apply when selecting the best user-defined conversion for a user-defined conversion 
17674: sequence (see 13.3.3 and 13.3.3.1). 
17675: 3 If the user-defined conversion is specified by a specialization of a conversion function template, the second 
17676: standard conversion sequence shall have exact match rank. 
17677: 4 A conversion of an expression of class type to the same class type is given Exact Match rank, and a conversion 
17678: of an expression of class type to a base class of that type is given Conversion rank, in spite of the fact that 
17679: a copy constructor (i.e., a user-defined conversion function) is called for those cases. 
17680: 13.3.3.1.3 Ellipsis conversion sequences [over.ics.ellipsis] 
17681: 1 An ellipsis conversion sequence occurs when an argument in a function call is matched with the ellipsis 
17682: parameter specification of the function called (see 5.2.2). 
17683: 13.3.3.1.4 Reference binding [over.ics.ref] 
17684: 1 When a parameter of reference type binds directly (8.5.3) to an argument expression, the implicit conversion 
17685: sequence is the identity conversion, unless the argument expression has a type that is a derived class of the 
17686: parameter type, in which case the implicit conversion sequence is a derived-to-base Conversion (13.3.3.1). 
17687: [ Example: 
17688: ∫ 13.3.3.1.4 291 
17689: 
17690: c
17691: . ISO/IEC N2800=08-0310 
17692: struct A {};
17693: struct B : public A {} b;
17694: int f(A&);
17695: int f(B&);
17696: int i = f(b); // calls f(B&), an exact match, rather than
17697: // f(A&), a conversion 
17698: 〞end example ] If the parameter binds directly to the result of applying a conversion function to the 
17699: argument expression, the implicit conversion sequence is a user-defined conversion sequence (13.3.3.1.2), 
17700: with the second standard conversion sequence either an identity conversion or, if the conversion function 
17701: returns an entity of a type that is a derived class of the parameter type, a derived-to-base Conversion. 
17702: 2 When a parameter of reference type is not bound directly to an argument expression, the conversion sequence 
17703: is the one required to convert the argument expression to the underlying type of the reference according 
17704: to 13.3.3.1. Conceptually, this conversion sequence corresponds to copy-initializing a temporary of the 
17705: underlying type with the argument expression. Any difference in top-level cv-qualification is subsumed by 
17706: the initialization itself and does not constitute a conversion. 
17707: 3 A standard conversion sequence cannot be formed if it requires binding an lvalue reference to non-const to 
17708: an rvalue (except when binding an implicit object parameter; see the special rules for that case in 13.3.1). 
17709: [ Note: this means, for example, that a candidate function cannot be a viable function if it has a non-const 
17710: lvalue reference parameter (other than the implicit object parameter) and the corresponding argument is a 
17711: temporary or would require one to be created to initialize the lvalue reference (see 8.5.3). 〞end note ] 
17712: 4 Other restrictions on binding a reference to a particular argument that are not based on the types of 
17713: the reference and the argument do not affect the formation of a standard conversion sequence, however. 
17714: [ Example: a function with an ※lvalue reference to int§ parameter can be a viable candidate even if the 
17715: corresponding argument is an int bit-field. The formation of implicit conversion sequences treats the int 
17716: bit-field as an int lvalue and finds an exact match with the parameter. If the function is selected by overload 
17717: resolution, the call will nonetheless be ill-formed because of the prohibition on binding a non-const lvalue 
17718: reference to a bit-field (8.5.3). 〞end example ] 
17719: 5 The binding of a reference to an expression that is reference-compatible with added qualification influences 
17720: the rank of a standard conversion; see 13.3.3.2 and 8.5.3. 
17721: 13.3.3.1.5 List-initialization sequence [over.ics.list] 
17722: 1 When an argument is an initializer list (8.5.4), it is not an expression and special rules apply for converting 
17723: it to a parameter type. 
17724: 2 If the parameter type is std::initializer_list<X> and all the elements of the initializer list can be 
17725: implicitly converted to X, the implicit conversion sequence is the worst conversion necessary to convert an 
17726: element of the list to X. This conversion can be a user-defined conversion even in the context of a call to an 
17727: initializer-list constructor. [ Example: 
17728: void f(std::initializer_list<int>);
17729: f( {1,2,3} ); // OK: f(initializer_list<int>) identity conversion
17730: f( {＊a＊,＊b＊} ); // OK: f(initializer_list<int>) integral promotion
17731: f( {1.0} ); // error: narrowing
17732: struct A {
17733: A(std::initializer_list<double>); // #1
17734: A(std::initializer_list<complex<double>>); // #2
17735: A(std::initializer_list<std::string>); // #3
17736: }; 
17737: A a{ 1.0,2.0 }; // OK, uses #1 
17738: ∫ 13.3.3.1.5 292 
17739: 
17740: c
17741: . ISO/IEC N2800=08-0310 
17742: void g(A);
17743: g({ "foo", "bar" }); // OK, uses #3
17744: 〞end example ] 
17745: 3 Otherwise, if the parameter is a non-aggregate class X and overload resolution per 13.3.1.7 chooses a single 
17746: best constructor of X to perform the initialization of an object of type X from the argument initializer list, the 
17747: implicit conversion sequence is a user-defined conversion sequence. If multiple constructors are viable but 
17748: none is better than the others, the implicit conversion sequence is the ambiguous conversion sequence. User-
17749: defined conversions are allowed for conversion of the initializer list elements to the constructor parameter 
17750: types except as noted in 13.3.3.1. [ Example: 
17751: struct A { 
17752: A(std::initializer_list<int>); 
17753: }; 
17754: void f(A); 
17755: f( {＊a＊, ＊b＊} ); // OK: f(A(std::initializer_list<int>)) user-defined conversion 
17756: struct B { 
17757: B(int, double); 
17758: }; 
17759: void g(B); 
17760: g( {＊a＊, ＊b＊} ); // OK: g(B(int,double)) user-defined conversion 
17761: g( {1.0, 1,0} ); // error: narrowing 
17762: void f(B);
17763: f( {＊a＊, ＊b＊} ); // error: ambiguous f(A) or f(B)
17764: struct C { 
17765: C(std::string); 
17766: }; 
17767: void h(C); 
17768: h({"foo"}); // OK: h(C(std::string("foo"))) 
17769: struct D { 
17770: C(A, C); 
17771: }; 
17772: void i(D); 
17773: i({ {1,2}, {"bar"} }); // OK: i(D(A(std::initializer_list<int>{1,2}),C(std::string("bar")))) 
17774: 〞end example ] 
17775: 4 Otherwise, if the parameter has an aggregate type which can be initialized from the initializer list according 
17776: to the rules for aggregate initialization (8.5.1), the implicit conversion sequence is a user-defined conversion 
17777: sequence. [ Example: 
17778: struct A {
17779: int m1;
17780: double m2;
17781: }; 
17782: void f(A);
17783: f( {＊a＊, ＊b＊} ); // OK: f(A(int,double)) user-defined conversion
17784: f( {1.0} ); // error: narrowing
17785: ∫ 13.3.3.1.5 293 
17786: 
17787: c
17788: . ISO/IEC N2800=08-0310 
17789: 〞end example ] 
17790: 5 Otherwise, if the parameter is a reference, see 13.3.3.1.4. [ Note: The rules in this section will apply for 
17791: initializing the underlying temporary for the reference. 〞end note ][ Example: 
17792: struct A {
17793: int m1;
17794: double m2;
17795: }; 
17796: void f(const A&);
17797: f( {＊a＊, ＊b＊} ); // OK: f(A(int,double)) user-defined conversion
17798: f( {1.0} ); // error: narrowing
17799: void g(const double &);
17800: g({1}); // same conversion as int to double
17801: 〞end example ] 
17802: 6 Otherwise, if the parameter type is not a class: 
17803: 〞 if the initializer list has one element, the implicit conversion sequence is the one required to convert 
17804: the element to the parameter type; [ Example: 
17805: void f(int);
17806: f( {＊a＊} ); // OK: same conversion as char to int
17807: f( {1.0} ); // error: narrowing
17808: 〞end example ] 
17809: 〞 if the initializer list has no elements, the implicit conversion sequence is the identity conversion. 
17810: [ Example: 
17811: void f(int); 
17812: f( { } ); // OK: identity conversion 
17813: 〞end example ] 
17814: 7 In all cases other than those enumerated above, no conversion is possible. 
17815: 13.3.3.2 Ranking implicit conversion sequences [over.ics.rank] 
17816: 1 13.3.3.2defines a partial ordering of implicit conversion sequences based on the relationships better conversion 
17817: sequence and better conversion. If an implicit conversion sequence S1 is defined by these rules to be a better 
17818: conversion sequence than S2, then it is also the case that S2 is a worse conversion sequence than S1. If 
17819: conversion sequence S1 is neither better than nor worse than conversion sequence S2, S1 and S2 are said to 
17820: be indistinguishable conversion sequences. 
17821: 2 When comparing the basic forms of implicit conversion sequences (as defined in 13.3.3.1) 
17822: 〞 a standard conversion sequence (13.3.3.1.1) is a better conversion sequence than a user-defined con-
17823: version sequence or an ellipsis conversion sequence, and 
17824: 〞 a user-defined conversion sequence (13.3.3.1.2) is a better conversion sequence than an ellipsis conver-
17825: sion sequence (13.3.3.1.3). 
17826: 3 Two implicit conversion sequences of the same form are indistinguishable conversion sequences unless one of 
17827: the following rules applies: 
17828: ∫ 13.3.3.2 294 
17829: 
17830: c
17831: . ISO/IEC N2800=08-0310 
17832: 〞 Standard conversion sequence S1 is a better conversion sequence than standard conversion sequence 
17833: S2 if 
17834: 〞 S1 is a proper subsequence of S2 (comparing the conversion sequences in the canonical form 
17835: defined by 13.3.3.1.1, excluding any Lvalue Transformation; the identity conversion sequence is 
17836: considered to be a subsequence of any non-identity conversion sequence) or, if not that, 
17837: 〞 the rank of S1 is better than the rank of S2, or S1 and S2 have the same rank and are distin-
17838: guishable by the rules in the paragraph below, or, if not that, 
17839: 〞 S1 and S2 differ only in their qualification conversion and yield similar types T1 and T2 (4.4), 
17840: respectively, and the cv-qualification signature of type T1 is a proper subset of the cv-qualification 
17841: signature of type T2, and S1 is not the deprecated string literal array-to-pointer conversion (4.2). 
17842: [ Example: 
17843: int f(const int *);
17844: int f(int *);
17845: int i;
17846: int j = f(&i); // calls f(int*)
17847: 〞end example ] or, if not that, 
17848: 〞 S1 and S2 are reference bindings (8.5.3) and neither refers to an implicit object parameter of a non-
17849: static member function declared without a ref-qualifier, and either S1 binds an lvalue reference 
17850: to an lvalue and S2 binds an rvalue reference or S1 binds an rvalue reference to an rvalue and S2 
17851: binds an lvalue reference. 
17852: [ Example: 
17853: int i;
17854: int f();
17855: int g(const int&);
17856: int g(const int&&);
17857: int j = g(i); // calls g(const int&)
17858: int k = g(f()); // calls g(const int&&)
17859: struct A {
17860: A& operator<<(int);
17861: void p() &;
17862: void p() &&;
17863: };
17864: A& operator<<(A&&, char);
17865: A() << 1; // calls A::operator<<(int)
17866: A() << ＊c＊; // calls operator<<(A&&, char)
17867: A a;
17868: a << 1; // calls A::operator<<(int)
17869: a << ＊c＊; // calls operator<<(A&&, char)
17870: A().p(); // calls A::p()&&
17871: a.p(); // calls A::p()&
17872: 〞end example ] or, if not that, 
17873: 〞 S1 and S2 are reference bindings (8.5.3), and the types to which the references refer are the same 
17874: type except for top-level cv-qualifiers, and the type to which the reference initialized by S2 refers 
17875: is more cv-qualified than the type to which the reference initialized by S1 refers. [ Example: 
17876: int f(const int &); 
17877: ∫ 13.3.3.2 295 
17878: 
17879: c
17880: . ISO/IEC N2800=08-0310 
17881: int f(int &);
17882: int g(const int &);
17883: int g(int);
17884: int i;
17885: int j = f(i); // calls f(int &)
17886: int k = g(i); // ambiguous
17887: struct X {
17888: void f() const;
17889: void f();
17890: }; 
17891: void g(const X& a, X b) {
17892: a.f(); // calls X::f() const
17893: b.f(); // calls X::f()
17894: } 
17895: 〞end example ] 
17896: 〞 User-defined conversion sequence U1 is a better conversion sequence than another user-defined conver-
17897: sion sequence U2 if they contain the same user-defined conversion function or constructor and if the 
17898: second standard conversion sequence of U1 is better than the second standard conversion sequence of 
17899: U2.[ Example: 
17900: struct A { 
17901: operator short(); 
17902: } a; 
17903: int f(int); 
17904: int f(float); 
17905: int i = f(a); // calls f(int), because short int is 
17906: // better than short float. ↙ 
17907: ↙ 
17908: 〞end example ] 
17909: 4 Standard conversion sequences are ordered by their ranks: an Exact Match is a better conversion than a 
17910: Promotion, which is a better conversion than a Conversion. Two conversion sequences with the same rank 
17911: are indistinguishable unless one of the following rules applies: 
17912: 〞 A conversion that is not a conversion of a pointer, or pointer to member, to bool is better than another 
17913: conversion that is such a conversion. 
17914: 〞 If class B is derived directly or indirectly from class A, conversion of B* to A* is better than conversion 
17915: of B* to void*, and conversion of A* to void* is better than conversion of B* to void*. 
17916: 〞 If class B is derived directly or indirectly from class A and class C is derived directly or indirectly from 
17917: B, 
17918: 〞 conversion of C* to B* is better than conversion of C* to A*,[ Example: 
17919: struct A {};
17920: struct B : public A {};
17921: struct C : public B {};
17922: C *pc;
17923: int f(A *);
17924: int f(B *);
17925: int i = f(pc); // calls f(B*)
17926: 〞end example ] 
17927: ∫ 13.3.3.2 296 
17928: 
17929: c
17930: . ISO/IEC N2800=08-0310 
17931: 〞 binding of an expression of type C to a reference of type B& is better than binding an expression 
17932: of type C to a reference of type A&, 
17933: 〞 conversion of A::* to B::* is better than conversion of A::* to C::*, 
17934: 〞 conversion of C to B is better than conversion of C to A, 
17935: 〞 conversion of B* to A* is better than conversion of C* to A*, 
17936: 〞 binding of an expression of type B to a reference of type A& is better than binding an expression 
17937: of type C to a reference of type A&, 
17938: 〞 conversion of B::* to C::* is better than conversion of A::* to C::*, and 
17939: 〞 conversion of B to A is better than conversion of C to A. 
17940: [ Note: compared conversion sequences will have different source types only in the context of comparing 
17941: the second standard conversion sequence of an initialization by user-defined conversion (see 13.3.3); 
17942: in all other contexts, the source types will be the same and the target types will be different. 〞end 
17943: note ] 
17944: 13.4 Address of overloaded function [over.over] 
17945: 1 A use of an overloaded function name without arguments is resolved in certain contexts to a function, a 
17946: pointer to function or a pointer to member function for a specific function from the overload set. A function 
17947: template name is considered to name a set of overloaded functions in such contexts. The function selected 
17948: is the one whose type matches the target type required in the context. The target can be 
17949: 〞 an object or reference being initialized (8.5, 8.5.3), 
17950: 〞 the left side of an assignment (5.17), 
17951: 〞 a parameter of a function (5.2.2), 
17952: 〞 a parameter of a user-defined operator (13.5), 
17953: 〞 the return value of a function, operator function, or conversion (6.6.3), 
17954: 〞 an explicit type conversion (5.2.3, 5.2.9, 5.4), or 
17955: 〞 a non-type template-parameter (14.3.2). 
17956: The overloaded function name can be preceded by the & operator. An overloaded function name shall not 
17957: be used without arguments in contexts other than those listed. [ Note: any redundant set of parentheses 
17958: surrounding the overloaded function name is ignored (5.1). 〞end note ] 
17959: 2 If the name is a function template, template argument deduction is done (14.8.2.2), and if the argument 
17960: deduction succeeds, the resulting template argument list is used to generate a single function template 
17961: specialization, which is added to the set of overloaded functions considered. [ Note: As described in 14.8.1, 
17962: if deduction fails and the function template name is followed by an explicit template argument list, the 
17963: template-id is then examined to see whether it identifies a single function template specialization. If it does, 
17964: the template-id is considered to be an lvalue for that function template specialization. The target type is 
17965: not used in that determination. 〞 end note ] 
17966: 3 Non-member functions and static member functions match targets of type ※pointer-to-function§ or ※reference-
17967: to-function.§ Nonstatic member functions match targets of type ※pointer-to-member-function;§ the function 
17968: type of the pointer to member is used to select the member function from the set of overloaded member 
17969: functions. If a non-static member function is selected, the reference to the overloaded function name is 
17970: required to have the form of a pointer to member as described in 5.3.1. 
17971: ∫ 13.4 297 
17972: 
17973: c
17974: . ISO/IEC N2800=08-0310 
17975: 4 If more than one function is selected, any function template specializations in the set are eliminated if the 
17976: set also contains a non-template function, and any given function template specialization F1 is eliminated if 
17977: the set contains a second function template specialization whose function template is more specialized than 
17978: the function template of F1 according to the partial ordering rules of 14.5.6.2. After such eliminations, if 
17979: any, there shall remain exactly one selected function. 
17980: 5 [ Example: 
17981: int f(double);
17982: int f(int);
17983: int (*pfd)(double) = &f; // selects f(double)
17984: int (*pfi)(int) = &f; // selects f(int)
17985: int (*pfe)(...) = &f; // error: type mismatch
17986: int (&rfi)(int) = f; // selects f(int)
17987: int (&rfd)(double) = f; // selects f(double)
17988: void g() {
17989: (int (*)(int))&f; // cast expression as selector
17990: }
17991: The initialization of pfe is ill-formed because no f() with type int(...) has been declared, and not because 
17992: of any ambiguity. For another example, 
17993: struct X {
17994: int f(int);
17995: static int f(long);
17996: }; 
17997: int (X::*p1)(int) = &X::f; // OK
17998: int (*p2)(int) = &X::f; // error: mismatch
17999: int (*p3)(long) = &X::f; // OK
18000: int (X::*p4)(long) = &X::f; // error: mismatch
18001: int (X::*p5)(int) = &(X::f); // error: wrong syntax for
18002: // pointer to member
18003: int (*p6)(long) = &(X::f); // OK
18004: 〞end example ] 
18005: 6 [ Note: if f() and g() are both overloaded functions, the cross product of possibilities must be considered 
18006: to resolve f(&g), or the equivalent expression f(g). 〞end note ] 
18007: 7 [ Note: there are no standard conversions (Clause 4) of one pointer-to-function type into another. In partic-
18008: ular, even if B is a public base of D, we have 
18009: D* f();
18010: B* (*p1)() = &f; // error
18011: void g(D*);
18012: void (*p2)(B*) = &g; // error
18013: 〞end note ] 
18014: 13.5 Overloaded operators [over.oper] 
18015: 1 A function declaration having one of the following operator-function-ids as its name declares an operator 
18016: function. A function template declaration having one of the following operator-function-ids as its name 
18017: ∫ 13.5 298 
18018: 
18019: c
18020: . ISO/IEC N2800=08-0310 
18021: declares an operator function template. A specialization of an operator function template is also an operator 
18022: function. An operator function is said to implement the operator named in its operator-function-id. 
18023: operator-function-id:
18024: operator operator
18025: operator: one of 
18026: new delete new[] delete[] 
18027: +-* / % . & | != < > +=-=*=/=%= 
18028: .=&= |= << >> >>= <<= == != 
18029: <=>= && || ++ --, ->*-> 
18030: ( ) [ ] 
18031: [ Note: the last two operators are function call (5.2.2) and subscripting (5.2.1). The operators new[], 
18032: delete[], (), and [] are formed from more than one token. 〞end note ] 
18033: 2 Both the unary and binary forms of 
18034: +-* & 
18035: can be overloaded. 
18036: 3 The following operators cannot be overloaded: 
18037: . .* :: ?: 
18038: nor can the preprocessing symbols # and ## (Clause 16). 
18039: 4 Operator functions are usually not called directly; instead they are invoked to evaluate the operators they 
18040: implement (13.5.1 每 13.5.7). They can be explicitly called, however, using the operator-function-id as the 
18041: name of the function in the function call syntax (5.2.2). [ Example: 
18042: complex z = a.operator+(b); // complex z = a+b;
18043: void* p = operator new(sizeof(int)*n);
18044: 〞end example ] 
18045: 5 The allocation and deallocation functions, operator new, operator new[], operator delete and operator 
18046: delete[], are described completely in 3.7.4. The attributes and restrictions found in the rest of this 
18047: subclause do not apply to them unless explicitly stated in 3.7.4. 
18048: 6 An operator function shall either be a non-static member function or be a non-member function and have 
18049: at least one parameter whose type is a class, a reference to a class, an enumeration, or a reference to an 
18050: enumeration. It is not possible to change the precedence, grouping, or number of operands of operators. 
18051: The meaning of the operators =, (unary) &, and , (comma), predefined for each type, can be changed for 
18052: specific class and enumeration types by defining operator functions that implement these operators. Operator 
18053: functions are inherited in the same manner as other base class functions. 
18054: 7 The identities among certain predefined operators applied to basic types (for example, ++a √ a+=1) need 
18055: not hold for operator functions. Some predefined operators, such as +=, require an operand to be an lvalue 
18056: when applied to basic types; this is not required by operator functions. 
18057: 8 An operator function cannot have default arguments (8.3.6), except where explicitly stated below. Operator 
18058: functions cannot have more or fewer parameters than the number required for the corresponding operator, 
18059: as described in the rest of this subclause. 
18060: ∫ 13.5 299 
18061: 
18062: c
18063: . ISO/IEC N2800=08-0310 
18064: 9 Operators not mentioned explicitly in subclauses 13.5.3 through 13.5.7 act as ordinary unary and binary 
18065: operators obeying the rules of 13.5.1 or 13.5.2. 
18066: 13.5.1 Unary operators [over.unary] 
18067: 1 A prefix unary operator shall be implemented by a non-static member function (9.3) with no parameters or 
18068: a non-member function with one parameter. Thus, for any prefix unary operator @, @x can be interpreted 
18069: as either x.operator@() or operator@(x). If both forms of the operator function have been declared, the 
18070: rules in 13.3.1.2 determine which, if any, interpretation is used. See 13.5.7 for an explanation of the postfix 
18071: unary operators ++ and --. 
18072: 2 The unary and binary forms of the same operator are considered to have the same name. [ Note: consequently, 
18073: a unary operator can hide a binary operator from an enclosing scope, and vice versa. 〞end note ] 
18074: 13.5.2 Binary operators [over.binary] 
18075: 1 A binary operator shall be implemented either by a non-static member function (9.3) with one parameter 
18076: or by a non-member function with two parameters. Thus, for any binary operator @, x@y can be interpreted 
18077: as either x.operator@(y) or operator@(x,y). If both forms of the operator function have been declared, 
18078: the rules in 13.3.1.2 determine which, if any, interpretation is used. 
18079: 13.5.3 Assignment [over.ass] 
18080: 1 An assignment operator shall be implemented by a non-static member function with exactly one parameter. 
18081: Because a copy assignment operator operator= is implicitly declared for a class if not declared by the 
18082: user (12.8), a base class assignment operator is always hidden by the copy assignment operator of the 
18083: derived class. 
18084: 2 Any assignment operator, even the copy assignment operator, can be virtual. [ Note: for a derived class D 
18085: with a base class B for which a virtual copy assignment has been declared, the copy assignment operator in 
18086: D does not override B＊s virtual copy assignment operator. [ Example: 
18087: struct B {
18088: virtual int operator= (int);
18089: virtual B& operator= (const B&);
18090: }; 
18091: struct D : B {
18092: virtual int operator= (int);
18093: virtual D& operator= (const B&);
18094: }; 
18095: D dobj1;
18096: D dobj2;
18097: B* bptr = &dobj1;
18098: void f() {
18099: bptr->operator=(99); // calls D::operator=(int)
18100: *bptr = 99; // ditto
18101: bptr->operator=(dobj2); // calls D::operator=(const B&)
18102: *bptr = dobj2; // ditto
18103: dobj1 = dobj2; // calls implicitly-declared
18104: // D::operator=(const D&)
18105: }
18106: ∫ 13.5.3 300 
18107: 
18108: c
18109: . ISO/IEC N2800=08-0310 
18110: 〞end example ] 〞end note ] 
18111: 13.5.4 Function call [over.call] 
18112: 1 If declared in a class type, operator() shall be a non-static member function with an arbitrary number of 
18113: parameters. It can have default arguments. It implements the function call syntax 
18114: postfix-expression ( expression-listopt ) 
18115: where the postfix-expression evaluates to a class object and the possibly empty expression-list matches the 
18116: parameter list of an operator() member function of the class. Thus, a call x(arg1,...) is interpreted as 
18117: x.operator()(arg1, ...) for a class object x of type T if T::operator()(T1, T2, T3) exists and if the 
18118: operator is selected as the best match function by the overload resolution mechanism (13.3.3). 
18119: 2 If declared in a concept or concept map, operator() shall be a non-member associated function with one 
18120: or more parameters. It implements the function call syntax 
18121: postfix-expression ( expression-listopt ) 
18122: where the postfix-expression evaluates to an object and the possibly empty expression-list matches the 
18123: parameter list of the operator() associated function after the first parameter of the parameter list has been 
18124: removed. Thus, a call x(arg1,...) is interpreted as operator()(x, arg1, ...) for an object x of type 
18125: T if operator()(T, T1, T2, T3) exists and if the operator is selected as the best match function by the 
18126: overload resolution mechanism (13.3.3). 
18127: 13.5.5 Subscripting [over.sub] 
18128: 1 If declared in a class type, operator[] shall be a non-static member function with exactly one parameter. 
18129: It implements the subscripting syntax 
18130: postfix-expression [ expression ] 
18131: Thus, a subscripting expression x[y] is interpreted as x.operator[](y) for a class object x of type T 
18132: if T::operator[](T1) exists and if the operator is selected as the best match function by the overload 
18133: resolution mechanism (13.3.3). 
18134: 2 If declared in a concept or concept map, operator[] shall be a non-member associated function with exactly 
18135: two parameters. It implements the subscripting syntax 
18136: postfix-expression [ expression ] 
18137: Thus, a subscripting expression x[y] is interpreted as operator[](x, y) for an object x of type T if oper-
18138: ator[](T, T1) exists and if the operator is selected as the best match function by the overload resolution 
18139: mechanism (13.3.3). 
18140: 13.5.6 Class member access [over.ref] 
18141: 1 If declared in a class type, operator-> shall be a non-static member function taking no parameters. It 
18142: implements the class member access syntax that uses ->. 
18143: postfix-expression -> templateopt id-expression
18144: postfix-expression -> pseudo-destructor-name
18145: An expression x->m is interpreted as (x.operator->())->m for a class object x of type T if T::operator->() 
18146: exists and if the operator is selected as the best match function by the overload resolution mechanism (13.3). 
18147: 2 If declared in a concept or concept map, operator-> shall be a non-member associated function taking 
18148: exactly one parameter. It implements class member access using -> 
18149: postfix-expression -> id-expression 
18150: ∫ 13.5.6 301 
18151: 
18152: c
18153: . ISO/IEC N2800=08-0310 
18154: An expression x->m is interpreted as (operator->(x))->m for an object x of type T if operator->(T) exists 
18155: and if the operator is selected as the best match function by the overload resolution mechanism (13.3). 
18156: 13.5.7 Increment and decrement [over.inc] 
18157: 1 The user-defined function called operator++ implements the prefix and postfix ++ operator. If this function is 
18158: a member function with no parameters, or a non-member function with one parameter of class or enumeration 
18159: type, it defines the prefix increment operator ++ for objects of that type. If the function is a member function 
18160: with one parameter (which shall be of type int) or a non-member function with two parameters (the second 
18161: of which shall be of type int), it defines the postfix increment operator ++ for objects of that type. When 
18162: the postfix increment is called as a result of using the ++ operator, the int argument will have value zero.128 
18163: [ Example: 
18164: struct X {
18165: X& operator++(); // prefix ++a
18166: X operator++(int); // postfix a++
18167: }; 
18168: struct Y { };
18169: Y& operator++(Y&); // prefix ++b
18170: Y operator++(Y&, int); // postfix b++
18171: void f(X a, Y b) {
18172: ++a;
18173: a++;
18174: ++b;
18175: b++;
18176: // a.operator++(); 
18177: // a.operator++(0); 
18178: // operator++(b); 
18179: // operator++(b, 0); 
18180: a.operator++();
18181: a.operator++(0);
18182: operator++(b);
18183: operator++(b, 0);
18184: } 
18185: // explicit call: like ++a; 
18186: // explicit call: like a++; 
18187: // explicit call: like ++b; 
18188: // explicit call: like b++; 
18189: 〞end example ] 
18190: 2 The prefix and postfix decrement operators --are handled analogously. 
18191: 13.5.8 User-defined literals [over.literal] 
18192: literal-operator-id:
18193: operator "" identifier
18194: 1 The identifier in a literal-operator-id is called a literal suffix identifier. 
18195: 2 A declaration whose declarator-id is a literal-operator-id shall be a declaration of a namespace-scope function 
18196: or function template (it could be a friend function (11.4)), an explicit instantiation or specialization of a 
18197: function template, or a using-declaration (7.3.3). A function declared with a literal-operator-id is a literal 
18198: operator. A function template declared with a literal-operator-id is a literal operator template. 
18199: 3 The declaration of a literal operator shall have a parameter-declaration-clause equivalent to one of the 
18200: following: 
18201: const char*
18202: unsigned long long int
18203: 128) Calling operator++ explicitly, as in expressions like a.operator++(2), has no special properties: The argument to oper-
18204: ator++ is 2. 
18205: ∫ 13.5.8 302 
18206: 
18207: c
18208: . ISO/IEC N2800=08-0310 
18209: long double
18210: const char*, std::size_t
18211: const wchar_t*, std::size_t
18212: const char16_t*, std::size_t
18213: const char32_t*, std::size_t
18214: 4 A raw literal operator is a literal operator with a single parameter whose type is const char*. 
18215: 5 The declaration of a literal operator template shal have an empty parameter-declaration-clause and its 
18216: template-parameter-list shall have a single template-parameter that is a non-type template parameter pack 
18217: with element type char. 
18218: 6 Literal operators and literal operator templates shall not have C language linkage. 
18219: 7 [ Note: literal operators and literal operator templates are usually invoked implicitly through user-defined 
18220: literals (2.13.7). However, except for the constraints described above, they are ordinary namespace-scope 
18221: functions and function templates. In particular, they are looked up like ordinary functions and function tem-
18222: plates and they follow the same overload resolution rules. Also, they can be declared inline or constexpr, 
18223: they may have internal or external linkage, they can be called explicitly, their addresses can be taken, etc. 
18224: 〞end note ] 
18225: 8 [ Example: 
18226: void operator "" _km(long double); // OK
18227: string operator "" _i18n(const char*, std::size_t); // OK
18228: template <char...> int operator "" \u03C0();
18229: float operator ""E(const char*);
18230: float operator " " B(const char*);
18231: string operator "" 5X(const char*, std::size_t);
18232: double operator _miles(double);
18233: template <char...> int operator "" j(const char*);
18234: 〞end example ] 
18235: 13.6 Built-in operators 
18236: // OK: UCN for lowercase pi 
18237: // error: ""E (with no intervening space) 
18238: // is a single token 
18239: // error: non-adjacent quotes 
18240: // error: invalid lteral suffix identifier 
18241: // error: invalid parameter-declaration-clause 
18242: // error: invalid parameter-declaration-clause 
18243: [over.built] 
18244: 1 The candidate operator functions that represent the built-in operators defined in Clause 5 are specified in 
18245: this subclause. These candidate functions participate in the operator overload resolution process as described 
18246: in 13.3.1.2 and are used for no other purpose. Built-in operators are not defined for archetypes (14.10.2), 
18247: except as noted, even though template requirements naming compiler-supported concepts (14.9.4) can clas-
18248: sify archetypes as non-class types. [ Note: because built-in operators take only operands with non-class 
18249: type, and operator overload resolution occurs only when an operand expression originally has class or enu-
18250: meration type, operator overload resolution can resolve to a built-in operator only when an operand has a 
18251: class type that has a user-defined conversion to a non-class type appropriate for the operator, or when an 
18252: operand has an enumeration type that can be converted to a type appropriate for the operator. Also note 
18253: that some of the candidate operator functions given in this subclause are more permissive than the built-in 
18254: operators themselves. As described in 13.3.1.2, after a built-in operator is selected by overload resolution 
18255: the expression is subject to the requirements for the built-in operator given in Clause 5, and therefore to 
18256: any additional semantic constraints given there. If there is a user-written candidate with the same name 
18257: and parameter types as a built-in candidate operator function, the built-in operator function is hidden and 
18258: is not included in the set of candidate functions. 〞end note ] 
18259: 2 In this subclause, the term promoted integral type is used to refer to those integral types which are preserved 
18260: by integral promotion (including e.g. int and long but excluding e.g. char). Similarly, the term promoted 
18261: ∫ 13.6 303 
18262: 
18263: c
18264: . ISO/IEC N2800=08-0310 
18265: arithmetic type refers to floating types plus promoted integral types. [ Note: in all cases where a promoted 
18266: integral type or promoted arithmetic type is required, an operand of enumeration type will be acceptable 
18267: by way of the integral promotions. 〞end note ] 
18268: 3 For every pair (T, VQ), where T is an arithmetic type, and VQ is either volatile or empty, there exist 
18269: candidate operator functions of the form 
18270: VQ T & operator++(VQ T &);
18271: T operator++(VQ T &, int);
18272: 4 For every pair (T, VQ), where T is an arithmetic type other than bool, and VQ is either volatile or empty, 
18273: there exist candidate operator functions of the form 
18274: VQ T & operator--(VQ T &);
18275: T operator--(VQ T &, int);
18276: 5 For every pair (T, VQ), where T is a cv-qualified or cv-unqualified object type, and VQ is either volatile 
18277: or empty, there exist candidate operator functions of the form 
18278: T *VQ & operator++(T *VQ &);
18279: T *VQ & operator--(T *VQ &);
18280: T * operator++(T *VQ &, int);
18281: T * operator--(T *VQ &, int);
18282: 6 For every cv-qualified or cv-unqualified effective object type T, there exist candidate operator functions of 
18283: the form 
18284: T & operator*(T *); 
18285: 7 For every function type T, there exist candidate operator functions of the form 
18286: T & operator*(T *); 
18287: 8 For every type T, including archetypes for which the template requirements contain std::PointeeType<T>, 
18288: there exist candidate operator functions of the form 
18289: T * operator+(T *); 
18290: 9 For every promoted arithmetic type T, there exist candidate operator functions of the form 
18291: T operator+(T );
18292: T operator-(T );
18293: 10 For every promoted integral type T, there exist candidate operator functions of the form 
18294: T operator(T ); 
18295: 11 For every quintuple (C1, C2, T, CV1, CV2), where C2 is a class type, C1 is the same type as C2 or is a 
18296: derived class of C2, T is an effective object type or a function type, and CV1 and CV2 are cv-qualifier-seqs, 
18297: there exist candidate operator functions of the form 
18298: CV12 T & operator->*(CV1 C1*, CV2 T C2 ::*); 
18299: where CV12 is the union of CV1 and CV2. 
18300: 12 For every pair of promoted arithmetic types L and R, there exist candidate operator functions of the form 
18301: ∫ 13.6 304 
18302: 
18303: c
18304: . ISO/IEC N2800=08-0310 
18305: LR operator*(L, R);
18306: LR operator/(L, R);
18307: LR operator+(L, R);
18308: LR operator-(L, R);
18309: bool operator<(L, R);
18310: bool operator>(L, R);
18311: bool operator<=(L, R);
18312: bool operator>=(L, R);
18313: bool operator==(L, R);
18314: bool operator!=(L, R);
18315: where LR is the result of the usual arithmetic conversions between types L and R. 
18316: 13 For every cv-qualified or cv-unqualified effective object type T there exist candidate operator functions of 
18317: the form 
18318: T * operator+(T *, std::ptrdiff_t);
18319: T & operator[](T *, std::ptrdiff_t);
18320: T * operator-(T *, std::ptrdiff_t);
18321: T * operator+(std::ptrdiff_t, T *);
18322: T & operator[](std::ptrdiff_t, T *);
18323: 14 For every T, where T is a pointer to effective object type, there exist candidate operator functions of the 
18324: form 
18325: std::ptrdiff_t operator-(T , T ); 
18326: 15 For every T, where T is an enumeration type or pointer to effective object type, there exist candidate 
18327: operator functions of the form 
18328: bool operator<(T , T );
18329: bool operator>(T , T );
18330: bool operator<=(T , T );
18331: bool operator>=(T , T );
18332: bool operator==(T , T );
18333: bool operator!=(T , T );
18334: 16 For every pointer to member type T, including pointer to member types involving archetypes, there exist 
18335: candidate operator functions of the form 
18336: bool operator==(T , T );
18337: bool operator!=(T , T );
18338: 17 For every pair of promoted integral types L and R, there exist candidate operator functions of the form 
18339: LR operator%(L, R);
18340: LR operator&(L, R);
18341: LR operator^(L, R);
18342: LR operator|(L, R);
18343: L operator<<(L, R);
18344: L operator>>(L, R);
18345: where LR is the result of the usual arithmetic conversions between types L and R. 
18346: 18 For every triple (L, VQ, R), where L is an arithmetic type, VQ is either volatile or empty, and R is a 
18347: promoted arithmetic type, there exist candidate operator functions of the form 
18348: ∫ 13.6 305 
18349: 
18350: c
18351: . ISO/IEC N2800=08-0310 
18352: VQ L& operator=(VQ L&, R);
18353: VQ L& operator*=(VQ L&, R);
18354: VQ L& operator/=(VQ L&, R);
18355: VQ L& operator+=(VQ L&, R);
18356: VQ L& operator-=(VQ L&, R);
18357: 19 For every pair (T, VQ), where T is any type, including archetypes for which the template requirements 
18358: contain std::PointeeType<T>, and VQ is either volatile or empty, there exist candidate operator functions 
18359: of the form 
18360: T *VQ & operator=(T *VQ &, T *); 
18361: 20 For every pair (T, VQ), where T is an enumeration or pointer to member type, including pointer to member 
18362: types that involve archetypes, and VQ is either volatile or empty, there exist candidate operator functions 
18363: of the form 
18364: VQ T & operator=(VQ T &, T ); 
18365: 21 For every pair (T, VQ), where T is a cv-qualified or cv-unqualified effective object type and VQ is either 
18366: volatile or empty, there exist candidate operator functions of the form 
18367: T *VQ & operator+=(T *VQ &, std::ptrdiff_t);
18368: T *VQ & operator-=(T *VQ &, std::ptrdiff_t);
18369: 22 For every triple (L, VQ, R), where L is an integral type, VQ is either volatile or empty, and R is a 
18370: promoted integral type, there exist candidate operator functions of the form 
18371: VQ L& operator%=(VQ L&, R);
18372: VQ L& operator<<=(VQ L&, R);
18373: VQ L& operator>>=(VQ L&, R);
18374: VQ L& operator&=(VQ L&, R);
18375: VQ L& operator^=(VQ L&, R);
18376: VQ L& operator|=(VQ L&, R);
18377: 23 There also exist candidate operator functions of the form 
18378: bool operator!(bool);
18379: bool operator&&(bool, bool);
18380: bool operator||(bool, bool);
18381: 24 For every pair of promoted arithmetic types L and R, there exist candidate operator functions of the form 
18382: LR operator?(bool, L, R); 
18383: where LR is the result of the usual arithmetic conversions between types L and R.[ Note: as with all these 
18384: descriptions of candidate functions, this declaration serves only to describe the built-in operator for purposes 
18385: of overload resolution. The operator ※?§ cannot be overloaded. 〞end note ] 
18386: 25 For every type T, where T is a pointer or pointer-to-member type, including pointer and pointer-to-member 
18387: types that involve archetypes, there exist candidate operator functions of the form 
18388: T operator?(bool, T , T ); 
18389: ∫ 13.6 306 
18390: 
18391: c
18392: . ISO/IEC N2800=08-0310 
18393: 14 Templates [temp]
18394: 1 A template defines a family of classes, functions, or concept maps, or an alias for a family of types. 
18395: template-declaration:
18396: exportopt template < template-parameter-list > declaration
18397: template-parameter-list:
18398: template-parameter
18399: template-parameter-list , template-parameter
18400: [ Note: The > token following the template-parameter-list of a template-declaration may be the product of 
18401: replacing a >> token by two consecutive > tokens (14.2). 〞end note ] 
18402: The declaration in a template-declaration shall 
18403: 〞 declare or define a function or a class, or 
18404: 〞 define a member function, a member class or a static data member of a class template or of a class 
18405: nested within a class template, or 
18406: 〞 define a member template of a class or class template, or 
18407: 〞 be an alias-declaration, or 
18408: 〞 define a concept map. 
18409: A template-declaration is a declaration. A template-declaration is also a definition if its declaration defines 
18410: a function, a class, a concept map, or a static data member. 
18411: 2 A template-declaration can appear only as a namespace scope or class scope declaration. In a function 
18412: template declaration, the last component of the declarator-id shall be a template-name or operator-function-
18413: id (i.e., not a template-id). [ Note: in a class template declaration, if the class name is a simple-template-id, 
18414: the declaration declares a class template partial specialization (14.5.5). 〞 end note ] 
18415: 3 In a template-declaration, explicit specialization, or explicit instantiation the init-declarator-list in the dec-
18416: laration shall contain at most one declarator. When such a declaration is used to declare a class template, 
18417: no declarator is permitted. 
18418: 4 A template name has linkage (3.5). A non-member function template can have internal linkage; any other 
18419: template name shall have external linkage. Entities generated from a template with internal linkage are 
18420: distinct from all entities generated in other translation units. A template, a template explicit specializa-
18421: tion (14.7.3), and a class template partial specialization shall not have C linkage. Use of a linkage specification 
18422: other than C or C++ with any of these constructs is conditionally-supported, with implementation-defined 
18423: semantics. Template definitions shall obey the one definition rule (3.2). [ Note: default arguments for func-
18424: tion templates and for member functions of class templates are considered definitions for the purpose of 
18425: template instantiation (14.5) and must also obey the one definition rule. 〞end note ] 
18426: 5 A class template shall not have the same name as any other template, class, concept, function, object, 
18427: enumeration, enumerator, namespace, or type in the same scope (3.3), except as specified in (14.5.5). Except 
18428: that a function template can be overloaded either by (non-template) functions with the same name or by 
18429: other function templates with the same name (14.8.3), a template name declared in namespace scope or in 
18430: class scope shall be unique in that scope. 
18431: 307 
18432: 
18433: c
18434: . ISO/IEC N2800=08-0310 
18435: 6 A template-declaration may be preceded by the export keyword. Such a template is said to be exported. 
18436: Declaring exported a class templateis equivalent to declaring exported all of its non-inline member functions, 
18437: static data members, member classes, member class templates, and non-inline member function templates. 
18438: 7 If a template is exported in one translation unit, it shall be exported in all translation units in which it 
18439: appears; no diagnostic is required. A declaration of an exported template shall appear with the export 
18440: keyword before any point of instantiation (14.6.4.1) of that template in that translation unit. In addition, 
18441: the first declaration of an exported template containing the export keyword shall not follow the definition 
18442: of that template. The export keyword shall not be used in a friend declaration. 
18443: 8 Templates defined in an unnamed namespace, inline functions, and inline function templates shall not be 
18444: exported. An exported non-class template shall be defined only once in a program; no diagnostic is required. 
18445: An exported non-class template need only be declared (and not necessarily defined) in a translation unit in 
18446: which it is instantiated. 
18447: 9 A non-exported non-class template shall be defined in every translation unit in which it is implicitly instan-
18448: tiated (14.7.1), unless the corresponding specialization is explicitly instantiated (14.7.2) in some translation 
18449: unit; no diagnostic is required. 
18450: 10 [ Note: an implementation may require that a translation unit containing the definition of an exported 
18451: template be compiled before any translation unit containing an instantiation of that template. 〞end note ] 
18452: 11 A template-declaration that declares a template alias (14.5.7) shall not be exported. 
18453: 12 A template-declaration with a requires keyword is a constrained template (14.10). The requires-clause 
18454: specifies template requirements (14.10.1). 
18455: 14.1 Template parameters [temp.param] 
18456: 1 The syntax for template-parameters is: 
18457: template-parameter:
18458: type-parameter
18459: parameter-declaration
18460: constrained-template-parameter
18461: type-parameter:
18462: class ...opt identifieropt
18463: class identifieropt = type-id
18464: typename ...opt identifieropt
18465: typename identifieropt = type-id
18466: template < template-parameter-list > class ...opt identifieropt
18467: template < template-parameter-list > class identifieropt = id-expression
18468: constrained-template-parameter: 
18469: ::opt nested-name-specifieropt concept-name ...opt identifieropt 
18470: ::opt nested-name-specifieropt concept-name identifieropt constrained-default-argumentopt 
18471: ::opt nested-name-specifieropt concept-name < 
18472: simple-requirement-argument-list > ...opt identifier 
18473: ::opt nested-name-specifieropt concept-name < 
18474: simple-requirement-argument-list > identifier constrained-default-argumentopt 
18475: constrained-default-argument:
18476: = type-id
18477: = assignment-expression
18478: = id-expression
18479: ∫ 14.1 308 
18480: 
18481: c
18482: . ISO/IEC N2800=08-0310 
18483: simple-requirement-argument-list: 
18484: auto
18485: auto , template-argument-list
18486: [ Note: The > token following the template-parameter-list of a type-parameter may be the product of replacing 
18487: a >> token by two consecutive > tokens (14.2). 〞end note ] 
18488: 2 There is no semantic difference between class and typename in a template-parameter. typename followed 
18489: by an unqualified-id names a template type parameter. typename followed by a qualified-id denotes the 
18490: type in a non-type 129 parameter-declaration. A storage class shall not be specified in a template-parameter 
18491: declaration. [ Note: a template parameter may be a class template. For example, 
18492: template<class T> class myarray { /. ...  / }; 
18493: template<class K, class V, template<class T> class C = myarray> 
18494: class Map {
18495: C<K> key;
18496: C<V> value;
18497: }; 
18498: 〞end note ] 
18499: 3 A type-parameter whose identifier does not follow an ellipsis defines its identifier to be a typedef-name (if 
18500: declared with class or typename) or template-name (if declared with template) in the scope of the template 
18501: declaration. [ Note: because of the name lookup rules, a template-parameter that could be interpreted as 
18502: either a non-type template-parameter or a type-parameter (because its identifier is the name of an already 
18503: existing class) is taken as a type-parameter. For example, 
18504: class T { /. ...  / };
18505: int i;
18506: template<class T, T i> void f(T t) {
18507: T t1 = i; // template-parameters T and i
18508: ::T t2 = ::i; // global namespace members T and i
18509: } 
18510: Here, the template f has a type-parameter called T, rather than an unnamed non-type template-parameter 
18511: of class T. 〞end note ] 
18512: 4 A non-type template-parameter shall have one of the following (optionally cv-qualified) types: 
18513: 〞 integral or enumeration type, 
18514: 〞 pointer to object or pointer to function, 
18515: 〞 reference to object or reference to function, 
18516: 〞 pointer to member, or 
18517: 〞 in a constrained template (14.10), a type archetype T for which the concept requirement std:: 
18518: NonTypeTemplateParameterType<T> (14.9.4) is part of the template＊s requirements. 
18519: 5 [ Note: other types are disallowed either explicitly below or implicitly by the rules governing the form of 
18520: template-arguments (14.3). 〞end note ] The top-level cv-qualifiers on the template-parameter are ignored 
18521: when determining its type. 
18522: 129) Since template template-parameters and template template-arguments are treated as types for descriptive purposes, the 
18523: terms non-type parameter and non-type argument are used to refer to non-type, non-template parameters and arguments. 
18524: ∫ 14.1 309 
18525: 
18526: c
18527: . ISO/IEC N2800=08-0310 
18528: 6 A non-type non-reference template-parameter is not an lvalue. It shall not be assigned to or in any other 
18529: way have its value changed. A non-type non-reference template-parameter cannot have its address taken. 
18530: When a non-type non-reference template-parameter is used as an initializer for a reference, a temporary is 
18531: always used. [ Example: 
18532: template<const X& x, int i> void f() {
18533: i++; // error: change of template-parameter value
18534: &x; // OK
18535: &i; // error: address of non-reference template-parameter
18536: int& ri = i; // error: non-const reference bound to temporary
18537: const int& cri = i; // OK: const reference bound to temporary
18538: }
18539: 〞end example ] 
18540: 7 A non-type template-parameter shall not be declared to have floating point, class, or void type. [ Example: 
18541: template<double d> class X; // error
18542: template<double* pd> class Y; // OK
18543: template<double& rd> class Z; // OK
18544: 〞end example ] 
18545: 8 A non-type template-parameter of type ※array of T§ or ※function returning T§ is adjusted to be of type 
18546: ※pointer to T§ or ※pointer to function returning T§, respectively. [ Example: 
18547: template<int *a> struct R { /. ...  / };
18548: template<int b[5]> struct S { /. ...  / };
18549: int p;
18550: R<&p> w; // OK
18551: S<&p> x; // OK due to parameter adjustment
18552: int v[5];
18553: R<v> y; // OK due to implicit argument conversion
18554: S<v> z; // OK due to both adjustment and conversion
18555: 〞end example ] 
18556: 9 A default template-argument is a template-argument (14.3) specified after = in a template-parameter.A 
18557: default template-argument may be specified for any kind of template-parameter (type, non-type, template) 
18558: that is not a template parameter pack. A default template-argument may be specified in a template declara-
18559: tion. A default template-argument shall not be specified in the template-parameter-lists of the definition of 
18560: a member of a class template that appears outside of the member＊s class. A default template-argument shall 
18561: not be specified in a friend class template declaration. If a friend function template declaration specifies a 
18562: default template-argument, that declaration shall be a definition and shall be the only declaration of the 
18563: function template in the translation unit. 
18564: 10 The set of default template-arguments available for use with a template declaration or definition is obtained 
18565: by merging the default arguments from the definition (if in scope) and all declarations in scope in the same 
18566: way default function arguments are (8.3.6). [ Example: 
18567: template<class T1, class T2 = int> class A;
18568: template<class T1 = int, class T2> class A;
18569: is equivalent to 
18570: ∫ 14.1 310 
18571: 
18572: c
18573: . ISO/IEC N2800=08-0310 
18574: template<class T1 = int, class T2 = int> class A; 
18575: 〞end example ] 
18576: 11 If a template-parameter of a class template has a default template-argument, each subsequent template-
18577: parameter shall either have a default template-argument supplied or be a template parameter pack. If 
18578: a template-parameter of a class template is a template parameter pack, it shall be the last template-
18579: parameter.[ Note: These are not requirements for function templates because template arguments might be 
18580: deduced (14.8.2). [ Example: 
18581: template<class T1 = int, class T2> class B; // error 
18582: 〞end example ] 〞end note ] 
18583: 12 A template-parameter shall not be given default arguments by two different declarations in the same scope. 
18584: [ Example: 
18585: template<class T = int> class X;
18586: template<class T = int> class X { / ...  / }; // error
18587: 〞end example ] 
18588: 13 The scope of a template-parameter extends from its point of declaration until the end of its template. In 
18589: particular, a template-parameter can be used in the declaration of subsequent template-parameters and their 
18590: default arguments. [ Example: 
18591: template<class T, T* p, class U = T> class X { /. ...  / };
18592: template<class T> void f(T* p = new T);
18593: 〞end example ] 
18594: 14 A template-parameter shall not be used in its own default argument. 
18595: 15 When parsing a default template-argument for a non-type template-parameter, the first non-nested > is taken 
18596: as the end of the template-parameter-list rather than a greater-than operator. [ Example: 
18597: template<int i = 3 > 4 > // syntax error
18598: class X { /. ...  / };
18599: template<int i = (3 > 4) > // OK
18600: class Y { /. ...  / };
18601: 〞end example ] 
18602: 16 A template-parameter of a template template-parameter is permitted to have a default template-argument. 
18603: When such default arguments are specified, they apply to the template template-parameter in the scope of 
18604: the template template-parameter.[ Example: 
18605: template <class T = float> struct B {}; 
18606: template <template <class TT = float> class T> struct A {
18607: inline void f();
18608: inline void g();
18609: };
18610: template <template <class TT> class T> void A<T>::f() {
18611: T<> t; // error -TT has no default template argument
18612: }
18613: template <template <class TT = char> class T> void A<T>::g() {
18614: T<> t; // OK -T<char>
18615: }
18616: ∫ 14.1 311 
18617: 
18618: c
18619: . ISO/IEC N2800=08-0310 
18620: 〞end example ] 
18621: 17 If a template-parameter is a type-parameter with an ellipsis prior to its optional identifier or is a parameter-
18622: declaration that declares a parameter pack (8.3.5), then the template-parameter is a template parameter 
18623: pack (14.5.3). [ Example: 
18624: template <class... Types> class Tuple; // Types is a template type parameter pack 
18625: template <class T, int... Dims> struct multi_array; // Dims is a non-type template parameter pack 
18626: 〞end example ] 
18627: 18 A template-parameter declared with a concept-name is a template type, non-type or template parameter or 
18628: parameter pack that specifies a template requirement (14.10.1) using the simple form of template require-
18629: ments. The kind (type, non-type or template) of the parameter is that of the first template parameter of 
18630: the concept named in the constrained-template-parameter. For a non-type parameter, the type is that of 
18631: the first template parameter of the concept named in the constrained-template-parameter. For a template 
18632: parameter, the template parameter list is that of the first template parameter of the concept named in 
18633: the constrained-template-parameter. A template parameter or parameter pack written ::opt nested-name-
18634: specifieropt C ...opt T, where C is a concept-name, is equivalent to a template parameter or parameter pack 
18635: T declared as a type-parameter or parameter-declaration with the template requirement or pack expansion 
18636: ::opt nested-name-specifieropt C<T> ...opt added to the template requirements. A template parameter 
18637: or parameter pack written ::opt nested-name-specifieropt C<auto, T2, T3, ..., TN >...opt T, is equiv-
18638: alent to a template parameter or parameter pack T declared as a type-parameter or parameter-declaration 
18639: with the template requirement ::opt nested-name-specifieropt C<T, T2, T3, ..., TN >...opt added to the 
18640: template requirements. 
18641: concept C<typename T> { ... }
18642: concept D<typename T, typename U> { ... }
18643: concept E<typename T, typename U, typename V = U> { ... }
18644: template<C T, D<auto, T> P> void f(T, P); 
18645: // equivalent to 
18646: template<class T, class P> requires C<T> && D<P, T> void f(T, P); 
18647: template<C T, E<auto, T> P> void f(T, P); 
18648: // equivalent to 
18649: template<class T, class P> requires C<T> && E<P, T, T> void f(T, P); 
18650: 〞end example ] 
18651: When the type-parameter is a template type parameter pack, the equivalent requirement is a pack expansion 
18652: (14.5.3). [ Example: 
18653: concept C<typename T> { } 
18654: template<C... Args> void g(Args const&...); 
18655: // equivalent to 
18656: template<typename... Args> requires C<Args>... void g(Args const&...); 
18657: 〞end example ] 
18658: 14.2 Names of template specializations [temp.names] 
18659: 1 A template specialization (14.7) can be referred to by a template-id: 
18660: ∫ 14.2 312 
18661: 
18662: c
18663: . ISO/IEC N2800=08-0310 
18664: simple-template-id:
18665: template-name < template-argument-listopt >
18666: template-id:
18667: simple-template-id
18668: operator-function-id < template-argument-listopt >
18669: template-name:
18670: identifier
18671: template-argument-list:
18672: template-argument ...opt
18673: template-argument-list , template-argument ...opt
18674: template-argument:
18675: constant-expression
18676: type-id
18677: id-expression
18678: [ Note: the name lookup rules (3.4) are used to associate the use of a name with a template declaration; that 
18679: is, to identify a name as a template-name. 〞end note ] 
18680: 2 For a template-name to be explicitly qualified by the template arguments, the name must be known to refer 
18681: to a template. 
18682: 3 After name lookup (3.4) finds that a name is a template-name, or that an operator-function-id refers to a 
18683: set of overloaded functions any member of which is a function template, if this is followed by a <, the < is 
18684: always taken as the delimiter of a template-argument-list and never as the less-than operator. When parsing 
18685: a template-argument-list, the first non-nested >130 is taken as the ending delimiter rather than a greater-than 
18686: operator. Similarly, the first non-nested >> is treated as two consecutive but distinct > tokens, the first of 
18687: which is taken as the end of the template-argument-list and completes the template-id.[ Note: The second > 
18688: token produced by this replacement rule may terminate an enclosing template-id construct or it may be part 
18689: of a different construct (e.g. a cast). 〞end note ][ Example: 
18690: template<int i> class X { /. ...  / }; 
18691: X< 1>2 > x1; // syntax error
18692: X<(1>2)> x2; // OK
18693: template<class T> class Y { /. ...  / };
18694: Y<X<1>> x3; // OK, same as Y<X<1> > x3;
18695: Y<X<6>>1>> x4; // syntax error
18696: Y<X<(6>>1)>> x5; // OK
18697: 〞end example ] 
18698: 4 When the name of a member template specialization appears after . or -> in a postfix-expression, or after 
18699: a nested-name-specifier in a qualified-id, and the postfix-expression or qualified-id explicitly depends on a 
18700: template-parameter (14.6.2) but does not refer to a member of the current instantiation (14.6.2.1), the 
18701: member template name must be prefixed by the keyword template. Otherwise the name is assumed to 
18702: name a non-template. [ Example: 
18703: struct X {
18704: template<std::size_t> X* alloc();
18705: template<std::size_t> static X* adjust();
18706: }; 
18707: 130) A > that encloses the type-id of a dynamic_cast, static_cast, reinterpret_cast or const_cast, or which encloses the 
18708: template-arguments of a subsequent template-id, is considered nested for the purpose of this description. 
18709: ∫ 14.2 313 
18710: 
18711: c
18712: . ISO/IEC N2800=08-0310 
18713: template<class T> void f(T* p) {
18714: T* p1 = p->alloc<200>(); // ill-formed: < means less than
18715: T* p2 = p->template alloc<200>(); // OK: < starts template argument list
18716: T::adjust<100>(); // ill-formed: < means less than
18717: T::template adjust<100>(); // OK: < starts template argument list
18718: } 
18719: 〞end example ] 
18720: 5 If a name prefixed by the keyword template is not the name of a template, the program is ill-formed. 
18721: [ Note: the keyword template may not be applied to non-template members of class templates. 〞end 
18722: note ][ Note: as is the case with the typename prefix, the template prefix is allowed in cases where it is not 
18723: strictly necessary; i.e., when the nested-name-specifier or the expression on the left of the -> or . is not 
18724: dependent on a template-parameter, or the use does not appear in the scope of a template. 〞end note ] 
18725: 6 A simple-template-id that names a class template specialization is a class-name (Clause 9). 
18726: 7 A template-id that names a template alias specialization is a type-name. 
18727: 14.3 Template arguments [temp.arg] 
18728: 1 There are three forms of template-argument, corresponding to the three forms of template-parameter: type, 
18729: non-type and template. The type and form of each template-argument specified in a template-id shall 
18730: match the type and form specified for the corresponding parameter declared by the template in its template-
18731: parameter-list. When the parameter declared by the template is a template parameter pack, it will corre-
18732: spond to zero or more template-arguments. [ Example: 
18733: template<class T> class Array {
18734: T* v;
18735: int sz;
18736: public:
18737: explicit Array(int);
18738: T& operator[](int);
18739: T& elem(int i) { return v[i]; }
18740: }; 
18741: Array<int> v1(20);
18742: typedef std::complex<double> dcomplex; // std::complex is a standard
18743: // library template
18744: Array<dcomplex> v2(30);
18745: Array<dcomplex> v3(40);
18746: void bar() {
18747: v1[3] = 7;
18748: v2[3] = v3.elem(4) = dcomplex(7,8);
18749: } 
18750: 〞end example ] 
18751: 2 In a template-argument, an ambiguity between a type-id and an expression is resolved to a type-id, regardless 
18752: of the form of the corresponding template-parameter.131 [ Example: 
18753: template<class T> void f();
18754: template<int I> void f();
18755: 131) There is no such ambiguity in a default template-argument because the form of the template-parameter determines the 
18756: allowable forms of the template-argument. 
18757: ∫ 14.3 314 
18758: 
18759: c
18760: . ISO/IEC N2800=08-0310 
18761: void g() {
18762: f<int()>(); // int() is a type-id: call the first f()
18763: }
18764: 〞end example ] 
18765: 3 The name of a template-argument shall be accessible at the point where it is used as a template-argument. 
18766: [ Note: if the name of the template-argument is accessible at the point where it is used as a template-
18767: argument, there is no further access restriction in the resulting instantiation where the corresponding 
18768: template-parameter name is used. 〞end note ][ Example: 
18769: template<class T> class X {
18770: static T t;
18771: };
18772: class Y { 
18773: private:
18774: struct S { /. ...  / };
18775: X<S> x; // OK: S is accessible
18776: // X<Y::S> has a static member of type Y::S
18777: // OK: even though Y::S is private
18778: };
18779: X<Y::S> y; // error: S not accessible 
18780: 〞end example ] For a template-argument that is a class type or a class template, the template definition 
18781: has no special access rights to the members of the template-argument.[ Example: 
18782: template <template <class TT> class T> class A {
18783: typename T<int>::S s;
18784: };
18785: template <class U> class B {
18786: private:
18787: struct S { /. ...  / };
18788: };
18789: A<B> b; // ill-formed: A has no access to B::S 
18790: 〞end example ] 
18791: 4 When template argument packs or default template-arguments are used, a template-argument list can be 
18792: empty. In that case the empty <> brackets shall still be used as the template-argument-list. [ Example: 
18793: template<class T = char> class String;
18794: String<>* p; // OK: String<char>
18795: String* q; // syntax error
18796: template<class ... Elements> class Tuple;
18797: Tuple<>* t; // OK: Elements is empty
18798: Tuple* u; // syntax error
18799: 〞end example ] 
18800: 5 An explicit destructor call (12.4) for an object that has a type that is a class template specialization may 
18801: explicitly specify the template-arguments. [ Example: 
18802: ∫ 14.3 315 
18803: 
18804: c
18805: . ISO/IEC N2800=08-0310 
18806: template<class T> struct A { 
18807: ~A();
18808: };
18809: void f(A<int>* p, A<int>* q) {
18810: p->A<int>::~A(); // OK: destructor call
18811: q->A<int>::~A<int>(); // OK: destructor call
18812: }
18813: 〞end example ] 
18814: 6 If the use of a template-argument gives rise to an ill-formed construct in the instantiation of a template 
18815: specialization, the program is ill-formed. 
18816: 7 When the template in a template-id is an overloaded function template, both non-template functions in the 
18817: overload set and function templates in the overload set for which the template-arguments do not match the 
18818: template-parameters are ignored. If none of the function templates have matching template-parameters, the 
18819: program is ill-formed. 
18820: 8 A template-argument followed by an ellipsis is a pack expansion (14.5.3). 
18821: 14.3.1 Template type arguments [temp.arg.type] 
18822: 1 A template-argument for a template-parameter which is a type shall be a type-id. 
18823: 2 [ Example: 
18824: template <class T> class X { };
18825: template <class T> void f(T t) { }
18826: struct { } unnamed_obj;
18827: void f() {
18828: struct A { };
18829: enum { e1 };
18830: typedef struct { } B;
18831: B b;
18832: X<A> x1; // OK
18833: X<A*> x2; // OK
18834: X<B> x3; // OK
18835: f(e1); // OK
18836: f(unnamed_obj); // OK
18837: f(b); // OK
18838: } 
18839: 〞end example ][ Note: a template type argument may be an incomplete type (3.9). 〞end note ] 
18840: 3 If a declaration acquires a function type through a type dependent on a template-parameter and this causes a 
18841: declaration that does not use the syntactic form of a function declarator to have function type, the program 
18842: is ill-formed. [ Example: 
18843: template<class T> struct A { 
18844: static T t;
18845: };
18846: typedef int function();
18847: A<function> a; // ill-formed: would declare A<function>::t
18848: // as a static member function 
18849: 〞end example ] 
18850: ∫ 14.3.1 316 
18851: 
18852: c
18853: . ISO/IEC N2800=08-0310 
18854: 4 If a template-argument for a template-parameter T names a type that is a reference to a type A, an attempt 
18855: to create the type ※lvalue reference to cv T§ creates the type ※lvalue reference to A,§ while an attempt to 
18856: create the type ※rvalue reference to cv T§ creates the type T [ Example: 
18857: template <class T> class X {
18858: void f(const T&);
18859: void g(T&&);
18860: };
18861: X<int&> x1; // X<int&>::f has the parameter type int&
18862: // X<int&>::g has the parameter type int&
18863: X<const int&&> x2; // X<const int&&>::f has the parameter type const int&
18864: // X<const int&&>::g has the parameter type const int&&
18865: 〞end example ] 
18866: 14.3.2 Template non-type arguments [temp.arg.nontype] 
18867: 1 A template-argument for a non-type, non-template template-parameter shall be one of: 
18868: 〞 an integral constant expression; or 
18869: 〞 the name of a non-type template-parameter; or 
18870: 〞 the address of an object or function with external linkage, including function templates and function 
18871: template-ids but excluding non-static class members, expressed as & id-expression where the & is 
18872: optional if the name refers to a function or array, or if the corresponding template-parameter is a 
18873: reference; or 
18874: 〞 a constant expression that evaluates to a null pointer value (4.10); or 
18875: 〞 a constant expression that evaluates to a null member pointer value (4.11); or 
18876: 〞 a pointer to member expressed as described in 5.3.1. 
18877: 2 [ Note: A string literal (2.13.4) does not satisfy the requirements of any of these categories and thus is not 
18878: an acceptable template-argument.[ Example: 
18879: template<class T, char* p> class X {
18880: X();
18881: X(const char* q) { /. ...  / }
18882: }; 
18883: X<int, "Studebaker"> x1; // error: string literal as template-argument 
18884: char p[] = "Vivisectionist";
18885: X<int,p> x2; // OK
18886: 〞end example ] 〞end note ] 
18887: 3 [ Note: Addresses of array elements and names or addresses of non-static class members are not acceptable 
18888: template-arguments. [ Example: 
18889: template<int* p> class X { }; 
18890: int a[10];
18891: struct S { int m; static int s; } s;
18892: X<&a[2]> x3; // error: address of array element
18893: X<&s.m> x4; // error: address of non-static member
18894: ∫ 14.3.2 317 
18895: 
18896: c
18897: . ISO/IEC N2800=08-0310 
18898: X<&s.s> x5; // error: &S::s must be used
18899: X<&S::s> x6; // OK: address of static member
18900: 〞end example ] 〞end note ] 
18901: 4 [ Note: Temporaries, unnamed lvalues, and named lvalues that do not have external linkage are not accept-
18902: able template-arguments when the corresponding template-parameter has reference type. [ Example: 
18903: template<const int& CRI> struct B { /. ...  / }; 
18904: B<1> b2; // error: temporary would be required for template argument 
18905: int c = 1;
18906: B<c> b1; // OK
18907: 〞end example ] 〞end note ] 
18908: 5 The following conversions are performed on each expression used as a non-type template-argument. If a 
18909: non-type template-argument cannot be converted to the type of the corresponding template-parameter then 
18910: the program is ill-formed. 
18911: 〞 for a non-type template-parameter of integral or enumeration type, integral promotions (4.5) and 
18912: integral conversions (4.7) are applied. 
18913: 〞 for a non-type template-parameter of type pointer to object, qualification conversions (4.4) and the 
18914: array-to-pointer conversion (4.2) are applied; if the template-argument is of type std::nullptr_t, the 
18915: null pointer conversion (4.10) is applied. [ Note: In particular, neither the null pointer conversion for 
18916: a zero-valued integral constant expression (4.10) nor the derived-to-base conversion (4.10) are applied. 
18917: Although 0 is a valid template-argument for a non-type template-parameter of integral type, it is not 
18918: a valid template-argument for a non-type template-parameter of pointer type. However, both (int*)0 
18919: and nullptr are valid template-arguments for a non-type template-parameter of type ※pointer to int.§ 
18920: 〞 end note ] 
18921: 〞 For a non-type template-parameter of type reference to object, no conversions apply. The type referred 
18922: to by the reference may be more cv-qualified than the (otherwise identical) type of the template-
18923: argument. The template-parameter is bound directly to the template-argument, which shall be an 
18924: lvalue. 
18925: 〞 For a non-type template-parameter of type pointer to function, the function-to-pointer conversion (4.3) 
18926: is applied; if the template-argument is of type std::nullptr_t, the null pointer conversion (4.10) is 
18927: applied. If the template-argument represents a set of overloaded functions (or a pointer to such), the 
18928: matching function is selected from the set (13.4). 
18929: 〞 For a non-type template-parameter of type reference to function, no conversions apply. If the template-
18930: argument represents a set of overloaded functions, the matching function is selected from the set (13.4). 
18931: 〞 For a non-type template-parameter of type pointer to member function, if the template-argument is of 
18932: type std::mullptr_t, the null member pointer conversion (4.11) is applied; otherwise, no conversions 
18933: apply. If the template-argument represents a set of overloaded member functions, the matching member 
18934: function is selected from the set (13.4). 
18935: 〞 For a non-type template-parameter of type pointer to data member, qualification conversions (4.4) are 
18936: applied; if the template-argument is of type std::nullptr_t, the null member pointer conversion (4.11) 
18937: is applied. 
18938: [ Example: 
18939: ∫ 14.3.2 318 
18940: 
18941: c
18942: . ISO/IEC N2800=08-0310 
18943: template<const int* pci> struct X { /. ...  / };
18944: int ai[10];
18945: X<ai> xi; // array to pointer and qualification conversions
18946: struct Y { /. ...  / };
18947: template<const Y& b> struct Z { /. ...  / };
18948: Y y;
18949: Z<y> z; // no conversion, but note extra cv-qualification
18950: template<int (&pa)[5]> struct W { /. ...  / };
18951: int b[5];
18952: W<b> w; // no conversion
18953: void f(char);
18954: void f(int);
18955: template<void (*pf)(int)> struct A { /. ...  / }; 
18956: A<&f> a; // selects f(int) 
18957: 〞end example ] 
18958: 14.3.3 Template template arguments [temp.arg.template] 
18959: 1 A template-argument for a template template-parameter shall be the name of a class template or a template 
18960: alias, expressed as id-expression. When the template-argument names a class template, only primary class 
18961: templates are considered when matching the template template argument with the corresponding parameter; 
18962: partial specializations are not considered even if their parameter lists match that of the template template 
18963: parameter. 
18964: 2 Any partial specializations (14.5.5) associated with the primary class template are considered when a spe-
18965: cialization based on the template template-parameter is instantiated. If a specialization is not visible at the 
18966: point of instantiation, and it would have been selected had it been visible, the program is ill-formed; no 
18967: diagnostic is required. [ Example: 
18968: template<class T> class A { // primary template 
18969: int x; 
18970: }; 
18971: template<class T> class A<T*> { // partial specialization 
18972: long x; 
18973: }; 
18974: template<template<class U> class V> class C { 
18975: V<int> y; 
18976: V<int*> z; 
18977: }; 
18978: C<A> c; // V<int> within C<A> uses the primary template, 
18979: // so c.y.x has type int
18980: // V<int*> within C<A> uses the partial specialization,
18981: // so c.z.x has type long
18982: 〞end example ]
18983: [ Example:
18984: template<class T> class A { /. ...  / }; 
18985: ∫ 14.3.3 319 
18986: 
18987: c
18988: . ISO/IEC N2800=08-0310 
18989: template<class T, class U = T> class B { /. ...  / };
18990: template <class ... Types> class C { /. ...  / };
18991: template<template<class> class P> class X { /. ...  / };
18992: template<template<class ...> class Q> class Y { /. ...  / };
18993: X<A> xa; // OK 
18994: X<B> xb; // ill-formed: default arguments for the parameters of a template argument are ignored 
18995: X<C> xc; // ill-formed: a template parameter pack does not match a template parameter 
18996: Y<A> ya; // ill-formed: a template parameter pack does not match a template parameter 
18997: Y<B> yb; // ill-formed: a template parameter pack does not match a template parameter 
18998: Y<C> yc; // OK 
18999: 〞end example ] 
19000: 3 A template-argument matches a template template-parameter (call it P) when each of the template parameters 
19001: in the template-parameter-list of the template-argument＊s corresponding class template or template alias (call 
19002: it A) matches the corresponding template parameter in the template-parameter-list of P. When P＊s template-
19003: parameter-list contains a template parameter pack (14.5.3), the template parameter pack will match zero 
19004: or more template parameters or template parameter packs in the template-parameter-list of A with the 
19005: same type and form as the template parameter pack in P (ignoring whether those template parameters are 
19006: template parameter packs) [ Example: 
19007: template <class T> struct eval; 
19008: template <template <class, class...> class TT, class T1, class... Rest>
19009: struct eval<TT<T1, Rest...>> { };
19010: template <class T1> struct A;
19011: template <class T1, class T2> struct B;
19012: template <int N> struct C;
19013: template <class T1, int N> struct D;
19014: template <class T1, class T2, int N = 17> struct E;
19015: eval<A<int>> eA; // OK: matches partial specialization of eval
19016: eval<B<int, float>> eB; // OK: matches partial specialization of eval
19017: eval<C<17>> eC; // error: C does not match TT in partial specialization
19018: eval<D<int, 17>> eD; // error: D does not match TT in partial specialization
19019: eval<E<int, float>> eE; // error: E does not match TT in partial specialization
19020: 〞end example ] 
19021: 14.4 Type equivalence [temp.type] 
19022: 1 Two template-ids refer to the same class or function if 
19023: 〞 their template-names or operator-function-ids refer to the same template, and 
19024: 〞 their corresponding type template-arguments are the same type, and 
19025: 〞 their corresponding non-type template arguments of integral or enumeration type have identical values, 
19026: and 
19027: 〞 their corresponding non-type template-arguments of pointer type refer to the same external object or 
19028: function or are both the null pointer value, and 
19029: ∫ 14.4 320 
19030: 
19031: c
19032: . ISO/IEC N2800=08-0310 
19033: 〞 their corresponding non-type template-arguments of pointer-to-member type refer to the same class 
19034: member or are both the null member pointer value, and 
19035: 〞 their corresponding non-type template-arguments of reference type refer to the same external object 
19036: or function, and 
19037: 〞 their corresponding template template-arguments refer to the same template.
19038: [ Example:
19039: template<class E, int size> class buffer { /. ...  / };
19040: buffer<char,2*512> x;
19041: buffer<char,1024> y;
19042: declares x and y to be of the same type, and 
19043: template<class T, void(*err_fct)()> class list { /. ...  / };
19044: list<int,&error_handler1> x1;
19045: list<int,&error_handler2> x2;
19046: list<int,&error_handler2> x3;
19047: list<char,&error_handler2> x4;
19048: declares x2 and x3 to be of the same type. Their type differs from the types of x1 and x4. 
19049: template<template<class> class TT> struct X { };
19050: template<class> struct Y { };
19051: template<class T> using Z = Y<T>;
19052: X<Y> y;
19053: X<Z> z;
19054: declares y and z to be of the same type. 〞end example ] 
19055: 2 In a constrained context (14.10), two types are the same type if some same-type requirement (14.10.1) makes 
19056: them equivalent (14.10.1). 
19057: 14.5 Template declarations [temp.decls] 
19058: 1 A template-id, that is, the template-name followed by a template-argument-list shall not be specified in the 
19059: declaration of a primary template declaration. [ Example: 
19060: template<class T1, class T2, int I> class A<T1, T2, I> { }; // error
19061: template<class T1, int I> void sort<T1, I>(T1 data[I]); // error
19062: 〞end example ][ Note: however, this syntax is allowed in class template partial specializations (14.5.5). 
19063: 〞end note ] 
19064: 2 For purposes of name lookup and instantiation, default arguments of function templates and default argu-
19065: ments of member functions of class templates are considered definitions; each default argument is a separate 
19066: definition which is unrelated to the function template definition or to any other default arguments. 
19067: 3 Because an alias-declaration cannot declare a template-id, it is not possible to partially or explicitly specialize 
19068: a template alias. 
19069: 14.5.1 Class templates [temp.class] 
19070: 1 A class template defines the layout and operations for an unbounded set of related types. [ Example: a single 
19071: class template List might provide a common definition for list of int, list of float, and list of pointers to 
19072: Shapes. 〞end example ] 
19073: ∫ 14.5.1 321 
19074: 
19075: c
19076: . ISO/IEC N2800=08-0310 
19077: [ Example: An array class template might be declared like this: 
19078: template<class T> class Array {
19079: T* v;
19080: int sz;
19081: public:
19082: explicit Array(int);
19083: T& operator[](int);
19084: T& elem(int i) { return v[i]; }
19085: }; 
19086: 2 The prefix template <class T> specifies that a template is being declared and that a type-name T will be 
19087: used in the declaration. In other words, Array is a parameterized type with T as its parameter. 〞end 
19088: example ] 
19089: 3 When a member function, a member class, a static data member or a member template of a class template 
19090: is defined outside of the class template definition, the member definition is defined as a template definition 
19091: in which the template-parameters are those of the class template. The names of the template parameters 
19092: used in the definition of the member may be different from the template parameter names used in the class 
19093: template definition. The template argument list following the class template name in the member definition 
19094: shall name the parameters in the same order as the one used in the template parameter list of the member. 
19095: Each template parameter pack shall be expanded with an ellipsis in the template argument list. [ Example: 
19096: template<class T1, class T2> struct A {
19097: void f1();
19098: void f2();
19099: }; 
19100: template<class T2, class T1> void A<T2,T1>::f1() { } // OK
19101: template<class T2, class T1> void A<T1,T2>::f2() { } // error
19102: template<class ... Types> struct B {
19103: void f3();
19104: void f4();
19105: }; 
19106: template<class ... Types> void B<Types ...>::f3() { } // OK
19107: template<class ... Types> void B<Types>::f4() { } // error
19108: 〞end example ] 
19109: 4 In a redeclaration, partial specialization, explicit specialization or explicit instantiation of a class template, 
19110: the class-key shall agree in kind with the original class template declaration (7.1.6.3). 
19111: 5 A constrained member (9.2) in a class template is declared only in class template specializations in which its 
19112: template requirements (14.10.1) are satisfied (14.10.1.1). If there exist multiple overloads of the constrained 
19113: member with identical signatures, ignoring the template requirements, and identical return types, only the 
19114: most specialized overload, as determined by partial ordering of the template requirements (14.5.6.2), is 
19115: declared in the instantiation. If partial ordering results in an ambiguity, a deleted function with the given 
19116: signature (without any template requirements) is declared in the instantiation. [ Example: 
19117: auto concept C<typename T> {
19118: bool operator<(T, T);
19119: }
19120: concept D<typename T> : C<T> { /. ...  / } 
19121: ∫ 14.5.1 322 
19122: 
19123: c
19124: . ISO/IEC N2800=08-0310 
19125: template<typename T> 
19126: struct A {
19127: requires C<T> void g(); // #1
19128: requires D<T> void g(); // #2
19129: }; 
19130: struct X { };
19131: concept_map D<int> { /. ...  / }
19132: void f(A<float> lf, A<int> li, A<X> lX) 
19133: {
19134: lf.g(); // OK: C<float> implicitly defined, calls #1
19135: li.g(); // OK: calls #2, which is more specialized than #1
19136: lX.g(); // error: no ＊g＊ member in A<X>
19137: } 
19138: 〞end example ] 
19139: 14.5.1.1 Member functions of class templates [temp.mem.func] 
19140: 1 A member function of a class template may be defined outside of the class template definition in which it is 
19141: declared. [ Example: 
19142: template<class T> class Array {
19143: T* v;
19144: int sz;
19145: public:
19146: explicit Array(int);
19147: T& operator[](int);
19148: T& elem(int i) { return v[i]; }
19149: }; 
19150: declares three function templates. The subscript function might be defined like this: 
19151: template<class T> T& Array<T>::operator[](int i) {
19152: if (i<0 || sz<=i) error("Array: range error");
19153: return v[i];
19154: } 
19155: 〞end example ] 
19156: 2 The template-arguments for a member function of a class template are determined by the template-arguments 
19157: of the type of the object for which the member function is called. [ Example: the template-argument for 
19158: Array<T> :: operator [] () will be determined by the Array to which the subscripting operation is applied. 
19159: Array<int> v1(20);
19160: Array<dcomplex> v2(30);
19161: v1[3] = 7; // Array<int>::operator[]()
19162: v2[3] = dcomplex(7,8); // Array<dcomplex>::operator[]()
19163: ∫ 14.5.1.1 323 
19164: 
19165: c
19166: . ISO/IEC N2800=08-0310 
19167: 〞end example ] 
19168: 14.5.1.2 Member classes of class templates [temp.mem.class] 
19169: 1 A class member of a class template may be defined outside the class template definition in which it is declared. 
19170: [ Note: the class member must be defined before its first use that requires an instantiation (14.7.1). For 
19171: example, 
19172: template<class T> struct A { 
19173: class B;
19174: };
19175: A<int>::B* b1; // OK: requires A to be defined but not A::B
19176: template<class T> class A<T>::B { };
19177: A<int>::B b2; // OK: requires A::B to be defined
19178: 〞end note ] 
19179: 14.5.1.3 Static data members of class templates [temp.static] 
19180: 1 A definition for a static data member may be provided in a namespace scope enclosing the definition of the 
19181: static member＊s class template. [ Example: 
19182: template<class T> class X { 
19183: static T s;
19184: };
19185: template<class T> T X<T>::s = 0;
19186: 〞end example ] 
19187: 14.5.2 Member templates [temp.mem] 
19188: 1 A template can be declared within a class or class template; such a template is called a member template. A 
19189: member template can be defined within or outside its class definition or class template definition. A member 
19190: template of a class template that is defined outside of its class template definition shall be specified with 
19191: the template-parameters of the class template followed by the template-parameters of the member template. 
19192: [ Example: 
19193: template<class T> struct string {
19194: template<class T2> int compare(const T2&);
19195: template<class T2> string(const string<T2>& s) { /. ...  / }
19196: }; 
19197: template<class T> template<class T2> int string<T>::compare(const T2& s) {
19198: }
19199: 〞end example ] 
19200: 2 A local class shall not have member templates. Access control rules (Clause 11) apply to member template 
19201: names. A destructor shall not be a member template. A normal (non-template) member function with a 
19202: given name and type and a member function template of the same name, which could be used to generate 
19203: a specialization of the same type, can both be declared in a class. When both exist, a use of that name and 
19204: type refers to the non-template member unless an explicit template argument list is supplied. [ Example: 
19205: template <class T> struct A {
19206: void f(int);
19207: template <class T2> void f(T2);
19208: }; 
19209: ∫ 14.5.2 324 
19210: 
19211: c
19212: . ISO/IEC N2800=08-0310 
19213: template <> void A<int>::f(int) { } // non-template member
19214: template <> template <> void A<int>::f<>(int) { } // template member
19215: int main() {
19216: A<char> ac;
19217: ac.f(1); // non-template
19218: ac.f(＊c＊); // template
19219: ac.f<>(1); // template
19220: } 
19221: 〞end example ] 
19222: 3 A member function template shall not be virtual. [ Example: 
19223: template <class T> struct AA {
19224: template <class C> virtual void g(C); // error
19225: virtual void f(); // OK
19226: }; 
19227: 〞end example ] 
19228: 4 A specialization of a member function template does not override a virtual function from a base class. 
19229: [ Example: 
19230: class B {
19231: virtual void f(int);
19232: };
19233: class D : public B {
19234: template <class T> void f(T); // does not override B::f(int)
19235: void f(int i) { f<>(i); } // overriding function that calls
19236: // the template instantiation 
19237: }; 
19238: 〞end example ] 
19239: 5 A specialization of a conversion function template is referenced in the same way as a non-template conversion 
19240: function that converts to the same type. [ Example: 
19241: struct A { 
19242: template <class T> operator T*();
19243: };
19244: template <class T> A::operator T*(){ return 0; }
19245: template <> A::operator char*(){ return 0; } // specialization
19246: template A::operator void*(); // explicit instantiation
19247: int main() {
19248: A a;
19249: int *ip;
19250: ip = a.operator int*(); // explicit call to template operator
19251: // A::operator int*()
19252: }
19253: 〞end example ][ Note: because the explicit template argument list follows the function template name, 
19254: and because conversion member function templates and constructor member function templates are called 
19255: ∫ 14.5.2 325 
19256: 
19257: c
19258: . ISO/IEC N2800=08-0310 
19259: without using a function name, there is no way to provide an explicit template argument list for these 
19260: function templates. 〞end note ] 
19261: 6 A specialization of a conversion function template is not found by name lookup. Instead, any conversion 
19262: function templates visible in the context of the use are considered. For each such operator, if argument 
19263: deduction succeeds (14.8.2.3), the resulting specialization is used as if found by name lookup. 
19264: 7 A using-declaration in a derived class cannot refer to a specialization of a conversion function template in a 
19265: base class. 
19266: 8 Overload resolution (13.3.3.2) and partial ordering (14.5.6.2) are used to select the best conversion function 
19267: among multiple specializations of conversion function templates and/or non-template conversion functions. 
19268: 9 A member template of a constrained class template is itself a constrained template (14.10). The template 
19269: requirements of the member template are the template requirements of each of its enclosing constrained 
19270: templates and any requirements specified or implied by the member template itself. [ Example: 
19271: concept C<typename T> { void f(const T&); }
19272: concept D<typename T> { void g(const T&); }
19273: template<C T> class A { 
19274: requires D<T> void h(const T& x) {
19275: f(x); // OK: C<T>::f
19276: g(x); // OK: D<T>::g
19277: }
19278: };
19279: 〞end example ] 
19280: 14.5.3 Variadic templates [temp.variadic] 
19281: 1 A template parameter pack is a template parameter that accepts zero or more template arguments. [ Example: 
19282: template<class ... Types> struct Tuple { }; 
19283: Tuple<> t0; // Types contains no arguments
19284: Tuple<int> t1; // Types contains one argument: int
19285: Tuple<int, float> t2; // Types contains two arguments: int and float
19286: Tuple<0> eror; // error: 0 is not a type
19287: 〞end example ]
19288: [ Note: a template parameter pack can also occur in a concept＊s template parameter list (14.9.1). [ Example:
19289: auto concept C<typename F, typename... Args> {
19290: typename result_type;
19291: result_type operator()(F&, Args...);
19292: } 
19293: 〞end example ] 〞end note ] 
19294: 2 A function parameter pack is a function parameter that accepts zero or more function arguments. [ Example: 
19295: template<class ... Types> void f(Types ... args); 
19296: f(); // OK: args contains no arguments
19297: f(1); // OK: args contains one argument: int
19298: f(2, 1.0); // OK: args contains two arguments: int and double
19299: ∫ 14.5.3 326 
19300: 
19301: c
19302: . ISO/IEC N2800=08-0310 
19303: 〞end example ] 
19304: 3 A parameter pack is either a template parameter pack or a function parameter pack. 
19305: 4 A pack expansion is a sequence of tokens that names one or more parameter packs, followed by an ellipsis. 
19306: The sequence of tokens is called the pattern of the expansion; its syntax depends on the context in which 
19307: the expansion occurs. Pack expansions can occur in the following contexts: 
19308: 〞 In an expression-list (5.2); the pattern is an initializer-clause. 
19309: 〞 In an initializer-list (8.5); the pattern is an initializer-clause. 
19310: 〞 In a base-specifier-list (10); the pattern is a base-specifier. 
19311: 〞 In a mem-initializer-list (12.6.2); the pattern is a mem-initializer. 
19312: 〞 In a template-argument-list (14.3); the pattern is a template-argument. 
19313: 〞 In an exception-specification (15.4); the pattern is a type-id. 
19314: 〞 In a requirement-list (14.10.1); the pattern is a requirement.
19315: [ Example:
19316: template<class ... Types> void f(Types ... rest);
19317: template<class ... Types> void g(Types ... rest) {
19318: f(&rest ...); // ※&rest ...§ is a pack expansion; ※&rest§ is its pattern
19319: }
19320: 〞end example ] 
19321: 5 A parameter pack whose name appears within the pattern of a pack expansion is expanded by that pack 
19322: expansion. An appearance of the name of a parameter pack is only expanded by the innermost enclosing 
19323: pack expansion. The pattern of a pack expansion shall name one or more parameter packs that are not 
19324: expanded by a nested pack expansion. All of the parameter packs expanded by a pack expansion shall have 
19325: the same number of arguments specified. An appearance of a name of a parameter pack that is not expanded 
19326: is ill-formed. [ Example: 
19327: template<typename...> struct Tuple {};
19328: template<typename T1, typename T2> struct Pair {};
19329: template<class ... Args1> struct zip {
19330: template<class ... Args2> struct with {
19331: typedef Tuple<Pair<Args1, Args2> ... > type;
19332: };
19333: };
19334: typedef zip<short, int>::with<unsigned short, unsigned>::type T1;
19335: // T1 is Tuple<Pair<short, unsigned short>, Pair<int, unsigned>>
19336: typedef zip<short>::with<unsigned short, unsigned>::type T2;
19337: // error: different number of arguments specified for Args1 and Args2
19338: template<class ... Args> void g(Args ... args) { 
19339: f(const_cast<const Args*>(&args)...); // OK: ※Args§ and ※args§ are expanded 
19340: f(5 ...); // error: pattern does not contain any parameter packs 
19341: f(args); // error: parameter pack ※args§ is not expanded 
19342: f(h(args ...) + args ...); // OK: first ※args§ expanded within h, second ※args§ expanded 
19343: within f
19344: }
19345: ∫ 14.5.3 327 
19346: 
19347: c
19348: . ISO/IEC N2800=08-0310 
19349: 〞end example ] 
19350: 6 The instantiation of an expansion produces a list E1  E2  ...  EN , where N is the number of elements in the 
19351: pack expansion parameters and  is the syntactically-appropriate separator for the list. Each Ei is generated 
19352: by instantiating the pattern and replacing each pack expansion parameter with its ith element. All of the 
19353: Ei become elements in the enclosing list. [ Note: The variety of list varies with the context: expression-list, 
19354: base-specifier-list, template-argument-list, requirement-list, etc. 〞end note ] 
19355: 14.5.4 Friends [temp.friend] 
19356: 1 A friend of a class or class template can be a function template or class template, a specialization of a 
19357: function template or class template, or an ordinary (non-template) function or class. For a friend function 
19358: declaration that is not a template declaration: 
19359: 〞 if the name of the friend is a qualified or unqualified template-id, the friend declaration refers to a 
19360: specialization of a function template, otherwise 
19361: 〞 if the name of the friend is a qualified-id and a matching non-template function is found in the specified 
19362: class or namespace, the friend declaration refers to that function, otherwise, 
19363: 〞 if the name of the friend is a qualified-id and a matching specialization of a function templateis found in 
19364: the specified class or namespace, the friend declaration refers to that function template specialization, 
19365: otherwise, 
19366: 〞 the name shall be an unqualified-id that declares (or redeclares) an ordinary (non-template) function. 
19367: [ Example: 
19368: template<class T> class task;
19369: template<class T> task<T>* preempt(task<T>*);
19370: template<class T> class task {
19371: friend void next_time();
19372: friend void process(task<T>*);
19373: friend task<T>* preempt<T>(task<T>*);
19374: template<class C> friend int func(C);
19375: friend class task<int>;
19376: template<class P> friend class frd;
19377: };
19378: Here, each specialization of the task class template has the function next_time as a friend; because process 
19379: does not have explicit template-arguments, each specialization of the task class template has an appropriately 
19380: typed function process as a friend, and this friend is not a function template specialization; because the 
19381: friend preempt has an explicit template-argument <T>, each specialization of the task class template has 
19382: the appropriate specialization of the function template preempt as a friend; and each specialization of 
19383: the task class template has all specializations of the function template func as friends. Similarly, each 
19384: specialization of the task class template has the class template specialization task<int> as a friend, and 
19385: has all specializations of the class template frd as friends. 〞 end example ] 
19386: 2 A friend template may be declared within a class or class template. A friend function template may be 
19387: defined within a class or class template, but a friend class template may not be defined in a class or class 
19388: template. In these cases, all specializations of the friend class or friend function template are friends of the 
19389: class or class template granting friendship. [ Example: 
19390: ∫ 14.5.4 328 
19391: 
19392: c
19393: . ISO/IEC N2800=08-0310 
19394: class A {
19395: template<class T> friend class B; // OK
19396: template<class T> friend void f(T){ /* ... */ } // OK
19397: }; 
19398: 〞end example ] 
19399: 3 A template friend declaration specifies that all specializations of that template, whether they are implicitly 
19400: instantiated (14.7.1), partially specialized (14.5.5) or explicitly specialized (14.7.3), are friends of the class 
19401: containing the template friend declaration. [ Example: 
19402: class X {
19403: template<class T> friend struct A;
19404: class Y { };
19405: }; 
19406: template<class T> struct A { X::Y ab; }; // OK
19407: template<class T> struct A<T*> { X::Y ab; }; // OK
19408: 〞end example ] 
19409: 4 When a function is defined in a friend function declaration in a class template, the function is instantiated 
19410: when the function is used. The same restrictions on multiple declarations and definitions that apply to 
19411: non-template function declarations and definitions also apply to these implicit definitions. 
19412: 5 A member of a class template may be declared to be a friend of a non-template class. In this case, the 
19413: corresponding member of every specialization of the class template is a friend of the class granting friendship. 
19414: [ Example: 
19415: template<class T> struct A {
19416: struct B { };
19417: void f();
19418: }; 
19419: class C {
19420: template<class T> friend struct A<T>::B;
19421: template<class T> friend void A<T>::f();
19422: }; 
19423: 〞end example ] 
19424: 6 [ Note: a friend declaration may first declare a member of an enclosing namespace scope (14.6.5). 〞end 
19425: note ] 
19426: 7 A friend template shall not be declared in a local class. 
19427: 8 Friend declarations shall not declare partial specializations. [ Example: 
19428: template<class T> class A { };
19429: class X {
19430: template<class T> friend class A<T*>; // error
19431: };
19432: 〞end example ] 
19433: 9 When a friend declaration refers to a specialization of a function template, the function parameter declara-
19434: tions shall not include default arguments, nor shall the inline specifier be used in such a declaration. 
19435: ∫ 14.5.4 329 
19436: 
19437: c
19438: . ISO/IEC N2800=08-0310 
19439: 14.5.5 Class template partial specializations [temp.class.spec] 
19440: 1 A primary class template declaration is one in which the class template name is an identifier. A template 
19441: declaration in which the class template name is a simple-template-id is a partial specialization of the class 
19442: template namedin the simple-template-id. A partial specialization of a class template provides an alternative 
19443: definition of the template that is used instead of the primary definition when the argumentsin a specialization 
19444: match those given in the partial specialization (14.5.5.1). The primary template shall be declared before 
19445: any specializations of that template. A partial specialization shall be declared before the first use of a class 
19446: template specialization that would make use of the partial specialization as the result of an implicit or 
19447: explicit instantiation in every translation unit in which such a use occurs; no diagnostic is required. 
19448: 2 When a partial specialization is used within the instantiation of an exported template, and the unspecialized 
19449: template name is non-dependent in the exported template, a declaration of the partial specialization shall 
19450: be declared before the definition of the exported template, in the translation unit containing that definition. 
19451: A similar restriction applies to explicit specialization; see 14.7. 
19452: 3 Each class template partial specialization is a distinct template and definitions shall be provided for the 
19453: members of a template partial specialization (14.5.5.3). 
19454: 4 [ Example: 
19455: template<class T1, class T2, int I> class A { }; // #1
19456: template<class T, int I> class A<T, T*, I> { }; // #2
19457: template<class T1, class T2, int I> class A<T1*, T2, I> { }; // #3
19458: template<class T> class A<int, T*, 5> { }; // #4
19459: template<class T1, class T2, int I> class A<T1, T2*, I> { }; // #5
19460: The first declaration declares the primary (unspecialized) class template. The second and subsequent dec-
19461: larations declare partial specializations of the primary template. 〞end example ] 
19462: 5 The template parameters are specified in the angle bracket enclosedlist that immediately follows the keyword 
19463: template. For partial specializations, the template argument list is explicitly written immediately following 
19464: the class template name. For primary templates, this list is implicitly described by the template parameter 
19465: list. Specifically, the order of the template arguments is the sequence in which they appear in the template 
19466: parameter list. [ Example: the template argument list for the primary template in the example above is <T1, 
19467: T2, I>. 〞end example ][ Note: the template argument list shall not be specified in the primary template 
19468: declaration. For example, 
19469: template<class T1, class T2, int I> class A<T1, T2, I> { }; // error 
19470: 〞end note ] 
19471: 6 A class template partial specialization may be declared or redeclared in any namespace scope in which its 
19472: definition may be defined (14.5.1 and 14.5.2). [ Example: 
19473: template<class T> struct A {
19474: struct C {
19475: template<class T2> struct B { };
19476: };
19477: };
19478: // partial specialization of A<T>::C::B<T2>
19479: template<class T> template<class T2>
19480: struct A<T>::C::B<T2*> { };
19481: A<short>::C::B<int*> absip; // uses partial specialization 
19482: ∫ 14.5.5 330 
19483: 
19484: c
19485: . ISO/IEC N2800=08-0310 
19486: 〞end example ] 
19487: 7 Partial specialization declarations themselves are not found by name lookup. Rather, when the primary 
19488: template name is used, any previously-declared partial specializations of the primary template are also 
19489: considered. One consequence is that a using-declaration which refers to a class template does not restrict 
19490: the set of partial specializations which may be found through the using-declaration.[ Example: 
19491: namespace N {
19492: template<class T1, class T2> class A { }; // primary template
19493: }
19494: using N::A; // refers to the primary template 
19495: namespace N {
19496: template<class T> class A<T, T*> { }; // partial specialization
19497: }
19498: A<int,int*> a; // uses the partial specialization, which is found through
19499: // the using declaration which refers to the primary template
19500: 〞end example ] 
19501: 8 A non-type argument is non-specialized if it is the name of a non-type parameter. All other non-type 
19502: arguments are specialized. 
19503: 9 Within the argument list of a class template partial specialization, the following restrictions apply: 
19504: 〞 A partially specialized non-type argument expression shall not involve a template parameter of the 
19505: partial specialization except when the argument expression is a simple identifier.[ Example: 
19506: template <int I, int J> struct A {};
19507: template <int I> struct A<I+5, I*2> {}; // error
19508: template <int I, int J> struct B {};
19509: template <int I> struct B<I, I> {}; // OK
19510: 〞end example ] 
19511: 〞 The type of a template parameter corresponding to a specialized non-type argument shall not be 
19512: dependent on a parameter of the specialization. [ Example: 
19513: template <class T, T t> struct C {};
19514: template <class T> struct C<T, 1>; // error
19515: template< int X, int (*array_ptr)[X] > class A {};
19516: int array[5];
19517: template< int X > class A<X,&array> { }; // error
19518: 〞end example ] 
19519: 〞 The argument list of the specialization shall not be identical to the implicit argument list of the primary 
19520: template unless the specialization contains template requirements that are more specific (14.5.6.2) than 
19521: the primary template＊s requirements. [ Example: 
19522: concept C<typename T> { int F(T); } 
19523: template<typename T> class X { /. ...  / }; // #6
19524: template<typename T> requires C<T> class X<T> { /. ...  / }; // #7, OK
19525: ∫ 14.5.5 331 
19526: 
19527: c
19528: . ISO/IEC N2800=08-0310 
19529: 〞end example ] 
19530: 〞 The template parameter list of a specialization shall not contain default template argument values.132 
19531: 〞 An argument shall not contain an unexpanded parameter pack. If an argument is a pack expan-
19532: sion (14.5.3), it shall be the last argument in the template argument list. 
19533: 10 The template requirements of a primary class template are implied (14.10.1.2) in its class template partial 
19534: specializations that are constrained templates. [ Example: 
19535: concept C<typename T> { /. ...  / }
19536: concept D<typename T> { /. ...  / }
19537: template<typename T> requires C<T> class Y { /. ...  / }; 
19538: template<typename T>
19539: requires D<T> // same as requires C<T> && D<T>
19540: class Y<T> { /. ...  / };
19541: 〞end example ] 
19542: 14.5.5.1 Matching of class template partial specializations [temp.class.spec.match] 
19543: 1 When a class template is used in a context that requires an instantiation of the class, it is necessary to 
19544: determine whether the instantiation is to be generated using the primary template or one of the partial 
19545: specializations. This is done by matching the template arguments of the class template specialization with 
19546: the template argument lists of the partial specializations. 
19547: 〞 If exactly one matching specialization is found, the instantiation is generated from that specialization. 
19548: 〞 If more than one matching specialization is found, the partial order rules (14.5.5.2) are used to deter-
19549: mine whether one of the specializations is more specialized than the others. If none of the specializations 
19550: is more specialized than all of the other matching specializations, then the use of the class template is 
19551: ambiguous and the program is ill-formed. 
19552: 〞 If no matches are found, the instantiation is generated from the primary template. 
19553: 2 A partial specialization matches a given actual template argument list if the template arguments of the 
19554: partial specialization can be deduced from the actual template argument list (14.8.2) and the deduced 
19555: template arguments satisfy the partial specializaton＊s template requirements (if any). [ Example: 
19556: A<int, int, 1> a1; // uses #1
19557: A<int, int*, 1> a2; // uses #2, T is int, I is 1
19558: A<int, char*, 5> a3; // uses #4, T is char
19559: A<int, char*, 1> a4; // uses #5, T1 is int, T2 is char, I is 1
19560: A<int*, int*, 2> a5; // ambiguous: matches #3 and #5
19561: concept_map D<int> { /. ...  /}
19562: struct Y { }
19563: X<int> x1; // uses #7
19564: X<Y> x2; // uses #6
19565: 〞end example ] 
19566: 3 A non-type template argument can also be deduced from the value of an actual template argument of a 
19567: non-type parameter of the primary template. [ Example: the declaration of a2 above. 〞 end example ] 
19568: 132) There is no way in which they could be used.
19569: ∫ 14.5.5.1 332 
19570: 
19571: c
19572: . ISO/IEC N2800=08-0310 
19573: 4 In a type name that refers to a class template specialization, (e.g., A<int, int, 1>) the argument list 
19574: shall match the template parameter list of the primary template. If the primary template has template 
19575: requirements, the arguments shall satisfy those requirements. The template arguments of a specialization 
19576: are deduced from the arguments of the primary template. 
19577: 14.5.5.2 Partial ordering of class template specializations [temp.class.order] 
19578: 1 For two class template partial specializations, the first is at least as specialized as the second if, given the 
19579: following rewrite to two function templates, the first function template is at least as specialized as the second 
19580: according to the ordering rules for function templates (14.5.6.2): 
19581: 〞 the first function template has the same template parameters as the first partial specialization and has 
19582: a single function parameter whose type is a class template specialization with the template arguments 
19583: of the first partial specialization, and 
19584: 〞 the second function template has the same template parameters as the second partial specialization 
19585: and has a single function parameter whose type is a class template specialization with the template 
19586: arguments of the second partial specialization. 
19587: 2 [ Example: 
19588: concept Con1<typename T> { }
19589: concept Con2<typename T> : Con1<T> { }
19590: template<int I, int J, class T> class X { };
19591: template<int I, int J> class X<I, J, int> { }; // #1
19592: template<int I> class X<I, I, int> { }; // #2
19593: template<int I, int J, class T>
19594: requires Con1<T> class X<I, J, T> { }; // #3
19595: template<int I, int J, class T>
19596: requires Con1<2> class X<I, J, T> { }; // #4
19597: template<int I, int J> void f(X<I, J, int>); // A
19598: template<int I> void f(X<I, I, int>); // B
19599: template<int I, int J, class T>
19600: requires Con1<T> void f(X<I, J, T>); // C
19601: template<int I, int J, class T>
19602: requires Con2<T> void f(X<I, J, T>); // D
19603: The partial specialization #2 is more specialized than the partial specialization #1 because the function 
19604: template B is more specialized than the function template A according to the ordering rules for function 
19605: templates. The partial specialization #4 is more specialized than the partial specialization #3 because the 
19606: function template D is more specialized than the function template C according to the partial ordering rules 
19607: for function templates. 〞end example ] 
19608: 14.5.5.3 Members of class template specializations [temp.class.spec.mfunc] 
19609: 1 The template parameter list of a member of a class template partial specialization shall match the template 
19610: parameter list of the class template partial specialization. The template argument list of a member of a class 
19611: template partial specialization shall match the template argument list of the class template partial special-
19612: ization. A class template specialization is a distinct template. The members of the class template partial 
19613: specialization are unrelated to the members of the primary template. Class template partial specialization 
19614: members that are used in a way that requires a definition shall be defined; the definitions of members of the 
19615: primary template are never used as definitions for members of a class template partial specialization. An 
19616: ∫ 14.5.5.3 333 
19617: 
19618: c
19619: . ISO/IEC N2800=08-0310 
19620: explicit specialization of a member of a class template partial specialization is declared in the same way as 
19621: an explicit specialization of the primary template. [ Example: 
19622: // primary template 
19623: template<class T, int I> struct A {
19624: void f();
19625: };
19626: template<class T, int I> void A<T,I>::f() { } 
19627: // class template partial specialization 
19628: template<class T> struct A<T,2> {
19629: void f();
19630: void g();
19631: void h();
19632: }; 
19633: // member of class template partial specialization 
19634: template<class T> void A<T,2>::g() { } 
19635: // explicit specialization 
19636: template<> void A<char,2>::h() { } 
19637: int main() {
19638: A<char,0> a0;
19639: A<char,2> a2;
19640: a0.f(); // OK, uses definition of primary template＊s member
19641: a2.g(); // OK, uses definition of
19642: // partial specialization＊s member
19643: a2.h(); // OK, uses definition of
19644: // explicit specialization＊s member
19645: a2.f(); // ill-formed, no definition of f for A<T,2>
19646: // the primary template is not used here
19647: } 
19648: 〞end example ] 
19649: 2 If a member template of a class template is partially specialized, the member template partial specializations 
19650: are member templates of the enclosing class template; if the enclosing class template is instantiated (14.7.1, 
19651: 14.7.2), a declaration for every member template partial specialization is also instantiated as part of creating 
19652: the members of the class template specialization. If the primary member template is explicitly specialized 
19653: for a given (implicit) specialization of the enclosing class template, the partial specializations of the member 
19654: template are ignored for this specialization of the enclosing class template. If a partial specialization of the 
19655: member template is explicitly specialized for a given (implicit) specialization of the enclosing class template, 
19656: the primary member template and its other partial specializations are still considered for this specialization 
19657: of the enclosing class template. [ Example: 
19658: template<class T> struct A {
19659: template<class T2> struct B {}; // #1
19660: template<class T2> struct B<T2*> {}; // #2
19661: }; 
19662: template<> template<class T2> struct A<short>::B {}; // #3 
19663: A<char>::B<int*> abcip; // uses #2
19664: A<short>::B<int*> absip; // uses #3
19665: ∫ 14.5.5.3 334 
19666: 
19667: c. ISO/IEC N2800=08-0310 
19668: A<char>::B<int> abci; // uses #1 
19669: 〞 end example ] 
19670: 14.5.6 Function templates [temp.fct] 
19671: 1 A function template defines an unbounded set of related functions. 
19672: might be declared like this: 
19673: [ Example: a family of sort functions 
19674: template<class T> class Array { }; 
19675: template<class T> void sort(Array<T>&); 
19676: 〞 end example ] 
19677: 2 A function template can be overloaded with other function templates and with normal (non-template) 
19678: functions. A normal function is not related to a function template (i.e., it is never considered to be a special-
19679: ization), even if it has the same name and type as a potentially generated function template specialization.133 
19680: 14.5.6.1 Function template overloading [temp.over.link] 
19681: 1 It is possible to overload function templates so that two different function template specializations have the 
19682: same type. [ Example: 
19683: // file1.c // file2.c 
19684: template<class T>
19685: void f(T*);
19686: void g(int* p) {
19687: f(p); // calls f<int>(int*)
19688: }
19689: template<class T> 
19690: void f(T); 
19691: void h(int* p) { 
19692: f(p); // calls f<int*>(int*) 
19693: } 
19694: 〞end example ] 
19695: 2 Such specializations are distinct functions and do not violate the one definition rule (3.2). 
19696: 3 The signature of a function template is defined in 1.3. The names of the template parameters are significant 
19697: only for establishing the relationship between the template parameters and the rest of the signature. [ Note: 
19698: two distinct function templates may have identical function return types and function parameter lists, even 
19699: if overload resolution alone cannot distinguish them. 
19700: template<class T> void f();
19701: template<int I> void f(); // OK: overloads the first template
19702: // distinguishable with an explicit template argument list
19703: 〞end note ] 
19704: 4 When an expression that references a template parameter is used in the function parameter list or the return 
19705: type in the declaration of a function template, the expression that references the template parameter is part 
19706: of the signature of the function template. This is necessary to permit a declaration of a function template 
19707: in one translation unit to be linked with another declaration of the function template in another translation 
19708: unit and, conversely, to ensure that function templates that are intended to be distinct are not linked with 
19709: one another. [ Example: 
19710: 133) That is, declarations of non-template functions do not merely guide overload resolution of function template specializations 
19711: with the same name. If such a non-template function is used in a program, it must be defined; it will not be implicitly instantiated 
19712: using the function template definition. 
19713: ∫ 14.5.6.1 335 
19714: 
19715: c
19716: . ISO/IEC N2800=08-0310 
19717: template <int I, int J> A<I+J> f(A<I>, A<J>); // #1
19718: template <int K, int L> A<K+L> f(A<K>, A<L>); // same as #1
19719: template <int I, int J> A<I-J> f(A<I>, A<J>); // different from #1
19720: 〞end example ][ Note: Most expressions that use template parameters use non-type template parameters, 
19721: but it is possible for an expression to reference a type parameter. For example, a template type parameter 
19722: can be used in the sizeof operator. 〞end note ] 
19723: 5 Two expressions involving template parameters are considered equivalent if two function definitions con-
19724: taining the expressions would satisfy the one definition rule (3.2), except that the tokens used to name the 
19725: template parameters may differ as long as a token used to name a template parameter in one expression is 
19726: replaced by another token that names the same template parameter in the other expression. [ Example: 
19727: template <int I, int J> void f(A<I+J>); // #1
19728: template <int K, int L> void f(A<K+L>); // same as #1
19729: 〞end example ] Two expressions involving template parameters that are not equivalent are functionally 
19730: equivalent if, for any given set of template arguments, the evaluation of the expression results in the same 
19731: value. 
19732: 6 Two function templates are equivalent if they are declared in the same scope, have the same name, have 
19733: identical template parameter lists, have identical template requirements (if any), and have return types and 
19734: parameter lists that are equivalent using the rules described above to compare expressions involving template 
19735: parameters. Two function templates are functionally equivalent if they are equivalent except that one or more 
19736: expressions that involve template parameters in the return types, parameter lists, and template requirements 
19737: (if any) are functionally equivalent using the rules described above to compare expressions involving template 
19738: parameters. If a program contains declarations of function templates that are functionally equivalent but 
19739: not equivalent, the program is ill-formed; no diagnostic is required. 
19740: 7 [ Note: This rule guarantees that equivalent declarations will be linked with one another, while not requiring 
19741: implementations to use heroic efforts to guarantee that functionally equivalent declarations will be treated 
19742: as distinct. For example, the last two declarations are functionally equivalent and would cause a program 
19743: to be ill-formed: 
19744: // Guaranteed to be the same 
19745: template <int I> void f(A<I>, A<I+10>);
19746: template <int I> void f(A<I>, A<I+10>);
19747: // Guaranteed to be different 
19748: template <int I> void f(A<I>, A<I+10>);
19749: template <int I> void f(A<I>, A<I+11>);
19750: // Ill-formed, no diagnostic required 
19751: template <int I> void f(A<I>, A<I+10>);
19752: template <int I> void f(A<I>, A<I+1+2+3+4>);
19753: 〞end note ] 
19754: 14.5.6.2 Partial ordering of function templates [temp.func.order] 
19755: 1 If a function template is overloaded, the use of a function template specialization might be ambiguous 
19756: because template argument deduction (14.8.2) may associate the function template specialization with more 
19757: than one function template declaration. Partial ordering of overloaded function template declarations is 
19758: used in the following contexts to select the function template to which a function template specialization 
19759: refers: 
19760: ∫ 14.5.6.2 336 
19761: 
19762: c
19763: . ISO/IEC N2800=08-0310 
19764: 〞 during overload resolution for a call to a function template specialization (13.3.3); 
19765: 〞 when the address of a function template specialization is taken; 
19766: 〞 when a placement operator delete that is a function template specialization is selected to match a 
19767: placement operator new (3.7.4.2, 5.3.4); 
19768: 〞 when a friend function declaration (14.5.4), an explicit instantiation (14.7.2) or an explicit specializa-
19769: tion (14.7.3) refers to a function template specialization. 
19770: 2 Partial ordering selects which of two function templates is more specialized than the other by transforming 
19771: each template in turn (see next paragraph) and performing template argument deduction using the function 
19772: parameter types, or in the case of a conversion function the return type. [ Note: if template argument 
19773: deduction succeeds, then the template requirements (if any) have all been satisfied (14.10.1.1) by the deduced 
19774: template arguments. 〞end note ] The deduction process determines whether one of the templates is more 
19775: specialized than the other. If so, the more specialized template is the one chosen by the partial ordering 
19776: process. 
19777: 3 To produce the transformed template, for each type, non-type, or template template parameter (including 
19778: template parameter packs thereof) synthesize a unique type, value, or class template respectively and sub-
19779: stitute it for each occurrence of that parameter in the function type of the template. When the template is 
19780: a constrained template, the unique type is an archetype and concept map archetypes for each of the require-
19781: ments stated in or implied by its template requirements are also synthesized; see 14.10. [ Note: because the 
19782: unique types are archetypes, two template type parameters may share the same archetype due to same-type 
19783: constraints. 〞 end note ] 
19784: 4 Using the transformed function template＊s function parameter list, or in the case of a conversion function 
19785: its transformed return type, perform type deduction against the function parameter list (or return type) of 
19786: the other function. The mechanism for performing these deductions is given in 14.8.2.4. 
19787: [ Example: 
19788: template<class T> struct A { A(); }; 
19789: template<class T> void f(T);
19790: template<class T> void f(T*);
19791: template<class T> void f(const T*);
19792: template<class T> void g(T);
19793: template<class T> void g(T&);
19794: template<class T> void h(const T&);
19795: template<class T> void h(A<T>&);
19796: void m() {
19797: const int *p;
19798: f(p); // f(const T*) is more specialized than f(T) or f(T*)
19799: float x;
19800: g(x); // Ambiguous: g(T) or g(T&)
19801: A<int> z;
19802: h(z); // overload resolution selects h(A<T>&)
19803: const A<int> z2;
19804: h(z2); // h(const T&) is called because h(A<T>&) is not callable
19805: } 
19806: 〞end example ] 
19807: ∫ 14.5.6.2 337 
19808: 
19809: c
19810: . ISO/IEC N2800=08-0310 
19811: [ Note: when two constrained templates have identical signatures (ignoring template requirements), the par-
19812: tial ordering is based on those template requirements. Similarly, a constrained template is more specialized 
19813: than an unconstrained template because it has more stringent requirements. 〞 end note ][ Example: 
19814: auto concept CopyConstructible<typename T> {
19815: T::T(const T&);
19816: }
19817: template<CopyConstructible T> struct A { A(); }; 
19818: concept C<typename T> { }
19819: concept D<typename T> : C<T> { }
19820: concept_map C<int*> { }
19821: concept_map D<float> { }
19822: template<typename T> concept_map D<A<T>> { }
19823: template<class T> requires C<T> void f(T&) { } // #1
19824: template<class T> requires D<T> void f(T&) { } // #2
19825: template<class T> requires C<A<T>> void f(A<T>&) { } // #3
19826: template<class T> void f(T&); // #4
19827: void m() { 
19828: int *p; 
19829: f(p); // calls #1: template argument deductions fails #2 and #3, and #1 is more specialized than 
19830: #4 
19831: float x;
19832: f(x); // #2 is called because #3 is not callable and #2 is more specialized than #1 and #4
19833: A<int> z;
19834: f(z); // ambiguous: no partial ordering between #2 and #3
19835: } 
19836: 〞end example ] 
19837: 5 The presence of unused ellipsis and default arguments has no effect on the partial ordering of function 
19838: templates. [ Example: 
19839: template<class T> void f(T); // #1
19840: template<class T> void f(T*, int=1); // #2
19841: template<class T> void g(T); // #3
19842: template<class T> void g(T*, ...); // #4
19843: int main() {
19844: int* ip;
19845: f(ip); // calls #2
19846: g(ip); // calls #4
19847: } 
19848: 〞end example ] 
19849: 14.5.7 Template aliases [temp.alias] 
19850: 1 A template alias declares a name for a family of types. The name of the template alias is a template-name. 
19851: 2 When a template-id refers to the specialization of a template alias, it is equivalent to the associated type 
19852: obtained by substitution of its template-arguments for the template-parameters in the type-id of the template 
19853: alias. [ Note: A template alias name is never deduced. 〞end note ][ Example: 
19854: ∫ 14.5.7 338 
19855: 
19856: c
19857: . ISO/IEC N2800=08-0310 
19858: template<class T> struct Alloc { /. ...  / };
19859: template<class T> using Vec = vector<T, Alloc<T>>;
19860: Vec<int> v; // same as vector<int, Alloc<int>> v;
19861: template<class T>
19862: void process(Vec<T>& v)
19863: { /. ...  / }
19864: template<class T>
19865: void process(vector<T, Alloc<T>>& w)
19866: { /. ...  / } // error: redefinition
19867: template<template<class> class TT>
19868: void f(TT<int>);
19869: f(v); // error: Vec not deduced 
19870: template<template<class,class> class TT>
19871: void g(TT<int, Alloc<int>>);
19872: g(v); // OK: TT = vector
19873: 〞end example ] 
19874: 14.5.8 Concept map templates [temp.concept.map] 
19875: 1 A concept map template defines an unbounded set of concept maps with a common set of associated function, 
19876: associated type, and associated class template definitions. [ Example: 
19877: concept F<typename T> {
19878: typename type;
19879: type f(T);
19880: } 
19881: template<typename T> 
19882: concept_map F<T*> {
19883: typedef T& type;
19884: T& f(T*);
19885: } 
19886: 〞end example ] 
19887: 2 A concept map template is a constrained template (14.10) [ Note: a concept map template is a constrained 
19888: template even if it does not have template requirements. 〞end note ] 
19889: 3 Within the template-argument-list of the concept-id in a concept map template (including nested template 
19890: argument lists), the following restrictions apply: 
19891: 〞 A non-type argument expression shall not involve a template parameter of the concept map except 
19892: when the argument expression is a simple identifier. 
19893: 〞 The type of a template parameter corresponding to a non-type argument shall not be dependent on a 
19894: parameter of the concept map. 
19895: 〞 The template parameter list of a concept map template shall not contain default template argument 
19896: values.134 
19897: 134) There is no way in which they could be used. 
19898: ∫ 14.5.8 339 
19899: 
19900: c
19901: . ISO/IEC N2800=08-0310 
19902: 4 During concept map lookup (14.10.1.1), concept map matching determines whether a particular concept map 
19903: template can be used. Concept map matching matches the template arguments in the concept instance to the 
19904: template arguments in the concept map template, using matching of class template partial specializations 
19905: (14.5.5.1). 
19906: 5 For two concept map templates, the first is at least as specialized as the second if, given the following rewrite 
19907: to two class template partial specializations of an invented class template X, the first class template partial 
19908: specialization is at least as specialized as the second according to the rules for partial ordering of class 
19909: template partial specializations (14.5.5.2). The primary class template X has the same template parameters 
19910: as the concept of the concept map templates. The class template partial specializations are constrained 
19911: templates, even if the corresponding concept map templates have no requirements specified. 
19912: 〞 the first class template partial specialization has the same template parameters and template arguments 
19913: as the first concept map template, and 
19914: 〞 the second class template has the same template parameters and template arguments as the second 
19915: concept map template. 
19916: [ Example: 
19917: concept C<typename T> { }
19918: concept Ptr<typename T> { }
19919: template<typename T> concept_map Ptr<T*> { /. ...  / }
19920: template<typename T> requires Ptr<T*> concept_map C<T*> { /. ...  / } // #1
19921: template<typename T> requires Ptr<T> concept_map C<T> { /. ...  / } // #2
19922: template<typename T> class X;
19923: template<typename T> requires Ptr<T*> class X<T*>; // A
19924: template<typename T> requires Ptr<T> class X<T>; // B
19925: The concept map template #1 is more specialized than the concept map template #2 because the class 
19926: template partial specialization A is more specialized than the class template partial specialization B according 
19927: to the ordering rules for class template partial specializations. 〞end example ] 
19928: 6 A concept map template shall satisfy the requirements of its corresponding concept (14.9.2) at the time of 
19929: definition of the concept map template. [ Example: 
19930: concept C<typename T> { } 
19931: concept F<typename T> {
19932: void f(T);
19933: }
19934: template<C T> struct X; 
19935: template<F T> void f(X<T>); // #1 
19936: template<typename T>
19937: concept_map F<X<T>> { } // error: requirement for f(X<T>) not satisfied
19938: template<F T>
19939: concept_map F<X<T>> { } // OK: uses #1 to satisfy requirement for f(X<T>)
19940: 〞end example ] 
19941: ∫ 14.5.8 340 
19942: 
19943: c
19944: . ISO/IEC N2800=08-0310 
19945: 7 If the definition of a concept map template uses an instantiated archetype (14.10.2), and instantiation of 
19946: the concept map template results in a different specialization of that class template with an incompatible 
19947: definition, the program is ill-formed. The specialization is considered to have an incompatible definition if 
19948: the specialization＊s definition causes a different definition of any associated type or associated class template 
19949: in the concept map, if its definition causes any of the associated function definitions to be ill-formed, or if 
19950: the resulting concept map fails to satisfy the axioms of the corresponding concept. [ Example: 
19951: concept Stack<typename X> {
19952: typename value_type;
19953: value_type& top(X&);
19954: // ... 
19955: } 
19956: template<typename T> struct dynarray {
19957: T& top();
19958: };
19959: template<> struct dynarray<bool> {
19960: bool top();
19961: };
19962: template<typename T> 
19963: concept_map Stack<dynarray<T>> {
19964: typedef T value_type;
19965: T& top(dynarray<T>& x) { return x.top(); }
19966: } 
19967: template<Stack X>
19968: void f(X& x) {
19969: X::value_type& t = top(x);
19970: }
19971: void g(dynarray<int>& x1, dynarray<bool>& x2) {
19972: f(x1); // OK
19973: f(x2); // error: Stack<dynarray<bool> > uses the dynarray<bool> class specialization
19974: // rather than the dynarray primary class template, and the two
19975: // have incompatible signatures for top()
19976: }
19977: 〞end example ] 
19978: 8 A concept map template shall be declared before the first use of a concept map that would make use of the 
19979: concept map template as the result of an instantiation in every translation unit in which such a use occurs; 
19980: no diagnostic is required. 
19981: 14.6 Name resolution [temp.res] 
19982: 1 Three kinds of names can be used within a template definition: 
19983: 〞 The name of the template itself, and names declared within the template itself. 
19984: 〞 Names dependent on a template-parameter (14.6.2). 
19985: 〞 Names from scopes which are visible within the template definition. 
19986: ∫ 14.6 341 
19987: 
19988: c
19989: . ISO/IEC N2800=08-0310 
19990: 2 A name used in a template declaration or definition and that is dependent on a template-parameter is 
19991: assumed not to name a type unless the applicable name lookup finds a type name or the name is qualified 
19992: by the keyword typename.[ Example: 
19993: // no B declared here 
19994: class X; 
19995: template<class T> class Y {
19996: class Z; // forward declaration of member class
19997: void f() {
19998: X* a1; // declare pointer to X
19999: T* a2; // declare pointer to T
20000: Y* a3; // declare pointer to Y<T>
20001: Z* a4; // declare pointer to Z
20002: typedef typename T::A TA;
20003: TA* a5; // declare pointer to T＊s A
20004: typename T::A* a6; // declare pointer to T＊s A
20005: T::A* a7; // T::A is not a type name:
20006: // multiply T::A by a7; ill-formed, 
20007: // no visible declaration of a7 
20008: B* a8; // B is not a type name:
20009: // multiply B by a8; ill-formed,
20010: // no visible declarations of B and a8
20011: }
20012: };
20013: 〞end example ] 
20014: 3 When a qualified-id is intended to refer to a type that is not a member of the current instantiation (14.6.2.1) 
20015: and its nested-name-specifier is not a concept instance (14.9) and depends on a template-parameter (14.6.2), it 
20016: shall be prefixed by the keyword typename, forming a typename-specifier. If the qualified-id in a typename-
20017: specifier does not denote a type, the program is ill-formed. When the nested-name-specifier refers to a 
20018: concept instance, name lookup into the corresponding concept determines whether the qualified-id refers to 
20019: a type or a value. 
20020: typename-specifier:
20021: typename ::opt nested-name-specifier identifier
20022: typename ::opt nested-name-specifier templateopt simple-template-id
20023: 4 If a specialization of a template is instantiated for a set of template-arguments such that the qualified-id 
20024: prefixed by typename does not denote a type, the specialization is ill-formed. The usual qualified name 
20025: lookup (3.4.3) is used to find the qualified-id even in the presence of typename.[ Example: 
20026: struct A {
20027: struct X { };
20028: int X;
20029: };
20030: struct B {
20031: struct X { };
20032: };
20033: template<class T> void f(T t) {
20034: typename T::X x;
20035: }
20036: void foo() {
20037: A a; 
20038: ∫ 14.6 342 
20039: 
20040: c
20041: . ISO/IEC N2800=08-0310 
20042: B b;
20043: f(b); // OK: T::X refers to B::X
20044: f(a); // error: T::X refers to the data member A::X not the struct A::X
20045: } 
20046: 〞end example ] 
20047: 5 A qualified name used as the name in a mem-initializer-id, a base-specifier, or an elaborated-type-specifier is 
20048: implicitly assumed to name a type, without the use of the typename keyword. [ Note: the typename keyword 
20049: is not permitted by the syntax of these constructs. 〞end note ] 
20050: 6 If, for a given set of template arguments, a specialization of a template is instantiated that refers to a 
20051: qualified-id that denotes a type, and the nested-name-specifier of the qualified-id depends on a template 
20052: parameter, the qualified-id shall either be prefixed by typename or shall be used in a context in which it 
20053: implicitly names a type as described above. [ Example: 
20054: template <class T> void f(int i) { 
20055: T::x * i;
20056: }
20057: struct Foo { 
20058: typedef int x; 
20059: }; 
20060: struct Bar { 
20061: static int const 
20062: }; 
20063: int main() {
20064: f<Bar>(1);
20065: f<Foo>(1);
20066: } 
20067: 〞end example ] 
20068: // T::x must not be a type 
20069: x = 5; 
20070: // OK 
20071: // error: Foo::x is a type 
20072: 7 Within the definition of a class template or within the definition of a member of a class template, the keyword 
20073: typename is not required when referring to the unqualified name of a previously declared member of the 
20074: class template that declares a type. [ Example: 
20075: template<class T> struct A {
20076: typedef int B;
20077: B b; // OK, no typename required
20078: }; 
20079: 〞end example ] 
20080: 8 Knowing which names are type names allows the syntax of every template definition to be checked. No 
20081: diagnostic shall be issued for a template definition for which a valid specialization can be generated. If 
20082: no valid specialization can be generated for a template definition, and that template is not instantiated, 
20083: the template definition is ill-formed, no diagnostic required. If a type used in a non-dependent name is 
20084: incomplete at the point at which a template is defined but is complete at the point at which an instantiation 
20085: is done, and if the completeness of that type affects whether or not the program is well-formed or affects 
20086: the semantics of the program, the program is ill-formed; no diagnostic is required. [ Note: if a template 
20087: is instantiated, errors will be diagnosed according to the other rules in this Standard. Exactly when these 
20088: errors are diagnosed is a quality of implementation issue. 〞end note ][ Example: 
20089: ∫ 14.6 343 
20090: 
20091: . ISO/IEC N2800=08-0310 
20092: int j; 
20093: template<class T> class X {
20094: void f(T t, int i, char* p) {
20095: t = i; 
20096: p = i; 
20097: p = j; 
20098: } 
20099: void g(T t) { 
20100: +; 
20101: } 
20102: }; 
20103: 〞end example ] 
20104: // diagnosed if X::f is instantiated 
20105: // and the assignment to t is an error 
20106: // may be diagnosed even if X::f is 
20107: // not instantiated 
20108: // may be diagnosed even if X::f is 
20109: // not instantiated 
20110: // may be diagnosed even if X::g is 
20111: // not instantiated 
20112: 9 When looking for the declaration of a name used in a template definition, the usual lookup rules (3.4.1, 
20113: 3.4.2) are used for non-dependent names. The lookup of names dependent on the template parameters is 
20114: postponed until the actual template argument is known (14.6.2). 
20115: #include <iostream>
20116: using namespace std;
20117: template<class T> class Set {
20118: T* p;
20119: int cnt;
20120: public:
20121: Set();
20122: Set<T>(const Set<T>&);
20123: void printall() {
20124: for (int i = 0; i<cnt; i++)
20125: cout << p[i] << ＊\n＊;
20126: }
20127: };
20128: [ Example: 
20129: in the example, i is the local variable i declared in printall, cnt is the member cnt declared in Set, and 
20130: cout is the standard output stream declared in iostream. However, not every declaration can be found this 
20131: way; the resolution of some names must be postponed until the actual template-arguments are known. For 
20132: example, even though the name operator<< is known within the definition of printall() and a declaration 
20133: of it can be found in <iostream>, the actual declaration of operator<< needed to print p[i] cannot be 
20134: known until it is known what type T is (14.6.2). 〞end example ] 
20135: 10 If a name does not depend on a template-parameter (as defined in14.6.2), a declaration (or set of declarations) 
20136: for that name shall be in scope at the point where the name appears in the template definition; the name is 
20137: bound to the declaration (or declarations) found at that point and this binding is not affected by declarations 
20138: that are visible at the point of instantiation. [ Example: 
20139: void f(char); 
20140: template<class T> void g(T t) {
20141: f(1); // f(char)
20142: f(T(1)); // dependent
20143: f(t); // dependent
20144: dd++; // not dependent
20145: ∫ 14.6 344 
20146: 
20147: . ISO/IEC N2800=08-0310 
20148: // error: declaration for dd not found 
20149: } 
20150: enum E { e };
20151: void f(E);
20152: double dd;
20153: void h() {
20154: g(e); // will cause one call of f(char) followed
20155: // by two calls of f(E)
20156: g(＊a＊); // will cause three calls of f(char)
20157: }
20158: 〞end example ] 
20159: 11 [ Note: for purposes of name lookup, default arguments of function templates and default arguments of 
20160: member functions of class templates are considered definitions (14.5). 〞end note ] 
20161: 14.6.1 Locally declared names [temp.local] 
20162: 1 Like normal (non-template) classes, class templates have an injected-class-name (Clause 9). The injected-
20163: class-name can be used with or without a template-argument-list. When it is used without a template-
20164: argument-list, it is equivalent to the injected-class-name followed by the template-parameters of the class 
20165: template enclosed in <>. When it is used with a template-argument-list, it refers to the specified class 
20166: template specialization, which could be the current specialization or another specialization. 
20167: 2 Within the scope of a class template specialization or partial specialization, when the injected-class-name 
20168: is not followed by a <, it is equivalent to the injected-class-name followed by the template-arguments of the 
20169: class template specialization or partial specialization enclosed in <>.[ Example: 
20170: template<class T> class Y; 
20171: template<> class Y<int> {
20172: Y* p; // meaning Y<int>
20173: Y<char>* q; // meaning Y<char>
20174: }; 
20175: 〞end example ] 
20176: 3 The injected-class-name of a class template or class template specialization can be used either with or without 
20177: a template-argument-list wherever it is in scope. [ Example: 
20178: template <class T> struct Base {
20179: Base* p;
20180: };
20181: template <class T> struct Derived: public Base<T> {
20182: typename Derived::Base* p; // meaning Derived::Base<T>
20183: };
20184: 〞end example ] 
20185: 4 A lookup that finds an injected-class-name (10.2) can result in an ambiguity in certain cases (for example, if it 
20186: is found in more than one base class). If all of the injected-class-names that are found refer to specializations 
20187: of the same class template, and if the name is followed by a template-argument-list, the reference refers to 
20188: the class template itself and not a specialization thereof, and is not ambiguous. [ Example: 
20189: ∫ 14.6.1 345 
20190: 
20191: c
20192: . ISO/IEC N2800=08-0310 
20193: template <class T> struct Base { }; 
20194: template <class T> struct Derived: Base<int>, Base<char> {
20195: typename Derived::Base b; // error: ambiguous
20196: typename Derived::Base<double> d; // OK
20197: }; 
20198: 〞end example ] 
20199: 5 When the normal name of the template (i.e., the name from the enclosing scope, not the injected-class-name) 
20200: is used without a template-argument-list, it refers to the class template itself and not a specialization of the 
20201: template. [ Example: 
20202: template <class T> class X {
20203: X* p; // meaning X<T>
20204: X<T>* p2;
20205: X<int>* p3;
20206: ::X* p4; // error: missing template argument list
20207: // ::X does not refer to the injected-class-name
20208: };
20209: 〞end example ] 
20210: 6 The scope of a template-parameter extends from its point of declaration until the end of its template. A 
20211: template-parameter hides any entity with the same name in the enclosing scope. [ Note: this implies that 
20212: a template-parameter can be used in the declaration of subsequent template-parameters and their default 
20213: arguments but cannot be used in preceding template-parameters or their default arguments. For example, 
20214: template<class T, T* p, class U = T> class X { /. ...  / };
20215: template<class T> void f(T* p = new T);
20216: This also implies that a template-parameter can be used in the specification of base classes. For example, 
20217: template<class T> class X : public Array<T> { /. ...  / };
20218: template<class T> class Y : public T { /. ...  / };
20219: The use of a template-parameter as a base class implies that a class used as a template-argument must be 
20220: defined and not just declared when the class template is instantiated. 〞 end note ] 
20221: 7 A template-parameter shall not be redeclared within its scope (including nested scopes). A template-
20222: parameter shall not have the same name as the template name. [ Example: 
20223: template<class T, int i> class Y {
20224: int T; // error: template-parameter redeclared
20225: void f() {
20226: char T; // error: template-parameter redeclared
20227: }
20228: };
20229: template<class X> class X; // error: template-parameter redeclared 
20230: 〞end example ] 
20231: 8 In the definition of a member of a class template that appears outside of the class template definition, the 
20232: name of a member of this template hides the name of a template-parameter.[ Example: 
20233: template<class T> struct A {
20234: struct B { /. ...  / };
20235: void f();
20236: ∫ 14.6.1 346 
20237: 
20238: c
20239: . ISO/IEC N2800=08-0310 
20240: }; 
20241: template<class B> void A<B>::f() {
20242: B b; // A＊s B, not the template parameter
20243: }
20244: 〞end example ] 
20245: 9 In the definition of a member of a class template that appears outside of the namespace containing the 
20246: class template definition, the name of a template-parameter hides the name of a member of this namespace. 
20247: [ Example: 
20248: namespace N {
20249: class C { };
20250: template<class T> class B {
20251: void f(T); 
20252: };
20253: }
20254: template<class C> void N::B<C>::f(C) {
20255: C b; // C is the template parameter, not N::C
20256: }
20257: 〞end example ] 
20258: 10 In the definition of a class template or in the definition of a member of such a template that appears outside 
20259: of the template definition, for each base class which does not depend on a template-parameter (14.6.2), if 
20260: the name of the base class or the name of a member of the base class is the same as the name of a template-
20261: parameter, the base class name or member name hides the template-parameter name (3.3.10). [ Example: 
20262: struct A {
20263: struct B { /. ...  / };
20264: int a;
20265: int Y;
20266: }; 
20267: template<class B, class a> struct X : A {
20268: B b; // A＊s B
20269: a b; // error: A＊s a isn＊t a type name
20270: }; 
20271: 〞end example ] 
20272: 14.6.2 Dependent names [temp.dep] 
20273: 1 Inside a template, some constructs have semantics which may differ from one instantiation to another. Such a 
20274: construct depends on the template parameters. In particular, types and expressions may depend on the type 
20275: and/or value of template parameters (as determined by the template arguments) and this determines the 
20276: context for name lookup for certain names. Expressions may be type-dependent (on the type of a template 
20277: parameter) or value-dependent (on the value of a non-type template parameter). In an expression of the 
20278: form: 
20279: postfix-expression ( expression-listopt ) 
20280: where the postfix-expression is an unqualified-id but not a template-id, the unqualified-id denotes a dependent 
20281: name if and only if any of the expressions in the expression-list is a type-dependent expression (14.6.2.2). 
20282: If an operand of an operator is a type-dependent expression, the operator also denotes a dependent name. 
20283: ∫ 14.6.2 347 
20284: 
20285: c
20286: . ISO/IEC N2800=08-0310 
20287: Such names are unbound and are looked up at the point of the template instantiation (14.6.4.1) in both the 
20288: context of the template definition and the context of the point of instantiation. 
20289: 2 [ Example: 
20290: template<class T> struct X : B<T> {
20291: typename T::A* pa;
20292: void f(B<T>* pb) {
20293: static int i = B<T>::i;
20294: pb->j++;
20295: }
20296: };
20297: the base class name B<T>, the type name T::A, the names B<T>::i and pb->j explicitly depend on the 
20298: template-parameter. 〞end example ] 
20299: 3 In the definition of a class template or a member of a class template, if a base class of the class template 
20300: depends on a template-parameter, the base class scope is not examined during unqualified name lookup 
20301: either at the point of definition of the class template or member or during an instantiation of the class 
20302: template or member. [ Example: 
20303: typedef double A;
20304: template<class T> class B {
20305: typedef int A;
20306: };
20307: template<class T> struct X : B<T> {
20308: A a; // a has type double
20309: };
20310: The type name A in the definition of X<T> binds to the typedef name defined in the global namespace scope, 
20311: not to the typedef name defined in the base class B<T>. 〞 end example ][ Example: 
20312: struct A {
20313: struct B { /. ...  / };
20314: int a;
20315: int Y;
20316: }; 
20317: int a; 
20318: template<class T> struct Y : T {
20319: struct B { /. ...  / };
20320: B b; // The B defined in Y
20321: void f(int i) { a = i; } // ::a
20322: Y* p; // Y<T>
20323: }; 
20324: Y<A> ya; 
20325: The members A::B, A::a, and A::Y of the template argument A do not affect the binding of names in Y<A>. 
20326: 〞end example ] 
20327: 14.6.2.1 Dependent types [temp.dep.type] 
20328: 1 In the definition of a class template, a nested class of a class template, a member of a class template, or a 
20329: member of a nested class of a class template, a name refers to the current instantiation if it is 
20330: 〞 the injected-class-name (9) of the class template or nested class, 
20331: ∫ 14.6.2.1 348 
20332: 
20333: c
20334: . ISO/IEC N2800=08-0310 
20335: 〞 in the definition of a primary class template, the name of the class template followed by the template 
20336: argument list of the primary template (as described below) enclosed in <>, 
20337: 〞 in the definition of a nested class of a class template, the name of the nested class referenced as a 
20338: member of the current instantiation, or 
20339: 〞 in the definition of a partial specialization, the name of the class template followed by the template 
20340: argument list of the partial specialization enclosed in <>. If the nth template parameter is a parameter 
20341: pack, the nth template argument is a pack expansion (14.5.3) whose pattern is the name of the 
20342: parameter pack. 
20343: 2 The template argument list of a primary template is a template argument list in which the nth template 
20344: argument has the value of the nth template parameter of the class template. If the nth template parameter 
20345: is a template parameter pack, the nth template argument is a pack expansion (14.5.3) whose pattern is the 
20346: name of the template parameter pack. 
20347: 3 A template argument that is equivalent to a template parameter (i.e., has the same constant value or the 
20348: same type as the template parameter) can be used in place of that template parameter in a reference to 
20349: the current instantiation. In the case of a non-type template argument, the argument must have been given 
20350: the value of the template parameter and not an expression in which the template parameter appears as a 
20351: subexpression. [ Example: 
20352: template <class T> class A {
20353: A* p1; // A is the current instantiation
20354: A<T>* p2; // A<T> is the current instantiation
20355: A<T*> p3; // A<T*> is not the current instantiation
20356: ::A<T>* p4; // ::A<T> is the current instantiation
20357: class B {
20358: B* p1; // B is the current instantiation
20359: A<T>::B* p2; // A<T>::B is the current instantiation
20360: typename A<T*>::B* p3; // A<T*>::B is not the
20361: // current instantiation 
20362: };
20363: };
20364: template <class T> class A<T*> {
20365: A<T*>* p1; // A<T*> is the current instantiation
20366: A<T>* p2; // A<T> is not the current instantiation
20367: }; 
20368: template <class T1, class T2, int I> struct B {
20369: B<T1, T2, I>* b1; // refers to the current instantiation
20370: B<T2, T1, I>* b2; // not the current instantiation
20371: typedef T1 my_T1;
20372: static const int my_I = I;
20373: static const int my_I2 = I+0;
20374: static const int my_I3 = my_I;
20375: B<my_T1, T2, my_I>* b3; // refers to the current instantiation
20376: B<my_T1, T2, my_I2>* b4; // not the current instantiation
20377: B<my_T1, T2, my_I3>* b5; // refers to the current instantiation
20378: }; 
20379: 〞end example ] 
20380: 4 A name is a member of the current instantiation if it is 
20381: ∫ 14.6.2.1 349 
20382: 
20383: c
20384: . ISO/IEC N2800=08-0310 
20385: 〞 An unqualified name that, when looked up, refers to a member of a class template. [ Note: this can 
20386: only occur when looking up a name in a scope enclosed by the definition of a class template. 〞end 
20387: note ] 
20388: 〞A qualified-id in which the nested-name-specifier refers to the current instantiation.
20389: [ Example:
20390: template <class T> class A {
20391: static const int i = 5;
20392: int n1[i]; // i refers to a member of the current instantiation
20393: int n2[A::i]; // A::i refers to a member of the current instantiation
20394: int n3[A<T>::i]; // A<T>::i refers to a member of the current instantiation
20395: int f();
20396: }; 
20397: template <class T> int A<T>::f() {
20398: return i; // i refers to a member of the current instantiation
20399: }
20400: 〞end example ] 
20401: 5 A name is a member of an unknown specialization if the name is a qualified-id in which the nested-name-
20402: specifier names a dependent type that is not the current instantiation. 
20403: 6 A type is dependent if it is 
20404: 〞 a template parameter, 
20405: 〞 a member of an unknown specialization, 
20406: 〞 a nested class that is a member of the current instantiation, 
20407: 〞 a cv-qualified type where the cv-unqualified type is dependent, 
20408: 〞 a compound type constructed from any dependent type, 
20409: 〞 an array type constructed from any dependent type or whose size is specified by a constant expression 
20410: that is value-dependent, 
20411: 〞a simple-template-id in which either the template name is a template parameter or any of the template 
20412: arguments is a dependent type or an expression that is type-dependent or value-dependent, or 
20413: 〞 denoted by decltype(expression ), where expression is type-dependent (14.6.2.2). 
20414: 7 [ Note: because typedefs do not introduce new types, but instead simply refer to other types, a name that 
20415: refers to a typedef that is a member of the current instantiation is dependent only if the type referred to is 
20416: dependent. 〞end note ] 
20417: 14.6.2.2 Type-dependent expressions [temp.dep.expr] 
20418: 1 Except as described below, an expression is type-dependent if any subexpression is type-dependent. 
20419: 2 this is type-dependent if the class type of the enclosing member function is dependent (14.6.2.1). 
20420: 3 An id-expression is type-dependent if it contains: 
20421: 〞 an identifier that was declared with a dependent type, 
20422: 〞 a template-id that is dependent, 
20423: ∫ 14.6.2.2 350 
20424: 
20425: c
20426: . ISO/IEC N2800=08-0310 
20427: 〞 a conversion-function-id that specifies a dependent type, 
20428: 〞 a nested-name-specifier or a qualified-id that names a member of an unknown specialization, or 
20429: 〞 an identifier, nested-name-specifier, or a qualified-id that names a member of the current instantiation 
20430: that is a cosntrained member (9.2). 
20431: Expressions of the following forms are type-dependent only if the type specified by the type-id, simple-type-
20432: specifier or new-type-id is dependent, even if any subexpression is type-dependent: 
20433: simple-type-specifier ( expression-listopt )
20434: ::opt new new-placementopt new-type-id new-initializeropt
20435: ::opt new new-placementopt ( type-id ) new-initializeropt
20436: dynamic_cast < type-id >( expression )
20437: static_cast < type-id > ( expression )
20438: const_cast < type-id > ( expression )
20439: reinterpret_cast < type-id > ( expression )
20440: ( type-id ) cast-expression
20441: 4 Expressions of the following forms are never type-dependent (because the type of the expression cannot be 
20442: dependent): 
20443: literal
20444: postfix-expression . pseudo-destructor-name
20445: postfix-expression -> pseudo-destructor-name
20446: sizeof unary-expression
20447: sizeof ( type-id )
20448: sizeof ... ( identifier )
20449: alignof ( type-id )
20450: typeid ( expression )
20451: typeid ( type-id )
20452: ::opt delete cast-expression
20453: ::opt delete [ ] cast-expression
20454: throw assignment-expressionopt
20455: [ Note: For the standard library macro offsetof, see 18.1. 〞end note ] 
20456: 5 A class member access expression (5.2.5) is type-dependent if the type of the referenced member is dependent. 
20457: [ Note: in an expression of the form x.y or xp->y the type of the expression is usually the type of the member 
20458: y of the class of x (or the class pointed to by xp). However, if x or xp refers to a dependent type that is not 
20459: the current instantiation, the type of y is always dependent. If x or xp refers to a non-dependent type or 
20460: refers to the current instantiation, the type of y is the type of the class member access expression. 〞end 
20461: note ] 
20462: 14.6.2.3 Value-dependent expressions [temp.dep.constexpr] 
20463: 1 Except as described below, a constant expression is value-dependent if any subexpression is value-dependent. 
20464: 2 An identifier is value-dependent if it is: 
20465: 〞 a name declared with a dependent type, 
20466: 〞 the name of a non-type template parameter, 
20467: 〞 a constant with effective literal type and is initialized with an expression that is value-dependent. 
20468: Expressions of the following form are value-dependent if the unary-expression is type-dependent or the 
20469: type-id is dependent: 
20470: ∫ 14.6.2.3 351 
20471: 
20472: c
20473: . ISO/IEC N2800=08-0310 
20474: sizeof unary-expression 
20475: sizeof ( type-id ) 
20476: alignof ( type-id ) 
20477: [ Note: For the standard library macro offsetof, see 18.1. 〞end note ] 
20478: 3 Expressions of the following form are value-dependent if either the type-id or simple-type-specifier is depen-
20479: dent or the expression or cast-expression is value-dependent: 
20480: simple-type-specifier ( expression-listopt ) 
20481: static_cast < type-id > ( expression ) 
20482: const_cast < type-id > ( expression ) 
20483: reinterpret_cast < type-id > ( expression ) 
20484: ( type-id ) cast-expression 
20485: 4 Expressions of the following form are value-dependent: 
20486: sizeof ... ( identifier ) 
20487: 14.6.2.4 Dependent template arguments [temp.dep.temp] 
20488: 1 A type template-argument is dependent if the type it specifies is dependent.
20489: 2 Anintegral non-type template-argument is dependentif the constant expression it specifies is value-dependent.
20490: 3 A non-integral non-type template-argument is dependent if its type is dependent or it has either of the
20491: following forms 
20492: qualified-id 
20493: & qualified-id 
20494: and contains a nested-name-specifier which specifies a class-name that names a dependent type. 
20495: 4 A template template-argument is dependent if it names a template-parameter or is a qualified-id with a 
20496: nested-name-specifier which contains a class-name that names a dependent type. 
20497: 14.6.3 Non-dependent names [temp.nondep] 
20498: 1 Non-dependent names used in a template definition are found using the usual name lookup and bound at 
20499: the point they are used. [ Example: 
20500: void g(double);
20501: void h();
20502: template<class T> class Z {
20503: public:
20504: void f() { 
20505: g(1); // calls g(double) 
20506: h++; // ill-formed: cannot increment function; 
20507: // this could be diagnosed either here or 
20508: // at the point of instantiation 
20509: }
20510: };
20511: void g(int); // not in scope at the point of the template
20512: // definition, not considered for the call g(1)
20513: 〞end example ] 
20514: ∫ 14.6.3 352 
20515: 
20516: c
20517: . ISO/IEC N2800=08-0310 
20518: 2 [ Note: if a template contains template requirements, name lookup of non-dependent names in its constrained 
20519: contexts (14.10) can find the names of associated functions in the requirements scope (3.3.8). 〞end note ] 
20520: 14.6.4 Dependent name resolution [temp.dep.res] 
20521: 1 In resolving dependent names, names from the following sources are considered: 
20522: 〞 Declarations that are visible at the point of definition of the template. 
20523: 〞 Declarations from namespaces associated with the types of the function arguments both from the 
20524: instantiation context (14.6.4.1) and from the definition context. 
20525: 14.6.4.1 Point of instantiation [temp.point] 
20526: 1 For a function template specialization, a member function template specialization, or a specialization for a 
20527: member function or static data member of a class template, if the specialization is implicitly instantiated 
20528: because it is referenced from within another template specialization and the context from which it is ref-
20529: erenced depends on a template parameter, the point of instantiation of the specialization is the point of 
20530: instantiation of the enclosing specialization. Otherwise, the point of instantiation for such a specialization 
20531: immediately follows the namespace scope declaration or definition that refers to the specialization. 
20532: 2 If a function template or member function of a class template is called in a way which uses the definition of 
20533: a default argument of that function template or member function, the point of instantiation of the default 
20534: argument is the point of instantiation of the function template or member function specialization. 
20535: 3 For a class template specialization, a class member template specialization, or a specialization for a class 
20536: member of a class template, if the specialization is implicitly instantiated because it is referenced from 
20537: within another template specialization, if the context from which the specialization is referenced depends 
20538: on a template parameter, and if the specialization is not instantiated previous to the instantiation of the 
20539: enclosing template, the point of instantiation is immediately before the point of instantiation of the enclosing 
20540: template. Otherwise, the point of instantiation for such a specialization immediately precedes the namespace 
20541: scope declaration or definition that refers to the specialization. 
20542: 4 If a virtual function is implicitly instantiated, its point of instantiation is immediately following the point of 
20543: instantiation of its enclosing class template specialization. 
20544: 5 An explicit instantiation definition is an instantiation point for the specialization or specializations specified 
20545: by the explicit instantiation. 
20546: 6 The instantiation context of an expression that depends on the template arguments is the set of declarations 
20547: with external linkage declared prior to the point of instantiation of the template specialization in the same 
20548: translation unit. 
20549: 7 A specialization for a function template, a member function template, or of a member function or static 
20550: data member of a class template may have multiple points of instantiations within a translation unit. 
20551: A specialization for a class template has at most one point of instantiation within a translation unit. A 
20552: specialization for any template may have points of instantiation in multiple translation units. If two different 
20553: points of instantiation give a template specialization different meanings according to the one definition 
20554: rule (3.2), the program is ill-formed, no diagnostic required. 
20555: 14.6.4.2 Candidate functions [temp.dep.candidate] 
20556: 1 For a function call that depends on a template parameter, if the function name is an unqualified-id but not 
20557: a template-id, or if the function is called using operator notation, the candidate functions are found using 
20558: the usual lookup rules (3.4.1, 3.4.2) except that: 
20559: ∫ 14.6.4.2 353 
20560: 
20561: c
20562: . ISO/IEC N2800=08-0310 
20563: 〞 For the part of the lookup using unqualified name lookup (3.4.1), only function declarations with 
20564: external linkage from the template definition context are found. 
20565: 〞 For the part of the lookup using associated namespaces (3.4.2), only function declarations with external 
20566: linkage found in either the template definition context or the template instantiation context are found. 
20567: If the call would be ill-formed or would find a better match had the lookup within the associated namespaces 
20568: considered all the function declarations with external linkage introduced in those namespaces in all transla-
20569: tion units, not just considering those declarations found in the template definition and template instantiation 
20570: contexts, then the program has undefined behavior. 
20571: 14.6.5 Friend names declared within a class template [temp.inject] 
20572: 1 Friend classes or functions can be declared within a class template. When a template is instantiated, the 
20573: names ofits friends are treated as if the specialization had been explicitly declared at its point of instantiation. 
20574: 2 As with non-template classes, the names of namespace-scope friend functions of a class template specializa-
20575: tion are not visible during an ordinary lookup unless explicitly declared at namespace scope (11.4). Such 
20576: names may be found under the rules for associated classes (3.4.2).135 [ Example: 
20577: template<typename T> struct number {
20578: number(int);
20579: friend number gcd(number x, number y) { return 0; };
20580: }; 
20581: void g() {
20582: number<double> a(3), b(4);
20583: a = gcd(a,b); // finds gcd because number<double> is an
20584: // associated class, making gcd visible
20585: // in its namespace (global scope)
20586: b = gcd(3,4); // ill-formed; gcd is not visible
20587: }
20588: 〞end example ] 
20589: 14.7 Template instantiation and specialization [temp.spec] 
20590: 1 The act of instantiating a function, a class, a concept map, a member of a class template or a member 
20591: template is referred to as template instantiation. 
20592: 2 A function instantiated from a function template is called an instantiated function. A class instantiated from 
20593: a class template is called an instantiated class. A concept map instantiated from a concept map template is 
20594: called an instantiated concept map. A member function, a member class, or a static data member of a class 
20595: template instantiated from the member definition of the class template is called, respectively, an instantiated 
20596: member function, member class or static data member. A member function instantiated from a member 
20597: function template is called an instantiated member function. A member class instantiated from a member 
20598: class template is called an instantiated member class. 
20599: 3 An explicit specialization may be declared for a function template, a class template, a member of a class 
20600: template or a member template. An explicit specialization declaration is introduced by template<>. In 
20601: an explicit specialization declaration for a class template, a member of a class template or a class member 
20602: template, the name of the class that is explicitly specialized shall be a simple-template-id. In the explicit 
20603: 135) Friend declarations do not introduce new names into any scope, either when the template is declared or when it is 
20604: instantiated. 
20605: ∫ 14.7 354 
20606: 
20607: c
20608: . ISO/IEC N2800=08-0310 
20609: specialization declaration for a function template or a member function template, the name of the function 
20610: or member function explicitly specialized may be a template-id.[ Example: 
20611: template<class T = int> struct A { 
20612: static int x;
20613: };
20614: template<class U> void g(U) { }
20615: template<> struct A<double> { };
20616: template<> struct A<> { };
20617: template<> void g(char) { }
20618: template<> void g<int>(int) { }
20619: template<> int A<char>::x = 0;
20620: // specialize for T == double 
20621: // specialize for T == int 
20622: // specialize for U == char 
20623: // U is deduced from the parameter type 
20624: // specialize for U == int 
20625: // specialize for T == char 
20626: template<class T = int> struct B { 
20627: static int x;
20628: };
20629: template<> int B<>::x = 1; // specialize for T == int
20630: 〞end example ] 
20631: 4 An instantiated template specialization can be either implicitly instantiated (14.7.1) for a given argument 
20632: list or be explicitly instantiated (14.7.2). A specialization is a class, function, or class member that is either 
20633: instantiated or explicitly specialized (14.7.3). 
20634: 5 For a given template and a given set of template-arguments, 
20635: 〞 an explicit instantiation definition shall appear at most once in a program, 
20636: 〞 an explicit specialization shall be defined at most once in a program (according to 3.2), and 
20637: 〞 both an explicit instantiation and a declaration of an explicit specialization shall not appear in a 
20638: program unless the explicit instantiation follows a declaration of the explicit specialization. 
20639: An implementation is not required to diagnose a violation of this rule. 
20640: 6 Each class template specialization instantiated from a template has its own copy of any static members. 
20641: [ Example: 
20642: template<class T> class X { 
20643: static T s;
20644: };
20645: template<class T> T X<T>::s = 0;
20646: X<int> aa;
20647: X<char*> bb;
20648: X<int> has a static member s of type int and X<char*> has a static member s of type char*. 〞end 
20649: example ] 
20650: 14.7.1 Implicit instantiation [temp.inst] 
20651: 1 Unless a class template specialization has been explicitlyinstantiated (14.7.2) or explicitly specialized (14.7.3), 
20652: the class template specialization is implicitly instantiated when the specialization is referenced in a context 
20653: that requires a completely-defined object type or when the completeness of the class type affects the se-
20654: mantics of the program. The implicit instantiation of a class template specialization causes the implicit 
20655: ∫ 14.7.1 355 
20656: 
20657: c
20658: . ISO/IEC N2800=08-0310 
20659: instantiation of the declarations, but not of the definitions or default arguments, of the class member func-
20660: tions, member classes, static data members and member templates; and it causes the implicit instantiation 
20661: of the definitions of member anonymous unions. Unless a member of a class template or a member template 
20662: has been explicitly instantiated or explicitly specialized, the specialization of the member is implicitly in-
20663: stantiated when the specialization is referenced in a context that requires the member definition to exist; in 
20664: particular, the initialization (and any associated side-effects) of a static data member does not occur unless 
20665: the static data member is itself used in a way that requires the definition of the static data member to exist. 
20666: 2 Unless a function template specialization has been explicitly instantiated or explicitly specialized, the func-
20667: tion template specialization is implicitly instantiated when the specialization is referenced in a context that 
20668: requires a function definition to exist. Unless a call is to a function template explicit specialization or to a 
20669: member function of an explicitly specialized class template, a default argument for a function template or a 
20670: member function of a class template is implicitly instantiated when the function is called in a context that 
20671: requires the value of the default argument. 
20672: 3 [ Example: 
20673: template<class T> struct Z {
20674: void f();
20675: void g();
20676: }; 
20677: void h() {
20678: Z<int> a; // instantiation of class Z<int> required
20679: Z<char>* p; // instantiation of class Z<char> not required
20680: Z<double>* q; // instantiation of class Z<double> not required
20681: a.f(); // instantiation of Z<int>::f() required
20682: p->g(); // instantiation of class Z<char> required, and
20683: // instantiation of Z<char>::g() required
20684: }
20685: Nothing in this example requires class Z<double>, Z<int>::g(), or Z<char>::f() to be implicitly instan-
20686: tiated. 〞end example ] 
20687: 4 A class template specialization is implicitly instantiated if the class type is used in a context that requires 
20688: a completely-defined object type or if the completeness of the class type might affect the semantics of the 
20689: program. [ Note: in particular, if the semantics of an expression depend on the member or base class lists 
20690: of a class template specialization, the class template specialization is implicitly generated. For instance, 
20691: deleting a pointer to class type depends on whether or not the class declares a destructor, and conversion 
20692: between pointer to class types depends on the inheritance relationship between the two classes involved. 
20693: 〞end note ][ Example: 
20694: template<class T> class B { /. ...  / };
20695: template<class T> class D : public B<T> { /. ...  / };
20696: void f(void*);
20697: void f(B<int>*);
20698: void g(D<int>* p, D<char>* pp, D<double>* ppp) {
20699: f(p); // instantiation of D<int> required: call f(B<int>*)
20700: B<char>* q = pp; // instantiation of D<char> required:
20701: // convert D<char>* to B<char>*
20702: delete ppp; // instantiation of D<double> required
20703: }
20704: ∫ 14.7.1 356 
20705: 
20706: c
20707: . ISO/IEC N2800=08-0310 
20708: 〞end example ] 
20709: 5 If the overload resolution process can determine the correct function to call without instantiating a class 
20710: template definition or concept map template definition, it is unspecified whether that instantiation actually 
20711: takes place. [ Example: 
20712: template <class T> struct S {
20713: operator int();
20714: };
20715: void f(int);
20716: void f(S<int>&);
20717: void f(S<float>);
20718: void g(S<int>& sr) {
20719: f(sr); // instantiation of S<int> allowed but not required
20720: // instantiation of S<float> allowed but not required
20721: };
20722: 〞end example ] 
20723: 6 If an implicit instantiation of a class template specialization is required and the template is declared but not 
20724: defined, the program is ill-formed. [ Example: 
20725: template<class T> class X; 
20726: X<char> ch; // error: definition of X required 
20727: 〞end example ] 
20728: 7 The implicit instantiation of a class template does not cause any static data members of that class to be 
20729: implicitly instantiated. 
20730: 8 If a function template or a member function template specialization is used in a way that involves overload 
20731: resolution, a declaration of the specialization is implicitly instantiated (14.8.3). 
20732: 9 An implementation shall not implicitly instantiate a function template, a member template, a non-virtual 
20733: member function, a concept map template, a member class, or a static data member of a class template 
20734: that does not require instantiation. It is unspecified whether or not an implementation implicitly instanti-
20735: ates a virtual member function of a class template if the virtual member function would not otherwise be 
20736: instantiated. The use of a template specialization in a default argument shall not cause the template to be 
20737: implicitly instantiated except that a class template may be instantiated where its complete type is needed to 
20738: determine the correctness of the default argument. The use of a default argument in a function call causes 
20739: specializations in the default argument to be implicitly instantiated. 
20740: 10 Implicitly instantiated class, concept map, and function template specializations are placed in the namespace 
20741: where the template is defined. Implicitly instantiated specializations for members of a class template are 
20742: placed in the namespace where the enclosing class template is defined. Implicitly instantiated member 
20743: templates are placed in the namespace where the enclosing class or class template is defined. [ Example: 
20744: namespace N {
20745: template<class T> class List {
20746: public:
20747: T* get();
20748: };
20749: }
20750: ∫ 14.7.1 357 
20751: 
20752: c
20753: . ISO/IEC N2800=08-0310 
20754: template<class K, class V> class Map {
20755: N::List<V> lt;
20756: V get(K);
20757: }; 
20758: void g(Map<char*,int>& m) {
20759: int i = m.get("Nicholas");
20760: }
20761: a call of lt.get() from Map<char*,int>::get() would place List<int>::get() in the namespace N rather 
20762: than in the global namespace. 〞end example ] 
20763: 11 If a function template f is called in a way that requires a default argument expression to be used, the 
20764: dependent names are looked up, the semantics constraints are checked, and the instantiation of any template 
20765: used in the default argument expression is done as if the default argument expression had been an expression 
20766: used in a function template specialization with the same scope, the same template parameters and the same 
20767: access as that of the function template f used at that point. This analysis is called default argument 
20768: instantiation. The instantiated default argument is then used as the argument of f. 
20769: 12 Each default argument is instantiated independently. [ Example: 
20770: template<class T> void f(T x, T y = ydef(T()), T z = zdef(T())); 
20771: class A { }; 
20772: A zdef(A); 
20773: void g(A a, A b, A c) {
20774: f(a, b, c); // no default argument instantiation
20775: f(a, b); // default argument z = zdef(T()) instantiated
20776: f(a); // ill-formed; ydef is not declared
20777: } 
20778: 〞end example ] 
20779: 13 [ Note: 14.6.4.1 defines the point of instantiation of a template specialization. 〞end note ] 
20780: 14 There is an implementation-defined quantity that specifies the limit on the total depth of recursive instan-
20781: tiations, which could involve more than one template. The result of an infinite recursion in instantiation is 
20782: undefined. [ Example: 
20783: template<class T> class X {
20784: X<T>* p; // OK
20785: X<T*> a; // implicit generation of X<T> requires
20786: // the implicit instantiation of X<T*> which requires
20787: // the implicit instantiation of X<T**> which ...
20788: };
20789: 〞end example ] 
20790: 15 If no concept map exists for a given concept instance, and there exists a concept map template that matches 
20791: the concept instance, the concept map is implicitly instantiated when the concept map is referenced in a 
20792: ∫ 14.7.1 358 
20793: 
20794: c
20795: . ISO/IEC N2800=08-0310 
20796: context that requires the concept map definition, either to satisfy a concept requirement (14.10.1) or when 
20797: the nested-name-specifier of a qualified-id references a concept instance (3.4.3.3). 
20798: 14.7.2 Explicit instantiation [temp.explicit] 
20799: 1 A class, a function or member template specialization can be explicitly instantiated from its template. A 
20800: member function, member class or static data member of a class template can be explicitly instantiated from 
20801: the member definition associated with its class template. An explicit instantiation of a function template 
20802: shall not use the inline or constexpr specifiers. 
20803: 2 The syntax for explicit instantiation is: 
20804: explicit-instantiation:
20805: externopt template declaration
20806: There are two forms of explicit instantiation: an explicit instantiation definition and an explicit instantiation 
20807: declaration. An explicit instantiation declaration begins with the extern keyword. 
20808: If the explicit instantiation is for a class or member class, the elaborated-type-specifier in the declaration shall 
20809: include a simple-template-id. If the explicit instantiation is for a function or member function, the unqualified-
20810: id in the declaration shall be either a template-id or, where all template arguments can be deduced, a 
20811: template-name or operator-function-id.[ Note: the declaration may declare a qualified-id, in which case the 
20812: unqualified-id of the qualified-id must be a template-id. 〞end note ] If the explicit instantiation is for a 
20813: member function, a member class or a static data member of a class template specialization, the name of 
20814: the class template specialization in the qualified-id for the member name shall be a simple-template-id. An 
20815: explicit instantiation shall appear in an enclosing namespace of its template. If the name declared in the 
20816: explicit instantiation is an unqualified name, the explicit instantiation shall appear in the namespace where 
20817: its template is declared or, if that namespace is inline (7.3.1), any namespace from its enclosing namespace 
20818: set. [ Note: regarding qualified names in declarators, see 8.3. 〞 end note ][ Example: 
20819: template<class T> class Array { void mf(); };
20820: template class Array<char>;
20821: template void Array<int>::mf();
20822: template<class T> void sort(Array<T>& v) { /. ...  / }
20823: template void sort(Array<char>&); // argument is deduced here
20824: namespace N { 
20825: template<class T> void f(T&) { }
20826: }
20827: template void N::f<int>(int&);
20828: 〞end example ] 
20829: 3 A declaration of a function template shall be in scope at the point of the explicit instantiation of the function 
20830: template. A definition of the class or class template containing a member function template shall be in scope 
20831: at the point of the explicit instantiation of the member function template. A definition of a class template 
20832: or class member template shall be in scope at the point of the explicit instantiation of the class template 
20833: or class member template. A definition of a class template shall be in scope at the point of an explicit 
20834: instantiation of a member function or a static data member of the class template. A definition of a member 
20835: class of a class template shall be in scope at the point of an explicit instantiation of the member class. If the 
20836: declaration of the explicit instantiation names an implicitly-declared special member function (Clause 12), 
20837: the program is ill-formed. 
20838: 4 For a given set of template parameters, if an explicit instantiation of a template appears after a declaration 
20839: of an explicit specialization for that template, the explicit instantiation has no effect. Otherwise, for an 
20840: ∫ 14.7.2 359 
20841: 
20842: c
20843: . ISO/IEC N2800=08-0310 
20844: explicit instantiation definition the definition of a non-exported function template, a non-exported member 
20845: function template, or a non-exported member function or static data member of a class template shall be 
20846: present in every translation unit in which it is explicitly instantiated. 
20847: 5 An explicit instantiation of a class or function template specialization is placed in the namespace in which 
20848: the template is defined. An explicit instantiation for a member of a class template is placed in the namespace 
20849: where the enclosing class template is defined. An explicit instantiation for a member template is placed in 
20850: the namespace where the enclosing class or class template is defined. [ Example: 
20851: namespace N {
20852: template<class T> class Y { void mf() { } };
20853: }
20854: template class Y<int>;
20855: using N::Y; 
20856: template class Y<int>;
20857: template class N::Y<char*>;
20858: template void N::Y<double>::mf();
20859: 〞end example ] 
20860: // error: class template Y not visible 
20861: // in the global namespace 
20862: // OK: explicit instantiation in namespace N 
20863: // OK: explicit instantiation in namespace N 
20864: // OK: explicit instantiation 
20865: // in namespace N 
20866: 6 A trailing template-argument can be left unspecified in an explicit instantiation of a function template 
20867: specialization or of a member function template specialization provided it can be deduced from the type of 
20868: a function parameter (14.8.2). [ Example: 
20869: template<class T> class Array { /. ...  / };
20870: template<class T> void sort(Array<T>& v);
20871: // instantiate sort(Array<int>&) -template-argument deduced
20872: template void sort<>(Array<int>&);
20873: 〞end example ] 
20874: 7 An explicit instantiation that names a class template specialization is an explicit instantion of the same kind 
20875: (declaration or definition) of each of its members (not including members inherited from base classes) that 
20876: has not been previously explicitly specialized in the translation unit containing the explicit instantiation, 
20877: except as described below. 
20878: 8 An explicit instantiation definition that names a class template specialization explicitly instantiates the class 
20879: template specialization and is only an explicit instantiation definition of members whose definition is visible 
20880: at the point of instantiation. 
20881: 9 An explicit instantiation declaration that names a class template specialization has no effect on the class 
20882: template specialization itself (except for perhaps resulting in its implicit instantiation). Except for inline 
20883: functions, other explicit instantiation declarations have the effect of suppressing the implicit instantiation of 
20884: the entity to which they refer. [ Note: The intent is that an inline function that is the subject of an explicit 
20885: instantiation declaration will still be implicitly instantiated when used so that the body can be considered for 
20886: inlining, but that no out-of-line copy of the inline function would be generated in the translation unit. 〞end 
20887: note ] 
20888: 10 If an entity is the subject of both an explicit instantiation declaration and an explicit instantiation definition 
20889: in the same translation unit, the definition shall follow the declaration. An entity that is the subject of 
20890: ∫ 14.7.2 360 
20891: 
20892: c
20893: . ISO/IEC N2800=08-0310 
20894: an explicit instantiation declaration and that is also used in the translation unit shall be the subject of an 
20895: explicit instantiation definition somewhere in the program; otherwise the program is ill-formed, no diagnostic 
20896: required. [ Note: This rule does apply to inline functions even though an explicit instantiation declaration 
20897: of such an entity has no other normative effect. This is needed to ensure that if the address of an inline 
20898: function is taken in a translation unit in which the implementation chose to suppress the out-of-line body, 
20899: another translation unit will supply the body. 〞end note ] An explicit instantiation declaration shall not 
20900: name a specialization of a template with internal linkage. 
20901: 11 The usual access checking rules do not apply to names used to specify explicit instantiations. [ Note: In 
20902: particular, the template arguments and names used in the function declarator (including parameter types, 
20903: return types and exception specifications) may be private types or objects which would normally not be 
20904: accessible and the template may be a member template or member function which would not normally be 
20905: accessible. 〞end note ] 
20906: 12 An explicit instantiation does not constitute a use of a default argument, so default argument instantiation 
20907: is not done. [ Example: 
20908: char* p = 0;
20909: template<class T> T g(T = &p);
20910: template int g<int>(int); // OK even though &p isn＊t an int.
20911: 〞end example ] 
20912: 14.7.3 Explicit specialization [temp.expl.spec] 
20913: 1 An explicit specialization of any of the following: 
20914: 〞 non-deleted function template 
20915: 〞 class template 
20916: 〞 non-deleted member function of a class template 
20917: 〞 static data member of a class template 
20918: 〞 member class of a class template 
20919: 〞 member class template of a class template 
20920: 〞 non-deleted member function template of a class template
20921: can be declared by a declaration introduced by template<>; that is:
20922: explicit-specialization:
20923: template < > declaration
20924: [ Example: 
20925: template<class T> class stream; 
20926: template<> class stream<char> { /. ...  / }; 
20927: template<class T> class Array { /. ...  / };
20928: template<class T> void sort(Array<T>& v) { /. ...  / }
20929: template<> void sort<char*>(Array<char*>&) ; 
20930: Given these declarations, stream<char> will be used as the definition of streams of chars; other streams will 
20931: be handled by class template specializations instantiated from the class template. Similarly, sort<char*> 
20932: ∫ 14.7.3 361 
20933: 
20934: c
20935: . ISO/IEC N2800=08-0310 
20936: will be used as the sort function for arguments of type Array<char*>; other Array types will be sorted by 
20937: functions generated from the template. 〞end example ] 
20938: 2 An explicit specialization shall be declared in the nearest enclosing namespace of the template, or, if the 
20939: namespace is inline (7.3.1), any namespace from its enclosing namespace set. Such a declaration may also 
20940: be a definition. If the declaration is not a definition, the specialization may be defined later (7.3.1.2). 
20941: 3 A declaration of a function template or class template being explicitly specialized shall be in scope at the 
20942: point of declaration of an explicit specialization. [ Note: a declaration, but not a definition of the template is 
20943: required. 〞 end note ] The definition of a class or class template shall be in scope at the point of declaration 
20944: of an explicit specialization for a member template of the class or class template. [ Example: 
20945: template<> class X<int> { /. ...  / }; // error: X not a template 
20946: template<class T> class X; 
20947: template<> class X<char*> { /. ...  / }; // OK: X is a template 
20948: 〞end example ] 
20949: 4 A member function, a member class or a static data member of a class template may be explicitly specialized 
20950: for a class specialization that is implicitly instantiated; in this case, the definition of the class template shall 
20951: be in scope at the point of declaration of the explicit specialization for the member of the class template. 
20952: If such an explicit specialization for the member of a class template names an implicitly-declared special 
20953: member function (Clause 12), the program is ill-formed. 
20954: 5 A member of an explicitly specialized class is not implicitly instantiated from the member declaration of 
20955: the class template; instead, the member of the class template specialization shall itself be explicitly defined. 
20956: In this case, the definition of the class template explicit specialization shall be in scope at the point of 
20957: declaration of the explicit specialization of the member. The definition of an explicitly specialized class is 
20958: unrelated to the definition of a generated specialization. That is, its members need not have the same names, 
20959: types, etc. as the members of a generated specialization. Definitions of members of an explicitly specialized 
20960: class are defined in the same manner as members of normal classes, and not using the syntax for explicit 
20961: specialization. [ Example: 
20962: template<class T> struct A {
20963: void f(T) { /. ...  / }
20964: }; 
20965: template<> struct A<int> {
20966: void f(int);
20967: }; 
20968: void h() {
20969: A<int> a;
20970: a.f(16); // A<int>::f must be defined somewhere
20971: } 
20972: // explicit specialization syntax not used for a member of
20973: // explicitly specialized class template specialization
20974: void A<int>::f(int) { /. ...  / }
20975: 〞end example ] 
20976: 6 If a template, a member template or the member of a class template is explicitly specialized then that 
20977: specialization shall be declared before the first use of that specialization that would cause an implicit instan-
20978: ∫ 14.7.3 362 
20979: 
20980: c
20981: . ISO/IEC N2800=08-0310 
20982: tiation to take place, in every translation unit in which such a use occurs; no diagnostic is required. If the 
20983: program does not provide a definition for an explicit specialization and either the specialization is used in a 
20984: way that would cause an implicit instantiation to take place or the member is a virtual member function, 
20985: the program is ill-formed, no diagnostic required. An implicit instantiation is never generated for an explicit 
20986: specialization that is declared but not defined. [ Example: 
20987: template<class T> class Array { /. ...  / };
20988: template<class T> void sort(Array<T>& v) { /. ...  / }
20989: void f(Array<String>& v) {
20990: sort(v); // use primary template
20991: // sort(Array<T>&), T is String
20992: }
20993: template<> void sort<String>(Array<String>& v); // error: specialization
20994: // after use of primary template
20995: template<> void sort<>(Array<char*>& v); // OK: sort<char*> not yet used
20996: 〞end example ] 
20997: 7 The placement of explicit specialization declarations for function templates, class templates, member func-
20998: tions of class templates, static data members of class templates, member classes of class templates, member 
20999: class templates of class templates, member function templates of class templates, member functions of mem-
21000: ber templates of class templates, member functions of member templates of non-template classes, member 
21001: function templates of member classes of class templates, etc., and the placement of partial specialization 
21002: declarations of class templates, member class templates of non-template classes, member class templates of 
21003: class templates, etc., can affect whether a program is well-formed according to the relative positioning of 
21004: the explicit specialization declarations and their points of instantiation in the translation unit as specified 
21005: above and below. When writing a specialization, be careful about its location; or to make it compile will be 
21006: such a trial as to kindle its self-immolation. 
21007: 8 When a specialization for which an explicit specialization exists is used within the instantiation of an exported 
21008: template, and the unspecialized template name is non-dependent in the exported template, a declaration of 
21009: the explicit specialization shall be declared before the definition of the exported template, in the translation 
21010: unit containing that definition. [ Example: 
21011: // file #1 
21012: #include <vector>
21013: // Primary class template vector
21014: export template<class T> void f(t) {
21015: std::vector<T> vec; // should match the specialization
21016: ...  /
21017: /. 
21018: } 
21019: // file #2 
21020: #include <vector>
21021: class B { };
21022: // Explicit specialization of vector for vector<B>
21023: namespace std {
21024: template<> class vector<B> { /. ...  / };
21025: }
21026: template<class T> void f(T);
21027: void g(B b) {
21028: f(b); // ill-formed:
21029: // f<B> should refer to vector<B>, but the
21030: ∫ 14.7.3 363 
21031: 
21032: . ISO/IEC N2800=08-0310 
21033: // specialization was not declared with the
21034: // definition of f in file #1
21035: }
21036: 〞end example ] 
21037: 9 A template explicit specialization is in the scope of the namespace in which the template was defined. 
21038: [ Example: 
21039: namespace N {
21040: template<class T> class X { /. ...  / };
21041: template<class T> class Y { /. ...  / };
21042: template<> class X<int> { /. ...  / }; // OK: specialization
21043: // in same namespace
21044: template<> class Y<double>; // forward declare intent to
21045: // specialize for double
21046: }
21047: template<> class N::Y<double> { /. ...  / }; // OK: specialization
21048: // in same namespace
21049: 〞end example ] 
21050: 10 A simple-template-id that names a class template explicit specialization that has been declared but not 
21051: defined can be used exactly like the names of other incompletely-defined classes (3.9). [ Example: 
21052: template<class T> class X; // X is a class template
21053: template<> class X<int>;
21054: X<int>* p; // OK: pointer to declared class X<int>
21055: X<int> x; // error: object of incomplete class X<int>
21056: 〞end example ] 
21057: 11 A trailing template-argument can be left unspecified in the template-id naming an explicit function template 
21058: specialization provided it can be deduced from the function argument type. [ Example: 
21059: template<class T> class Array { /. ...  / };
21060: template<class T> void sort(Array<T>& v);
21061: // explicit specialization for sort(Array<int>&)
21062: // with deduced template-argument of type int
21063: template<> void sort(Array<int>&);
21064: 〞end example ] 
21065: 12 [ Note: This paragraph is intentionally empty. 〞 end note ] 
21066: 13 A function with the same name as a template and a type that exactly matches that of a template special-
21067: ization is not an explicit specialization (14.5.6). 
21068: 14 An explicit specialization of a function template is inline only if it is explicitly declared to be, and indepen-
21069: dently of whether its function template is. [ Example: 
21070: template<class T> void f(T) { /. ...  / }
21071: template<class T> inline T g(T) { /. ...  / }
21072: ∫ 14.7.3 364 
21073: 
21074: c
21075: . ISO/IEC N2800=08-0310 
21076: template<> inline void f<>(int) { /. ...  / } // OK: inline
21077: template<> int g<>(int) { /. ...  / } // OK: not inline
21078: 〞end example ] 
21079: 15 An explicit specialization of a static data member of a template is a definition if the declaration includes an 
21080: initializer; otherwise, it is a declaration. [ Note: there is no syntax for the definition of a static data member 
21081: of a template that requires default initialization. 
21082: template<> X Q<int>::x; 
21083: 16 This is a declaration regardless of whether X can be default initialized (8.5). 〞end note ] 
21084: 17 A member or a member template of a class template may be explicitly specialized for a given implicit 
21085: instantiation of the class template, even if the member or member template is defined in the class template 
21086: definition. An explicit specialization of a member or member template is specified using the syntax for 
21087: explicit specialization. [ Example: 
21088: template<class T> struct A {
21089: void f(T);
21090: template<class X1> void g1(T, X1);
21091: template<class X2> void g2(T, X2);
21092: void h(T) { }
21093: }; 
21094: // specialization 
21095: template<> void A<int>::f(int); 
21096: // out of class member template definition 
21097: template<class T> template<class X1> void A<T>::g1(T, X1) { } 
21098: // member template specialization 
21099: template<> template<class X1> void A<int>::g1(int, X1); 
21100: //member template specialization 
21101: template<> template<>
21102: void A<int>::g1(int, char); // X1 deduced as char
21103: template<> template<>
21104: void A<int>::g2<char>(int, char); // X2 specified as char
21105: // member specialization even if defined in class definition 
21106: template<> void A<int>::h(int) { } 
21107: 〞end example ] 
21108: 18 A member or a member template may be nested within many enclosing class templates. In an explicit 
21109: specialization for such a member, the member declaration shall be preceded by a template<> for each 
21110: enclosing class template that is explicitly specialized. [ Example: 
21111: template<class T1> class A {
21112: template<class T2> class B {
21113: void mf();
21114: };
21115: };
21116: template<> template<> class A<int>::B<double>;
21117: template<> template<> void A<char>::B<char>::mf();
21118: ∫ 14.7.3 365 
21119: 
21120: c
21121: . ISO/IEC N2800=08-0310 
21122: 〞end example ] 
21123: 19 In an explicit specialization declaration for a member of a class template or a member template that ap-
21124: pears in namespace scope, the member template and some of its enclosing class templates may remain 
21125: unspecialized, except that the declaration shall not explicitly specialize a class member template if its en-
21126: closing class templates are not explicitly specialized as well. In such explicit specialization declaration, the 
21127: keyword template followed by a template-parameter-list shall be provided instead of the template<> pre-
21128: ceding the explicit specialization declaration of the member. The types of the template-parameters in the 
21129: template-parameter-list shall be the same as those specified in the primary template definition. [ Example: 
21130: template <class T1> class A { 
21131: template<class T2> class B {
21132: template<class T3> void mf1(T3);
21133: void mf2();
21134: };
21135: };
21136: template <> template <class X>
21137: class A<int>::B {
21138: template <class T> void mf1(T);
21139: };
21140: template <> template <> template<class T>
21141: void A<int>::B<double>::mf1(T t) { }
21142: template <class Y> template <>
21143: void A<Y>::B<double>::mf2() { } // ill-formed; B<double> is specialized but
21144: // its enclosing class template A is not
21145: 〞end example ] 
21146: 20 A specialization of a member function template or member class template of a non-specialized class template 
21147: is itself a template. 
21148: 21 An explicit specialization declaration shall not be a friend declaration. 
21149: 22 Default function arguments shall not be specified in a declaration or a definition for one of the following 
21150: explicit specializations: 
21151: 〞 the explicit specialization of a function template; 
21152: 〞 the explicit specialization of a member function template; 
21153: 〞 the explicit specialization of a member function of a class template where the class template special-
21154: ization to which the member function specialization belongs is implicitly instantiated. [ Note: default 
21155: function arguments may be specified in the declaration or definition of a member function of a class 
21156: template specialization that is explicitly specialized. 〞end note ] 
21157: 23 [ Note: The template arguments provided for an explicit specialization shall satisfy the template requirements 
21158: of the primary template (14.5.5.1). [ Example: 
21159: concept C<typename T> { }
21160: concept_map C<float> { }
21161: template<typename T> requires C<T> void f(T); 
21162: template<> void f<float>(float);// OK: concept_map C<float> satisfies requirement 
21163: template<> void f<int>(int); // ill-formed: no concept map satisfies the requirement for C<int> 
21164: 〞end example ] 〞end note ] 
21165: ∫ 14.7.3 366 
21166: 
21167: c
21168: . ISO/IEC N2800=08-0310 
21169: 14.8 Function template specializations [temp.fct.spec] 
21170: 1 A function instantiated from a function template is called a function template specialization; so is an 
21171: explicit specialization of a function template. Template arguments can be explicitly specified when naming 
21172: the function template specialization, deduced from the context (e.g., deduced from the function arguments 
21173: in a call to the function template specialization, see 14.8.2), or obtained from default template arguments. 
21174: 2 Each function template specialization instantiated from a template has its own copy of any static variable. 
21175: [ Example: 
21176: template<class T> void f(T* p) {
21177: static T s;
21178: };
21179: void g(int a, char* b) {
21180: f(&a); // calls f<int>(int*)
21181: f(&b); // calls f<char*>(char**)
21182: } 
21183: Here f<int>(int*) has a static variable s of type int and f<char*>(char**) has a static variable s of 
21184: type char*. 〞end example ] 
21185: 14.8.1 Explicit template argument specification [temp.arg.explicit] 
21186: 1 Template arguments can be specified when referring to a function template specialization by qualifying the 
21187: function template name with the list of template-arguments in the same way as template-arguments are 
21188: specified in uses of a class template specialization. [ Example: 
21189: template<class T> void sort(Array<T>& v); 
21190: void f(Array<dcomplex>& cv, Array<int>& ci) {
21191: sort<dcomplex>(cv); // sort(Array<dcomplex>&)
21192: sort<int>(ci); // sort(Array<int>&)
21193: } 
21194: and 
21195: template<class U, class V> U convert(V v); 
21196: void g(double d) {
21197: int i = convert<int,double>(d); // int convert(double)
21198: char c = convert<char,double>(d); // char convert(double)
21199: } 
21200: 〞end example ] 
21201: 2 A template argument list may be specified when referring to a specialization of a function template 
21202: 〞 when a function is called, 
21203: 〞 when the address of a function is taken, when a function initializes a reference to function, or when a 
21204: pointer to member function is formed, 
21205: 〞 in an explicit specialization, 
21206: 〞 in an explicit instantiation, or 
21207: 〞 in a friend declaration. 
21208: ∫ 14.8.1 367 
21209: 
21210: c
21211: . ISO/IEC N2800=08-0310 
21212: 3 Trailing template arguments that can be deduced (14.8.2) or obtained from default template-arguments may 
21213: be omitted from the list of explicit template-arguments. A trailing template parameter pack not otherwise 
21214: deduced will be deduced to an empty sequence of template arguments. If all of the template arguments 
21215: can be deduced, they may all be omitted; in this case, the empty template argument list <> itself may also 
21216: be omitted. In contexts where deduction is done and fails, or in contexts where deduction is not done, if 
21217: a template argument list is specified and it, along with any default template arguments, identifies a single 
21218: function template specialization, then the template-id is an lvalue for the function template specialization. 
21219: [ Example: 
21220: template<class X, class Y> X f(Y);
21221: template<class X, class Y, class ... Z> X g(Y);
21222: void h() {
21223: int i = f<int>(5.6); // Y is deduced to be double; Z is deduced to be an empty sequence 
21224: int j = f(5.6); // ill-formed: X cannot be deduced 
21225: f<void>(f<int, bool>); // Y for outer f deduced to be 
21226: // int (*)(bool); Z is deduced to be an empty sequence
21227: f<void>(f<int>); // ill-formed: f<int> does not denote a
21228: // single function template specialization 
21229: int k = g<int>(5.6); // Y is deduced to be double, Z is deduced to an empty sequence 
21230: f<void>(g<int, bool>); // Y for outer f is deduced to be 
21231: // int (*)(bool), Z is deduced to an empty sequence
21232: }
21233: 〞end example ] 
21234: 4 [ Note: An empty template argument list can be used to indicate that a given use refers to a specialization 
21235: of a function template even when a normal (i.e., non-template) function is visible that would otherwise be 
21236: used. For example: 
21237: template <class T> int f(T); // #1
21238: int f(int); // #2
21239: int k = f(1); // uses #2
21240: int l = f<>(1); // uses #1
21241: 〞end note ] 
21242: 5 Template arguments that are present shall be specified in the declaration order of their corresponding 
21243: template-parameters. The template argument list shall not specify more template-arguments than there 
21244: are corresponding template-parameters unless one of the template-parameters is a template parameter pack. 
21245: [ Example: 
21246: template<class X, class Y, class Z> X f(Y,Z);
21247: template<class ... Args> void f2();
21248: void g() {
21249: f<int,char*,double>("aa",3.0);
21250: f<int,char*>("aa",3.0); // Z is deduced to be double
21251: f<int>("aa",3.0); // Y is deduced to be const char*, and
21252: // Z is deduced to be double
21253: f("aa",3.0); // error: X cannot be deduced
21254: f2<char, short, int, long>(); // OK
21255: } 
21256: 〞end example ] 
21257: 6 Implicit conversions (Clause 4) will be performed on a function argument to convert it to the type of the 
21258: corresponding function parameter if the parameter type contains no template-parameters that participate 
21259: ∫ 14.8.1 368 
21260: 
21261: c
21262: . ISO/IEC N2800=08-0310 
21263: in template argument deduction. [ Note: template parameters do not participate in template argument 
21264: deduction if they are explicitly specified. For example, 
21265: template<class T> void f(T); 
21266: class Complex { 
21267: Complex(double);
21268: };
21269: void g() { 
21270: f<Complex>(1); // OK, means f<Complex>(Complex(1))
21271: }
21272: 〞end note ] 
21273: 7 [ Note: because the explicit template argument list follows the function template name, and because con-
21274: version member function templates and constructor member function templates are called without using a 
21275: function name, there is no way to provide an explicit template argument list for these function templates. 
21276: 〞end note ] 
21277: 8 [ Note: For simple function names, argument dependent lookup (3.4.2) applies even when the function name 
21278: is not visible within the scope of the call. This is because the call still has the syntactic form of a function 
21279: call (3.4.1). But when a function template with explicit template arguments is used, the call does not have 
21280: the correct syntactic form unless there is a function template with that name visible at the point of the call. 
21281: If no such name is visible, the call is not syntactically well-formed and argument-dependent lookup does not 
21282: apply. If some such name is visible, argument dependent lookup applies and additional function templates 
21283: may be found in other namespaces. [ Example: 
21284: namespace A { 
21285: struct B { }; 
21286: template<int X> void f(B); 
21287: }
21288: namespace C {
21289: template<class T> void f(T t);
21290: }
21291: void g(A::B b) {
21292: f<3>(b); // ill-formed: not a function call 
21293: A::f<3>(b); // well-formed 
21294: C::f<3>(b); // ill-formed; argument dependent lookup 
21295: // applies only to unqualified names 
21296: using C::f;
21297: f<3>(b); // well-formed because C::f is visible; then
21298: // A::f is found by argument dependent lookup
21299: }
21300: 〞end example ] 〞end note ] 
21301: 9 Template argument deduction can extend the sequence of template arguments corresponding to a template 
21302: parameter pack, even when the sequence contains explicitly specified template arguments. [ Example: 
21303: template<class ... Types> void f(Types ... values); 
21304: void g() { 
21305: f<int*, float*>(0, 0, 0); // Types is deduced to the sequence int*, float*, int
21306: }
21307: 〞end example ] 
21308: ∫ 14.8.1 369 
21309: 
21310: c
21311: . ISO/IEC N2800=08-0310 
21312: 14.8.2 Template argument deduction [temp.deduct] 
21313: 1 When a function template specialization is referenced, all of the template arguments shall have values. 
21314: The values can be explicitly specified or, in some cases, be deduced from the use or obtained from default 
21315: template-arguments. [ Example: 
21316: void f(Array<dcomplex>& cv, Array<int>& ci) {
21317: sort(cv); // calls sort(Array<dcomplex>&)
21318: sort(ci); // calls sort(Array<int>&)
21319: } 
21320: and 
21321: void g(double d) {
21322: int i = convert<int>(d); // calls convert<int,double>(double)
21323: int c = convert<char>(d); // calls convert<char,double>(double)
21324: } 
21325: 〞end example ] 
21326: 2 When an explicit template argument list is specified, the template arguments must be compatible with the 
21327: template parameter list and must result in a valid function type as described below; otherwise type deduc-
21328: tion fails. Specifically, the following steps are performed when evaluating an explicitly specified template 
21329: argument list with respect to a given function template: 
21330: 〞 The specified template arguments must match the template parameters in kind (i.e., type, non-type, 
21331: template). There must not be more arguments than there are parameters unless at least one parameter 
21332: is a template parameter pack, and there shall be an argument for each non-pack parameter. Otherwise, 
21333: type deduction fails. 
21334: 〞 Non-type arguments must match the types of the corresponding non-type template parameters, or must 
21335: be convertible to the types of the corresponding non-type parameters as specified in 14.3.2, otherwise 
21336: type deduction fails. 
21337: 〞 The specified template argument values are substituted for the corresponding template parameters as 
21338: specified below. 
21339: 3 After this substitution is performed, the function parameter type adjustments described in 8.3.5 are per-
21340: formed. [ Example: A parameter type of ※void ()(const int, int[5])§ becomes ※void(*)(int,int*)§. 
21341: 〞end example ][ Note: A top-level qualifier in a function parameter declaration does not affect the function 
21342: type but still affects the type of the function parameter variable within the function. 〞end note ][ Example: 
21343: template <class T> void f(T t);
21344: template <class X> void g(const X x);
21345: template <class Z> void h(Z, Z*);
21346: int main() {
21347: // #1: function type is f(int), t is non const
21348: f<int>(1);
21349: // #2: function type is f(int), t is const
21350: f<const int>(1);
21351: // #3: function type is g(int), x is const
21352: g<int>(1);
21353: // #4: function type is g(int), x is const 
21354: ∫ 14.8.2 370 
21355: 
21356: c
21357: . ISO/IEC N2800=08-0310 
21358: g<const int>(1); 
21359: // #5: function type is h(int, const int*)
21360: h<const int>(1,0);
21361: }
21362: 〞end example ] 
21363: 4 [ Note: f<int>(1) and f<const int>(1) call distinct functions even though both of the functions called 
21364: have the same function type. 〞end note ] 
21365: 5 The resulting substituted and adjusted function type is used as the type of the function template for template 
21366: argument deduction. If a template argument has not been deduced, its default template argument, if any, 
21367: is used. [ Example: 
21368: template <class T, class U = double>
21369: void f(T t = 0, U u = 0);
21370: void g() {
21371: f(1, ＊c＊); // f<int,char>(1,＊c＊)
21372: f(1); // f<int,double>(1,0)
21373: f(); // error: T cannot be deduced
21374: f<int>(); // f<int,double>(0,0)
21375: f<int,char>(); // f<int,char>(0,0)
21376: } 
21377: 〞end example ] 
21378: When all template arguments have been deduced or obtained from default template arguments, all uses 
21379: of template parameters in non-deduced contexts are replaced with the corresponding deduced or default 
21380: argument values. If the substitution results in an invalid type, as described above, type deduction fails. 
21381: 6 At certain points in the template argument deduction process it is is necessary to take a function type 
21382: that makes use of template parameters and replace those template parameters with the corresponding 
21383: template arguments. This is done at the beginning of template argument deduction when any explicitly 
21384: specified template arguments are substituted into the function type, and again at the end of template 
21385: argument deduction when any template arguments that were deduced or obtained from default arguments 
21386: are substituted. 
21387: 7 The substitution occurs in all types and expressions that are used in the function type,in template parameter 
21388: declarations, and in the template requirements (if any) (14.10.1). The expressions include not only constant 
21389: expressions such as those that appear in array bounds or as nontype template arguments but also general 
21390: expressions (i.e., non-constant expressions) inside sizeof, decltype, and other contexts that allow non-
21391: constant expressions. [ Note: The equivalent substitution in exception specifications is done only when the 
21392: function is instantiated, at which point a program is ill-formed if the substitution results in an invalid type 
21393: or expression. 〞end note ] 
21394: 8 If a substitution results in an invalid type or expression or if a substituted template requirement cannot be 
21395: satisfied (14.10.1.1), type deduction fails. An invalid type or expression is one that would be ill-formed if 
21396: written using the substituted arguments. Access checking is not done as part of the substitution process. 
21397: Consequently, when deduction succeeds, an access error could still result when the function is instantiated. 
21398: Only invalid types and expressions in the immediate context of the function type and its template parameter 
21399: types can result in a deduction failure. [ Note: The evaluation of the substituted types and expressions 
21400: can result in side effects such as the instantiation of class template specializations and/or function template 
21401: specializations, the generation of implicitly-defined functions, etc. Such side effects are not in the ※immediate 
21402: context§ and can result in the program being ill-formed. 〞end note ] 
21403: ∫ 14.8.2 371 
21404: 
21405: c
21406: . ISO/IEC N2800=08-0310 
21407: [ Example: 
21408: struct X { };
21409: struct Y {
21410: Y(X){}
21411: };
21412: template <class T> auto f(T t1, T t2) -> decltype(t1 + t2); // #1
21413: X f(Y, Y); // #2
21414: X x1, x2;
21415: X x3 = f(x1, x2); // deduction fails on #1 (cannot add X+X), calls #2
21416: 〞end example ]
21417: [ Note: Type deduction may fail for the following reasons:
21418: 〞 Attempting to instantiate a pack expansion containing multiple parameter packs of differing lengths. 
21419: 〞 Attempting to create an array with an element type that is void, a function type, a reference type, or 
21420: an abstract class type, or attempting to create an array with a size that is zero or negative. [ Example: 
21421: template <class T> int f(T[5]);
21422: int I = f<int>(0);
21423: int j = f<void>(0); // invalid array
21424: 〞end example ] 
21425: 〞 Attempting to use a type that is not a class type in a qualified name. [ Example: 
21426: template <class T> int f(typename T::B*);
21427: int i = f<int>(0);
21428: 〞end example ] 
21429: 〞 Attempting to use a type in a nested-name-specifier of a qualified-id when that type does not contain 
21430: the specified member, or 
21431: 〞 the specified member is not a type where a type is required, or 
21432: 〞 the specified member is not a template where a template is required, or 
21433: 〞 the specified member is not a non-type where a non-type is required.
21434: [ Example:
21435: template <int I> struct X { };
21436: template <template <class T> class> struct Z { };
21437: template <class T> void f(typename T::Y*){}
21438: template <class T> void g(X<T::N>*){}
21439: template <class T> void h(Z<T::template TT>*){}
21440: struct A {};
21441: struct B { int Y; };
21442: struct C {
21443: typedef int N;
21444: };
21445: struct D {
21446: typedef int TT;
21447: };
21448: ∫ 14.8.2 372 
21449: 
21450: c
21451: . ISO/IEC N2800=08-0310 
21452: int main() { 
21453: // Deduction fails in each of these cases:
21454: f<A>(0); // A does not contain a member Y
21455: f<B>(0); // The Y member of B is not a type
21456: g<C>(0); // The N member of C is not a non-type
21457: h<D>(0); // The TT member of D is not a template
21458: } 
21459: 〞end example ] 
21460: 〞 Attempting to create a pointer to reference type. 
21461: 〞 Attempting to create a reference to void. 
21462: 〞 Attempting to create ※pointer to member of T§ when T is not a class type. [ Example: 
21463: template <class T> int f(int T::*);
21464: int i = f<int>(0);
21465: 〞end example ] 
21466: 〞 Attempting to give an invalid type to a non-type template parameter. [ Example: 
21467: template <class T, T> struct S {};
21468: template <class T> int f(S<T, T()>*);
21469: struct X {};
21470: int i0 = f<X>(0);
21471: 〞end example ] 
21472: 〞 Attempting to perform an invalid conversion in either a template argument expression, or an expression 
21473: used in the function declaration. [ Example: 
21474: template <class T, T*> int f(int);
21475: int i2 = f<int,1>(0); // can＊t conv 1 to int*
21476: 〞end example ] 
21477: 〞 Attempting to create a function type in which a parameter has a type of void, or in which the return 
21478: type is a function type or array type. 
21479: 〞 Attempting to use a type in a nested-name-specifier of a qualified-id that refers to a member in a 
21480: concept instance for which concept map lookup (14.10.1.1) does not find a concept map corresponding 
21481: to that concept instance. 
21482: 〞 Attempting to use a class or function template with template arguments that do not satisfy that 
21483: template＊s requirements. [ Example: 
21484: concept C<typename T> { /. ...  / }
21485: template<typename T> requires C<T> class X { /. ...  / };
21486: template<typename T> int f(X<T>*); // #1
21487: template<typename> int f(...); // #2
21488: int i0 = f<int>(0); // OK: calls #2
21489: 〞end example ] 
21490: ∫ 14.8.2 373 
21491: 
21492: c
21493: . ISO/IEC N2800=08-0310 
21494: 〞end note ] 
21495: 9 Except as described above, the use of an invalid value shall not cause type deduction to fail. [ Example: 
21496: In the following example 1000 is converted to signed char and results in an implementation-defined value 
21497: as specified in (4.7). In other words, both templates are considered even though 1000, when converted to 
21498: signed char, results in an implementation-defined value. 
21499: template <int> int f(int);
21500: template <signed char> int f(int);
21501: int i1 = f<1>(0); // ambiguous
21502: int i2 = f<1000>(0); // ambiguous
21503: 〞end example ] 
21504: 14.8.2.1 Deducing template arguments from a function call [temp.deduct.call] 
21505: 1 Template argument deduction is done by comparing each function template parameter type (call it P) with 
21506: the type of the corresponding argument of the call (call it A) as described below. If removing references 
21507: and cv-qualifiers from P gives std::initializer_list<P 0> for some P . and the argument is an initializer 
21508: list (8.5.4), then deduction is performed instead for each element of the initializer list, taking P . as a function 
21509: template parameter type and the initializer element as its argument. Otherwise, an initializer list argument 
21510: causes the parameter to be considered a non-deduced context (14.8.2.5). [ Example: 
21511: template<class T> void f(std::initializer_list<T>);
21512: f({1,2,3}); // T deduced to int
21513: f({1,"asdf"}); // error: T deduced to both int and const char*
21514: template<class T> void g(T);
21515: g({1,2,3}); // error: no argument deduced for T
21516: 〞end example ] For a function parameter pack, the type A of each remaining argument of the call is 
21517: compared with the type P of the declarator-id of the function parameter pack. Each comparison deduces 
21518: template arguments for subsequent positions in the template parameter packs expanded by the function 
21519: parameter pack. [ Note: A function parameter pack can only occur at the end of a parameter-declaration-
21520: list (8.3.5). 〞end note ][ Example: 
21521: template<class ... Types> void f(Types& ...);
21522: template<class T1, class ... Types> void g(T1, Types ...);
21523: void h(int x, float& y) {
21524: const int z = x;
21525: f(x, y, z); // Types is deduced to int, float, const int
21526: g(x, y, z); // T1 is deduced to int; Types is deduced to float, int
21527: } 
21528: 〞end example ] 
21529: 2 If P is not a reference type: 
21530: 〞 If A is an array type, the pointer type produced by the array-to-pointer standard conversion (4.2) is 
21531: used in place of A for type deduction; otherwise, 
21532: 〞 If A is a function type, the pointer type produced by the function-to-pointer standard conversion (4.3) 
21533: is used in place of A for type deduction; otherwise, 
21534: 〞 If A is a cv-qualified type, the top level cv-qualifiers of A＊s type are ignored for type deduction. 
21535: ∫ 14.8.2.1 374 
21536: 
21537: c
21538: . ISO/IEC N2800=08-0310 
21539: 3 If P is a cv-qualified type, the top level cv-qualifiers of P＊s type are ignored for type deduction. If P is a 
21540: reference type, the type referred to by P is used for type deduction. If P is of the form T&&, where T is a 
21541: template parameter, and the argument is an lvalue, the type A& is used in place of A for type deduction. 
21542: [ Example: 
21543: template <typename T> int f(T&&);
21544: int i;
21545: int j = f(i); // calls f<int&>(i)
21546: template <typename T> int g(const T&&);
21547: int k;
21548: int n = g(k); // calls g<int>(k)
21549: 〞end example ] 
21550: 4 In general, the deduction process attempts to find template argument values that will make the deduced A 
21551: identical to A (after the type A is transformed as described above). However, there are three cases that allow 
21552: a difference: 
21553: 〞 If the original P is a reference type, the deduced A (i.e., the type referred to by the reference) can be 
21554: more cv-qualified than the transformed A. 
21555: 〞 The transformed A can be another pointer or pointer to member type that can be converted to the 
21556: deduced A via a qualification conversion (4.4). 
21557: 〞 If P is a class and P has the form simple-template-id, then the transformed A can be a derived class of 
21558: the deduced A. Likewise, if P is a pointer to a class of the form simple-template-id, the transformed A 
21559: can be a pointer to a derived class pointed to by the deduced A. 
21560: 5 These alternatives are considered only if type deduction would otherwise fail. If they yield more than one 
21561: possible deduced A, the type deduction fails. [ Note: if a template-parameter is not used in any of the 
21562: function parameters of a function template, or is used only in a non-deduced context, its corresponding 
21563: template-argument cannot be deduced from a function call and the template-argument must be explicitly 
21564: specified. 〞end note ] 
21565: 6 When P is a function type, pointer to function type, or pointer to member function type: 
21566: 〞 If the argument is an overload set containing one or more function templates, the parameter is treated 
21567: as a non-deduced context. 
21568: 〞 If the argument is an overload set (not containing function templates), trial argument deduction is 
21569: attempted using each of the members of the set. If deduction succeeds for only one of the overload 
21570: set members, that member is used as the argument value for the deduction. If deduction succeeds for 
21571: more than one member of the overload set the parameter is treated as a non-deduced context. 
21572: 7 [ Example: 
21573: // Only one function of an overload set matches the call so the function
21574: // parameter is a deduced context.
21575: template <class T> int f(T (*p)(T));
21576: int g(int);
21577: int g(char);
21578: int i = f(g); // calls f(int (*)(int))
21579: 〞end example ] 
21580: 8 [ Example: 
21581: ∫ 14.8.2.1 375 
21582: 
21583: c
21584: . ISO/IEC N2800=08-0310 
21585: // Ambiguous deduction causes the second function parameter to be a
21586: // non-deduced context.
21587: template <class T> int f(T, T (*p)(T));
21588: int g(int);
21589: char g(char);
21590: int i = f(1, g); // calls f(int, int (*)(int))
21591: 〞end example ] 
21592: 9 [ Example: 
21593: // The overload set contains a template, causing the second function
21594: // parameter to be a non-deduced context.
21595: template <class T> int f(T, T (*p)(T));
21596: char g(char);
21597: template <class T> T g(T);
21598: int i = f(1, g); // calls f(int, int (*)(int))
21599: 〞end example ] 
21600: 14.8.2.2 Deducing template arguments taking the address of a function template
21601: [temp.deduct.funcaddr]
21602: 1 Template arguments can be deduced from the type specified when taking the address of an overloaded 
21603: function (13.4). The function template＊s function type and the specified type are used as the types of P and 
21604: A, and the deduction is done as described in 14.8.2.5. 
21605: 14.8.2.3 Deducing conversion function template arguments [temp.deduct.conv] 
21606: 1 Template argument deduction is done by comparing the return type of the conversion function template 
21607: (call it P) with the type that is required as the result of the conversion (call it A) as described in 14.8.2.5. 
21608: 2 If A is not a reference type: 
21609: 〞 If P is an array type, the pointer type produced by the array-to-pointer standard conversion (4.2) is 
21610: used in place of P for type deduction; otherwise, 
21611: 〞 If P is a function type, the pointer type produced by the function-to-pointer standard conversion (4.3) 
21612: is used in place of P for type deduction; otherwise, 
21613: 〞 If P is a cv-qualified type, the top level cv-qualifiers of P＊s type are ignored for type deduction. 
21614: 3 If A is a cv-qualified type, the top level cv-qualifiers of A＊s type are ignored for type deduction. If A is a 
21615: reference type, the type referred to by A is used for type deduction. If P is a reference type, the type referred 
21616: to by P is used for type deduction. 
21617: 4 In general, the deduction process attempts to find template argument values that will make the deduced A 
21618: identical to A. However, there are two cases that allow a difference: 
21619: 〞 If the original A is a reference type, A can be more cv-qualified than the deduced A (i.e., the type 
21620: referred to by the reference) 
21621: 〞 The deduced A can be another pointer or pointer to member type that can be converted to A via a 
21622: qualification conversion. 
21623: 5 These alternatives are considered only if type deduction would otherwise fail. If they yield more than one 
21624: possible deduced A, the type deduction fails. 
21625: ∫ 14.8.2.3 376 
21626: 
21627: c
21628: . ISO/IEC N2800=08-0310 
21629: 6 When the deduction process requires a qualification conversion for a pointer or pointer to member type as 
21630: described above, the following process is used to determine the deduced template argument values: 
21631: If A is a type 
21632: cv 1,0 ※pointer to ...§ cv1,n.1 ※pointer to§ cv 1,nT1 
21633: and P is a type 
21634: cv 2,0 ※pointer to ...§ cv2,n.1 ※pointer to§ cv 2,nT2 
21635: The cv-unqualified T1 and T2 are used as the types of A and P respectively for type deduction. [ Example: 
21636: struct A { 
21637: template <class T> operator T***(); 
21638: }; 
21639: A a; 
21640: const int * const * const * p1 = a; // T is deduced as int, not const int 
21641: 〞end example ] 
21642: 14.8.2.4 Deducing template arguments during partial ordering [temp.deduct.partial] 
21643: 1 Template argument deduction is done by comparing certain types associated with the two function templates 
21644: being compared. 
21645: 2 Two sets of types are used to determine the partial ordering. For each of the templates involved there is 
21646: the original function type and the transformed function type. [ Note: the creation of the transformed type 
21647: is described in 14.5.6.2. 〞end note ] The deduction process uses the transformed type as the argument 
21648: template and the original type of the other template as the parameter template. This process is done twice 
21649: for each type involved in the partial ordering comparison: once using the transformed template-1 as the 
21650: argument template and template-2 as the parameter template and again using the transformed template-2 
21651: as the argument template and template-1 as the parameter template. 
21652: 3 The types used to determine the ordering depend on the context in which the partial ordering is done: 
21653: 〞 In the context of a function call, the function parameter types are used. 
21654: 〞 In the context of a call to a conversion operator, the return types of the conversion function templates 
21655: are used. 
21656: 〞 In other contexts (14.5.6.2) the function template＊s function type is used. 
21657: 4 Each type from the parameter template and the corresponding type from the argument template are used 
21658: as the types of P and A. 
21659: 5 Before the partial ordering is done, certain transformations are performed on the types used for partial 
21660: ordering: 
21661: 〞 If P is a reference type, P is replaced by the type referred to. 
21662: 〞 If A is a reference type, A is replaced by the type referred to. 
21663: 6 If both P and A were reference types (before being replaced with the type referred to above), determine 
21664: which of the two types (if any) is more cv-qualified than the other; otherwise the types are considered to be 
21665: equally cv-qualified for partial ordering purposes. The result of this determination will be used below. 
21666: 7 Remove any top-level cv-qualifiers: 
21667: 〞 If P is a cv-qualified type, P is replaced by the cv-unqualified version of P. 
21668: ∫ 14.8.2.4 377 
21669: 
21670: c
21671: . ISO/IEC N2800=08-0310 
21672: 〞 If A is a cv-qualified type, A is replaced by the cv-unqualified version of A. 
21673: 8 Using the resulting types P and A the deduction is then done as described in 14.8.2.5. If deduction succeeds 
21674: for a given type, the type from the argument template is considered to be at least as specialized as the type 
21675: from the parameter template. 
21676: 9 If, for a given type, deduction succeeds in both directions (i.e., the types are identical after the transfor-
21677: mations above) and if the type from the argument template is more cv-qualified than the type from the 
21678: parameter template (as described above) that type is considered to be more specialized than the other. If 
21679: neither type is more cv-qualified than the other then neither type is more specialized than the other. 
21680: 10 If for each type being considered a given template is at least as specialized for all types and more specialized 
21681: for some set of types and the other template is not more specialized for any types or is not at least as 
21682: specialized for any types, then the given template is more specialized than the other template. Otherwise, 
21683: neither template is more specialized than the other. 
21684: 11 In most cases, all template parameters must have values in order for deduction to succeed, but for partial 
21685: ordering purposes a template parameter may remain without a value provided it is not used in the types 
21686: being used for partial ordering. [ Note: a template parameter used in a non-deduced context is considered 
21687: used. 〞end note ][ Example: 
21688: template <class T> T f(int); // #1
21689: template <class T, class U> T f(U); // #2
21690: void g() {
21691: f<int>(1); // calls #1
21692: }
21693: 〞end example ] 
21694: 12 [ Note: Partial ordering of function templates containing template parameter packs is independent of the 
21695: number of deduced arguments for those template parameter packs. 〞end note ][ Example: 
21696: template<class ...> struct Tuple { };
21697: template<class ... Types> void g(Tuple<Types ...>); // #1
21698: template<class T1, class ... Types> void g(Tuple<T1, Types ...>); // #2
21699: template<class T1, class ... Types> void g(Tuple<T1, Types& ...>); // #3
21700: g(Tuple<>()); // calls #1
21701: g(Tuple<int, float>()); // calls #2
21702: g(Tuple<int, float&>()); // calls #3
21703: g(Tuple<int>()); // calls #3
21704: 〞end example ] 
21705: 14.8.2.5 Deducing template arguments from a type [temp.deduct.type] 
21706: 1 Template arguments can be deduced in several different contexts, but in each case a type that is specified 
21707: in terms of template parameters (call it P) is compared with an actual type (call it A), and an attempt is 
21708: made to find template argument values (a type for a type parameter, a value for a non-type parameter, or 
21709: a template for a template parameter) that will make P, after substitution of the deduced values (call it the 
21710: deduced A), compatible with A. 
21711: 2 In some cases, the deduction is done using a single set of types P and A, in other cases, there will be a set 
21712: of corresponding types P and A. Type deduction is done independently for each P/A pair, and the deduced 
21713: template argument values are then combined. If type deduction cannot be done for any P/A pair, or if for any 
21714: pair the deduction leads to more than one possible set of deduced values, or if different pairs yield different 
21715: ∫ 14.8.2.5 378 
21716: 
21717: c
21718: . ISO/IEC N2800=08-0310 
21719: deduced values, or if any template argument remains neither deduced nor explicitly specified, template 
21720: argument deduction fails. 
21721: 3 A given type P can be composed from a number of other types, templates, and non-type values: 
21722: 〞 A function type includes the types of each of the function parameters and the return type. 
21723: 〞 A pointer to member type includes the type of the class object pointed to and the type of the member 
21724: pointed to. 
21725: 〞 A type that is a specialization of a class template (e.g., A<int>) includes the types, templates, and 
21726: non-type values referenced by the template argument list of the specialization. 
21727: 〞 An array type includes the array element type and the value of the array bound. 
21728: 4 In most cases, the types, templates, and non-type values that are used to compose P participate in template 
21729: argument deduction. That is, they may be used to determine the value of a template argument, and the 
21730: value so determined must be consistent with the values determined elsewhere. In certain contexts, however, 
21731: the value does not participate in type deduction, but instead uses the values of template arguments that 
21732: were either deduced elsewhere or explicitly specified. If a template parameter is used only in non-deduced 
21733: contexts and is not explicitly specified, template argument deduction fails. 
21734: 5 The non-deduced contexts are: 
21735: 〞 The nested-name-specifier of a type that was specified using a qualified-id. 
21736: 〞 A non-type template argument or an array bound in which a subexpression references a template 
21737: parameter. 
21738: 〞 A template parameter used in the parameter type of a function parameter that has a default argument 
21739: that is being used in the call for which argument deduction is being done. 
21740: 〞 A function parameter for which argument deduction cannot be done because the associated function 
21741: argument is a function, or a set of overloaded functions (13.4), and one or more of the following apply: 
21742: 〞 more than one function matches the function parameter type (resulting in an ambiguous deduc-
21743: tion), or 
21744: 〞 no function matches the function parameter type, or 
21745: 〞 the set of functions supplied as an argument contains one or more function templates. 
21746: 〞 A function parameter for which the associated argument is an initializer list (8.5.4) but the parameter 
21747: does not have std::initializer_list or reference to possibly cv-qualified std::initializer_list 
21748: type. [ Example: 
21749: template<class T> void g(T);
21750: g({1,2,3}); // error: no argument deduced for T
21751: 〞end example ] 
21752: 6 When a type name is specified in a way that includes a non-deduced context, all of the types that comprise 
21753: that type name are also non-deduced. However, a compound type can include both deduced and non-deduced 
21754: types. [ Example: If a type is specified as A<T>::B<T2>, both T and T2 are non-deduced. Likewise, if a type is 
21755: specified as A<I+J>::X<T>, I, J, and T are non-deduced. If a type is specified as void f(typename A<T>::B, 
21756: A<T>), the T in A<T>::B is non-deduced but the T in A<T> is deduced. 〞end example ] 
21757: 7 [ Example: Here is an example in which different parameter/argument pairs produce inconsistent template 
21758: argument deductions: 
21759: ∫ 14.8.2.5 379 
21760: 
21761: c
21762: . ISO/IEC N2800=08-0310 
21763: template<class T> void f(T x, T y) { /. ...  / }
21764: struct A { /. ...  / };
21765: struct B : A { /. ...  / };
21766: void g(A a, B b) {
21767: f(a,b); // error: T could be A or B
21768: f(b,a); // error: T could be A or B
21769: f(a,a); // OK: T is A
21770: f(b,b); // OK: T is B
21771: } 
21772: Here is an example where two template arguments are deduced from a single function parameter/argument 
21773: pair. This can lead to conflicts that cause type deduction to fail: 
21774: template <class T, class U> void f( T (*)( T, U, U ) ); 
21775: int g1( int, float, float);
21776: char g2( int, float, float);
21777: int g3( int, char, float);
21778: void r() {
21779: f(g1); // OK: T is int and U is float
21780: f(g2); // error: T could be char or int
21781: f(g3); // error: U could be char or float
21782: } 
21783: Here is an example where a qualification conversion applies between the argument type on the function call 
21784: and the deduced template argument type: 
21785: template<class T> void f(const T*) { }
21786: int *p;
21787: void s() {
21788: f(p); // f(const int*)
21789: }
21790: Here is an example where the template argument is used to instantiate a derived class type of the corre-
21791: sponding function parameter type: 
21792: template <class T> struct B { };
21793: template <class T> struct D : public B<T> {};
21794: struct D2 : public B<int> {};
21795: template <class T> void f(B<T>&){}
21796: void t() {
21797: D<int> d;
21798: D2 d2;
21799: f(d); // calls f(B<int>&)
21800: f(d2); // calls f(B<int>&)
21801: } 
21802: 〞end example ] 
21803: 8 A template type argument T, a template template argument TT or a template non-type argument i can be 
21804: deduced if P and A have one of the following forms: 
21805: T
21806: cv-list T
21807: T*
21808: T&
21809: ∫ 14.8.2.5 380 
21810: 
21811: c
21812: . ISO/IEC N2800=08-0310 
21813: T&&
21814: T[integer-constant]
21815: template-name<T> (where template-name refers to a class template)
21816: type(T)
21817: T()
21818: T(T)
21819: T type::*
21820: type T::*
21821: T T::*
21822: T (type::*)()
21823: type (T::*)()
21824: type (type::*)(T)
21825: type (T::*)(T)
21826: T (type::*)(T)
21827: T (T::*)()
21828: T (T::*)(T)
21829: type[i]
21830: template-name<i> (where template-name refers to a class template)
21831: TT<T>
21832: TT<i>
21833: TT<>
21834: where (T) represents a parameter-type-list where at least one parameter type contains a T, and () represents 
21835: a parameter-type-list where no parameter type contains a T. Similarly, <T> represents template argument 
21836: lists where at least one argument contains a T, <i> represents template argument lists where at least one 
21837: argument contains an i and <> represents template argument lists where no argument contains a T or an i. 
21838: 9 If P has a form that contains <T> or <i>, then each argument Pi of the respective template argument list 
21839: P is compared with the corresponding argument Ai of the corresponding template argument list of A. If 
21840: the template argument list of P contains a pack expansion that is not the last template argument, the 
21841: entire template argument list is a non-deduced context. If Pi is a pack expansion, then the pattern of Pi 
21842: is compared with each remaining argument in the template argument list of A. Each comparison deduces 
21843: template arguments for subsequent positions in the template parameter packs expanded by Pi. 
21844: 10 Similarly, if P has a form that contains (T), then each parameter type Pi of the respective parameter-type-list 
21845: of P is compared with the corresponding parameter type Ai of the corresponding parameter-type-list of A. If 
21846: the parameter-declaration corresponding to Pi is a function parameter pack, then the type of its declarator-id 
21847: is compared with each remaining parameter type in the parameter-type-list of A. Each comparison deduces 
21848: template arguments for subsequent positions in the template parameter packs expanded by the function 
21849: parameter pack. [ Note: A function parameter pack can only occur at the end of a parameter-declaration-
21850: list (8.3.5). 〞end note ] 
21851: 11 These forms can be used in the same way as T is for further composition of types. [ Example: 
21852: X<int> (*)(char[6]) 
21853: is of the form 
21854: template-name<T> (*)(type[i]) 
21855: which is a variant of 
21856: type (*)(T) 
21857: where type is X<int> and T is char[6]. 〞end example ] 
21858: ∫ 14.8.2.5 381 
21859: 
21860: c
21861: . ISO/IEC N2800=08-0310 
21862: 12 Template arguments cannot be deduced from function arguments involving constructs other than the ones 
21863: specified above. 
21864: 13 A template type argument cannot be deduced from the type of a non-type template-argument. 
21865: 14 [ Example: 
21866: template<class T, T i> void f(double a[10][i]);
21867: int v[10][20];
21868: f(v); // error: argument for template-parameter T cannot be deduced
21869: 〞end example ] 
21870: 15 [ Note: except for reference and pointer types, a major array bound is not part of a function parameter type 
21871: and cannot be deduced from an argument: 
21872: template<int i> void f1(int a[10][i]);
21873: template<int i> void f2(int a[i][20]);
21874: template<int i> void f3(int (&a)[i][20]);
21875: void g() {
21876: int v[10][20];
21877: f1(v); // OK: i deduced to be 20
21878: f1<20>(v); // OK
21879: f2(v); // error: cannot deduce template-argument i
21880: f2<10>(v); // OK
21881: f3(v); // OK: i deduced to be 10
21882: } 
21883: 16 If, in the declaration of a function template with a non-type template parameter, the non-type template 
21884: parameter is used in a subexpression in the function parameter list, the expression is a non-deduced context 
21885: as specified above. [ Example: 
21886: template <int i> class A { /. ...  / };
21887: template <int i> void g(A<i+1>);
21888: template <int i> void f(A<i>, A<i+1>);
21889: void k() {
21890: A<1> a1;
21891: A<2> a2;
21892: g(a1); // error: deduction fails for expression i+1
21893: g<0>(a1); // OK
21894: f(a1, a2); // OK
21895: } 
21896: 〞end example ] 〞end note ][ Note: template parameters do not participate in template argument deduc-
21897: tion if they are used only in non-deduced contexts. For example, 
21898: template<int i, typename T> 
21899: T deduce(typename A<T>::X x, // T is not deduced here
21900: T t, // but T is deduced here
21901: typename B<i>::Y y); // i is not deduced here
21902: A<int> a;
21903: B<77> b;
21904: int x = deduce<77>(a.xm, 62, y.ym);
21905: // T is deduced to be int, a.xm must be convertible to
21906: // A<int>::X
21907: ∫ 14.8.2.5 382 
21908: 
21909: c
21910: . ISO/IEC N2800=08-0310 
21911: // i is explicitly specified to be 77, y.ym must be convertible
21912: // to B<77>::Y
21913: 〞end note ] 
21914: 17 If, in the declaration of a function template with a non-type template-parameter, the non-type template-
21915: parameter is used in an expression in the function parameter-list and, if the corresponding template-argument 
21916: is deduced, the template-argument type shall match the type of the template-parameter exactly, except that 
21917: a template-argument deduced from an array bound may be of any integral type.136 [ Example: 
21918: template<int i> class A { /. ...  / };
21919: template<short s> void f(A<s>);
21920: void k1() {
21921: A<1> a;
21922: f(a); // error: deduction fails for conversion from int to short
21923: f<1>(a); // OK
21924: } 
21925: template<const short cs> class B { };
21926: template<short s> void g(B<s>);
21927: void k2() {
21928: B<1> b;
21929: g(b); // OK: cv-qualifiers are ignored on template parameter types
21930: }
21931: 〞end example ] 
21932: 18 A template-argument can be deduced from a function, pointer to function, or pointer to member function 
21933: type. 
21934: [ Example: 
21935: template<class T> void f(void(*)(T,int));
21936: template<class T> void foo(T,int);
21937: void g(int,int);
21938: void g(char,int);
21939: void h(int,int,int);
21940: void h(char,int);
21941: int m() {
21942: f(&g); // error: ambiguous
21943: f(&h); // OK: void h(char,int) is a unique match
21944: f(&foo); // error: type deduction fails because foo is a template
21945: } 
21946: 〞end example ] 
21947: 19 A template type-parameter cannot be deduced from the type of a function default argument. [ Example: 
21948: template <class T> void f(T = 5, T = 7); 
21949: void g() {
21950: f(1); // OK: call f<int>(1,7)
21951: f(); // error: cannot deduce T
21952: f<int>(); // OK: call f<int>(5,7)
21953: } 
21954: 136) Although the template-argument corresponding to a template-parameter of type bool may be deduced from an array 
21955: bound, the resulting value will always be true because the array bound will be non-zero. 
21956: ∫ 14.8.2.5 383 
21957: 
21958: c
21959: . ISO/IEC N2800=08-0310 
21960: 〞end example ] 
21961: 20 The template-argument corresponding to a template template-parameter is deduced from the type of the 
21962: template-argument of a class template specialization used in the argument list of a function call. [ Example: 
21963: template <template <class T> class X> struct A { };
21964: template <template <class T> class X> void f(A<X>) { }
21965: template<class T> struct B { };
21966: A<B> ab;
21967: f(ab); // calls f(A<B>)
21968: 〞end example ] 
21969: 21 [ Note: Template argument deduction involving parameter packs (14.5.3) can deduce zero or more arguments 
21970: for each parameter pack. 〞end note ][ Example: 
21971: template<class> struct X { };
21972: template<class R, class ... ArgTypes> struct X<R(int, ArgTypes ...)> { };
21973: template<class ... Types> struct Y { };
21974: template<class T, class ... Types> struct Y<T, Types& ...> { };
21975: template<class ... Types> int f(void (*)(Types ...));
21976: void g(int, float);
21977: X<int> x1; // uses primary template 
21978: X<int(int, float, double)> x2; // uses partial specialization; ArgTypes contains float, double 
21979: X<int(float, int)> x3; // uses primary template 
21980: Y<> y1; // use primary template; Types is empty 
21981: Y<int&, float&, double&> y2; // uses partial specialization; T is int&, Types contains float, double 
21982: Y<int, float, double> y3; // uses primary template; Types contains int, float, double 
21983: int fv = f(g); // OK; Types contains int, float 
21984: 〞end example ] 
21985: 22 If the original function parameter associated with A is a function parameter pack and the function parameter 
21986: associated with P is not a function parameter pack, then template argument deduction fails. [ Example: 
21987: template<class ... Args> void f(Args ... args); // #1
21988: template<class T1, class ... Args> void f(T1 a1, Args ... args); // #2
21989: template<class T1, class T2> void f(T1 a1, T2 a2); // #3
21990: f(); // calls #1
21991: f(1, 2, 3); // calls #2
21992: f(1, 2); // calls #3; non-variadic template #3 is more
21993: // specialized than the variadic templates #1 and #2 
21994: 〞end example ] 
21995: 14.8.3 Overload resolution [temp.over] 
21996: 1 A function template can be overloaded either by (non-template) functions of its name or by (other) function 
21997: templates of the same name. When a call to that name is written (explicitly, or implicitly using the operator 
21998: notation), template argument deduction (14.8.2) and checking of any explicit template arguments (14.3) are 
21999: performed for each function template to find the template argument values (if any) that can be used with 
22000: that function template to instantiate a function template specialization that can be invoked with the call 
22001: ∫ 14.8.3 384 
22002: 
22003: c
22004: . ISO/IEC N2800=08-0310 
22005: arguments. For each function template, if the argument deduction and checking succeeds, the template-
22006: arguments (deduced and/or explicit) are used to synthesize the declaration of a single function template 
22007: specialization which is added to the candidate functions set to be used in overload resolution. If, for a given 
22008: function template, argument deduction fails, no such function is added to the set of candidate functions for 
22009: that template. The complete set of candidate functions includes all the synthesized declarations and all of 
22010: the non-template overloaded functions of the same name. The synthesized declarations are treated like any 
22011: 137 
22012: other functions in the remainder of overload resolution, except as explicitly noted in 13.3.3.
22013: [ Example:
22014: template<class T> T max(T a, T b) { return a>b?a:b; } 
22015: void f(int a, int b, char c, char d) {
22016: int m1 = max(a,b); // max(int a, int b)
22017: char m2 = max(c,d); // max(char a, char b)
22018: int m3 = max(a,c); // error: cannot generate max(int,char)
22019: } 
22020: 2 Adding the non-template function 
22021: int max(int,int); 
22022: to the example above would resolve the third call, by providing a function that could be called for max(a,c) 
22023: after using the standard conversion of char to int for c. 
22024: 3 Here is an example involving conversions on a function argument involved in template-argument deduction: 
22025: template<class T> struct B { /. ...  / };
22026: template<class T> struct D : public B<T> { /. ...  / };
22027: template<class T> void f(B<T>&);
22028: void g(B<int>& bi, D<int>& di) {
22029: f(bi); // f(bi)
22030: f(di); // f((B<int>&)di)
22031: } 
22032: 4 Here is an example involving conversions on a function argument not involved in template-parameter deduc-
22033: tion: 
22034: template<class T> void f(T*,int); // #1
22035: template<class T> void f(T,char); // #2
22036: void h(int* pi, int i, char c) {
22037: f(pi,i); // #1: f<int>(pi,i)
22038: f(pi,c); // #2: f<int*>(pi,c)
22039: f(i,c); // #2: f<int>(i,c);
22040: f(i,i); // #2: f<int>(i,char(i))
22041: }
22042: 〞end example ] 
22043: 137) The parameters of function template specializations contain no template parameter types. The set of conversions allowed 
22044: on deduced arguments is limited, because the argument deduction process produces function templates with parameters that 
22045: either match the call arguments exactly or differ only in ways that can be bridged by the allowed limited conversions. Non-
22046: deduced arguments allow the full range of conversions. Note also that 13.3.3 specifies that a non-template function will be given 
22047: preference over a template specialization if the two functions are otherwise equally good candidates for an overload match. 
22048: ∫ 14.8.3 385 
22049: 
22050: c
22051: . ISO/IEC N2800=08-0310 
22052: 5 Only the signature of a function template specialization is needed to enter the specialization in a set of 
22053: candidate functions. Therefore only the function template declaration is needed to resolve a call for which 
22054: a template specialization is a candidate. [ Example: 
22055: template<class T> void f(T); // declaration 
22056: void g() {
22057: f("Annemarie"); // call of f<const char*>
22058: }
22059: 6 The call of f is well-formed even if the template f is only declared and not defined at the point of the call. 
22060: The program will be ill-formed unless a specialization for f<const char*>, either implicitly or explicitly 
22061: generated, is present in some translation unit. 〞end example ] 
22062: 14.9 Concepts [concept] 
22063: 1 Concepts describe an abstract interface that can be used to constrain templates (14.10). Concepts state 
22064: certain syntactic and semantic requirements (14.9.1) on a set of template type, non-type, and template 
22065: template parameters. 
22066: concept-id:
22067: concept-name < template-argument-listopt >
22068: concept-name:
22069: identifier
22070: 2 A concept-id names a specific use of a concept by its concept-name and a set of template arguments. 
22071: The concept and its template arguments, together, are referred to as a concept instance.[ Example: 
22072: CopyConstructible<int> is a concept-id if name lookup (3.4) determines that the identifier CopyConstructible 
22073: refers to a concept-name;then, CopyConstructible<int> is a concept instance that refers to the CopyConstructible 
22074: concept used with the type int. 〞end example ] 
22075: 3 A concept C is treated as a constrained template (14.10) X for the purpose of making the concept＊s definition 
22076: a constrained context. The template requirements for X consist of a concept requirement C<T1, T2, ..., 
22077: TN>, where T1, T2, ..., TN are the template parameters of C, and the template requirements implied by that 
22078: concept requirement (14.10.1.2). [ Example: 
22079: concept C<typename T> { } 
22080: concept D<typename T> {
22081: requires C<T>;
22082: // D is treated as a constrained template whose template requirements are D<T> && C<T> 
22083: } 
22084: 〞end example ] 
22085: 14.9.1 Concept definitions [concept.def] 
22086: 1 The grammar for a concept-definition is: 
22087: concept-definition:
22088: autoopt concept identifier < template-parameter-list >
22089: refinement-clauseopt concept-body ;opt
22090: 2 Concept-definition s are used to declare concept-name s. A concept-name is inserted into the scope in which 
22091: it is declared immediately after the concept-name is seen. A concept is considered defined after the closing 
22092: ∫ 14.9.1 386 
22093: 
22094: c
22095: . ISO/IEC N2800=08-0310 
22096: brace of its concept-body. A full concept name is an identifier that is treated as if it were composed of the 
22097: concept name and the sequence of its enclosing namespaces. 
22098: 3 Concepts shall only be defined at namespace scope. 
22099: 4 A concept-definition that starts with auto defines an auto concept. 
22100: 5 The template-parameter-list of a concept-definition shall not contain any requirements specified in the simple 
22101: form (14.10.1). 
22102: concept-body: 
22103: 6 { concept-member-specificationopt } 
22104: concept-member-specification:
22105: concept-member-specifier concept-member-specificationopt
22106: concept-member-specifier:
22107: associated-function
22108: type-parameter ;
22109: associated-requirements
22110: axiom-definition
22111: The body of a concept contains associated functions (14.9.1.1), associated types (14.9.1.2), associated class 
22112: templates, associated requirements (14.9.1.3), and axioms (14.9.1.3). 
22113: 14.9.1.1 Associated functions [concept.fct] 
22114: 1 Associated functions describe functions, member functions, or operators (including templates thereof) that 
22115: specify the functional behavior of the concept＊s template arguments and associated types and class templates 
22116: (14.9.1.2). A concept map (14.9.2) for a given concept must satisfy each associated function in the concept 
22117: (14.9.2.1). 
22118: associated-function:
22119: simple-declaration
22120: function-definition
22121: template-declaration
22122: 2 An associated-function shall declare a function or function template. If the declarator-id of the declaration 
22123: is a qualified-id, its nested-name-specifier shall name a template parameter of the enclosing concept; the 
22124: declaration declares a member function or member function template. An associated function shall not 
22125: be extern, inline or virtual (7.1.2), explicitly-defaulted or deleted (8.4), or a friend function (11.4). An 
22126: associated function shall not contain an exception-specification (15.4). 
22127: 3 Associated functions may specify requirements for non-member functions and operators. [ Example: 
22128: concept Monoid<typename T> {
22129: T operator+(T, T);
22130: T identity();
22131: } 
22132: 〞end example ] 
22133: 4 With the exception of the assignment operator (13.5.3) and operators new, new[], delete, and delete[], 
22134: associated functions shall specify requirements for operators as non-member functions. [ Note: This restric-
22135: tion applies even to the operators (), [], and ->, which can otherwise only be declared as non-static member 
22136: functions (13.5): [ Example: 
22137: concept Convertible<typename T, typename U> {
22138: operator U(T); // OK: conversion from T to U
22139: T::operator U*() const; // error: cannot specify requirement for member operator
22140: } 
22141: ∫ 14.9.1.1 387 
22142: 
22143: c
22144: . ISO/IEC N2800=08-0310 
22145: 〞end example ] 〞end note ] 
22146: 5 Associated functions may specify requirements for static or non-static member functions, constructors, and 
22147: destructors. [ Example: 
22148: concept Container<typename X> {
22149: X::X(int n);
22150: X::~X();
22151: bool X::empty() const;
22152: static size_t X::max_size();
22153: } 
22154: 〞end example ]
22155: Associated functions may specify requirements for new and delete.
22156: concept HeapAllocatable<typename T> {
22157: void* T::operator new(std::size_t);
22158: void* T::operator new[](std::size_t);
22159: void T::operator delete(void*);
22160: void T::operator delete[](void*);
22161: } 
22162: 〞end example ] 
22163: [ Example: 
22164: 7 Associated functions may specify requirements for function templates and member function templates. 
22165: [ Example: 
22166: concept Sequence<typename X> {
22167: typename value_type;
22168: template<InputIterator Iter> 
22169: requires Convertible<InputIterator<Iter>::value_type, Sequence<X>::value_type> 
22170: X::X(Iter first, Iter last); 
22171: } 
22172: 〞end example ]
22173: 8 Concepts may contain overloaded associated functions (clause 13). [ Example:
22174: concept C<typename X> {
22175: void f(X);
22176: void f(X, X); // OK
22177: int f(X, X); // error: differs only by return type
22178: } 
22179: 〞end example ] 
22180: 9 Associated member functions with the same name and the same parameter-type-list, as well as associated 
22181: member function templates with the same name, the same parameter-type-list, the same template parameter 
22182: lists, and the same template requirements (if any), cannot be overloaded if any of them, but not all, have a 
22183: ref-qualifier (8.3.5). 
22184: 10 Associated functions may have a default implementation. This implementation is instantiated if used. A 
22185: default implementation of an associated function is a constrained template (14.10) whose template require-
22186: ments include concept requirements for the enclosing concept, its less refined concepts, and its associated 
22187: requirements. [ Example: 
22188: ∫ 14.9.1.1 388 
22189: 
22190: c
22191: . ISO/IEC N2800=08-0310 
22192: concept EqualityComparable<typename T> { 
22193: bool operator==(T, T); 
22194: bool operator!=(T x, T y) { return !(x == y); } 
22195: } 
22196: class X {};
22197: bool operator==(const X&, const X&);
22198: concept_map EqualityComparable<X> { } // OK, operator!= uses default 
22199: 〞end example ] 
22200: 14.9.1.2 Associated types and class templates [concept.assoc] 
22201: 1 Associated types and associated class templates are types and class templates, respectively, defined in the 
22202: concept body and used in the description of the concept. 
22203: 2 An associated type specifies a type in a concept body. Associated types are typically used to express the 
22204: parameter and return types of associated functions. [ Example: 
22205: concept Callable1<typename F, typename T1> { 
22206: typename result_type; 
22207: result_type operator()(F&&, T1); 
22208: } 
22209: 〞end example ] 
22210: 3 An associated class template specifies a class template in a concept. [ Example: 
22211: concept C<typename T> { 
22212: template<ObjectType U> class X;
22213: }
22214: 〞end example ] 
22215: 4 Associated types and class templates may be provided with a default value. The default value is used to 
22216: satisfy the associated type or class template requirement when no corresponding definition is provided in a 
22217: concept map (14.9.2.2). [ Example: 
22218: concept Iterator<typename Iter> { 
22219: typename difference_type = int;
22220: }
22221: concept_map Iterator<int*> { } // OK, difference_type is int 
22222: 〞end example ] 
22223: 5 Associated types and class templates may use the simple form to specify requirements (14.10.1) on the 
22224: associated type or class template. The simple form is equivalent to a declaration of the associated type 
22225: or class template followed by an associated requirement (14.9.1.3) stated using the general form (14.10.1). 
22226: [ Example: 
22227: concept InputIterator<typename Iter> { /. ...  / } 
22228: concept Container<typename X> { 
22229: InputIterator iterator; // same as typename iterator; requires InputIterator<iterator>; 
22230: } 
22231: ∫ 14.9.1.2 389 
22232: 
22233: c
22234: . ISO/IEC N2800=08-0310 
22235: 〞end example ] 
22236: 14.9.1.3 Associated requirements [concept.req] 
22237: 1 Associated requirements place additional requirements on the concept＊s template parameters, associated 
22238: types, and associated class templates. Associated requirements have the same form and behavior as template 
22239: requirements in a constrained template (14.10). 
22240: associated-requirements:
22241: requires-clause ;
22242: [ Example: 
22243: concept Iterator<typename Iter> {
22244: typename difference_type;
22245: requires SignedIntegral<difference_type>;
22246: } 
22247: 〞end example ] 
22248: 14.9.1.4 Axioms [concept.axiom] 
22249: 1 Axioms allow the expression of the semantic properties of concepts. 
22250: axiom-definition:
22251: requires-clauseopt axiom identifier ( parameter-declaration-clause ) axiom-body
22252: axiom-body:
22253: { axiom-seqopt }
22254: axiom-seq:
22255: axiom axiom-seqopt
22256: axiom:
22257: expression-statement
22258: if ( expression ) expression-statement
22259: An axiom-definition defines a new semantic axiom whose name is specified by its identifier.[ Example: 
22260: concept Semigroup<typename Op, typename T> : CopyConstructible<T> {
22261: T operator()(Op, T, T);
22262: axiom Associativity(Op op, T x, T y, T z) {
22263: op(x, op(y, z)) == op(op(x, y), z);
22264: }
22265: }
22266: concept Monoid<typename Op, typename T> : Semigroup<Op, T> {
22267: T identity_element(Op);
22268: axiom Identity(Op op, T x) {
22269: op(x, identity_element(op)) == x;
22270: op(identity_element(op), x) == x;
22271: }
22272: }
22273: 〞end example ] 
22274: 2 Within the body of an axiom-definition, equality (==) and inequality (!=) operators are available for each 
22275: concept type parameter and associated type T. These implicitly-defined operators have the form: 
22276: ∫ 14.9.1.4 390 
22277: 
22278: c
22279: . ISO/IEC N2800=08-0310 
22280: bool operator==(const T&, const T&);
22281: bool operator!=(const T&, const T&);
22282: [ Example: 
22283: concept CopyConstructible<typename T> {
22284: T::T(const T&);
22285: axiom CopyEquivalence(T x) {
22286: T(x) == x; // OK, uses implicit ==
22287: }
22288: }
22289: 〞end example ] 
22290: 3 Name lookup within an axiom will only find the implicitly-declared == and != operators if the corresponding 
22291: operation is not declared as an associated function (14.9.1.1) in the concept, one of its less refined concepts 
22292: (14.9.3), or in an associated requirement (14.9.1.3). [ Example: 
22293: concept EqualityComparable<typename T> {
22294: bool operator==(T, T);
22295: bool operator!=(T, T);
22296: axiom Reflexivity(T x) {
22297: x == x; // refers to EqualityComparable<T>::operator==
22298: }
22299: }
22300: 〞end example ] 
22301: 4 Where axioms state the equality of two expressions, implementations are permitted to replace one expression 
22302: with the other. [ Example: 
22303: template<typename Op, typename T> requires Monoid<Op, T>
22304: T identity(const Op& op, const T& t) {
22305: return op(t, identity_element(op)); // equivalent to return t;
22306: }
22307: 〞end example ] 
22308: 5 Axioms can state conditional semantics using if statements. The expression is contextually converted to 
22309: bool (clause 4). When the condition can be proven true, and the expression-statement states the equality 
22310: of two expressions, implementations are permitted to replace one expression with the other. [ Example: 
22311: concept TotalOrder<typename Op, typename T> {
22312: bool operator()(Op, T, T);
22313: axiom Antisymmetry(Op op, T x, T y) { if (op(x, y) && op(y, x)) x == y; } 
22314: axiom Transitivity(Op op, T x, T y, T z) { if (op(x, y) && op(y, z)) op(x, z) == true; } 
22315: axiom Totality(Op op, T x, T y) { (op(x, y) || op(y, x)) == true; } 
22316: } 
22317: 〞end example ] 
22318: 6 In a concept map where the requires clause of an axiom-definition is not satisfied, an implementation shall 
22319: behave as if the axiom weere not defined. [ Example: 
22320: ∫ 14.9.1.4 391 
22321: 
22322: . ISO/IEC 
22323: concept EqualityComparable2<typename T, typename U = T> { 
22324: bool operator==(T, U); 
22325: bool operator!=(T, U); 
22326: requires std::SameType<T, U> axiom Reflexivity(T x) { 
22327: x == x; // OK: T and U have the same type 
22328: } 
22329: } 
22330: 〞end example ] 
22331: N2800=08-0310 
22332: 7 Whether an implementation replaces any expression according to an axiom is implementation-defined. With 
22333: the exception of such substitutions, the presence of an axiom shall have no effect on the observable behavior 
22334: of the program. [ Note: the intent of axioms is to provide a mechanism to express the semantics of concepts. 
22335: Such semantic information can be used for optimization, software verification, software testing, and other 
22336: program analyses and transformations, all of which are outside the scope of this International Standard. 
22337: 〞end note ] 
22338: 14.9.2 Concept maps [concept.map] 
22339: 1 The grammar for a concept-map-definition is: 
22340: concept-map-definition: 
22341: concept_map ::opt nested-name-specifieropt concept-id { concept-map-member-specificationopt 
22342: } ;opt 
22343: concept-map-member-specification:
22344: concept-map-member concept-map-member-specificationopt
22345: concept-map-member:
22346: simple-declaration
22347: function-definition
22348: template-declaration
22349: 2 Concept maps describe how a set of template arguments satisfy the requirements stated in the body of a 
22350: concept definition (14.9.1). For template argument deduction (14.8.2.5) against a constrained template to 
22351: succeed, each of the template＊s requirements shall be satisfied (14.10.1.1). The concept map＊s name (which 
22352: is the full concept name of its concept) is inserted into the scope in which the concept map or concept map 
22353: template (14.5.8) is defined immediately after the concept-id is seen. [ Example: 
22354: class student_record { 
22355: public:
22356: std::string id;
22357: std::string name;
22358: std::string address;
22359: }; 
22360: namespace N {
22361: concept EqualityComparable<typename T> {
22362: bool operator==(T, T);
22363: }
22364: }
22365: namespace M { 
22366: concept_map N::EqualityComparable<student_record> { // the concept map＊s name is ::N::EqualityComparable 
22367: bool operator==(const student_record& a, const student_record& b) { 
22368: return a.id == b.id; 
22369: } 
22370: ∫ 14.9.2 392 
22371: 
22372: c
22373: . ISO/IEC N2800=08-0310 
22374: }
22375: }
22376: template<typename T> requires EqualityComparable<T> void f(T); 
22377: f(student_record()); // OK, have concept_map EqualityComparable<student_record> 
22378: 〞end example ] 
22379: 3 A concept map may contain two kinds of members: requirement members and members that satisfy require-
22380: ment members. The latter may be explicitly declared within the concept map, explicitly declared within 
22381: a concept map for a more refined concept, or generated implicitly from a default implementation from the 
22382: concept or one of its more refined concepts. 
22383: 4 Each requirement member represents an entity (a single associated function (14.9.1.1), associated type or 
22384: associated class template (14.9.1.2) in the corresponding concept that must be satisfied as described below. 
22385: The set of requirement members is the set of associated functions, associated types and associated class 
22386: templates from the concept after substitution of the concept＊s template parameters with the corresponding 
22387: template arguments. [ Note: There is no way to explicitly declare a requirement member. 〞 end note ] 
22388: 5 After a requirement is satisfied, the requirement member serves as a synonym for the set of entities that 
22389: satisfies the requirement (14.9.2.1, 14.9.2.2). That set of entities is said to be the satisfier of the requirement 
22390: member. Each requirement member is visible during qualified name lookup (3.4.3.3). [ Note: A satisfier 
22391: need not be a member of a concept map. 〞end note ] 
22392: 6 A concept map member that satisfies a requirement member cannot be found by any form of name lookup 
22393: (3.4). 
22394: 7 A concept map archetype (14.10.2) is considered to have satisfiers (generated from the concept) for each of 
22395: its requirement members. 
22396: 8 Concept maps shall satisfy every associated function (14.9.1.1), associated type and associated class template 
22397: requirement (14.9.1.2) of its concept instance and all of the requirements inherited from its less refined 
22398: concept instances (14.9.3). [ Example: 
22399: concept C<typename T, typename U> { T f(T); U f(U); } 
22400: concept_map C<int, int> {
22401: int f(int); // OK: matches requirement for f in concept instance C<int, int>
22402: }
22403: 〞end example ] 
22404: 9 Concept maps shall not contain declarations that do not satisfy any requirement in their corresponding 
22405: concept or its less refined concepts. [ Example: 
22406: concept C<typename T> { } 
22407: concept_map C<int> {
22408: int f(int); // error: no requirement for function f
22409: }
22410: 〞end example ] 
22411: 10 At the point of definition of a concept map, all associated requirements (14.9.1.3) of the corresponding 
22412: concept and its less refined concepts (14.9.3) shall be satisfied (14.10.1.1). [ Example: 
22413: ∫ 14.9.2 393 
22414: 
22415: c
22416: . ISO/IEC N2800=08-0310 
22417: concept C<typename T> { /. ...  / } 
22418: concept D<typename Iter> {
22419: typename type;
22420: requires C<type>;
22421: } 
22422: concept_map C<ptrdiff_t> { } 
22423: concept_map D<int*> {
22424: typedef ptrdiff_t type;
22425: } // OK: there exists a concept map C<ptrdiff_t>
22426: class X { ... }; 
22427: concept_map D<X> {
22428: typedef long type;
22429: } // error: no concept map C<long> if ptrdiff_t is not long
22430: 〞end example ] 
22431: 11 A concept map for an auto concept is implicitly defined (14.9.1) when it is needed by concept map lookup 
22432: (14.10.1.1). If any requirement of the concept or its less refined concepts would not be satisfied by the 
22433: implicitly-defined concept map, the concept map is not implicitly defined. The implicitly-defined concept 
22434: map is defined in the namespace of the concept. [ Example: 
22435: auto concept C<typename T> {
22436: T::T(const T&);
22437: T operator+(T, T);
22438: } 
22439: template<typename T>
22440: requires C<T>
22441: T add(T x, T y) {
22442: return x + y;
22443: }
22444: int f(int x, int y) {
22445: return add(x, y); // OK: concept map C<int> implicitly defined
22446: }
22447: 〞end example ] 
22448: 12 [ Note: Failure to implicitly define a concept map does not necessarily imply that the program is ill-formed 
22449: (14.8.2). 〞end note ][ Example: 
22450: auto concept F<typename T> {
22451: void f(T);
22452: }
22453: auto concept G<typename T> {
22454: void g(T);
22455: }
22456: template<typename T> requires F<T> void h(T); // #1
22457: template<typename T> requires G<T> void h(T); // #2
22458: ∫ 14.9.2 394 
22459: 
22460: c
22461: . ISO/IEC N2800=08-0310 
22462: struct X { };
22463: void g(X);
22464: void func(X x) {
22465: h(x); // OK: implicit concept map F<X> fails, causing
22466: // template argument deduction to fail for #1; calls #2
22467: } 
22468: 〞end example ] 
22469: 13 A concept map or concept map template shall be defined before the first use of a concept instance that 
22470: would make use of the concept map or concept map template in every translation unit in which such a use 
22471: occurs; no diagnostic is required. If the introduction of a concept map or concept map template changes 
22472: a previous result (e.g., in template argument deduction (14.8.2)), the program is ill-formed, no diagnostic 
22473: required. Concept map templates must be instantiated if doing so would affect the semantics of the program. 
22474: A concept map for a particular concept instance shall not be defined both implicitly and explicitly in the 
22475: same namespace in a translation unit. If one translation unit of a program contains an explicitly-defined 
22476: concept map for that concept instance, and a different translation contains an implicitly-defined concept 
22477: map for that concept instance, then the program is ill-formed, no diagnostic required. 
22478: 14 The implicit or explicit definition of a concept map asserts that the axioms (14.9.1.4) stated in its cor-
22479: responding concept (and the concepts that it refines) hold, permitting an implementation to perform the 
22480: transformations described in 14.9.1.4. If an axiom is violated, the behavior of the program is undefined. 
22481: 14.9.2.1 Associated function definitions [concept.map.fct] 
22482: 1 Function definitions in the concept map can be used to adapt the syntax of the concept＊s template arguments 
22483: to the syntax expected by the concept. [ Example: 
22484: concept Stack<typename S> {
22485: typename value_type;
22486: bool empty(S const&);
22487: void push(S&, value_type);
22488: void pop(S&);
22489: value_type& top(S&);
22490: // Make a vector behave like a stack 
22491: template<Regular T> 
22492: concept_map Stack<std::vector<T> > {
22493: typedef T value_type;
22494: bool empty(std::vector<T> const& vec) { return vec.empty(); }
22495: void push(std::vector<T>& vec, value_type const& value) {
22496: vec.push_back(value);
22497: }
22498: void pop(std::vector<T>& vec) { vec.pop_back(); }
22499: value_type& top(std::vector<T>& vec) { return vec.back(); }
22500: } 
22501: 〞end example ] 
22502: 2 A function or function template defined in a concept map is inline. 
22503: 3 An associated function (or function template) requirement is satisfied as follows. Given an associated function 
22504: (call it f), let R be the return type of f, after substitution of the concept＊s template arguments for their 
22505: ∫ 14.9.2.1 395 
22506: 
22507: c
22508: . ISO/IEC N2800=08-0310 
22509: corresponding concept parameters. Construct an expression E (as defined below) in the scope of the concept 
22510: map. Then, the associated function requirement is satisfied: 
22511: 〞 if R is cv void and the expression E is well-formed, 
22512: 〞 otherwise, if R is not cv void and the expression ※E implicitly converted to R§ is well-formed, or 
22513: 〞 otherwise, if f has a default implementation. 
22514: 4 The expression E is defined differently depending on the associated function and the concept map definition. 
22515: Let parm1, parm2, ..., parmN be the parameters of f (after substitution of the concept map arguments) 
22516: and parm10, parm20, ..., parmN . be expressions, where each parmi. is an id-expression naming parmi. If the 
22517: declared type of parmi is an lvalue reference type, then parmi. is treated as an lvalue, otherwise, parmi. is 
22518: treated as an rvalue. 
22519: For an associated member function (or member function template) in a type X (after substitution of the 
22520: concept map arguments into the associated member function or member function template), let x be an 
22521: object of type cv X, where cv are the cv-qualifiers on the associated member function (or member function 
22522: template). If the requirement has no ref-qualifier or if its ref-qualifier is &, x is an lvalue; otherwise, x is an 
22523: rvalue. 
22524: The expression E is defined as follows: 
22525: 〞 If f is an associated non-member function or function template and the concept map contains one or 
22526: more function or function template definitions with the same name as f, E is f(parm10, parm20, ..., 
22527: parmN 0), and the overload set of entities f consists of the definitions of f in the concept map. [ Note: 
22528: Unqualified lookup 3.4.1 and argument dependent lookup 3.4.2 are suppressed. 〞end note ]. 
22529: 〞 Otherwise, if f is a non-static associated member function and the concept map contains one or more 
22530: member function or member function template definitions in the type X and with the same name as f, 
22531: E is x.f(parm10, parm20, ..., parmN 0), where name lookup of x.f refers to the definitions of X::f 
22532: in the concept map. 
22533: 〞 Otherwise, if f is a static associated member function and the concept map contains one or more 
22534: member function or member function template definitions in the type X and with the same name as f, 
22535: E is X::f(parm10, parm20, ..., parmN 0), where name lookup of X::f refers to the static definitions 
22536: of X::f in the concept map. 
22537: 〞 If the associated function or function template is a prefix unary operator Op, E is Op parm10. 
22538: 〞 If the associated function or function template is a postfix unary operator Op, E is parm1. Op. 
22539: 〞 If the associated function or function template is a binary operator Op, E is parm1. Op parm20. 
22540: 〞 If the associated function or function template is the function call operator, E is parm10(parm20, 
22541: parm30, ..., parmN 0). 
22542: 〞 If the associated function is a conversion operator, E is parm1. if the conversion operator requirement 
22543: is not explicit and (R)parm1. if the conversion operator requirement is explicit, where R is the 
22544: return type of the conversion operator. 
22545: 〞 If the associated function or function template is a non-member function or function template, E is an 
22546: unqualified call f(parm10, parm20, ..., parmN 0). 
22547: 〞 If the associated function or function template is a static member function or function template in the 
22548: type X, E is a call X::f(parm10, parm20, ..., parmN 0). 
22549: 〞 If the associated function is a constructor or constructor template that is explicit or has N =
22550: 61 
22551: parameters, E is X(parm10, parm20, ..., parmN 0).[ Example: 
22552: ∫ 14.9.2.1 396 
22553: 
22554: c
22555: . ISO/IEC N2800=08-0310 
22556: concept TwoIntConstructible<typename T> {
22557: T::T(int, int);
22558: } 
22559: struct X { X(long, int); }; 
22560: concept_map TwoIntConstructible<X> { } // OK: X has a constructor that can accept two ints 
22561: // (the first is converted to a long) 
22562: 〞end example ] 
22563: 〞 If the associated function is a constructor or constructor template that has one parameter (and is not 
22564: explicit), E is ※parm1. implicitly converted to X§. [ Example: 
22565: concept IC<typename T> {
22566: T::T(int);
22567: } 
22568: concept EC<typename T> {
22569: explicit T::T(int);
22570: } 
22571: struct X {
22572: X(int);
22573: }; 
22574: struct Y {
22575: explicit Y(int);
22576: }; 
22577: concept_map IC<X> { } // OK
22578: concept_map EC<X> { } // OK
22579: concept_map IC<Y> { } // error: cannot copy-initialize Y from an int
22580: concept_map EC<Y> { } // OK
22581: 〞end example ] 
22582: 〞 If the associated function is a destructor, E is x.X().[ Example: 
22583: concept D<typename T> {
22584: T::~T();
22585: } 
22586: concept_map D<int> { } // OK: int is not a class type 
22587: struct X { };
22588: concept_map D<X> { } // OK: X has implicitly-declared, public destructor
22589: struct Y { private: ~Y(); };
22590: concept_map D<Y> { } // error: Y＊s destructor is inaccessible
22591: 〞end example ] 
22592: 〞 If the associated member function requirement is a requirement for an operator new or new[], E is 
22593: operator new(parm10, parm20, ..., parmN 0) or operator new[](parm10, parm20, ..., parmN 0), 
22594: respectively. If X is a class type, the allocation function＊s name is looked up in the scope of X. If this 
22595: lookup fails to find the name, or if X is not a class type, the allocation function＊s name is looked up in 
22596: the global scope. 
22597: ∫ 14.9.2.1 397 
22598: 
22599: c
22600: . ISO/IEC N2800=08-0310 
22601: 〞 If the associated member function requirement is a requirement for an operator delete or delete[], E 
22602: is operator delete(parm10, parm20, ..., parmN 0) or operator delete[](parm10, parm20, ..., 
22603: parmN 0), respectively. If X is a class type, the deallocation function＊s name is looked up in the scope 
22604: of X. If this lookup fails to find the name, or if X is not a class type, the deallocation function＊s name 
22605: is looked up in the global scope. 
22606: 〞 Otherwise, the associated function is a member function requirement, and E is x.f(parm10, parm20, 
22607: ..., parmN 0). 
22608: 5 Each satisfied associated function (or function template) requirement has a corresponding associated function 
22609: candidate set. An associated function candidate set is a candidate set (14.10.3) representing the functions or 
22610: operations used to satisfy the requirement. The seed of the associated function candidate set is determined 
22611: based on the expression E used to determine that the requirement was satisfied. 
22612: 〞 If the evaluation of E involves overload resolution at the top level, the seed is the function (13.3.1) 
22613: selected by the outermost application of overload resolution (clause 13). 
22614: 〞 Otherwise, if E is a pseudo destructor call (5.2.4), the seed is a pseudo-destructor-name. 
22615: 〞 Otherwise, the seed is the initialization of an object. 
22616: 14.9.2.2 Associated type and template definitions [concept.map.assoc] 
22617: 1 Definitions in the concept map provide types and templates that satisfy requirements for associated types 
22618: and templates (14.9.1.2), respectively. 
22619: 2 Associated type parameter requirements are satisfied by type definitions in the body of a concept map. 
22620: [ Example: 
22621: concept ForwardIterator<typename Iter> {
22622: typename difference_type;
22623: }
22624: concept_map ForwardIterator<int*> {
22625: typedef ptrdiff_t difference_type;
22626: }
22627: 〞end example ] 
22628: 3 Associated class template requirements are satisfied by template aliases (14.5.7) in the body of the concept 
22629: map. [ Example: 
22630: concept Allocator<typename Alloc> {
22631: template<class T> class rebind;
22632: }
22633: template<typename T>
22634: class my_allocator {
22635: template<typename U> class rebind;
22636: };
22637: template<typename T>
22638: concept_map Allocator<my_allocator<T>> {
22639: template<class U> using rebind = my_allocator<T>::rebind;
22640: }
22641: 〞end example ] 
22642: ∫ 14.9.2.2 398 
22643: 
22644: c
22645: . ISO/IEC N2800=08-0310 
22646: 4 A concept map member that satisfies an associated type or class template requirement can be implicitly 
22647: defined using template argument deduction (14.8.2) with one or more associated function requirements 
22648: (14.9.2.1), if the associated type or class template requirement does not have a default value. The definition 
22649: of the associated type or class template is determined using the rules of template argument deduction from 
22650: a type (14.8.2.5). 
22651: 〞 Let P be the return type of an associated function after substitution of the concept＊s template parame-
22652: ters specified by the concept map with their template arguments, and where each undefined associated 
22653: type and associated class template has been replaced with a newly invented type or template template 
22654: parameter, respectively. 
22655: 〞 Let A be the return type of the seed in the associated function candidate set corresponding to the 
22656: associated function. 
22657: If the deduction fails, no concept map members are implicitly defined by that associated function. If the 
22658: results of deduction produced by different associated functions yield more than one possible value, that 
22659: associated type or class template is not implicitly defined. [ Example: 
22660: auto concept Dereferenceable<typename T> {
22661: typename value_type;
22662: value_type& operator*(T&);
22663: } 
22664: template<typename T> requires Dereferenceable<T> void f(T&); 
22665: void g(int* x) { 
22666: f(x); // OK: Dereferenceable<int*> implicitly defined 
22667: // implicitly-defined Dereferenceable<int*>::operator* calls built-in * for integer pointers 
22668: // implicitly-defined Dereferenceable<int*>::value_type is int 
22669: } 
22670: 〞end example ] 
22671: 5 If an associated type or class template (14.9.1.2) has a default value, a concept map member satisfying the 
22672: associated type or class template requirement shall be implicitly defined by substituting the concept map 
22673: arguments into the default value. If this substitution does not produce a valid type or template (14.8.2), 
22674: the concept map member is not implicitly defined. [ Note: If substitution fails, the associated type or class 
22675: template can still be deduced, as described below. 〞end note ][ Example: 
22676: auto concept A<typename T> {
22677: typename result_type = typename T::result_type;
22678: }
22679: auto concept B<typename T> {
22680: T::T(const T&);
22681: }
22682: template<typename T> requires A<T> void f(const T&); // #1
22683: template<typename T> requires B<T> void f(const T&); // #2
22684: struct X {}; 
22685: void g(X x) { 
22686: f(x); // OK: A<X> cannot satisfy result_type requirement, and is not implicitly defined, calls #2 
22687: } 
22688: 〞end example ] 
22689: ∫ 14.9.2.2 399 
22690: 
22691: c
22692: . ISO/IEC 
22693: 14.9.3 Concept refinement 
22694: 1 The grammar for a refinement-clause is: 
22695: refinement-clause:
22696: : refinement-specifier-list
22697: refinement-specifier-list:
22698: refinement-specifier , refinement-specifier-list
22699: refinement-specifier
22700: refinement-specifier: 
22701: concept-instance-alias-defopt ::opt nested-name-specifieropt concept-id 
22702: concept-instance-alias-def:
22703: identifier =
22704: 2 Refinements specify an inheritance relationship among concepts. A concept B named 
22705: N2800=08-0310 
22706: [concept.refine] 
22707: in a refinement-specifier 
22708: of concept D is a less refined concept of D and D is a more refined concept of B. A concept refinement inherits 
22709: all requirements in the body of a concept (14.9.1), such that the requirements of the more refined concept 
22710: are a superset of the requirements of the less refined concept. [ Note: when a concept D refines a concept B, 
22711: every set of template arguments that satisfies the requirements of D also satisfies the requirements of B. The 
22712: refinement relationshipis transitive. 〞end note ][ Example: In the following example, EquilateralPolygon 
22713: refines Polygon. Thus, every EquilateralPolygon is a Polygon, and constrained templates (14.10) that 
22714: are well-formed with a Polygon constraint are well-formed when given an EquilateralPolygon. 
22715: concept Polygon<typename P> { /. ...  / } 
22716: concept EquilateralPolygon<typename P> : Polygon<P> { /. ...  / } 
22717: 〞end example ] 
22718: 3 A refinement-specifier shall refer to a previously defined concept. [ Example: 
22719: concept C<typename T> : C<vector<T>> {/. ...  / } // error: concept C is not defined 
22720: 〞end example ] 
22721: 4 The template-argument-list of a refinement-specifier＊s concept-id shall refer to at least one of the template 
22722: parameters, and no template parameter shall be used in a way that establishes an archetype (14.10.2). 
22723: [ Example: 
22724: concept C<typename T> { T f(); } 
22725: concept D<typename T> 
22726: : C<int> // error: C<int> uses no template parameters
22727: {
22728: // ... 
22729: } 
22730: concept E<typename T> 
22731: : C<T>, D<decltype(f())> // error: establishes archetype T.
22732: {
22733: // ... 
22734: } 
22735: 〞end example ] 
22736: ∫ 14.9.3 400 
22737: 
22738: c
22739: . ISO/IEC N2800=08-0310 
22740: 5 Within the definition of a concept, a concept map archetype is synthesized for each refinement-specifier in 
22741: the concept＊s refinement-clause (if any). 
22742: 14.9.3.1 Concept member lookup [concept.member.lookup] 
22743: 1 Concept member lookup determines the meaning of a name in concept scope (3.3.7). The following steps 
22744: define the result of name lookup for a member name f in concept scope C. CR is the set of concept scopes 
22745: corresponding to the concepts refined by the concept whose scope is C. 
22746: 2 If the name f is declared in concept scope C, and f refers to an associated type or class template (14.9.1.2), 
22747: then the result of name lookup is the associated type or class template. 
22748: 3 If the name f is declared in concept scope C, and f refers to one or more associated functions (14.9.1.1), then 
22749: the result of name lookup is the set consisting of the associated functions in C in addition to the associated 
22750: functions in each concept scope in CR for which name lookup of f results in a set of associated functions. 
22751: [ Example: 
22752: concept C1<typename T> : CopyConstructible<T> {
22753: T f(T); // #1
22754: }
22755: concept C2<typename T> {
22756: typename f;
22757: }
22758: concept D<typename T> : C1<T>, C2<T> {
22759: T f(T, T); // #2
22760: }
22761: template<typename T>
22762: requires D<T>
22763: void f(T x)
22764: {
22765: D<T>::f(x); // name lookup finds #1 and #2, overload resolution selects #1
22766: }
22767: 〞end example ] 
22768: 4 If the name f is not declared in C, name lookup searches for f in the scopes of each of the less refined 
22769: concepts (CR). If name lookup of f is ambiguous in any concept scope CR, name lookup of f in C is 
22770: ambiguous. Otherwise, the set of concept scopes CR. is a subset of CR containing only those concept scopes 
22771: for which name lookup finds f. The result of name lookup for f in C is defined by: 
22772: 〞 If CR. is empty, name lookup of f in C returns no result. 
22773: 〞 Otherwise, if CR. contains only a single concept scope, name lookup for f in C is the result of name 
22774: lookup for f in that concept scope. 
22775: 〞 Otherwise, if f refers to one or more functions in all of the concept scopes in CR. , then f refers to the 
22776: set consisting of all associated functions from all of the concept scopes in CR. . 
22777: 〞 Otherwise, if f refers to an associated type or class template in all concept scopes in CR. , and all of the 
22778: associated types or class templates are equivalent (14.10.1), the result is the associated type or class 
22779: template f. 
22780: 〞 Otherwise, name lookup of f in C is ambiguous.
22781: [ Example:
22782: ∫ 14.9.3.1 401 
22783: 
22784: c
22785: . ISO/IEC N2800=08-0310 
22786: concept A<typename T> { typename t; } 
22787: concept B<typename T> { typename t; } 
22788: concept C<typename T> : A<T>, B<T> {
22789: f(t); // error: ambiguous, the two t＊s are not equivalent
22790: f(A<T>::t); // OK
22791: } 
22792: 〞end example ] 
22793: 5 When name lookup in a concept scope C results in a set of associated functions, duplicate associated functions 
22794: are removed from the set. [ Example: 
22795: concept A<typename T> {
22796: T f(T); // #1a
22797: }
22798: concept B<typename T> {
22799: T f(T); // #1b
22800: T g(T); // #2a
22801: } 
22802: concept C<typename T> : A<T>, B<T> {
22803: T g(T); // #2b
22804: }
22805: template<typename T>
22806: requires C<T>
22807: void h(T x) {
22808: C<T>::f(x); // overload set contains #1a; #1b was removed as a duplicate
22809: C<T>::g(x); // overload set contains #2b; #2a was removed as a duplicate
22810: }
22811: 〞end example ] 
22812: 14.9.3.2 Implicit concept maps for refined concepts [concept.refine.maps] 
22813: 1 When a concept map or concept map template is defined for a concept C that has a refinement clause, 
22814: concept maps or concept map templates for each of the concept instances in the refinement clause of C shall 
22815: be defined, implicitly or explicitly, in the namespace of which the more refined concept map or concept map 
22816: template is a member. [ Example: 
22817: concept A<typename T> { }
22818: concept B<typename T> : A<T> { }
22819: concept_map B<int> { } // implicitly defines concept map A<int> 
22820: 〞end example ] 
22821: 2 A concept map or concept map template for a refinement (called a less refined concept map or concept map 
22822: template) has been defined if concept map lookup (14.10.1.1) finds a concept map for the concept instance 
22823: I in the namespace of which the more refined concept map or concept map template is a member, where 
22824: I is determined by substituting the template arguments of the more refined concept map or concept map 
22825: template into the refinement-specifier corresponding to the refinement. If concept map lookup fails, if it 
22826: ∫ 14.9.3.2 402 
22827: 
22828: c
22829: . ISO/IEC N2800=08-0310 
22830: finds an implicitly generated concept map for an auto concept, or if it finds a concept map from a different 
22831: namespace, a suitable concept map is defined implicitly, as described below. [ Example: 
22832: concept C<typename T> { }
22833: concept D<typename T> : C<T> { }
22834: template<typename T> concept_map C<T*> { } // #1 
22835: template<typename T>
22836: concept_map D<T*> { } // OK: #1 defines the concept map corresponding to the refinement-specifier C<T*>
22837: 〞end example ] 
22838: 3 Concept map templates (14.5.8) can only be implicitly defined for certain less refined concepts from the 
22839: concept map templates of more refined concepts. A less refined concept map template corresponding to a 
22840: particular refinement-specifier can be defined if all of the template parameters of the more refined concept 
22841: map template can be deduced. Let R be the refinement-specifier after substitution of the more refined concept 
22842: map＊s template arguments for the corresponding template parameters. A template parameter T of the more 
22843: refined concept map template can be deduced if for any template argument P in R＊s template-argument-list 
22844: there exists a type, template, or value A such that template argument deduction (14.8.2) performed with 
22845: that P/A pair would determine a value for T. If any template parameter of the more refined concept map 
22846: template can not be deduced, the program is ill-formed. Otherwise, a less refined concept map template is 
22847: implicitly defined in the namespace of the more refined concept map template; its template-parameter-list 
22848: and template requirements are the same as the more refined concept map template, and its concept-id is R. 
22849: [ Example: 
22850: concept C<typename T> { }
22851: concept D<typename T, typename U> : C<T> { }
22852: template<typename T> struct A { }; 
22853: template<typename T> concept_map D<A<T>, T> { } 
22854: // implicitly defines: 
22855: template<typename T> concept_map C<A<T>> { } 
22856: template<typename T, typename U>
22857: concept_map D<T, A<U>> { } // ill-formed: cannot deduce template parameter U from C<T>
22858: // and there is no concept map template C<T>
22859: 〞end example ] 
22860: 4 When a less refined concept map or concept map template is implicitly defined, definitions in the more 
22861: refined concept map or concept map template can be used to satisfy the requirements of the less refined 
22862: concept (14.9.2). [ Note: a single function definition in a concept map can be used to satisfy multiple 
22863: requirements. 〞end note ][ Example: in this example, the concept map D<int> implicitly defines the 
22864: concept map C<int>. 
22865: concept C<typename T> {
22866: T f(T);
22867: void g(T);
22868: } 
22869: concept D<typename T> : C<T> {
22870: void g(T);
22871: }
22872: ∫ 14.9.3.2 403 
22873: 
22874: c
22875: . ISO/IEC N2800=08-0310 
22876: concept_map D<int> {
22877: int f(int x) { return -x; } // satisfies requirement for C<int>::f
22878: void g(int x) { } // satisfies requirement for C<int>::g and D<int>::g
22879: } 
22880: 〞end example ] 
22881: 5 Each concept map or concept map template shall have satisfiers that are compatible with the satisfiers of its 
22882: less refined concept maps or concept map templates. A satisfier of the more refined concept map or concept 
22883: map template is compatible with its corresponding satisfier of the less refined concept map or concept map 
22884: template if 
22885: 〞 the satisfiers correspond to an associated function requirement (14.9.1.1) and their associated function 
22886: candidate sets have the same seed or 
22887: 〞 the satisfiers satisfy an associated type or class template requirement (14.9.1.2) and both satisfiers 
22888: name the same type or template, respectively. 
22889: If a program contains satisfiers of a concept map or concept map template that are not compatible with their 
22890: corresponding satisfiers of a less refined concept map or concept map template, the program is ill-formed. 
22891: If the concept maps or concept map templates with satisfiers that are not compatible occur in different 
22892: translation units, no diagnostic is required. [ Example: 
22893: concept C<typename T> {
22894: typename assoc;
22895: assoc f(T);
22896: } 
22897: concept D<typename T> : C<T> {
22898: int g(T);
22899: }
22900: concept E<typename T> : D<T> { } 
22901: concept_map C<int> {
22902: typedef int assoc;
22903: int f(int x) { return x; }
22904: } 
22905: concept_map D<int> {
22906: typedef int assoc; // OK: same type as C<int>::assoc
22907: // OK: f is not defined in D<int>
22908: int g(int x) { return -x; } // OK: satisfies D<int>::g
22909: }
22910: concept_map E<int> { 
22911: typedef float assoc; // error: E<int>::assoc and D<int>::assoc are not the same type 
22912: // OK: f is not defined in D<int> 
22913: int g(int x) { return x; } // error: D<int>::g already defined in concept map D<int> 
22914: } 
22915: 〞end example ] 
22916: 14.9.4 Support concepts [concept.support] 
22917: 1 The concepts in [concept.support] provide the ability to state template requirements for C++ type classi-
22918: ∫ 14.9.4 404 
22919: 
22920: c
22921: . ISO/IEC N2800=08-0310 
22922: fications (3.9) and type relationships that cannot be expressed directly with concepts. Concept maps for 
22923: these concepts are implicitly defined. A program shall not provide a concept map or concept map template 
22924: for any concept in [concept.support] nor shall it provide a definition for any of these concepts. 
22925: 2 The following concepts are implicitly defined at the beginning of each translation unit. [ Note: This implies 
22926: that the namespace std is always visible at global scope. 〞end note ] 
22927: namespace std {
22928: concept Returnable<typename T> { }
22929: concept PointeeType<typename T> { }
22930: concept MemberPointeeType<typename T> { }
22931: concept ReferentType<typename T> { }
22932: concept VariableType<typename T> { }
22933: concept ObjectType<typename T> see below ;
22934: concept ValueType<typename T> see below ;
22935: concept ClassType<typename T> see below ;
22936: concept Class<typename T> see below ;
22937: concept PolymorphicClass<typename T> see below ;
22938: concept Union<typename T> see below ;
22939: concept TrivialType<typename T> see below ;
22940: concept StandardLayoutType<typename T> see below ;
22941: concept LiteralType<typename T> see below ;
22942: concept ScalarType<typename T> see below ;
22943: concept ArithmeticType<typename T> see below ;
22944: concept NonTypeTemplateParameterType<typename T> see below ;
22945: concept IntegralConstantExpressionType<typename T> see below ;
22946: concept IntegralType<typename T> see below ;
22947: concept EnumerationType<typename T> see below ;
22948: concept FloatingPointType<typename T> see below ;
22949: concept SameType<typename T, typename U> { }
22950: concept DerivedFrom<typename Derived, typename Base> { }
22951: } 
22952: concept Returnable<typename T> { } 
22953: 3 Note: Describes types that can be used as the return type of a function. 
22954: 4 Requires: for every non-array type T that is cv void or that provides a copy operation suitable for use 
22955: in a return statement (6.6.3) and is not an abstract class, the concept map Returnable<T> is implicitly 
22956: defined in namespace std. 
22957: concept PointeeType<typename T> { } 
22958: 5 Note: describes types to which a pointer can be created. 
22959: 6 Requires: for every type T that is an object type, a function type that does not have cv-qualifiers, or 
22960: cv void, a concept map PointeeType<T> is implicitly defined in namespace std. 
22961: concept MemberPointeeType<typename T> { } 
22962: 7 Note: describes types to which a pointer-to-member can be created. 
22963: 8 Requires: for every type T thatis an object type or function type, a concept map MemberPointeeType<T> 
22964: is implicitly defined in namespace std. 
22965: concept ReferentType<typename T> { } 
22966: ∫ 14.9.4 405 
22967: 
22968: c
22969: . ISO/IEC N2800=08-0310 
22970: 9 Note: describes types to which a reference can be created, including reference types (since references 
22971: to references can be formed during substitution of template arguments). 
22972: 10 Requires: for every type T that is an object type, a function type that does not have cv-qualifiers, or 
22973: a reference type, a concept map ReferentType<T> is implicitly defined in namespace std. 
22974: concept VariableType<typename T> : ReferentType<T> { } 
22975: 11 Note: describes types that can be used to declare a variable. 
22976: 12 Requires: for every type T that is an object type or reference type, but not an abstract class, a concept 
22977: map VariableType<T> is implicitly defined in namespace std. 
22978: concept ObjectType<typename T> : ReferentType<T>, PointeeType<T> { } 
22979: 13 Note: describes object types (3.9), for which storage can be allocated. 
22980: 14 Requires: for every type T that is an object type, a concept map ObjectType<T> is implicitly defined 
22981: in namespace std. 
22982: concept ValueType<typename T> : ObjectType<T>, VariableType<T>, MemberPointeeType<T> { } 
22983: 15 Note: describes value types, for which objects, variables, references, pointers, and pointers-to-members 
22984: can be created. 
22985: 16 Requires: for every type T that is an object type but not an abstract class, a concept map ValueType<T> 
22986: is implicitly defined in namespace std. 
22987: concept ClassType<typename T> : ObjectType<T> { } 
22988: 17 Note: describes class types (i.e., unions, classes, and structs). 
22989: 18 Requires: for every type T that is a class type (Clause 9), a concept map ClassType<T> is implicitly 
22990: defined in namespace std. 
22991: concept Class<typename T> : ClassType<T> { } 
22992: 19 Note: describes non-union classes (Clause 9). 
22993: 20 Requires: for every non-union class T, a concept map Class<T> is implicitly defined in namespace std. 
22994: concept PolymorphicClass<typename T> : Class<T> { } 
22995: 21 Note: describes polymorphic class types (10.3). 
22996: 22 Requires: for every type T that is a polymorphic class, a concept map PolymorphicClass<T> is im-
22997: plicitly defined in namespace std. 
22998: concept Union<typename T> : ClassType<T>, ValueType<T> { } 
22999: 23 Note: describes union types (9.5). 
23000: 24 Requires: for every type T that is a union, a concept map Union<T> is implicitly defined in namespace 
23001: std. 
23002: concept TrivialType<typename T> : ValueType<T> { } 
23003: 25 Note: describes trivial types (3.9). 
23004: 26 Requires: for every type T that is a trivial type, a concept map TrivialType<T> is implicitly defined 
23005: in namespace std. 
23006: ∫ 14.9.4 406 
23007: 
23008: c
23009: . ISO/IEC N2800=08-0310 
23010: concept StandardLayoutType<typename T> : ValueType<T> { } 
23011: 27 Note: describes standard-layout types (3.9).
23012: 28 Requires: for every type T that is a standard-layout type, a concept map StandardLayoutType<T> is
23013: implicitly defined in namespace std. 
23014: concept LiteralType<typename T> : ValueType<T> { } 
23015: 29 Note: describes literal types (3.9). 
23016: 30 Requires: for every type T that is a literal type, a concept map LiteralType<T> is 
23017: in namespace std. 
23018: concept ScalarType<typename T>
23019: : TrivialType<T>, LiteralType<T>, StandardLayoutType<T> { }
23020: 31 Note: describes scalar types (3.9). 
23021: implicitly defined 
23022: 32 Requires: for every type T that is a scalar type, a concept map ScalarType<T> is implicitly defined in 
23023: namespace std. 
23024: concept ArithmeticType<typename T> : ScalarType<T> { } 
23025: 33 Note: describes arithmetic types (3.9.1). 
23026: 34 Requires: for every type T that is an arithmetic type, a concept map ArithmeticType<T> is implicitly 
23027: defined in namespace std. 
23028: concept NonTypeTemplateParameterType<typename T> : VariableType<T> { } 
23029: 35 Note: describes type that can be used as the type of a non-type template parameter (14.1). 
23030: 36 Requires: for every type T that can be the type of a non-type template-parameter (14.1), a concept 
23031: map NonTypeTemplateParameterType<T> is implicitly defined in namespace std. 
23032: concept IntegralConstantExpressionType<typename T>
23033: : ScalarType<T>, NonTypeTemplateParameterType<T> { }
23034: 37 Note: describes types that can be the type of an integral constant expression (5.19). 
23035: 38 Requires: for every type T thatis anintegral type or enumeration type, a concept map IntegralConstantExpressionType<is implicitly defined in namespace std. 
23036: concept IntegralType<typename T>
23037: : IntegralConstantExpressionType<T>, ArithmeticType<T> { }
23038: 39 Note: describes integral types (3.9.1). 
23039: 40 Requires: for every type T that is an integral type, a concept map IntegralType<T> is implicitly 
23040: defined in namespace std. 
23041: concept EnumerationType<typename T> : IntegralConstantExpressionType<T> {
23042: IntegralType underlying_type;
23043: }
23044: 41 Note: describes enumeration types (7.2). underlying_type is the underlying type of the enumeration 
23045: type. 
23046: 42 Requires: for every type T that is an enumeration type, a concept map EnumerationType<T> is im-
23047: plicitly defined in namespace std. 
23048: ∫ 14.9.4 407 
23049: 
23050: c
23051: . ISO/IEC N2800=08-0310 
23052: concept FloatingPointType<typename T> : ArithmeticType<T> { } 
23053: 43 Note: describes floating point types (3.9.1). 
23054: 44 Requires: for every type T that is a floating point type, a concept map FloatingPointType<T> is 
23055: implicitly defined in namespace std. 
23056: concept SameType<typename T, typename U> { } 
23057: 45 Note: describes a same-type requirement (14.10.1). 
23058: concept DerivedFrom<typename Derived, typename Base> { } 
23059: 46 Requires: for every pair of class types (T, U), such that T is either the same as or publicly and 
23060: unambiguously derived from U, a concept map DerivedFrom<T, U> is implicitly defined in namespace 
23061: std. 
23062: 14.10 Constrained templates [temp.constrained] 
23063: 1 A template that has a requires-clause (or declares any template type parameters using the simple form 
23064: of requirements (14.1)) is a constrained template. A constrained template can only be instantiated with 
23065: template arguments that satisfy its template requirements. The template definitions of constrained templates 
23066: are similarly constrained, requiring names to be found through name lookup at template definition time (3.4). 
23067: [ Note: Names can be found in the template requirements of a constrained template (3.3.8). The practical 
23068: effect of constrained templates is that they provide improved diagnostics at template definition time, such 
23069: that any use of the constrained template that satisfies the template＊s requirements is likely to result in a 
23070: well-formed instantiation. 〞end note ] 
23071: 2 A template that is not a constrained template is an unconstrained template. 
23072: 3 A constrained context is a part of a constrained template in which all name lookup is resolved at template 
23073: definition time. Names that would be dependent outside of a constrained context shall be found in the 
23074: current scope, which includes the template requirements of the constrained template (3.3.8). [ Note: Within 
23075: a constrained context, template parameters behave as if aliased to their corresponding archetypes (14.10.2) 
23076: so there are no dependent types (14.6.2.1), and no type-dependent values (14.6.2.2) or dependent names 
23077: (14.6.2). Instantiation in constrained contexts (14.10.4) still substitutes types, templates and values for 
23078: template parameters. 〞end note ] A constrained context is any part of a constrained template that is not 
23079: an unconstrained context (described below). 
23080: 4 Any context that is not a constrained context is an unconstrained context. Within a constrained context, 
23081: several constructs provide unconstrained contexts: 
23082: 〞 a late-checked block (6.9), 
23083: 〞 a default argument in a template-parameter, and 
23084: 〞 a default function argument (8.3.5). 
23085: 5 Within a constrained context, a program shall not require a template specialization of an unconstrained 
23086: template for which the template arguments of the specialization depend on a template parameter. 
23087: 14.10.1 Template requirements [temp.req] 
23088: 1 A template has template requirements if it contains a requires-clause or any of its template parameters is 
23089: specified using the simple form of requirements (14.1). Template requirements state the conditions under 
23090: which the template can be used. 
23091: ∫ 14.10.1 408 
23092: 
23093: c
23094: . ISO/IEC N2800=08-0310 
23095: requires-clause:
23096: requires requirement-list
23097: requires ( requirement-list )
23098: requirement-list:
23099: requirement ...opt && requirement-list
23100: requirement ...opt
23101: requirement:
23102: concept-instance-alias-defopt ::opt nested-name-specifieropt concept-id
23103: ! ::opt nested-name-specifieropt concept-id
23104: 2 A requires-clause contains a list of requirements, all of which must be satisfied by the template arguments 
23105: for the template. [ Note: Requirement satisfaction is described in 14.10.1.1. 〞end note ]A requirement not 
23106: containing a ! is a concept requirement. A requirement containing a ! is a negative requirement. 
23107: 3 A concept requirement that refers to the std::SameType concept (14.9.4) is a same-type requirement.A 
23108: same-type requirement is satisfied when its two template arguments refer to the same type (including the 
23109: same cv qualifiers). In a constrained template (14.10), a same-type requirement std::SameType<T1, T2> 
23110: makes the types T1 and T2 equivalent. [ Note: type equivalence is a congruence relation, thus 
23111: 〞 std::SameType<T1, T2> implies std::SameType<T2, T1>, 
23112: 〞 std::SameType<T1, T2> and std::SameType<T2, T3> implies std::SameType<T1, T3>, 
23113: 〞 std::SameType<T1, T1> is trivially true, 
23114: 〞 std::SameType<T1*, T2*> implies std::SameType<T1, T2> and std::SameType<T1**, T2**>, etc. 
23115: 〞end note ][ Example: 
23116: concept C<typename T> {
23117: typename assoc;
23118: assoc a(T);
23119: } 
23120: concept D<typename T> {
23121: T::T(const T&);
23122: T operator+(T, T);
23123: } 
23124: template<typename T, typename U>
23125: requires C<T> && C<U> && std::SameType<C<T>::assoc, C<U>::assoc> && D<C<T>::assoc>
23126: C<T>::assoc f(T t, U u) {
23127: return a(t) + a(u); // OK: C<T>::assoc and C<U>::assoc are the same type
23128: }
23129: 〞end example ] 
23130: 4 A requirement followed by an ellipsis is a pack expansion (14.5.3). Requirement pack expansions place 
23131: requirements on all of the arguments in one or more template parameter packs. [ Example: 
23132: auto concept OutputStreamable<typename T> {
23133: std::ostream& operator<<(std::ostream&, const T&);
23134: }
23135: template<typename T, typename... Rest>
23136: requires OutputStreamable<T> && OutputStreamable<Rest>...
23137: void print(const T& t, const Rest&... rest) {
23138: std::cout << t; 
23139: ∫ 14.10.1 409 
23140: 
23141: c
23142: . ISO/IEC N2800=08-0310 
23143: print(rest...);
23144: }
23145: template<typename T>
23146: requires OutputStreamable<T>
23147: void print(const T& t) {
23148: std::cout << t;
23149: }
23150: void f(int x, float y) { 
23151: print(17, ", ", 3.14159); // OK: implicitly-generated OutputStreamable<int>,
23152: // OutputStreamable<const char[3]>,
23153: // and OutputStreamable<double>
23154: print(17, " ", std::cout); // error: no concept map OutputStreamable<std::ostream>
23155: }
23156: 〞end example ] 
23157: 5 If the requirements of a template are such that no set of template arguments can satisfy all of the require-
23158: ments, the program is ill-formed, no diagnostic required. [ Example: 
23159: concept C<typename T> { } 
23160: template<typename T>
23161: requires C<T> && !C<T>
23162: void f(const T&); // error: no type can satisfy both C<T> && !C<T>, no diagnostic required
23163: 〞end example ] 
23164: 6 A concept-instance-alias-def defines its identifier to be an alias of the concept instance given in its require-
23165: ment or refinement-specifier . When the concept-instance-alias-def appears in a member-requirement (9.2), 
23166: the potential scope of the identifier begins at its point of declaration and terminates at the end of the con-
23167: strained member＊s declaration. When the concept-instance-alias-def appears in the optional requires-clause 
23168: of an axiom-definition (14.9.1.4), the potential scope of the identifier begins at its point of declaration and 
23169: terminates at the end of the axiom-definition. Otherwise, a concept-instance-alias-def inserts the identifier 
23170: as a name in the scope of: 
23171: 〞 the template parameters of the concept, when the concept-instance-alias-def appears in a refinement-
23172: specifier (14.9.3); 
23173: 〞 the enclosing concept, when the concept-instance-alias-def appearsin the associated-requirements (14.9.1.3); 
23174: or 
23175: 〞 the template parameters declared in the template-parameter-list immediately before the requires 
23176: keyword, when the concept-instance-alias-def appears in the optional requires-clause of a template-
23177: declaration. 
23178: 7 [ Example: 
23179: concept A<typename X, typename Y, typename Z> {
23180: typename result_type;
23181: }
23182: concept B<typename X, typename Y> {
23183: typename result_type;
23184: }
23185: ∫ 14.10.1 410 
23186: 
23187: c
23188: . ISO/IEC N2800=08-0310 
23189: concept C<typename X> {
23190: typename R;
23191: }
23192: template <class T>
23193: requires J = C<T>
23194: J::R f(T); // qualified lookup finds type name R
23195: // within the concept C (3.4.3.3) 
23196: auto concept D<typename Op, typename Elem> {
23197: requires a = A<Op, Elem, Elem>;
23198: requires B<a::result_type, Elem>;
23199: typename result_type = a::result_type;
23200: } 
23201: 〞end example ] 
23202: 8 If a concept-instance-alias-def appears in a requirement that is the pattern of a pack expansion, the program 
23203: is ill-formed. [ Example: 
23204: concept C<typename... Args> { } 
23205: template <class... Args>
23206: requires a = C<Args>... // error: requirement aliases may refer only
23207: // to requirements that are not pack expansions
23208: void f(Args...); 
23209: 〞end example ] 
23210: 14.10.1.1 Requirement satisfaction [temp.req.sat] 
23211: 1 During template argument deduction (14.8.2) against a constrained template, it is necessary to determine 
23212: whether each of the requirements of the constrained template can be satisfied by the template arguments. 
23213: 2 A concept requirement is satisfied if concept map lookup (described below) finds a unique concept map 
23214: with the same full concept name as the concept named by the concept requirement and whose template 
23215: argument list is the same as the template argument list of the concept requirement, after substitution of the 
23216: constrained template＊s template arguments into the concept requirement＊s template argument list. Concept 
23217: maps used to satisfy a concept requirement can be defined explicitly (14.9.2), instantiated from a concept 
23218: map template (14.5.8), or defined implicitly (14.9.2). [ Example: 
23219: concept A<typename T> { }
23220: auto concept B<typename T> { T operator+(T, T); }
23221: concept C<typename T> { }
23222: concept D<typename T> { }
23223: concept_map A<float> { }
23224: concept_map B<float> { }
23225: template<typename T> concept_map C<T*> { }
23226: template<typename T> requires B<T> concept_map D<T> { }
23227: template<typename T> requires A<T> void f(T);
23228: template<typename T> requires B<T> void g(T);
23229: template<typename T> requires C<T> void h(T);
23230: template<typename T> requires D<T> void i(T);
23231: ∫ 14.10.1.1 411 
23232: 
23233: c
23234: . ISO/IEC N2800=08-0310 
23235: struct X { }; 
23236: void h(float x, int y, int X::* p, int *q) { 
23237: f(x); // OK: uses concept map A<float> 
23238: f(y); // error: no concept map A<int>; requirement not satisfied 
23239: g(x); // OK: uses concept map B<float> 
23240: g(y); // OK: implicitly defines and uses concept map B<int> 
23241: g(p); // error: no implicit definition of concept map B<int X::*>; requirement not satisfied 
23242: h(q); // okay: instantiates concept map C<T*> with T=int to satisfy requirement C<T> 
23243: i(p); // error: i can＊t get no satisfaction; the 
23244: // concept map template D<T> does not apply
23245: // because B<int X::*> is not satisfied
23246: }
23247: 〞end example ] 
23248: 3 A negative requirement is satisfied if concept map lookup fails to find a concept map that would satisfy the 
23249: corresponding concept requirement. [ Note: If concept map lookup results in an ambiguity, concept map 
23250: lookup halts and the negative requirement is not satisfied. 〞end note ][ Example: 
23251: concept A<typename T> { }
23252: auto concept B<typename T> { T operator+(T, T); }
23253: concept_map A<float> { }
23254: concept_map B<float> { }
23255: template<typename T> requires !A<T> void f(T);
23256: template<typename T> requires !B<T> void g(T);
23257: struct X { }; 
23258: void h(float x, int y, int X::* p) {
23259: f(x); // error: concept map A<float> has been defined
23260: f(y); // OK: no concept map A<int>
23261: g(x); // error: concept map B<float> has been defined
23262: g(y); // error: implicitly defines concept map B<int>, requirement not satisfied
23263: g(p); // OK: concept map B<int X::*> cannot be implicitly defined
23264: } 
23265: 〞end example ] 
23266: 4 Concept map lookup is a mechanism that attempts to find a concept map that corresponds to the concept 
23267: instance (call it I) formed from the concept of a requirement and its template argument list after substitution 
23268: of template arguments for their corresponding template parameters. There is an associated full concept 
23269: name (14.9.1) of I; call it N. Concept map lookup searches an ordered sequence Q (defined below) where 
23270: each element is a set of concept maps called S. For each element in Q (progressing from the lowest to the 
23271: highest-numbered element of Q), concept map lookup attempts to find within S 
23272: 〞 exactly one matching non-template concept map or, if one does not exist, 
23273: 〞 exactly one most-specific matching concept map template according to concept map matching rules 
23274: (14.5.8). 
23275: If no matching concept map is found within a set S in Q, concept map lookup proceeds to the next set in Q. 
23276: If partial ordering of concept map templates results in an ambiguity, concept map lookup returns no result. 
23277: ∫ 14.10.1.1 412 
23278: 
23279: c
23280: . ISO/IEC N2800=08-0310 
23281: 5 When concept map lookup is performed during template argument deduction during partial ordering (14.8.2.4), 
23282: Q is defined as containing only one element S, where S is the set of concept map archetypes synthesized from 
23283: the requirements of the argument template (14.5.6.2,14.8.2.4). 
23284: 6 When concept map lookup is performed during the instantiation of a constrained template (14.10.4), Q is 
23285: defined as the following ordered sequence: 
23286: 1. S is the set of concept maps, each with name N, that have replaced the concept map archetypes used 
23287: in the constrained template. 
23288: 2. S is the set of concept maps and concept map templates found by searching for N in the namespaces 
23289: of which a subset of the concept maps in (1) (described below) are members and in the associated 
23290: namespaces of those namespaces (7.3.1); using-directives in those namespaces are not followed during 
23291: this search. Concept maps in (1) that were implicitly generated from an auto concept are not considered 
23292: when determining which namespaces to search. 
23293: 3. If a concept map for I can be implicitly defined from an auto concept (14.9.2), S contains the concept 
23294: map generated from the auto concept. Otherwise, S is empty. 
23295: [ Example: 
23296: concept C<typename T> { }
23297: concept D<typename T> { }
23298: namespace N1 {
23299: concept_map C<int> { }
23300: concept_map D<int> { }
23301: } 
23302: namespace N2 {
23303: template<C T> void f(T); // #1
23304: template<C T> requires D<T> void f(T); // #2
23305: template<C T> void g(T x) {
23306: f(x);
23307: }
23308: using N1::concept_map C<int>;
23309: void h() {
23310: g(1); // inside g＊s call to f, concept map lookup for D<int> finds N1::D<int>; calls #2
23311: }
23312: }
23313: 〞end example ] 
23314: 7 In all other cases (excluding during the instantiation of a constrained template and template argument 
23315: deduction during partial ordering), Q is defined as the ordered sequence: 
23316: 1. S is formed by performing unqualified name lookup (3.4.1) for N. 
23317: 2. S is the set of concept maps and concept map templates found by searching for N in the namespace 
23318: of which the concept of I is a member and its associated namespaces (7.3.1); using-directives in these 
23319: namespaces are not followed during this search and all names found by way of using-declarations are 
23320: ignored. 
23321: 3. If a concept map for I can be implicitly defined (14.9.2), S contains the implicitly-defined concept map 
23322: for I. Otherwise, S is empty. 
23323: 8 [ Note: When concept map lookup is performed within a constrained context (14.10), concept map archetypes, 
23324: whose names are placed at the same scope as template parameters, can be found by unqualified lookup. 
23325: Concept map lookup does not require the definition of a concept map archetype that it finds. 〞end note ] 
23326: ∫ 14.10.1.1 413 
23327: 
23328: c
23329: . ISO/IEC N2800=08-0310 
23330: 9 If concept map lookup finds a matching concept map in a set S within Q, concept map lookup succeeds and 
23331: the remaining elements of Q are ignored. [ Note: The ordering of name-finding methods in Q can effect a 
23332: kind of "concept map hiding" behavior. [ Example: 
23333: namespace N1 {
23334: concept C<typename T> { }
23335: concept_map C<int> { } // #1
23336: template<C T> void f(T x);
23337: }
23338: namespace N2 {
23339: concept_map N1::C<int> { } // #2 
23340: namespace N3 {
23341: concept_map N1::C<int> { } // #3
23342: void g() {
23343: N1::f(1); // uses #3 to satisfy concept requirement N1::C<int>
23344: }
23345: }
23346: }
23347: 〞end example ] 〞end note ] 
23348: 10 [ Note: Concept maps declared in the namespace of the concept itself will be found last by concept map 
23349: lookup. [ Example: 
23350: namespace N1 {
23351: concept C<typename T> { }
23352: concept_map C<int> { }
23353: }
23354: template<N1::C T> void f(T x);
23355: void g() {
23356: f(1); // Ok, finds N1::concept_map C<int> because it is in the same namespace as concept N1::C. 
23357: } 
23358: 〞end example ] 〞end note ] 
23359: 11 If a concept requirement appears (directly or indirectly) multiple times in the requirements of the template, 
23360: and if the concept maps (14.9.2) used to satisfy the multiple occurrences of the concept requirement are not 
23361: the same concept map or are different from the concept map that would be determined by concept map 
23362: lookup (14.10.1.1), then the template arguments do not satisfy the requirements of the template. [ Note: 
23363: This does not necessarily imply that the program is ill-formed. 〞end note ][ Example: 
23364: concept A<typename T> { } 
23365: concept B<typename T> {
23366: typename X;
23367: requires A<X>;
23368: } 
23369: concept C<typename T> {
23370: typename X;
23371: requires A<X>;
23372: } 
23373: namespace N1 {
23374: concept_map A<int> { } // #1
23375: concept_map B<int> { } // uses #1 to satisfy the requirement for A<int>
23376: } 
23377: ∫ 14.10.1.1 414 
23378: 
23379: c
23380: . ISO/IEC N2800=08-0310 
23381: namespace N2 {
23382: concept_map A<int> { } // #2
23383: concept_map C<int> { } // uses #2 to satisfy the requirement for A<int>
23384: }
23385: template<typename T> requires B<T> && C<T>
23386: struct S { };
23387: using N1::concept_map B<int>;
23388: using N2::concept_map C<int>;
23389: S<int> s; // ill-formed, two different concept maps for A<int>, #1 and #2
23390: 〞end example ] 
23391: 14.10.1.2 Requirement implication [temp.req.impl] 
23392: 1 The declaration of a constrained template implies additional template requirements that are available within 
23393: the body of the template. Template requirements are implied from: 
23394: 〞 the type of a constrained function template, 
23395: 〞 the template arguments of a constrained class template partial specialization, 
23396: 〞 the template arguments of a concept map template, 
23397: 〞 the template parameters of a constrained template, 
23398: 〞 the requirements of a constrained template (including implied requirements), 
23399: 〞 the associated requirements and refinements of a concept, and 
23400: 〞 the type of an associated function requirement. 
23401: 2 A requirement is only implied if that requirement is not already present in the template requirements. 
23402: 3 For every concept requirement in a template＊s requirements (including implied requirements), requirements 
23403: for the refinements and associated requirements of the concept named by the concept instance (14.9.3, 
23404: 14.9.1.3) are implied. 
23405: 4 The formation of types within certain parts of the declaration of a constrained template (described above) 
23406: implies the template requirements needed to ensure that the types themselves are well-formed within any 
23407: instantiation. The following type constructions imply template requirements: 
23408: 〞 For every template-id X<A1, A2, ..., AN >, where X is a constrained template, the requirements of 
23409: X (after substitution of the arguments A1, A2, ..., AN ) are implied. [ Example: 
23410: template<LessThanComparable T> class set { /. ...  / }; 
23411: template<CopyConstructible T>
23412: void maybe_add_to_set(std::set<T>& s, const T& value);
23413: // use of std::set<T> implicitly adds requirement LessThanComparable<T>
23414: 〞end example ] 
23415: 〞 For every type cv T that is used as the type of a variable, where T aliases an archetype, the concept 
23416: requirement VariableType<T> is implied. 
23417: 〞 For every type ※pointer to cv T§, where T aliases a type archetype, the concept requirement PointeeType<T> 
23418: is implied. 
23419: ∫ 14.10.1.2 415 
23420: 
23421: c
23422: . ISO/IEC N2800=08-0310 
23423: 〞 For every type ※reference to cv T§, where T aliases a type archetype, the concept requirement ReferentType<T> 
23424: is implied. 
23425: 〞 For every type ※pointer to member of X of type cv T§: 
23426: 〞 If X aliases a type archetype, the concept requirement ClassType<X> is implied. 
23427: 〞 If T aliases a type archetype, the concept requirement MemberPointeeType<T> is implied. 
23428: 〞 For every type ※array of unknown bound of T§ or ※array of N T§ where T aliases a type archetype, the 
23429: concept requirement ValueType<T> is implied. 
23430: 〞 For every type cv T that occurs as the return type of a function, where T aliases an archetype, the 
23431: concept requirement Returnable<T> is implied. 
23432: 〞 For every type T that is used as the type of a non-type template parameter, where T aliases an archetype, 
23433: the concept requirement NonTypeTemplateParameterType<T> is implied. 
23434: 〞 For every type T that is a parameter type or return type of a constexpr function, where T aliases an 
23435: archetype, the concept requirement LiteralType<T> is implied. 
23436: 〞 For every qualified-id that names an associated type or class template, a concept requirement for the 
23437: concept instance containing that associated type or class template is implied. [ Example: 
23438: concept Addable<typename T, typename U> {
23439: CopyConstructible result_type;
23440: result_type operator+(T, U);
23441: } 
23442: template<CopyConstructible T, CopyConstructible U>
23443: Addable<T, U>::result_type // implies Addable<T, U>
23444: add(T t, U u) {
23445: return t + u;
23446: }
23447: 〞end example ]
23448: [ Example:
23449: concept C<typename T> { typename assoc; } 
23450: template<typename T>
23451: requires C<T>
23452: C<T>::assoc // implies Returnable<C<T>::assoc>
23453: f(T*, T&); // implies PointeeType<T> and ReferentType<T>
23454: 〞end example ] 
23455: 5 In the definition of a constrained class template partial specialization, the requirements of its primary class 
23456: template (14.5.5), after substitution of the template arguments of the class template partial specialization, 
23457: are implied. If this substitution results in a requirement that does not depend on any template parameter, 
23458: then the requirement must be satisfied (14.10.1); otherwise, the program is ill-formed. [ Example: 
23459: template<typename T>
23460: requires EqualityComparable<T>
23461: class simple_set { };
23462: template<std::ObjectType T>
23463: class simple_set<T*> // implies EqualityComparable<T*>
23464: ∫ 14.10.1.2 416 
23465: 
23466: c
23467: . ISO/IEC N2800=08-0310 
23468: {
23469: };
23470: 〞end example ] 
23471: 6 The template requirements for two templates are identical if they contain the same concept, negative, and 
23472: same-type requirements in arbitrary order. Two requirements are the same if they have the same kind, name 
23473: the same concept, and have the same template argument lists. 
23474: 14.10.2 Archetypes [temp.archetype] 
23475: 1 An archetype is a non-dependent type, template, or value whose behavior is defined by the template re-
23476: quirements (14.10.1) of its constrained template. Within a constrained context (14.10), a type, value, or 
23477: template that has an established archetype (described below) behaves as if it were its archetype. [ Note: 
23478: this substitution of archetypes (which are not dependent) for their corresponding types, templates, or values 
23479: (which would be dependent in an unconstrained template) effectively treats all types, templates, and values 
23480: (and therefore both expressions and names) in a constrained context as ※non-dependent§. 〞end note ] 
23481: 2 The archetype of a type is a type, the archetype of a template is a class template, and the archetype of a 
23482: value is a value. 
23483: 3 A type in a constrained context aliases an archetype if it is: 
23484: 〞 a template type parameter (14.1), 
23485: 〞 an associated type (14.9.1.2), or 
23486: 〞 a class template specialization involving one or more archetypes. 
23487: 4 A template in a constrained context aliases an archetype if it is: 
23488: 〞 a template template parameter (14.1) or 
23489: 〞 an associated class template (14.9.1.2). 
23490: 5 A value in a constrained context aliases an archetype if it is a constant-expression (5.19) whose value depends 
23491: on a template parameter. Two values that alias archetypes are the same if their expressions are equivalent 
23492: (14.5.6.1). If the translation of the program requires comparison of two values that alias archetypes and are 
23493: functionally equivalent but not equivalent, the program is ill-formed, no diagnostic required. 
23494: 6 If two types, T1 and T2, both alias archetypes and are the same (e.g., due to one or more same-type 
23495: requirements (14.10.1)), then T1 and T2 alias the same archetype T0.[ Note: there is no mechanism to 
23496: specify the relationships between different value archetypes, because such a mechanism would introduce the 
23497: need for equational reasoning within the translation process. 〞 end note ] 
23498: 7 An archetype does not exist until it is established. An archetype becomes established under the following 
23499: circumstances: 
23500: 〞 when it is used in the template argument list of a class template specialization or concept instance 
23501: whose definition is required, 
23502: 〞 at the end of the function declarator in a function declaration in which one or more parameters use a 
23503: type that aliases the archetype, or 
23504: 〞 the archetype is used in a context where a complete type is required. 
23505: 8 If a same-type requirement attempts to make two types equivalent that both alias established archetypes 
23506: but do not alias the same archetype, the program is ill-formed. 
23507: ∫ 14.10.2 417 
23508: 
23509: c
23510: . ISO/IEC N2800=08-0310 
23511: 9 In the declaration of a constrained member, member template, or nested class, archetypes are established 
23512: as if the member were the only member of its class. [ Note: This means that members that come before 
23513: the constrained member, member template, or nested class cannot prevent the expression of additional 
23514: requirements on template parameters from enclosing scopes. 〞end note ][ Example: Given: 
23515: concept C1<typename T> { }
23516: concept C2<typename T> { }
23517: concept C3<typename T> { }
23518: template <C1 T> class X {
23519: requires C2<T> void g(T) {}
23520: class B {
23521: void g(T) {}
23522: requires C3<T> void f(T) {}
23523: };
23524: };
23525: X::g is evaluated as if in the context: 
23526: template <C1 T> class X {
23527: requires C2<T> void g(T) {}
23528: };
23529: and X::B::g is evaluated as if in the context: 
23530: template <C1 T> class X {
23531: class B {
23532: requires C3<T> void f(T) {}
23533: };
23534: };
23535: 〞end example ] 
23536: 10 An archetype T has the requirement of a given concept instance if T appears in the template argument list 
23537: of the concept instance when that concept instance appears in a requirement whose potential scope encloses 
23538: a region where the archetype T is used. [ Example: 
23539: concept C<typename T> {}
23540: template <C T> void f( T ) {}
23541: Beginning at the declaration of T until the closing curly brace of the definition of f(T) above, we say that 
23542: T ※has the requirement C<T>§. 〞end example ] 
23543: 11 An archetype is synthesized from the template requirements of the constrained template in which it is 
23544: defined; see 14.10.2.1. 
23545: 12 If two associated member function or member function template requirements that name a constructor or 
23546: destructor for a type T have the same signature, the duplicate signature is ignored. 
23547: 13 If a class template specialization is an archetype that does not appear as a template argument of any 
23548: explicitly-specified requirement in the template requirements and whose template is not itself an archetype, 
23549: then the archetype is an instantiated archetype. An instantiated archetype is an archetype whose definition 
23550: is provided by the instantiation of its template with its template arguments (which involve archetypes). 
23551: The template shall not be an unconstrained template. [ Note: Partial ordering of class template partial 
23552: specializations (14.5.5.2) depends on the properties of the archetypes, as defined by the requirements of 
23553: the constrained template. When the constrained template is instantiated (14.10.4), partial ordering of class 
23554: ∫ 14.10.2 418 
23555: 
23556: c
23557: . ISO/IEC N2800=08-0310 
23558: template partial specializations occurs a second time based on the actual template arguments. 〞 end note ] 
23559: [ Example: 
23560: template<EqualityComparable T> 
23561: struct simple_multiset {
23562: bool includes(const T&);
23563: void insert(const T&);
23564: // ... 
23565: }; 
23566: template<LessThanComparable T> 
23567: struct simple_multiset<T> { // A
23568: bool includes(const T&);
23569: void insert(const T&);
23570: // ... 
23571: }; 
23572: template<LessThanComparable T> 
23573: bool first_access(const T& x) { 
23574: static simple_multiset<T> set; // instantiates simple_multiset<T0>, where T. is the archetype of T , 
23575: // from the partial specialization of simple_multiset marked ＊A＊ 
23576: return set.includes(x)? false : (set.insert(x), true); 
23577: } 
23578: 〞end example ] 
23579: [ Note: Class template specializations for which template requirements are specified behave as normal 
23580: archetypes. 〞 end note ][ Example: 
23581: auto concept CopyConstructible<typename T> {
23582: T::T(const T&);
23583: }
23584: template<CopyConstructible T> struct vector; 
23585: auto concept VectorLike<typename X> {
23586: typename value_type = typename X::value_type;
23587: X::X();
23588: void X::push_back(const value_type&);
23589: value_type& X::front();
23590: }
23591: template<CopyConstructible T>
23592: requires VectorLike<vector<T>> // vector<T> is an archetype (but not an instantiated archetype)
23593: void f(const T& value) {
23594: vector<T> x; // OK: default constructor in VectorLike<vector<T> >
23595: x.push_back(value); // OK: push_back in VectorLike<vector<T> >
23596: VectorLike<vector<T>>::value_type& val = x.front(); // OK: front in VectorLike<vector<T> >
23597: } 
23598: 〞end example ] 
23599: 14 [ Note: Constrained class templates involving recursive definitions are ill-formed if the recursive class template 
23600: specialization is an instantiated archetype. Constrained class templates involving recursive definitions can 
23601: be specified by adding template requirements on the recursive class template specializations, making them 
23602: archetypes that are not instantiated archetypes. [ Example: 
23603: ∫ 14.10.2 419 
23604: 
23605: c
23606: . ISO/IEC N2800=08-0310 
23607: template<CopyConstructible... T> class tuple; 
23608: template<CopyConstructible Head, CopyConstructible... Tail> 
23609: class tuple<Head, Tail...> : tuple<Tail...> // ill-formed: tuple<Tail...> is an instantiated archetype, 
23610: // but it is an incomplete type 
23611: {
23612: Head head;
23613: // ... 
23614: }; 
23615: template<> class tuple<> { /. ...  / }; 
23616: 〞end example ] 〞end note ] 
23617: 15 In a constrained context, for each concept requirement that is stated in or implied by the corresponding 
23618: requirements, a concept map archetype for that requirement is synthesized by substituting the archetype of 
23619: T for each occurrence of T within the template arguments of the requirement. The concept map archetype 
23620: acts as a concept map, and its definition is used to resolve name lookup into requirements scope (3.3.8) and 
23621: satisfy the requirements of templates used inside the constrained context. When the definition of a concept 
23622: map archetype is required, it is synthesized from the definition of its corresponding concept (14.9.2). An 
23623: implementation shall not define a concept map archetype unless the definition of that concept map archetype 
23624: is required. [ Example: 
23625: concept SignedIntegral<typename T> {
23626: T::T(const T&);
23627: T operator-(T);
23628: } 
23629: concept RandomAccessIterator<typename T> {
23630: SignedIntegral difference_type;
23631: difference_type operator-(T, T);
23632: } 
23633: template<SignedIntegral T> T negate(const T& t) { return -t; } 
23634: template<RandomAccessIterator Iter> 
23635: RandomAccessIterator<Iter>::difference_type distance(Iter f, Iter l) {
23636: typedef RandomAccessIterator<Iter>::difference_type D;
23637: D dist = f -l; // OK: -operator resolves to synthesized operator-in
23638: // the concept map archetype RandomAccessIterator<Iter0>, 
23639: // where Iter. is the archetype of Iter 
23640: return negate(dist);// OK, concept map archetype RandomAccessIterator<Iter0>
23641: // implies the concept map archetype SignedIntegral<D0>,
23642: // where D. is the archetype of D
23643: 〞end example ] 
23644: 14.10.2.1 Assembling archetypes [temp.archetype.assemble] 
23645: 1 A type archetype is a unique generated class type whose special member functions are each either user-
23646: provided or deleted (depending on template requirements) and whose other members are given entirely by 
23647: its template requirements. A type archetype is considered to be completely defined when it is established 
23648: (although it may later acquire additional members as a result of additional requirements). 
23649: 2 The archetype T. of T contains a public member function or member function template corresponding to each 
23650: member function or member function template of each concept map archetype corresponding to a concept 
23651: requirement that names T (14.10.1). [ Example: 
23652: ∫ 14.10.2.1 420 
23653: 
23654: c
23655: . ISO/IEC N2800=08-0310 
23656: concept CopyConstructible<typename T> {
23657: T::T(const T&);
23658: }
23659: concept MemSwappable<typename T> {
23660: void T::swap(T&);
23661: }
23662: template<typename T>
23663: requires CopyConstructible<T> && MemSwappable<T>
23664: void foo(T& x) {
23665: // archetype T. of T contains a copy constructor T0::T0(const T0&) from CopyConstructible<T>
23666: // and a member function void swap(T0&) from MemSwappable<T>
23667: T y(x);
23668: y.swap(x);
23669: } 
23670: 〞end example ] 
23671: 3 If no requirement specifies a copy constructor for a type T, a copy constructor is implicitly declared (12.8) 
23672: in the archetype of T with the following signature: 
23673: T(const T&) = delete; 
23674: [ Example: 
23675: concept DefaultConstructible<typename T> {
23676: T::T();
23677: }
23678: concept MoveConstructible<typename T> {
23679: T::T(T&&);
23680: }
23681: template<typename T>
23682: requires DefaultConstructible<T> && MoveConstructible<T>
23683: void f(T x) {
23684: T y = T(); // OK: move-constructs y from default-constructed T
23685: T z(x); // error: overload resolution selects implicitly-declared
23686: // copy constructor, which is deleted
23687: } 
23688: 〞end example ] 
23689: 4 If no requirement specifies a copy assignment operator for a type T, a copy assignment operator is implicitly 
23690: declared (12.8) in the archetype of T with the following signature: 
23691: T& T::operator=(const T&) = delete; 
23692: 5 If no requirement specifies a destructor for a type T, a destructor is implicitly declared (12.4) in the archetype 
23693: of T with the following signature: 
23694: ~T() = delete; 
23695: 6 If no requirement specifies a unary & operator for a type T, a unary member operator & is implicitly declared 
23696: in the archetype of T for each cv that is a valid cv-qualifier-seq: 
23697: ∫ 14.10.2.1 421 
23698: 
23699: c
23700: . ISO/IEC N2800=08-0310 
23701: cv T* operator&() cv = delete; 
23702: 7 For each of the allocation functions new, new[], delete, and delete[] (12.5), if no requirement specifies the 
23703: corresponding operator with a signature below, that allocation function is implicitly declared as a member 
23704: function in the archetype T. of T with the corresponding signature from the following list: 
23705: static void* T0::operator new(std::size_t) = delete;
23706: static void* T0::operator new(std::size_t, void*) = delete;
23707: static void* T0::operator new(std::size_t, const std::nothrow_t&) throw() = delete;
23708: static void* T0::operator new[](std::size_t) = delete;
23709: static void* T0::operator new[](std::size_t, void*) = delete;
23710: static void* T0::operator new[](std::size_t, const std::nothrow_t&) throw() = delete;
23711: static void T0::operator delete(void*) = delete;
23712: static void T0::operator delete(void*, void*) = delete;
23713: static void T0::operator delete(void*, const std::nothrow_t&) throw() = delete;
23714: static void T0::operator delete[](void*) = delete;
23715: static void T0::operator delete[](void*, void*) = delete;
23716: static void T0::operator delete[](void*, const std::nothrow_t&) throw() = delete;
23717: 8 If the template requirements contain a requirement std::DerivedFrom<T, Base>, then the archetype of T is 
23718: publicly derived from the archetype of Base. If the same std::DerivedFrom<T, Base> requirement occurs 
23719: more than once within the template requirements, the repeated std::DerivedFrom<T, Base> requirements 
23720: are ignored. 
23721: 14.10.3 Candidate sets [temp.constrained.set] 
23722: 1 A candidate set is a set containing functions and function templates that is determined by a seed (defined 
23723: below). A candidate set is defined in a constrained context (a retained candidate set, 14.10.4) or as the 
23724: result of satisfying an associated function requirement in a concept map (an associated function candidate 
23725: set, 14.9.2.1). Candidate sets are used to capture a set of candidate functions that are used in the instanti-
23726: ation of a constrained template (14.10.4) or when referring to members in a concept map (14.9.2). [ Note: 
23727: For the purposes of this section, candidate operator functions (13.6) are considered functions. 〞end note ] 
23728: 2 Each candidate set has a seed, which provides the basis for the candidate set itself. All functions and function 
23729: templates that are consistent with the seed are contained in the candidate set. The seed is determined as 
23730: part of the definition of the candidate set, and will be one of: 
23731: 〞 a function, 
23732: 〞 the initialization of an object (8.5), or 
23733: 〞a pseudo-destructor-name (5.2.4). 
23734: 3 A function is consistent with the seed if all of the following apply: 
23735: 〞 it has the same name as the seed, 
23736: 〞 its enclosing namespace is the same as the enclosing namespace of the seed, 
23737: 〞 the seed has a return type of cv void or the function has the same return type as the seed, after the 
23738: reference (if any) and then top-level cv-qualifiers (if any) have been removed from the return types of 
23739: the seed and the function, and 
23740: 〞 it has the same parameter-type-list as the seed, after making the following adjustments to both 
23741: parameter-type-list s: 
23742: 〞 for a non-static member function, add the implicit object parameter (13.3.1) as the first parameter 
23743: in the parameter-type-list, 
23744: ∫ 14.10.3 422 
23745: 
23746: c
23747: . ISO/IEC N2800=08-0310 
23748: 〞 for each parameter type, remove the top-level reference (if any) and then top-level cv-qualifiers 
23749: (if any), 
23750: 〞 if the function has M parameters, the seed has N parameters, and M >N, remove each of the 
23751: last M. N parameters that has a default argument from the parameter-type-list, and 
23752: 〞 remove the ellipsis, if any. 
23753: [ Note: No function or function template is consistent with a non-function seed. A seed that is a function is 
23754: consistent with itself. 〞end note ] 
23755: 4 A function template is consistent with the seed if all of the following apply: 
23756: 〞 it has the same name as the seed, 
23757: 〞 its enclosing namespace is the same as the enclosing namespace of the seed, and 
23758: 〞 if the candidate set containing the seed is a retained candidate set, the function template is a con-
23759: strained function template. 
23760: 5 A candidate set is a set of overloaded functions. Overload resolution (13.3) for a candidate set is subject to 
23761: the following additional conditions: 
23762: 〞 the set of candidate functions for overload resolution is the set of functions in the candidate set, and 
23763: 〞 if template argument deduction on a candidate function produces a function template specialization 
23764: that is not consistent with the seed of the candidate set, the function template specialization is not a 
23765: viable function (13.3.2). 
23766: 14.10.4 Instantiation of constrained templates [temp.constrained.inst] 
23767: 1 Instantiation of a constrained template replaces each template parameter within the definition of the template 
23768: with its corresponding template argument, using the same process as for unconstrained templates (14.7). 
23769: 2 Instantiation of a constrained template also replaces each concept map archetype with the concept map that 
23770: satisfied the corresponding template requirement. [ Note: A concept member that had resolved to a member 
23771: of a concept map archetype now refers to a member of the corresponding concept map. 〞end note ] 
23772: 3 In the instantiation of a constrained template, a call to a function that resolves to an associated function in 
23773: a concept map archetype (14.10.2) is instantiated using the associated function candidate set (14.10.3) that 
23774: satisfies the corresponding associated function requirement in the concept map that replaces the concept 
23775: map archetype. The instantiated form depends on the seed of the associated function candidate set and the 
23776: syntactic form that resulted in the call in the constrained template: 
23777: 〞 If the seed is a function, the instantiated form is a call to the associated function candidate set. 
23778: [ Example: 
23779: concept F<typename T> {
23780: T::T();
23781: void f(T const&);
23782: } 
23783: template<typename T> requires F<T> 
23784: void g(T const& x) {
23785: f(x); // calls F<T>::f. When instantiated with T=X, calls #1
23786: f(T()); // calls F<T>::f. When instantiated with T=X, calls #2
23787: } 
23788: ∫ 14.10.4 423 
23789: 
23790: c
23791: . ISO/IEC N2800=08-0310 
23792: struct X {};
23793: void f(X const&); // #1
23794: void f(X&&); // #2
23795: concept_map F<X> { } // associated function candidate set for
23796: // f(X const&) contains #1 and #2, seed is #1
23797: void h(X const& x) {
23798: g(x);
23799: }
23800: 〞end example ] 
23801: 〞 Otherwise, if the seed is a pseudo-destructor-name, the instantiated form is a pseudo destructor call 
23802: (5.2.4). 
23803: 〞 Otherwise, if the seed is the initialization of an object, the instantiated form is the appropriate kind of 
23804: initialization (zero-initialization, default-initialization, value-initialization, or no initialization) based 
23805: on the syntactic form in the constrained template. [ Example: 
23806: auto concept DefaultConstructible<typename T> {
23807: T::T();
23808: }
23809: template<DefaultConstructible T> 
23810: void f() {
23811: T t1; // type-checks as a call to DefaultConstructible<T>＊s T::T()
23812: T t2{}; // type-checks as a call to DefaultConstructible<T>＊s T::T()
23813: } 
23814: template void f<int>(); // t1 is not initialized, t2 is value-initialized 
23815: 〞end example ] 
23816: 4 A use of a function template specialization in a constrained template instantiates to a reference to that 
23817: function template specialization＊s retained candidate set. The retained candidate set is a candidate set 
23818: (14.10.3) whose seed is the function template specialization. [ Example: 
23819: concept InputIterator<typename Iter> { 
23820: typename difference_type;
23821: }
23822: concept BidirectionalIterator<typename Iter> : InputIterator<Iter> { }
23823: concept RandomAccessIterator<typename Iter> : BidirectionalIterator<Iter> { }
23824: template<InputIterator Iter>
23825: void advance(Iter& i, Iter::difference_type n); // #1
23826: template<BidirectionalIterator Iter>
23827: void advance(Iter& i, Iter::difference_type n); // #2
23828: template<BidirectionalIterator Iter> void f(Iter i) {
23829: advance(i, 1); // seed function is #2
23830: }
23831: concept_map RandomAccessIterator<int*> {
23832: typedef std::ptrdiff_t difference_type;
23833: }
23834: ∫ 14.10.4 424 
23835: 
23836: c
23837: . ISO/IEC N2800=08-0310 
23838: template<RandomAccessIterator Iter>
23839: void advance(Iter& i, Iter::difference_type n); // #3
23840: void g(int* i) { 
23841: f(i); // in the call to advance(), #2 is the seed of the
23842: // retained candidate set, the retained candidate set
23843: // contains #1, #2, and #3, and partial ordering of
23844: // function templates selects #3.
23845: } 
23846: 〞end example ] 〞end note ] 
23847: 5 When a function call in the instantiation of a constrained template is instantiated as a call to a candidate 
23848: set (14.10.3), the user-defined conversions applied to the function call arguments in the call to the seed are 
23849: applied in the call to the candidate set in the instantiation. When such a user-defined conversion is applied 
23850: to an instantiated function call argument, it acts as the user-defined conversion sequence (13.3.3.1.2) for that 
23851: argument. [ Note: the user-defined conversion sequence may still be preceded and followed by a standard 
23852: conversion sequence. 〞end note ][ Example: 
23853: concept C<typename T> {
23854: operator int(const T&);
23855: };
23856: class A { }; 
23857: concept_map C<A> {
23858: operator int(const A&) { return 0; }
23859: }
23860: void f(int); 
23861: template<C T> void f(const T& x) {
23862: f(x); // OK: implicit, user-defined conversion from T to int
23863: }
23864: template void f<A>(const A&); // OK: call f(x) applies the implicit, user-defined 
23865: // conversion from the template definition using C<A>::operator int. 
23866: 〞end example ] 
23867: 6 In the instantiation of a constrained template, a template specialization whose template arguments involve 
23868: the constrained template＊s template parameters (14.10.2) is replaced by the template specialization that 
23869: results from substituting the constrained template＊s template arguments for their corresponding template 
23870: parameters. [ Note: If the template specialization is a template alias (14.5.7), the substitution occurs in the 
23871: type-id of the template alias. 〞end note ] The resulting type (call it A) shall be compatible with the type 
23872: involving the template parameters (call it A0) that it replaced, otherwise the program is ill-formed. The 
23873: template specializations are compatible if all of the following conditions hold: 
23874: 〞 for each function, function template, or data member m of A. referenced by the constrained template, 
23875: there exists a member named m in A that is accessible from the constrained template and whose type, 
23876: storage specifiers, template parameters (if any), and template requirements (if any) are the same as the 
23877: those of A0::m after substituting the constrained template＊s template arguments for the corresponding 
23878: template parameters, 
23879: ∫ 14.10.4 425 
23880: 
23881: c
23882: . ISO/IEC N2800=08-0310 
23883: 〞 for each member type t of A. referenced by the constrained template, there exists a member type t in 
23884: A that is accessible from the constrained template and is compatible with the member type A0::t as 
23885: specified herein, and 
23886: 〞 for each base class B. of A. referenced by a derived-to-base conversion (4.10) in the constrained tem-
23887: plate, there exists an unambiguous base class B of A that is accessible from the constrained template, 
23888: where B is the type produced by substituting the constrained template＊s template parameters with the 
23889: corresponding template arguments in B0. 
23890: [ Example: 
23891: auto concept CopyConstructible<typename T> {
23892: T::T(const T&);
23893: }
23894: template<CopyConstructible T> 
23895: struct vector { // A
23896: vector(int, T const &);
23897: T& front();
23898: }; 
23899: template<typename T> 
23900: struct vector<T*> { // B
23901: vector(int, T* const &);
23902: T*& front();
23903: }; 
23904: template<> 
23905: struct vector<bool> { // C
23906: vector(int, bool);
23907: bool front();
23908: }; 
23909: template<CopyConstructible T> 
23910: void f(const T& x) {
23911: vector<T> vec(1, x);
23912: T& ref = vec.front();
23913: } 
23914: void g(int i, int* ip, bool b) { 
23915: f(i); // OK: instantiation of f<int> uses vector<int>, instantiated from A 
23916: f(ip); // OK: instantiation of f<int*> uses vector<int*>, instantiated from B 
23917: f(b); // ill-formed, detected in the instantiation of f<bool>, which uses the vector<bool> specialization 
23918: C: 
23919: // vector<bool>::front is not compatible with vector<T>::front (where T is bool)
23920: }
23921: 〞end example ] 
23922: ∫ 14.10.4 426 
23923: 
23924: . ISO/IEC N2800=08-0310 
23925: 15 Exception handling [except]
23926: 1 Exception handling provides a way of transferring control and information from a point in the execution of a 
23927: program to an exception handler associated with a point previously passed by the execution. A handler will 
23928: be invoked only by a throw-expression invoked in code executed in the handler＊s try block or in functions 
23929: called from the handler＊s try block . 
23930: try-block:
23931: try compound-statement handler-seq
23932: function-try-block:
23933: try ctor-initializeropt compound-statement handler-seq
23934: handler-seq:
23935: handler handler-seqopt
23936: handler:
23937: catch ( exception-declaration ) compound-statement
23938: exception-declaration:
23939: type-specifier-seq declarator
23940: type-specifier-seq abstract-declarator
23941: type-specifier-seq
23942: ... 
23943: throw-expression:
23944: throw assignment-expressionopt
23945: 2 A try-block is a statement (Clause 6). A throw-expression is of type void. Code that executes a throw-
23946: expression is said to ※throw an exception;§ code that subsequently gets control is called a ※handler.§ [ Note: 
23947: within this Clause ※try block§ is taken to mean both try-block and function-try-block. 〞end note ] 
23948: 3 A goto or switch statement shall not be used to transfer control into a try block or into a handler. 
23949: [ Example: 
23950: void f() {
23951: goto l1;
23952: goto l2;
23953: try {
23954: goto l1; 
23955: goto l2; 
23956: l1: ; 
23957: } catch (...) { 
23958: l2: ; 
23959: goto l1; 
23960: goto l2; 
23961: }
23962: }
23963: // Ill-formed 
23964: // Ill-formed 
23965: // OK 
23966: // Ill-formed 
23967: // Ill-formed 
23968: // OK 
23969: 〞end example ]A goto, break, return, or continue statement can be used to transfer control out of a 
23970: try block or handler. When this happens, each variable declared in the try block will be destroyed in the 
23971: context that directly contains its declaration. [ Example: 
23972: lab: try {
23973: T1 t1;
23974: 427 
23975: 
23976: c
23977: . ISO/IEC N2800=08-0310 
23978: try {
23979: T2 t2;
23980: if (condition)
23981: goto lab;
23982: } catch(...) { /. handler 2  / }
23983: } catch(...) { /. handler 1  / }
23984: Here, executing goto lab; will destroy first t2, then t1, assuming the condition does not declare a variable. 
23985: Any exception raised while destroying t2 will result in executing handler 2; any exception raised while 
23986: destroying t1 will result in executing handler 1. 〞end example ] 
23987: 4 A function-try-block associates a handler-seq with the ctor-initializer, if present, and the compound-statement. 
23988: An exception thrown during the execution of the initializer expressions in the ctor-initializer or during the 
23989: execution of the compound-statement transfers control to a handler in a function-try-block in the same way 
23990: as an exception thrown during the execution of a try-block transfers control to other handlers. [ Example: 
23991: int f(int); 
23992: class C {
23993: int i;
23994: double d;
23995: public:
23996: C(int, double);
23997: };
23998: C::C(int ii, double id)
23999: try : i(f(ii)), d(id) {
24000: // constructor statements 
24001: }
24002: catch (...) {
24003: // handles exceptions thrown from the ctor-initializer
24004: // and from the constructor statements
24005: } 
24006: 〞end example ] 
24007: 15.1 Throwing an exception [except.throw] 
24008: 1 Throwing an exception transfers control to a handler. An object is passed and the type of that object 
24009: determines which handlers can catch it. [ Example: 
24010: throw "Help!"; 
24011: can be caught by a handler of const char* type: 
24012: try { 
24013: // ... 
24014: }
24015: catch(const char* p) {
24016: // handle character string exceptions here 
24017: } 
24018: and 
24019: class Overflow {
24020: public:
24021: Overflow(char,double,double);
24022: };
24023: ∫ 15.1 428 
24024: 
24025: c
24026: . ISO/IEC N2800=08-0310 
24027: void f(double x) {
24028: throw Overflow(＊+＊,x,3.45e107);
24029: } 
24030: can be caught by a handler for exceptions of type Overflow 
24031: try {
24032: f(1.2);
24033: } catch(Overflow& oo) {
24034: // handle exceptions of type Overflow here
24035: } 
24036: 〞end example ] 
24037: 2 When an exception is thrown, control is transferred to the nearest handler with a matching type (15.3); 
24038: ※nearest§ means the handler for which the compound-statement or ctor-initializer following the try keyword 
24039: was most recently entered by the thread of control and not yet exited. 
24040: 3 A throw-expression initializes a temporary object, called the exception object, the type of which is determined 
24041: by removing any top-level cv-qualifiers from the static type of the operand of throw and adjusting the type 
24042: from ※array of T§ or ※function returning T§ to ※pointer to T§ or ※pointer to function returning T§, respectively. 
24043: [ Note: the temporary object created for a throw-expression that is a string literal is never of type char*, 
24044: char16_t*, char32_t*, or wchar_t*; that is, the special conversions for string literals from the types ※array 
24045: of const char§, ※array of const char16_t§, ※array of const char32_t§, and ※array of const wchar_t§ 
24046: to the types ※pointer to char§, ※pointer to char16_t§, ※pointer to char32_t§, and ※pointer to wchar_t§, 
24047: respectively (4.2), are never applied to a throw-expression. 〞 end note ] The temporary is an lvalue and 
24048: is used to initialize the variable named in the matching handler (15.3). The type of the throw-expression 
24049: shall not be an incomplete type, or a pointer to an incomplete type other than (possibly cv-qualified) void. 
24050: Except for these restrictions and the restrictions on type matching mentioned in 15.3, the operand of throw 
24051: is treated exactly as a function argument in a call (5.2.2) or the operand of a return statement. 
24052: 4 The memory for the temporary copy of the exception being thrown is allocated in an unspecified way, except 
24053: as noted in 3.7.4.1. The temporary persists as long as there is a handler being executed for that exception. In 
24054: particular, if a handler exits by executing a throw; statement, that passes control to another handler for the 
24055: same exception, so the temporary remains. When the last remaining active handler for the exception exits 
24056: by any means other than throw; the temporary object is destroyed and the implementation may deallocate 
24057: the memory for the temporary object; any such deallocation is done in an unspecified way. The destruction 
24058: occurs immediately after the destruction of the object declared in the exception-declaration in the handler. 
24059: 5 When the thrown object is a class object, the copy constructor and the destructor shall be accessible, even 
24060: if the copy operation is elided (12.8). 
24061: 6 An exception is considered caught when a handler for that exception becomes active (15.3). [ Note: an 
24062: exception can have active handlers and still be considered uncaught if it is rethrown. 〞end note ] 
24063: 7 A throw-expression with no operand rethrows the currently handled exception (15.3). The exception is 
24064: reactivated with the existing temporary; no new temporary exception object is created. The exception is 
24065: no longer considered to be caught; therefore, the value of std::uncaught_exception() will again be true. 
24066: [ Example: code that must be executed because of an exception yet cannot completely handle the exception 
24067: can be written like this: 
24068: try { 
24069: // ...
24070: } catch (...) { // catch all exceptions
24071: // respond (partially) to exception
24072: ∫ 15.1 429 
24073: 
24074: c
24075: . ISO/IEC N2800=08-0310 
24076: throw; // pass the exception to some
24077: // other handler
24078: } 
24079: 〞end example ] 
24080: 8 If no exception is presently being handled, executing a throw-expression with no operand calls std:: 
24081: terminate() (15.5.1). 
24082: 15.2 Constructors and destructors [except.ctor] 
24083: 1 As control passes from a throw-expression to a handler, destructors are invoked for all automatic objects 
24084: constructed since the try block was entered. The automatic objects are destroyed in the reverse order of the 
24085: completion of their construction. 
24086: 2 An object that is partially constructed or partially destroyed will have destructors executed for all of its 
24087: fully constructed base classes and non-variant members, that is, for subobjects for which the principal 
24088: constructor (12.6.2) has completed execution and the destructor has not yet begun execution. Similarly, 
24089: if the non-delegating constructor for an object has completed execution and a delegating constructor for 
24090: that object exits with an exception, the object＊s destructor will be invoked. If the object was allocated in a 
24091: new-expression, the matching deallocation function (3.7.4.2, 5.3.4, 12.5), if any, is called to free the storage 
24092: occupied by the object. 
24093: 3 The process of calling destructors for automatic objects constructed on the path from a try block to a throw-
24094: expression is called ※stack unwinding.§ [ Note: If a destructor called during stack unwinding exits with an 
24095: exception, std::terminate is called (15.5.1). So destructors should generally catch exceptions and not let 
24096: them propagate out of the destructor. 〞end note ] 
24097: 15.3 Handling an exception [except.handle] 
24098: 1 The exception-declaration in a handler describes the type(s) of exceptions that can cause that handler to 
24099: be entered. The exception-declaration shall not denote an incomplete type. The exception-declaration shall 
24100: not denote a pointer or reference to an incomplete type, other than void*, const void*, volatile void*, 
24101: or const volatile void*. 
24102: 2 A handler of type ※array of T§ or ※function returning T§ is adjusted to be of type ※pointer to T§ or ※pointer 
24103: to function returning T§, respectively. 
24104: 3 A handler is a match for an exception object of type E if 
24105: 〞 The handler is of type cv T or cv T& and E and T are the same type (ignoring the top-level cv-qualifiers), 
24106: or 
24107: 〞 the handler is of type cv T or cv T& and T is an unambiguous public base class of E, or 
24108: 〞 the handler is of type cv1 T* cv2 and E is a pointer type that can be converted to the type of the 
24109: handler by either or both of 
24110: 〞 a standard pointer conversion (4.10) not involving conversions to pointers to private or protected 
24111: or ambiguous classes 
24112: 〞 a qualification conversion 
24113: 〞 the handler is a pointer or pointer to member type and E is std::nullptr_t. 
24114: [ Note: a throw-expression whose operand is an integral constant expression of integer type that evaluates
24115: to zero does not match a handler of pointer or pointer to member type. 〞end note ]
24116: [ Example:
24117: ∫ 15.3 430 
24118: 
24119: c
24120: . ISO/IEC N2800=08-0310 
24121: class Matherr { /. ...  / virtual void vf(); };
24122: class Overflow: public Matherr { /. ...  / };
24123: class Underflow: public Matherr { /. ...  / };
24124: class Zerodivide: public Matherr { /. ...  / };
24125: void f() {
24126: try {
24127: g();
24128: } catch (Overflow oo) {
24129: // ... 
24130: } catch (Matherr mm) { 
24131: // ... 
24132: }
24133: }
24134: Here, the Overflow handler will catch exceptions of type Overflow and the Matherr handler will catch 
24135: exceptions of type Matherr and of all types publicly derived from Matherr including exceptions of type 
24136: Underflow and Zerodivide. 〞end example ] 
24137: 4 The handlers for a try block are tried in order of appearance. That makes it possible to write handlers that 
24138: can never be executed, for example by placing a handler for a derived class after a handler for a corresponding 
24139: base class. 
24140: 5 A ... in a handler＊s exception-declaration functions similarly to ... in a function parameter declaration; 
24141: it specifies a match for any exception. If present, a ... handler shall be the last handler for its try block. 
24142: 6 If no match is found among the handlers for a try block, the search for a matching handler continues in a 
24143: dynamically surrounding try block. 
24144: 7 A handler is considered active when initialization is complete for the formal parameter (if any) of the catch 
24145: Clause. [ Note: the stack will have been unwound at that point. 〞end note ] Also, an implicit handler is 
24146: considered active when std::terminate() or std::unexpected() is entered due to a throw. A handler 
24147: is no longer considered active when the catch Clause exits or when std::unexpected() exits after being 
24148: entered due to a throw. 
24149: 8 The exception with the most recently activated handler that is still active is called the currently handled 
24150: exception. 
24151: 9 If no matching handler is found, the function std::terminate() is called; whether or not the stack is 
24152: unwound before this call to std::terminate() is implementation-defined (15.5.1). 
24153: 10 Referring to any non-static member or base class of an object in the handler for a function-try-block of a 
24154: constructor or destructor for that object results in undefined behavior. 
24155: 11 The fully constructed base classes and members of an object shall be destroyed before entering the handler 
24156: of a function-try-block of a constructor for that object. Similarly, if a delegating constructor for an object 
24157: exits with an exception after the non-delegating constructor for that object has completed execution, the 
24158: object＊s destructor shall be executed before entering the handler of a function-try-block of a constructor for 
24159: that object. The base classes and non-variant members of an object shall be destroyed before entering the 
24160: handler of a function-try-block of a destructor for that object (12.4). 
24161: 12 The scope and lifetime of the parameters of a function or constructor extend into the handlers of a function-
24162: try-block. 
24163: 13 Exceptions thrown in destructors of objects with static storage duration or in constructors of namespace-
24164: scope objects with static storage duration are not caught by a function-try-block on main(). Exceptions 
24165: ∫ 15.3 431 
24166: 
24167: c
24168: . ISO/IEC N2800=08-0310 
24169: thrown in destructors of objects with thread storage duration or in constructors of namespace-scope objects 
24170: with thread storage duration are not caught by a function-try-block on the initial function of the thread. 
24171: 14 If a return statement appearsin a handler of the function-try-block of a constructor, the programis ill-formed. 
24172: 15 The currently handled exception is rethrown if control reaches the end of a handler of the function-try-block 
24173: of a constructor or destructor. Otherwise, a function returns when control reaches the end of a handler for 
24174: the function-try-block (6.6.3). Flowing off the end of a function-try-block is equivalent to a return with no 
24175: value; this results in undefined behavior in a value-returning function (6.6.3). 
24176: 16 When the exception-declaration specifies a class type, a copy constructor is used to initialize either the object 
24177: declared in the exception-declaration or, if the exception-declaration does not specify a name, a temporary 
24178: object of that type. The object shall not have an abstract class type. The object is destroyed when 
24179: the handler exits, after the destruction of any automatic objects initialized within the handler. The copy 
24180: constructor and destructor shall be accessible in the context of the handler. If the copy constructor and 
24181: destructor are implicitly declared (12.8), such a use in the handler causes these functions to be implicitly 
24182: defined; otherwise, the program shall provide a definition for these functions. 
24183: 17 The copy constructor and destructor associated with the object shall be accessible even if the copy operation 
24184: is elided (12.8). 
24185: 18 When the handler declares a non-constant object, any changes to that object will not affect the temporary 
24186: object that was initialized by execution of the throw-expression. When the handler declares a reference to 
24187: a non-constant object, any changes to the referenced object are changes to the temporary object initialized 
24188: when the throw-expression was executed and will have effect should that object be rethrown. 
24189: 15.4 Exception specifications [except.spec] 
24190: 1 A function declaration lists exceptions that its function might directly or indirectly throw by using an 
24191: exception-specification as a suffix of its declarator. 
24192: exception-specification:
24193: throw ( type-id-listopt )
24194: type-id-list:
24195: type-id ...opt
24196: type-id-list , type-id ...opt
24197: 2 An exception-specification shall appear only on a function declarator for a function type, pointer to function 
24198: type, reference to function type, or pointer to member function type that is the top-level type of a declaration 
24199: or definition, or on such a type appearing as a parameter or return type in a function declarator. An 
24200: exception-specification shall not appear in a typedef declaration. [ Example: 
24201: void f() throw(int); // OK
24202: void (*fp)() throw (int); // OK
24203: void g(void pfa() throw(int)); // OK
24204: typedef int (*pf)() throw(int); // ill-formed
24205: 〞end example ] A type denoted in an exception-specification shall not denote an incomplete type. A type 
24206: denoted in an exception-specification shall not denote a pointer or reference to an incomplete type, other 
24207: than void*, const void*, volatile void*, or const volatile void*. 
24208: 3 If any declaration of a function has an exception-specification, all declarations, including the definition and 
24209: an explicit specialization, of that function shall have an exception-specification with the same set of type-
24210: ids. If any declaration of a pointer to function, reference to function, or pointer to member function has 
24211: an exception-specification, all occurrences of that declaration shall have an exception-specification with the 
24212: same set of type-ids. In an explicit instantiation an exception-specification may be specified, but is not 
24213: ∫ 15.4 432 
24214: 
24215: c
24216: . ISO/IEC N2800=08-0310 
24217: required. If an exception-specification is specified in an explicit instantiation directive, it shall have the same 
24218: set of type-ids as other declarations of that function. A diagnostic is required only if the sets of type-ids are 
24219: different within a single translation unit. 
24220: 4 If a virtual function has an exception-specification, all declarations, including the definition, of any function 
24221: that overrides that virtual function in any derived class shall only allow exceptions that are allowed by the 
24222: exception-specification of the base class virtual function. [ Example: 
24223: struct B {
24224: virtual void f() throw (int, double);
24225: virtual void g();
24226: }; 
24227: struct D: B {
24228: void f(); // ill-formed
24229: void g() throw (int); // OK
24230: }; 
24231: The declaration of D::f is ill-formed because it allows all exceptions, whereas B::f allows only int and 
24232: double. 〞end example ] A similar restriction applies to assignment to and initialization of pointers to 
24233: functions, pointers to member functions, and references to functions: the target entity shall allow at least 
24234: the exceptions allowed by the source value in the assignment or initialization. [ Example: 
24235: class A { /. ...  / };
24236: void (*pf1)(); // no exception specification
24237: void (*pf2)() throw(A);
24238: void f() {
24239: pf1 = pf2; // OK: pf1 is less restrictive
24240: pf2 = pf1; // error: pf2 is more restrictive
24241: } 
24242: 〞end example ] 
24243: 5 In such an assignment or initialization, exception-specifications on return types and parameter types shall 
24244: match exactly. In other assignments or initializations, exception-specifications shall match exactly. 
24245: 6 An exception-specification can include the same type more than once and can include classes that are related 
24246: by inheritance, even though doing so is redundant. An exception-specification can also include the class 
24247: std::bad_exception (18.7.2.1). 
24248: 7 A function is said to allow an exception of type E if its exception-specification contains a type T for which a 
24249: handler of type T would be a match (15.3) for an exception of type E. 
24250: 8 Whenever an exception is thrown and the search for a handler (15.3) encounters the outermost block of a 
24251: function with an exception-specification, the function std::unexpected() is called (15.5.2) if the exception-
24252: specification does not allow the exception. [ Example: 
24253: class X { };
24254: class Y { };
24255: class Z: public X { };
24256: class W { };
24257: void f() throw (X, Y) {
24258: int n = 0;
24259: if (n) throw X(); // OK
24260: if (n) throw Z(); // also OK
24261: ∫ 15.4 433 
24262: 
24263: c
24264: . ISO/IEC N2800=08-0310 
24265: throw W(); // will call std::unexpected()
24266: }
24267: 〞end example ] 
24268: 9 The function std::unexpected() may throw an exception that will satisfy the exception-specification for 
24269: which it was invoked, and in this case the search for another handler will continue at the call of the function 
24270: with this exception-specification (see 15.5.2), or it may call std::terminate(). 
24271: 10 An implementation shall not reject an expression merely because when executed it throws or might throw 
24272: an exception that the containing function does not allow. [ Example: 
24273: extern void f() throw(X, Y); 
24274: void g() throw(X) {
24275: f(); // OK
24276: }
24277: the call to f is well-formed even though when called, f might throw exception Y that g does not allow. 
24278: 〞end example ] 
24279: 11 A function with no exception-specification allows all exceptions. A function with an empty exception-
24280: specification, throw(), does not allow any exceptions. 
24281: 12 An exception-specification is not considered part of a function＊s type. 
24282: 13 An implicitly declared special member function (Clause 12) shall have an exception-specification. If f is 
24283: an implicitly declared default constructor, copy constructor, destructor, or copy assignment operator, its 
24284: implicit exception-specification specifies the type-id T if and only if T is allowed by the exception-specification 
24285: of a function directly invoked by f＊s implicit definition; f shall allow all exceptions if any function it directly 
24286: invokes allows all exceptions, and f shall allow no exceptions 
24287: exceptions. [ Example: 
24288: struct A {
24289: A();
24290: A(const A&) throw();
24291: ~A() throw(X);
24292: }; 
24293: struct B {
24294: B() throw();
24295: B(const B&) throw();
24296: ~B() throw(Y);
24297: }; 
24298: struct D : public A, public B {
24299: // Implicit declaration of D::D();
24300: // Implicit declaration of D::D(const D&) throw();
24301: // Implicit declaration of D::D() throw(X,Y);
24302: }; 
24303: if every function it directly invokes allows no 
24304: Furthermore, if A::.A() or B::.B() were virtual, D::.D() would not be as restrictive as that of A::.A, and 
24305: the program would be ill-formed since a function that overrides a virtual function from a base class shall 
24306: have an exception-specification at least as restrictive as that in the base class. 〞end example ] 
24307: ∫ 15.4 434 
24308: 
24309: c
24310: . ISO/IEC N2800=08-0310 
24311: 14 In an exception-specification, a type-id followed by an ellipsis is a pack expansion (14.5.3). 
24312: 15.5 Special functions [except.special] 
24313: 1 The exception handling mechanism relies on two functions, std::terminate() and std::unexpected(), 
24314: for coping with errors related to the exception handling mechanism itself (18.7). 
24315: 15.5.1 The std::terminate() function [except.terminate] 
24316: 1 In the following situations exception handling must be abandoned for less subtle error handling techniques: 
24317: 〞 when the exception handling mechanism, after completing evaluation of the expression to be thrown 
24318: but before the exception is caught (15.1), calls a user function that exits via an uncaught exception,138 
24319: 〞 when the exception handling mechanism cannot find a handler for a thrown exception (15.3), or 
24320: 〞 when the destruction of an object during stack unwinding (15.2) exits using an exception, or 
24321: 〞 when construction or destruction of a non-local object with static or thread storage duration exits 
24322: using an exception (3.6.2), or 
24323: 〞 when execution of a function registered with std::atexit exits using an exception (18.4), or 
24324: 〞 when a throw-expression with no operand attempts to rethrow an exception and no exception is being 
24325: handled (15.1), or 
24326: 〞 when std::unexpected throws an exception which is not allowed by the previously violated exception-
24327: specification, and std::bad_exception is not included in that exception-specification (15.5.2), or 
24328: 〞 when the implementation＊s default unexpected exception handler is called (18.7.2.2). 
24329: 2 In such cases, std::terminate() is called (18.7.3). In the situation where no matching handler is found, it 
24330: is implementation-defined whether or not the stack is unwound before std::terminate() is called. In all 
24331: other situations, the stack shall not be unwound before std::terminate() is called. An implementation is 
24332: not permitted to finish stack unwinding prematurely based on a determination that the unwind process will 
24333: eventually cause a call to std::terminate(). 
24334: 15.5.2 The std::unexpected() function [except.unexpected] 
24335: 1 If a function with an exception-specification throws an exception that is not listed in the exception-specification, 
24336: the function std::unexpected() is called (18.7.2) immediately after completing the stack unwinding for 
24337: the former function. 
24338: 2 The std::unexpected() function shall not return, but it can throw (or re-throw) an exception. If it throws a 
24339: new exception which is allowed by the exception specification which previously was violated, then the search 
24340: for another handler will continue at the call of the function whose exception specification was violated. If it 
24341: throws or rethrows an exception that the exception-specification does not allow then the following happens: 
24342: If the exception-specification does not include the class std::bad_exception (18.7.2.1) then the function 
24343: std::terminate() is called, otherwise the thrown exception is replaced by an implementation-defined object 
24344: of the type std::bad_exception and the search for another handler will continue at the call of the function 
24345: whose exception-specification was violated. 
24346: 138) For example, if the object being thrown is of a class with a copy constructor, std::terminate() will be called if that copy 
24347: constructor exits with an exception during a throw. 
24348: ∫ 15.5.2 435 
24349: 
24350: c
24351: . ISO/IEC N2800=08-0310 
24352: 3 Thus, an exception-specification guarantees that only the listed exceptions will be thrown. If the exception-
24353: specification includes the type std::bad_exception then any exception not on the list may be replaced by 
24354: std::bad_exception within the function std::unexpected(). 
24355: 15.5.3 The std::uncaught_exception() function [except.uncaught] 
24356: 1 The function std::uncaught_exception() returns true after completing evaluation of the object to be 
24357: thrown until completing the initialization of the exception-declaration in the matching handler (18.7.4). 
24358: This includes stack unwinding. If the exception is rethrown (15.1), std::uncaught_exception() returns 
24359: true from the point of rethrow until the rethrown exception is caught again. 
24360: 15.6 Exceptions and access [except.access] 
24361: 1 If the exception-declaration in a catch Clause has class type, and the function in which the catch Clause 
24362: occurs does not have access to the destructor of that class, the program is ill-formed. 
24363: 2 An object can be thrown if it can be copied and destroyed in the context of the function in which the 
24364: throw-expression occurs. 
24365: ∫ 15.6 436 
24366: 
24367: . ISO/IEC N2800=08-0310 
24368: 16 Preprocessing directives [cpp]
24369: 1 A preprocessing directive consists of a sequence of preprocessing tokens. The first token in the sequence is 
24370: a # preprocessing token that (at the start of translation phase 4) is either the first character in the source 
24371: file (optionally after white space containing no new-line characters) or that follows white space containing 
24372: at least one new-line character. The last token in the sequence is the first new-line character that follows 
24373: the first token in the sequence.139 A new-line character ends the preprocessing directive even if it occurs 
24374: within what would otherwise be an invocation of a function-like macro. 
24375: preprocessing-file:
24376: groupopt
24377: group:
24378: group-part
24379: group group-part
24380: group-part:
24381: if-section
24382: control-line
24383: text-line
24384: # non-directive
24385: if-section:
24386: if-group elif-groupsopt else-groupopt endif-line
24387: if-group:
24388: # if constant-expression new-line groupopt
24389: # ifdef identifier new-line groupopt
24390: # ifndef identifier new-line groupopt
24391: elif-groups:
24392: elif-group
24393: elif-groups elif-group
24394: elif-group:
24395: # elif constant-expression new-line groupopt
24396: else-group:
24397: # else new-line groupopt
24398: endif-line:
24399: # endif new-line
24400: 139) Thus, preprocessing directives are commonly called ※lines.§ These ※lines§ have no other syntactic significance, as all 
24401: white space is equivalent except in certain situations during preprocessing (see the # character string literal creation operator 
24402: in 16.3.2, for example). 
24403: 
24404: c
24405: . ISO/IEC N2800=08-0310 
24406: control-line:
24407: # include pp-tokens new-line
24408: # define identifier replacement-list new-line
24409: # define identifier lparen identifier-listopt ) replacement-list new-line
24410: # define identifier lparen ... ) replacement-list new-line
24411: # define identifier lparen identifier-list, ... ) replacement-list new-line
24412: # undef identifier new-line
24413: # line pp-tokens new-line
24414: # error pp-tokensopt new-line
24415: # pragma pp-tokensopt new-line
24416: # new-line
24417: text-line:
24418: pp-tokensopt new-line
24419: non-directive:
24420: pp-tokensopt new-line
24421: lparen: 
24422: a ( character not immediately preceded by white-space 
24423: identifier-list:
24424: identifier
24425: identifier-list , identifier
24426: replacement-list:
24427: pp-tokensopt
24428: pp-tokens:
24429: preprocessing-token
24430: pp-tokens preprocessing-token
24431: new-line: 
24432: the new-line character 
24433: 2 A text line shall not begin with a # preprocessing token. A non-directive shall not begin with any of the 
24434: directive names appearing in the syntax. 
24435: 3 When in a group that is skipped (16.1), the directive syntax is relaxed to allow any sequence of preprocessing 
24436: tokens to occur between the directive name and the following new-line character. 
24437: 4 The only white-space characters that shall appear between preprocessing tokens within a preprocessing 
24438: directive (from just after the introducing # preprocessing token through just before the terminating new-line 
24439: character) are space and horizontal-tab (including spaces that have replaced comments or possibly other 
24440: white-space characters in translation phase 3). 
24441: 5 The implementation can process and skip sections of source files conditionally, include other source files, 
24442: and replace macros. These capabilities are called preprocessing, because conceptually they occur before 
24443: translation of the resulting translation unit. 
24444: 6 The preprocessing tokens within a preprocessing directive are not subject to macro expansion unless other-
24445: wise stated. 
24446: [ Example: In: 
24447: #define EMPTY
24448: EMPTY # include <file.h>
24449: 
24450: c
24451: . ISO/IEC N2800=08-0310 
24452: the sequence of preprocessing tokens on the second line is not a preprocessing directive, because it does not 
24453: begin with a # at the start of translation phase 4, even though it will do so after the macro EMTPY has been 
24454: replaced. 〞end example ] 
24455: 16.1 Conditional inclusion [cpp.cond] 
24456: 1 The expression that controls conditional inclusion shall be an integral constant expression except that: 
24457: it shall not contain a cast; identifiers (including those lexically identical to keywords) are interpreted as 
24458: described below;140 and it may contain unary operator expressions of the form 
24459: defined identifier 
24460: or 
24461: defined ( identifier ) 
24462: which evaluate to 1 if the identifier is currently defined as a macro name (that is, if it is predefined or if it 
24463: has been the subject of a #define preprocessing directive without an intervening #undef directive with the 
24464: same subject identifier), 0 if it is not. 
24465: 2 Each preprocessing token that remains after all macro replacements have occurred shall be in the lexical 
24466: form of a token (2.6). 
24467: 3 Preprocessing directives of the forms 
24468: # if constant-expression new-line groupopt
24469: # elif constant-expression new-line groupopt
24470: check whether the controlling constant expression evaluates to nonzero. 
24471: 4 Prior to evaluation, macro invocations in the list of preprocessing tokens that will become the controlling 
24472: constant expression are replaced (except for those macro names modified by the defined unary operator), 
24473: just as in normal text. If the token defined is generated as a result of this replacement process or use of 
24474: the defined unary operator does not match one of the two specified forms prior to macro replacement, the 
24475: behavior is undefined. After all replacements due to macro expansion and the defined unary operator have 
24476: been performed, all remaining identifiers and keywords141, except for true and false, are replaced with the 
24477: pp-number 0, and then each preprocessing token is converted into a token. The resulting tokens comprise 
24478: the controlling constant expression which is evaluated according to the rules of 5.19 using arithmetic that has 
24479: at least the ranges specified in 18.2, except that all signed and unsigned integer types act as if they have the 
24480: same representation as, respectively, intmax_t or uintmax_t (18.3.2). This includes interpreting character 
24481: literals, which may involve converting escape sequences into execution character set members. Whether 
24482: the numeric value for these character literals matches the value obtained when an identical character literal 
24483: occurs in an expression (other than within a #if or #elif directive) is implementation-defined.142 Also, 
24484: whether a single-character character literal may have a negative value is implementation-defined. Each 
24485: subexpression with type bool is subjected to integral promotion before processing continues. 
24486: 5 Preprocessing directives of the forms 
24487: 140) Because the controlling constant expression is evaluated during translation phase 4, all identifiers either are or are not 
24488: macro names 〞 there simply are no keywords, enumeration constants, and so on. 
24489: 141) An alternative token (2.5) is not an identifier, even when its spelling consists entirely of letters and underscores. Therefore 
24490: it is not subject to this replacement. 
24491: 142) Thus, the constant expression in the following #if directive and if statement is not guaranteed to evaluate to the same 
24492: value in these two contexts. 
24493: #if ＊z＊ -＊a＊ == 25
24494: if (＊z＊ -＊a＊ == 25)
24495: ∫ 16.1 439 
24496: 
24497: c
24498: . ISO/IEC N2800=08-0310 
24499: # ifdef identifier new-line groupopt
24500: # ifndef identifier new-line groupopt
24501: check whether the identifier is or is not currently defined as a macro name. Their conditions are equivalent 
24502: to #if defined identifier and #if !defined identifier respectively. 
24503: 6 Each directive＊s condition is checked in order. If it evaluates to false (zero), the group that it controls is 
24504: skipped: directives are processed only through the name that determines the directive in order to keep track 
24505: of the level of nested conditionals; the rest of the directives＊ preprocessing tokens are ignored, as are the other 
24506: preprocessing tokens in the group. Only the first group whose control condition evaluates to true (nonzero) 
24507: is processed. If none of the conditions evaluates to true, and there is a #else directive, the group controlled 
24508: by the #else is processed; lacking a #else directive, all the groups until the #endif are skipped.143 
24509: 16.2 Source file inclusion [cpp.include] 
24510: 1 A #include directive shall identify a header or source file that can be processed by the implementation. 
24511: 2 A preprocessing directive of the form 
24512: # include < h-char-sequence> new-line 
24513: searches a sequence of implementation-defined places for a header identified uniquely by the specified se-
24514: quence between the < and > delimiters, and causes the replacement of that directive by the entire contents 
24515: of the header. How the places are specified or the header identified is implementation-defined. 
24516: 3 A preprocessing directive of the form 
24517: # include " q-char-sequence" new-line 
24518: causes the replacement of that directive by the entire contents of the source file identified by the specified 
24519: sequence between the " delimiters. The named source file is searched for in an implementation-defined 
24520: manner. If this search is not supported, or if the search fails, the directive is reprocessed as if it read 
24521: # include < h-char-sequence> new-line 
24522: with the identical contained sequence (including > characters, if any) from the original directive. 
24523: 4 A preprocessing directive of the form 
24524: # include pp-tokens new-line 
24525: (that does not match one of the two previous forms) is permitted. The preprocessing tokens after include 
24526: in the directive are processed just as in normal text (each identifier currently defined as a macro name is 
24527: replaced by its replacement list of preprocessing tokens). If the directive resulting after all replacements does 
24528: not match one of the two previous forms, the behavior is undefined.144 The method by which a sequence 
24529: of preprocessing tokens between a < and a > preprocessing token pair or a pair of " characters is combined 
24530: into a single header name preprocessing token is implementation-defined. 
24531: 5 The implementation provides unique mappings for sequences consisting of one or more nondigits or digits (2.10) 
24532: followed by a period (.) and a single nondigit. The first character shall not be a digit. The implementation 
24533: may ignore the distinctions of alphabetical case. 
24534: 6 A #include preprocessing directive may appear in a source file that has been read because of a #include 
24535: directive in another file, up to an implementation-defined nesting limit. 
24536: 143) As indicated by the syntax, a preprocessing token shall not follow a #else or #endif directive before the terminating 
24537: new-line character. However, comments may appear anywhere in a source file, including within a preprocessing directive. 
24538: 144) Note that adjacent string literals are not concatenated into a single string literal (see the translation phases in 2.1); thus, 
24539: an expansion that results in two string literals is an invalid directive. 
24540: ∫ 16.2 440 
24541: 
24542: c
24543: . ISO/IEC N2800=08-0310 
24544: 7 [ Note: Although an implementation may provide a mechanism for making arbitrary source files available to 
24545: the <> search, in general programmers should use the <> form for headers provided with the implementa-
24546: tion, and the "" form for sources outside the control of the implementation. For instance: 
24547: #include <stdio.h>
24548: #include <unistd.h>
24549: #include "usefullib.h"
24550: #include "myprog.h"
24551: 〞end note ]
24552: [ Example: Here is a macro-replaced #include directive:
24553: #if VERSION == 1
24554: #define INCFILE "vers1.h"
24555: #elif VERSION == 2
24556: #define INCFILE "vers2.h" // and so on
24557: #else
24558: #define INCFILE "versN.h"
24559: #endif
24560: #include INCFILE
24561: 〞end example ] 
24562: 16.3 Macro replacement [cpp.replace] 
24563: 1 Two replacement lists are identical if and only if the preprocessing tokens in both have the same number, 
24564: ordering, spelling, and white-space separation, where all white-space separations are considered identical. 
24565: 2 An identifier currently defined as an object-like macro may be redefined by another #define preprocessing 
24566: directive provided that the second definition is an object-like macro definition and the two replacement lists 
24567: are identical, otherwise the program is ill-formed. Likewise, an identifier currently defined as a function-like 
24568: macro may be redefined by another #define preprocessing directive provided that the second definition is a 
24569: function-like macro definition that has the same number and spelling of parameters, and the two replacement 
24570: lists are identical, otherwise the program is ill-formed. 
24571: 3 There shall be white-space between the identifier and the replacement list in the definition of an object-like 
24572: macro. 
24573: 4 If the identifier-list in the macro definition does not end with an ellipsis, the number of arguments (including 
24574: those arguments consisting of no preprocessing tokens) in an invocation of a function-like macro shall equal 
24575: the number of parameters in the macro definition. Otherwise, there shall be more arguments in the invocation 
24576: than there are parameters in the macro definition (excluding the ...). There shall exist a ) preprocessing 
24577: token that terminates the invocation. 
24578: 5 The identifier _ _ VA_ARGS _ _ shall occur only in the replacement-list of a function-like macro that uses the 
24579: ellipsis notation in the parameters. 
24580: 6 A parameter identifier in a function-like macro shall be uniquely declared within its scope. 
24581: 7 Theidentifier immediately following the define is called the macro name. There is one name space for macro 
24582: names. Any white-space characters preceding or following the replacement list of preprocessing tokens are 
24583: not considered part of the replacement list for either form of macro. 
24584: 8 If a # preprocessing token, followed by an identifier, occurs lexically at the point at which a preprocessing 
24585: directive could begin, the identifier is not subject to macro replacement. 
24586: 9 A preprocessing directive of the form 
24587: ∫ 16.3 441 
24588: 
24589: c
24590: . ISO/IEC N2800=08-0310 
24591: # define identifier replacement-list new-line 
24592: defines an object-like macro that causes each subsequent instance of the macro name145 to be replaced by the 
24593: replacement list of preprocessing tokens that constitute the remainder of the directive.146 The replacement 
24594: list is then rescanned for more macro names as specified below. 
24595: 10 A preprocessing directive of the form 
24596: # define identifier lparen identifier-listopt ) replacement-list new-line
24597: # define identifier lparen ... ) replacement-list new-line
24598: # define identifier lparen identifier-list , ... ) replacement-list new-line
24599: defines a function-like macro with parameters, similar syntactically to a function call. The parameters 
24600: are specified by the optional list of identifiers, whose scope extends from their declaration in the identifier 
24601: list until the new-line character that terminates the #define preprocessing directive. Each subsequent 
24602: instance of the function-like macro name followed by a ( as the next preprocessing token introduces the 
24603: sequence of preprocessing tokens that is replaced by the replacement list in the definition (an invocation of 
24604: the macro). The replaced sequence of preprocessing tokens is terminated by the matching ) preprocessing 
24605: token, skipping intervening matched pairs of left and right parenthesis preprocessing tokens. Within the 
24606: sequence of preprocessing tokens making up an invocation of a function-like macro, new-line is considered a 
24607: normal white-space character. 
24608: 11 The sequence of preprocessing tokens bounded by the outside-most matching parentheses forms the list of 
24609: arguments for the function-like macro. The individual arguments within the list are separated by comma 
24610: preprocessing tokens, but comma preprocessing tokens between matching inner parentheses do not separate 
24611: arguments. If (before argument substitution) any argument consists of no preprocessing tokens, the behavior 
24612: is undefined. If there are sequences of preprocessing tokens within the list of arguments that would otherwise 
24613: act as preprocessing directives, the behavior is undefined. 
24614: 12 If there is a ... in the identifier-list in the macro definition, then the trailing arguments, including any 
24615: separating comma preprocessing tokens, are merged to form a single item: the variable arguments. The 
24616: number of arguments so combined is such that, following merger, the number of arguments is one more than 
24617: the number of parameters in the macro definition (excluding the ...). 
24618: 16.3.1 Argument substitution [cpp.subst] 
24619: 1 After the arguments for the invocation of a function-like macro have been identified, argument substitution 
24620: takes place. A parameter in the replacement list, unless preceded by a # or ## preprocessing token or 
24621: followed by a ## preprocessing token (see below), is replaced by the corresponding argument after all macros 
24622: contained therein have been expanded. Before being substituted, each argument＊s preprocessing tokens are 
24623: completely macro replaced as if they formed the rest of the preprocessing file; no other preprocessing tokens 
24624: are available. 
24625: 2 An identifier _ _ VA_ARGS _ _ that occurs in the replacement list shall be treated as if it were a paremeter, 
24626: and the variable arguments shall form the preprocessing tokens used to replace it. 
24627: 16.3.2 The # operator [cpp.stringize] 
24628: 1 Each # preprocessing token in the replacement list for a function-like macro shall be followed by a parameter 
24629: as the next preprocessing token in the replacement list. 
24630: 145) Since, by macro-replacement time, all character literals and string literals are preprocessing tokens, not sequences possibly 
24631: containing identifier-like subsequences (see 2.1, translation phases), they are never scanned for macro names or parameters. 
24632: 146) An alternative token (2.5) is not an identifier, even when its spelling consists entirely of letters and underscores. Therefore 
24633: it is not possible to define a macro whose name is the same as that of an alternative token. 
24634: ∫ 16.3.2 442 
24635: 
24636: c
24637: . ISO/IEC N2800=08-0310 
24638: 2 If, in the replacement list, a parameter is immediately preceded by a # preprocessing token, both are 
24639: replaced by a single character string literal preprocessing token that contains the spelling of the preprocessing 
24640: token sequence for the corresponding argument. Each occurrence of white space between the argument＊s 
24641: preprocessing tokens becomes a single space character in the character string literal. White space before 
24642: the first preprocessing token and after the last preprocessing token comprising the argument is deleted. 
24643: Otherwise, the original spelling of each preprocessing token in the argument is retained in the character 
24644: string literal, except for special handling for producing the spelling of string literals and character literals: 
24645: a \ character is inserted before each " and \ character of a character literal or string literal (including the 
24646: delimiting " characters). If the replacement that results is not a valid character string literal, the behavior is 
24647: undefined. The character string literal corresponding to an empty argument is "". The order of evaluation 
24648: of # and ## operators is unspecified. 
24649: 16.3.3 The ## operator [cpp.concat] 
24650: 1 A ## preprocessing token shall not occur at the beginning or at the end of a replacement list for either form 
24651: of macro definition. 
24652: 2 If, in the replacement list of a function-like macro, a parameter is immediately preceded or followed by 
24653: a ## preprocessing token, the parameter is replaced by the corresponding argument＊s preprocessing token 
24654: sequence; however, if an argument consists of no preprocessing tokens, the parameter is replaced by a 
24655: placemarker preprocessing token instead.147 
24656: 3 For both object-like and function-like macro invocations, before the replacement list is reexamined for more 
24657: macro names to replace, each instance of a ## preprocessing token in the replacement list (not from an 
24658: argument) is deleted and the preceding preprocessing token is concatenated with the following preprocessing 
24659: token. Placemarker preprocessing tokens are handled specially; concatenation of two placemarkers results 
24660: in a single placemarker preprocessing token, and concatenation of a placemarker with a non-placemarker 
24661: preprocessing token results in the non-placemarker preprocessing token. If the result is not a valid prepro-
24662: cessing token, the behavior is undefined. The resulting token 
24663: The order of evaluation of ## operators is unspecified. 
24664: [ Example: In the following fragment: 
24665: #define hash_hash # ## #
24666: #define mkstr(a) # a
24667: #define in_between(a) mkstr(a)
24668: #define join(c, d) in_between(c hash_hash d)
24669: char p[] = join(x, y); // equivalent to
24670: // char p[] = "x ## y"; 
24671: The expansion produces, at various stages: 
24672: join(x, y)
24673: in_between(x hash_hash y)
24674: in_between(x ## y)
24675: mkstr(x ## y)
24676: "x ## y"
24677: is available for further macro replacement. 
24678: In other words, expanding hash_hash produces a new token, consisting of two adjacent sharp signs, but this 
24679: new token is not the ## operator. 〞end example ] 
24680: 16.3.4 Rescanning and further replacement [cpp.rescan] 
24681: 1 After all parameters in the replacement list have been substituted and # and ## processing has taken 
24682: 147) Placemarker preprocessing tokens do not appear in the syntax because they are temporary entities that exist only within 
24683: translation phase 4. 
24684: ∫ 16.3.4 443 
24685: 
24686: c
24687: . ISO/IEC N2800=08-0310 
24688: place, all placemarker preprocessing tokens are removed. Then the resulting preprocessing token sequence 
24689: is rescanned, along with all subsequent preprocessing tokens of the source file, for more macro names to 
24690: replace. 
24691: 2 If the name of the macro being replaced is found during this scan of the replacement list (not including the 
24692: rest of the source file＊s preprocessing tokens), it is not replaced. Furthermore, if any nested replacements 
24693: encounter the name of the macro being replaced, it is not replaced. These nonreplaced macro name prepro-
24694: cessing tokens are no longer available for further replacement even if they are later (re)examined in contexts 
24695: in which that macro name preprocessing token would otherwise have been replaced. 
24696: 3 The resulting completely macro-replaced preprocessing token sequence is not processed as a preprocessing 
24697: directive even if it resembles one, but all pragma unary operator expressions within it are then processed as 
24698: specified in 16.9 below. 
24699: 16.3.5 Scope of macro definitions [cpp.scope] 
24700: 1 A macro definition lasts (independent of block structure) until a corresponding #undef directive is encoun-
24701: tered or (if none is encountered) until the end of the translation unit. Macro definitions have no significance 
24702: after translation phase 4. 
24703: 2 A preprocessing directive of the form 
24704: # undef identifier new-line 
24705: causes the specified identifier no longer to be defined as a macro name. It is ignored if the specified identifier 
24706: is not currently defined as a macro name. 
24707: 3 [ Note: The simplest use of this facility is to define a ※manifest constant,§ as in 
24708: #define TABSIZE 100
24709: int table[TABSIZE];
24710: 4 The following defines a function-like macro whose value is the maximum of its arguments. It has the 
24711: advantages of working for any compatible types of the arguments and of generating in-line code without 
24712: the overhead of function calling. It has the disadvantages of evaluating one or the other of its arguments a 
24713: second time (including side effects) and generating more code than a function if invoked several times. It 
24714: also cannot have its address taken, as it has none. 
24715: #define max(a, b) ((a) > (b) ? (a) : (b)) 
24716: The parentheses ensure that the arguments and the resulting expression are bound properly. 
24717: 5 To illustrate the rules for redefinition and reexamination, the sequence 
24718: #define x 3
24719: #define f(a) f(x * (a))
24720: #undef x
24721: #define x 2
24722: #define g f
24723: #define z z[0]
24724: #define h g(‵
24725: #define m(a) a(w)
24726: #define w 0,1
24727: #define t(a) a
24728: #define p() int
24729: #define q(x) x
24730: #define r(x,y) x ## y
24731: #define str(x) # x
24732: ∫ 16.3.5 444 
24733: 
24734: c
24735: . ISO/IEC N2800=08-0310 
24736: f(y+1) + f(f(z)) % t(t(g)(0) + t)(1);
24737: g(x+(3,4)-w) | h 5) & m
24738: (f)^m(m);
24739: p() i[q()] = { q(1), r(2,3), r(4,), r(,5), r(,) };
24740: char c[2][6] = { str(hello), str() };
24741: results in 
24742: f(2 * (y+1)) + f(2 * (f(2 * (z[0])))) % f(2 * (0)) + t(1);
24743: f(2 * (2+(3,4)-0,1)) | f(2 * (5)) & f(2 * (0,1))^m(0,1);
24744: int i[] = { 1, 23, 4, 5, };
24745: char c[2][6] = { "hello", "" };
24746: 6 To illustrate the rules for creating character string literals and concatenating tokens, the sequence 
24747: #define str(s) # s
24748: #define xstr(s) str(s)
24749: #define debug(s, t) printf("x" # s "= %d, x" # t "= %s", \
24750: x ## s, x ## t)
24751: #define INCFILE(n) vers ## n /. from previous #include example */
24752: #define glue(a, b) a ## b
24753: #define xglue(a, b) glue(a, b)
24754: #define HIGHLOW "hello"
24755: #define LOW LOW ", world"
24756: debug(1, 2);
24757: fputs(str(strncmp("abc\0d", "abc", ＊\4＊) // this goes away
24758: == 0) str(: @\n), s);
24759: #include xstr(INCFILE(2).h)
24760: glue(HIGH, LOW);
24761: xglue(HIGH, LOW)
24762: results in 
24763: printf("x" "1" "= %d, x" "2" "= %s", x1, x2);
24764: fputs("strncmp(\"abc\\0d\", \"abc\", ＊\\4＊) == 0" ": @\n", s);
24765: #include "vers2.h" (after macro replacement, before file access)
24766: "hello";
24767: "hello" ", world"
24768: or, after concatenation of the character string literals, 
24769: printf("x1= %d, x2= %s", x1, x2);
24770: fputs("strncmp(\"abc\\0d\", \"abc\", ＊\\4＊) == 0: @\n", s);
24771: #include "vers2.h" (after macro replacement, before file access)
24772: "hello";
24773: "hello, world"
24774: Space around the # and ## tokens in the macro definition is optional. 
24775: 7 To illustrate the rules for placemarker preprocessing tokens, the sequence 
24776: #define t(x,y.z) x ## y ## z
24777: int j[] = { t(1,2,3), t(,4,5), t(6,{,}7), t(8,9,),
24778: t(10,{,}), t(,11,), t(,{,}12), t(,{,}) };
24779: ∫ 16.3.5 445 
24780: 
24781: c
24782: . ISO/IEC N2800=08-0310 
24783: results in 
24784: int j[] = { 123, 45, 67, 89,
24785: 10, 11, 12, };
24786: 8 To demonstrate the redefinition rules, the following sequence is valid. 
24787: #define OBJ_LIKE (1-1)
24788: #define OBJ_LIKE /. white space */ (1-1) /* other */
24789: #define FTN_LIKE(a) ( a )
24790: #define FTN_LIKE( a )( /. note the white space */ \
24791: a /. other stuff on this line
24792:  / )
24793: 9 But the following redefinitions are invalid: 
24794: #define OBJ_LIKE (0) // different token sequence
24795: #define OBJ_LIKE (1 -1) // different white space
24796: #define FTN_LIKE(b) ( a ) // different parameter usage
24797: #define FTN_LIKE(b) ( b ) // different parameter spelling
24798: 〞end note ] 
24799: 10 Finally, to show the variable argument list macro facilities: 
24800: #define debug(...) fprintf(stderr, _ _ VA_ARGS _ _)
24801: #define showlist(...) puts(#_ _ VA_ARGS _ _)
24802: #define report(test, ...) ((test) ? puts(#test) : printf(_ _ VA_ARGS _ _))
24803: debug("Flag");
24804: debug("X = %d\n", x);
24805: showlist(The first, second, and third items.);
24806: report(x>y, "x is %d but y is \%d", x, y);
24807: results in 
24808: fprintf(stderr, "Flag" );
24809: fprintf(stderr, "X = %d\n", x );
24810: puts( "The first, second, and third items." );
24811: ((x>y) ? puts("x>y") : printf("x is %d but y is %d", x, y));
24812: 16.4 Line control [cpp.line] 
24813: 1 The string literal of a #line directive, if present, shall be a character string literal. 
24814: 2 The line number of the current source line is one greater than the number of new-line characters read or 
24815: introduced in translation phase 1 (2.1) while processing the source file to the current token. 
24816: 3 A preprocessing directive of the form 
24817: # line digit-sequence new-line 
24818: causes the implementation to behave as if the following sequence of source lines begins with a source line 
24819: that has a line number as specified by the digit sequence (interpreted as a decimal integer). If the digit 
24820: sequence specifies zero or a number greater than 2147483647, the behavior is undefined. 
24821: 4 A preprocessing directive of the form 
24822: # line digit-sequence " s-char-sequenceopt " new-line 
24823: ∫ 16.4 446 
24824: 
24825: c
24826: . ISO/IEC N2800=08-0310 
24827: sets the line number similarly and changes the presumed name of the source file to be the contents of the 
24828: character string literal. 
24829: 5 A preprocessing directive of the form 
24830: # line pp-tokens new-line 
24831: (that does not match one of the two previous forms) is permitted. The preprocessing tokens after line 
24832: on the directive are processed just as in normal text (each identifier currently defined as a macro name is 
24833: replaced by its replacement list of preprocessing tokens). If the directive resulting after all replacements 
24834: does not match one of the two previous forms, the behavior is undefined; otherwise, the result is processed 
24835: as appropriate. 
24836: 16.5 Error directive [cpp.error] 
24837: 1 A preprocessing directive of the form 
24838: # error pp-tokensopt new-line 
24839: causes the implementation to produce a diagnostic message that includes the specified sequence of prepro-
24840: cessing tokens, and renders the program ill-formed. 
24841: 16.6 Pragma directive [cpp.pragma] 
24842: 1 A preprocessing directive of the form 
24843: # pragma pp-tokensopt new-line 
24844: causes the implementation to behave in an implementation-defined manner. The behavior might cause 
24845: translation to fail or cause the translator or the resulting program to behave in a non-conforming manner. 
24846: Any pragma that is not recognized by the implementation is ignored. 
24847: 16.7 Null directive [cpp.null] 
24848: 1 A preprocessing directive of the form 
24849: # new-line 
24850: has no effect. 
24851: 16.8 Predefined macro names [cpp.predefined] 
24852: 1 The following macro names shall be defined by the implementation: 
24853: _ _ cplusplus 
24854: The name _ _ cplusplus is defined to the value [tbd] when compiling a C++ translation unit.148 
24855: _ _ DATE _ _ 
24856: The date of translation of the source file (a character string literal of the form "Mmm dd yyyy", where 
24857: the names of the months are the same as those generated by the asctime function, and the first 
24858: character of dd is a space character if the value is less than 10). If the date of translation is not 
24859: available, an implementation-defined valid date is supplied. 
24860: _ _ FILE _ _ 
24861: The presumed name of the source file (a character string literal). 
24862: 148) It is intended that future versions of this standard will replace the value of this macro with a greater value. Non-conforming 
24863: compilers should use a value with at most five decimal digits. 
24864: ∫ 16.8 447 
24865: 
24866: c
24867: . ISO/IEC N2800=08-0310 
24868: _ _ LINE _ _ 
24869: The line number of the current source line (a decimal constant). 
24870: _ _ STDC_HOSTED _ _ 
24871: The integer constant 1 if the implementation is a hosted implementation or the integer constant 0 if 
24872: it is not. 
24873: _ _ TIME _ _ 
24874: The time of translation of the source file (a character string literal of the form "hh:mm:ss" as in the 
24875: time generated by the asctime function). If the time of translation is not available, an implementation-
24876: defined valid time is supplied. 
24877: 2 The following macro names are conditionally defined by the implementation: 
24878: _ _ STDC _ _
24879: Whether _ _ STDC _ _ is predefined and if so, what its value is, are implementation-defined.
24880: _ _ STDC_VERSION _ _ 
24881: Whether _ _ STDC_VERSION _ _ is predefined and if so, what its value is, are implementation-defined. 
24882: _ _ STDC_ISO_10646 _ _ 
24883: An integer constant of the form yyyymmL (for example, 199712L), intended to indicate that values of 
24884: type wchar_t are the coded representations of the characters defined by ISO/IEC 10646, along with 
24885: all amendments and technical corrigenda as of the specified year and month. 
24886: 3 The values of the predefined macros (except for _ _ LINE _ _ and _ _ FILE _ _) remain constant throughout 
24887: the translation unit. 
24888: 4 If any of the pre-defined macro names in this subclause, or the identifier defined, is the subject of a #define 
24889: or a #undef preprocessing directive, the behavior is undefined. Any other predefined macro names shall begin 
24890: with a leading underscore followed by an uppercase letter or a second underscore. 
24891: 16.9 Pragma operator [cpp.pragma.op] 
24892: A unary operator expression of the form: 
24893: _Pragma ( string-literal ) 
24894: is processed as follows: The string literal is destringized by deleting the L prefix, if present, deleting the 
24895: leading and trailing double-quotes, replacing each escape sequence \" by a double-quote, and replacing 
24896: each escape sequence \\ by a single backslash. The resulting sequence of characters is processed through 
24897: translation phase 3 to produce preprocessing tokens that are executed as if they were the pp-tokens in a 
24898: pragma directive. The original four preprocessing tokens in the unary operator expression are removed. 
24899: [ Example: 
24900: #pragma listing on "..\listing.dir" 
24901: can also be expressed as: 
24902: _Pragma ( listing on "\"..\\listing.dir\"" ) 
24903: The latter form is processed in the same way whether it appears literally as shown, or results from macro 
24904: replacement, as in: 
24905: #define LISTING(x) PRAGMA(listing on #x)
24906: #define PRAGMA(x) _Pragma(#x)
24907: LISTING( ..\listing.dir ) 
24908: ∫ 16.9 448 
24909: 
24910: . ISO/IEC N2800=08-0310 
24911: 〞end example ] 
24912: ∫ 16.9 449
24913: 
24914: c
24915: . ISO/IEC N2800=08-0310 
24916: 17 Library introduction [library]
24917: 17.1 General [library.general] 
24918: 1 This Clause describes the contents of the C++ standard library, how a well-formed C++ program makes use 
24919: of the library, and how a conforming implementation may provide the entities in the library. 
24920: 2 The C++ standard library provides an extensible framework, and contains components for: language support, 
24921: diagnostics, general utilities, strings, locales, containers, iterators, algorithms, numerics, and input/output. 
24922: The language support components are required by certain parts of the C++ language, such as memory 
24923: allocation (5.3.4, 5.3.5) and exception processing (Clause 15). 
24924: 3 The general utilities include components used by other library elements, such as a predefined storage allocator 
24925: for dynamic storage management (3.7.4). The diagnostics components provide a consistent framework for 
24926: reporting errors in a C++ program, including predefined exception classes. 
24927: 4 The strings components provide support for manipulating text represented as sequences of type char, se-
24928: quences of type char16_t, sequences of type char32_t, sequences of type wchar_t, and sequences of any 
24929: other character-like type. The localization components extend internationalization support for such text 
24930: processing. 
24931: 5 The containers, iterators, and algorithms provide a C++ program with access to a subset of the most widely 
24932: used algorithms and data structures. 
24933: 6 Numeric algorithms and the complex number components extend support for numeric processing. The 
24934: valarray components provide support for n-at-a-time processing, potentially implemented as parallel oper-
24935: ations on platforms that support such processing. 
24936: 7 The iostream components are the primary mechanism for C++ program input/output. They can be used 
24937: with other elements of the library, particularly strings, locales, and iterators. 
24938: 8 The atomic components allow more fine-grained concurrent access to shared data than is possible with locks. 
24939: 9 This library also makes available the facilities of the C99 standard library, suitably adjusted to ensure static 
24940: type safety. 
24941: 10 The descriptions of many library functions rely on the Standard C99 Library for the signatures and semantics 
24942: of those functions. In all such cases, any use of the restrict qualifier shall be omitted. 
24943: 17.2 Overview [library.overview] 
24944: 1 The following subclauses describe the definitions (17.3), method of description (17.5), and organization (17.6.2) 
24945: of the library. Clause 17.6, Clauses 18 through 30, and Annex D specify the contents of the library, as well as 
24946: library requirements and constraints on both well-formed C++ programs and conforming implementations. 
24947: 2 Detailed specifications for each of the components in the library are in Clauses 18每30, as shown in Table 12. 
24948: 17.3 Definitions 
24949: 17.3.1 
24950: arbitrary-positional stream 
24951: ∫ 17.3 
24952: [definitions] 
24953: [defns.arbitrary.stream] 
24954: 
24955: . ISO/IEC N2800=08-0310 
24956: Table 12 〞 Library categories 
24957: Clause 
24958: 18 
24959: 19 
24960: 20 
24961: 21 
24962: 22 
24963: 23 
24964: 24 
24965: 25 
24966: 26 
24967: 27 
24968: 28 
24969: 29 
24970: 30 
24971: Category 
24972: Language support 
24973: Diagnostics 
24974: General utilities 
24975: Strings 
24976: Localization 
24977: Containers 
24978: Iterators 
24979: Algorithms 
24980: Numerics 
24981: Input/output 
24982: Regular expressions 
24983: Atomic operations 
24984: Threads 
24985: a stream (described in Clause 27) that can seek to any integral position within the length of the stream. 
24986: Every arbitrary-positional stream is also a repositional stream (). 
24987: 17.3.2 [defns.blocked] 
24988: blocked thread 
24989: a thread that is waiting for some condition (other than the availability of a processor) to be satisfied before 
24990: it can continue execution.149 As a verb, to block is to place a thread in the blocked state, and to unblock is 
24991: to place a thread in the unblocked state. 
24992: 17.3.3 [defns.character] 
24993: character 
24994: in Clauses 21, 22, and 27, means any object which, when treated sequentially, can represent text. The term 
24995: does not only mean char, char16_t, char32_t, and wchar_t objects, but any value that can be represented 
24996: by a type that provides the definitions specified in these Clauses. 
24997: 17.3.4 [defns.character.container] 
24998: character container type 
24999: a class or a type used to represent a character. It is used for one of the template parameters of the string 
25000: and iostream class templates. A character container type shall be a POD (3.9) type. 
25001: 17.3.5 [defns.comparison] 
25002: comparison function 
25003: an operator function (13.5) for any of the equality (5.10) or relational (5.9) operators. 
25004: 17.3.6 [defns.component] 
25005: component 
25006: a group of library entities directly related as members, parameters, or return types. For example, the class 
25007: template basic_string and the non-member function templates that operate on strings are referred to as 
25008: the string component. 
25009: 149) This definition is taken from POSIX. 
25010: ∫ 17.3 451 
25011: 
25012: c. ISO/IEC N2800=08-0310 
25013: 17.3.7 [defns.deadlock] 
25014: deadlock 
25015: two or more threads are unable to continue execution because each is blocked waiting for one or more of the 
25016: others to satisfy some condition. 
25017: 17.3.8 [defns.default.behavior] 
25018: default behavior 
25019: a description of replacement function and handler function semantics. Any specific behavior provided by 
25020: the implementation, within the scope of the required behavior. 
25021: 17.3.9 [defns.handler] 
25022: handler function 
25023: a non-reserved function whose definition may be provided by a C++ program. A C++ program may designate 
25024: a handler function at various points in its execution, by supplying a pointer to the function when calling 
25025: any of the library functions that install handler functions (Clause 18). 
25026: 17.3.10 [defns.iostream.templates] 
25027: iostream class templates 
25028: templates, defined in Clause 27, that take two template arguments: charT and traits. The argument charT 
25029: is a character container class, and the argument traits is a class which defines additional characteristics and 
25030: functions of the character type represented by charT necessary to implement the iostream class templates. 
25031: 17.3.11 [defns.modifier] 
25032: modifier function 
25033: a class member function (9.3), other than constructors, assignment, or destructor, that alters the state of 
25034: an object of the class. 
25035: 17.3.12 [defns.obj.state] 
25036: object state 
25037: the current value of all non-static class members of an object (9.2). The state of an object can be obtained 
25038: by using one or more observer functions. 
25039: 17.3.13 [defns.ntcts] 
25040: NTCTS 
25041: a sequence of values that have character type, that precede the terminating null character type value charT(). 
25042: 17.3.14 [defns.narrow.iostream] 
25043: narrow-oriented iostream classes 
25044: the instantiations of the iostream class templates on the character container class char and the default value 
25045: of any other parameters. The traditional iostream classes are regarded as the narrow-oriented iostream 
25046: classes (27.3.1). 
25047: 17.3.15 [defns.observer] 
25048: observer function 
25049: ∫ 17.3 452 
25050: 
25051: c. ISO/IEC N2800=08-0310 
25052: a class member function (9.3) that accesses the state of an object of the class, but does not alter that state. 
25053: Observer functions are specified as const member functions (9.3.2). 
25054: 17.3.16 [defns.replacement] 
25055: replacement function 
25056: a non-reserved function whose definition is provided by a C++ program. Only one definition for such a 
25057: function is in effect for the duration of the program＊s execution, as the result of creating the program (2.1) 
25058: and resolving the definitions of all translation units (3.5). 
25059: 17.3.17 [defns.repositional.stream] 
25060: repositional stream 
25061: a stream (described in Clause 27) that can seek only to a position that was previously encountered. 
25062: 17.3.18 [defns.required.behavior] 
25063: required behavior 
25064: a description of replacement function and handler function semantics, applicable to both the behavior pro-
25065: vided by the implementation and the behavior that shall be provided by any function definition in the 
25066: program. If a function defined in a C++ program fails to meet the required behavior when it executes, the 
25067: behavior is undefined. 
25068: 17.3.19 [defns.reserved.function] 
25069: reserved function 
25070: a function, specified as part of the C++ standard library, that must be defined by the implementation. If a 
25071: C++ program provides a definition for any reserved function, the results are undefined. 
25072: 17.3.20 [defns.stable] 
25073: stable algorithm 
25074: an algorithm that preserves, as appropriate to the particular algorithm, the order of elements. 
25075: 〞 For the sort algorithms the relative order of equivalent elements is preserved. 
25076: 〞 For the remove algorithms the relative order of the elements that are not removed is preserved. 
25077: 〞 For the merge algorithms, for equivalent elements in the original two ranges, the elements from the 
25078: first range precede the elements from the second range. 
25079: 17.3.21 [defns.traits] 
25080: traits class 
25081: a class that encapsulates a set of types and functions necessary for class templates and function templates to 
25082: manipulate objects of types for which they are instantiated. Traits classes defined in Clauses 21, 22 and 27 
25083: are character traits, which provide the character handling support needed by the string and iostream classes. 
25084: 17.3.22 [defns.wide.iostream] 
25085: wide-oriented iostream classes 
25086: the instantiations of the iostream class templates on the character container class wchar_t and the default 
25087: value of any other parameters. 
25088: ∫ 17.3 453 
25089: 
25090: c
25091: . ISO/IEC N2800=08-0310 
25092: 17.4 Additional definitions [defns.additional] 
25093: 1 1.3 defines additional terms used elsewhere in this International Standard. 
25094: 17.5 Method of description (Informative) [description] 
25095: 17.5.1 General [description.general] 
25096: 1 This subclause describes the conventions used to specify the C++ standard library. 17.5.2 describes the 
25097: structure of the normative Clauses 18 through 30 and Annex D. 17.5.3 describes other editorial conventions. 
25098: 17.5.2 Structure of each clause [structure] 
25099: 17.5.2.1 Elements [structure.elements] 
25100: 1 Each library clause contains the following elements, as applicable:150 
25101: 〞 Summary 
25102: 〞 Requirements 
25103: 〞 Detailed specifications 
25104: 〞 References to the Standard C library 
25105: 17.5.2.2 Summary [structure.summary] 
25106: 1 The Summary provides a synopsis of the category, and introduces the first-level subclauses. Each subclause 
25107: also provides a summary, listing the headers specified in the subclause and the library entities provided in 
25108: each header. 
25109: 2 Paragraphs labelled ※Note(s):§ or ※Example(s):§ are informative, other paragraphs are normative. 
25110: 3 The summary and the detailed specifications are presented in the order: 
25111: 〞 macros 
25112: 〞 values 
25113: 〞 types 
25114: 〞 classes 
25115: 〞 functions
25116: 〞 objects
25117: 17.5.2.3 Requirements [structure.requirements] 
25118: 1 Requirements describe contraints that shall be met by a C++ program that extends the standard library. 
25119: Such extensions are generally one of the following: 
25120: 〞 Template arguments 
25121: 〞 Derived classes 
25122: 〞 Containers, iterators, and algorithms that meet an interface convention 
25123: 150) To save space, items that do not apply to a Clause are omitted. For example, if a Clause does not specify any requirements, 
25124: there will be no ※Requirements§ subclause. 
25125: ∫ 17.5.2.3 454 
25126: 
25127: c
25128: . ISO/IEC N2800=08-0310 
25129: 2 The string and iostream components use an explicit representation of operations required of template argu-
25130: ments. They use a class template char_traits to define these constraints. 
25131: 3 Interface convention requirements are stated as generally as possible. Instead of stating ※class X has to 
25132: define a member function operator++(),§ the interface requires ※for any object x of class X, ++x is defined.§ 
25133: That is, whether the operator is a member is unspecified. 
25134: 4 Requirements are stated in terms of well-defined expressions that define valid terms of the types that satisfy 
25135: the requirements, or concepts that define capabilities of the types that satisfy the requirements. For every set 
25136: of well-defined expression requirements there is a table that specifies an initial set of the valid expressions and 
25137: their semantics. For every set of concept requirements there is a concept that specifies the requirements and 
25138: their semantics (20.1, 23.1.6, 24.1). Any generic algorithm (Clause 25) that uses the well-defined expression 
25139: requirements is described in terms of the valid expressions for its formal type parameters. Any generic 
25140: algorithm that uses concepts places requirements on its formal type parameters. 
25141: 5 Template argument requirements are sometimes referenced by name. See 17.5.3.2. 
25142: 6 In some cases the semantic requirements are presented as C++ code. Such code is intended as a specifica-
25143: tion of equivalence of a construct to another construct, not necessarily as the way the construct must be 
25144: implemented.151 
25145: 17.5.2.4 Detailed Specifications [structure.specifications] 
25146: 1 The detailed specifications each contain the following elements:152 
25147: 〞 name and brief description 
25148: 〞 synopsis (class definition or function prototype, as appropriate) 
25149: 〞 restrictions on template arguments, if any 
25150: 〞 description of class invariants 
25151: 〞 description of function semantics 
25152: 2 Descriptions of class member functions follow the order (as appropriate):153 
25153: 〞 constructor(s) and destructor 
25154: 〞 copying & assignment functions 
25155: 〞 comparison functions 
25156: 〞 modifier functions
25157: 〞 observer functions
25158: 〞 operators and other non-member functions
25159: 3 Descriptions of function semantics contain the following elements (as appropriate):154 
25160: 〞 Requires: the preconditions for calling the function 
25161: 〞 Effects: the actions performed by the function 
25162: 151) Although in some cases the code given is unambiguously the optimum implementation.
25163: 152) The form of these specifications was designed to follow the conventions established by existing C++ library vendors.
25164: 153) To save space, items that do not apply to a class are omitted. For example, if a class does not specify any comparison
25165: functions, there will be no ※Comparison functions§ subclause.
25166: 154) To save space, items that do not apply to a function are omitted. For example, if a function does not specify any further
25167: preconditions, there will be no ※Requires§ paragraph.
25168: ∫ 17.5.2.4 455 
25169: 
25170: c
25171: . ISO/IEC N2800=08-0310 
25172: 〞 Postconditions: the observable results established by the function 
25173: 〞 Returns: a description of the value(s) returned by the function 
25174: 〞 Throws: any exceptions thrown by the function, and the conditions that would cause the exception 
25175: 〞 Complexity: the time and/or space complexity of the function 
25176: 〞 Remarks: additional semantic constraints on the function 
25177: 〞 Error conditions: the error conditions for error codes reported by the function. 
25178: 〞 Notes: non-normative comments about the function 
25179: 4 For non-reserved replacement and handler functions, Clause 18 specifies two behaviors for the functions in 
25180: question: their required and default behavior. The default behavior describes a function definition provided 
25181: by the implementation. The required behavior describes the semantics of a function definition provided by 
25182: either the implementation or a C++ program. Where no distinction is explicitly made in the description, 
25183: the behavior described is the required behavior. 
25184: 5 Complexity requirements specified in the library Clauses are upper bounds, andimplementations that provide 
25185: better complexity guarantees satisfy the requirements. 
25186: 6 Error conditions specify conditions where a function may fail. The conditions are listed, together with 
25187: a suitable explanation, as the enum class errc constants (19.4) that could be used as an argument to 
25188: function make_error_condition (19.4.3.6). 
25189: 17.5.2.5 C Library [structure.see.also] 
25190: 1 Paragraphs labelled ※See also:§ contain cross-references to the relevant portions of this International 
25191: Standard and the ISO C standard, which is incorporated into this International Standard by reference. 
25192: 17.5.3 Other conventions [conventions] 
25193: 17.5.3.1 General [conventions.general] 
25194: 1 This subclause describes several editorial conventions used to describe the contents of the C++ standard 
25195: library. These conventions are for describing implementation-defined types (17.5.3.2), and member func-
25196: tions (17.5.3.3). 
25197: 17.5.3.2 Type descriptions [type.descriptions] 
25198: 17.5.3.2.1 General [type.descriptions.general] 
25199: 1 The Requirements subclauses may describe names that are used to specify constraints on template argu-
25200: ments.155 These names are used in library Clauses to describe the types that may be supplied as arguments 
25201: by a C++ program when instantiating template components from the library. 
25202: 2 Certain types defined in Clause 27 are used to describe implementation-defined types. They are based on 
25203: other types, but with added constraints. 
25204: 17.5.3.2.2 Enumerated types [enumerated.types] 
25205: 1 Several types defined in Clause 27 are enumerated types. Each enumerated type may be implemented as an 
25206: enumeration or as a synonym for an enumeration.156 
25207: 155) Examples from 20.1 include: EqualityComparable, LessThanComparable, CopyConstructable, etc. Examples from 24.1.1
25208: include: InputIterator, ForwardIterator, Function, Predicate, etc.
25209: 156) Such as an integer type, with constant integer values (3.9.1).
25210: ∫ 17.5.3.2.2 456 
25211: 
25212: c
25213: . ISO/IEC N2800=08-0310 
25214: 2 The enumerated type enumerated can be written: 
25215: enum enumerated { V0, V1, V2 , V3 , .....}; 
25216: static const enumerated C0 (V0);
25217: static const enumerated C1 (V1);
25218: static const enumerated C2 (V2 );
25219: static const enumerated C3 (V3 );
25220: ..... 
25221: 3 Here, the names C0, C1, etc. represent enumerated elements for this particular enumerated type. All such 
25222: elements have distinct values. 
25223: 17.5.3.2.3 Bitmask types [bitmask.types] 
25224: 1 Several types defined in Clauses18through30and AnnexDare bitmask types. Each bitmask type can be im-
25225: plemented as an enumerated type that overloads certain operators, as aninteger type, or as a bitset (20.2.6). 
25226: 2 The bitmask type bitmask can be written: 
25227: enum bitmask {
25228: V0 = 1 << 0, V1 = 1 << 1, V2 = 1 << 2, V3 = 1 << 3, .....
25229: };
25230: static const bitmask C0(V0);
25231: static const bitmask C1(V1);
25232: static const bitmask C2(V2 );
25233: static const bitmask C3 (V3 );
25234: ..... 
25235: // For exposition only.
25236: // int_type is an integral type capable of
25237: // representing all values of bitmask
25238: bitmask operator& (bitmask X , bitmask Y ) {
25239: return static_cast<bitmask>(
25240: static_cast<int_type>(X ) &
25241: static_cast<int_type>(Y ));
25242: }
25243: bitmask operator| (bitmask X , bitmask Y ) {
25244: return static_cast<bitmask>(
25245: static_cast<int_type>(X ) |
25246: static_cast<int_type>(Y ));
25247: }
25248: bitmask operator^ (bitmask X , bitmask Y ){
25249: return static_cast<bitmask>(
25250: static_cast<int_type>(X )^
25251: static_cast<int_type>(Y ));
25252: }
25253: bitmask operator~ (bitmask X ){
25254: return static_cast<bitmask>(static_cast<int_type>(X ));
25255: }
25256: bitmask& operator&=(bitmask& X , bitmask Y ){
25257: X = X &Y ; return X ;
25258: }
25259: bitmask& operator|=(bitmask& X , bitmask Y ) {
25260: X = X |Y ; return X ; 
25261: ∫ 17.5.3.2.3 457 
25262: 
25263: c
25264: . ISO/IEC N2800=08-0310 
25265: }
25266: bitmask& operator^=(bitmask& X , bitmask Y ) {
25267: X = X ^Y ; return X ;
25268: }
25269: 3 Here, the names C0, C1, etc. represent bitmask elements for this particular bitmask type. All such elements 
25270: have distinct values such that, for any pair Ci and Cj, Ci & Ci is nonzero and Ci & Cj is zero. 
25271: 4 The following terms apply to objects and values of bitmask types: 
25272: 〞 To set a value Y in an object X is to evaluate the expression X |= Y. 
25273: 〞 To clear a value Y in an object X is to evaluate the expression X &= Y. 
25274: 〞 The value Y is set in the object X if the expression X & Y is nonzero. 
25275: 17.5.3.2.4 Character sequences [character.seq] 
25276: 17.5.3.2.4.1 General [character.seq.general] 
25277: 1 The C standardlibrary makes widespread use of characters and character sequences that follow a few uniform 
25278: conventions: 
25279: 〞 A letter is any of the 26 lowercase or 26 uppercase letters in the basic execution character set.157 
25280: 〞 The decimal-point character is the (single-byte) character used by functions that convert between a 
25281: (single-byte) character sequence and a value of one of the floating-point types. It is used in the character 
25282: sequence to denote the beginning of a fractional part. It is represented in Clauses 18 through 27 and 
25283: Annex D by a period, ＊.＊, which is also its value in the "C" locale, but may change during program 
25284: execution by a call to setlocale(int, const char*),158 or by a change to a locale object, as 
25285: described in Clauses 22.1 and 27. 
25286: 〞A character sequence is an array object (8.3.4) A that can be declared as T A [N ], where T is any 
25287: of the types char, unsigned char, or signed char (3.9.1), optionally qualified by any combination 
25288: of const or volatile. The initial elements of the array have defined contents up to and including an 
25289: element determined by some predicate. A character sequence can be designated by a pointer value S 
25290: that points to its first element. 
25291: 17.5.3.2.4.2 Byte strings [byte.strings] 
25292: 1 A null-terminated byte string, or ntbs, is a character sequence whose highest-addressed element with defined 
25293: content has the value zero (the terminating null character).159 
25294: 2 The length of an ntbs is the number of elements that precede the terminating null character. An empty 
25295: ntbs has a length of zero. 
25296: 3 The value of an ntbs is the sequence of values of the elements up to and including the terminating null 
25297: character. 
25298: 157) Note that this definition differs from the definition in ISO C 7.1.1.
25299: 158) declared in <clocale> (22.4).
25300: 159) Many of the objects manipulated by function signatures declared in <cstring> (21.5) are character sequences or ntbss.
25301: The size of some of these character sequences is limited by a length value, maintained separately from the character sequence.
25302: ∫ 17.5.3.2.4 458 
25303: 
25304: c
25305: . ISO/IEC N2800=08-0310 
25306: 4 A static ntbs is an ntbs with static storage duration.160 
25307: 17.5.3.2.4.3 Multibyte strings [multibyte.strings] 
25308: 1 A null-terminated multibyte string, or ntmbs, is an ntbs that constitutes a sequence of valid multibyte 
25309: characters, beginning and ending in the initial shift state.161 
25310: 2 A static ntmbs is an ntmbs with static storage duration. 
25311: 17.5.3.2.4.4 char16_t sequences [char16_t.seq] 
25312: 1 A char16-character sequence is an array object (8.3.4) A that can be declared as TA[N], where T is type 
25313: char16_t (3.9.1), optionally qualified by any combination of const or volatile. The initial elements of 
25314: the array have defined contents up to and including an element determined by some predicate. A char16-
25315: character sequence can be designated by a pointer value S that designates its first element. 
25316: 2 A null-terminated char16-character string, or ntc16s, is a char16-character sequence whose highest-addressed 
25317: element with defined content has the value zero.162 
25318: 3 The length of an ntc16s is the number of elements that precede the terminating null char16_t character. 
25319: An empty ntc16s has a length of zero. 
25320: 4 The value of an ntc16s is the sequence of values of the elements up to and including the terminating null 
25321: character. 
25322: 5 A static ntc16s is an ntc16s with static storage duration.163 
25323: 17.5.3.2.4.5 char32_t sequences [char32_t.seq] 
25324: 1 A char32-character sequence is an array object (8.3.4) A that can be declared as TA[N], where T is type 
25325: char32_t (3.9.1), optionally qualified by any combination of const or volatile. The initial elements of 
25326: the array have defined contents up to and including an element determined by some predicate. A char32-
25327: character sequence can be designated by a pointer value S that designates its first element. 
25328: 2 A null-terminated char32-character string, or ntc32s, is a char32-character sequence whose highest-addressed 
25329: element with defined content has the value zero.164 
25330: 3 The length of an ntc32s is the number of elements that precede the terminating null char32_t character. 
25331: An empty ntc32s has a length of zero. 
25332: 4 The value of an ntc32s is the sequence of values of the elements up to and including the terminating null 
25333: character. 
25334: 5 A static ntc32s is an ntc32s with static storage duration.165 
25335: 17.5.3.2.4.6 Wide-character sequences [wide.characters] 
25336: 1 A wide-character sequence is an array object (8.3.4) A that can be declared as TA[N], where T is type 
25337: wchar_t (3.9.1), optionally qualified by any combination of const or volatile. The initial elements of the 
25338: array have defined contents up to and including an element determined by some predicate. A wide-character 
25339: sequence can be designated by a pointer value S that designates its first element. 
25340: 160) A string literal, such as "abc", is a static ntbs161) An ntbs that contains characters only from the basic execution character set is also an ntmbs. Each multibyte character
25341: then consists of a single byte.
25342: 162) Many of the objects manipulated by function signatures declared in <cuchar> are char16-character sequences or ntc16ss.
25343: 163) A char16_t string literal, such as u"abc", is a static ntc16s.
25344: 164) Many of the objects manipulated by function signatures declared in <cuchar> are char32-character sequences or ntc32ss.
25345: 165) A char32_t string literal, such as U"abc", is a static ntc32s.
25346: ∫ 17.5.3.2.4 459 
25347: 
25348: c
25349: . ISO/IEC N2800=08-0310 
25350: 2 A null-terminated wide-character string, or ntwcs, is a wide-character sequence whose highest-addressed 
25351: element with defined content has the value zero.166 
25352: 3 The length of an ntwcs is the number of elements that precede the terminating null wide character. An 
25353: empty ntwcs has a length of zero. 
25354: 4 The value of an ntwcs is the sequence of values of the elements up to and including the terminating null 
25355: character. 
25356: 5 A static ntwcs is an ntwcs with static storage duration.167 
25357: 17.5.3.3 Functions within classes [functions.within.classes] 
25358: 1 For the sake of exposition, Clauses 18 through 27 and Annex D do not describe copy constructors, assignment 
25359: operators, or (non-virtual) destructors with the same apparent semantics as those that can be generated by 
25360: default (12.1, 12.4, 12.8). 
25361: 2 It is unspecified whether the implementation provides explicit definitions for such member function signa-
25362: tures, or for virtual destructors that can be generated by default. 
25363: 17.5.3.4 Private members [objects.within.classes] 
25364: 1 Clauses 18 through 30 and Annex D do not specify the representation of classes, and intentionally omit 
25365: specification of class members (9.2). An implementation may define static or non-static class members, or 
25366: both, as needed to implement the semantics of the member functions specified in Clauses 18 through 30 and 
25367: Annex D. 
25368: 2 Objects of certain classes are sometimes required by the external specifications of their classes to store data, 
25369: apparently in member objects. For the sake of exposition, some subclauses provide representative declara-
25370: tions, and semantic requirements, for private member objects of classes that meet the external specifications 
25371: of the classes. The declarations for such member objects and the definitions of related member types are 
25372: enclosed in a comment that ends with exposition only, as in: 
25373: // streambuf* sb; exposition only 
25374: 3 An implementation may use any technique that provides equivalent external behavior. 
25375: 17.6 Library-wide requirements [requirements] 
25376: 17.6.1 General [requirements.general] 
25377: 1 This subclause specifies requirements that apply to the entire C++ standard library. Clauses 18 through 30 
25378: and Annex D specify the requirements of individual entities within the library. 
25379: 2 Requirements specified in terms of interactions between threads do not apply to programs having only a 
25380: single thread of execution. 
25381: 3 Within this subclause, 17.6.2 describes the library＊s contents and organization, 17.6.3 describes how well-
25382: formed C++ programs gain access to library entities, 17.6.4 describes constraints on well-formed C++ pro-
25383: grams, and 17.6.5 describes constraints on conforming implementations. 
25384: 17.6.2 Library contents and organization [organization] 
25385: 17.6.2.1 General [organization.general] 
25386: 1 17.6.2.2 describes the entities defined in the C++ standard library. 17.6.2.3 lists the standard library headers 
25387: 166) Many of the objects manipulated by function signatures declared in <cwchar> are wide-character sequences or ntwcss. 
25388: 167) A wide string literal, such as L"abc" is a static ntwcs. 
25389: ∫ 17.6.2.1 460 
25390: 
25391: c
25392: . ISO/IEC N2800=08-0310 
25393: and some constraints on those headers. 17.6.2.4 lists requirements for a freestanding implementation of the 
25394: C++ standard library. 
25395: 17.6.2.2 Library contents [contents] 
25396: 1 The C++ standard library provides definitions for the following types of entities: macros, values, types, 
25397: concepts, concept maps, templates, classes, functions, objects. 
25398: 2 All library entities except macros, operator new and operator delete are defined within the namespace 
25399: std or namespaces nested within namespace std. 
25400: 3 Whenever a name x defined in the standard library is mentioned, the name x is assumed to be fully qualified 
25401: as ::std::x, unless explicitly described otherwise. For example, if the Effects section for library function F 
25402: is described as calling library function G, the function ::std::G is meant. 
25403: 17.6.2.3 Headers [headers] 
25404: 168 
25405: 1 Each element of the C++ standard library is declared or defined (as appropriate) in a header.
25406: 2 The C++ standard library provides 54 C++ library headers, as shown in Table 13. 
25407: Table 13 〞 C++ library headers 
25408: <algorithm> <forward_list> <iterator_concepts> <queue> <system_error> 
25409: <array> <fstream> <limits> <random> <threads> 
25410: <bitset> <functional> <list> <ratio> <tuple> 
25411: <chrono> <future> <locale> <regex> <typeinfo> 
25412: <codecvt> <initializer_list> <map> <set> <type_traits> 
25413: <complex> <iomanip> <memory> <sstream> <unordered_map> 
25414: <concepts> <ios> <memory_concepts> <stack> <unordered_set> 
25415: <condition_variable> <iosfwd> <mutex> <stdexcept> <utility> 
25416: <container_concepts> <iostream> <new> <streambuf> <valarray> 
25417: <deque> <istream> <numeric> <string> <vector> 
25418: <exception> <iterator> <ostream> <strstream> 
25419: The facilities of the C99 standard Library are provided in 26 additional headers, as shown in Table 14. 
25420: Table 14 〞 C++ headers for C library facilities 
25421: <cassert> <cinttypes> <csignal> <cstdio> <cwchar>
25422: <ccomplex> <ciso646> <cstdarg> <cstdlib> <cwctype>
25423: <cctype> <climits> <cstdatomic> <cstring>
25424: <cerrno> <clocale> <cstdbool> <ctgmath>
25425: <cfenv> <cmath> <cstddef> <ctime>
25426: <cfloat> <csetjmp> <cstdint> <cuchar>
25427: 4 Except as noted in Clauses 18 through 30 and Annex D, the contents of each header cname shall be the same 
25428: as that of the corresponding header name.h, as specified in the C99 standard Library (1.2) or the C Unicode 
25429: TR, as appropriate, as if by inclusion. In the C++ standard library, however, the declarations (except for 
25430: names which are defined as macros in C) are within namespace scope (3.3.5) of the namespace std. It is 
25431: 168) A header is not necessarily a source file, nor are the sequences delimited by < and > in header names necessarily valid 
25432: source file names (16.2). 
25433: ∫ 17.6.2.3 461 
25434: 
25435: c
25436: . ISO/IEC N2800=08-0310 
25437: unspecified whether these names are first declared within the global namespace scope and are then injected 
25438: into namespace std by explicit using-declarations (7.3.3). 
25439: 5 Names which are defined as macros in C shall be defined as macros in the C++ standard library, even if 
25440: C grants license for implementation as functions. [ Note: the names defined as macros in C include the 
25441: following: assert, offsetof, setjmp, va_arg, va_end, and va_start. 〞 end note ] 
25442: 6 Names that are defined as functions in C shall be defined as functions in the C++ standard library.169 
25443: 7 Identifiers that are keywords or operators in C++ shall not be defined as macros in C++ standard library 
25444: headers.170 
25445: 8 D.5, C standard library headers, describes the effects of using the name.h (C header) form in a C++ pro-
25446: gram.171 
25447: 17.6.2.4 Freestanding implementations [compliance] 
25448: 1 Two kinds of implementations are defined: hosted and freestanding (1.4). For a hosted implementation, this 
25449: International Standard describes the set of available headers. 
25450: 2 A freestanding implementation has an implementation-defined set of headers. This set shall include at least 
25451: the headers shown in Table 15. 
25452: Table 15 〞 C++ headers for freestanding implementations 
25453: Subclause Header(s) 
25454: 18.1 Types <cstddef> 
25455: 18.2 Implementation properties <limits> 
25456: 18.4 Start and termination <cstdlib> 
25457: 18.5 Dynamic memory management <new> 
25458: 18.6 Type identification <typeinfo> 
25459: 18.7 Exception handling <exception> 
25460: 18.9 Other runtime support <cstdarg> 
25461: 3 The supplied version of the header <cstdlib> shall declare at least the functions abort(), atexit(), and 
25462: exit() (18.4). 
25463: 17.6.3 Using the library [using] 
25464: 17.6.3.1 Overview [using.overview] 
25465: 1 This section describes how a C++ program gains access to the facilities of the C++ standard library. 17.6.3.2 
25466: describes effects during translation phase 4, while 17.6.3.3 describes effects during phase 8 (2.1). 
25467: 17.6.3.2 Headers [using.headers] 
25468: 1 The entities in the C++ standard library are defined in headers, whose contents are made available to a 
25469: translation unit when it contains the appropriate #include preprocessing directive (16.2). 
25470: 169) This disallows the practice, allowed in C, of providing a masking macro in addition to the function prototype. The only 
25471: way to achieve equivalent inline behavior in C++ is to provide a definition as an extern inline function. 
25472: 170) In particular, including the standard header <iso646.h> or <ciso646> has no effect. 
25473: 171) The ".h" headers dump all their names into the global namespace, whereas the newer forms keep their names in namespace 
25474: std. Therefore, the newer forms are the preferred forms for all uses except for C++ programs which are intended to be strictly 
25475: compatible with C. 
25476: ∫ 17.6.3.2 462 
25477: 
25478: c
25479: . ISO/IEC N2800=08-0310 
25480: 2 A translation unit may include library headers in any order (Clause 2). Each may be included more than 
25481: once, with no effect different from being included exactly once, except that the effect of including either 
25482: 172 
25483: <cassert> or <assert.h> depends each time on the lexically current definition of NDEBUG.
25484: 3 A translation unit shall include a header only outside of any external declaration or definition, and shall 
25485: include the header lexically before the first reference to any of the entities it declares in that translation 
25486: unit. 
25487: 17.6.3.3 Linkage [using.linkage] 
25488: 1 Entities in the C++ standard library have external linkage (3.5). Unless otherwise specified, objects and 
25489: functions have the default extern "C++" linkage (7.5). 
25490: 2 Whether a name from the Standard C library declared with external linkage has extern "C" or extern 
25491: "C++" linkage is implementation-defined. It is recommended that an implementation use extern "C++" 
25492: linkage for this purpose.173 
25493: 3 Objects and functions defined in the library and required by a C++ program are included in the program 
25494: prior to program startup. 
25495: See also: replacement functions (17.6.4.6), run-time changes (17.6.4.7). 
25496: 17.6.4 Constraints on programs [constraints] 
25497: 17.6.4.1 Overview [constraints.overview] 
25498: 1 This section describes restrictions on C++ programs that use the facilities of the C++ standard library. 
25499: The following subclauses specify constraints on the program＊s use of namespaces (17.6.4.2.1), its use of 
25500: various reserved names (17.6.4.3), its use of headers (17.6.4.4), its use of standard library classes as base 
25501: classes (17.6.4.5), its definitions of replacement functions (17.6.4.6), and its installation of handler functions 
25502: during execution (17.6.4.7). 
25503: 17.6.4.2 Namespace use [namespace.constraints] 
25504: 17.6.4.2.1 Namespace std [namespace.std] 
25505: 1 The behavior of a C++ program is undefined if it adds declarations or definitions to namespace std or to 
25506: a namespace within namespace std unless otherwise specified. A program may add a concept map for any 
25507: standard library concept or a template specialization for any standard library template to namespace std 
25508: only if the declaration depends on a user-defined type of external linkage and the specialization meets the 
25509: standard library requirements for the original template and is not explicitly prohibited.174 
25510: 2 The behavior of a C++ program is undefined if it declares 
25511: 〞 an explicit specialization of any member function of a standard library class template, or 
25512: 〞 an explicit specialization of any member function template of a standard library class or class template, 
25513: or 
25514: 〞 an explicit or partial specialization of any member class template of a standard library class or class 
25515: template. 
25516: 172) This is the same as the Standard C library.
25517: 173) The only reliable way to declare an object or function signature from the Standard C library is by including the header
25518: that declares it, notwithstanding the latitude granted in 7.1.7 of the C Standard.
25519: 174) Any library code that instantiates other library templates must be prepared to work adequately with any user-supplied
25520: specialization that meets the minimum requirements of the Standard.
25521: ∫ 17.6.4.2.1 463 
25522: 
25523: c
25524: . ISO/IEC N2800=08-0310 
25525: A program may explicitly instantiate a template defined in the standard library only if the declaration 
25526: depends on the name of a user-defined type of external linkage and the instantiation meets the standard 
25527: library requirements for the original template. 
25528: 3 A translation unit shall not declare namespace std to be an inline namespace (7.3.1). 
25529: 17.6.4.2.2 Namespace posix [namespace.posix] 
25530: 1 The behavior of a C++ program is undefined if it adds declarations or definitions to namespace posix or to 
25531: a namespace within namespace posix unless otherwise specified. The namespace posix is reserved for use 
25532: by ISO/IEC 9945 and other POSIX standards. 
25533: 17.6.4.3 Reserved names [reserved.names] 
25534: 17.6.4.3.1 General [reserved.names.general] 
25535: 1 The C++ standard library reserves the following kinds of names: 
25536: 〞 macros 
25537: 〞 global names 
25538: 〞 names with external linkage 
25539: 2 If a program declares or defines a name in a context where it is reserved, other than as explicitly allowed by 
25540: this Clause, its behavior is undefined. 
25541: 17.6.4.3.2 Macro names [macro.names] 
25542: 1 A translation unit that includes a standard library header shall not #define or #undef names declared in 
25543: any standard library header. 
25544: 2 A translation unit shall not #define or #undef names lexically identical to keywords. 
25545: 17.6.4.3.3 Global names [global.names] 
25546: 1 Certain sets of names and function signatures are always reserved to the implementation: 
25547: 〞 Each name that contains a double underscore _ _ or begins with an underscore followed by an uppercase 
25548: letter (2.11) is reserved to the implementation for any use. 
25549: 〞 Each name that begins with an underscore is reserved to the implementation for use as a name in the 
25550: global namespace.175 
25551: 17.6.4.3.4 External linkage [extern.names] 
25552: 1 Each name declared as an object with external linkage in a header is reserved to the implementation to 
25553: designate that library object with external linkage,176 both in namespace std and in the global namespace. 
25554: 2 Each global function signature declared with external linkage in a header is reserved to the implementation 
25555: to designate that function signature with external linkage.177 
25556: 175) Such names are also reserved in namespace ::std (17.6.4.3).
25557: 176) The list of such reserved names includes errno, declared or defined in <cerrno>.
25558: 177) The list of such reserved function signatures with external linkage includes setjmp(jmp_buf), declared or defined in
25559: <csetjmp>, and va_end(va_list), declared or defined in <cstdarg>.
25560: ∫ 17.6.4.3.4 464 
25561: 
25562: c
25563: . ISO/IEC N2800=08-0310 
25564: 3 Each name having two consecutive underscores (2.11) is reserved to the implementation for use as a name 
25565: with both extern "C" and extern "C++" linkage. 
25566: 4 Each name from the Standard C library declared with external linkage is reserved to the implementation 
25567: for use as a name with extern "C" linkage, both in namespace std and in the global namespace. 
25568: 5 Each function signature from the Standard C library declared with external linkage is reserved to the 
25569: implementation for use as a function signature with both extern "C" and extern "C++" linkage,178 or as 
25570: a name of namespace scope in the global namespace. 
25571: 17.6.4.3.5 Types [extern.types] 
25572: 1 For each type T from the Standard C library,179 the types ::T and std::T are reserved to theimplementation 
25573: and, when defined, ::T shall be identical to std::T. 
25574: 17.6.4.3.6 User-defined literal suffixes [usrlit.suffix] 
25575: 1 Literal suffix identifiers that do not start with an underscore are reserved for future standardization. 
25576: 17.6.4.4 Headers [alt.headers] 
25577: 1 If a file with a name equivalent to the derived file name for one of the C++ standard library headers is not 
25578: provided as part of the implementation, and a file with that name is placed in any of the standard places 
25579: for a source file to be included (16.2), the behavior is undefined. 
25580: 17.6.4.5 Derived classes [derived.classes] 
25581: 1 Virtual member function signatures defined for a base class in the C++ Standard library may be overridden 
25582: in a derived class defined in the program (10.3). 
25583: 17.6.4.6 Replacement functions [replacement.functions] 
25584: 1 Clauses18through30and AnnexDdescribe the behavior of numerous functions defined by the C++ standard 
25585: library. Under some circumstances, however, certain of these function descriptions also apply to replacement 
25586: functions defined in the program (17.3). 
25587: 2 A C++ program may provide the definition for any of eight dynamic memory allocation function signatures 
25588: declared in header <new> (3.7.4, Clause 18): 
25589: 〞 operator new(std::size_t) 
25590: 〞 operator new(std::size_t, const std::nothrow_t&) 
25591: 〞 operator new[](std::size_t) 
25592: 〞 operator new[](std::size_t, const std::nothrow_t&) 
25593: 〞 operator delete(void*) 
25594: 〞 operator delete(void*, const std::nothrow_t&) 
25595: 〞 operator delete[](void*) 
25596: 〞 operator delete[](void*, const std::nothrow_t&) 
25597: 178) The function signatures declared in <cuchar>, <cwchar>, and <cwctype> are always reserved, notwithstanding the restric
25598: tions 
25599: imposed in subclause 4.5.1 of Amendment 1 to the C Standard for these headers.
25600: 179) These types are clock_t, div_t, FILE, fpos_t, lconv, ldiv_t, mbstate_t, ptrdiff_t, sig_atomic_t, size_t, time_t, tm,
25601: va_list, wctrans_t, wctype_t, and wint_t.
25602: ∫ 17.6.4.6 465 
25603: 
25604: c
25605: . ISO/IEC N2800=08-0310 
25606: 3 The program＊s definitions are used instead of the default versions supplied by the implementation (18.5). 
25607: Such replacement occurs prior to program startup (3.2, 3.6). The program＊s definitions shall not be specified 
25608: as inline. No diagnostic is required. 
25609: 17.6.4.7 Handler functions [handler.functions] 
25610: 1 The C++ standard library provides default versions of the following handler functions (Clause 18): 
25611: 〞 unexpected_handler 
25612: 〞 terminate_handler 
25613: 2 A C++ program may install different handler functions during execution, by supplying a pointer to a function 
25614: defined in the program or the library as an argument to (respectively): 
25615: 〞 set_new_handler 
25616: 〞 set_unexpected 
25617: 〞 set_terminate
25618: See also: subclauses 18.5.2, Storage allocation errors, and 18.7, Exception handling.
25619: 17.6.4.8 Other functions [res.on.functions] 
25620: 1 In certain cases (replacement functions, handler functions, operations on types used to instantiate standard 
25621: library template components), the C++ standard library depends on components supplied by a C++ pro-
25622: gram. If these components do not meet their requirements, the Standard places no requirements on the 
25623: implementation. 
25624: 2 In particular, the effects are undefined in the following cases: 
25625: 〞 for replacement functions (18.5.1), if the installed replacement function does not implement the se-
25626: mantics of the applicable Required behavior: paragraph. 
25627: 〞 for handler functions (18.5.2.2, 18.7.3.1, 18.7.2.2), if the installed handler function does not implement 
25628: the semantics of the applicable Required behavior: paragraph 
25629: 〞 for types used as template arguments when instantiating a template component, if the operations on 
25630: the type do not implement the semantics of the applicable Requirements subclause (20.7.2.2, 23.1.6, 
25631: 24.1, 26.1). Operations on such types can report a failure by throwing an exception unless otherwise 
25632: specified. 
25633: 〞 if any replacement function or handler function or destructor operation throws an exception, unless 
25634: specifically allowed in the applicable Required behavior: paragraph. 
25635: 〞 if an incomplete type (3.9) is used as a template argument when instantiating a template component, 
25636: unless specifically allowed for that component. 
25637: 17.6.4.9 Function arguments [res.on.arguments] 
25638: 1 Each of the following statements applies to all arguments to functions defined in the C++ standard library, 
25639: unless explicitly stated otherwise. 
25640: 〞 If an argument to a function has an invalid value (such as a value outside the domain of the function, 
25641: or a pointer invalid for its intended use), the behavior is undefined. 
25642: ∫ 17.6.4.9 466 
25643: 
25644: c
25645: . ISO/IEC N2800=08-0310 
25646: 〞 If a function argument is described as being an array, the pointer actually passed to the function shall 
25647: have a value such that all address computations and accesses to objects (that would be valid if the 
25648: pointer did point to the first element of such an array) are in fact valid. 
25649: 17.6.4.10 Shared objects and the library [res.on.objects] 
25650: 1 The behavior of a program is undefined if calls to standard library functions from different threads may 
25651: introduce a data race. The conditions under which this may occur are specified in 17.6.5.7. 
25652: 17.6.4.11 Required paragraph [res.on.required] 
25653: 1 Violation of the preconditions specified in a function＊s Required behavior: paragraph results in undefined 
25654: behavior unless the function＊s Throws: paragraph specifies throwing an exception when the precondition is 
25655: violated. 
25656: 17.6.5 Conforming implementations [conforming] 
25657: 17.6.5.1 Overview [conforming.overview] 
25658: 1 This section describes the constraints upon, and latitude of, implementations of the C++ standard library. 
25659: 2 An implementation＊s use of headers is discussed in 17.6.5.2, its use of macros in 17.6.5.3, global functions 
25660: in 17.6.5.4, member functions in 17.6.5.5, data race avoidance in 17.6.5.7, access specifiers in 17.6.5.8, class 
25661: derivation in 17.6.5.9, and exceptions in 17.6.5.10. 
25662: 17.6.5.2 Headers [res.on.headers] 
25663: 1 A C++ header may include other C++ headers.180 
25664: 2 Certain types and macros are defined in more than one header. Every such entity shall be defined such that 
25665: any header that defines it may be included after any other header that also defines it (3.2). 
25666: 3 The C standard headers (D.5) shall include only their corresponding C++ standard header, as described 
25667: in 17.6.2.3. 
25668: 17.6.5.3 Restrictions on macro definitions [res.on.macro.definitions] 
25669: 1 The names and global function signatures described in 17.6.2.2 are reserved to the implementation. 
25670: 2 All object-like macros defined by the C standard library and described in this Clause as expanding to 
25671: integral constant expressions are also suitable for use in #if preprocessing directives, unless explicitly stated 
25672: otherwise. 
25673: 17.6.5.4 Global and non-member functions [global.functions] 
25674: 1 It is unspecified whether any global or non-member functions in the C++ standard library are defined as 
25675: inline (7.1.2). 
25676: 2 A call to a global or non-member function signature described in Clauses 18 through 30 and Annex D shall 
25677: behave as if the implementation declared no additional global or non-member function signatures.181 
25678: 3 An implementation shall not declare a global or non-member function signature with additional default 
25679: arguments. 
25680: 180) C++ headers must include a C++ header that contains any needed definition (3.2).
25681: 181) A valid C++ program always calls the expected library global or non-member function. An implementation may also
25682: define additional global or non-member functions that would otherwise not be called by a valid C++ program.
25683: ∫ 17.6.5.4 467 
25684: 
25685: c
25686: . ISO/IEC N2800=08-0310 
25687: 4 Unless otherwise specified, global and non-member functions in the standard library shall not use functions 
25688: from another namespace which are found through argument-dependent name lookup (3.4.2). [ Note: The 
25689: phrase ※unless otherwise specified§ is intended to allow argument-dependent lookup in cases like that of 
25690: ostream_iterators: Effects: 
25691: *out_stream << value;
25692: if (delim != 0)
25693: *out_stream << delim;
25694: return (*this);
25695: 〞end note ] 
25696: 17.6.5.5 Member functions [member.functions] 
25697: 1 It is unspecified whether any member functions in the C++ standard library are defined as inline (7.1.2). 
25698: 2 An implementation may declare additional non-virtual member function signatures within a class: 
25699: 〞 by adding arguments with default values to a member function signature;182 [ Note: An implementation 
25700: may not add arguments with default values to virtual, global, or non-member functions. 〞end note ] 
25701: 〞 by replacing a member function signature with default values by two or more member function signa-
25702: tures with equivalent behavior; and 
25703: 〞 by adding a member function signature for a member function name. 
25704: 3 A call to a member function signature described in the C++ standard library behaves as if the implementation 
25705: declares no additional member function signatures.183 
25706: 17.6.5.6 Reentrancy [reentrancy] 
25707: 1 Except where explicitly specified in this standard, it is implementation defined which functions in the C++ 
25708: standard library may be recursively reentered. 
25709: 17.6.5.7 Data race avoidance [res.on.data.races] 
25710: 1 This section specifies requirements that implementations shall meet to prevent data races (1.10). Every 
25711: standard library function shall meet each requirement unless otherwise specified. Implementations may 
25712: prevent data races in cases other than those specified below. 
25713: 2 A C++ standard library function shall not directly or indirectly access objects (1.10) accessible by threads 
25714: other than the current thread unless the objects are accessed directly or indirectly via the function＊s argu-
25715: ments, including this. 
25716: 3 A C++ standard library function shall not directly or indirectly modify objects (1.10) accessible by threads 
25717: other than the current thread unless the objects are accessed directly or indirectly via the function＊s non-
25718: const arguments, including this. 
25719: 4 [ Note: This means, for example, that implementations can＊t use a static object for internal purposes without 
25720: synchronization because it could cause a data race even in programs that do not explicitly share objects 
25721: between threads. 〞end note ] 
25722: 5 A C++ standard library function shall not access objects indirectly accessible via its arguments or via 
25723: elements of its container arguments except by invoking functions required by its specification on those 
25724: container elements. 
25725: 182) Hence, the address of a member function of a class in the C++ standard library has an unspecified type.
25726: 183) A valid C++ program always calls the expected library member function, or one with equivalent behavior. An implemen
25727: tation 
25728: may also define additional member functions that would otherwise not be called by a valid C++ program.
25729: ∫ 17.6.5.7 468 
25730: 
25731: c
25732: . ISO/IEC N2800=08-0310 
25733: 6 Implementations may share their own internal objects between threads if the objects are not visible to users 
25734: and are protected against data races. 
25735: 7 Unless otherwise specified, C++ standard library functions shall perform all operations solely within the 
25736: current thread if those operations have effects that are visible (1.10) to users. 
25737: 8 [ Note: This allows implementations to parallelize operations if there are no visible side effects. 〞end note ] 
25738: 17.6.5.8 Protection within classes [protection.within.classes] 
25739: 1 It is unspecified whether any function signature or class described in Clauses 18 through 30 and Annex D is 
25740: a friend of another class in the C++ standard library. 
25741: 17.6.5.9 Derived classes [derivation] 
25742: 1 An implementation may derive any class in the C++ standard library from a class with a name reserved to 
25743: the implementation. 
25744: 2 Certain classes defined in the C++ standard library are required to be derived from other classes in the C+ 
25745: + standard library. An implementation may derive such a class directly from the required base or indirectly 
25746: through a hierarchy of base classes with names reserved to the implementation. 
25747: 3 In any case: 
25748: 〞 Every base class described as virtual shall be virtual; 
25749: 〞 Every base class described as non-virtual shall not be virtual; 
25750: 〞 Unless explicitly stated otherwise, types with distinct names shall be distinct types.184 
25751: 17.6.5.10 Restrictions on exception handling [res.on.exception.handling] 
25752: 1 Any of the functions defined in the C++ standard library can report a failure by throwing an exception of 
25753: a type described in its Throws: paragraph or its exception-specification (15.4). An implementation may 
25754: strengthen the exception-specification for a non-virtual function by removing listed exceptions.185 
25755: 2 A function may throw an object of a type not listed in its Throws clause if its type is derived from a type 
25756: named in the Throws clause and would be caught by an exception handler for the base type. 
25757: 3 Functions from the C standard library shall not throw exceptions186 except when such a function calls a 
25758: program-supplied function that throws an exception.187 
25759: 4 Destructor operations defined in the C++ standard library shall not throw exceptions. Any other functions 
25760: defined in the C++ standard library that do not have an exception-specification may throw implementation-
25761: 184) There is an implicit exception to this rule for types that are described as synonyms for basic integral types, such as
25762: size_t (18.1) and streamoff (27.4.1).
25763: 185) That is, an implementation of the function will have an explicit exception-specification thatlists fewer exceptions than those
25764: specified in this International Standard. It may not, however, change the types of exceptions listed in the exception-specification
25765: from those specified, nor add others.
25766: 186) That is, the C library functions all have a throw() exception-specification. This allows implementations to make perfor
25767: mance 
25768: optimizations based on the absence of exceptions at runtime.
25769: 187) The functions qsort() and bsearch() (25.4) meet this condition.
25770: ∫ 17.6.5.10 469 
25771: 
25772: c
25773: . ISO/IEC N2800=08-0310 
25774: defined exceptions unless otherwise specified.188 An implementation may strengthen this implicit exception-
25775: specification by adding an explicit one.189 
25776: 17.6.5.11 Restrictions on storage of pointers [res.on.pointer.storage] 
25777: 1 Objects constructed by the standard library that may hold a user-supplied pointer value or an integer of 
25778: type std::intptr_t shall store such values in a traceable pointer location (3.7.4.3). [ Note: Other libraries 
25779: are strongly encouraged to do the same, since not doing so may result in accidental use of pointers that are 
25780: not safely derived. Libraries that store pointers outside the user＊s address space should make it appear that 
25781: they are stored and retrieved from a traceable pointer location. 〞end note ] 
25782: 17.6.5.12 Value of error codes [value.error.codes] 
25783: 1 Certain functions in the C++ standard library report errors via a std::error_code (19.4.2.2) object. That 
25784: object＊s category() member shall return a reference to std::system_category for errors originating from 
25785: the operating system, or a reference to an implementation-defined error_category object for errors orig-
25786: inating elsewhere. The implementation shall define the possible values of value() for each of these error 
25787: categories. [ Example: For operating systems that are based on POSIX, implementations are encouraged to 
25788: define the std::system_category values as identical to the POSIX errno values, with additional values as 
25789: defined by the operating system＊s documentation. Implementations for operating systems that are not based 
25790: on POSIX are encouraged to define values identical to the operating system＊s values. For errors that do 
25791: not originate from the operating system, the implementation may provide enums for the associated values. 
25792: 〞end example ] 
25793: 188) In particular, they can report a failure to allocate storage by throwing an exception of type bad_alloc, or a class derived 
25794: from bad_alloc (18.5.2.1). Library implementations are encouraged (but not required) to report errors by throwing exceptions 
25795: from (or derived from) the standard exception classes (18.5.2.1, 18.7, 19.1). 
25796: 189) That is, an implementation may provide an explicit exception-specification that defines the subset of ※any§ exceptions 
25797: thrown by that function. This implies that the implementation may list implementation-defined types in such an exception-
25798: specification. 
25799: ∫ 17.6.5.12 470 
25800: 
25801: c
25802: . ISO/IEC N2800=08-0310 
25803: 18 Language support library
25804: [language.support]
25805: 1 This Clause describes the function signatures that are called implicitly, and the types of objects generated 
25806: implicitly, during the execution of some C++ programs. It also describes the headers that declare these 
25807: function signatures and define any related types. 
25808: 2 The following subclauses describe common type definitions used throughout the library, characteristics of 
25809: the predefined types, functions supporting start and termination of a C++ program, support for dynamic 
25810: memory management, support for dynamic type identification, support for exception processing, support 
25811: for initializer lists, and other runtime support, as summarized in Table 16. 
25812: Table 16 〞 Language support library summary 
25813: Subclause Header(s) 
25814: 18.1 Types <cstddef> 
25815: <limits> 
25816: 18.2 Implementation properties <climits> 
25817: <cfloat> 
25818: 18.3 Integer types <cstdint> 
25819: 18.4 Start and termination <cstdlib> 
25820: 18.5 Dynamic memory management <new> 
25821: 18.6 Type identification <typeinfo> 
25822: 18.8 Initializer lists <initializer_list> 
25823: 18.7 Exception handling <exception> 
25824: <cstdarg> 
25825: 18.9 Other runtime support 
25826: <csetjmp> 
25827: <ctime> 
25828: <csignal> 
25829: <cstdlib> 
25830: <cstdbool> 
25831: 18.1 Types [support.types] 
25832: Table 17) describes the header <cstddef>.
25833: Table 17 〞 Header <cstddef> synopsis
25834: Type Name(s) 
25835: Macros: NULL offsetof 
25836: Types: ptrdiff_t size_t 
25837: max_align_t nullptr_t 
25838: 2 The contents are the same as the Standard C library header <stddef.h>, with the following changes: 
25839: ∫ 18.1 471 
25840: 
25841: c
25842: . ISO/IEC N2800=08-0310 
25843: 3 The macro NULL is an implementation-defined C++ null pointer constant in this International Standard (4.10).190 
25844: 4 The macro offsetof(type, member-designator) accepts a restricted set of type arguments in this Interna-
25845: tional Standard. If type is not a standard-layout class (Clause 9), the results are undefined.191 The expression 
25846: offsetof(type, member-designator) is never type-dependent (14.6.2.2) and it is value-dependent (14.6.2.3) 
25847: if and only if type is dependent. The result of applying the offsetof macro to a field that is a static data 
25848: member or a function member is undefined. 
25849: 5 The type max_align_t is a POD type whose alignment requirement is at least as great as that of every 
25850: scalar type, and whose alignment requirement is supported in every context. 
25851: 6 nullptr_t is defined as follows: 
25852: namespace std {
25853: typedef decltype(nullptr) nullptr_t;
25854: }
25855: The type for which nullptr_t is a synonym has the characteristics described in 3.9.1 and 4.10. [ Note: 
25856: Although nullptr＊s address cannot be taken, the address of another nullptr_t object that is an lvalue can 
25857: be taken. 〞end note ] 
25858: See also: subclause 5.3.3, Sizeof, subclause 5.7, Additive operators, subclause 12.5, Free store, and ISO 
25859: C 7.1.6. 
25860: 18.2 Implementation properties [support.limits] 
25861: 1 The headers <limits>, <climits>, <cfloat>, and <cinttypes> supply characteristics of implementation-
25862: dependent arithmetic types (3.9.1). 
25863: 18.2.1 Numeric limits [limits] 
25864: 1 The numeric_limits component provides a C++ program with information about various properties of the 
25865: implementation＊s representation of the arithmetic types. 
25866: 2 Specializations shall be provided for each arithmetic type, both floating point and integer, including bool. 
25867: The member is_specialized shall be true for all such specializations of numeric_limits. 
25868: 3 For all members declared static constexpr in the numeric_limits template, specializations shall define 
25869: these values in such a way that they are usable as constant expressions. 
25870: 4 Non-arithmetic standard types, such as complex<T> (26.3.2), shall not have specializations. 
25871: Header <limits> synopsis 
25872: namespace std {
25873: template<Regular T> class numeric_limits;
25874: enum float_round_style;
25875: enum float_denorm_style;
25876: template<> class numeric_limits<bool>; 
25877: template<> class numeric_limits<char>;
25878: template<> class numeric_limits<signed char>;
25879: template<> class numeric_limits<unsigned char>;
25880: template<> class numeric_limits<char16_t>;
25881: 190) Possible definitions include 0 and 0L, but not (void*)0.
25882: 191) Note that offsetof is required to work as specified even if unary operator& is overloaded for any of the types involved.
25883: ∫ 18.2.1 472 
25884: 
25885: c
25886: . ISO/IEC N2800=08-0310 
25887: template<> class numeric_limits<char32_t>;
25888: template<> class numeric_limits<wchar_t>;
25889: template<> class numeric_limits<short>;
25890: template<> class numeric_limits<int>;
25891: template<> class numeric_limits<long>;
25892: template<> class numeric_limits<long long>;
25893: template<> class numeric_limits<unsigned short>;
25894: template<> class numeric_limits<unsigned int>;
25895: template<> class numeric_limits<unsigned long>;
25896: template<> class numeric_limits<unsigned long long>;
25897: template<> class numeric_limits<float>;
25898: template<> class numeric_limits<double>;
25899: template<> class numeric_limits<long double>;
25900: } 
25901: 18.2.1.1 Class template numeric_limits [numeric.limits] 
25902: namespace std {
25903: template<Regular T> class numeric_limits {
25904: public:
25905: static constexpr bool is_specialized = false;
25906: static constexpr T min() throw() { return T(); }
25907: static constexpr T max() throw() { return T(); }
25908: static constexpr T lowest() throw() { return T(); }
25909: static constexpr int digits = 0;
25910: static constexpr int digits10 = 0;
25911: static constexpr int max_digits10 = 0;
25912: static constexpr bool is_signed = false;
25913: static constexpr bool is_integer = false;
25914: static constexpr bool is_exact = false;
25915: static constexpr int radix = 0;
25916: static constexpr T epsilon() throw() { return T(); }
25917: static constexpr T round_error() throw() { return T(); }
25918: static constexpr int min_exponent = 0;
25919: static constexpr int min_exponent10 = 0;
25920: static constexpr int max_exponent = 0;
25921: static constexpr int max_exponent10 = 0;
25922: static constexpr bool has_infinity = false;
25923: static constexpr bool has_quiet_NaN = false;
25924: static constexpr bool has_signaling_NaN = false;
25925: static constexpr float_denorm_style has_denorm = denorm_absent;
25926: static constexpr bool has_denorm_loss = false;
25927: static constexpr T infinity() throw() { return T(); }
25928: static constexpr T quiet_NaN() throw() { return T(); }
25929: static constexpr T signaling_NaN() throw() { return T(); }
25930: static constexpr T denorm_min() throw() { return T(); }
25931: static constexpr bool is_iec559 = false;
25932: static constexpr bool is_bounded = false;
25933: static constexpr bool is_modulo = false;
25934: ∫ 18.2.1.1 473 
25935: 
25936: c
25937: . ISO/IEC N2800=08-0310 
25938: static constexpr bool traps = false;
25939: static constexpr bool tinyness_before = false;
25940: static constexpr float_round_style round_style = round_toward_zero;
25941: }; 
25942: template<class T> class numeric_limits<const T>;
25943: template<class T> class numeric_limits<volatile T>;
25944: template<class T> class numeric_limits<const volatile T>;
25945: } 
25946: 1 The default numeric_limits<T> template shall have all members, but with 0 or false values. 
25947: 2 The value of each member of a specialization of numeric_limits on a cv-qualified type cv T shall be equal 
25948: to the value of the corresponding member of the specialization on the unqualified type T. 
25949: 18.2.1.2 numeric_limits members [numeric.limits.members] 
25950: static constexpr T min() throw(); 
25951: 1 Minimum finite value.192
25952: 2 For floating types with denormalization, returns the minimum positive normalized value.
25953: 3 Meaningful for all specializations in which is_bounded != false, or is_bounded == false && is_
25954: 
25955: signed 
25956: == false. 
25957: static constexpr T max() throw(); 
25958: 4 Maximum finite value.193
25959: 5 Meaningful for all specializations in which is_bounded != false.
25960: static constexpr T lowest() throw(); 
25961: 194 
25962: 6 A finite value x such that there is no other finite value y where y<x.
25963: 7 Meaningful for all specializations in which is_bounded != false.
25964: static constexpr int digits; 
25965: 8 Number of radix digits that can be represented without change. 
25966: 9 For integer types, the number of non-sign bits in the representation. 
25967: 10 For floating point types, the number of radix digits in the mantissa.195 
25968: static constexpr int digits10; 
25969: 11 Number of base 10 digits that can be represented without change.196 
25970: 12 Meaningful for all specializations in which is_bounded != false. 
25971: static constexpr int max_digits10; 
25972: 192) Equivalent to CHAR_MIN, SHRT_MIN, FLT_MIN, DBL_MIN, etc.
25973: 193) Equivalent to CHAR_MAX, SHRT_MAX, FLT_MAX, DBL_MAX, etc.
25974: 194) lowest() is necessary because not all floating-point representations have a smallest (most negative) value that is the
25975: negative of the largest (most positive) finite value.
25976: 195) Equivalent to FLT_MANT_DIG, DBL_MANT_DIG, LDBL_MANT_DIG.
25977: 196) Equivalent to FLT_DIG, DBL_DIG, LDBL_DIG.
25978: ∫ 18.2.1.2 474 
25979: 
25980: c
25981: . ISO/IEC N2800=08-0310 
25982: 13 Number of base 10 digits required to ensure that values which differ are always differentiated. 
25983: 14 Meaningful for all floating point types. 
25984: static constexpr bool is_signed; 
25985: 15 True if the type is signed. 
25986: 16 Meaningful for all specializations. 
25987: static constexpr bool is_integer; 
25988: 17 True if the type is integer. 
25989: 18 Meaningful for all specializations. 
25990: static constexpr bool is_exact; 
25991: 19 True if the type uses an exact representation. All integer types are exact, but not all exact types are 
25992: integer. For example, rational and fixed-exponent representations are exact but not integer. 
25993: 20 Meaningful for all specializations. 
25994: static constexpr int radix; 
25995: 21 For floating types, specifies the base or radix of the exponent representation (often 2).197 
25996: 22 For integer types, specifies the base of the representation.198 
25997: 23 Meaningful for all specializations. 
25998: static constexpr T epsilon() throw(); 
25999: 24 Machine epsilon: the difference between 1 and the least value greater than 1 that is representable.199 
26000: 25 Meaningful for all floating point types. 
26001: static constexpr T round_error() throw(); 
26002: 26 Measure of the maximum rounding error.200 
26003: static constexpr int min_exponent; 
26004: 27 Minimum negative integer such that radix raised to the power of one less than that integer is a 
26005: normalized floating point number.201 
26006: 28 Meaningful for all floating point types. 
26007: static constexpr int min_exponent10; 
26008: 29 Minimum negative integer such that 10 raised to that power is in the range of normalized floating 
26009: point numbers.202 
26010: 30 Meaningful for all floating point types. 
26011: static constexpr int max_exponent; 
26012: 197) Equivalent to FLT_RADIX.
26013: 198) Distinguishes types with bases other than 2 (e.g. BCD).
26014: 199) Equivalent to FLT_EPSILON, DBL_EPSILON, LDBL_EPSILON.
26015: 200) Rounding error is described in ISO/IEC 10967-1 Language independent arithmetic -Part 1 Section 5.2.8 and Annex A
26016: Rationale Section A.5.2.8 -Rounding constants.
26017: 201) Equivalent to FLT_MIN_EXP, DBL_MIN_EXP, LDBL_MIN_EXP.
26018: 202) Equivalent to FLT_MIN_10_EXP, DBL_MIN_10_EXP, LDBL_MIN_10_EXP.
26019: ∫ 18.2.1.2 475 
26020: 
26021: c
26022: . ISO/IEC 
26023: 31 Maximum positive integer such that radix raised to the power one 
26024: sentable finite floating point number.203 
26025: 32 Meaningful for all floating point types. 
26026: static constexpr int max_exponent10; 
26027: N2800=08-0310 
26028: less than that integer is a repre-
26029: 33 Maximum positive integer such that 10 raised to that power is in the range of representable finite 
26030: floating point numbers.204 
26031: 34 Meaningful for all floating point types. 
26032: static constexpr bool has_infinity; 
26033: 35 True if the type has a representation for positive infinity.
26034: 36 Meaningful for all floating point types.
26035: 37 Shall be true for all specializations in which is_iec559 != false.
26036: static constexpr bool has_quiet_NaN; 
26037: 38 True if the type has a representation for a quiet (non-signaling) ※Not a Number.§205
26038: 39 Meaningful for all floating point types.
26039: 40 Shall be true for all specializations in which is_iec559 != false.
26040: static constexpr bool has_signaling_NaN; 
26041: 41 True if the type has a representation for a signaling ※Not a Number.§206
26042: 42 Meaningful for all floating point types.
26043: 43 Shall be true for all specializations in which is_iec559 != false.
26044: static constexpr float_denorm_style has_denorm; 
26045: 44 denorm_present if the type allows denormalized values (variable number of exponent bits)207, denorm_-
26046: absent if the type does not allow denormalized values, and denorm_indeterminate if it is indetermi-
26047: nate at compile time whether the type allows denormalized values. 
26048: 45 Meaningful for all floating point types. 
26049: static constexpr bool has_denorm_loss; 
26050: 46 True if loss of accuracy is detected as a denormalization loss, rather than as an inexact result.208 
26051: static constexpr T infinity() throw(); 
26052: 47 Representation of positive infinity, if available.209 
26053: 48 Meaningful for all specializations for which has_infinity != false. Required in specializations for 
26054: which is_iec559 != false. 
26055: static constexpr T quiet_NaN() throw(); 
26056: 203) Equivalent to FLT_MAX_EXP, DBL_MAX_EXP, LDBL_MAX_EXP.
26057: 204) Equivalent to FLT_MAX_10_EXP, DBL_MAX_10_EXP, LDBL_MAX_10_EXP.
26058: 205) Required by LIA-1.
26059: 206) Required by LIA-1.
26060: 207) Required by LIA-1.
26061: 208) See IEC 559.
26062: 209) Required by LIA-1.
26063: ∫ 18.2.1.2 476 
26064: 
26065: c
26066: . ISO/IEC N2800=08-0310 
26067: 49 Representation of a quiet ※Not a Number,§ if available.210 
26068: 50 Meaningful for all specializations for which has_quiet_NaN != false. Required in specializations for 
26069: which is_iec559 != false. 
26070: static constexpr T signaling_NaN() throw(); 
26071: 51 Representation of a signaling ※Not a Number,§ if available.211 
26072: 52 Meaningful for all specializations for which has_signaling_NaN != false. Required in specializations 
26073: for which is_iec559 != false. 
26074: static constexpr T denorm_min() throw(); 
26075: 53 Minimum positive denormalized value.212
26076: 54 Meaningful for all floating point types.
26077: 55 In specializations for which has_denorm == false, returns the minimum positive normalized value.
26078: static constexpr bool is_iec559; 
26079: 56 True if and only if the type adheres to IEC 559 standard.213 
26080: 57 Meaningful for all floating point types. 
26081: static constexpr bool is_bounded; 
26082: 58 True if the set of values representable by the type is finite.214 [ Note: All built-in types are bounded. 
26083: This member would be false for arbitrary precision types. 〞end note ] 
26084: 59 Meaningful for all specializations. 
26085: static constexpr bool is_modulo; 
26086: 60 True if the type is modulo.215 A type is modulo if, for any operation involving +, -, or * on values 
26087: of that type whose result would fall outside the range [min(),max()], the value returned differs from 
26088: the true value by an integer multiple of max() -min() + 1. 
26089: 61 On most machines, this is false for floating types, true for unsigned integers, and true for signed 
26090: integers. 
26091: 62 Meaningful for all specializations. 
26092: static constexpr bool traps; 
26093: 63 true if, at program startup, there exists a value of the type that would cause an arithmetic operation 
26094: using that value to trap.216 
26095: 64 Meaningful for all specializations. 
26096: static constexpr bool tinyness_before; 
26097: 210) Required by LIA-1.
26098: 211) Required by LIA-1.
26099: 212) Required by LIA-1.
26100: 213) International Electrotechnical Commission standard 559 is the same as IEEE 754.
26101: 214) Required by LIA-1.
26102: 215) Required by LIA-1.
26103: 216) Required by LIA-1.
26104: ∫ 18.2.1.2 477 
26105: 
26106: c
26107: . ISO/IEC N2800=08-0310 
26108: 65 true if tinyness is detected before rounding.217 
26109: 66 Meaningful for all floating point types. 
26110: static constexpr float_round_style round_style; 
26111: 67 The rounding style for the type.218 
26112: 68 Meaningful for all floating point types. Specializations for integer types shall return round_toward_-
26113: zero. 
26114: 18.2.1.3 Type float_round_style [round.style] 
26115: namespace std { 
26116: enum float_round_style {
26117: round_indeterminate = -1,
26118: round_toward_zero = 0,
26119: round_to_nearest = 1,
26120: round_toward_infinity = 2,
26121: round_toward_neg_infinity = 3
26122: };
26123: }
26124: 1 The rounding mode for floating point arithmetic is characterized by the values: 
26125: 〞 round_indeterminate if the rounding style is indeterminable 
26126: 〞 round_toward_zero if the rounding style is toward zero 
26127: 〞 round_to_nearest if the rounding style is to the nearest representable value 
26128: 〞 round_toward_infinity if the rounding style is toward infinity 
26129: 〞 round_toward_neg_infinity if the rounding style is toward negative infinity 
26130: 18.2.1.4 Type float_denorm_style [denorm.style] 
26131: namespace std { 
26132: enum float_denorm_style {
26133: denorm_indeterminate = -1,
26134: denorm_absent = 0,
26135: denorm_present = 1
26136: };
26137: }
26138: 1 The presence or absence of denormalization (variable number of exponent bits) is characterized by the values: 
26139: 〞 denorm_indeterminate if it cannot be determined whether or not the type allows denormalized values 
26140: 〞 denorm_absent if the type does not allow denormalized values 
26141: 〞 denorm_present if the type does allow denormalized values 
26142: 217) Refer to IEC 559. Required by LIA-1.
26143: 218) Equivalent to FLT_ROUNDS. Required by LIA-1.
26144: ∫ 18.2.1.4 478 
26145: 
26146: c
26147: . ISO/IEC N2800=08-0310 
26148: 18.2.1.5 numeric_limits specializations [numeric.special] 
26149: 1 All members shall be provided for all specializations. However, many values are only required to be mean-
26150: ingful under certain conditions (for example, epsilon() is only meaningful if is_integer is false). Any 
26151: value that is not ※meaningful§ shall be set to 0 or false. 
26152: 2 [ Example: 
26153: namespace std {
26154: template<> class numeric_limits<float> {
26155: public:
26156: static constexpr bool is_specialized = true; 
26157: inline static constexpr float min() throw() { return 1.17549435E-38F; }
26158: inline static constexpr float max() throw() { return 3.40282347E+38F; }
26159: inline static constexpr float lowest() throw() { return -3.40282347E+38F; }
26160: static constexpr int digits = 24;
26161: static constexpr int digits10 = 6;
26162: static constexpr int max_digits10 = 9;
26163: static constexpr bool is_signed = true;
26164: static constexpr bool is_integer = false;
26165: static constexpr bool is_exact = false;
26166: static constexpr int radix = 2;
26167: inline static constexpr float epsilon() throw() { return 1.19209290E-07F; }
26168: inline static constexpr float round_error() throw() { return 0.5F; }
26169: static constexpr int min_exponent = -125;
26170: static constexpr int min_exponent10 = -37;
26171: static constexpr int max_exponent = +128;
26172: static constexpr int max_exponent10 = + 38;
26173: static constexpr bool has_infinity = true;
26174: static constexpr bool has_quiet_NaN = true;
26175: static constexpr bool has_signaling_NaN = true;
26176: static constexpr float_denorm_style has_denorm = denorm_absent;
26177: static constexpr bool has_denorm_loss = false;
26178: inline static constexpr float infinity() throw() { return ...; }
26179: inline static constexpr float quiet_NaN() throw() { return ...; }
26180: inline static constexpr float signaling_NaN() throw() { return ...; }
26181: inline static constexpr float denorm_min() throw() { return min(); }
26182: static constexpr bool is_iec559 = true;
26183: static constexpr bool is_bounded = true;
26184: static constexpr bool is_modulo = false;
26185: static constexpr bool traps = true;
26186: static constexpr bool tinyness_before = true;
26187: static constexpr float_round_style round_style = round_to_nearest;
26188: };
26189: }
26190: 〞end example ] 
26191: ∫ 18.2.1.5 479 
26192: 
26193: c
26194: . ISO/IEC N2800=08-0310 
26195: 3 The specialization for bool shall be provided as follows: 
26196: namespace std {
26197: template<> class numeric_limits<bool> {
26198: public:
26199: static constexpr bool is_specialized = true;
26200: static constexpr bool min() throw() { return false; }
26201: static constexpr bool max() throw() { return true; }
26202: static constexpr bool lowest() throw() { return false; }
26203: static constexpr int digits = 1;
26204: static constexpr int digits10 = 0;
26205: static constexpr int max_digits10 = 0;
26206: static constexpr bool is_signed = false;
26207: static constexpr bool is_integer = true;
26208: static constexpr bool is_exact = true;
26209: static constexpr int radix = 2;
26210: static constexpr bool epsilon() throw() { return 0; }
26211: static constexpr bool round_error() throw() { return 0; }
26212: static constexpr int min_exponent = 0;
26213: static constexpr int min_exponent10 = 0;
26214: static constexpr int max_exponent = 0;
26215: static constexpr int max_exponent10 = 0;
26216: static constexpr bool has_infinity = false;
26217: static constexpr bool has_quiet_NaN = false;
26218: static constexpr bool has_signaling_NaN = false;
26219: static constexpr float_denorm_style has_denorm = denorm_absent;
26220: static constexpr bool has_denorm_loss = false;
26221: static constexpr bool infinity() throw() { return 0; }
26222: static constexpr bool quiet_NaN() throw() { return 0; }
26223: static constexpr bool signaling_NaN() throw() { return 0; }
26224: static constexpr bool denorm_min() throw() { return 0; }
26225: static constexpr bool is_iec559 = false;
26226: static constexpr bool is_bounded = true;
26227: static constexpr bool is_modulo = false;
26228: static constexpr bool traps = false;
26229: static constexpr bool tinyness_before = false;
26230: static constexpr float_round_style round_style = round_toward_zero;
26231: };
26232: }
26233: 18.2.2 C Library [c.limits] 
26234: 1 Table 18 describes the header <climits>.
26235: 2 The contents are the same as the Standard C library header <limits.h>.[ Note: The types of the constants
26236: defined by macros in <climits> are not required to match the types to which the macros refer. 〞end note ] 
26237: 3 Table 19 describes the header <cfloat>. 
26238: 4 The contents are the same as the Standard C library header <float.h>. 
26239: ∫ 18.2.2 480 
26240: 
26241: . ISO/IEC N2800=08-0310 
26242: Table 18 〞 Header <climits> synopsis 
26243: Type Name(s) 
26244: Values: 
26245: CHAR_BIT INT_MAX LONG_MAX SCHAR_MIN SHRT_MIN ULLONG_MAX 
26246: CHAR_MAX LLONG_MAX LONG_MIN SCHAR_MAX UCHAR_MAX ULONG_MAX 
26247: CHAR_MIN LLONG_MIN MB_LEN_MAX SHRT_MAX UINT_MAX USHRT_MAX 
26248: INT_MIN 
26249: Table 19 〞 Header <cfloat> synopsis 
26250: Type 
26251: Values: 
26252: DBL_DIG 
26253: DBL_EPSILON 
26254: DBL_MANT_DIG 
26255: DBL_MAX 
26256: DBL_MAX_10_EXP 
26257: DBL_MAX_EXP 
26258: DBL_MIN 
26259: DBL_MIN_10_EXP 
26260: DBL_MIN_EXP 
26261: DECIMAL_DIG 
26262: FLT_DIG 
26263: FLT_EPSILON 
26264: FLT_EVAL_METHOD 
26265: FLT_MANT_DIG 
26266: FLT_MAX 
26267: FLT_MAX_10_EXP 
26268: Name(s) 
26269: FLT_MAX_EXP 
26270: FLT_MIN 
26271: FLT_MIN_10_EXP 
26272: FLT_MIN_EXP 
26273: FLT_RADIX 
26274: FLT_ROUNDS 
26275: LDBL_DIG 
26276: LDBL_EPSILON 
26277: LDBL_MANT_DIG 
26278: LDBL_MAX_10_EXP 
26279: LDBL_MAX_EXP 
26280: LDBL_MAX 
26281: LDBL_MIN 
26282: LDBL_MIN_10_EXP 
26283: LDBL_MIN_EXP 
26284: See also: ISO C 7.1.5, 5.2.4.2.2, 5.2.4.2.1. 
26285: 18.3 Integer types [cstdint] 
26286: 18.3.1 Header <cstdint> synopsis [cstdint.syn] 
26287: namespace std { 
26288: typedef signed integer type int8_t; // optional 
26289: typedef signed integer type int16_t; // optional 
26290: typedef signed integer type int32_t; // optional 
26291: typedef signed integer type int64_t; // optional 
26292: typedef signed integer type int_fast8_t;
26293: typedef signed integer type int_fast16_t;
26294: typedef signed integer type int_fast32_t;
26295: typedef signed integer type int_fast64_t;
26296: typedef signed integer type int_least8_t;
26297: typedef signed integer type int_least16_t;
26298: typedef signed integer type int_least32_t;
26299: typedef signed integer type int_least64_t;
26300: typedef signed integer type intmax_t;
26301: typedef signed integer type intptr_t; // optional
26302: typedef unsigned integer type uint8_t; // optional
26303: typedef unsigned integer type uint16_t; // optional
26304: typedef unsigned integer type uint32_t; // optional
26305: typedef unsigned integer type uint64_t; // optional
26306: typedef unsigned integer type uint_fast8_t; 
26307: ∫ 18.3.1 481 
26308: 
26309: c
26310: . ISO/IEC N2800=08-0310 
26311: typedef unsigned integer type uint_fast16_t;
26312: typedef unsigned integer type uint_fast32_t;
26313: typedef unsigned integer type uint_fast64_t;
26314: typedef unsigned integer type uint_least8_t;
26315: typedef unsigned integer type uint_least16_t;
26316: typedef unsigned integer type uint_least32_t;
26317: typedef unsigned integer type uint_least64_t;
26318: typedef unsigned integer type uintmax_t;
26319: typedef unsigned integer type uintptr_t; // optional
26320: } // namespace std
26321: 1 The header also defines numerous macros of the form: 
26322: INT_[FAST LEAST]{8 16 32 64}_MIN
26323: [U]INT_[FAST LEAST]{8 16 32 64}_MAX
26324: INT{MAX PTR}_MIN
26325: [U]INT{MAX PTR}_MAX
26326: {PTRDIFF SIG_ATOMIC WCHAR WINT}{_MAX _MIN}
26327: SIZE_MAX
26328: plus function macros of the form: 
26329: [U]INT{8 16 32 64 MAX}_C 
26330: 2 The header defines all functions, types, and macros the same as C99 7.18. [ Note: The macros defined by 
26331: <stdint> are provided unconditionally. In particular, the symbols __STDC_LIMIT_MACROS and __STDC_-
26332: CONSTANT_MACROS (mentioned in C99 footnotes 219, 220, and 222) play no role in C++. 〞end note ] 
26333: 18.3.2 The header <stdint.h> [stdinth] 
26334: 1 The header behaves as if it includes the header <cstdint>, and provides sufficient using declarations to 
26335: declare in the global namespace all type names defined in the header <cstdint>. 
26336: 18.4 Start and termination [support.start.term] 
26337: 1 Table 20 describes some of the contents of the header <cstdlib>. 
26338: Table 20 〞 Header <cstdlib> synopsis 
26339: Type Name(s) 
26340: Macros: EXIT_FAILURE EXIT_SUCCESS 
26341: Functions: abort atexit at_quick_exit 
26342: exit quick_exit 
26343: 2 The contents are the same as the Standard C library header <stdlib.h>, with the following changes: 
26344: abort(void) 
26345: 3 The function abort() has additional behavior in this International Standard: 
26346: 〞 The program is terminated without executing destructors for objects of automatic, thread, or 
26347: static storage duration and without calling the functions passed to atexit() (3.6.3). 
26348: extern "C" int atexit(void (*f)(void))
26349: extern "C++" int atexit(void (*f)(void))
26350: ∫ 18.4 482 
26351: 
26352: c
26353: . ISO/IEC N2800=08-0310 
26354: 4 Effects: The atexit() functions register the function pointed to by f to be called without arguments 
26355: at normal program termination. 
26356: 5 Implementation limits: The implementation shall support the registration of at least 32 functions. 
26357: 6 Returns: The atexit() function returns zero if the registration succeeds, nozero if it fails. 
26358: exit(int status) 
26359: 7 The function exit() has additional behavior in this International Standard: 
26360: 〞 First, objects with thread storage duration and associated with the current thread are destroyed. 
26361: Next, objects with static storage duration are destroyed and functions registered by calling atexit 
26362: are called.219 See 3.6.3 for the order of destructions and calls. (Automatic objects are not 
26363: destroyed as a result of calling exit().)220 
26364: If control leaves a registered function called by exit because the function does not provide a 
26365: handler for a thrown exception, terminate() shall be called. 
26366: 〞 Next, all open C streams (as mediated by the function signatures declared in <cstdio>) with 
26367: unwritten buffered data are flushed, all open C streams are closed, and all files created by calling 
26368: tmpfile() are removed.221 
26369: 〞 Finally, control is returned to the host environment. If status is zero or EXIT_SUCCESS, an im-
26370: plementation-defined form of the status successful termination is returned. If status is EXIT_-
26371: FAILURE, an implementation-defined form of the status unsuccessful termination is returned. 
26372: Otherwise the status returned is implementation-defined.222 
26373: 8 The function exit() never returns to its caller. 
26374: extern "C" int at_quick_exit(void (*f)(void));
26375: extern "C++" int at_quick_exit(void (*f)(void));
26376: 9 Effects: The at_quick_exit() functions register the function pointed to by f to be called without 
26377: arguments when quick_exit is called. The at_quick_exit() functions shall be thread safe. [ Note: 
26378: The at_quick_exit registrations are distinct from the atexit registrations, and applications may 
26379: need to call both registration functions with the same argument. 〞end note ] 
26380: 10 Implementation limits: The implementation shall support the registration of at least 32 functions. 
26381: 11 Returns: zero if the registration succeeds, non-zero if it fails. 
26382: void quick_exit(int status) 
26383: 12 Effects: Functions registered by calls to at_quick_exit are called in the reverse order of their reg-
26384: istration, except that a function shall be called after any previously registered functions that had 
26385: already been called at the time it was registered. Objects shall not be destroyed as a result of calling 
26386: quick_exit. 
26387: If control leaves a registered function called by quick_exit because the function does not provide a 
26388: handler for a thrown exception, terminate() shall be called. 
26389: 219) A function is called for every time it is registered.
26390: 220) Objects with automatic storage duration are all destroyed in a program whose function main() contains no automatic
26391: objects and executes the call to exit(). Control can be transferred directly to such a main() by throwing an exception that is
26392: caught in main().
26393: 221) Any C streams associated with cin, cout, etc (27.3) are flushed and closed when static objects are destroyed in the previous
26394: phase. The function tmpfile() is declared in <cstdio>.
26395: 222) The macros EXIT_FAILURE and EXIT_SUCCESS are defined in <cstdlib>.
26396: ∫ 18.4 483 
26397: 
26398: c
26399: . ISO/IEC N2800=08-0310 
26400: After calling registered functions, quick_exit shall call _Exit(status).[ Note: The standard file 
26401: buffers are not flushed. See: ISO C 7.20.4.4. 〞end note ] 
26402: 13 The function quick_exit() never returns to its caller. 
26403: See also: 3.6, 3.6.3, ISO C 7.10.4. 
26404: 18.5 Dynamic memory management [support.dynamic] 
26405: 1 The header <new> defines several functions that manage the allocation of dynamic storage in a program. It 
26406: also defines components for reporting storage management errors. 
26407: Header <new> synopsis 
26408: namespace std {
26409: class bad_alloc;
26410: struct nothrow_t {};
26411: extern const nothrow_t nothrow;
26412: typedef void (*new_handler)();
26413: new_handler set_new_handler(new_handler new_p) throw();
26414: } 
26415: void* operator new(std::size_t size) throw(std::bad_alloc);
26416: void* operator new(std::size_t size, const std::nothrow_t&) throw();
26417: void operator delete(void* ptr) throw();
26418: void operator delete(void* ptr, const std::nothrow_t&) throw();
26419: void* operator new[](std::size_t size) throw(std::bad_alloc);
26420: void* operator new[](std::size_t size, const std::nothrow_t&) throw();
26421: void operator delete[](void* ptr) throw();
26422: void operator delete[](void* ptr, const std::nothrow_t&) throw();
26423: void* operator new (std::size_t size, void* ptr) throw();
26424: void* operator new[](std::size_t size, void* ptr) throw();
26425: void operator delete (void* ptr, void*) throw();
26426: void operator delete[](void* ptr, void*) throw();
26427: See also: 1.7, 3.7.4, 5.3.4, 5.3.5, 12.5, 20.7. 
26428: 18.5.1 Storage allocation and deallocation [new.delete] 
26429: 1 Except where otherwise specified, the provisions of (3.7.4) apply to the library versions of operator new 
26430: and operator delete. 
26431: 18.5.1.1 Single-object forms [new.delete.single] 
26432: void* operator new(std::size_t size) throw(std::bad_alloc); 
26433: 1 Effects: The allocation function (3.7.4.1) called by a new-expression (5.3.4) to allocate size bytes of 
26434: storage suitably aligned to represent any object of that size. 
26435: 2 Replaceable: a C++ program may define a function with this function signature that displaces the 
26436: default version defined by the C++ standard library. 
26437: 3 Required behavior: Return a non-null pointer to suitably aligned storage (3.7.4), or else throw a bad_-
26438: alloc exception. This requirement is binding on a replacement version of this function. 
26439: 4 Default behavior: 
26440: ∫ 18.5.1.1 484 
26441: 
26442: c
26443: . ISO/IEC N2800=08-0310 
26444: 〞 Executes a loop: Within the loop, the function first attempts to allocate the requested storage. 
26445: Whether the attempt involves a call to the Standard C library function malloc is unspecified. 
26446: 〞 Returns a pointer to the allocated storage if the attempt is successful. Otherwise, if the last 
26447: argument to set_new_handler() was a null pointer, throw bad_alloc. 
26448: 〞 Otherwise, the function calls the current new_handler (18.5.2.2). If the called function returns, 
26449: the loop repeats. 
26450: 〞 The loop terminates when an attempt to allocate the requested storage is successful or when a 
26451: called new_handler function does not return. 
26452: void* operator new(std::size_t size, const std::nothrow_t&) throw(); 
26453: 5 Effects: Same as above, except that it is called by a placement version of a new-expression when a C 
26454: ++ program prefers a null pointer result as an error indication, instead of a bad_alloc exception. 
26455: 6 Replaceable: a C++ program may define a function with this function signature that displaces the 
26456: default version defined by the C++ standard library. 
26457: 7 Required behavior: Return a non-null pointer to suitably aligned storage (3.7.4), or else return a null 
26458: pointer. This nothrow version of operator new returns a pointer obtained as if acquired from the 
26459: (possibly replaced) ordinary version. This requirement is binding on a replacement version of this 
26460: function. 
26461: 8 Default behavior: Calls operator new(size). If the call returns normally, returns the result of that 
26462: call. Otherwise, returns a null pointer. 
26463: 9 [ Example: 
26464: T* p1 = new T; // throws bad_alloc if it fails
26465: T* p2 = new(nothrow) T; // returns 0 if it fails
26466: 〞end example ] 
26467: void operator delete(void* ptr) throw();
26468: void operator delete(void* ptr, const std::nothrow_t&) throw();
26469: 10 Effects: The deallocation function (3.7.4.2) called by a delete-expression to render the value of ptr 
26470: invalid. 
26471: 11 Replaceable: a C++ program may define a function with this function signature that displaces the 
26472: default version defined by the C++ standard library. 
26473: 12 Requires: ptr shall be a null pointer or its value shall be a value returned by an earlier call to the (possi-
26474: bly replaced) operator new(std::size_t) or operator new(std::size_t,const std::nothrow_-
26475: t&) which has not been invalidated by an intervening call to operator delete(void*). 
26476: 13 Default behavior: If ptr is null, does nothing. Otherwise, reclaims the storage allocated by the earlier 
26477: call to operator new. 
26478: 14 Remarks: It is unspecified under what conditions part or all of such reclaimed storage will be allocated 
26479: by subsequent calls to operator new or any of calloc, malloc, or realloc, declared in <cstdlib>. 
26480: void operator delete(void* ptr, const std::nothrow_t&) throw(); 
26481: 15 Effects: The deallocation function (3.7.4.2) called by the implementation to render the value of ptr 
26482: invalid when the constructor invoked from a nothrow placement version of the new-expression throws 
26483: an exception. 
26484: ∫ 18.5.1.1 485 
26485: 
26486: c
26487: . ISO/IEC N2800=08-0310 
26488: 16 Replaceable: a C++ program may define a function with this function signature that displaces the 
26489: default version defined by the C++ standard library. 
26490: 17 Default behavior: calls operator delete(ptr). 
26491: 18.5.1.2 Array forms [new.delete.array] 
26492: void* operator new[](std::size_t size) throw(std::bad_alloc); 
26493: 1 Effects: The allocation function (3.7.4.1) called by the array form of a new-expression (5.3.4) to allocate 
26494: size bytes of storage suitably aligned to represent any array object of that size or smaller.223 
26495: 2 Replaceable: a C++ program can define a function with this function signature that displaces the 
26496: default version defined by the C++ standard library. 
26497: 3 Required behavior: Same as for operator new(std::size_t). This requirement is binding on a re-
26498: placement version of this function. 
26499: 4 Default behavior: Returns operator new(size). 
26500: void* operator new[](std::size_t size, const std::nothrow_t&) throw(); 
26501: 5 Effects: Same as above, except that it is called by a placement version of a new-expression when a C 
26502: ++ program prefers a null pointer result as an error indication, instead of a bad_alloc exception. 
26503: 6 Replaceable: a C++ program can define a function with this function signature that displaces the 
26504: default version defined by the C++ standard library. 
26505: 7 Required behavior: Return a non-null pointer to suitably aligned storage (3.7.4), or return a null 
26506: pointer. This requirement is binding on a replacement version of this function. 
26507: 8 Default behavior: Calls operator new[](size). If the call returns normally, returns the result of that 
26508: call. Otherwise, returns a null pointer. 
26509: void operator delete[](void* ptr) throw();
26510: void operator delete[](void* ptr, const std::nothrow_t&) throw();
26511: 9 Effects: The deallocation function (3.7.4.2) called by the array form of a delete-expression to render 
26512: the value of ptr invalid. 
26513: 10 Replaceable: a C++ program can define a function with this function signature that displaces the 
26514: default version defined by the C++ standard library. 
26515: 11 Requires: ptr shall be a null pointer or its value shall be the value returned by an earlier call to 
26516: operator new[](std::size_t) or operator new[](std::size_t,const std::nothrow_t&) which 
26517: has not been invalidated by an intervening call to operator delete[](void*). 
26518: 12 Default behavior: Calls operator delete(ptr). 
26519: void operator delete[](void* ptr, const std::nothrow_t&) throw(); 
26520: 13 Effects: The deallocation function (3.7.4.2) called by the implementation to render the value of ptr 
26521: invalid when the constructor invoked from a nothrow placement version of the array new-expression 
26522: throws an exception. 
26523: 223) It is not the direct responsibility of operator new[](std::size_t) or operator delete[](void*) to note the repetition 
26524: count or element size of the array. Those operations are performed elsewhere in the array new and delete expressions. The 
26525: array new expression, may, however, increase the size argument to operator new[](std::size_t) to obtain space to store 
26526: supplemental information. 
26527: ∫ 18.5.1.2 486 
26528: 
26529: c
26530: . ISO/IEC N2800=08-0310 
26531: 14 Replaceable: a C++ program may define a function with this function signature that displaces the 
26532: default version defined by the C++ standard library. 
26533: 15 Default behavior: calls operator delete[](ptr). 
26534: 18.5.1.3 Placement forms [new.delete.placement] 
26535: 1 These functions are reserved, a C++ program may not define functions that displace the versions in the 
26536: Standard C++ library (17.6.4). The provisions of (3.7.4) do not apply to these reserved placement forms of 
26537: operator new and operator delete. 
26538: void* operator new(std::size_t size, void* ptr) throw(); 
26539: 2 Returns: ptr. 
26540: 3 Remarks: Intentionally performs no other action.
26541: 4 [ Example: This can be useful for constructing an object at a known address:
26542: void* place = operator new(sizeof(Something));
26543: Something* p = new (place) Something();
26544: 〞end example ] 
26545: void* operator new[](std::size_t size, void* ptr) throw(); 
26546: 5 Returns: ptr.
26547: 6 Remarks: Intentionally performs no other action.
26548: void operator delete(void* ptr, void*) throw(); 
26549: 7 Effects: Intentionally performs no action. 
26550: 8 Remarks: Default function called when any part of the initialization in a placement new expression that 
26551: invokes the library＊s non-array placement operator new terminates by throwing an exception (5.3.4). 
26552: void operator delete[](void* ptr, void*) throw(); 
26553: 9 Effects: Intentionally performs no action. 
26554: 10 Remarks: Default function called when any part of the initialization in a placement new expression 
26555: that invokes the library＊s array placement operator new terminates by throwing an exception (5.3.4). 
26556: 18.5.1.4 Data races [new.delete.dataraces] 
26557: 1 The library versions of operator new and operator delete, user replacement versions of global operator 
26558: new and operator delete, and the C standard library functions calloc, malloc, realloc, and free shall 
26559: not introduce data races (1.10) as a result of concurrent calls from different threads. Calls to these functions 
26560: that allocate or deallocate a particular unit of storage shall occur in a single total order, and each such 
26561: deallocation call shall happen before the next allocation (if any) in this order. 
26562: 18.5.2 Storage allocation errors [alloc.errors] 
26563: 18.5.2.1 Class bad_alloc [bad.alloc] 
26564: namespace std {
26565: class bad_alloc : public exception {
26566: public:
26567: ∫ 18.5.2.1 487 
26568: 
26569: c
26570: . ISO/IEC N2800=08-0310 
26571: bad_alloc() throw();
26572: bad_alloc(const bad_alloc&) throw();
26573: bad_alloc& operator=(const bad_alloc&) throw();
26574: virtual const char* what() const throw();
26575: };
26576: }
26577: 1 The class bad_alloc defines the type of objects thrown as exceptions by the implementation to report a 
26578: failure to allocate storage. 
26579: bad_alloc() throw(); 
26580: 2 Effects: Constructs an object of class bad_alloc.
26581: 3 Remarks: The result of calling what() on the newly constructed object is implementation-defined.
26582: bad_alloc(const bad_alloc&) throw();
26583: bad_alloc& operator=(const bad_alloc&) throw();
26584: 4 Effects: Copies an object of class bad_alloc. 
26585: virtual const char* what() const throw(); 
26586: 5 Returns: An implementation-defined ntbs. 
26587: 18.5.2.2 Type new_handler [new.handler] 
26588: typedef void (*new_handler)(); 
26589: 1 The type of a handler function to be called by operator new() or operator new[]() (18.5.1) when 
26590: they cannot satisfy a request for additional storage. 
26591: 2 Required behavior: A new_handler shall perform one of the following: 
26592: 〞 make more storage available for allocation and then return; 
26593: 〞 throw an exception of type bad_alloc or a class derived from bad_alloc; 
26594: 〞 call either abort() or exit(); 
26595: 18.5.2.3 set_new_handler [set.new.handler] 
26596: new_handler set_new_handler(new_handler new_p) throw(); 
26597: 1 Effects: Establishes the function designated by new_p as the current new_handler. 
26598: 2 Returns: 0 on the first call, the previous new_handler on subsequent calls. 
26599: 18.6 Type identification [support.rtti] 
26600: 1 The header <typeinfo> defines a type associated with type information generated by the implementation. 
26601: It also defines two types for reporting dynamic type identification errors. 
26602: Header <typeinfo> synopsis 
26603: namespace std {
26604: class type_info;
26605: class type_index;
26606: template <class T> struct hash;
26607: ∫ 18.6 488 
26608: 
26609: c
26610: . ISO/IEC N2800=08-0310 
26611: template<>
26612: struct hash<type_index> : public std::unary_function<type_index, size_t> {
26613: size_t operator()(type_index index) const;
26614: }
26615: class bad_cast;
26616: class bad_typeid;
26617: } 
26618: See also: 5.2.7, 5.2.8. 
26619: 18.6.1 Class type_info [type.info] 
26620: namespace std {
26621: class type_info {
26622: public:
26623: virtual ~type_info();
26624: bool operator==(const type_info& rhs) const;
26625: bool operator!=(const type_info& rhs) const;
26626: bool before(const type_info& rhs) const;
26627: size_t hash_code() const throw();
26628: const char* name() const;
26629: type_info(const type_info& rhs) = delete; // cannot be copied
26630: type_info& operator=(const type_info& rhs) = delete; // cannot be copied
26631: };
26632: }
26633: 1 The class type_info describes type information generated by the implementation. Objects of this class 
26634: effectively store a pointer to a name for the type, and an encoded value suitable for comparing two types for 
26635: equality or collating order. The names, encoding rule, and collating sequence for types are all unspecified 
26636: and may differ between programs. 
26637: bool operator==(const type_info& rhs) const; 
26638: 2 Effects: Compares the current object with rhs. 
26639: 3 Returns: true if the two values describe the same type. 
26640: bool operator!=(const type_info& rhs) const; 
26641: 4 Returns: !(*this == rhs). 
26642: bool before(const type_info& rhs) const; 
26643: 5 Effects: Compares the current object with rhs.
26644: 6 Returns: true if *this precedes rhs in the implementation＊s collation order.
26645: size_t hash_code() const throw(); 
26646: 7 Returns: an unspecified value, except that within a single execution of the program, it shall return the 
26647: same value for any two type_info objects which compare equal. 
26648: 8 Remark: an implementation should return different values for two type_info objects which do not 
26649: compare equal. 
26650: const char* name() const; 
26651: ∫ 18.6.1 489 
26652: 
26653: c
26654: . ISO/IEC N2800=08-0310 
26655: 9 Returns: an implementation-defined ntbs. 
26656: 10 Remarks: The message may be a null-terminated multibyte string (17.5.3.2.4.3), suitable for conversion 
26657: and display as a wstring (21.2, 22.2.1.4) 
26658: 18.6.2 Class type_index [type.index] 
26659: 18.6.2.1 type_index overview [type.index.overview] 
26660: namespace std {
26661: class type_index {
26662: public:
26663: type_index(const type_info& rhs);
26664: bool operator==(const type_index& rhs) const;
26665: bool operator!=(const type_index& rhs) const;
26666: bool operator< (const type_index& rhs) const;
26667: bool operator<= (const type_index& rhs) const;
26668: bool operator> (const type_index& rhs) const;
26669: bool operator>= (const type_index& rhs) const;
26670: size_t hash_code() const;
26671: const char* name() const;
26672: private:
26673: const type_info* target; // exposition only
26674: // Note that the use of a pointer here, rather than a reference,
26675: // means that the default copy constructor and assignment
26676: // operator will be provided and work as expected.
26677: };
26678: }
26679: 1 The class type_index provides a simple wrapper for type_info which can be used as an index type in 
26680: associative containers (23.3) and in unordered associative containers (23.4). 
26681: 18.6.2.2 type_index members [type.index.members] 
26682: type_index(const type_info& rhs); 
26683: 1 Effects: constructs a type_index object, the equivalent of target = &rhs. 
26684: bool operator==(const type_index& rhs) const; 
26685: 2 Returns: *target == *rhs.target 
26686: bool operator!=(const type_index& rhs) const; 
26687: 3 Returns: *target != *rhs.target 
26688: bool operator<(const type_index& rhs) const; 
26689: 4 Returns: target->before(*rhs.target) 
26690: bool operator<=(const type_index& rhs) const; 
26691: 5 Returns: !rhs.target->before(*target) 
26692: bool operator>(const type_index& rhs) const; 
26693: 6 Returns: rhs.target->before(*target) 
26694: bool operator>=(const type_index& rhs) const; 
26695: ∫ 18.6.2.2 490 
26696: 
26697: c
26698: . ISO/IEC N2800=08-0310 
26699: 7 Returns: !target->before(*rhs.target) 
26700: size_t hash_code() const; 
26701: 8 Returns: target->hash_code() 
26702: const char* name() const; 
26703: 9 Returns: target->name() 
26704: 18.6.2.3 Template specialization hash<type_index> [type.index.templ] 
26705: size_t operator()(type_index index) const; 
26706: 1 Returns: index.hash_code() 
26707: 18.6.3 Class bad_cast [bad.cast] 
26708: namespace std {
26709: class bad_cast : public exception {
26710: public:
26711: bad_cast() throw();
26712: bad_cast(const bad_cast&) throw();
26713: bad_cast& operator=(const bad_cast&) throw();
26714: virtual const char* what() const throw();
26715: };
26716: }
26717: 1 The class bad_cast defines the type of objects thrown as exceptions by the implementation to report the 
26718: execution of an invalid dynamic-cast expression (5.2.7). 
26719: bad_cast() throw(); 
26720: 2 Effects: Constructs an object of class bad_cast.
26721: 3 Remarks: The result of calling what() on the newly constructed object is implementation-defined.
26722: bad_cast(const bad_cast&) throw();
26723: bad_cast& operator=(const bad_cast&) throw();
26724: 4 Effects: Copies an object of class bad_cast. 
26725: virtual const char* what() const throw(); 
26726: 5 Returns: An implementation-defined ntbs. 
26727: 6 Remarks: The message may be a null-terminated multibyte string (17.5.3.2.4.3), suitable for conversion 
26728: and display as a wstring (21.2, 22.2.1.4) 
26729: 18.6.4 Class bad_typeid [bad.typeid] 
26730: namespace std {
26731: class bad_typeid : public exception {
26732: public:
26733: bad_typeid() throw();
26734: bad_typeid(const bad_typeid&) throw();
26735: bad_typeid& operator=(const bad_typeid&) throw();
26736: virtual const char* what() const throw();
26737: ∫ 18.6.4 491 
26738: 
26739: c
26740: . ISO/IEC N2800=08-0310 
26741: };
26742: }
26743: 1 The class bad_typeid defines the type of objects thrown as exceptions by the implementation to report a 
26744: null pointer in a typeid expression (5.2.8). 
26745: bad_typeid() throw(); 
26746: 2 Effects: Constructs an object of class bad_typeid.
26747: 3 Remarks: The result of calling what() on the newly constructed object is implementation-defined.
26748: bad_typeid(const bad_typeid&) throw();
26749: bad_typeid& operator=(const bad_typeid&) throw();
26750: 4 Effects: Copies an object of class bad_typeid. 
26751: virtual const char* what() const throw(); 
26752: 5 Returns: An implementation-defined ntbs. 
26753: 6 Remarks: The message may be a null-terminated multibyte string (17.5.3.2.4.3), suitable for conversion 
26754: and display as a wstring (21.2, 22.2.1.4) 
26755: 18.7 Exception handling [support.exception] 
26756: 1 The header <exception> defines several types and functions related to the handling of exceptions in a C++ 
26757: program. 
26758: Header <exception> synopsis 
26759: namespace std {
26760: class exception;
26761: class bad_exception;
26762: class nested_exception;
26763: typedef void (*unexpected_handler)();
26764: unexpected_handler set_unexpected(unexpected_handler f) throw();
26765: void unexpected();
26766: typedef void (*terminate_handler)();
26767: terminate_handler set_terminate(terminate_handler f) throw();
26768: void terminate();
26769: bool uncaught_exception() throw(); 
26770: typedef unspecified exception_ptr; 
26771: exception_ptr current_exception();
26772: void rethrow_exception(exception_ptr p);
26773: template<class E> exception_ptr copy_exception(E e);
26774: template <class T> void throw_with_nested(T&& t); // [[noreturn]]
26775: template <class E> void rethrow_if_nested(const E& e);
26776: }
26777: ∫ 18.7 492 
26778: 
26779: c
26780: . ISO/IEC N2800=08-0310 
26781: See also: 15.5. 
26782: 18.7.1 Class exception [exception] 
26783: namespace std {
26784: class exception {
26785: public:
26786: exception() throw();
26787: exception(const exception&) throw();
26788: exception& operator=(const exception&) throw();
26789: virtual ~exception() throw();
26790: virtual const char* what() const throw();
26791: };
26792: }
26793: 1 The class exception defines the base class for the types of objects thrown as exceptions by C++ standard 
26794: library components, and certain expressions, to report errors detected during program execution. 
26795: exception() throw(); 
26796: 2 Effects: Constructs an object of class exception. 
26797: 3 Remarks: Does not throw any exceptions. 
26798: exception(const exception&) throw();
26799: exception& operator=(const exception&) throw();
26800: 4 Effects: Copies an exception object.
26801: 5 Remarks: The effects of calling what() after assignment are implementation-defined.
26802: virtual ~exception() throw(); 
26803: 6 Effects: Destroys an object of class exception. 
26804: 7 Remarks: Does not throw any exceptions. 
26805: virtual const char* what() const throw(); 
26806: 8 Returns: An implementation-defined ntbs. 
26807: 9 Remarks: The message may be a null-terminated multibyte string (17.5.3.2.4.3), suitable for conversion 
26808: and display as a wstring (21.2, 22.2.1.4). The return value remains valid until the exception object 
26809: from which it is obtained is destroyed or a non-const member function of the exception object is called. 
26810: 18.7.2 Violating exception-specifications [exception.unexpected] 
26811: 18.7.2.1 Class bad_exception [bad.exception] 
26812: namespace std {
26813: class bad_exception : public exception {
26814: public:
26815: bad_exception() throw();
26816: bad_exception(const bad_exception&) throw();
26817: bad_exception& operator=(const bad_exception&) throw();
26818: virtual const char* what() const throw();
26819: };
26820: }
26821: ∫ 18.7.2.1 493 
26822: 
26823: c
26824: . ISO/IEC N2800=08-0310 
26825: 1 The class bad_exception defines the type of objects thrown as described in (15.5.2). 
26826: bad_exception() throw(); 
26827: 2 Effects: Constructs an object of class bad_exception.
26828: 3 Remarks: The result of calling what() on the newly constructed object is implementation-defined.
26829: bad_exception(const bad_exception&) throw();
26830: bad_exception& operator=(const bad_exception&) throw();
26831: 4 Effects: Copies an object of class bad_exception. 
26832: virtual const char* what() const throw(); 
26833: 5 Returns: An implementation-defined ntbs. 
26834: 6 Remarks: The message may be a null-terminated multibyte string (17.5.3.2.4.3), suitable for conversion 
26835: and display as a wstring (21.2, 22.2.1.4). 
26836: 18.7.2.2 Type unexpected_handler [unexpected.handler] 
26837: typedef void (*unexpected_handler)(); 
26838: 1 The type of a handler function to be called by unexpected() when a function attempts to throw an 
26839: exception not listed in its exception-specification. 
26840: 2 Required behavior: An unexpected_handler shall not return. See also 15.5.2. 
26841: 3 Default behavior: The implementation＊s default unexpected_handler calls terminate(). 
26842: 18.7.2.3 set_unexpected [set.unexpected] 
26843: unexpected_handler set_unexpected(unexpected_handler f) throw(); 
26844: 1 Effects: Establishes the function designated by f as the current unexpected_handler.
26845: 2 Requires: f shall not be a null pointer.
26846: 3 Returns: The previous unexpected_handler.
26847: 18.7.2.4 unexpected [unexpected] 
26848: void unexpected(); 
26849: 1 Called by the implementation when a function exits via an exception not allowed by its exception-
26850: specification (15.5.2). May also be called directly by the program. 
26851: 2 Effects: Calls the unexpected_handler function in effect immediately after evaluating the throw-
26852: expression (18.7.2.2), if called by the implementation, or calls the current unexpected_handler, if 
26853: called by the program. 
26854: 18.7.3 Abnormal termination [exception.terminate] 
26855: 18.7.3.1 Type terminate_handler [terminate.handler] 
26856: typedef void (*terminate_handler)(); 
26857: ∫ 18.7.3.1 494 
26858: 
26859: c
26860: . ISO/IEC N2800=08-0310 
26861: 1 The type of a handler function to be called by terminate() when terminating exception processing. 
26862: 2 Required behavior: A terminate_handler shall terminate execution of the program without returning 
26863: to the caller. 
26864: 3 Default behavior: The implementation＊s default terminate_handler calls abort(). 
26865: 18.7.3.2 set_terminate [set.terminate] 
26866: terminate_handler set_terminate(terminate_handler f) throw(); 
26867: 1 Effects: Establishes the function designated by f as the current handler function for terminating 
26868: exception processing. 
26869: 2 Requires: f shall not be a null pointer. 
26870: 3 Returns: The previous terminate_handler. 
26871: 18.7.3.3 terminate [terminate] 
26872: void terminate(); 
26873: 1 Called by the implementation when exception handling must be abandoned for any of several rea-
26874: sons (15.5.1). May also be called directly by the program. 
26875: 2 Effects: Calls the terminate_handler function in effect immediately after evaluating the throw-
26876: expression (18.7.3.1), if called by the implementation, or calls the current terminate_handler function, 
26877: if called by the program. 
26878: 18.7.4 uncaught_exception [uncaught] 
26879: bool uncaught_exception() throw(); 
26880: 1 Returns: true after completing evaluation of a throw-expression until either completing initialization 
26881: of the exception-declaration in the matching handler or entering unexpected() due to the throw; or 
26882: after entering terminate() for any reason other than an explicit call to terminate(). [ Note: This 
26883: includes stack unwinding (15.2). 〞end note ] 
26884: 2 Remarks: When uncaught_exception() returns true, throwing an exception can result in a call of 
26885: terminate() (15.5.1). 
26886: 18.7.5 Exception Propagation [propagation] 
26887: typedef unspecified exception_ptr; 
26888: 1 The type exception_ptr can be used to refer to an exception object. 
26889: 2 exception_ptr shall be DefaultConstructible, CopyConstructible, Assignable and EqualityCompara-
26890: ble. exception_ptr＊s operations shall not throw exceptions. 
26891: 3 Two objects of type exception_ptr are equivalent and compare equal if and only if they refer to the 
26892: same exception. 
26893: 4 The default constructor of exception_ptr produces the null value of the type. The null value is 
26894: equivalent only to itself. 
26895: ∫ 18.7.5 495 
26896: 
26897: c
26898: . ISO/IEC N2800=08-0310 
26899: 5 An object of type exception_ptr can be compared for equality with a null pointer constant and 
26900: assigned a null pointer constant. The effect shall be as if exception_ptr() had been used in place of 
26901: the null pointer constant. 
26902: 6 [ Note: An implementation might use a reference-counted smart pointer as exception_ptr. 〞end 
26903: note ] 
26904: exception_ptr current_exception(); 
26905: 7 Returns: An exception_ptr object that refers to the currently handled exception (15.3) or a copy of 
26906: the currently handled exception, or a null exception_ptr object if no exception is being handled. The 
26907: referenced object shall remain valid at least as long as there is an exception_ptr object that refers to 
26908: it. If the function needs to allocate memory and the attempt fails, it returns an exception_ptr object 
26909: that refers to an instance of bad_alloc. It is unspecified whether the return values of two successive 
26910: calls to current_exception refer to the same exception object. [ Note: that is,it is unspecified whether 
26911: current_exception creates a new copy each time it is called. 〞end note ] If the attempt to copy 
26912: the current exception object throws an exception, the function returns an exception_ptr object that 
26913: refers to the thrown exception or, if this is not possible, to an instance of bad_exception.[ Note: The 
26914: copy constructor of the thrown exception may also fail, so the implementation is allowed to substitute 
26915: a bad_exception object to avoid infinite recursion. 〞end note ] 
26916: 8 Throws: nothing. 
26917: void rethrow_exception(exception_ptr p); 
26918: 9 Requires: p shall not be a null pointer. 
26919: 10 Throws: the exception object to which p refers. 
26920: template<class E> exception_ptr copy_exception(E e); 
26921: 11 Effects: as if 
26922: try {
26923: throw e;
26924: } catch(...) {
26925: return current_exception();
26926: }
26927: 12 [ Note: this function is provided for convenience and efficiency reasons. 〞end note ] 
26928: 18.7.6 nested_exception [except.nested] 
26929: namespace std {
26930: class nested_exception {
26931: public:
26932: nested_exception() throw();
26933: nested_exception(const nested_exception&) throw() = default;
26934: nested_exception& operator=(const nested_exception&) throw() = default;
26935: virtual ~nested_exception() = default;
26936: // access functions
26937: void rethrow_nested() const; // [[noreturn]]
26938: exception_ptr nested_ptr() const;
26939: }; 
26940: template<class T> void throw_with_nested(T&& t); // [[noreturn]] 
26941: ∫ 18.7.6 496 
26942: 
26943: c
26944: . ISO/IEC N2800=08-0310 
26945: template <class E> void rethrow_if_nested(const E& e);
26946: }
26947: 1 The class nested_exception is designed for use as a mixin through multiple inheritance. It captures the 
26948: currently handled exception and stores it for later use. 
26949: 2 [ Note: nested_exception has a virtual destructor to make it a polymorphic class. Its presence can be 
26950: tested for with dynamic_cast. 〞end note ] 
26951: nested_exception() throw(); 
26952: 3 Effects: The constructor calls current_exception() and stores the returned value. 
26953: void rethrow_nested() const; // [[noreturn]] 
26954: 4 Throws: the stored exception captured by this nested_exception object. 
26955: exception_ptr nested_ptr() const; 
26956: 5 Returns: the stored exception captured by this nested_exception object. 
26957: template <class T> void throw_with_nested(T&& t); // [[noreturn]] 
26958: 6 Requires: T shall be CopyConstructible. 
26959: 7 Throws: If T is a non-union class type not derived from nested_exception, an exception of unspecified 
26960: type that is publicly derived from both T and nested_exception, otherwise t. 
26961: template <class E> void rethrow_if_nested(const E& e); 
26962: 8 Effects: Calls e.rethrow_nested() only if e is publicly derived from nested_exception. 
26963: 18.8 Initializer lists [support.initlist] 
26964: 1 The header <initializer_list> defines one type. 
26965: Header <initializer_list> synopsis 
26966: namespace std {
26967: template<ObjectType E> class initializer_list {
26968: public:
26969: typedef E value_type;
26970: typedef const E& reference;
26971: typedef const E& const_reference;
26972: typedef size_t size_type;
26973: typedef const E* iterator;
26974: typedef const E* const_iterator;
26975: initializer_list(); 
26976: size_t size() const; // number of elements
26977: const E* begin() const; // first element
26978: const E* end() const; // one past the last element
26979: }; 
26980: template<typename T>
26981: concept_map Range<initializer_list<T> > see below ;
26982: ∫ 18.8 497 
26983: 
26984: c
26985: . ISO/IEC N2800=08-0310 
26986: template<typename T>
26987: concept_map Range<const initializer_list<T> > see below ;
26988: }
26989: 2 An object of type initializer_list<E> provides access to an array of objects of type const E.[ Note: 
26990: A pair of pointers or a pointer plus a length would be obvious representations for initializer_list. 
26991: initializer_list is used to implement initializer lists as specified in 8.5.4. Copying an initializer list does 
26992: not copy the underlying elements. 〞end note ] 
26993: 18.8.1 Initializer list constructors [support.initlist.cons] 
26994: initializer_list(); 
26995: 1 Effects: constructs an empty initializer_list object. 
26996: 2 Postcondition: size() == 0 
26997: 3 Throws: nothing. 
26998: 18.8.2 Initializer list access 
26999: const E* begin() const; 
27000: 1 Returns: a pointer to the beginning of the array. If size() 
27001: are unspecified but they shall be identical. 
27002: 2 Throws: nothing. 
27003: const E* end() const; 
27004: 3 Returns: begin() + size() 
27005: 4 Throws: nothing. 
27006: size_t size() const; 
27007: 5 Returns: the number of elements in the array. 
27008: 6 Throws: nothing. 
27009: 18.8.3 Initializer list concept maps 
27010: template<typename T>
27011: concept_map Range<initializer_list<T> > {
27012: typedef const T* iterator;
27013: iterator begin(initializer_list<T> r) { return r.begin(); } 
27014: iterator end(initializer_list<T> r) { return r.end(); } 
27015: } 
27016: template<typename T>
27017: concept_map Range<const initializer_list<T> > {
27018: typedef const T* iterator;
27019: iterator begin(initializer_list<T> r) { return r.begin(); } 
27020: iterator end(initializer_list<T> r) { return r.end(); } 
27021: } 
27022: ∫ 18.8.3 
27023: [support.initlist.access] 
27024: == 0 the values of begin() and end() 
27025: [support.initlist.concept] 
27026: 
27027: c
27028: . ISO/IEC N2800=08-0310 
27029: 1 Note: these concept maps adapt initializer lists to the Range concept. 
27030: 18.9 Other runtime support [support.runtime] 
27031: 1 Headers <cstdarg> (variable arguments), <csetjmp> (nonlocal jumps), <ctime> (system clock clock(), 
27032: time()), <csignal> (signal handling), <cstdlib> (runtime environment getenv(), system()), and <cstd-
27033: bool> (_ _ bool_true_false_are_defined). 
27034: Table 21 〞 Header <cstdarg> synopsis 
27035: Type Name(s) 
27036: Macros: 
27037: va_copy 
27038: va_arg va_end va_start 
27039: Type: va_list 
27040: Table 22 〞 Header <csetjmp> synopsis 
27041: Type Name(s) 
27042: Macro: setjmp 
27043: Type: jmp_buf 
27044: Function: longjmp 
27045: Table 23 〞 Header <ctime> synopsis 
27046: Type Name(s) 
27047: Macro: CLOCKS_PER_SEC 
27048: Type: clock_t 
27049: Function: clock 
27050: Table 24 〞 Header <csignal> synopsis 
27051: Type Name(s) 
27052: Macros: SIGABRT SIGILL SIGSEGV SIG_DFL 
27053: SIG_IGN SIGFPE SIGINT SIGTERM SIG_ERR 
27054: Type: sig_atomic_t 
27055: Functions: raise signal 
27056: 2 The contents of these headers are the same as the Standard C library headers <stdarg.h>, <setjmp.h>, 
27057: <time.h>, <signal.h>, and <stdlib.h> respectively, with the following changes: 
27058: 3 The restrictions that ISO C places on the second parameter to the va_start() macro in header <stdarg.h> 
27059: are different in this International Standard. The parameter parmN is the identifier of the rightmost parameter 
27060: in the variable parameter list of the function definition (the one just before the ...).224 If the parameter 
27061: parmN is declared with a function, array, or reference type, or with a type that is not compatible with the 
27062: type that results when passing an argument for which there is no parameter, the behavior is undefined. 
27063: See also: ISO C 4.8.1.1. 
27064: 224) Note that va_start is required to work as specified even if unary operator& is overloaded for the type of parmN. 
27065: ∫ 18.9 499 
27066: 
27067: . ISO/IEC N2800=08-0310 
27068: Table 25 〞 Header <cstdlib> synopsis 
27069: Type Name(s) 
27070: Functions: getenv system 
27071: Table 26 〞 Header <cstdbool> synopsis 
27072: Type Name(s)
27073: Macro: __bool_true_false_are_defined
27074: 4 The function signature longjmp(jmp_buf jbuf, int val) has more restricted behavior in this International 
27075: Standard. A setjmp/longjmp call pair has undefined behavior if replacing the setjmp and longjmp by catch 
27076: and throw would destroy any automatic objects. 
27077: See also: ISO C 7.10.4, 7.8, 7.6, 7.12. 
27078: 5 The header <cstdbool> and the header <stdbool.h> shall not define macros named bool, true, and false. 
27079: 6 The common subset of the C and C++ languages consists of all declarations, definitions, and expressions 
27080: that may appear in a well formed C++ program and also in a conforming C program. A POF (※plain 
27081: old function§) is a function that uses only features from this common subset, and that does not directly 
27082: or indirectly use any function that is not a POF, except that it may use functions defined in Clause 29 
27083: that are not member functions. All signal handlers shall have C linkage. A POF that could be used as 
27084: a signal handler in a conforming C program does not produce undefined behavior when used as a signal 
27085: handler in a C++ program. The behavior of any other function used as a signal handler in a C++ program 
27086: is implementation-defined.225 
27087: 225) In particular, a signal handler using exception handling is very likely to have problems. Also, invoking std::exit may cause 
27088: destruction of objects, including those of the standard library implementation, which, in general, yields undefined behavior in 
27089: a signal handler (see 1.9). 
27090: ∫ 18.9 500 
27091: 
27092: c
27093: . ISO/IEC N2800=08-0310 
27094: 19 Diagnostics library [diagnostics]
27095: 1 This Clause describes components that C++ programs may use to detect and report error conditions. 
27096: 2 The following subclauses describe components for reporting several kinds of exceptional conditions, docu-
27097: menting program assertions, and a global variable for error number codes, as summarized in Table 27. 
27098: Table 27 〞 Diagnostics library summary 
27099: Subclause Header(s) 
27100: 19.1 Exception classes <stdexcept> 
27101: 19.2 Assertions <cassert> 
27102: 19.3 Error numbers <cerrno> 
27103: 19.4 System error support <system_error> 
27104: 19.1 Exception classes [std.exceptions] 
27105: 1 The Standard C++ library provides classes to be used to report certain errors (17.6.5.10) in C++ programs. 
27106: In the error model reflected in these classes, errors are divided into two broad categories: logic errors and 
27107: runtime errors. 
27108: 2 The distinguishing characteristic of logic errors is that they are due to errors in the internal logic of the 
27109: program. In theory, they are preventable. 
27110: 3 By contrast, runtime errors are due to events beyond the scope of the program. They cannot be easily 
27111: predicted in advance. The header <stdexcept> defines several types of predefined exceptions for reporting 
27112: errors in a C++ program. These exceptions are related by inheritance. 
27113: Header <stdexcept> synopsis 
27114: namespace std { 
27115: class logic_error;
27116: class domain_error;
27117: class invalid_argument;
27118: class length_error;
27119: class out_of_range;
27120: class runtime_error;
27121: class range_error;
27122: class overflow_error;
27123: class underflow_error;
27124: } 
27125: 19.1.1 Class logic_error [logic.error] 
27126: namespace std {
27127: class logic_error : public exception {
27128: public:
27129: explicit logic_error(const string& what_arg);
27130: explicit logic_error(const char* what_arg);
27131: };
27132: }
27133: ∫ 19.1.1 501 
27134: 
27135: c
27136: . ISO/IEC N2800=08-0310 
27137: 1 The class logic_error defines the type of objects thrown as exceptions to report errors presumably de-
27138: tectable before the program executes, such as violations of logical preconditions or class invariants. 
27139: logic_error(const string& what_arg); 
27140: 2 Effects: Constructs an object of class logic_error. 
27141: 3 Postcondition: strcmp(what(), what_arg.c_str()) == 0. 
27142: logic_error(const char* what_arg); 
27143: 4 Effects: Constructs an object of class logic_error. 
27144: 5 Postcondition: strcmp(what(), what_arg) == 0. 
27145: 19.1.2 Class domain_error [domain.error] 
27146: namespace std {
27147: class domain_error : public logic_error {
27148: public:
27149: explicit domain_error(const string& what_arg);
27150: explicit domain_error(const char* what_arg);
27151: };
27152: }
27153: 1 The class domain_error defines the type of objects thrown as exceptions by the implementation to report 
27154: domain errors. 
27155: domain_error(const string& what_arg); 
27156: 2 Effects: Constructs an object of class domain_error. 
27157: 3 Postcondition: strcmp(what(), what_arg.c_str()) 
27158: domain_error(const char* what_arg); 
27159: 4 Effects: Constructs an object of class domain_error. 
27160: 5 Postcondition: strcmp(what(), what_arg) == 0. 
27161: 19.1.3 Class invalid_argument 
27162: namespace std { 
27163: class invalid_argument : public logic_error { 
27164: public: 
27165: explicit invalid_argument(const string& what_arg); 
27166: == 0. 
27167: [invalid.argument] 
27168: explicit invalid_argument(const char* what_arg); 
27169: }; 
27170: } 
27171: 1 The class invalid_argument defines the type of objects thrown as exceptions to report an invalid argument. 
27172: invalid_argument(const string& what_arg); 
27173: 2 Effects: Constructs an object of class invalid_argument. 
27174: 3 Postcondition: strcmp(what(), what_arg.c_str()) == 0. 
27175: invalid_argument(const char* what_arg); 
27176: ∫ 19.1.3 502 
27177: 
27178: c
27179: . ISO/IEC N2800=08-0310 
27180: 4 Effects: Constructs an object of class invalid_argument. 
27181: 5 Postcondition: strcmp(what(), what_arg) == 0. 
27182: 19.1.4 Class length_error [length.error] 
27183: namespace std {
27184: class length_error : public logic_error {
27185: public:
27186: explicit length_error(const string& what_arg);
27187: explicit length_error(const char* what_arg);
27188: };
27189: }
27190: 1 The class length_error defines the type of objects thrown as exceptions to report an attempt to produce 
27191: an object whose length exceeds its maximum allowable size. 
27192: length_error(const string& what_arg); 
27193: 2 Effects: Constructs an object of class length_error. 
27194: 3 Postcondition: strcmp(what(), what_arg.c_str()) == 0. 
27195: length_error(const char* what_arg); 
27196: 4 Effects: Constructs an object of class length_error. 
27197: 5 Postcondition: strcmp(what(), what_arg) == 0. 
27198: 19.1.5 Class out_of_range [out.of.range] 
27199: namespace std {
27200: class out_of_range : public logic_error {
27201: public:
27202: explicit out_of_range(const string& what_arg);
27203: explicit out_of_range(const char* what_arg);
27204: };
27205: }
27206: 1 The class out_of_range defines the type of objects thrown as exceptions to report an argument value not 
27207: in its expected range. 
27208: out_of_range(const string& what_arg); 
27209: 2 Effects: Constructs an object of class out_of_range. 
27210: 3 Postcondition: strcmp(what(), what_arg.c_str()) == 0. 
27211: out_of_range(const char* what_arg); 
27212: 4 Effects: Constructs an object of class out_of_range. 
27213: 5 Postcondition: strcmp(what(), what_arg) == 0. 
27214: ∫ 19.1.5 503 
27215: 
27216: c
27217: . ISO/IEC N2800=08-0310 
27218: 19.1.6 Class runtime_error [runtime.error] 
27219: namespace std {
27220: class runtime_error : public exception {
27221: public:
27222: explicit runtime_error(const string& what_arg);
27223: explicit runtime_error(const char* what_arg);
27224: };
27225: }
27226: 1 The class runtime_error defines the type of objects thrown as exceptions to report errors presumably 
27227: detectable only when the program executes. 
27228: runtime_error(const string& what_arg); 
27229: 2 Effects: Constructs an object of class runtime_error. 
27230: 3 Postcondition: strcmp(what(), what_arg.c_str()) == 0. 
27231: runtime_error(const char* what_arg); 
27232: 4 Effects: Constructs an object of class runtime_error. 
27233: 5 Postcondition: strcmp(what(), what_arg) == 0. 
27234: 19.1.7 Class range_error [range.error] 
27235: namespace std {
27236: class range_error : public runtime_error {
27237: public:
27238: explicit range_error(const string& what_arg);
27239: explicit range_error(const char* what_arg);
27240: };
27241: }
27242: 1 The class range_error defines the type of objects thrown as exceptions to report range errors in internal 
27243: computations. 
27244: range_error(const string& what_arg); 
27245: 2 Effects: Constructs an object of class range_error. 
27246: 3 Postcondition: strcmp(what(), what_arg.c_str()) == 0. 
27247: range_error(const char* what_arg); 
27248: 4 Effects: Constructs an object of class range_error. 
27249: 5 Postcondition: strcmp(what(), what_arg) == 0. 
27250: 19.1.8 Class overflow_error [overflow.error] 
27251: namespace std {
27252: class overflow_error : public runtime_error {
27253: public:
27254: explicit overflow_error(const string& what_arg);
27255: explicit overflow_error(const char* what_arg);
27256: };
27257: ∫ 19.1.8 504 
27258: 
27259: c
27260: . ISO/IEC N2800=08-0310 
27261: } 
27262: 1 The class overflow_error defines the type of objects thrown as exceptions to report an arithmetic overflow 
27263: error. 
27264: overflow_error(const string& what_arg); 
27265: 2 Effects: Constructs an object of class overflow_error. 
27266: 3 Postcondition: strcmp(what(), what_arg.c_str()) == 0. 
27267: overflow_error(const char* what_arg); 
27268: 4 Effects: Constructs an object of class overflow_error. 
27269: 5 Postcondition: strcmp(what(), what_arg) == 0. 
27270: 19.1.9 Class underflow_error [underflow.error] 
27271: namespace std {
27272: class underflow_error : public runtime_error {
27273: public:
27274: explicit underflow_error(const string& what_arg);
27275: explicit underflow_error(const char* what_arg);
27276: };
27277: }
27278: 1 The class underflow_error defines the type of objects thrown as exceptions to report an arithmetic under-
27279: flow error. 
27280: underflow_error(const string& what_arg); 
27281: 2 Effects: Constructs an object of class underflow_error. 
27282: 3 Postcondition: strcmp(what(), what_arg.c_str()) == 0. 
27283: underflow_error(const char* what_arg); 
27284: 4 Effects: Constructs an object of class underflow_error. 
27285: 5 Postcondition: strcmp(what(), what_arg) == 0. 
27286: 19.2 Assertions [assertions] 
27287: 1 The header <cassert>, described in (Table 28), provides a macro for documenting C++ program assertions 
27288: and a mechanism for disabling the assertion checks. 
27289: Table 28 〞 Header <cassert> synopsis 
27290: Type Name(s) 
27291: Macro: assert 
27292: 2 The contents are the same as the Standard C library header <assert.h>. 
27293: See also: ISO C 7.2. 
27294: ∫ 19.2 505 
27295: 
27296: c
27297: . ISO/IEC N2800=08-0310 
27298: 19.3 Error numbers [errno] 
27299: 1 
27300: The header <cerrno> is described in Table 29. Its contents are the same as the POSIX header <errno.h>, 
27301: except that errno shall be defined as a macro. [ Note: The intent is to remain in close alignment with the 
27302: POSIX standard. 〞end note ] A separate errno value shall be provided for each thread. 
27303: Table 29 〞 Header <cerrno> synopsis 
27304: Type Name(s) 
27305: Macros: ECONNREFUSED EIO ENODEV ENOTEMPTY ERANGE 
27306: E2BIG ECONNRESET EISCONN ENOENT ENOTRECOVERABLE EROFS 
27307: EACCES EDEADLK EISDIR ENOEXEC ENOTSOCK ESPIPE 
27308: EADDRINUSE EDESTADDRREQ ELOOP ENOLCK ENOTSUP ESRCH 
27309: EADDRNOTAVAIL EDOM EMFILE ENOLINK ENOTTY ETIME 
27310: EAFNOSUPPORT EEXIST EMLINK ENOMEM ENXIO ETIMEDOUT 
27311: EAGAIN EFAULT EMSGSIZE ENOMSG EOPNOTSUPP ETXTBSY 
27312: EALREADY EFBIG ENAMETOOLONG ENOPROTOOPT EOVERFLOW EWOULDBLOCK 
27313: EBADF EHOSTUNREACH ENETDOWN ENOSPC EOWNERDEAD EXDEV 
27314: EBADMSG EIDRM ENETRESET ENOSR EPERM errno 
27315: EBUSY EILSEQ ENETUNREACH ENOSTR EPIPE 
27316: ECANCELED EINPROGRESS ENFILE ENOSYS EPROTO 
27317: ECHILD EINTR ENOBUFS ENOTCONN EPROTONOSUPPORT 
27318: ECONNABORTED EINVAL ENODATA ENOTDIR EPROTOTYPE 
27319: See also: ISO C 7.1.4, 7.2, Amendment 1 4.3. 
27320: 19.4 System error support [syserr] 
27321: 1 This subclause describes components that the standard library and C++ programs may use to report error 
27322: conditions originating from the operating system or other low-level application program interfaces. 
27323: 2 Components described in this subclause shall not change the value of errno (19.3). Implementations are 
27324: encouraged but not required to leave unchanged the error states provided by other libraries. 
27325: Header <system_error> synopsis 
27326: namespace std {
27327: class error_category;
27328: class error_code;
27329: class error_condition;
27330: class system_error;
27331: concept ErrorCodeEnum<typename T> see below ;
27332: concept ErrorConditionEnum<typename T> see below ;
27333: enum class errc {
27334: address_family_not_supported, // EAFNOSUPPORT
27335: address_in_use, // EADDRINUSE
27336: address_not_available, // EADDRNOTAVAIL
27337: already_connected, // EISCONN
27338: argument_list_too_long, // E2BIG
27339: argument_out_of_domain, // EDOM
27340: ∫ 19.4 506 
27341: 
27342: c. ISO/IEC N2800=08-0310 
27343: bad_address, // EFAULT 
27344: bad_file_descriptor, // EBADF 
27345: bad_message, // EBADMSG 
27346: broken_pipe, // EPIPE 
27347: connection_aborted, // ECONNABORTED 
27348: connection_already_in_progress, // EALREADY 
27349: connection_refused, // ECONNREFUSED 
27350: connection_reset, // ECONNRESET 
27351: cross_device_link, // EXDEV 
27352: destination_address_required, // EDESTADDRREQ 
27353: device_or_resource_busy, // EBUSY 
27354: directory_not_empty, // ENOTEMPTY 
27355: executable_format_error, // ENOEXEC 
27356: file_exists, // EEXIST 
27357: file_too_large, // EFBIG 
27358: filename_too_long, // ENAMETOOLONG 
27359: function_not_supported, // ENOSYS 
27360: host_unreachable, // EHOSTUNREACH 
27361: identifier_removed, // EIDRM 
27362: illegal_byte_sequence, // EILSEQ 
27363: inappropriate_io_control_operation, // ENOTTY 
27364: interrupted, // EINTR 
27365: invalid_argument, // EINVAL 
27366: invalid_seek, // ESPIPE 
27367: io_error, // EIO 
27368: is_a_directory, // EISDIR 
27369: message_size, // EMSGSIZE 
27370: network_down, // ENETDOWN 
27371: network_reset, // ENETRESET 
27372: network_unreachable, // ENETUNREACH 
27373: no_buffer_space, // ENOBUFS 
27374: no_child_process, // ECHILD 
27375: no_link, // ENOLINK 
27376: no_lock_available, // ENOLCK 
27377: no_message_available, // ENODATA 
27378: no_message, // ENOMSG 
27379: no_protocol_option, // ENOPROTOOPT 
27380: no_space_on_device, // ENOSPC 
27381: no_stream_resources, // ENOSR 
27382: no_such_device_or_address, // ENXIO 
27383: no_such_device, // ENODEV 
27384: no_such_file_or_directory, // ENOENT 
27385: no_such_process, // ESRCH 
27386: not_a_directory, // ENOTDIR 
27387: not_a_socket, // ENOTSOCK 
27388: not_a_stream, // ENOSTR 
27389: not_connected, // ENOTCONN 
27390: not_enough_memory, // ENOMEM 
27391: not_supported, // ENOTSUP 
27392: operation_canceled, // ECANCELED 
27393: operation_in_progress, // EINPROGRESS 
27394: operation_not_permitted, // EPERM 
27395: operation_not_supported, // EOPNOTSUPP 
27396: operation_would_block, // EWOULDBLOCK 
27397: owner_dead, // EOWNERDEAD 
27398: ∫ 19.4 507 
27399: 
27400: c
27401: . ISO/IEC N2800=08-0310 
27402: permission_denied, // EACCES
27403: protocol_error, // EPROTO
27404: protocol_not_supported, // EPROTONOSUPPORT
27405: read_only_file_system, // EROFS
27406: resource_deadlock_would_occur, // EDEADLK
27407: resource_unavailable_try_again, // EAGAIN
27408: result_out_of_range, // ERANGE
27409: state_not_recoverable, // ENOTRECOVERABLE
27410: stream_timeout, // ETIME
27411: text_file_busy, // ETXTBSY
27412: timed_out, // ETIMEDOUT
27413: too_many_files_open_in_system, // ENFILE
27414: too_many_files_open, // EMFILE
27415: too_many_links, // EMLINK
27416: too_many_symbolic_link_levels, // ELOOP
27417: value_too_large, // EOVERFLOW
27418: wrong_protocol_type, // EPROTOTYPE
27419: }; 
27420: concept_map ErrorConditionEnum<errc> { }; 
27421: error_code make_error_code(errc e);
27422: error_condition make_error_condition(errc e);
27423: // 19.4.4 Comparison operators: 
27424: bool operator==(const error_code& lhs, const error_code& rhs);
27425: bool operator==(const error_code& lhs, const error_condition& rhs);
27426: bool operator==(const error_condition& lhs, const error_code& rhs);
27427: bool operator==(const error_condition& lhs, const error_condition& rhs);
27428: bool operator!=(const error_code& lhs, const error_code& rhs);
27429: bool operator!=(const error_code& lhs, const error_condition& rhs);
27430: bool operator!=(const error_condition& lhs, const error_code& rhs);
27431: bool operator!=(const error_condition& lhs, const error_condition& rhs);
27432: } // namespace std 
27433: 3 The value of each enum errc constant shall be the same as the value of the <cerrno> macro shown in 
27434: the above synopsis. Whether or not the <system_error> implementation exposes the <cerrno> macros is 
27435: unspecified. 
27436: 19.4.1 Class error_category [syserr.errcat] 
27437: 19.4.1.1 Class error_category overview [syserr.errcat.overview] 
27438: 1 The class error_category serves as a base class for types used to identify the source and encoding of a 
27439: particular category of error code. Classes may be derived from error_category to support categories of 
27440: errors in addition to those defined in this International Standard. Such classes shall behave as specified in 
27441: this subclause. [ Note: error_category objects are passed by reference, and two such objects are equal 
27442: if they have the same address. This means that applications using custom error_category types should 
27443: create a single object of each such type. 〞end note ] 
27444: namespace std {
27445: class error_category {
27446: public:
27447: virtual ~error_category(); 
27448: error_category(const error_category&) = delete; 
27449: ∫ 19.4.1.1 508 
27450: 
27451: c
27452: . ISO/IEC N2800=08-0310 
27453: error_category& operator=(const error_category&) = delete;
27454: virtual const char* name() const = 0;
27455: virtual error_condition default_error_condition(int ev) const;
27456: virtual bool equivalent(int code, const error_condition& condition) const;
27457: virtual bool equivalent(const error_code& code, int condition) const;
27458: virtual string message(int ev) const = 0;
27459: bool operator==(const error_category& rhs) const;
27460: bool operator!=(const error_category& rhs) const;
27461: bool operator<(const error_category& rhs) const;
27462: }; 
27463: const error_category& get_generic_category();
27464: const error_category& get_system_category();
27465: static const error_category& generic_category = get_generic_category();
27466: static const error_category& system_category = get_system_category();
27467: } // namespace std
27468: 19.4.1.2 Class error_category virtual members [syserr.errcat.virtuals] 
27469: virtual const char* name() const = 0; 
27470: 1 Returns: A string naming the error category. 
27471: 2 Throws: Nothing. 
27472: virtual error_condition default_error_condition(int ev) const; 
27473: 3 Returns: error_condition(ev, *this). 
27474: 4 Throws: Nothing. 
27475: virtual bool equivalent(int code, const error_condition& condition) const; 
27476: 5 Returns: default_error_condition(code) == condition. 
27477: 6 Throws: Nothing. 
27478: virtual bool equivalent(const error_code& code, int condition) const; 
27479: 7 Returns: *this == code.category() && code.value() == condition. 
27480: 8 Throws: Nothing. 
27481: virtual string message(int ev) const = 0; 
27482: 9 Returns: A string that describes the error condition denoted by ev. 
27483: 19.4.1.3 Class error_category non-virtual members [syserr.errcat.nonvirtuals] 
27484: bool operator==(const error_category& rhs) const; 
27485: 1 Returns: this == &rhs. 
27486: bool operator!=(const error_category& rhs) const; 
27487: 2 Returns: !(*this == rhs). 
27488: bool operator<(const error_category& rhs) const; 
27489: ∫ 19.4.1.3 509 
27490: 
27491: c
27492: . ISO/IEC N2800=08-0310 
27493: 3 Returns: less<const error_category*>()(this, &rhs). 
27494: [ Note: less (20.6.8) provides a total ordering for pointers. 〞end note ] 
27495: 4 Throws: Nothing. 
27496: 19.4.1.4 Program defined classes derived from error_category [syserr.errcat.derived] 
27497: virtual const char *name() const = 0; 
27498: 1 Returns: a string naming the error category. 
27499: 2 Throws: Nothing. 
27500: virtual error_condition default_error_condition(int ev) const; 
27501: 3 Returns: An object of type error_condition that corresponds to ev. 
27502: 4 Throws: Nothing. 
27503: virtual bool equivalent(int code, const error_condition& condition) const; 
27504: 5 Returns: true if, for the category of error represented by *this, code is considered equivalent to 
27505: condition; otherwise, false. 
27506: 6 Throws: Nothing. 
27507: virtual bool equivalent(const error_code& code, int condition) const; 
27508: 7 Returns: true if, for the category of error represented by *this, code is considered equivalent to 
27509: condition; otherwise, false. 
27510: 8 Throws: Nothing. 
27511: 19.4.1.5 Error category objects [syserr.errcat.objects] 
27512: const error_category& get_generic_category(); 
27513: 1 Returns: A reference to an object of a type derived from class error_category. 
27514: 2 Remarks: The object＊s default_error_condition and equivalent virtual functions shall behave as 
27515: specified for the class error_category. The object＊s name virtual function shall return a pointer to 
27516: the string "generic". 
27517: const error_category& get_system_category(); 
27518: 3 Returns: A reference to an object of a type derived from class error_category. 
27519: 4 Remarks: The object＊s equivalent virtual functions shall behave as specified for class error_-
27520: category. The object＊s name virtual function shall return a pointer to the string "system". The 
27521: object＊s default_error_condition virtual function shall behave as follows: 
27522: If the argument ev corresponds to a POSIX errno value posv, the function shall return error_-
27523: condition(posv, generic_category). Otherwise, the function shall return error_condition(ev, 
27524: system_category). What constitutes correspondence for any given operating system is unspecified. 
27525: [ Note: The number of potential system error codes is large and unbounded, and some may not 
27526: correspond to any POSIX errno value. Thus implementations are given latitude in determining 
27527: correspondence. 〞end note ] 
27528: ∫ 19.4.1.5 510 
27529: 
27530: c
27531: . ISO/IEC N2800=08-0310 
27532: 19.4.2 Class error_code and concept ErrorCodeEnum [syserr.errcode] 
27533: 19.4.2.1 Concept ErrorCodeEnum [syserr.errcodeenum] 
27534: namespace std {
27535: concept ErrorCodeEnum<typename T> : EnumerationType<T> {
27536: error_code make_error_code(T val);
27537: }
27538: }
27539: 1 Requires: Function make_error_code shall return error_code(static_cast<int>(val), cat), where 
27540: cat is an error_category that describes type T. 
27541: 2 Remark: Describes types to be used as an argument to function make_error_code. 
27542: 19.4.2.2 Class error_code overview [syserr.errcode.overview] 
27543: 1 The class error_code describes an object used to hold error code values, such as those originating from the 
27544: operating system or other low-level application program interfaces. [ Note: Class error_code is an adjunct 
27545: to error reporting by exception. 〞end note ] 
27546: namespace std {
27547: class error_code {
27548: public:
27549: // 19.4.2.3 constructors: 
27550: error_code();
27551: error_code(int val, const error_category& cat);
27552: template <ErrorCodeEnum E>
27553: error_code(E e); 
27554: // 19.4.2.4 modifiers: 
27555: void assign(int val, const error_category& cat);
27556: template <ErrorCodeEnum E>
27557: error_code& operator=(E e);
27558: void clear();
27559: // 19.4.2.5 observers: 
27560: int value() const;
27561: const error_category& category() const;
27562: error_condition default_error_condition() const;
27563: string message() const;
27564: explicit operator bool() const;
27565: private:
27566: int val_; // exposition only
27567: const error_category* cat_; // exposition only
27568: }; 
27569: // 19.4.2.6 non-member functions: 
27570: bool operator<(const error_code& lhs, const error_code& rhs); 
27571: template <class charT, class traits>
27572: basic_ostream<charT,traits>&
27573: operator<<(basic_ostream<charT,traits>& os, const error_code& ec);
27574: } // namespace std
27575: ∫ 19.4.2.2 511 
27576: 
27577: c. ISO/IEC N2800=08-0310 
27578: 19.4.2.3 Class error_code constructors [syserr.errcode.constructors] 
27579: error_code(); 
27580: 1 Effects: Constructs an object of type error_code. 
27581: 2 Postconditions: val_ == 0 and cat_ == &system_category. 
27582: 3 Throws: Nothing. 
27583: error_code(int val, const error_category& cat); 
27584: 4 Effects: Constructs an object of type error_code. 
27585: 5 Postconditions: val_ == val and cat_ == &cat. 
27586: 6 Throws: Nothing. 
27587: template <ErrorCodeEnum E> 
27588: error_code(E e); 
27589: 7 Effects: Constructs an object of type error_code. 
27590: 8 Postconditions: *this == make_error_code(e). 
27591: 9 Throws: Nothing. 
27592: 19.4.2.4 Class error_code modifiers [syserr.errcode.modifiers] 
27593: void assign(int val, const error_category& cat); 
27594: 1 Postconditions: val_ == val and cat_ == &cat. 
27595: 2 Throws: Nothing. 
27596: template <ErrorCodeEnum E> 
27597: error_code& operator=(E e); 
27598: 3 Postconditions: *this == 
27599: 4 Returns: *this. 
27600: 5 Throws: Nothing. 
27601: void clear(); 
27602: make_error_code(e). 
27603: 6 Postconditions: value() == 0 and category() == system_category. 
27604: 19.4.2.5 Class error_code observers [syserr.errcode.observers] 
27605: int value() const; 
27606: 1 Returns: val_. 
27607: 2 Throws: Nothing. 
27608: const error_category& category() const; 
27609: 3 Returns: *cat_. 
27610: 4 Throws: Nothing. 
27611: ∫ 19.4.2.5 512 
27612: 
27613: c
27614: . ISO/IEC 
27615: error_condition default_error_condition() const; 
27616: 5 Returns: category().default_error_condition(value()). 
27617: 6 Throws: Nothing. 
27618: string message() const; 
27619: 7 Returns: category().message(value()). 
27620: explicit operator bool() const; 
27621: 8 Returns: value() != 0. 
27622: 9 Throws: Nothing. 
27623: 19.4.2.6 Class error_code non-member functions 
27624: error_code make_error_code(errc e); 
27625: N2800=08-0310 
27626: [syserr.errcode.nonmembers] 
27627: Returns: error_code(static_cast<int>(e), generic_category). 
27628: bool operator<(const error_code& lhs, const error_code& rhs); 
27629: Returns: lhs.category() < rhs.category() || lhs.category() == rhs.category() && lhs.value() 
27630: < rhs.value(). 
27631: 2 Throws: Nothing. 
27632: template <class charT, class traits> 
27633: basic_ostream<charT,traits>& 
27634: operator<<(basic_ostream<charT,traits>& os, const error_code& ec); 
27635: 3 Effects: os << ec.category().name() << ＊:＊ << ec.value(). 
27636: 19.4.3 Class error_condition and concept ErrorConditionEnum 
27637: 19.4.3.1 Concept ErrorConditionEnum 
27638: namespace std {
27639: concept ErrorConditionEnum<typename T> : EnumerationType<T> {
27640: error_condition make_error_condition(T val);
27641: }
27642: }
27643: [syserr.errcondition] 
27644: [syserr.errcondenum] 
27645: 1 Requires: Function make_error_condition shall return error_condition(static_cast<int>(val), 
27646: cat), where cat is an error_category that describes type T. 
27647: 2 Remark: Describes types to be used as an argument to function make_error_condition. 
27648: 19.4.3.2 Class error_condition overview [syserr.errcondition.overview] 
27649: 1 The class error_condition describes an object used to hold values identifying error conditions. [ Note: 
27650: error_condition values are portable abstractions, while error_code values (19.4.2) are implementation 
27651: specific. 〞end note ] 
27652: namespace std {
27653: class error_condition {
27654: public:
27655: ∫ 19.4.3.2 513 
27656: 
27657: c
27658: . ISO/IEC N2800=08-0310 
27659: // 19.4.3.3 constructors: 
27660: error_condition();
27661: error_condition(int val, const error_category& cat);
27662: template <ErrorConditionEnum E>
27663: error_condition(E e); 
27664: // 19.4.3.4 modifiers: 
27665: void assign(int val, const error_category& cat);
27666: template <ErrorConditionEnum E>
27667: error_condition& operator=(E e);
27668: void clear();
27669: // 19.4.3.5 observers: 
27670: int value() const;
27671: const error_category& category() const;
27672: string message() const;
27673: explicit operator bool() const;
27674: private:
27675: int val_; // exposition only
27676: const error_category* cat_; // exposition only
27677: }; 
27678: // 19.4.3.6 non-member functions: 
27679: bool operator<(const error_condition& lhs, const error_condition& rhs);
27680: } // namespace std
27681: 19.4.3.3 Class error_condition constructors [syserr.errcondition.constructors] 
27682: error_condition(); 
27683: 1 Effects: Constructs an object of type error_condition. 
27684: 2 Postconditions: val_ == 0 and cat_ == &generic_category. 
27685: 3 Throws: Nothing. 
27686: error_condition(int val, const error_category& cat); 
27687: 4 Effects: Constructs an object of type error_condition. 
27688: 5 Postconditions: val_ == val and cat_ == &cat. 
27689: 6 Throws: Nothing. 
27690: template <ErrorConditionEnum E>
27691: error_condition(E e);
27692: 7 Effects: Constructs an object of type error_condition. 
27693: 8 Postcondition: *this == make_error_condition(e). 
27694: 9 Throws: Nothing. 
27695: 19.4.3.4 Class error_condition modifiers [syserr.errcondition.modifiers] 
27696: void assign(int val, const error_category& cat); 
27697: ∫ 19.4.3.4 514 
27698: 
27699: c. ISO/IEC N2800=08-0310 
27700: 1 Postconditions: val_ == val and cat_ == &cat. 
27701: 2 Throws: Nothing. 
27702: template <ErrorConditionEnum E> 
27703: error_condition& operator=(E e); 
27704: 3 Postcondition: *this == make_error_condition(e). 
27705: 4 Throws: Nothing. 
27706: void clear(); 
27707: Postconditions: value() == 0 and category() 
27708: 19.4.3.5 Class error_condition observers 
27709: int value() const; 
27710: 1 Returns: val_. 
27711: 2 Throws: Nothing. 
27712: const error_category& category() const; 
27713: 3 Returns: *cat_. 
27714: 4 Throws: Nothing. 
27715: string message() const; 
27716: 5 Returns: category().message(value()). 
27717: explicit operator bool() const; 
27718: 6 Returns: value() != 0. 
27719: 7 Throws: Nothing. 
27720: == generic_category. 
27721: [syserr.errcondition.observers] 
27722: 19.4.3.6 Class error_condition non-member functions [syserr.errcondition.nonmembers] 
27723: error_condition make_error_condition(errc e); 
27724: Returns: error_condition(static_cast<int>(e), generic_category). 
27725: bool operator<(const error_condition& lhs, const error_condition& rhs); 
27726: Returns: lhs.category() < rhs.category() || lhs.category() == rhs.category() && lhs.value() 
27727: 2 
27728: < rhs.value(). 
27729: Throws: Nothing. 
27730: 19.4.4 Comparison operators [syserr.compare] 
27731: 1 
27732: 2 
27733: bool operator==(const error_code& lhs, const error_code& rhs); 
27734: Returns: lhs.category() == rhs.category() && lhs.value() 
27735: Throws: Nothing. 
27736: == rhs.value(). 
27737: bool operator==(const error_code& lhs, const error_condition& rhs); 
27738: ∫ 19.4.4 515 
27739: 
27740: c
27741: . ISO/IEC N2800=08-0310 
27742: 3 Returns: lhs.category().equivalent(lhs.value(), rhs) || rhs.category().equivalent(lhs,
27743: rhs.value()).
27744: 4 Throws: Nothing. 
27745: bool operator==(const error_condition& lhs, const error_code& rhs); 
27746: 5 Returns: rhs.category().equivalent(rhs.value(), lhs) || lhs.category.equivalent(rhs, lhs.value()). 
27747: 6 Throws: Nothing. 
27748: bool operator==(const error_condition& lhs, const error_condition& rhs); 
27749: 7 Returns: lhs.category() == rhs.category() && lhs.value() == rhs.value().
27750: 8 Throws: Nothing.
27751: bool operator!=(const error_code& lhs, const error_code& rhs);
27752: bool operator!=(const error_code& lhs, const error_condition& rhs);
27753: bool operator!=(const error_condition& lhs, const error_code& rhs);
27754: bool operator!=(const error_condition& lhs, const error_condition& rhs);
27755: 9 Returns: !(lhs == rhs). 
27756: 10 Throws: Nothing. 
27757: 19.4.5 Class system_error [syserr.syserr] 
27758: 19.4.5.1 Class system_error overview [syserr.syserr.overview] 
27759: 1 The class system_error describes an exception object used to report error conditions that have an associated
27760: error code. Such error conditions typically originate from the operating system or other low-level application
27761: program interfaces.
27762: 2 [ Note: If an error represents an out-of-memory condition, implementations are encouraged to throw an
27763: exception object of type bad_alloc 18.5.2.1 rather than system_error. 〞end note ]
27764: namespace std {
27765: class system_error : public runtime_error {
27766: public:
27767: system_error(error_code ec, const string& what_arg);
27768: system_error(error_code ec, const char* what_arg);
27769: system_error(error_code ec);
27770: system_error(int ev, const error_category& ecat,
27771: const string& what_arg);
27772: system_error(int ev, const error_category& ecat,
27773: const char* what_arg);
27774: system_error(int ev, const error_category& ecat);
27775: const error_code& code() const throw();
27776: const char* what() const throw();
27777: };
27778: } // namespace std
27779: 19.4.5.2 Class system_error members [syserr.syserr.members] 
27780: system_error(error_code ec, const string& what_arg); 
27781: 1 Effects: Constructs an object of class system_error. 
27782: ∫ 19.4.5.2 516 
27783: 
27784: c
27785: . ISO/IEC N2800=08-0310 
27786: 2 Postconditions: code() == ec and strcmp(runtime_error::what(), what_arg.c_str()) == 0. 
27787: system_error(error_code ec, const char* what_arg); 
27788: 3 Effects: Constructs an object of class system_error.
27789: 4 Postconditions: code() == ec and strcmp(runtime_error::what(), what_arg) == 0.
27790: system_error(error_code ec); 
27791: 5 Effects: Constructs an object of class system_error.
27792: 6 Postconditions: code() == ec and strcmp(runtime_error::what(), "") == 0.
27793: system_error(int ev, const error_category& ecat,
27794: const string& what_arg);
27795: 7 Effects: Constructs an object of class system_error. 
27796: 8 Postconditions: code() == error_code(ev, ecat) and strcmp(runtime_error::what(), what_
27797: arg.
27798: c_str()) == 0.
27799: system_error(int ev, const error_category& ecat,
27800: const char* what_arg);
27801: 9 Effects: Constructs an object of class system_error. 
27802: 10 Postconditions: code() == error_code(ev, ecat) and strcmp(runtime_error::what(), what_arg) == 0. 
27803: system_error(int ev, const error_category& ecat); 
27804: 11 Effects: Constructs an object of class system_error.
27805: 12 Postconditions: code() == error_code(ev, ecat) and strcmp(runtime_error::what(), "") ==
27806: 0. 
27807: const error_code& code() const throw(); 
27808: 13 Returns: ec or error_code(ev, ecat), from the constructor, as appropriate. 
27809: const char *what() const throw(); 
27810: 14 Returns: An ntbs incorporating runtime_error::what() and code().message(). 
27811: [ Note: One possible implementation would be: 
27812: if (msg.empty()) { 
27813: try {
27814: std::string tmp = runtime_error::what();
27815: if (code()) {
27816: if (!tmp.empty())
27817: tmp += ": ";
27818: tmp += code().message();
27819: }
27820: swap(msg, tmp);
27821: } catch(...) {
27822: return runtime_error::what();
27823: }
27824: return msg.c_str();
27825: 〞end note ] 
27826: ∫ 19.4.5.2 517 
27827: 
27828: . ISO/IEC N2800=08-0310 
27829: 20 General utilities library [utilities]
27830: 1 This Clause describes components used by other elements of the C++ standard library. These components 
27831: may also be used by C++ programs. 
27832: 2 The following Clauses describe utility and allocator requirements, utility components, compile-time rational 
27833: arithmetic, tuples, type traits templates, function objects, dynamic memory management utilities, and 
27834: date/time utilities, as summarized in Table 30. 
27835: Table 30 〞 General utilities library summary 
27836: Subclause Header(s) 
27837: 20.1 Concepts <concepts> 
27838: <memory_concepts> 
27839: 20.2 Utility components <utility> 
27840: 20.3 Compile-time rational arithmetic <ratio> 
27841: 20.4 Tuples <tuple> 
27842: 20.5 Type traits <type_traits> 
27843: 20.6 Function objects <functional> 
27844: <memory> 
27845: 20.7 Memory <cstdlib> 
27846: <cstring> 
27847: 20.8 Time utilities <chrono> 
27848: 20.9 Date and time functions <ctime> 
27849: 20.1 Concepts [utility.concepts] 
27850: 1 This subclause describes concepts that specify requirements on template arguments used throughout the 
27851: C++ Standard Library. Concepts whose name is prefixed with Has provide detection of a specific syntax 
27852: (e.g., HasConstructor), but do not imply the semantics of the corresponding operation. Concepts whose 
27853: name has the able or ible suffix (e.g., Constructible) require both a specific syntax and semantics of 
27854: the associated operations. These semantic concepts refine the corresponding syntax-detection concepts, for 
27855: example, the Constructible concept refines the HasConstructor concept. 
27856: Header <concepts> synopsis 
27857: namespace std { 
27858: // 20.1.1, type transformations: 
27859: auto concept IdentityOf<typename T> see below ;
27860: auto concept RvalueOf<typename T> see below ;
27861: template<typename T> concept_map RvalueOf<T&> see below ;
27862: // 20.1.2, true: 
27863: concept True<bool> { }
27864: concept_map True<true> { }
27865: // 20.1.3, operator concepts: 
27866: auto concept HasPlus<typename T, typename U> see below ; 
27867: ∫ 20.1 518 
27868: 
27869: c
27870: . ISO/IEC N2800=08-0310 
27871: auto concept HasMinus<typename T, typename U> see below ;
27872: auto concept HasMultiply<typename T, typename U> see below ;
27873: auto concept HasDivide<typename T, typename U> see below ;
27874: auto concept HasModulus<typename T, typename U> see below ;
27875: auto concept HasUnaryPlus<typename T> see below ;
27876: auto concept HasNegate<typename T> see below ;
27877: auto concept HasLess<typename T, typename U> see below ;
27878: auto concept HasGreater<typename T, typename U> see below ;
27879: auto concept HasLessEqual<typename T, typename U> see below ;
27880: auto concept HasGreaterEqual<typename T, typename U> see below ;
27881: auto concept HasEqualTo<typename T, typename U> see below ;
27882: auto concept HasNotEqualTo<typename T, typename U> see below ;
27883: auto concept HasLogicalAnd<typename T, typename U> see below ;
27884: auto concept HasLogicalOr<typename T, typename U> see below ;
27885: auto concept HasLogicalNot<typename T> see below ;
27886: auto concept HasBitAnd<typename T, typename U> see below ;
27887: auto concept HasBitOr<typename T, typename U> see below ;
27888: auto concept HasBitXor<typename T, typename U> see below ;
27889: auto concept HasComplement<typename T> see below ;
27890: auto concept HasLeftShift<typename T, typename U> see below ;
27891: auto concept HasRightShift<typename T, typename U> see below ;
27892: auto concept HasDereference<typename T> see below ;
27893: auto concept HasAddressOf<typename T> see below ;
27894: auto concept HasSubscript<typename T, typename U> see below ;
27895: auto concept Callable<typename F, typename... Args> see below ;
27896: auto concept HasAssign<typename T, typename U> see below ;
27897: auto concept HasPlusAssign<typename T, typename U> see below ;
27898: auto concept HasMinusAssign<typename T, typename U> see below ;
27899: auto concept HasMultiplyAssign<typename T, typename U> see below ;
27900: auto concept HasDivideAssign<typename T, typename U> see below ;
27901: auto concept HasModulusAssign<typename T, typename U> see below ;
27902: auto concept HasBitAndAssign<typename T, typename U> see below ;
27903: auto concept HasBitOrAssign<typename T, typename U> see below ;
27904: auto concept HasBitXorAssign<typename T, typename U> see below ;
27905: auto concept HasLeftShiftAssign<typename T, typename U> see below ;
27906: auto concept HasRightShiftAssign<typename T, typename U> see below ;
27907: auto concept HasPreincrement<typename T> see below ;
27908: auto concept HasPostincrement<typename T> see below ;
27909: auto concept HasPredecrement<typename T> see below ;
27910: auto concept HasPostdecrement<typename T> see below ;
27911: auto concept HasComma<typename T, typename U> see below ;
27912: // 20.1.4, predicates: 
27913: auto concept Predicate<typename F, typename... Args> see below ; 
27914: // 20.1.5, comparisons: 
27915: auto concept LessThanComparable<typename T> see below ;
27916: auto concept EqualityComparable<typename T> see below ;
27917: auto concept StrictWeakOrder<typename F, typename T> see below ;
27918: auto concept EquivalenceRelation<typename F, typename T> see below ;
27919: // 20.1.6, construction: 
27920: auto concept HasConstructor<typename T, typename... Args> see below ;
27921: auto concept Constructible<typename T, typename... Args> see below ;
27922: auto concept DefaultConstructible<typename T> see below ;
27923: ∫ 20.1 519 
27924: 
27925: c
27926: . ISO/IEC N2800=08-0310 
27927: concept TriviallyDefaultConstructible<typename T> see below ; 
27928: // 20.1.7, destruction: 
27929: auto concept HasDestructor<typename T> see below ;
27930: auto concept HasVirtualDestructor<typename T> see below ;
27931: auto concept NothrowDestructible<typename T> see below ;
27932: concept TriviallyDestructible<typename T> see below ;
27933: // 20.1.8, copy and move: 
27934: auto concept MoveConstructible<typename T> see below ;
27935: auto concept CopyConstructible<typename T> see below ;
27936: concept TriviallyCopyConstructible<typename T> see below ;
27937: auto concept MoveAssignable<typename T> see below ;
27938: auto concept CopyAssignable<typename T> see below ;
27939: concept TriviallyCopyAssignable<typename T> see below ;
27940: auto concept HasSwap<typename T, typename U> see below ;
27941: auto concept Swappable<typename T> see below ;
27942: // 20.1.9, memory allocation: 
27943: auto concept FreeStoreAllocatable<typename T> see below ; 
27944: // 20.1.10, regular types: 
27945: auto concept Semiregular<typename T> see below ;
27946: auto concept Regular<typename T> see below ;
27947: // 20.1.11, convertibility: 
27948: auto concept ExplicitlyConvertible<typename T, typename U> see below ;
27949: auto concept Convertible<typename T, typename U> see below ;
27950: // 20.1.12, arithmetic concepts: 
27951: concept ArithmeticLike<typename T> see below ;
27952: concept IntegralLike<typename T> see below ;
27953: concept SignedIntegralLike<typename T> see below ;
27954: concept UnsignedIntegralLike<typename T> see below ;
27955: concept FloatingPointLike<typename T> see below ;
27956: } 
27957: 20.1.1 Type transformations [concept.transform] 
27958: 1 The concepts in 20.1.1 provide simple type transformations that can be used within constrained templates. 
27959: 2 A program shall not provide concept maps for any concept in 20.1.1. 
27960: auto concept IdentityOf<typename T> {
27961: typename type = T;
27962: requires SameType<type, T>;
27963: } 
27964: 3 Note: concept form of the identity type metafunction (20.6.6). 
27965: auto concept RvalueOf<typename T> {
27966: typename type = T&&;
27967: requires Convertible<T&, type> && Convertible<T&&, type>;
27968: } 
27969: 4 Note: describes the rvalue reference type for an arbitrary type T. 
27970: ∫ 20.1.1 520 
27971: 
27972: c
27973: . ISO/IEC N2800=08-0310 
27974: template<typename T> concept_map RvalueOf<T&> {
27975: typedef T&& type;
27976: }
27977: 5 Note: provides the appropriate rvalue reference type for the rvalue an lvalue reference type. [ Note: 
27978: this concept map is required to circumvent reference collapsing for lvalue references. 〞end note ] 
27979: 20.1.2 True [concept.true] 
27980: concept True<bool> { }
27981: concept_map True<true> { }
27982: 1 Note: used to express the requirement that a particular integral constant expression evaluate true. 
27983: 2 Requires: a program shall not provide a concept map for the True concept. 
27984: 20.1.3 Operator concepts [concept.operator] 
27985: auto concept HasPlus<typename T, typename U> {
27986: typename result_type;
27987: result_type operator+(const T&, const U&);
27988: } 
27989: 1 Note: describes types with a binary operator+. 
27990: auto concept HasMinus<typename T, typename U> {
27991: typename result_type;
27992: result_type operator-(const T&, const U&);
27993: } 
27994: 2 Note: describes types with a binary operator-. 
27995: auto concept HasMultiply<typename T, typename U> {
27996: typename result_type;
27997: result_type operator*(const T&, const U&);
27998: } 
27999: 3 Note: describes types with a binary operator*. 
28000: auto concept HasDivide<typename T, typename U> {
28001: typename result_type;
28002: result_type operator/(const T&, const U&);
28003: } 
28004: 4 Note: describes types with an operator/. 
28005: auto concept HasModulus<typename T, typename U> {
28006: typename result_type;
28007: result_type operator%(const T&, const U&);
28008: } 
28009: 5 Note: describes types with an operator%. 
28010: auto concept HasUnaryPlus<typename T> {
28011: typename result_type;
28012: result_type operator+(const T&);
28013: } 
28014: ∫ 20.1.3 521 
28015: 
28016: c
28017: . ISO/IEC N2800=08-0310 
28018: 6 Note: describes types with a unary operator+. 
28019: auto concept HasNegate<typename T> {
28020: typename result_type;
28021: result_type operator-(const T&);
28022: } 
28023: 7 Note: describes types with a unary operator-. 
28024: auto concept HasLess<typename T, typename U> {
28025: bool operator<(const T& a, const U& b);
28026: } 
28027: 8 Note: describes types with an operator<. 
28028: auto concept HasGreater<typename T, typename U> {
28029: bool operator>(const T& a, const U& b);
28030: } 
28031: 9 Note: describes types with an operator>. 
28032: auto concept HasLessEqual<typename T, typename U> {
28033: bool operator<=(const T& a, const U& b);
28034: } 
28035: 10 Note: describes types with an operator<=. 
28036: auto concept HasGreaterEqual<typename T, typename U> {
28037: bool operator>=(const T& a, const U& b);
28038: } 
28039: 11 Note: describes types with an operator>=. 
28040: 12 For the concepts HasLess, HasGreater, HasLessEqual, and HasGreaterEqual, the concept maps in name-
28041: space std for any pointer type yield a total order, even if the built-in operators <, >, <=, >= do not. 
28042: auto concept HasEqualTo<typename T, typename U> {
28043: bool operator==(const T& a, const U& b);
28044: } 
28045: 13 Note: describes types with an operator==. 
28046: auto concept HasNotEqualTo<typename T, typename U> {
28047: bool operator!=(const T& a, const U& b);
28048: } 
28049: 14 Note: describes types with an operator!=. 
28050: auto concept HasLogicalAnd<typename T, typename U> {
28051: bool operator&&(const T&, const U&);
28052: } 
28053: 15 Note: describes types with a logical conjunction operator. 
28054: auto concept HasLogicalOr<typename T, typename U> {
28055: bool operator||(const T&, const U&);
28056: } 
28057: 16 Note: describes types with a logical disjunction operator. 
28058: auto concept HasLogicalNot<typename T> { 
28059: ∫ 20.1.3 522 
28060: 
28061: c. ISO/IEC N2800=08-0310 
28062: bool operator!(const T&); 
28063: } 
28064: 17 Note: describes types with a logical negation operator. 
28065: auto concept HasBitAnd<typename T, typename U> { 
28066: typename result_type; 
28067: result_type operator&(const T&, const U&); 
28068: } 
28069: 18 Note: describes types with a binary operator&. 
28070: auto concept HasBitOr<typename T, typename U> { 
28071: typename result_type; 
28072: result_type operator|(const T&, const U&); 
28073: } 
28074: 19 Note: describes types with an operator|. 
28075: auto concept HasBitXor<typename T, typename U> { 
28076: typename result_type; 
28077: result_type operator^(const T&, const U&); 
28078: } 
28079: 20 Note: describes types with an operator.. 
28080: auto concept HasComplement<typename T> { 
28081: typename result_type; 
28082: result_type operator~(const T&); 
28083: } 
28084: 21 Note: describes types with an operator.. 
28085: auto concept HasLeftShift<typename T, typename U> { 
28086: typename result_type; 
28087: result_type operator<<(const T&, const U&); 
28088: } 
28089: 22 Note: describes types with an operator<<. 
28090: auto concept HasRightShift<typename T, typename U> { 
28091: typename result_type; 
28092: result_type operator>>(const T&, const U&); 
28093: } 
28094: 23 Note: describes types with an operator>>. 
28095: auto concept HasDereference<typename T> { 
28096: typename result_type; 
28097: result_type operator*(T&&); 
28098: } 
28099: 24 Note: describes types with a dereferencing operator*. 
28100: auto concept HasAddressOf<typename T> { 
28101: typename result_type; 
28102: result_type operator&(T&); 
28103: } 
28104: 25 Note: describes types with an address-of operator&. 
28105: ∫ 20.1.3 523 
28106: 
28107: c. ISO/IEC N2800=08-0310 
28108: auto concept HasSubscript<typename T, typename U> { 
28109: typename result_type; 
28110: result_type operator[](T&&, const U&); 
28111: } 
28112: 26 Note: describes types with a subscript operator[]. 
28113: auto concept Callable<typename F, typename... Args> { 
28114: typename result_type; 
28115: result_type operator()(F&&, Args...); 
28116: } 
28117: 27 Note: describes function object types callable given arguments of types Args.... 
28118: auto concept HasAssign<typename T, typename U> { 
28119: typename result_type; 
28120: result_type T::operator=(U); 
28121: } 
28122: 28 Note: describes types with an assignment operator. 
28123: auto concept HasPlusAssign<typename T, typename U> { 
28124: typename result_type; 
28125: result_type operator+=(T&, U); 
28126: } 
28127: 29 Note: describes types with an operator+=. 
28128: auto concept HasMinusAssign<typename T, typename U> { 
28129: typename result_type; 
28130: result_type operator-=(T&, U); 
28131: } 
28132: 30 Note: describes types with an operator. =. 
28133: auto concept HasMultiplyAssign<typename T, typename U> { 
28134: typename result_type; 
28135: result_type operator*=(T&, U); 
28136: } 
28137: 31 Note: describes types with an operator. =. 
28138: auto concept HasDivideAssign<typename T, typename U> { 
28139: typename result_type; 
28140: result_type operator/=(T&, U); 
28141: } 
28142: 32 Note: describes types with an operator/ =. 
28143: auto concept HasModulusAssign<typename T, typename U> { 
28144: typename result_type; 
28145: result_type operator%=(T&, U); 
28146: } 
28147: 33 Note: describes types with an operator%=. 
28148: auto concept HasBitAndAssign<typename T, typename U> { 
28149: typename result_type; 
28150: result_type operator&=(T&, U); 
28151: } 
28152: ∫ 20.1.3 524 
28153: 
28154: c. ISO/IEC N2800=08-0310 
28155: 34 Note: describes types with an operator&=. 
28156: auto concept HasBitOrAssign<typename T, typename U> { 
28157: typename result_type; 
28158: result_type operator|=(T&, U); 
28159: } 
28160: 35 Note: describes types with an operator| =. 
28161: auto concept HasBitXorAssign<typename T, typename U> { 
28162: typename result_type; 
28163: result_type operator^=(T&, U); 
28164: } 
28165: 36 Note: describes types with an operator.=. 
28166: auto concept HasLeftShiftAssign<typename T, typename U> { 
28167: typename result_type; 
28168: result_type operator<<=(T&, U); 
28169: } 
28170: 37 Note: describes types with an operator<<=. 
28171: auto concept HasRightShiftAssign<typename T, typename U> { 
28172: typename result_type; 
28173: result_type operator>>=(T&, U); 
28174: } 
28175: 38 Note: describes types with an operator>>=. 
28176: auto concept HasPreincrement<typename T> { 
28177: typename result_type; 
28178: result_type operator++(T&); 
28179: } 
28180: 39 Note: describes types with a pre-increment operator. 
28181: auto concept HasPostincrement<typename T> { 
28182: typename result_type; 
28183: result_type operator++(T&, int); 
28184: } 
28185: 40 Note: describes types with a post-increment operator. 
28186: auto concept HasPredecrement<typename T> { 
28187: typename result_type; 
28188: result_type operator--(T&); 
28189: } 
28190: 41 Note: describes types with a pre-decrement operator. 
28191: auto concept HasPostdecrement<typename T> { 
28192: typename result_type; 
28193: result_type operator--(T&, int); 
28194: } 
28195: 42 Note: describes types with a post-decrement operator. 
28196: auto concept HasComma<typename T, typename U> { 
28197: typename result_type 
28198: ∫ 20.1.3 525 
28199: 
28200: c
28201: . ISO/IEC N2800=08-0310 
28202: result_type operator,(const T&, const U&);
28203: }
28204: 43 Note: describes types with a comma operator. 
28205: 20.1.4 Predicates [concept.predicate] 
28206: auto concept Predicate<typename F, typename... Args> : Callable<F, const Args&...> {
28207: requires Convertible<result_type, bool>;
28208: }
28209: 1 Note: describes function objects callable with some set of arguments, the result of which can be used 
28210: in a context that requires a bool. 
28211: 2 Requires: predicate function objects shall not apply any non-constant function through the predicate 
28212: arguments. 
28213: 20.1.5 Comparisons [concept.comparison] 
28214: auto concept LessThanComparable<typename T> : HasLess<T, T> {
28215: bool operator>(const T& a, const T& b) { return b < a; }
28216: bool operator<=(const T& a, const T& b) { return !(b < a); }
28217: bool operator>=(const T& a, const T& b) { return !(a < b); }
28218: axiom Consistency(T a, T b) {
28219: (a > b) == (b < a);
28220: (a <= b) == !(b < a);
28221: (a >= b) == !(a < b);
28222: } 
28223: axiom Irreflexivity(T a) { (a < a) == false; } 
28224: axiom Antisymmetry(T a, T b) {
28225: if (a < b)
28226: (b < a) == false;
28227: }
28228: axiom Transitivity(T a, T b, T c) {
28229: if (a < b && b < c)
28230: (a < c) == true;
28231: }
28232: axiom TransitivityOfEquivalence(T a, T b, T c) {
28233: if (!(a < b) && !(b < a) && !(b < c) && !(c < b))
28234: (!(a < c) && !(c < a)) == true;
28235: }
28236: }
28237: 1 Note: describes types whose values can be ordered, where operator< is a strict weak ordering relation 
28238: (25.3). 
28239: auto concept EqualityComparable<typename T> : HasEqualTo<T, T> {
28240: bool operator!=(const T& a, const T& b) { return !(a == b); }
28241: axiom Consistency(T a, T b) { 
28242: ∫ 20.1.5 526 
28243: 
28244: c
28245: . ISO/IEC N2800=08-0310 
28246: (a == b) == !(a != b);
28247: }
28248: axiom Reflexivity(T a) { a == a; } 
28249: axiom Symmetry(T a, T b) {
28250: if (a == b)
28251: b == a;
28252: }
28253: axiom Transitivity(T a, T b, T c) {
28254: if (a == b && b == c)
28255: a == c;
28256: }
28257: }
28258: 2 Note: describes types whose values can be compared for equality with operator==, which is an equiv-
28259: alence relation. 
28260: auto concept StrictWeakOrder<typename F, typename T> : Predicate<F, T, T> { 
28261: axiom Irreflexivity(F f, T a) { f(a, a) == false; } 
28262: axiom Antisymmetry(F f, T a, T b) {
28263: if (f(a, b))
28264: f(b, a) == false;
28265: }
28266: axiom Transitivity(F f, T a, T b, T c) {
28267: if (f(a, b) && f(b, c))
28268: f(a, c) == true;
28269: }
28270: axiom TransitivityOfEquivalence(F f, T a, T b, T c) {
28271: if (!f(a, b) && !f(b, a) && !f(b, c) && !f(c, b))
28272: (!f(a, c) && !f(c, a)) == true;
28273: }
28274: }
28275: 3 Note: describes a strict weak ordering relation (25.3), F, on a type T. 
28276: auto concept EquivalenceRelation<typename F, typename T> : Predicate<F, T, T> {
28277: axiom Reflexivity(F f, T a) { f(a, a) == true; }
28278: axiom Symmetry(F f, T a, T b) {
28279: if (f(a, b))
28280: f(b, a) == true;
28281: }
28282: axiom Transitivity(F f, T a, T b, T c) {
28283: if (f(a, b) && f(b, c))
28284: f(a, c) == true;
28285: }
28286: }
28287: 4 Note: describes an equivalence relation, F, on a type T. 
28288: ∫ 20.1.5 527 
28289: 
28290: c
28291: . ISO/IEC N2800=08-0310 
28292: 20.1.6 Construction [concept.construct] 
28293: auto concept HasConstructor<typename T, typename... Args> {
28294: T::T(Args...);
28295: }
28296: 1 Note: describes types that can be constructed from a given set of arguments. 
28297: auto concept Constructible<typename T, typename... Args>
28298: : HasConstructor<T, Args...>, NothrowDestructible<T> { }
28299: 2 Note: describes types that can be constructed from a given set of arguments that also have a no-throw 
28300: destructor. 
28301: auto concept DefaultConstructible<typename T> : Constructible<T> { } 
28302: 3 Note: describes types for which an object can be constructed without initializing the object to any 
28303: particular value. 
28304: concept TriviallyDefaultConstructible<typename T> : DefaultConstructible<T> { } 
28305: 4 Note: describes types whose default constructor is trivial. 
28306: 5 Requires: for every type T that is a trivial type (3.9) or a class type with a trivial default constructor 
28307: (12.1), a concept map TriviallyDefaultConstructible<T> shall be implicitly defined in namespace 
28308: std. 
28309: 20.1.7 Destruction [concept.destruct] 
28310: auto concept HasDestructor<typename T> {
28311: T::~T();
28312: }
28313: 1 Note: describes types that can be destroyed. These are scalar types, references, and class types with 
28314: a public non-deleted destructor. 
28315: concept HasVirtualDestructor<typename T> : HasDestructor<T>, PolymorphicClass<T> { } 
28316: 2 Note: describes types with a virtual destructor. 
28317: 3 Requires: for every class type T that has a virtual destructor, a concept map HasVirtualDestructor<T> 
28318: shall be implicitly defined in namespace std. 
28319: auto concept NothrowDestructible<typename T> : HasDestructor<T> { }
28320: T::~T() // inherited from HasDestructor<T>
28321: 4 Requires: no exception is propagated. 
28322: concept TriviallyDestructible<typename T> : NothrowDestructible<T> { } 
28323: 5 Note: describes types whose destructors do not need to be executed when the object is destroyed. 
28324: 6 Requires: for every type T that is a trivial type (3.9), reference, or class type with a trivial destructor 
28325: (12.4), a concept map TriviallyDestructible<T> shall be implicitly defined in namespace std. 
28326: 20.1.8 Copy and move [concept.copymove] 
28327: ∫ 20.1.8 528 
28328: 
28329: c
28330: . ISO/IEC N2800=08-0310 
28331: auto concept MoveConstructible<typename T> : Constructible<T, T&&> {
28332: requires RvalueOf<T> && Constructible<T, RvalueOf<T>::type>;
28333: }
28334: 1 Note: describes types that can move-construct an object from a value of the same type, possibly 
28335: altering that value. 
28336: T::T(T&& rv); // note: inherited from HasConstructor<T, T&&> 
28337: 2 Postcondition: the constructed T object is equivalent to the value of rv before the construction. [ Note: 
28338: there is no requirement on the value of rv after the construction. 〞end note ] 
28339: auto concept CopyConstructible<typename T> : MoveConstructible<T>, Constructible<T, const T&> { 
28340: axiom CopyPreservation(T x) { 
28341: T(x) == x; 
28342: } 
28343: } 
28344: 3 Note: describes types with a public copy constructor. 
28345: concept TriviallyCopyConstructible<typename T> : CopyConstructible<T> { } 
28346: 4 Note: describes types whose copy constructor is equivalent to memcpy. 
28347: 5 Requires: for every type T that is a trivial type (3.9), a reference, or a class type with a trivial copy 
28348: constructor (12.8), a concept map TriviallyCopyConstructible<T> shall be implicitly defined in 
28349: namespace std. 
28350: auto concept MoveAssignable<typename T> : HasAssign<T, T&&> {
28351: requires RvalueOf<T> && HasAssign<T, RvalueOf<T>::type>;
28352: }
28353: 6 Note: describes types with the ability to assign to an object from an rvalue, potentially altering the 
28354: rvalue. 
28355: result_type T::operator=(T&& rv); // inherited from HasAssign<T, T&&> 
28356: 7 Postconditions: the constructed T object is equivalent to the value of rv before the assignment. [ Note: 
28357: there is no requirement on the value of rv after the assignment. 〞end note ] 
28358: auto concept CopyAssignable<typename T> : HasAssign<T, const T&>, MoveAssignable<T> {
28359: axiom CopyPreservation(T& x, T y) {
28360: (x = y, x) == y;
28361: }
28362: }
28363: 8 Note: describes types with the ability to assign to an object. 
28364: concept TriviallyCopyAssignable<typename T> : CopyAssignable<T> { } 
28365: 9 Note: describes types whose copy-assignment operator is equivalent to memcpy. 
28366: 10 Requires: for every type T that is a trivial type (ref) or a class type with a trivial copy assignment 
28367: operator (12.8), a concept map TriviallyCopyAssignable<T> shall be implicitly defined in namespace 
28368: std. 
28369: auto concept HasSwap<typename T, typename U> {
28370: void swap(T, U);
28371: }
28372: ∫ 20.1.8 529 
28373: 
28374: c
28375: . ISO/IEC N2800=08-0310 
28376: 11 Note: describes types that have a swap operation. 
28377: auto concept Swappable<typename T> : HasSwap<T&, T&> { } 
28378: 12 Note: describes types for which two values of that type can be swapped. 
28379: void swap(T& t, T& u); // inherited from HasSwap<T, T> 
28380: 13 Postconditions: t has the value originally held by u, and u has the value originally held by t. 
28381: 20.1.9 Memory allocation [concept.memory] 
28382: auto concept FreeStoreAllocatable<typename T> {
28383: void* T::operator new(size_t size);
28384: void T::operator delete(void*);
28385: void* T::operator new[](size_t size) {
28386: return T::operator new(size);
28387: }
28388: void T::operator delete[](void* ptr) {
28389: T::operator delete(ptr);
28390: }
28391: void* T::operator new(size_t size, const nothrow_t&) {
28392: try {
28393: return T::operator new(size);
28394: } catch(...) {
28395: return 0;
28396: }
28397: }
28398: void* T::operator new[](size_t size, const nothrow_t&) {
28399: try {
28400: return T::operator new[](size);
28401: } catch(...) {
28402: return 0;
28403: }
28404: }
28405: void T::operator delete(void* ptr, const nothrow_t&) {
28406: T::operator delete(ptr);
28407: }
28408: void T::operator delete[](void* ptr, const nothrow_t&) {
28409: T::operator delete[](ptr);
28410: }
28411: }
28412: 1 Note: describes types for which objects and arrays of objects can be allocated on or freed from the 
28413: free store with new and delete. 
28414: 20.1.10 Regular types [concept.regular] 
28415: auto concept Semiregular<typename T> 
28416: ∫ 20.1.10 530 
28417: 
28418: c
28419: . ISO/IEC N2800=08-0310 
28420: : CopyConstructible<T>, CopyAssignable<T>, FreeStoreAllocatable<T> {
28421: requires SameType<CopyAssignable<T>::result_type, T&>;
28422: }
28423: 1 Note: collects several common requirements supported by most types. 
28424: auto concept Regular<typename T>
28425: : Semiregular<T>, DefaultConstructible<T>, EqualityComparable<T> { }
28426: 2 Note: describes semi-regular types that are default constructible and have equality comparison oper-
28427: ators. 
28428: 20.1.11 Convertibility [concept.convertible] 
28429: auto concept ExplicitlyConvertible<typename T, typename U> {
28430: explicit operator U(const T&);
28431: }
28432: 1 Note: describes types with a conversion (explicit or implicit) from T to U. 
28433: auto concept Convertible<typename T, typename U> : ExplicitlyConvertible<T, U> {
28434: operator U(const T&);
28435: }
28436: 2 Note: describes types with an implicit conversion from T to U. 
28437: 20.1.12 Arithmetic concepts [concept.arithmetic] 
28438: concept ArithmeticLike<typename T> 
28439: : Regular<T>, LessThanComparable<T>, HasUnaryPlus<T>, HasNegate<T>,
28440: HasPlus<T, T>, HasMinus<T, T>, HasMultiply<T, T>, HasDivide<T, T>,
28441: HasPreincrement<T>, HasPostincrement<T>, HasPredecrement<T>, HasPostdecrement<T>,
28442: HasPlusAssign<T, const T&>, HasMinusAssign<T, const T&>,
28443: HasMultiplyAssign<T, const T&>, HasDivideAssign<T, const T&> {
28444: explicit T::T(intmax_t);
28445: explicit T::T(uintmax_t);
28446: explicit T::T(long double);
28447: requires Convertible<HasUnaryPlus<T>::result_type, T>
28448: && Convertible<HasNegate<T>::result_type, T>
28449: && Convertible<HasPlus<T, T>::result_type, T>
28450: && Convertible<HasMinus<T, T>::result_type, T>
28451: && Convertible<HasMultiply<T, T>::result_type, T>
28452: && Convertible<HasDivide<T, T>::result_type, T>
28453: && SameType<HasPreincrement<T>::result_type, T&>
28454: && SameType<HasPostincrement<T>::result_type, T>
28455: && SameType<HasPredecrement<T>::result_type, T&>
28456: && SameType<HasPostdecrement<T>::result_type, T>
28457: && SameType<HasPlusAssign<T, const T&>::result_type, T&>
28458: && SameType<HasMinusAssign<T, const T&>::result_type, T&>
28459: && SameType<HasMultiplyAssign<T, const T&>::result_type, T&>
28460: && SameType<HasDivideAssign<T, const T&>::result_type, T&>;
28461: } 
28462: 1 Note: describes types that provide all of the operations available on arithmetic types (3.9.1). 
28463: ∫ 20.1.12 531 
28464: 
28465: c
28466: . ISO/IEC N2800=08-0310 
28467: concept IntegralLike<typename T> 
28468: : ArithmeticLike<T>, 
28469: HasComplement<T>, HasModulus<T, T>, HasBitAnd<T, T>, HasBitXor<T, T>, HasBitOr<T, T>, 
28470: HasLeftShift<T, T>, HasRightShift<T, T> 
28471: HasModulusAssign<T, const T&>, HasLeftShiftAssign<T, const T&>, HasRightShiftAssign<T, const T&> 
28472: HasBitAndAssign<T, const T&>, HasBitXorAssign<T, const T&>, HasBitOrAssign<T, const T&> { 
28473: requires Convertible<HasComplement<T>::result_type, T>
28474: && Convertible<HasModulus<T, T>::result_type, T>
28475: && Convertible<HasBitAnd<T, T>::result_type, T>
28476: && Convertible<HasBitXor<T, T>::result_type, T>
28477: && Convertible<HasBitOr<T, T>::result_type, T>
28478: && Convertible<HasLeftShift<T, T>::result_type, T>
28479: && Convertible<HasRightShift<T, T>::result_type, T>
28480: && SameType<HasModulusAssign<T, const T&>::result_type, T&>
28481: && SameType<HasLeftShiftAssign<T, const T&>::result_type, T&>
28482: && SameType<HasRightShiftAssign<T, const T&>::result_type, T&>
28483: && SameType<HasBitAndAssign<T, const T&>::result_type, T&>
28484: && SameType<HasBitXorAssign<T, const T&>::result_type, T&>
28485: && SameType<HasBitOrAssign<T, const T&>::result_type, T&>;
28486: } 
28487: 2 Note: describes types that provide all of the operations available on integral types. 
28488: concept SignedIntegralLike<typename T> : IntegralLike<T> { } 
28489: 3 Note: describes types that provide all of the operations available on signed integral types. 
28490: 4 Requires: for every signed integral type T (3.9.1), including signed extended integral types, an empty 
28491: concept map SignedIntegralLike<T> shall be defined in namespace std. 
28492: concept UnsignedIntegralLike<typename T> : IntegralLike<T> { } 
28493: 5 Note: describes types that provide all of the operations available on unsigned integral types. 
28494: 6 Requires: for every unsigned integral type T (3.9.1), including unsigned extended integral types, an 
28495: empty concept map UnsignedIntegralLike<T> shall be defined in namespace std. 
28496: concept FloatingPointLike<typename T> : ArithmeticLike<T> { } 
28497: 7 Note: describes floating-point types. 
28498: 8 Requires: for every floating point type T (3.9.1), an empty concept map FloatingPointLike<T> shall 
28499: be defined in namespace std. 
28500: 20.2 Utility components [utility] 
28501: 1 This subclause contains some basic function and class templates that are used throughout the rest of the 
28502: library. 
28503: Header <utility> synopsis 
28504: namespace std { 
28505: // 20.2.1, operators: 
28506: namespace rel_ops {
28507: template<EqualityComparable T> bool operator!=(const T&, const T&);
28508: template<LessThanComparable T> bool operator> (const T&, const T&);
28509: template<LessThanComparable T> bool operator<=(const T&, const T&);
28510: template<LessThanComparable T> bool operator>=(const T&, const T&);
28511: ∫ 20.2 532 
28512: 
28513: c
28514: . ISO/IEC N2800=08-0310 
28515: } 
28516: // 20.2.2, forward/move: 
28517: template <IdentityOf T> T&& forward(IdentityOf<T>::type&&);
28518: template <RvalueOf T> RvalueOf<T>::type move(T&&);
28519: // 20.2.3, pairs: 
28520: template <VariableType T1,VariableType T2> struct pair;
28521: template <EqualityComparable T1, EqualityComparable T2>
28522: bool operator==(const pair<T1,T2>&, const pair<T1,T2>&);
28523: template <LessThanComparable T1, LessThanComparable T2>
28524: bool operator< (const pair<T1,T2>&, const pair<T1,T2>&);
28525: template <EqualityComparable T1, EqualityComparable T2>
28526: bool operator!=(const pair<T1,T2>&, const pair<T1,T2>&);
28527: template <LessThanComparable T1, LessThanComparable T2>
28528: bool operator> (const pair<T1,T2>&, const pair<T1,T2>&);
28529: template <LessThanComparable T1, LessThanComparable T2>
28530: bool operator>=(const pair<T1,T2>&, const pair<T1,T2>&);
28531: template <LessThanComparable T1, LessThanComparable T2>
28532: bool operator<=(const pair<T1,T2>&, const pair<T1,T2>&);
28533: template <Swappable T1, Swappable T2>
28534: void swap(pair<T1,T2>&, pair<T1,T2>&);
28535: template <Swappable T1, Swappable T2>
28536: void swap(pair<T1,T2>&&, pair<T1,T2>&);
28537: template <Swappable T1, Swappable T2>
28538: void swap(pair<T1,T2>&, pair<T1,T2>&&);
28539: template <MoveConstructible T1, MoveConstructible T2>
28540: pair<V1, V2> make_pair(T1&&, T2&&);
28541: // 20.2.4, tuple-like access to pair: 
28542: template <IdentityOf T> class tuple_size;
28543: template <size_t I, IdentityOf T> class tuple_element;
28544: template <VariableType T1, VariableType T2> struct tuple_size<std::pair<T1, T2> >; 
28545: template <VariableType T1, VariableType T2> struct tuple_element<0, std::pair<T1, T2> >; 
28546: template <VariableType T1, VariableType T2> struct tuple_element<1, std::pair<T1, T2> >; 
28547: template<size_t I, class T1, class T2>
28548: requires True<(I < 2)>
28549: P& get(std::pair<T1, T2>&);
28550: template<size_t I, class T1, class T2>
28551: requires True<(I < 2)>
28552: const P& get(const std::pair<T1, T2>&);
28553: // 20.2.5, range concept maps for pair: 
28554: template<InputIterator Iter>
28555: concept_map Range<pair<Iter, Iter> > see below ;
28556: template<InputIterator Iter>
28557: concept_map Range<const pair<Iter, Iter> > see below ;
28558: }
28559: 20.2.1 Operators [operators] 
28560: 1 To avoid redundant definitions of operator!= out of operator== and operators >, <=, and >= out of 
28561: operator<, the library provides the following: 
28562: ∫ 20.2.1 533 
28563: 
28564: c
28565: . ISO/IEC N2800=08-0310 
28566: template <EqualityComparable T> bool operator!=(const T& x, const T& y); 
28567: 2 Returns: !(x == y). 
28568: template <LessThanComparable T> bool operator>(const T& x, const T& y); 
28569: 3 Returns: y<x. 
28570: template <LessThanComparable T> bool operator<=(const T& x, const T& y); 
28571: 4 Returns: !(y < x). 
28572: template <LessThanComparable T> bool operator>=(const T& x, const T& y); 
28573: 5 Returns: !(x < y). 
28574: 6 In thislibrary, whenever a declaration is provided for an operator!=, operator>, operator>=, or operator<=, 
28575: and requirements and semantics are not explicitly provided, the requirements and semantics are as specified 
28576: in this clause. 
28577: 20.2.2 forward/move helpers [forward] 
28578: 1 The library provides templated helper functions to simplify applying move semantics to an lvalue and to 
28579: simplify the implementation of forwarding functions. 
28580: template <IdentityOf T> T&& forward(IdentityOf<T>::type&& t); 
28581: 2 [ Note: The use of IdentityOf in forward forces users to explicitly specify the template parameter. 
28582: This is necessary to get the correct forwarding semantics. 〞end note ] 
28583: 3 Returns: t. 
28584: 4 [ Example: 
28585: template <class T, class A1, class A2> 
28586: shared_ptr<T> factory(A1&& a1, A2&& a2) { 
28587: return shared_ptr<T>(new T(std::forward<A1>(a1), std::forward<A2>(a2))); 
28588: } 
28589: struct A {
28590: A(int&, const double&);
28591: };
28592: void g() {
28593: shared_ptr<A> sp1 = factory<A>(2, 1.414); // error: 2 will not bind to int&
28594: int i = 2;
28595: shared_ptr<A> sp2 = factory<A>(i, 1.414); // OK
28596: } 
28597: 5 In the first call to factory, A1 is deduced as int, so 2 is forwarded to A＊s constructor as. In the second 
28598: call to factory, A1 is deduced as int&, so i is forwarded to A＊s constructor as. In both cases, A2 is 
28599: deduced as double, so 1.414 is forwarded to A＊s constructor as an rvalue. 
28600: 〞end example ] 
28601: template <RvalueOf T> RvalueOf<T>::type move(T&& t); 
28602: 6 Returns: t. 
28603: ∫ 20.2.2 534 
28604: 
28605: c
28606: . ISO/IEC N2800=08-0310 
28607: 20.2.3 Pairs [pairs] 
28608: 1 The library provides a template for heterogeneous pairs of values. The library also provides a matching 
28609: function template to simplify their construction and several templates that provide access to pair objects 
28610: as if they were tuple objects (see 20.4.2.3 and 20.4.2.4). 
28611: template <VariableType T1, VariableType T2> 
28612: struct pair {
28613: typedef T1 first_type;
28614: typedef T2 second_type;
28615: T1 first;
28616: T2 second;
28617: requires DefaultConstructible<T1> && DefaultConstructible<T2> pair();
28618: requires CopyConstructible<T1> && CopyConstructible<T2> pair(const T1& x, const T2& y);
28619: template<class U, class V>
28620: requires Constructible<T1, const U&> && Constructible<T2, const V&>
28621: pair(const pair<U, V>& p);
28622: template<class U, class V> 
28623: requires Constructible<T1, RvalueOf<U>::type> && Constructible<T2, RvalueOf<V>::type> 
28624: pair(pair<U, V>&& p); 
28625: template<class U, class... Args>
28626: requires Constructible<T1, U&&> && Constructible<T2, Args&&...>
28627: pair(U&& x, Args&&... args);
28628: // allocator-extended constructors 
28629: template<Allocator Alloc> 
28630: requires ConstructibleWithAllocator<T1, Alloc> && ConstructibleWithAllocator<T2, Alloc> 
28631: pair(allocator_arg_t, const Alloc& a); 
28632: template<class U, class V, Allocator Alloc>
28633: requires ConstructibleWithAllocator<T1, Alloc, const U&>
28634: && ConstructibleWithAllocator<T2, Alloc, const V&>
28635: pair(allocator_arg_t, const Alloc& a, const pair<U, V>& p);
28636: template<class U, class V, Allocator Alloc>
28637: requires ConstructibleWithAllocator<T1, Alloc, RvalueOf<U>::type>
28638: && ConstructibleWithAllocator<T2, Alloc, RvalueOf<V>::type>
28639: pair(allocator_arg_t, const Alloc& a, pair<U, V>&& p);
28640: template<class U, class... Args, Allocator Alloc>
28641: requires ConstructibleWithAllocator<T1, Alloc, U&&>
28642: && ConstructibleWithAllocator<T2, Alloc, Args&&...>
28643: pair(allocator_arg_t, const Alloc& a, U&& x, Args&&... args);
28644: template<class U , class V>
28645: requires HasAssign<T1, const U&> && HasAssign<T2, const V&>
28646: pair& operator=(const pair<U , V>& p);
28647: requires MoveAssignable<T1> && MoveAssignable<T2> pair& operator=(pair&& p); 
28648: template<class U , class V>
28649: requires HasAssign<T1, RvalueOf<U>::type> && HasAssign<T2, RvalueOf<V>::type>
28650: pair& operator=(pair<U , V>&& p);
28651: requires Swappable<T1> && Swappable<T2> void swap(pair&& p);
28652: };
28653: template <class T1, class T2, class Alloc>
28654: concept_map UsesAllocator<pair<T1, T2>, Alloc> {
28655: typedef Alloc allocator_type;
28656: ∫ 20.2.3 535 
28657: 
28658: c
28659: . ISO/IEC N2800=08-0310 
28660: } 
28661: requires DefaultConstructible<T1> && DefaultConstructible<T2> pair(); 
28662: 2 Effects: Initializes its members as if implemented: pair() : first(), second() {} 
28663: requires CopyConstructible<T1> && CopyConstructible<T2> pair(const T1& x, const T2& y); 
28664: 3 Effects: The constructor initializes first with x and second with y. 
28665: template<class U, class V>
28666: requires Constructible<T1, const U&> && Constructible<T2, const V&>
28667: pair(const pair<U, V> &p);
28668: 4 Effects: Initializes members from the corresponding members of the argument, performing implicit 
28669: conversions as needed. 
28670: template<class U, class V>
28671: requires Constructible<T1, RvalueOf<U>::type> && Constructible<T2, RvalueOf<V>::type>
28672: pair(pair<U, V>&& p);
28673: 5 Effects: The constructor initializes first with std::move(p.first) and second with std::move( 
28674: p.second). 
28675: template<class U, class... Args>
28676: requires Constructible<T1, U&&> && Constructible<T2, Args&&...>
28677: pair(U&& x, Args&&... args);
28678: 6 Effects: The constructor initializes first with std::forward<U>(x) and second with stdforward< 
28679: Args>(args)... 
28680: template<Allocator Alloc>
28681: requires ConstructibleWithAllocator<T1, Alloc> && ConstructibleWithAllocator<T2, Alloc>
28682: pair(allocator_arg_t, const Alloc& a);
28683: 7 Effects: The members first and second are each constructed as ConstructibleWithAllocator ob-
28684: jects with constructor arguments (allocator_arg_t(), a). 
28685: template<class U, class V, Allocator Alloc>
28686: requires ConstructibleWithAllocator<T1, Alloc, const U&>
28687: && ConstructibleWithAllocator<T2, Alloc, const V&>
28688: pair(allocator_arg_t, const Alloc& a, const pair<U, V>& p);
28689: 8 Effects: The members first and second are each constructed as ConstructibleWithAllocator ob-
28690: jects with constructor arguments (allocator_arg_t(), a, p.first) and (allocator_arg_t(), a, 
28691: p.second), respectively. 
28692: template<class U, class V, Allocator Alloc>
28693: requires ConstructibleWithAllocator<T1, Alloc, RvalueOf<U>
28694: && ConstructibleWithAllocator<T2, Alloc, RvalueOf<V>::type>
28695: pair(allocator_arg_t, const Alloc& a, pair<U, V>&& p);
28696: 9 Effects: The members first and second are each constructed as ConstructibleWithAllocator ob-
28697: jects with constructor arguments (allocator_arg_t(), a, std::move(p.first)) and (allocator_-
28698: arg_t(), a, std::move(p.second)), respectively. 
28699: template<class U, class... Args, Allocator Alloc>
28700: requires ConstructibleWithAllocator<T1, Alloc, U&&>
28701: && ConstructibleWithAllocator<T2, Alloc, Args&&...>
28702: ∫ 20.2.3 536 
28703: 
28704: c
28705: . ISO/IEC N2800=08-0310 
28706: pair(allocator_arg_t, const Alloc& a, U&& x, Args&&... args); 
28707: 10 Effects: The members first and second are each constructed as ConstructibleWithAllocator ob-
28708: jects with constructor arguments (allocator_arg_t(), a, std::forward<U>(x)) and (allocator_-
28709: arg_t(), a, std::forward<Args>(args)...), respectively. 
28710: template<class U , class V>
28711: requires HasAssign<T1, const U&> && HasAssign<T2, const V&>
28712: pair& operator=(const pair<U , V>& p);
28713: 11 Effects: Assigns to first with p.first and to second with p.second. 
28714: 12 Returns: *this. 
28715: requires MoveAssignable<T1> && MoveAssignable<T2> pair& operator=(pair&& p); 
28716: 13 Effects: Assigns to first with std::move(p.first) and to second with std::move(p.second). 
28717: 14 Returns: *this. 
28718: template<class U, class V>
28719: requires HasAssign<T1, RvalueOf<U>::type> && HasAssign<T2, RvalueOf<V>::type>
28720: pair& operator=(pair<U, V>&& p);
28721: 15 Effects: Assigns to first with std::move(p.first) and to second with std::move(p.second). 
28722: 16 Returns: *this. 
28723: requires Swappable<T1> && Swappable<T2> void swap(pair&& p); 
28724: 17 Effects: Swaps first with p.first and second with p.second. 
28725: template <EqualityComparable T1, EqualityComparable T2>
28726: bool operator==(const pair<T1, T2>& x, const pair<T1, T2>& y);
28727: 18 Returns: x.first == y.first && x.second == y.second. 
28728: template <LessThanComparable T1, LessThanComparable T2>
28729: bool operator<(const pair<T1, T2>& x, const pair<T1, T2>& y);
28730: 19 Returns: x.first < y.first || (!(y.first < x.first) && x.second < y.second). 
28731: template<class T1, class T2>
28732: requires Swappable<T1> && Swappable<T2>
28733: void swap(pair<T1, T2>& x, pair<T1, T2>& y);
28734: template<class T1, class T2>
28735: requires Swappable<T1> && Swappable<T2>
28736: void swap(pair<T1, T2>&& x, pair<T1, T2>& y);
28737: template<class T1, class T2>
28738: requires Swappable<T1> && Swappable<T2>
28739: void swap(pair<T1, T2>& x, pair<T1, T2>&& y);
28740: 20 Effects: x.swap(y) 
28741: template <MoveConstructible T1, MoveConstructible T2>
28742: pair<V1, V2> make_pair(T1&& x, T2&& y);
28743: 21 Returns: 
28744: pair<V1, V2>(std::forward<T1>(x), std::forward<T2>(y)); 
28745: ∫ 20.2.3 537 
28746: 
28747: c
28748: . ISO/IEC N2800=08-0310 
28749: where V1 and V2 are determined as follows: Let Ui be decay<Ti>::type for each Ti. Then each 
28750: Vi is X& if Ui equals reference_wrapper<X>, otherwise Vi is Ui. 
28751: 22 [ Example: In place of: 
28752: return pair<int, double>(5, 3.1415926); // explicit types 
28753: a C++ program may contain: 
28754: return make_pair(5, 3.1415926); // types are deduced 
28755: 〞end example ] 
28756: 20.2.4 Tuple-like access to pair [pair.astuple] 
28757: tuple_size<pair<T1, T2> >::value 
28758: 1 Returns: integral constant expression. 
28759: 2 Value: 2. 
28760: tuple_element<0, pair<T1, T2> >::type 
28761: 3 Value: the type T1. 
28762: tuple_element<1, pair<T1, T2> >::type 
28763: 4 Value: the type T2. 
28764: template<int I, class T1, class T2>
28765: requires True<(I < 2)>
28766: P& get(pair<T1, T2>&);
28767: template<int I, class T1, class T2>
28768: requires True<(I < 2)>
28769: const P& get(const pair<T1, T2>&);
28770: 5 Return type: If I == 0 then P is T1, otherwise P is T2.
28771: 6 Returns: If I == 0 returns p.first, otherwise returns p.second.
28772: 20.2.5 Range concept maps for pair [pair.concepts] 
28773: template<InputIterator Iter> 
28774: concept_map Range<pair<Iter, Iter> > {
28775: typedef Iter iterator;
28776: Iter begin(pair<Iter, Iter>& p) { return p.first; }
28777: Iter end(pair<Iter, Iter>& p) { return p.second; }
28778: } 
28779: template<InputIterator Iter> 
28780: concept_map Range<const pair<Iter, Iter> > {
28781: typedef Iter iterator;
28782: Iter begin(const pair<Iter, Iter>& p) { return p.first; }
28783: Iter end(const pair<Iter, Iter>& p) { return p.second; }
28784: } 
28785: 1 Note: these concept maps adapt a pair object that holds two iterators to the Range concept. 
28786: ∫ 20.2.5 538 
28787: 
28788: c
28789: . ISO/IEC N2800=08-0310 
28790: 20.2.6 Class template bitset [template.bitset] 
28791: Header <bitset> synopsis 
28792: #include <cstddef> // for size_t
28793: #include <string>
28794: #include <stdexcept> // for invalid_argument,
28795: // out_of_range, overflow_error
28796: #include <iosfwd> // for istream, ostream
28797: namespace std {
28798: template <size_t N> class bitset; 
28799: // 20.2.6.3 bitset operators: 
28800: template <size_t N>
28801: bitset<N> operator&(const bitset<N>&, const bitset<N>&);
28802: template <size_t N>
28803: bitset<N> operator|(const bitset<N>&, const bitset<N>&);
28804: template <size_t N>
28805: bitset<N> operator^(const bitset<N>&, const bitset<N>&);
28806: template <class charT, class traits, size_t N>
28807: basic_istream<charT, traits>&
28808: operator>>(basic_istream<charT, traits>& is, bitset<N>& x);
28809: template <class charT, class traits, size_t N> 
28810: basic_ostream<charT, traits>& 
28811: operator<<(basic_ostream<charT, traits>& os, const bitset<N>& x); 
28812: } 
28813: 1 The header <bitset> defines a class template and several related functions for representing and ma-
28814: nipulating fixed-size sequences of bits. 
28815: namespace std {
28816: template<size_t N> class bitset {
28817: public:
28818: // bit reference: 
28819: class reference {
28820: friend class bitset;
28821: reference();
28822: public: 
28823: ~reference(); 
28824: reference& operator=(bool x); // for b[i] = x; 
28825: reference& operator=(const reference&); // for b[i] = b[j]; 
28826: bool operator~() const; // flips the bit 
28827: operator bool() const; // for x = b[i]; 
28828: reference& flip(); // for b[i].flip(); 
28829: }; 
28830: // 20.2.6.1 constructors: 
28831: constexpr bitset();
28832: constexpr bitset(unsigned long long val);
28833: template<class charT, class traits, class Allocator>
28834: explicit bitset( 
28835: const basic_string<charT,traits,Allocator>& str, 
28836: typename basic_string<charT,traits,Allocator>::size_type pos = 0, 
28837: typename basic_string<charT,traits,Allocator>::size_type n = 
28838: basic_string<charT,traits,Allocator>::npos, 
28839: charT zero = charT(＊0＊), charT one = charT(＊1＊)); 
28840: ∫ 20.2.6 539 
28841: 
28842: c
28843: . ISO/IEC N2800=08-0310 
28844: explicit bitset(const char *str); 
28845: // 20.2.6.2 bitset operations: 
28846: bitset<N>& operator&=(const bitset<N>& rhs);
28847: bitset<N>& operator|=(const bitset<N>& rhs);
28848: bitset<N>& operator^=(const bitset<N>& rhs);
28849: bitset<N>& operator<<=(size_t pos);
28850: bitset<N>& operator>>=(size_t pos);
28851: bitset<N>& set();
28852: bitset<N>& set(size_t pos, bool val = true);
28853: bitset<N>& reset();
28854: bitset<N>& reset(size_t pos);
28855: bitset<N> operator~() const;
28856: bitset<N>& flip();
28857: bitset<N>& flip(size_t pos);
28858: // element access:
28859: constexpr bool operator[](size_t pos) const; // for b[i];
28860: reference operator[](size_t pos); // for b[i];
28861: unsigned long to_ulong() const;
28862: unsigned long long to_ullong() const;
28863: template <class charT, class traits, class Allocator>
28864: basic_string<charT, traits, Allocator> 
28865: to_string(charT zero = charT(＊0＊), charT one = charT(＊1＊)) const; 
28866: template <class charT, class traits> 
28867: basic_string<charT, traits, allocator<charT> > to_string() const; 
28868: template <class charT> 
28869: basic_string<charT, char_traits<charT>, allocator<charT> > to_string() const; 
28870: basic_string<char, char_traits<char>, allocator<char> > to_string() const; 
28871: size_t count() const; 
28872: constexpr size_t size() const; 
28873: bool operator==(const bitset<N>& rhs) const; 
28874: bool operator!=(const bitset<N>& rhs) const; 
28875: constexpr bool test(size_t pos) const; 
28876: bool all() const; 
28877: bool any() const; 
28878: bool none() const; 
28879: bitset<N> operator<<(size_t pos) const; 
28880: bitset<N> operator>>(size_t pos) const; 
28881: };
28882: }
28883: 2 The template class bitset<N> describes an object that can store a sequence consisting of a fixed 
28884: number of bits, N. 
28885: 3 Each bit represents either the value zero (reset) or one (set). To toggle a bit is to change the value zero 
28886: to one, or the value one to zero. Each bit has a non-negative position pos. When converting between 
28887: an object of class bitset<N> and a value of some integral type, bit position pos corresponds to the bit 
28888: value 1 <<pos. The integral value corresponding to two or more bits is the sum of their bit values. 
28889: 4 The functions described in this subclause can report three kinds of errors, each associated with a 
28890: distinct exception: 
28891: 〞 an invalid-argument error is associated with exceptions of type invalid_argument (19.1.3); 
28892: ∫ 20.2.6 540 
28893: 
28894: . ISO/IEC N2800=08-0310 
28895: 〞 an out-of-range error is associated with exceptions of type out_of_range (19.1.5); 
28896: 〞 an overflow error is associated with exceptions of type overflow_error (19.1.8). 
28897: 20.2.6.1 bitset constructors [bitset.cons] 
28898: constexpr bitset(); 
28899: 1 Effects: Constructs an object of class bitset<N>, initializing all bits to zero. 
28900: constexpr bitset(unsigned long long val); 
28901: 2 Effects: Constructs an object of class bitset<N>, initializing the first M bit positions to the 
28902: corresponding bit values in val. M is the smaller of N and the number of bits in the value 
28903: representation (section 3.9) of unsigned long long. If M<N, the remaining bit positions are 
28904: initialized to zero. 
28905: template <class charT, class traits, class Allocator>
28906: explicit
28907: bitset(const basic_string<charT, traits, Allocator>& str,
28908: typename basic_string<charT, traits, Allocator>::size_type pos = 0, 
28909: typename basic_string<charT, traits, Allocator>::size_type n = 
28910: basic_string<charT, traits, Allocator>::npos, 
28911: charT zero = charT(＊0＊), charT one = charT(＊1＊)); 
28912: 3 Requires: pos <= str.size(). 
28913: 4 Throws: out_of_range if pos > str.size(). 
28914: 5 Effects: Determines the effective length rlen of the initializing string as the smaller of n and 
28915: str.size() -pos. 
28916: The function then throws invalid_argument if any of the rlen characters in str beginning at 
28917: position pos is other than zero or one. The function uses traits::eq() to compare the character 
28918: values. 
28919: Otherwise, the function constructs an object of class bitset<N>, initializing the first M bit positions 
28920: to values determined from the corresponding characters in the string str. M is the smaller of N 
28921: and rlen. 
28922: 6 An element of the constructed string has value zero if the corresponding character in str, begin-
28923: ning at position pos, is 0 zero. Otherwise, the element has the value 1. Character position pos 
28924: +M-1 corresponds to bit position zero. Subsequent decreasing character positions correspond 
28925: to increasing bit positions. 
28926: 7 If M<N, remaining bit positions are initialized to zero. 
28927: explicit bitset(const char *str); 
28928: 8 Effects: Constructs an object of class bitset<N> as if by bitset(string(str)). 
28929: 20.2.6.2 bitset members [bitset.members] 
28930: bitset<N>& operator&=(const bitset<N>& rhs); 
28931: 1 Effects: Clears each bit in *this for which the corresponding bit in rhs is clear, and leaves all 
28932: other bits unchanged. 
28933: ∫ 20.2.6.2 541 
28934: 
28935: c
28936: . ISO/IEC N2800=08-0310 
28937: 2 Returns: *this. 
28938: bitset<N>& operator|=(const bitset<N>& rhs); 
28939: 3 Effects: Sets each bit in *this for which the corresponding bit in rhs is set, and leaves all other 
28940: bits unchanged. 
28941: 4 Returns: *this. 
28942: bitset<N>& operator^=(const bitset<N>& rhs); 
28943: 5 Effects: Toggles each bit in *this for which the corresponding bit in rhs is set, and leaves all 
28944: other bits unchanged. 
28945: 6 Returns: *this. 
28946: bitset<N>& operator<<=(size_t pos); 
28947: 7 Effects: Replaces each bit at position I in *this with a value determined as follows: 
28948: 〞 If I < pos, the new value is zero; 
28949: 〞 If I >= pos, the new value is the previous value of the bit at position I -pos.
28950: 8 Returns: *this.
28951: bitset<N>& operator>>=(size_t pos); 
28952: 9 Effects: Replaces each bit at position I in *this with a value determined as follows: 
28953: 〞 If pos >= N -I, the new value is zero; 
28954: 〞 If pos < N -I, the new value is the previous value of the bit at position I + pos. 
28955: 10 Returns: *this. 
28956: bitset<N>& set(); 
28957: 11 Effects: Sets all bits in *this. 
28958: 12 Returns: *this. 
28959: bitset<N>& set(size_t pos, bool val = true); 
28960: 13 Requires: pos is valid
28961: 14 Throws: out_of_range if pos does not correspond to a valid bit position.
28962: 15 Effects: Stores a new value in the bit at position pos in *this. If val is nonzero, the stored value
28963: is one, otherwise it is zero. 
28964: 16 Returns: *this. 
28965: bitset<N>& reset(); 
28966: 17 Effects: Resets all bits in *this. 
28967: 18 Returns: *this. 
28968: bitset<N>& reset(size_t pos); 
28969: 19 Requires: pos is valid 
28970: 20 Throws: out_of_range if pos does not correspond to a valid bit position. 
28971: ∫ 20.2.6.2 542 
28972: 
28973: c
28974: . ISO/IEC N2800=08-0310 
28975: 21 Effects: Resets the bit at position pos in *this. 
28976: 22 Returns: *this. 
28977: bitset<N> operator~() const; 
28978: 23 Effects: Constructs an object x of class bitset<N> and initializes it with *this. 
28979: 24 Returns: x.flip(). 
28980: bitset<N>& flip(); 
28981: 25 Effects: Toggles all bits in *this. 
28982: 26 Returns: *this. 
28983: bitset<N>& flip(size_t pos); 
28984: 27 Requires: pos is valid
28985: 28 Throws: out_of_range if pos does not correspond to a valid bit position.
28986: 29 Effects: Toggles the bit at position pos in *this.
28987: 30 Returns: *this.
28988: unsigned long to_ulong() const; 
28989: 31 Throws: overflow_error if the integral value x corresponding to the bits in *this cannot be 
28990: represented as type unsigned long. 
28991: 32 Returns: x. 
28992: unsigned long long to_ullong() const; 
28993: 33 Throws: overflow_error if the integral value x corresponding to the bits in *this cannot be 
28994: represented as type unsigned long long. 
28995: 34 Returns: x. 
28996: template <class charT, class traits, class Allocator>
28997: basic_string<charT, traits, Allocator>
28998: to_string(charT zero = charT(＊0＊), charT one = charT(＊1＊)) const;
28999: 35 Effects: Constructs a string object of the appropriate type and initializes it to a string of length N 
29000: characters. Each character is determined by the value of its corresponding bit position in *this. 
29001: Character position N-1 corresponds to bit position zero. Subsequent decreasing character posi-
29002: tions correspond to increasing bit positions. Bit value zero becomes the character zero, bit value 
29003: one becomes the character one. 
29004: 36 Returns: The created object. 
29005: template <class charT, class traits>
29006: basic_string<charT, traits, allocator<charT> > to_string() const;
29007: 37 Returns: to_string<charT, traits, allocator<charT> >(). 
29008: template <class charT> 
29009: basic_string<charT, char_traits<charT>, allocator<charT> > to_string() const; 
29010: 38 Returns: to_string<charT, char_traits<charT>, allocator<charT> >(). 
29011: basic_string<char, char_traits<char>, allocator<char> > to_string() const; 
29012: ∫ 20.2.6.2 543 
29013: 
29014: c
29015: . ISO/IEC N2800=08-0310 
29016: 39 Returns: to_string<char, char_traits<char>, allocator<char> >(). 
29017: size_t count() const; 
29018: 40 Returns: A count of the number of bits set in *this. 
29019: constexpr size_t size() const; 
29020: 41 Returns: N. 
29021: bool operator==(const bitset<N>& rhs) const; 
29022: 42 Returns: A nonzero value if the value of each bit in *this equals the value of the corresponding 
29023: bit in rhs. 
29024: bool operator!=(const bitset<N>& rhs) const; 
29025: 43 Returns: A nonzero value if !(*this == rhs). 
29026: constexpr bool test(size_t pos) const; 
29027: 44 Requires: pos is valid
29028: 45 Throws: out_of_range if pos does not correspond to a valid bit position.
29029: 46 Returns: true if the bit at position pos in *this has the value one.
29030: bool all() const; 
29031: 47 Returns: count() == size() 
29032: bool any() const; 
29033: 48 Returns: count() != 0 
29034: bool none() const; 
29035: 49 Returns: count() == 0 
29036: bitset<N> operator<<(size_t pos) const; 
29037: 50 Returns: bitset<N>(*this) <<= pos. 
29038: bitset<N> operator>>(size_t pos) const; 
29039: 51 Returns: bitset<N>(*this) >>= pos. 
29040: constexpr bool operator[](size_t pos) const; 
29041: 52 Requires: pos shall be valid. 
29042: 53 Throws: nothing. 
29043: 54 Returns: test(pos). 
29044: bitset<N>::reference operator[](size_t pos); 
29045: 55 Requires: pos shall be valid.
29046: 56 Throws: nothing.
29047: 57 Returns: An object of type bitset<N>::reference such that (*this)[pos] == this->test(pos),
29048: and such that (*this)[pos] = val is equivalent to this->set(pos, val). 
29049: ∫ 20.2.6.2 544 
29050: 
29051: c
29052: . ISO/IEC N2800=08-0310 
29053: 20.2.6.3 bitset operators [bitset.operators] 
29054: bitset<N> operator&(const bitset<N>& lhs, const bitset<N>& rhs); 
29055: 1 Returns: bitset<N>(lhs) &= rhs. 
29056: bitset<N> operator|(const bitset<N>& lhs, const bitset<N>& rhs); 
29057: 2 Returns: bitset<N>(lhs) |= rhs. 
29058: bitset<N> operator^(const bitset<N>& lhs, const bitset<N>& rhs); 
29059: 3 Returns: bitset<N>(lhs) .= rhs. 
29060: template <class charT, class traits, size_t N>
29061: basic_istream<charT, traits>&
29062: operator>>(basic_istream<charT, traits>& is, bitset<N>& x);
29063: 4 A formatted input function (27.6.1.2). 
29064: 5 Effects: Extracts up to N characters from is. Stores these characters in a temporary object str 
29065: of type basic_string<charT, traits>, then evaluates the expression x = bitset<N>(str). 
29066: Characters are extracted and stored until any of the following occurs: 
29067: 〞 N characters have been extracted and stored; 
29068: 〞 end-of-file occurs on the input sequence; 
29069: 〞 the next input character is neither is.widen(＊0＊) nor is.widen(＊1＊) (in which case the 
29070: input character is not extracted). 
29071: 6 If no characters are stored in str, calls is.setstate(ios_base::failbit) (which may throw 
29072: ios_base::failure (27.4.4.3)). 
29073: 7 Returns: is. 
29074: template <class charT, class traits, size_t N>
29075: basic_ostream<charT, traits>&
29076: operator<<(basic_ostream<charT, traits>& os, const bitset<N>& x);
29077: 8 Returns: 
29078: os << x.template to_string<charT,traits,allocator<charT> >( 
29079: use_facet<ctype<charT> >(os.getloc()).widen(＊0＊), 
29080: use_facet<ctype<charT> >(os.getloc()).widen(＊1＊)) 
29081: (see 27.6.2.6). 
29082: 20.3 Compile-time rational arithmetic [ratio] 
29083: 1 This subclause describes the ratio library. It provides a class template ratio which exactly represents 
29084: any finite rational number with a numerator and denominator representable by compile-time constants 
29085: of type intmax_t. 
29086: 2 Throughout this subclause, the template argument types R1 and R2 shall be specializations of the 
29087: ratio template. Diagnostic required. 
29088: 3 Header <ratio> synopsis 
29089: ∫ 20.3 545 
29090: 
29091: c
29092: . ISO/IEC N2800=08-0310 
29093: namespace std {
29094: template <intmax_t N, intmax_t D = 1> class ratio;
29095: // ratio arithmetic 
29096: template <class R1, class R2> struct ratio_add;
29097: template <class R1, class R2> struct ratio_subtract;
29098: template <class R1, class R2> struct ratio_multiply;
29099: template <class R1, class R2> struct ratio_divide;
29100: // ratio comparison 
29101: template <class R1, class R2> struct ratio_equal;
29102: template <class R1, class R2> struct ratio_not_equal;
29103: template <class R1, class R2> struct ratio_less;
29104: template <class R1, class R2> struct ratio_less_equal;
29105: template <class R1, class R2> struct ratio_greater;
29106: template <class R1, class R2> struct ratio_greater_equal;
29107: // convenience SI typedefs
29108: typedef ratio<1, 1000000000000000000000000> yocto; // see 20.3.4
29109: typedef ratio<1, 1000000000000000000000> zepto; // see 20.3.4
29110: typedef ratio<1, 1000000000000000000> atto;
29111: typedef ratio<1, 1000000000000000> femto;
29112: typedef ratio<1, 1000000000000> pico;
29113: typedef ratio<1, 1000000000> nano;
29114: typedef ratio<1, 1000000> micro;
29115: typedef ratio<1, 1000> milli;
29116: typedef ratio<1, 100> centi;
29117: typedef ratio<1, 10> deci;
29118: typedef ratio< 10, 1> deca;
29119: typedef ratio< 100, 1> hecto;
29120: typedef ratio< 1000, 1> kilo;
29121: typedef ratio< 1000000, 1> mega;
29122: typedef ratio< 1000000000, 1> giga;
29123: typedef ratio< 1000000000000, 1> tera;
29124: typedef ratio< 1000000000000000, 1> peta;
29125: typedef ratio< 1000000000000000000, 1> exa;
29126: typedef ratio< 1000000000000000000000, 1> zetta; // see 20.3.4
29127: typedef ratio<1000000000000000000000000, 1> yotta; // see 20.3.4
29128: } 
29129: 20.3.1 Class template ratio [ratio.ratio] 
29130: namespace std {
29131: template <intmax_t N, intmax_t D = 1>
29132: class ratio {
29133: public:
29134: static const intmax_t num;
29135: static const intmax_t den;
29136: };
29137: }
29138: 1 The template argument D shall not be zero, and the absolute values of the template arguments N and D 
29139: shall be representable by type intmax_t. Diagnostic required. [ Note: These rules ensure that infinite 
29140: ratios are avoided and that for any negative input, there exists a representable value of its absolute 
29141: ∫ 20.3.1 546 
29142: 
29143: c
29144: . ISO/IEC N2800=08-0310 
29145: value which is positive. In a two＊s complement representation, this excludes the most negative value. 
29146: 〞 end note ] 
29147: 2 The static data members num and den shall have the following values, where gcd represents the greatest 
29148: common divisor of the absolute values of N and D: 
29149: 〞 num shall have the value sign(N) * sign(D) * abs(N) / gcd. 
29150: 〞 den shall have the value abs(D) / gcd. 
29151: 20.3.2 Arithmetic on ratio types [ratio.arithmetic] 
29152: template <class R1, class R2> struct ratio_add {
29153: typedef see below } type;
29154: ; 
29155: 1 The nested typedef type shall be a synonym for ratio<T1, T2> where T1 has the value R1::num 
29156: * R2::den + R2::num * R1::den and T2 has the value R1::den * R2::den. 
29157: template <class R1, class R2> struct ratio_subtract {
29158: typedef see below } type;
29159: ; 
29160: 2 The nested typedef type shall be a synonym for ratio<T1, T2> where T1 has the value R1::num 
29161: * R2::den -R2::num * R1::den and T2 has the value R1::den * R2::den. 
29162: template <class R1, class R2> struct ratio_multiply {
29163: typedef see below } type;
29164: ; 
29165: 3 The nested typedef type shall be a synonym for ratio<T1, T2> where T1 has the value R1::num 
29166: * R2::num and T2 has the value R1::den * R2::den. 
29167: template <class R1, class R2> struct ratio_divide {
29168: typedef see below } type;
29169: ; 
29170: 4 The nested typedef type shall be a synonym for ratio<T1, T2> where T1 has the value R1::num 
29171: * R2::den and T2 has the value R1::den * R2::num. 
29172: 20.3.3 Comparison of ratio types [ratio.comparison] 
29173: template <class R1, class R2> struct ratio_equal
29174: : integral_constant<bool, see below > { };
29175: 1 If R1::num == R2::num and R1::den == R2::den, ratio_equal<R1, R2> shall be derived from 
29176: integral_constant<bool, true>; otherwise it shall be derived from integral_constant<bool, 
29177: false>. 
29178: template <class R1, class R2> struct ratio_not_equal
29179: : integral_constant<bool, !ratio_equal<R1, R2>::value> { };
29180: template <class R1, class R2> struct ratio_less
29181: : integral_constant<bool, see below > { };
29182: 2 If R1::num * R2::den < R2::num * R1::den, ratio_less<R1, R2> shall be derived from 
29183: integral_constant<bool, true>; otherwise it shall be derived from integral_constant<bool, 
29184: ∫ 20.3.3 547 
29185: 
29186: c
29187: . ISO/IEC N2800=08-0310 
29188: false>. Implementations may use other algorithms to compute this relationship to avoid overflow. 
29189: If overflow occurs, a diagnostic is required. 
29190: template <class R1, class R2> struct ratio_less_equal
29191: : integral_constant<bool, !ratio_less<R2, R1>::value> { };
29192: template <class R1, class R2> struct ratio_greater
29193: : integral_constant<bool, ratio_less<R2, R1>::value> { };
29194: template <class R1, class R2> struct ratio_greater_equal
29195: : integral_constant<bool, !ratio_less<R1, R2>::value> { };
29196: 20.3.4 SI types for ratio [ratio.si] 
29197: 1 For each of the typedefs yocto, zepto, zetta, and yotta, if both of the constants used in its speci-
29198: fication are representable by intmax_t, the typedef shall be defined; if either of the constants is not 
29199: representable by intmax_t, the typedef shall not be defined. 
29200: 20.4 Tuples [tuple] 
29201: 20.4.1 In general [tuple.general] 
29202: 1 20.4 describes the tuple library that provides a tuple type as the class template tuple that can be 
29203: instantiated with any number of arguments. Each template argument specifies the type of an element 
29204: in the tuple. Consequently, tuples are heterogeneous, fixed-size collections of values. 
29205: 2 Header <tuple> synopsis 
29206: namespace std { 
29207: // 20.4.2, class template tuple: 
29208: template <VariableType... Types> class tuple; 
29209: // 20.4.2.2, tuple creation functions: 
29210: const unspecified ignore; 
29211: template <MoveConstructible... Types>
29212: tuple<VTypes...> make_tuple(Types&&...);
29213: template<VariableType... Types>
29214: tuple<Types&...> tie(Types&...);
29215: template <CopyConstructible... TTypes, CopyConstructible... UTypes> 
29216: tuple<TTypes..., UTypes...> tuple_cat(const tuple<TTypes...>&, const tuple<UTypes...>&); 
29217: template <MoveConstructible... TTypes, CopyConstructible... UTypes> 
29218: tuple<TTypes..., UTypes...> tuple_cat(tuple<TTypes...>&&, const tuple<UTypes...>&); 
29219: template <CopyConstructible... TTypes, MoveConstructible... UTypes> 
29220: tuple<TTypes..., UTypes...> tuple_cat(const tuple<TTypes...>&, tuple<UTypes...>&&); 
29221: template <MoveConstructible... TTypes, MoveConstructible... UTypes> 
29222: tuple<TTypes..., UTypes...> tuple_cat(tuple<TTypes...>&&, tuple<UTypes...>&&); 
29223: // 20.4.2.3, tuple helper classes:
29224: template <IdentityOf T> class tuple_size; // undefined
29225: template <VariableType... Types> class tuple_size<tuple<Types...> >;
29226: template <size_t I, IdentityOf T> class tuple_element; // undefined
29227: template <size_t I, VariableType... Types>
29228: ∫ 20.4.1 548 
29229: 
29230: . ISO/IEC N2800=08-0310 
29231: requires True<(I < sizeof...(Types))> class tuple_element<I, tuple<Types...> >; 
29232: // 20.4.2.4, element access: 
29233: template <size_t I, VariableType... Types> 
29234: requires True<(I < sizeof...(Types))> 
29235: typename tuple_element<I, tuple<Types...> >::type& get(tuple<Types...>&); 
29236: template <size_t I, VariableType... Types> 
29237: requires True<(I < sizeof...(Types))> 
29238: typename tuple_element<I, tuple<Types...> >::type const& get(const tuple<Types...>&); 
29239: // 20.4.2.5, relational operators: 
29240: template<class... TTypes, class... UTypes>
29241: requires EqualityComparable<TTypes, UTypes>...
29242: bool operator==(const tuple<TTypes...>&, const tuple<UTypes...>&);
29243: template<class... TTypes, class... UTypes>
29244: requires LessThanComparable<TTypes, UTypes>...
29245: bool operator<(const tuple<TTypes...>&, const tuple<UTypes...>&);
29246: template<class... TTypes, class... UTypes>
29247: requires EqualityComparable<TTypes, UTypes>...
29248: bool operator!=(const tuple<TTypes...>&, const tuple<UTypes...>&);
29249: template<class... TTypes, class... UTypes>
29250: requires LessThanComparable<UTypes, TTypes>...
29251: bool operator>(const tuple<TTypes...>&, const tuple<UTypes...>&);
29252: template<class... TTypes, class... UTypes>
29253: requires LessThanComparable<UTypes, TTypes>...
29254: bool operator<=(const tuple<TTypes...>&, const tuple<UTypes...>&);
29255: template<class... TTypes, class... UTypes>
29256: requires LessThanComparable<TTypes, UTypes>...
29257: bool operator>=(const tuple<TTypes...>&, const tuple<UTypes...>&);
29258: // 20.4.2.7, swap: 
29259: template <class... Types>
29260: void swap(tuple<Types...>& x, tuple<Types...>& y);
29261: template <class... Types>
29262: void swap(tuple<Types...>&& x, tuple<Types...>& y);
29263: template <class... Types>
29264: void swap(tuple<Types...>& x, tuple<Types...>&& y);
29265: // 20.4.2.8, range concept maps for tuple: 
29266: template<InputIterator Iter>
29267: concept_map Range<tuple<Iter, Iter> > see below ;
29268: template<InputIterator Iter>
29269: concept_map Range<const tuple<Iter, Iter> > see below ;
29270: } // namespace std
29271: 20.4.2 Class template tuple [tuple.tuple] 
29272: template <VariableType... Types>
29273: class tuple
29274: ∫ 20.4.2 549 
29275: 
29276: c
29277: . ISO/IEC N2800=08-0310 
29278: { 
29279: public:
29280: requires DefaultConstructible<Types>... tuple();
29281: template <class... UTypes>
29282: requires Constructible<Types, UTypes&&>...
29283: explicit tuple(UTypes&&...);
29284: requires CopyConstructible<Types>... tuple(const tuple&); 
29285: template <class... UTypes>
29286: requires Constructible<Types, const UTypes&>...
29287: tuple(const tuple<UTypes...>&);
29288: template <class... UTypes>
29289: requires Constructible<Types, RvalueOf<UTypes>::type>...
29290: tuple(tuple<UTypes...>&&);
29291: template <class... UTypes>
29292: requires Constructible<Types, const UTypes&>...
29293: template <class... UTypes>
29294: requires Constructible<Types, RvalueOf<UTypes>::type>...
29295: // allocator-extended constructors 
29296: template <Allocator Alloc>
29297: requires ConstructibleWithAllocator<Types, Alloc>...
29298: tuple(allocator_arg_t, const Alloc& a);
29299: template <Allocator Alloc, class... UTypes>
29300: requires ConstructibleWithAllocator<Types, Alloc, UTypes&&>...
29301: explicit tuple(allocator_arg_t, const Alloc& a, UTypes&&...);
29302: template <Allocator Alloc, class... UTypes>
29303: requires ConstructibleWithAllocator<Types, Alloc, const UTypes&>...
29304: tuple(allocator_arg_t, const Alloc& a, const tuple<UTypes...>&);
29305: template <Allocator Alloc, class... UTypes> 
29306: requires ConstructibleWithAllocator<Types, Alloc, RvalueOf<UTypes>::type>... 
29307: tuple(allocator_arg_t, const Alloc& a, tuple<UTypes...>&&); 
29308: template <Allocator Alloc, class... UTypes>
29309: requires ConstructibleWithAllocator<Types, Alloc, const UTypes&>...
29310: tuple(allocator_arg_t, const Alloc& a, const pair<UTypes...>&);
29311: template <Allocator Alloc, class... UTypes> 
29312: requires ConstructibleWithAllocator<Types, Alloc, RvalueOf<UTypes>::type>... 
29313: tuple(allocator_arg_t, const Alloc& a, pair<UTypes...>&&); 
29314: requires CopyAssignable<Types>... tuple& operator=(const tuple&); 
29315: template <class... UTypes>
29316: requires HasAssign<Types, const UTypes&>...
29317: tuple& operator=(const tuple<UTypes...>&);
29318: template <class... UTypes>
29319: requires HasAssign<Types, RvalueOf<UTypes>::type>...
29320: tuple& operator=(tuple<UTypes...>&&);
29321: template <class... UTypes>
29322: requires HasAssign<Types, const UTypes&>...
29323: template <class... UTypes>
29324: requires HasAssign<Types, RvalueOf<UTypes>::type>...
29325: ∫ 20.4.2 550 
29326: 
29327: c
29328: . ISO/IEC N2800=08-0310 
29329: void swap(tuple&& rhs);
29330: };
29331: template<class... Types, class Alloc>
29332: concept_map UsesAllocator<tuple<Types...>, Alloc> {
29333: typedef Alloc allocator_type;
29334: }
29335: 20.4.2.1 Construction [tuple.cnstr] 
29336: 1 For each tuple constructor and assignment operator, an exception is thrown only if the construction 
29337: of one of the types in Types throws an exception. 
29338: requires DefaultConstructible<Types>... tuple(); 
29339: 2 Effects: Default initializes each element. 
29340: template <class... UTypes>
29341: requires Constructible<Types, UTypes&&>...
29342: tuple(UTypes&&... u);
29343: 3 Effects: Initializes the elements in the tuple with the corresponding value in std::forward<UTypes 
29344: >(u). 
29345: requires CopyConstructible<Types>... tuple(const tuple& u); 
29346: 4 Effects: Copy constructs each element of *this with the corresponding element of u. 
29347: template <class... UTypes>
29348: requires Constructible<Types, const UTypes&>...
29349: tuple(const tuple<UTypes...>& u);
29350: 5 Effects: Constructs each element of *this with the corresponding element of u. 
29351: template <class... UTypes>
29352: requires Constructible<Types, RvalueOf<UTypes>::type>...
29353: tuple(tuple<UTypes...>&& u);
29354: 6 Effects: Move-constructs each element of *this with the corresponding element of u. 
29355: template <class... UTypes>
29356: requires Constructible<Types, const UTypes&>...
29357: tuple(const pair<UTypes...>&);
29358: 7 Effects: Constructs the first element with u.first and the second element with u.second. 
29359: template <class... UTypes>
29360: requires Constructible<Types, RvalueOf<UTypes>::type>...
29361: tuple(pair<UTypes...>&&);
29362: 8 Effects: Constructs the first element with std::move(u.first) and the second element with 
29363: std::move(u.second). 
29364: requires CopyAssignable<Types>... tuple& operator=(const tuple& u); 
29365: 9 Effects: Assigns each element of u to the corresponding element of *this. 
29366: 10 Returns: *this 
29367: requires MoveAssignable<Types>... tuple& operator=(tuple&& u); 
29368: ∫ 20.4.2.1 551 
29369: 
29370: c
29371: . ISO/IEC N2800=08-0310 
29372: 11 Effects: Move-assigns each element of u to the corresponding element of *this. 
29373: 12 Returns: *this. 
29374: template <class... UTypes>
29375: requires HasAssign<Types, const UTypes&>...
29376: tuple& operator=(const tuple<UTypes...>& u);
29377: 13 Effects: Assigns each element of u to the corresponding element of *this. 
29378: 14 Returns: *this 
29379: template <class... UTypes>
29380: requires HasMoveAssign<Types, RvalueOf<UTypes>::type>...
29381: tuple& operator=(tuple<UTypes...>&& u);
29382: 15 Effects: Move-assigns each element of u to the corresponding element of *this. 
29383: 16 Returns: *this. 
29384: template <class... UTypes>
29385: requires HasAssign<Types, const UTypes&>...
29386: tuple& operator=(const pair<UTypes...>&);
29387: 17 Effects: Assigns u.first to the first element of *this and u.second to the second element of 
29388: *this. 
29389: 18 Returns: *this 
29390: 19 [ Note: There are rare conditions where the converting copy constructor is a better match than 
29391: the element-wise construction, even though the user might intend differently. An example of 
29392: this is if one is constructing a one-element tuple where the element type is another tuple type 
29393: T and if the parameter passed to the constructor is not of type T, but rather a tuple type that 
29394: is convertible to T. The effect of the converting copy construction is most likely the same as the 
29395: effect of the element-wise construction would have been. However, it it possible to compare the 
29396: ※nesting depths§ of the source and target tuples and decide to select the element-wise constructor 
29397: if the source nesting depth is smaller than the target nesting-depth. This can be accomplished 
29398: using an enable_if template or other tools for constrained templates. 〞end note ] 
29399: template <class... UTypes>
29400: requires HasAssign<Types, RvalueOf<UTypes>::type>...
29401: tuple& operator=(pair<UTypes...>&&);
29402: 20 Effects: Assigns std::move(u.first) to the first element of *this and std::move(u.second) 
29403: to the second element of *this. 
29404: 21 Returns: *this. 
29405: template <Allocator Alloc>
29406: requires ConstructibleWithAllocator<Types, Alloc>...
29407: tuple(allocator_arg_t, const Alloc& a);
29408: template <Allocator Alloc, class... UTypes>
29409: requires ConstructibleWithAllocator<Types, Alloc, UTypes&&>...
29410: explicit tuple(allocator_arg_t, const Alloc& a, UTypes&&...);
29411: template <Allocator Alloc, class... UTypes>
29412: requires ConstructibleWithAllocator<Types, Alloc, const UTypes&>...
29413: tuple(allocator_arg_t, const Alloc& a, const tuple<UTypes...>&);
29414: template <Allocator Alloc, class... UTypes> 
29415: requires ConstructibleWithAllocator<Types, Alloc, RvalueOf<UTypes>::type>... 
29416: ∫ 20.4.2.1 552 
29417: 
29418: c
29419: . ISO/IEC N2800=08-0310 
29420: tuple(allocator_arg_t, const Alloc& a, tuple<UTypes...>&&); 
29421: template <Allocator Alloc, class... UTypes>
29422: requires ConstructibleWithAllocator<Types, Alloc, const UTypes&>...
29423: tuple(allocator_arg_t, const Alloc& a, const pair<UTypes...>&);
29424: template <Allocator Alloc, class... UTypes> 
29425: requires ConstructibleWithAllocator<Types, Alloc, RvalueOf<UTypes>::type>... 
29426: tuple(allocator_arg_t, const Alloc& a, pair<UTypes...>&&); 
29427: 22 Effects: Equivalent to the preceding constructors except that the allocator argument is passed 
29428: conditionally to the constructor of each element. Each member is allocator constructed (20.7.2.2) 
29429: with a. 
29430: 20.4.2.2 Tuple creation functions [tuple.creation] 
29431: template<MoveConstructible... Types>
29432: tuple<VTypes...> make_tuple(Types&&... t);
29433: 1 Let Ui be decay<Ti>::type for each Ti in Types. Then each Vi in VTypes is X& if Ui equals 
29434: reference_wrapper<X>, otherwise Vi is Ui. 
29435: 2 Returns: tuple<VTypes...>(std::forward<Types>(t)...). 
29436: 3 [ Example: 
29437: int i; float j;
29438: make_tuple(1, ref(i), cref(j))
29439: creates a tuple of type 
29440: tuple<int, int&, const float&> 
29441: 〞end example ] 
29442: template<VariableType... Types>
29443: tuple<Types&...> tie(Types&... t);
29444: 4 Returns: tuple<Types&>(t...). When an argument in t is ignore, assigning any value to the 
29445: corresponding tuple element has no effect. 
29446: 5 [ Example: tie functions allow one to create tuples that unpack tuples into variables. ignore can 
29447: be used for elements that are not needed: 
29448: int i; std::string s;
29449: tie(i, ignore, s) = make_tuple(42, 3.14, "C++");
29450: // i == 42, s == "C++"
29451: 〞end example ] 
29452: template <CopyConstructible... TTypes, CopyConstructible... UTypes> 
29453: tuple<TTypes..., UTypes...> tuple_cat(const tuple<TTypes...>& t, const tuple<UTypes...>& u); 
29454: template <MoveConstructible... TTypes, CopyConstructible... UTypes> 
29455: tuple<TTypes..., UTypes...> tuple_cat(tuple<TTypes...>&& t, const tuple<UTypes...>& u); 
29456: template <CopyConstructible... TTypes, MoveConstructible... UTypes> 
29457: tuple<TTypes..., UTypes...> tuple_cat(const tuple<TTypes...>& t, tuple<UTypes...>&& u); 
29458: template <MoveConstructible... TTypes, MoveConstructible... UTypes> 
29459: tuple<TTypes..., UTypes...> tuple_cat(tuple<TTypes...>&& t, tuple<UTypes...>&& u); 
29460: ∫ 20.4.2.2 553 
29461: 
29462: c
29463: . ISO/IEC N2800=08-0310 
29464: 6 Returns: A tuple object constructed by copy-or move-constructing its first sizeof...(TTypes) 
29465: elements from the corresponding elements of t and copy-or move-constructing its last sizeof... 
29466: (UTypes) elements from the corresponding elements of u. 
29467: 20.4.2.3 Tuple helper classes [tuple.helper] 
29468: template <class... Types>
29469: class tuple_size<tuple<Types...> >
29470: : public integral_constant<size_t, sizeof...(Types)> { };
29471: template <size_t I, class... Types>
29472: requires True<(I < sizeof...(Types))>
29473: class tuple_element<I, tuple<Types...> > {
29474: public:
29475: typedef TI type;
29476: };
29477: 1 Type: TI is the type of the Ith element of Types, where indexing is zero-based. 
29478: 20.4.2.4 Element access [tuple.elem] 
29479: template <size_t I, VariableType... Types>
29480: requires True<(I < sizeof...(Types))>
29481: typename tuple_element<I, tuple<Types...> >::type& get(tuple<Types...>& t);
29482: 1 Returns: A reference to the Ith element of t, where indexing is zero-based. 
29483: template <size_t I, VariableType... Types> 
29484: requires True<(I < sizeof...(Types))> 
29485: typename tuple_element<I, tuple<Types...> >::type const& get(const tuple<Types...>& t); 
29486: 2 Returns: A const reference to the Ith element of t, where indexing is zero-based. 
29487: 3 [ Note: Constness is shallow. If a T in Types is some reference type X&, the return type is X&, 
29488: not const X&. However, if the element type is non-reference type T, the return type is const T&. 
29489: This is consistent with how constness is defined to work for member variables of reference type. 
29490: 〞end note ]] 
29491: 4 [ Note: The reason get is a nonmember function is that if this functionality had been provided as 
29492: a member function, code where the type depended on a template parameter would have required 
29493: using the template keyword. 〞end note ] 
29494: 20.4.2.5 Relational operators [tuple.rel] 
29495: template<class... TTypes, class... UTypes>
29496: requires EqualityComparable<TTypes, UTypes>...
29497: bool operator==(const tuple<TTypes...>& t, const tuple<UTypes...>& u);
29498: 1 Returns: true iff get<i>(t) == get<i>(u) for all i. For any two zero-length tuples e and f, e 
29499: == f returns true. 
29500: 2 Effects: The elementary comparisons are performed in order from the zeroth index upwards. No 
29501: comparisons or element accesses are performed after the first equality comparison that evaluates 
29502: to false. 
29503: ∫ 20.4.2.5 554 
29504: 
29505: c
29506: . ISO/IEC N2800=08-0310 
29507: template<class... TTypes, class... UTypes>
29508: requires LessThanComparable<TTypes, UTypes>...
29509: bool operator<(const tuple<TTypes...>& t, const tuple<UTypes...>& u);
29510: 3 Returns: The result of a lexicographical comparison between t and u. The result is defined as: 
29511: (bool)(get<0>(t) < get<0>(u)) || (!(bool)(get<0>(u) < get<0>(t)) && ttail <utail), where 
29512: rtail for some tuple r is a tuple containing all but the first element of r. For any two zero-length 
29513: tuples e and f, e<f returns false. 
29514: template<class... TTypes, class... UTypes>
29515: requires EqualityComparable<TTypes, UTypes>...
29516: bool operator!=(const tuple<TTypes...>& t, const tuple<UTypes...>& u);
29517: 4 Returns: !(t == u). 
29518: template<class... TTypes, class... UTypes>
29519: requires LessThanComparable<UTypes, TTypes>...
29520: bool operator>(const tuple<TTypes...>& t, const tuple<UTypes...>& u);
29521: 5 Returns: u<t. 
29522: template<class... TTypes, class... UTypes>
29523: requires LessThanComparable<UTypes, TTypes>...
29524: bool operator<=(const tuple<TTypes...>& t, const tuple<UTypes...>& u);
29525: 6 Returns: !(u < t) 
29526: template<class... TTypes, class... UTypes>
29527: requires LessThanComparable<TTypes, UTypes>...
29528: bool operator>=(const tuple<TTypes...>& t, const tuple<UTypes...>& u);
29529: 7 Returns: !(t < u) 
29530: 8 [ Note: The above definitions for comparison operators do not require ttail (or utail) to be constructed. 
29531: It may not even be possible, as t and u are not required to be copy constructible. Also, all compar-
29532: ison operators are short circuited; they do not perform element accesses beyond what is required to 
29533: determine the result of the comparison. 〞end note ] 
29534: 20.4.2.6 Tuple swap [tuple.swap] 
29535: void swap(tuple&& rhs); 
29536: 1 Requires: each type in Types shall be Swappable.
29537: 2 Effects: calls swap for each element in *this and its corresponding element in rhs.
29538: 3 Throws: nothing, unless one of the element-wise swap calls throws an exception.
29539: 20.4.2.7 Tuple specialized algorithms [tuple.special] 
29540: template <class... Types>
29541: void swap(tuple<Types...>& x, tuple<Types...>& y);
29542: template <class... Types>
29543: void swap(tuple<Types...>&& x, tuple<Types...>& y);
29544: template <class... Types>
29545: void swap(tuple<Types...>& x, tuple<Types...>&& y);
29546: 1 Effects: x.swap(y) 
29547: ∫ 20.4.2.7 555 
29548: 
29549: c
29550: . ISO/IEC N2800=08-0310 
29551: 20.4.2.8 Range concept maps for tuple [tuple.concepts] 
29552: template<InputIterator Iter> 
29553: concept_map Range<tuple<Iter, Iter> > {
29554: typedef Iter iterator;
29555: Iter begin(tuple<Iter, Iter>& p) { return std::get<0>(p); }
29556: Iter end(tuple<Iter, Iter>& p) { return std::get<1>(p); }
29557: } 
29558: template<InputIterator Iter> 
29559: concept_map Range<const tuple<Iter, Iter> > {
29560: typedef Iter iterator;
29561: Iter begin(const tuple<Iter, Iter>& p) { return std::get<0>(p); }
29562: Iter end(const tuple<Iter, Iter>& p) { return std::get<1>(p); }
29563: } 
29564: 1 Note: these concept maps adapt a tuple object that holds two iterators to the Range concept. 
29565: 20.5 Metaprogramming and type traits [meta] 
29566: 1 This subclause describes components used by C++ programs, particularly in templates, to support 
29567: the widest possible range of types, optimise template code usage, detect type related user errors, and 
29568: perform type inference and transformation at compile time. It includes type classification traits, type 
29569: property inspection traits, and type transformations. The type classification traits describe a complete 
29570: taxonomy of all possible C++ types, and state where in that taxonomy a given type belongs. The type 
29571: property inspection traits allow important characteristics of types or of combinations of types to be 
29572: inspected. The type transformations allow certain properties of types to be manipulated. 
29573: 20.5.1 Requirements [meta.rqmts] 
29574: 1 A UnaryTypeTrait describes a property of a type. It shall be a class template that takes one template 
29575: type argument and, optionally, additional arguments that help define the property being described. 
29576: It shall be DefaultConstructible, CopyConstructible, and publicly derived, directly or indirectly, 
29577: from a specialization of the template integral_constant (20.5.3), with the arguments to the template 
29578: integral_constant determined by the requirements for the particular property being described. 
29579: 2 A BinaryTypeTrait describes a relationship between two types. It shall be a class template that takes 
29580: two template type arguments and, optionally, additional arguments that help define the relationship 
29581: being described. It shall be DefaultConstructible, CopyConstructible, and publicly derived, di-
29582: rectly or indirectly, from an instance of the template integral_constant (20.5.3), with the arguments 
29583: to the template integral_constant determined by the requirements for the particular relationship 
29584: being described. 
29585: 3 A TransformationTrait modifies a property of a type. It shall be a class template that takes one 
29586: template type argument and, optionally, additional arguments that help define the modification. It 
29587: shall define a nested type named type, which shall be a synonym for the modified type. 
29588: 20.5.2 Header <type_traits> synopsis [meta.type.synop] 
29589: namespace std { 
29590: // 20.5.3, helper class: 
29591: template <class T, T v> struct integral_constant;
29592: typedef integral_constant<bool, true> true_type;
29593: typedef integral_constant<bool, false> false_type;
29594: ∫ 20.5.2 556 
29595: 
29596: c
29597: . ISO/IEC N2800=08-0310 
29598: // 20.5.4.1, primary type categories: 
29599: template <class T> struct is_void;
29600: template <class T> struct is_integral;
29601: template <class T> struct is_floating_point;
29602: template <class T> struct is_array;
29603: template <class T> struct is_pointer;
29604: template <class T> struct is_lvalue_reference;
29605: template <class T> struct is_rvalue_reference;
29606: template <class T> struct is_member_object_pointer;
29607: template <class T> struct is_member_function_pointer;
29608: template <class T> struct is_enum;
29609: template <class T> struct is_union;
29610: template <class T> struct is_class;
29611: template <class T> struct is_function;
29612: // 20.5.4.2, composite type categories: 
29613: template <class T> struct is_reference;
29614: template <class T> struct is_arithmetic;
29615: template <class T> struct is_fundamental;
29616: template <class T> struct is_object;
29617: template <class T> struct is_scalar;
29618: template <class T> struct is_compound;
29619: template <class T> struct is_member_pointer;
29620: // 20.5.4.3, type properties: 
29621: template <class T> struct is_const;
29622: template <class T> struct is_volatile;
29623: template <class T> struct is_trivial;
29624: template <class T> struct is_standard_layout;
29625: template <class T> struct is_pod;
29626: template <class T> struct is_empty;
29627: template <class T> struct is_polymorphic;
29628: template <class T> struct is_abstract;
29629: template <class T> struct has_trivial_default_constructor;
29630: template <class T> struct has_trivial_copy_constructor;
29631: template <class T> struct has_trivial_assign;
29632: template <class T> struct has_trivial_destructor;
29633: template <class T> struct has_nothrow_default_constructor;
29634: template <class T> struct has_nothrow_copy_constructor;
29635: template <class T> struct has_nothrow_assign;
29636: template <class T> struct has_virtual_destructor;
29637: template <class T> struct is_signed;
29638: template <class T> struct is_unsigned;
29639: template <class T> struct alignment_of;
29640: template <class T> struct rank;
29641: template <class T, unsigned I = 0> struct extent;
29642: // 20.5.5, type relations: 
29643: template <class T, class U> struct is_same;
29644: template <class Base, class Derived> struct is_base_of;
29645: template <class From, class To> struct is_convertible;
29646: // 20.5.6.1, const-volatile modifications: 
29647: template <class T> struct remove_const;
29648: template <class T> struct remove_volatile;
29649: ∫ 20.5.2 557 
29650: 
29651: c
29652: . ISO/IEC N2800=08-0310 
29653: template <class T> struct remove_cv;
29654: template <class T> struct add_const;
29655: template <class T> struct add_volatile;
29656: template <class T> struct add_cv;
29657: // 20.5.6.2, reference modifications: 
29658: template <class T> struct remove_reference;
29659: template <class T> struct add_lvalue_reference;
29660: template <class T> struct add_rvalue_reference;
29661: // 20.5.6.3, sign modifications: 
29662: template <class T> struct make_signed;
29663: template <class T> struct make_unsigned;
29664: // 20.5.6.4, array modifications: 
29665: template <class T> struct remove_extent;
29666: template <class T> struct remove_all_extents;
29667: // 20.5.6.5, pointer modifications: 
29668: template <class T> struct remove_pointer;
29669: template <class T> struct add_pointer;
29670: // 20.5.7, other transformations: 
29671: template <std::size_t Len, std::size_t Align> struct aligned_storage;
29672: template <std::size_t Len, class... Types> struct aligned_union;
29673: template <class T> struct decay;
29674: template <bool, class T = void> struct enable_if;
29675: template <bool, class T, class F> struct conditional;
29676: template <class... T> struct common_type;
29677: } // namespace std 
29678: 1 The behavior of a program that adds specializations for any of the class templates defined in this 
29679: subclause is undefined unless otherwise specified. 
29680: 20.5.3 Helper classes [meta.help] 
29681: namespace std {
29682: template <class T, T v>
29683: struct integral_constant {
29684: static const T value = v;
29685: typedef T value_type;
29686: typedef integral_constant<T,v> type;
29687: };
29688: typedef integral_constant<bool, true> true_type;
29689: typedef integral_constant<bool, false> false_type;
29690: } 
29691: 1 The class template integral_constant and its associated typedefs true_type and false_type are 
29692: used as base classes to define the interface for various type traits. 
29693: 20.5.4 Unary Type Traits [meta.unary] 
29694: 1 This sub-clause contains templates that may be used to query the properties of a type at compile time. 
29695: ∫ 20.5.4 558 
29696: 
29697: c
29698: . ISO/IEC N2800=08-0310 
29699: 2 Each of these templates shall be a UnaryTypeTrait (20.5.1), publicly derived directly or indirectly from 
29700: true_type if the corresponding condition is true, otherwise from false_type. 
29701: 20.5.4.1 Primary Type Categories [meta.unary.cat] 
29702: 1 The primary type categories correspond to the descriptions given in section 3.9 of the C++ standard. 
29703: 2 For any given type T, the result of applying one of these templates to T and to cv-qualified T shall yield 
29704: the same result. 
29705: 3 [ Note: For any given type T, exactly one of the primary type categories has a value member that 
29706: evaluates to true. 〞end note ] 
29707: Table 31 〞 Primary type category predicates 
29708: Template Condition Comments 
29709: template <class T> 
29710: struct is_void; 
29711: T is void 
29712: template <class T> T is an integral type (3.9.1) 
29713: struct is_integral; 
29714: template <class T> T is a floating point 
29715: struct is_floating_point; type (3.9.1) 
29716: template <class T> 
29717: struct is_array; 
29718: T is an array type (3.9.2) of 
29719: known or unknown extent 
29720: Class template 
29721: array (23.2.1) is not an 
29722: array type. 
29723: template <class T> T is a pointer type (3.9.2) Includes pointers to 
29724: struct is_pointer; functions but not pointers 
29725: to non-static members. 
29726: template <class T> 
29727: struct is_lvalue_reference; 
29728: T is an lvalue reference 
29729: type (8.3.2) 
29730: template <class T> 
29731: struct is_rvalue_reference; 
29732: T is an rvalue reference 
29733: type (8.3.2) 
29734: template <class T> 
29735: struct is_member_object_pointer; 
29736: T is a pointer to non-static 
29737: data member 
29738: template <class T> T is a pointer to non-static 
29739: struct member function 
29740: is_member_function_pointer; 
29741: template <class T> 
29742: struct is_enum; 
29743: T is an enumeration 
29744: type (3.9.2) 
29745: template <class T> T is a union type (3.9.2) 
29746: struct is_union; 
29747: template <class T> T is a class type but not a 
29748: struct is_class; union type (3.9.2) 
29749: template <class T> T is a function type (3.9.2) 
29750: struct is_function; 
29751: 20.5.4.2 Composite type traits [meta.unary.comp] 
29752: 1 These templates provide convenient compositions of the primary type categories, corresponding to the 
29753: descriptions given in section 3.9. 
29754: ∫ 20.5.4.2 559 
29755: 
29756: c
29757: . ISO/IEC N2800=08-0310 
29758: 2 For any given type T, the result of applying one of these templates to T, and to cv-qualified T shall 
29759: yield the same result. 
29760: Table 32 〞 Composite type category predicates 
29761: Template Condition Comments 
29762: template <class T> 
29763: struct is_reference; 
29764: T is an lvalue reference or 
29765: an rvalue reference 
29766: template <class T> 
29767: struct is_arithmetic; 
29768: T is an arithmetic 
29769: type (3.9.1) 
29770: template <class T> 
29771: struct is_fundamental; 
29772: T is a fundamental 
29773: type (3.9.1) 
29774: template <class T> T is an object type (3.9) 
29775: struct is_object; 
29776: template <class T> T is a scalar type (3.9) 
29777: struct is_scalar; 
29778: template <class T> T is a compound 
29779: struct is_compound; type (3.9.2) 
29780: template <class T> 
29781: struct is_member_pointer; 
29782: T is a pointer to non-static 
29783: data member or non-static 
29784: member function 
29785: 20.5.4.3 Type properties [meta.unary.prop] 
29786: 1 These templates provide access to some of the more important properties of types. 
29787: 2 It is unspecified whether the library defines any full or partial specialisations of any of these templates. 
29788: 3 For all of the class templates X declared in this Clause, instantiating that template with a template-
29789: argument that is a class template specialization may result in the implicit instantiation of the template 
29790: argument if and only if the semantics of X require that the argument must be a complete type. 
29791: Table 33 〞 Type property predicates 
29792: Template Condition Preconditions 
29793: template <class T> T is const-qualified (3.9.3) 
29794: struct is_const; 
29795: template <class T> 
29796: struct is_volatile; 
29797: T is 
29798: volatile-qualified (3.9.3) 
29799: template <class T> 
29800: struct is_trivial; 
29801: T is a trivial type (3.9) T shall be a complete type, 
29802: an array of unknown 
29803: bound, or (possibly 
29804: cv-qualified) void. 
29805: template <class T> 
29806: struct is_standard_layout; 
29807: T is a standard-layout 
29808: type (3.9) 
29809: T shall be a complete type, 
29810: an array of unknown 
29811: bound, or (possibly 
29812: cv-qualified) void. 
29813: template <class T> T is a POD type (3.9) T shall be a complete type, 
29814: struct is_pod; an array of unknown 
29815: bound, or (possibly 
29816: cv-qualified) void. 
29817: ∫ 20.5.4.3 560 
29818: 
29819: . ISO/IEC N2800=08-0310 
29820: Table 33 〞 Type property predicates (continued) 
29821: Template Condition Preconditions 
29822: template <class T> 
29823: struct is_empty; 
29824: T is a class type, but not a 
29825: union type, with no 
29826: non-static data members 
29827: other than bit-fields of 
29828: length 0, no virtual 
29829: member functions, no 
29830: T shall be a complete type, 
29831: an array of unknown 
29832: bound, or (possibly 
29833: cv-qualified) void. 
29834: virtual base classes, and 
29835: no base class B for which 
29836: is_empty<B>::value is 
29837: false. 
29838: template <class T> 
29839: struct is_polymorphic; 
29840: T is a polymorphic 
29841: class (10.3) 
29842: T shall be a complete type, 
29843: an array of unknown 
29844: bound, or (possibly 
29845: cv-qualified) void. 
29846: template <class T> 
29847: struct is_abstract; 
29848: T is an abstract 
29849: class (10.4) 
29850: T shall be a complete type, 
29851: an array of unknown 
29852: bound, or (possibly 
29853: cv-qualified) void. 
29854: template <class T> 
29855: struct 
29856: has_trivial_default_constructor; 
29857: T is a trivial type (3.9) or 
29858: a class type with a trivial 
29859: default constructor (12.1) 
29860: or an array of such a class 
29861: T shall be a complete type, 
29862: an array of unknown 
29863: bound, or (possibly 
29864: cv-qualified) void. 
29865: type. 
29866: template <class T> 
29867: struct 
29868: has_trivial_copy_constructor; 
29869: T is a trivial type (3.9) or 
29870: a reference type or a class 
29871: type whose copy 
29872: constructors (12.8) are all 
29873: trivial. 
29874: T shall be a complete type, 
29875: an array of unknown 
29876: bound, or (possibly 
29877: cv-qualified) void. 
29878: template <class T> 
29879: struct has_trivial_assign; 
29880: T is neither const nor a 
29881: reference type, and T is a 
29882: trivial type (3.9) or a class 
29883: type whose copy 
29884: assignment 
29885: operators (12.8) are all 
29886: trivial. 
29887: T shall be a complete type, 
29888: an array of unknown 
29889: bound, or (possibly 
29890: cv-qualified) void. 
29891: template <class T> 
29892: struct has_trivial_destructor; 
29893: T is a trivial type (3.9) or 
29894: a reference type or a class 
29895: type with a trivial 
29896: destructor (12.4) or an 
29897: array of such a class type. 
29898: T shall be a complete type, 
29899: an array of unknown 
29900: bound, or (possibly 
29901: cv-qualified) void. 
29902: template <class T> 
29903: struct 
29904: has_nothrow_default_constructor; 
29905: has_trivial_default_-
29906: constructor<T>::value 
29907: is true or T is a class type 
29908: with a default constructor 
29909: that is known not to throw 
29910: any exceptions or T is an 
29911: array of such a class type. 
29912: T shall be a complete type, 
29913: an array of unknown 
29914: bound, or (possibly 
29915: cv-qualified) void. 
29916: ∫ 20.5.4.3 561 
29917: 
29918: . ISO/IEC N2800=08-0310 
29919: Table 33 〞 Type property predicates (continued) 
29920: Template Condition Preconditions 
29921: template <class T> 
29922: struct 
29923: has_nothrow_copy_constructor; 
29924: has_trivial_copy_-
29925: constructor<T>::value 
29926: is true or T is a class type 
29927: whose copy constructors 
29928: are all known not to throw 
29929: any exceptions or T is an 
29930: array of such a class type. 
29931: T shall be a complete type, 
29932: an array of unknown 
29933: bound, or (possibly 
29934: cv-qualified) void. 
29935: template <class T> 
29936: struct has_nothrow_assign; 
29937: T is neither const nor a 
29938: reference type, and 
29939: has_trivial_-
29940: assign<T>::value is true 
29941: or T is a class type whose 
29942: copy assignment operators 
29943: taking an lvalue of type T 
29944: are all known not to throw 
29945: any exceptions or T is an 
29946: array of such a class type. 
29947: T shall be a complete type, 
29948: an array of unknown 
29949: bound, or (possibly 
29950: cv-qualified) void. 
29951: template <class T> 
29952: struct has_virtual_destructor; 
29953: T has a virtual 
29954: destructor (12.4) 
29955: T shall be a complete type, 
29956: an array of unknown 
29957: bound, or (possibly 
29958: cv-qualified) void. 
29959: template <class T> is_-
29960: struct is_signed; arithmetic<T>::value 
29961: && T(-1) < T(0) 
29962: template <class T> is_-
29963: struct is_unsigned; arithmetic<T>::value 
29964: && T(0) < T(-1) 
29965: 4 [ Example: 
29966: is_const<const volatile int>::value 
29967: is_const<const int*>::value 
29968: is_const<const int&>::value 
29969: is_const<int[3]>::value 
29970: is_const<const int[3]>::value 
29971: // true 
29972: // false 
29973: // false 
29974: // false 
29975: // true 
29976: 〞 end example ] 
29977: 5 [ Example: 
29978: remove_const<const volatile int>::type 
29979: remove_const<const int* const>::type 
29980: remove_const<const int&>::type 
29981: remove_const<const int[3]>::type 
29982: // volatile int 
29983: // const int* 
29984: // const int& 
29985: // int[3] 
29986: 〞 end example ] 
29987: ∫ 20.5.4.3 562 
29988: 
29989: . ISO/IEC N2800=08-0310 
29990: Table 34 〞 Type property queries 
29991: Template Value 
29992: template <class T> 
29993: struct alignment_of; 
29994: alignof(T). 
29995: Precondition:T shall be a complete type, a reference type, or an array of 
29996: unknown bound, but shall not be a function type or (possibly 
29997: cv-qualified) void. 
29998: template <class T> If T names an array type, an integer value representing the number of 
29999: struct rank; dimensions of T; otherwise, 0. 
30000: template <class T, If T is not an array type (8.3.4), or if it has rank less than I, or if I is 0 
30001: unsigned I = 0> and T has type ※array of unknown bound of U§, then 0; otherwise, the 
30002: struct extent; size of the I＊th dimension of T 
30003: 6 [ Example: 
30004: // the following assertions hold: 
30005: assert(rank<int>::value == 0);
30006: assert(rank<int[2]>::value == 1);
30007: assert(rank<int[][4]>::value == 2);
30008: 〞end example ] 
30009: 7 [ Example: 
30010: // the following assertions hold: 
30011: assert(extent<int>::value == 0);
30012: assert(extent<int[2]>::value == 2);
30013: assert(extent<int[2][4]>::value == 2);
30014: assert(extent<int[][4]>::value == 0);
30015: assert((extent<int, 1>::value) == 0);
30016: assert((extent<int[2], 1>::value) == 0);
30017: assert((extent<int[2][4], 1>::value) == 4);
30018: assert((extent<int[][4], 1>::value) == 4);
30019: 〞end example ] 
30020: 20.5.5 Relationships between types [meta.rel] 
30021: 1 This sub-clause contains templates that may be used to query relationships between types at compile 
30022: time. 
30023: 2 Each of these templates shall be a BinaryTypeTrait (20.5.1), publicly derived directly or indirectly 
30024: from true_type if the corresponding condition is true, otherwise from false_type. 
30025: Table 35 〞 Type relationship predicates 
30026: Template Condition Comments 
30027: template <class T, class U> T and U name the same 
30028: struct is_same; type with the same 
30029: cv-qualifications 
30030: ∫ 20.5.5 563 
30031: 
30032: . ISO/IEC N2800=08-0310 
30033: Table 35 〞 Type relationship predicates (continued) 
30034: Template Condition Comments 
30035: template <class Base, class 
30036: Derived> 
30037: struct is_base_of; 
30038: Base is a base class of 
30039: Derived (10) without 
30040: regard to cv-qualifiers 
30041: or Base and Derived 
30042: are not unions and 
30043: name the same class 
30044: type without regard to 
30045: cv-qualifiers 
30046: If Base and Derived are class 
30047: types and are different types 
30048: (ignoring possible cv-qualifiers) 
30049: then Derived shall be a complete 
30050: type. [ Note: Base classes that 
30051: are private, protected, or 
30052: ambigious are, nonetheless, base 
30053: classes. 〞 end note ] 
30054: template <class From, class To> 
30055: struct is_convertible; 
30056: The code set out below 
30057: shall be well formed. 
30058: From and To shall be complete 
30059: types, arrays of unknown bound, 
30060: or (possibly cv-qualified) void 
30061: types. 
30062: 3 [ Example: 
30063: struct B {};
30064: struct B1 : B {};
30065: struct B2 : B {};
30066: struct D : private B1, private B2 {};
30067: is_base_of<B, D>::value // true
30068: is_base_of<const B, D>::value // true
30069: is_base_of<B, const D>::value // true
30070: is_base_of<B, const B>::value // true
30071: is_base_of<D, B>::value // false
30072: is_base_of<B&, D&>::value // false
30073: is_base_of<B[3], D[3]>::value // false
30074: is_base_of<int, int>::value // false
30075: 〞end example ] 
30076: 4 In order to instantiate the template is_convertible<From, To>, the following code shall be well 
30077: formed: 
30078: template <class T>
30079: typename add_rvalue_reference<T>::type create();
30080: To test() {
30081: return create<From>();
30082: }
30083: [ Note: This requirement gives well defined results for reference types, void types, array types, and 
30084: function types. 〞end note ] 
30085: 20.5.6 Transformations between types [meta.trans] 
30086: 1 This sub-clause contains templates that may be used to transform one type to another following some 
30087: predefined rule. 
30088: 2 Each of the templates in this subclause shall be a TransformationTrait (20.5.1). 
30089: 20.5.6.1 Const-volatile modifications [meta.trans.cv] 
30090: ∫ 20.5.6.1 564 
30091: 
30092: . ISO/IEC N2800=08-0310 
30093: Table 36 〞 Const-volatile modifications 
30094: Template Comments 
30095: template <class T> 
30096: struct remove_const; 
30097: The member typedef type shall name the same type as T except that 
30098: any top-level const-qualifier has been removed. 
30099: [ Example:remove_const<const volatile int>::type evaluates to 
30100: volatile int, whereas remove_const<const int*> is const int*. 
30101: 〞 end example ] 
30102: template <class T> 
30103: struct remove_volatile; 
30104: The member typedef type shall name the same type as T except that 
30105: any top-level volatile-qualifier has been removed. 
30106: [ Example:remove_volatile<const volatile int>::type evaluates to 
30107: const int, whereas remove_volatile<volatile int*> is volatile 
30108: int*. 〞 end example ] 
30109: template <class T> 
30110: struct remove_cv; 
30111: The member typedef type shall be the same as T except that any 
30112: top-level cv-qualifier has been removed. [ Example:remove_cv<const 
30113: volatile int>::type evaluates to int, whereas remove_cv<const 
30114: volatile int*> is const volatile int*. 〞 end example ] 
30115: template <class T> If T is a reference, function, or top-level const-qualified type, then type 
30116: struct add_const; shall name the same type as T, otherwise T const. 
30117: template <class T> If T is a reference, function, or top-level volatile-qualified type, then 
30118: struct add_volatile; type shall name the same type as T, otherwise T volatile. 
30119: template <class T> The member typedef type shall name the same type as 
30120: struct add_cv; add_const<typename add_volatile<T>::type>::type. 
30121: 20.5.6.2 Reference modifications [meta.trans.ref] 
30122: Table 37 〞 Reference modifications 
30123: Template Comments 
30124: template <class T> If T has type ※reference to T1§ then the member typedef type shall 
30125: struct remove_reference; name T1; otherwise, type shall name T. 
30126: template <class T> 
30127: struct 
30128: add_lvalue_reference; 
30129: template <class T> 
30130: struct 
30131: add_rvalue_reference 
30132: If T names an object or function type then the member typedef type 
30133: shall name T&; otherwise, if T names a type ※rvalue reference to T1§ then 
30134: the member typedef type shall name T1&; otherwise, type shall name T. 
30135: If T names an object or function type then the member typedef type 
30136: shall name T&&; otherwise, type shall name T. [ Note: This rule reflects 
30137: the semantics of reference collapsing. For example, when a type T names 
30138: a type T1&, the type add_rvalue_reference<T>::type is not an rvalue 
30139: reference. 〞 end note ] 
30140: 20.5.6.3 Sign modifications [meta.trans.sign] 
30141: ∫ 20.5.6.3 565 
30142: 
30143: . ISO/IEC N2800=08-0310 
30144: Table 38 〞 Sign modifications 
30145: Template Comments 
30146: template <class T> If T names a (possibly cv-qualified) signed integral type (3.9.1) then the 
30147: struct make_signed; member typedef type shall name the type T; otherwise, if T names a 
30148: (possibly cv-qualified) unsigned integral type then type shall name the 
30149: corresponding signed integral type, with the same cv-qualifiers as T; 
30150: otherwise, type shall name the signed integral type with smallest 
30151: rank (4.13) for which sizeof(T) == sizeof(type), with the same 
30152: cv-qualifiers as T. 
30153: Requires:T shall be a (possibly cv-qualified) integral type or enumeration 
30154: but not a bool type. 
30155: template <class T> If T names a (possibly cv-qualified) unsigned integral type (3.9.1) then 
30156: struct make_unsigned; the member typedef type shall name the type T; otherwise, if T names a 
30157: (possibly cv-qualified) signed integral type then type shall name the 
30158: corresponding unsigned integral type, with the same cv-qualifiers as T; 
30159: otherwise, type shall name the unsigned integral type with smallest 
30160: rank (4.13) for which sizeof(T) == sizeof(type), with the same 
30161: cv-qualifiers as T. 
30162: Requires:T shall be a (possibly cv-qualified) integral type or enumeration 
30163: but not a bool type. 
30164: 20.5.6.4 Array modifications [meta.trans.arr] 
30165: Table 39 〞 Array modifications 
30166: Template Comments 
30167: template <class T> 
30168: struct remove_extent; 
30169: If T names a type ※array of U§, the member typedef type shall be U, 
30170: otherwise T. [ Note: For multidimensional arrays, only the first array 
30171: dimension is removed. For a type ※array of const U§, the resulting type 
30172: is const U. 〞 end note ] 
30173: template <class T> If T is ※multi-dimensional array of U§, the resulting member typedef 
30174: struct remove_all_extents; type is U, otherwise T. 
30175: 1 [Example 
30176: // the following assertions hold: 
30177: assert((is_same<remove_extent<int>::type, int>::value)); 
30178: assert((is_same<remove_extent<int[2]>::type, int>::value)); 
30179: assert((is_same<remove_extent<int[2][3]>::type, int[3]>::value)); 
30180: assert((is_same<remove_extent<int[][3]>::type, int[3]>::value)); 
30181: 〞 end example ] 
30182: 2 [Example 
30183: // the following assertions hold: 
30184: assert((is_same<remove_all_extents<int>::type, int>::value)); 
30185: assert((is_same<remove_all_extents<int[2]>::type, int>::value)); 
30186: assert((is_same<remove_all_extents<int[2][3]>::type, int>::value)); 
30187: assert((is_same<remove_all_extents<int[][3]>::type, int>::value)); 
30188: ∫ 20.5.6.4 566 
30189: 
30190: c. ISO/IEC N2800=08-0310 
30191: 〞 end example ] 
30192: 20.5.6.5 Pointer modifications [meta.trans.ptr] 
30193: Table 40 〞 Pointer modifications 
30194: Template Comments 
30195: template <class T> If T has type ※(possibly cv-qualified) pointer to T1§ then the member 
30196: struct remove_pointer; typedef type shall name T1; otherwise, it shall name T. 
30197: template <class T> The member typedef type shall name the same type as 
30198: struct add_pointer; remove_reference<T>::type*. 
30199: 20.5.7 Other transformations [meta.trans.other] 
30200: Table 41 〞 Other transformations 
30201: Template Condition Comments 
30202: template <std::size_t Len, 
30203: std::size_t Align 
30204: = default-alignment> 
30205: struct aligned_storage; 
30206: Len shall not be zero. Align 
30207: shall be equal to 
30208: alignment_of<T>::value 
30209: for some type T or to 
30210: default-alignment. 
30211: The value of default-alignment shall 
30212: be the most stringent alignment 
30213: requirement for any C++ object type 
30214: whose size is no greater than 
30215: Len (3.9). The member typedef type 
30216: shall be a POD type suitable for use 
30217: as uninitialized storage for any object 
30218: whose size is at most Len and whose 
30219: alignment is a divisor of Align. 
30220: template <class T> struct 
30221: decay; 
30222: Let U be 
30223: remove_reference<T>::type. If 
30224: is_array<U>::value is true, the 
30225: member typedef type shall equal 
30226: remove_extent<U>::type*. If 
30227: is_function<U>::value is true, the 
30228: member typedef type shall equal 
30229: add_pointer<U>::type. Otherwise 
30230: the member typedef type equals 
30231: remove_cv<U>::type. 
30232: template <bool B, class T = If B is true, the member typedef type 
30233: void> struct enable_if; shall equal T; otherwise, there shall be 
30234: no member typedef type 
30235: template <bool B, class T, If B is true, the member typedef type 
30236: class F> struct conditional; shall equal T. If B is false, the 
30237: member typedef type shall equal F. 
30238: ∫ 20.5.7 567 
30239: 
30240: . ISO/IEC N2800=08-0310 
30241: Table 41 〞 Other transformations (continued) 
30242: Template Condition Comments 
30243: template <class... 
30244: struct common_type; 
30245: T> The member typedef type shall be 
30246: defined as set out below. All types in 
30247: the parameter pack T shall be 
30248: complete. A program may specialize 
30249: this trait if at least one template 
30250: parameter in the specialization is a 
30251: user-defined type. [ Note: Such 
30252: specializations are needed when only 
30253: explicit conversion are desired among 
30254: the template arguments. 〞 end note ] 
30255: 1 [ Note: A typical implementation would define aligned_storage as: 
30256: template <std::size_t Len, std::size_t Alignment>
30257: struct aligned_storage {
30258: typedef struct {
30259: unsigned char __data [[ align(Alignment) ]] [Len];
30260: } type;
30261: };
30262: 〞end note ] 
30263: 2 It is implementation-defined whether any extended alignment is supported (3.11). 
30264: 3 The nested typedef common_type::type shall be defined as follows: 
30265: template <class ...T> struct common_type; 
30266: template <class T>
30267: struct common_type<T> {
30268: typedef T type;
30269: };
30270: template <class T, class U>
30271: struct common_type<T, U> {
30272: private:
30273: static T&& __t();
30274: static U&& __u();
30275: public:
30276: typedef decltype(true ? __t() : __u()) type;
30277: };
30278: template <class T, class U, class... V> 
30279: struct common_type<T, U, V...> { 
30280: typedef typename common_type<typename common_type<T, U>::type, V...>::type type; 
30281: }; 
30282: 20.6 Function objects [function.objects] 
30283: 1 Function objects are objects with an operator() defined. In the places where one would expect to 
30284: pass a pointer to a function to an algorithmic template (clause 25), the interface is specified to accept 
30285: ∫ 20.6 568 
30286: 
30287: c
30288: . ISO/IEC N2800=08-0310 
30289: an object with an operator() defined. This not only makes algorithmic templates work with pointers 
30290: to functions, but also enables them to work with arbitrary function objects. 
30291: 2 Header <functional> synopsis 
30292: namespace std { 
30293: // 20.6.3, base: 
30294: template <class Arg, class Result> struct unary_function;
30295: template <class Arg1, class Arg2, class Result> struct binary_function;
30296: // 20.6.4 result_of:
30297: template <class> class result_of; // undefined
30298: template <class F, class... Args> class result_of<F(ArgTypes...)>;
30299: // 20.6.5, reference_wrapper: 
30300: template <ObjectType T> class reference_wrapper;
30301: template <ObjectType T> reference_wrapper<T> ref(T&);
30302: template <ObjectType T> reference_wrapper<const T> cref(const T&);
30303: template <ObjectType T> reference_wrapper<T> ref(reference_wrapper<T>);
30304: template <ObjectType T> reference_wrapper<const T> cref(reference_wrapper<T>);
30305: // 20.6.6, identity operation: 
30306: template <IdentityOf T> struct identity; 
30307: // 20.6.7, arithmetic operations: 
30308: template <ReferentType T> struct plus;
30309: template <ReferentType T> struct minus;
30310: template <ReferentType T> struct multiplies;
30311: template <ReferentType T> struct divides;
30312: template <ReferentType T> struct modulus;
30313: template <ReferentType T> struct negate;
30314: // 20.6.8, comparisons: 
30315: template <ReferentType T> struct equal_to;
30316: template <ReferentType T> struct not_equal_to;
30317: template <ReferentType T> struct greater;
30318: template <ReferentType T> struct less;
30319: template <ReferentType T> struct greater_equal;
30320: template <ReferentType T> struct less_equal;
30321: // 20.6.9, logical operations: 
30322: template <ReferentType T> struct logical_and;
30323: template <ReferentType T> struct logical_or;
30324: template <ReferentType T> struct logical_not;
30325: // 20.6.10, bitwise operations: 
30326: template <ReferentType T> struct bit_and;
30327: template <ReferentType T> struct bit_or;
30328: template <ReferentType T> struct bit_xor;
30329: // 20.6.11, negators: 
30330: template <class Predicate> class unary_negate;
30331: template <class Predicate>
30332: unary_negate<Predicate> not1(const Predicate&);
30333: ∫ 20.6 569 
30334: 
30335: c
30336: . ISO/IEC N2800=08-0310 
30337: template <class Predicate> class binary_negate;
30338: template <class Predicate>
30339: binary_negate<Predicate> not2(const Predicate&);
30340: // 20.6.12, bind: 
30341: template<class T> struct is_bind_expression;
30342: template<class T> struct is_placeholder;
30343: template<CopyConstructible Fn, CopyConstructible... Types> 
30344: unspecified bind(Fn, Types...); 
30345: template<Returnable R, CopyConstructible Fn, CopyConstructible... Types> 
30346: unspecified bind(Fn, Types...); 
30347: namespace placeholders { 
30348: // M is the implementation-defined number of placeholders 
30349: extern unspecified _1; 
30350: extern unspecified _2;
30351: .
30352: .
30353: .
30354: extern unspecified _M;
30355: }
30356: // D.8, binders (deprecated): 
30357: template <class Fn> class binder1st;
30358: template <class Fn, class T>
30359: binder1st<Fn> bind1st(const Fn&, const T&);
30360: template <class Fn> class binder2nd;
30361: template <class Fn, class T>
30362: binder2nd<Fn> bind2nd(const Fn&, const T&); 
30363: // 20.6.13, adaptors: 
30364: template <CopyConstructible Arg, Returnable Result> 
30365: class pointer_to_unary_function; 
30366: template <CopyConstructible Arg, Returnable Result> 
30367: pointer_to_unary_function<Arg,Result> ptr_fun(Result (*)(Arg)); 
30368: template <CopyConstructible Arg1, CopyConstructible Arg2, Returnable Result> 
30369: class pointer_to_binary_function; 
30370: template <CopyConstructible Arg1, CopyConstructible Arg2, Returnable Result> 
30371: pointer_to_binary_function<Arg1,Arg2,Result> 
30372: ptr_fun(Result (*)(Arg1,Arg2)); 
30373: // 20.6.14, adaptors: 
30374: template<Returnable S, ClassType T> class mem_fun_t;
30375: template<Returnable S, ClassType T, MoveConstructible A> class mem_fun1_t;
30376: template<Returnable S, ClassType T>
30377: mem_fun_t<S,T> mem_fun(S (T::*f)());
30378: template<Returnable S, ClassType T, MoveConstructible A>
30379: mem_fun1_t<S,T,A> mem_fun(S (T::*f)(A)); 
30380: template<Returnable S, ClassType T> class mem_fun_ref_t; 
30381: template<Returnable S, ClassType T, CopyConstructible A> class mem_fun1_ref_t; 
30382: template<Returnable S, ClassType T> 
30383: mem_fun_ref_t<S,T> mem_fun_ref(S (T::*f)());
30384: template<Returnable S, ClassType T, CopyConstructible A>
30385: mem_fun1_ref_t<S,T,A> mem_fun_ref(S (T::*f)(A));
30386: ∫ 20.6 570 
30387: 
30388: . ISO/IEC N2800=08-0310 
30389: template <Returnable S, ClassType T> class const_mem_fun_t;
30390: template <Returnable S, ClassType T, CopyConstructible A> class const_mem_fun1_t;
30391: template <Returnable S, ClassType T>
30392: const_mem_fun_t<S,T> mem_fun(S (T::*f)() const);
30393: template <Returnable S, ClassType T, CopyConstructible A>
30394: const_mem_fun1_t<S,T,A> mem_fun(S (T::*f)(A) const); 
30395: template <Returnable S, ClassType T> class const_mem_fun_ref_t; 
30396: template <Returnable S, ClassType T, CopyConstructible A> class const_mem_fun1_ref_t; 
30397: template <Returnable S, ClassType T> 
30398: const_mem_fun_ref_t<S,T> mem_fun_ref(S (T::*f)() const);
30399: template <Returnable S, ClassType T, CopyConstructible A>
30400: const_mem_fun1_ref_t<S,T,A> mem_fun_ref(S (T::*f)(A) const);
30401: // 20.6.15, member function adaptors: 
30402: template<Returnable R, class T> unspecified mem_fn(R T::*);
30403: template<Returnable R, class T, CopyConstructible... Args>
30404: unspecified mem_fn(R (T::* pm)(Args...));
30405: template<Returnable R, class T, CopyConstructible... Args>
30406: unspecified mem_fn(R (T::* pm)(Args...) const);
30407: template<Returnable R, class T, CopyConstructible... Args>
30408: unspecified mem_fn(R (T::* pm)(Args...) volatile);
30409: template<Returnable R, class T, CopyConstructible... Args>
30410: unspecified mem_fn(R (T::* pm)(Args...) const volatile);
30411: // 20.6.16 polymorphic function wrappers: 
30412: class bad_function_call; 
30413: template<FunctionType> class function; // undefined
30414: template<Returnable R, CopyConstructible... ArgTypes>
30415: class function<R(ArgTypes...)>;
30416: template<Returnable R, CopyConstructible... ArgTypes>
30417: void swap(function<R(ArgTypes...)>&, function<R(ArgTypes...)>&);
30418: template<Returnable R, CopyConstructible... ArgTypes>
30419: bool operator==(const function<R(ArgTypes...)>&, nullptr_t);
30420: template<Returnable R, CopyConstructible... ArgTypes>
30421: bool operator==(nullptr_t, const function<R(ArgTypes...)>&);
30422: template<Returnable R, CopyConstructible... ArgTypes>
30423: bool operator!=(const function<R(ArgTypes...)>&, nullptr_t);
30424: template<Returnable R, CopyConstructible... ArgTypes>
30425: bool operator!=(nullptr_t, const function<R(ArgTypes...)>&);
30426: // 20.6.17, hash function base template: 
30427: template <ReferentType T> struct hash; 
30428: // Hash function specializations 
30429: template <> struct hash<bool>;
30430: template <> struct hash<char>;
30431: template <> struct hash<signed char>;
30432: template <> struct hash<unsigned char>;
30433: template <> struct hash<char16_t>;
30434: template <> struct hash<char32_t>;
30435: template <> struct hash<wchar_t>;
30436: ∫ 20.6 571 
30437: 
30438: . ISO/IEC N2800=08-0310 
30439: template <> struct hash<short>;
30440: template <> struct hash<unsigned short>;
30441: template <> struct hash<int>;
30442: template <> struct hash<unsigned int>;
30443: template <> struct hash<long>;
30444: template <> struct hash<long long>;
30445: template <> struct hash<unsigned long>;
30446: template <> struct hash<unsigned long long>;
30447: template <> struct hash<float>;
30448: template <> struct hash<double>;
30449: template <> struct hash<long double>;
30450: template<PointeeType T> struct hash<T*>; 
30451: template <> struct hash<std::string>;
30452: template <> struct hash<std::u16string>;
30453: template <> struct hash<std::u32string>;
30454: template <> struct hash<std::wstring>;
30455: template <class Allocator> struct hash<std::vector<bool, Allocator> >; 
30456: template <std::size_t N> struct hash<std::bitset<N> >; 
30457: } 
30458: 20.6.1 Definitions [func.def] 
30459: 1 The following definitions apply to this Clause: 
30460: 2 A call signature is the name of a return type followed by a parenthesized comma-separated list of zero 
30461: or more argument types. 
30462: 3 A callable type is a pointer to function, a pointer to member function, a pointer to member data, or a 
30463: class type whose objects can appear immediately to the left of a function call operator. 
30464: 4 A callable object is an object of a callable type. 
30465: 5 A call wrapper type is a type that holds a callable object and supports a call operation that forwards 
30466: to that object. 
30467: 6 A call wrapper is an object of a call wrapper type. 
30468: 7 A target object is the callable object held by a call wrapper. 
30469: 20.6.2 Requirements [func.require] 
30470: 1 Define INVOKE (f, t1, t2, ..., tN) as follows: 
30471: 〞 (t1.*f)(t2, ..., tN) when f is a pointer to a member function of a class T and t1 is an object 
30472: of type T or a reference to an object of type T or a reference to an object of a type derived from 
30473: T; 
30474: 〞 ((*t1).*f)(t2, ..., tN) when f is a pointer to a member function of a class T and t1 is not 
30475: one of the types described in the previous item; 
30476: 〞 t1.*f when f is a pointer to member data of a class T and t1 is an object of type T or a reference 
30477: to an object of type T or a reference to an object of a type derived from T; 
30478: ∫ 20.6.2 572 
30479: 
30480: c
30481: . ISO/IEC N2800=08-0310 
30482: 〞 (*t1).*f when f is a pointer to member data of a class T and t1 is not one of the types described 
30483: in the previous item; 
30484: 〞 f(t1, t2, ..., tN) in all other cases. 
30485: 2 Define INVOKE (f, t1, t2, ..., tN, R) as INVOKE (f, t1, t2, ..., tN) implicitly converted to 
30486: R. 
30487: 3 If a call wrapper (20.6.1) has a weak result type the type of its member type result_type is based on 
30488: the type T of the wrapper＊s target object (20.6.1): 
30489: 〞 if T is a function, reference to function, or pointer to function type, result_type shall be a 
30490: synonym for the return type of T; 
30491: 〞 if T is a pointer to member function, result_type shall be a synonym for the return type of T; 
30492: 〞 if T is a class type with a member type result_type, then result_type shall be a synonym for 
30493: T::result_type; 
30494: 〞 otherwise result_type shall not be defined. 
30495: 4 Every call wrapper (20.6.1) shall be CopyConstructible. A simple call wrapper is a call wrapper that 
30496: is CopyAssignable and whose copy constructor and assignment operator do not throw exceptions. A 
30497: forwarding call wrapper is a call wrapper that can be called with an argument list. [ Note: in a typical 
30498: implementation forwarding call wrappers have an overloaded function call operator of the form 
30499: template<class... ArgTypes>
30500: R operator()(ArgTypes&&... args) cv-qual;
30501: 〞end note ] 
30502: 20.6.3 Base [base] 
30503: 1 The following classes are provided to simplify the typedefs of the argument and result types: 
30504: namespace std {
30505: template <class Arg, class Result>
30506: struct unary_function {
30507: typedef Arg argument_type;
30508: typedef Result result_type;
30509: };
30510: }
30511: namespace std {
30512: template <class Arg1, class Arg2, class Result>
30513: struct binary_function {
30514: typedef Arg1 first_argument_type;
30515: typedef Arg2 second_argument_type;
30516: typedef Result result_type;
30517: };
30518: }
30519: 20.6.4 Function object return types [func.ret] 
30520: namespace std {
30521: template <class> class result_of; // undefined
30522: ∫ 20.6.4 573 
30523: 
30524: c
30525: . ISO/IEC N2800=08-0310 
30526: template <class Fn, class... ArgTypes>
30527: class result_of<Fn(ArgTypes...)> {
30528: public :
30529: // types 
30530: typedef see below type;
30531: };
30532: }
30533: 1 Given an rvalue fn of type Fn and values t1, t2, ..., tN of types T1, T2, ..., TN in ArgTypes, 
30534: respectively, the type member is the result type of the expression fn(t1, t2, ...,tN). The values 
30535: ti are lvalues when the corresponding type Ti is a reference type, and rvalues otherwise. 
30536: 20.6.5 Class template reference_wrapper [refwrap] 
30537: template <ObjectType T> class reference_wrapper
30538: : public unary_function<T1, R> // see below
30539: : public binary_function<T1, T2, R> // see below
30540: {
30541: public :
30542: // types 
30543: typedef T type;
30544: typedef see below result_type; // Not always defined
30545: // construct/copy/destroy 
30546: explicit reference_wrapper(T&);
30547: reference_wrapper(const reference_wrapper<T>& x);
30548: // assignment 
30549: reference_wrapper& operator=(const reference_wrapper<T>& x); 
30550: // access 
30551: operator T& () const;
30552: T& get() const;
30553: // invoke 
30554: template <class... ArgTypes>
30555: requires Callable<T, ArgTypes&&...>
30556: Callable<T, ArgTypes&&...>::result_type
30557: operator() (ArgTypes&&...) const;
30558: };
30559: 1 reference_wrapper<T> is a CopyConstructible and Assignable wrapper around a reference to an 
30560: object of type T. 
30561: 2 reference_wrapper has a weak result type (20.6.2). 
30562: 3 The template instantiation reference_wrapper<T> shall be derived from std::unary_function<T1, 
30563: R> only if the type T is any of the following: 
30564: 〞 a function type or a pointer to function type taking one argument of type T1 and returning R 
30565: 〞 a pointer to member function R T0::f cv (where cv represents the member function＊s cv-qualifiers); 
30566: the type T1 is cv T0* 
30567: 〞 a class type that is derived from std::unary_function<T1, R> 
30568: ∫ 20.6.5 574 
30569: 
30570: c
30571: . ISO/IEC N2800=08-0310 
30572: 4 The template instantiation reference_wrapper<T> shall be derived from std::binary_function<T1, 
30573: T2, R> only if the type T is any of the following: 
30574: 〞 a function type or a pointer to function type taking two arguments of types T1 and T2 and 
30575: returning R 
30576: 〞 a pointer to member function R T0::f(T2) cv (where cv represents the member function＊s cv-
30577: qualifiers); the type T1 is cv T0* 
30578: 〞 a class type that is derived from std::binary_function<T1, T2, R> 
30579: 20.6.5.1 reference_wrapper construct/copy/destroy [refwrap.const] 
30580: reference_wrapper(T& t); 
30581: 1 Effects: Constructs a reference_wrapper object that stores a reference to t. 
30582: 2 Throws: nothing. 
30583: reference_wrapper(const reference_wrapper<T>& x); 
30584: 3 Effects: Constructs a reference_wrapper object that stores a reference to x.get(). 
30585: 4 Throws: nothing. 
30586: 20.6.5.2 reference_wrapper assignment [refwrap.assign] 
30587: reference_wrapper& operator=(const reference_wrapper<T>& x); 
30588: 1 Postconditions: *this stores a reference to x.get(). 
30589: 2 Throws: nothing. 
30590: 20.6.5.3 reference_wrapper access [refwrap.access] 
30591: operator T& () const; 
30592: 1 Returns: The stored reference. 
30593: 2 Throws: nothing. 
30594: T& get() const; 
30595: 3 Returns: The stored reference. 
30596: 4 Throws: nothing. 
30597: 20.6.5.4 reference_wrapper invocation [refwrap.invoke] 
30598: template <class... ArgTypes> 
30599: requires Callable<T, ArgTypes&&...> 
30600: Callable<T, ArgTypes&&...>::result_type 
30601: operator()(ArgTypes&&... args) const; 
30602: 1 Returns: INVOKE (get(), std::forward<ArgTypes>(args)...). (20.6.2) 
30603: ∫ 20.6.5.4 575 
30604: 
30605: c
30606: . ISO/IEC N2800=08-0310 
30607: 20.6.5.5 reference_wrapper helper functions [refwrap.helpers] 
30608: template <ObjectType T> reference_wrapper<T> ref(T& t); 
30609: 1 Returns: reference_wrapper<T>(t) 
30610: 2 Throws: nothing. 
30611: template <ObjectType T> reference_wrapper<T> ref(reference_wrapper<T>t); 
30612: 3 Returns: ref(t.get()) 
30613: 4 Throws: nothing. 
30614: template <ObjectType T> reference_wrapper<const T> cref(const T& t); 
30615: 5 Returns: reference_wrapper <const T>(t) 
30616: 6 Throws: nothing. 
30617: template <ObjectType T> reference_wrapper<const T> cref(reference_wrapper<T> t); 
30618: 7 Returns: cref(t.get()); 
30619: 8 Throws: nothing. 
30620: 20.6.6 Identity operation [identity.operation] 
30621: template <IdentityOf T> struct identity {
30622: typedef T type;
30623: requires ReferentType<T>
30624: const T& operator()(const T& x) const;
30625: };
30626: requires ReferentType<T>
30627: const T& operator()(const T& x) const;
30628: 1 Returns: x 
30629: 20.6.7 Arithmetic operations [arithmetic.operations] 
30630: 1 The library provides basic function object classes for all of the arithmetic operators in the language 
30631: (5.6, 5.7). 
30632: template <ReferentType T> struct plus : binary_function<T,T,T> {
30633: requires HasPlus<T, T> && Convertible<T::result_type, T>
30634: T operator()(const T& x, const T& y) const;
30635: };
30636: 2 operator() returns x+y. 
30637: template <ReferentType T> struct minus : binary_function<T,T,T> {
30638: requires HasMinus<T,T> && Convertible<T::result_type, T>
30639: T operator()(const T& x, const T& y) const;
30640: };
30641: 3 operator() returns x-y. 
30642: ∫ 20.6.7 576 
30643: 
30644: c
30645: . ISO/IEC N2800=08-0310 
30646: template <ReferentType T> struct multiplies : binary_function<T,T,T> {
30647: requires HasMultiply<T,T> && Convertible<T::result_type, T>
30648: T operator()(const T& x, const T& y) const;
30649: };
30650: 4 operator() returns x*y. 
30651: template <ReferentType T> struct divides : binary_function<T,T,T> {
30652: requires HasDivide<T,T> && Convertible<T::result_type, T>
30653: T operator()(const T& x, const T& y) const;
30654: }; 
30655: 5 operator() returns x/ y. 
30656: template <ReferentType T> struct modulus : binary_function<T,T,T> {
30657: requires HasModulus<T,T> && Convertible<T::result_type, T>
30658: T operator()(const T& x, const T& y) const;
30659: };
30660: 6 operator() returns x% y. 
30661: template <ReferentType T> struct negate : unary_function<T,T> {
30662: requires HasNegate<T> && Convertible<T::result_type, T>
30663: T operator()(const T& x) const;
30664: };
30665: 7 operator() returns -x. 
30666: 20.6.8 Comparisons [comparisons] 
30667: 1 The library provides basic function object classes for all of the comparison operators in the language 
30668: (5.9, 5.10). 
30669: template <ReferentType T> struct equal_to : binary_function<T,T,bool> {
30670: requires HasEqualTo<T, T>
30671: bool operator()(const T& x, const T& y) const;
30672: };
30673: 2 operator() returns x == y. 
30674: template <ReferentType T> struct not_equal_to : binary_function<T,T,bool> {
30675: requires HasNotEqualTo<T, T>
30676: bool operator()(const T& x, const T& y) const;
30677: };
30678: 3 operator() returns x != y. 
30679: template <ReferentType T> struct greater : binary_function<T,T,bool> {
30680: requires HasGreater<T, T>
30681: bool operator()(const T& x, const T& y) const;
30682: };
30683: 4 operator() returns x>y. 
30684: template <ReferentType T> struct less : binary_function<T,T,bool> {
30685: requires HasLess<T, T>
30686: bool operator()(const T& x, const T& y) const;
30687: };
30688: ∫ 20.6.8 577 
30689: 
30690: c
30691: . ISO/IEC N2800=08-0310 
30692: 5 operator() returns x<y. 
30693: template <ReferentType T> struct greater_equal : binary_function<T,T,bool> {
30694: requires HasGreaterEqual<T, T>
30695: bool operator()(const T& x, const T& y) const;
30696: };
30697: 6 operator() returns x >= y. 
30698: template <ReferentType T> struct less_equal : binary_function<T,T,bool> {
30699: requires HasLessEqual<T, T>
30700: bool operator()(const T& x, const T& y) const;
30701: };
30702: 7 operator() returns x <= y. 
30703: 8 For templates greater, less, greater_equal, and less_equal, the specializations for any pointer 
30704: type yield a total order, even if the built-in operators <, >, <=, >= do not. 
30705: 20.6.9 Logical operations [logical.operations] 
30706: 1 The library provides basic function object classes for all of the logical operators in the language (5.14, 
30707: 5.15, 5.3.1). 
30708: template <ReferentType T> struct logical_and : binary_function<T,T,bool> {
30709: requires HasLogicalAnd<T, T>
30710: bool operator()(const T& x, const T& y) const;
30711: };
30712: 2 operator() returns x && y. 
30713: template <ReferentType T> struct logical_or : binary_function<T,T,bool> {
30714: requires HasLogicalOr<T, T>
30715: bool operator()(const T& x, const T& y) const;
30716: };
30717: 3 operator() returns x || y. 
30718: template <ReferentType T> struct logical_not : unary_function<T,bool> {
30719: requires HasLogicalNot<T>
30720: bool operator()(const T& x) const;
30721: };
30722: 4 operator() returns !x. 
30723: 20.6.10 Bitwise operations [bitwise.operations] 
30724: 1 The library provides basic function object classes for all of the bitwise operators in the language (5.11, 
30725: 5.13, 5.12). 
30726: template <ReferentType T> struct bit_and : binary_function<T,T,T> {
30727: requires HasBitAnd<T, T> && Convertible<T::result_type, T>
30728: T operator()(const T& x, const T& y) const;
30729: };
30730: 2 operator() returns x& y. 
30731: ∫ 20.6.10 578 
30732: 
30733: c
30734: . ISO/IEC N2800=08-0310 
30735: template <ReferentType T> struct bit_or : binary_function<T,T,T> {
30736: requires HasBitOr<T, T> && Convertible<T::result_type, T>
30737: T operator()(const T& x, const T& y) const;
30738: };
30739: 3 operator() returns x| y. 
30740: template <ReferentType T> struct bit_xor : binary_function<T,T,T> {
30741: requires HasBitXor<T, T> && Convertible<T::result_type, T>
30742: T operator()(const T& x, const T& y) const;
30743: };
30744: 4 operator() returns x. y. 
30745: 20.6.11 Negators [negators] 
30746: 1 Negators not1 and not2 take a unary and a binary predicate, respectively, and return their comple-
30747: ments (5.3.1). 
30748: template <class Predicate>
30749: class unary_negate
30750: : public unary_function<typename Predicate::argument_type,bool> {
30751: public:
30752: explicit unary_negate(const Predicate& pred);
30753: bool operator()(const typename Predicate::argument_type& x) const;
30754: }; 
30755: 2 operator() returns !pred(x). 
30756: template <class Predicate>
30757: unary_negate<Predicate> not1(const Predicate& pred);
30758: 3 Returns: unary_negate<Predicate>(pred). 
30759: template <class Predicate>
30760: class binary_negate
30761: : public binary_function<typename Predicate::first_argument_type,
30762: typename Predicate::second_argument_type, bool> {
30763: public:
30764: explicit binary_negate(const Predicate& pred);
30765: bool operator()(const typename Predicate::first_argument_type& x,
30766: const typename Predicate::second_argument_type& y) const;
30767: };
30768: 4 operator() returns !pred(x,y). 
30769: template <class Predicate>
30770: binary_negate<Predicate> not2(const Predicate& pred);
30771: 5 Returns: 
30772: binary_negate<Predicate>(pred). 
30773: 20.6.12 Template function bind [bind] 
30774: 1 The template function bind returns an object that binds a function object passed as an argument to 
30775: ∫ 20.6.12 579 
30776: 
30777: c
30778: . ISO/IEC N2800=08-0310 
30779: additional arguments. 
30780: 20.6.12.1 Function object binders [func.bind] 
30781: 1 This subclause describes a uniform mechanism for binding arguments of function objects. 
30782: 20.6.12.1.1 Class template is_bind_expression [func.bind.isbind] 
30783: namespace std {
30784: template<class T> struct is_bind_expression {
30785: static const bool value = see below ;
30786: };
30787: }
30788: 1 is_bind_expression can be used to detect function objects generated by bind. bind uses is_bind_-
30789: expression to detect subexpressions. Users may specialize this template to indicate that a type should 
30790: be treated as a subexpression in a bind call. 
30791: static const bool value; 
30792: 2 true if T is a type returned from bind, false otherwise. 
30793: 20.6.12.1.2 Class template is_placeholder [func.bind.isplace] 
30794: namespace std {
30795: template<class T> struct is_placeholder {
30796: static const int value = see below ;
30797: };
30798: }
30799: 1 is_placeholder can be used to detect the standard placeholders _1, _2, and so on. bind uses is_-
30800: placeholder to detect placeholders. Users may specialize this template to indicate a placeholder 
30801: type. 
30802: static const int value; 
30803: 2 value is J if T is the type of std::placeholders::_J , 0 otherwise. 
30804: 20.6.12.1.3 Function template bind [func.bind.bind] 
30805: template<CopyConstructible F, CopyConstructible... BoundArgs>
30806: unspecified bind(F f, BoundArgs... bound_args);
30807: 1 Requires: INVOKE (f, w1, w2, ..., wN) (20.6.2) shall be a valid expression for some values 
30808: w1, w2, ..., wN, where N == sizeof...(bound_args). 
30809: 2 Returns: A forwarding call wrapper g with a weak result type (20.6.2). The effect of g(u1, u2, 
30810: ..., uM) shall be INVOKE (f, v1, v2, ..., vN, Callable<F cv,V1, V2, ..., VN>::result_-
30811: type), where cv represents the cv-qualifiers of g and the values and types of the bound arguments 
30812: v1, v2, ..., vN are determined as specified below. 
30813: template<Returnable R, CopyConstructible F, CopyConstructible... BoundArgs>
30814: unspecified bind(F f, BoundArgs... bound_args);
30815: 3 Requires: INVOKE (f, w1, w2, ..., wN) shall be a valid expression for some values w1, w2, ..., 
30816: wN, where N == sizeof...(bound_args). 
30817: ∫ 20.6.12.1.3 580 
30818: 
30819: c
30820: . ISO/IEC N2800=08-0310 
30821: 4 Returns: A forwarding call wrapper g with a nested type result_type defined as a synonym 
30822: for R. The effect of g(u1, u2, ..., uM) shall be INVOKE (f, v1, v2, ..., vN, R), where the 
30823: values and types of the bound arguments v1, v2, ..., vN are determined as specified below. 
30824: 20.6.12.1.4 Placeholders [func.bind.place] 
30825: namespace std {
30826: namespace placeholders {
30827: // M is the implementation-defined number of placeholders 
30828: extern unspecified _1; 
30829: extern unspecified _2;
30830: .
30831: .
30832: .
30833: extern unspecified _M;
30834: }
30835: }
30836: 1 All placeholder types shall be DefaultConstructible and CopyConstructible, and their default 
30837: constructors and copy constructors shall not throw exceptions. It is implementation defined whether 
30838: placeholder types are Assignable. Assignable placeholders＊ copy assignment operators shall not 
30839: throw exceptions. 
30840: 20.6.13 Adaptors for pointers to functions [function.pointer.adaptors] 
30841: 1 To allow pointers to (unary and binary) functions to work with function adaptors the library provides: 
30842: template <CopyConstructible Arg, Returnable Result>
30843: class pointer_to_unary_function : public unary_function<Arg, Result> {
30844: public:
30845: explicit pointer_to_unary_function(Result (*f)(Arg));
30846: Result operator()(Arg x) const;
30847: };
30848: 2 operator() returns f(x). 
30849: template <CopyConstructible Arg, Returnable Result>
30850: pointer_to_unary_function<Arg, Result> ptr_fun(Result (*f)(Arg));
30851: 3 Returns: pointer_to_unary_function<Arg, Result>(f). 
30852: template <CopyConstructible Arg1, CopyConstructible Arg2, Returnable Result>
30853: class pointer_to_binary_function :
30854: public binary_function<Arg1,Arg2,Result> {
30855: public:
30856: explicit pointer_to_binary_function(Result (*f)(Arg1, Arg2));
30857: Result operator()(Arg1 x, Arg2 y) const;
30858: }; 
30859: 4 operator() returns f(x,y). 
30860: template <CopyConstructible Arg1, CopyConstructible Arg2, Returnable Result>
30861: pointer_to_binary_function<Arg1,Arg2,Result>
30862: ptr_fun(Result (*f)(Arg1, Arg2));
30863: 5 Returns: pointer_to_binary_function<Arg1,Arg2,Result>(f). 
30864: 6 [ Example: 
30865: ∫ 20.6.13 581 
30866: 
30867: . ISO/IEC N2800=08-0310 
30868: int compare(const char*, const char*);
30869: replace_if(v.begin(), v.end(),
30870: not1(bind2nd(ptr_fun(compare), "abc")), "def");
30871: replaces each abc with def in sequence v. 〞end example ] 
30872: 20.6.14 Adaptors for pointers to members [member.pointer.adaptors] 
30873: 1 The purpose of the following is to provide the same facilities for pointer to members as those provided 
30874: for pointers to functions in 20.6.13. 
30875: template <Returnable S, ClassType T> class mem_fun_t
30876: : public unary_function<T*, S> {
30877: public:
30878: explicit mem_fun_t(S (T::*p)());
30879: S operator()(T* p) const;
30880: }; 
30881: 2 mem_fun_t calls the member function it is initialized with given a pointer argument. 
30882: template <Returnable S, ClassType T, CopyConstructible A> class mem_fun1_t
30883: : public binary_function<T*, A, S> {
30884: public:
30885: explicit mem_fun1_t(S (T::*p)(A));
30886: S operator()(T* p, A x) const;
30887: }; 
30888: 3 mem_fun1_t calls the member function it is initialized with given a pointer argument and an 
30889: additional argument of the appropriate type. 
30890: template<Returnable S, ClassType T> mem_fun_t<S,T>
30891: mem_fun(S (T::*f)());
30892: template<Returnable S, ClassType T, CopyConstructible A> mem_fun1_t<S,T,A>
30893: mem_fun(S (T::*f)(A));
30894: 4 mem_fun(&X::f) returns an object through which X::f can be called given a pointer to an X 
30895: followed by the argument required for f (if any). 
30896: template <Returnable S, ClassType T> class mem_fun_ref_t
30897: : public unary_function<T, S> {
30898: public:
30899: explicit mem_fun_ref_t(S (T::*p)());
30900: S operator()(T& p) const;
30901: }; 
30902: 5 mem_fun_ref_t calls the member function it is initialized with given a reference argument. 
30903: template <Returnable S, ClassType T, CopyConstructible A> class mem_fun1_ref_t 
30904: : public binary_function<T, A, S> { 
30905: public:
30906: explicit mem_fun1_ref_t(S (T::*p)(A));
30907: S operator()(T& p, A x) const;
30908: }; 
30909: 6 mem_fun1_ref_t calls the member function it is initialized with given a reference argument and 
30910: an additional argument of the appropriate type. 
30911: ∫ 20.6.14 582 
30912: 
30913: c
30914: . ISO/IEC N2800=08-0310 
30915: template<Returnable S, ClassType T> mem_fun_ref_t<S,T> 
30916: mem_fun_ref(S (T::*f)()); 
30917: template<Returnable S, ClassType T, CopyConstructible A> mem_fun1_ref_t<S,T,A> 
30918: mem_fun_ref(S (T::*f)(A)); 
30919: 7 mem_fun_ref(&X::f) returns an object through which X::f can be called given a reference to an 
30920: X followed by the argument required for f (if any). 
30921: template <Returnable S, ClassType T> class const_mem_fun_t
30922: : public unary_function<const T*, S> {
30923: public:
30924: explicit const_mem_fun_t(S (T::*p)() const);
30925: S operator()(const T* p) const;
30926: }; 
30927: 8 const_mem_fun_t calls the member function it is initialized with given a pointer argument. 
30928: template <Returnable S, ClassType T, CopyConstructible A> class const_mem_fun1_t 
30929: : public binary_function<const T*, A, S> { 
30930: public:
30931: explicit const_mem_fun1_t(S (T::*p)(A) const);
30932: S operator()(const T* p, A x) const;
30933: }; 
30934: 9 const_mem_fun1_t calls the member function it is initialized with given a pointer argument and 
30935: an additional argument of the appropriate type. 
30936: template<cReturnable S, ClassType T> const_mem_fun_t<S,T> 
30937: mem_fun(S (T::*f)() const); 
30938: template<Returnable S, ClassType T, CopyConstructible A> const_mem_fun1_t<S,T,A> 
30939: mem_fun(S (T::*f)(A) const); 
30940: 10 mem_fun(&X::f) returns an object through which X::f can be called given a pointer to an X 
30941: followed by the argument required for f (if any). 
30942: template <Returnable S, ClassType T> class const_mem_fun_ref_t
30943: : public unary_function<T, S> {
30944: public:
30945: explicit const_mem_fun_ref_t(S (T::*p)() const);
30946: S operator()(const T& p) const;
30947: }; 
30948: 11 const_mem_fun_ref_t calls the member function it is initialized with given a reference argument. 
30949: template <Returnable S, ClassType T, CopyConstructible A> class const_mem_fun1_ref_t 
30950: : public binary_function<T, A, S> { 
30951: public:
30952: explicit const_mem_fun1_ref_t(S (T::*p)(A) const);
30953: S operator()(const T& p, A x) const;
30954: }; 
30955: 12 const_mem_fun1_ref_t calls the member function itisinitialized with given a reference argument 
30956: and an additional argument of the appropriate type. 
30957: template<Returnable S, ClassType T> const_mem_fun_ref_t<S,T> 
30958: mem_fun_ref(S (T::*f)() const); 
30959: template<Returnable S, ClassType T, CopyConstructible A> const_mem_fun1_ref_t<S,T,A> 
30960: mem_fun_ref(S (T::*f)(A) const); 
30961: ∫ 20.6.14 583 
30962: 
30963: c
30964: . ISO/IEC N2800=08-0310 
30965: 13 mem_fun_ref(&X::f) returns an object through which X::f can be called given a reference to an 
30966: X followed by the argument required for f (if any). 
30967: 20.6.15 Function template mem_fn [func.memfn] 
30968: template<Returnable R, class T> unspecified mem_fn(R T::* pm);
30969: template<Returnable R, class T, CopyConstructible... Args>
30970: unspecified mem_fn(R (T::* pm)(Args...));
30971: template<Returnable R, class T, CopyConstructible... Args>
30972: unspecified mem_fn(R (T::* pm)(Args...) const);
30973: template<Returnable R, class T, CopyConstructible... Args>
30974: unspecified mem_fn(R (T::* pm)(Args...) volatile);
30975: template<Returnable R, class T, CopyConstructible... Args>
30976: unspecified mem_fn(R (T::* pm)(Args...) const volatile);
30977: 1 Returns: A simple call wrapper ([20.6.1]) fn such that the expression fn(t, a2, ..., aN) is 
30978: equivalent to INVOKE (pm, t, a2, ..., aN) ([20.6.2]). fn shall have a nested type result_type 
30979: that is a synonym for the return type of pm when pm is a pointer to member function. 
30980: 2 The simple call wrapper shall be derived from std::unary_function<cv T*, Ret> when pm is 
30981: a pointer to member function with cv-qualifier cv and taking no arguments, where Ret is pm＊s 
30982: return type. 
30983: 3 The simple call wrapper shall be derived from std::binary_function<cv T*, T1, Ret> when 
30984: pm is a pointer to member function with cv-qualifier cv and taking one argument of type T1, where 
30985: Ret is pm＊s return type. 
30986: 4 Throws: nothing. 
30987: 20.6.16 Polymorphic function wrappers [func.wrap] 
30988: 1 This subclause describes a polymorphic wrapper class that encapsulates arbitrary function objects. 
30989: 20.6.16.1 Class bad_function_call [func.wrap.badcall] 
30990: 1 An exception of type bad_function_call is thrown by function::operator() (20.6.16.2.4) when 
30991: the function wrapper object has no target. 
30992: namespace std { 
30993: class bad_function_call : public std::exception { 
30994: public: 
30995: // 20.6.16.1.1, constructor: 
30996: bad_function_call(); 
30997: }; 
30998: } // namespace std 
30999: 20.6.16.1.1 bad_function_call constructor [func.wrap.badcall.const] 
31000: bad_function_call(); 
31001: 1 Effects: constructs a bad_function_call object. 
31002: 20.6.16.2 Class template function [func.wrap.func] 
31003: ∫ 20.6.16.2 584 
31004: 
31005: c
31006: . ISO/IEC N2800=08-0310 
31007: namespace std {
31008: template<FunctionType> class function; // undefined
31009: template<Returnable R, CopyConstructible... ArgTypes>
31010: class function<R(ArgTypes...)>
31011: : public unary_function<T1, R> // iff sizeof...(ArgTypes) == 1 and
31012: // ArgTypes contains T1
31013: : public binary_function<T1, T2, R> // iff sizeof...(ArgTypes) == 2 and
31014: // ArgTypes contains T1 and T2
31015: {
31016: public:
31017: typedef R result_type; 
31018: // 20.6.16.2.1, construct/copy/destroy: 
31019: explicit function();
31020: function(nullptr_t);
31021: function(const function&);
31022: function(function&&);
31023: template<class F>
31024: requires CopyConstructible<F> && Callable<F, ArgTypes...>
31025: && Convertible<Callable<F, ArgTypes...>::result_type, R>
31026: function(F);
31027: template<class F>
31028: requires CopyConstructible<F> && Callable<F, ArgTypes...>
31029: && Convertible<Callable<F, ArgTypes...>::result_type, R>
31030: function(F&&);
31031: template<Allocator A>
31032: function(allocator_arg_t, const A&);
31033: template<Allocator A> function(allocator_arg_t, const A&,
31034: nullptr_t);
31035: template<Allocator A> function(allocator_arg_t, const A&,
31036: const function&);
31037: template<Allocator A> function(allocator_arg_t, const A&,
31038: function&&); 
31039: template<class F, Allocator A> function(allocator_arg_t, const A&, F); 
31040: template<class F, Allocator A> function(allocator_arg_t, const A&, F&&); 
31041: function& operator=(const function&);
31042: function& operator=(function&&);
31043: function& operator=(nullptr_t);
31044: template<class F>
31045: requires CopyConstructible<F> && Callable<F, ArgTypes..>
31046: && Convertible<Callable<F, ArgTypes...>::result_type
31047: function& operator=(F);
31048: template<class F>
31049: requires CopyConstructible<F> && Callable<F, ArgTypes...>
31050: && Convertible<Callable<F, ArgTypes...>::result_type, R>
31051: function& operator=(F&&);
31052: template<class F>
31053: requires Callable<F, ArgTypes...>
31054: && Convertible<Callable<F, ArgTypes...>::result_type, R>
31055: function& operator=(reference_wrapper<F>);
31056: ~function(); 
31057: ∫ 20.6.16.2 585 
31058: 
31059: c. ISO/IEC N2800=08-0310 
31060: // 20.6.16.2.2, function modifiers: 
31061: void swap(function&);
31062: template<class F, Allocator A>
31063: requires Callable<F, ArgTypes...>
31064: && Convertible<Callable<F, ArgTypes...>::result_type, R>
31065: void assign(F, const A&);
31066: // 20.6.16.2.3, function capacity: 
31067: explicit operator bool() const; 
31068: // deleted overloads close possible hole in the type system 
31069: template<class R2, class... ArgTypes2>
31070: bool operator==(const function<R2(ArgTypes2...)>&) = delete;
31071: template<class R2, class... ArgTypes2>
31072: bool operator!=(const function<R2(ArgTypes2...)>&) = delete;
31073: // 20.6.16.2.4, function invocation: 
31074: R operator()(ArgTypes...) const; 
31075: // 20.6.16.2.5, function target access: 
31076: const std::type_info& target_type() const;
31077: template <typename T>
31078: requires Callable<T, ArgTypes...>
31079: && Convertible<Callable<T, ArgTypes...>::result_type, R>
31080: T* target();
31081: template <typename T>
31082: requires Callable<T, ArgTypes...>
31083: && Convertible<Callable<T, ArgTypes...>::result_type, R>
31084: const T* target() const;
31085: };
31086: template <class R, class... Args>
31087: concept_map UsesAllocator<function<R(Args...)>, Alloc> {
31088: typedef Alloc allocator_type;
31089: }
31090: // 20.6.16.2.6, Null pointer comparisons: 
31091: template <MoveConstructible R, MoveConstructible... ArgTypes>
31092: bool operator==(const function<R(ArgTypes...)>&, nullptr_t);
31093: template <MoveConstructible R, MoveConstructible... ArgTypes>
31094: bool operator==(nullptr_t, const function<R(ArgTypes...)>&);
31095: template <MoveConstructible R, MoveConstructible... ArgTypes>
31096: bool operator!=(const function<R(ArgTypes...)>&, nullptr_t);
31097: template <MoveConstructible R, MoveConstructible... ArgTypes>
31098: bool operator!=(nullptr_t, const function<R(ArgTypes...)>&);
31099: // 20.6.16.2.7, specialized algorithms: 
31100: template <MoveConstructible R, MoveConstructible... ArgTypes>
31101: void swap(function<R(ArgTypes...)>&, function<R(ArgTypes...)>&);
31102: } // namespace std
31103: 20.6.16.2.1 function construct/copy/destroy [func.wrap.func.con] 
31104: ∫ 20.6.16.2.1 586 
31105: 
31106: c
31107: . ISO/IEC N2800=08-0310 
31108: explicit function(); 
31109: 1 Postconditions: !*this.
31110: 2 Throws: nothing.
31111: function(nullptr_t); 
31112: 3 Postconditions: !*this.
31113: 4 Throws: nothing.
31114: function(const function& f); 
31115: 5 Postconditions: !*this if !f; otherwise, *this targets a copy of f.target(). 
31116: 6 Throws: shall not throw exceptions if f＊s target is a function pointer or a function object passed 
31117: via reference_wrapper. Otherwise, may throw bad_alloc or any exception thrown by the copy 
31118: constructor of the stored function object. [ Note: Implementations are encouraged to avoid the 
31119: use of dynamically allocated memory for small function objects, e.g., where f＊s target is an object 
31120: holding only a pointer or reference to an object and a member function pointer. 〞end note ] 
31121: function(function&& f); 
31122: 7 Effects: If !f, *this has no target; otherwise, move-constructs the target of f into the target of 
31123: *this, leaving f in a valid state with an unspecified value. 
31124: template<class F>
31125: requires CopyConstructible<F> && Callable<F, ArgTypes..> &&
31126: Convertible<Callable<F, ArgTypes...>::result_type
31127: function(F f);
31128: template<class F>
31129: requires CopyConstructible<F> && Callable<F, ArgTypes..> &&
31130: Convertible<Callable<F, ArgTypes...>::result_type
31131: function(F&& f);
31132: 8 Postconditions: !*this if any of the following hold: 
31133: 〞 f is a NULL function pointer. 
31134: 〞 f is a NULL member function pointer. 
31135: 〞 F is an instance of the function class template, and !f 
31136: 9 Otherwise, *this targets a copy of f or std::move(f) if f is not a pointer to member function, 
31137: and targets a copy of mem_fn(f) if f is a pointer to member function. 
31138: 10 Throws: shall not throw exceptions when f is a function pointer or a reference_wrapper<T> 
31139: for some T. Otherwise, may throw bad_alloc or any exception thrown by F＊s copy or move 
31140: constructor. 
31141: function& operator=(const function& f); 
31142: 11 Effects: function(f).swap(*this); 
31143: 12 Returns: *this 
31144: function& operator=(function&& f); 
31145: 13 Effects: Replaces the target of *this with the target of f, leaving f in a valid but unspecified 
31146: state. 
31147: ∫ 20.6.16.2.1 587 
31148: 
31149: c
31150: . ISO/IEC N2800=08-0310 
31151: 14 Returns: *this 
31152: function& operator=(nullptr_t); 
31153: 15 Effects: If *this != NULL, destroys the target of this.
31154: 16 Postconditions: !(*this).
31155: 17 Returns: *this
31156: template<class F>
31157: requires CopyConstructible<F> && Callable<F, ArgTypes..>
31158: && Convertible<Callable<F, ArgTypes...>::result_type
31159: operator=(F f);
31160: 18 Effects: function(f).swap(*this); 
31161: 19 Returns: *this 
31162: template<class F>
31163: requires CopyConstructible<F> && Callable<F, ArgTypes..>
31164: && Convertible<Callable<F, ArgTypes...>::result_type
31165: function& operator=(F&& f);
31166: 20 Effects: Replaces the target of *this with f, leaving f in a valid but unspecified state. [ Note: A 
31167: valid implementation is function(f).swap(*this). 
31168: 21 Returns: *this. 
31169: template<class F>
31170: requires CopyConstructible<F> && Callable<F, ArgTypes...>
31171: && Convertible<Callable<F, ArgTypes...>::result_type, R>
31172: function& operator=(reference_wrapper<F> f);
31173: 22 Effects: function(f).swap(*this); 
31174: 23 Returns: *this 
31175: 24 Throws: nothing. 
31176: 20.6.16.2.2 function modifiers [func.wrap.func.mod] 
31177: void swap(function&& other); 
31178: 1 Effects: interchanges the targets of *this and other.
31179: 2 Throws: nothing.
31180: template<class F, class A> void assign(F f, const A& a); 
31181: Effects: function(f, a).swap(*this) 
31182: 20.6.16.2.3 function capacity [func.wrap.func.cap] 
31183: explicit operator bool() const 
31184: 1 Returns: true if *this has a target, otherwise false.
31185: 2 Throws: nothing.
31186: ∫ 20.6.16.2.3 588 
31187: 
31188: c
31189: . ISO/IEC N2800=08-0310 
31190: 20.6.16.2.4 function invocation [func.wrap.func.inv] 
31191: R operator()(ArgTypes... args) const 
31192: 1 Effects: INVOKE (f, t1, t2, ..., tN, R) (20.6.2), where f is the target object (20.6.1) of *this 
31193: and t1, t2, ..., tN are the values in args.... 
31194: 2 Returns: Nothing if R is void, otherwise the return value of INVOKE (f, t1, t2, ..., tN, R). 
31195: 3 Throws: bad_function_call if !*this; otherwise, any exception thrown by the wrapped function 
31196: object. 
31197: 20.6.16.2.5 function target access [func.wrap.func.targ] 
31198: const std::type_info& target_type() const; 
31199: 1 Returns: If *this has a target of type T, typeid(T); otherwise, typeid(void). 
31200: 2 Throws: nothing. 
31201: template<typename T> 
31202: requires Callable<T, ArgTypes...> && Convertible<Callable<T, ArgTypes...>::result_type, R> 
31203: T* target(); 
31204: template<typename T> 
31205: requires Callable<T, ArgTypes...> && Convertible<Callable<T, ArgTypes...>::result_type, R> 
31206: const T* target() const; 
31207: 3 Returns: If type() == typeid(T), a pointer to the stored function target; otherwise a null 
31208: pointer. 
31209: 4 Throws: nothing. 
31210: 20.6.16.2.6 null pointer comparison operators [func.wrap.func.nullptr] 
31211: template <MoveConstructible R, MoveConstructible... ArgTypes>
31212: bool operator==(const function<R(ArgTypes...)>& f, nullptr_t);
31213: template <MoveConstructible R, MoveConstructible... ArgTypes>
31214: bool operator==(nullptr_t, const function<R(ArgTypes...)>& f);
31215: 1 Returns: !f. 
31216: 2 Throws: nothing. 
31217: template <MoveConstructible R, MoveConstructible... ArgTypes>
31218: bool operator!=(const function<R(ArgTypes...)>& f, nullptr_t);
31219: template <MoveConstructible R, MoveConstructible... ArgTypes>
31220: bool operator!=(nullptr_t, const function<R(ArgTypes...)>& f);
31221: 3 Returns: (bool) f. 
31222: 4 Throws: nothing. 
31223: 20.6.16.2.7 specialized algorithms [func.wrap.func.alg] 
31224: template<Returnable R, CopyConstructible... ArgTypes>
31225: void swap(function<R(ArgTypes...)>& f1, function<R(ArgTypes...)>& f2);
31226: ∫ 20.6.16.2.7 589 
31227: 
31228: c
31229: . ISO/IEC N2800=08-0310 
31230: 1 Effects: f1.swap(f2); 
31231: 20.6.17 Class template hash [unord.hash] 
31232: 1 The unordered associative containers defined in Clause 23.4 use specializations of hash as the default 
31233: hash function. This class template is only required to be instantiable for integer types (3.9.1), floating-
31234: point types (3.9.1), pointer types (8.3.1), and std::string, std::u16string, std::u32string, std 
31235: ::wstring, std::error_code, std::thread::id, std::bitset, and std::vector<bool>. 
31236: namespace std {
31237: template <class T>
31238: struct hash : public std::unary_function<T, std::size_t> {
31239: std::size_t operator()(T val) const;
31240: };
31241: }
31242: 2 The return value of operator() is unspecified, except that equal arguments shall yield the same result. 
31243: operator() shall not throw exceptions. 
31244: 20.6.18 Class template reference_closure [func.referenceclosure] 
31245: namespace std {
31246: template<class> class reference_closure; // undefined
31247: template<class R , class... ArgTypes >
31248: class reference_closure<R (ArgTypes...)> {
31249: public:
31250: typedef R result_type;
31251: typedef T1 argument_type; // iff sizeof...(ArgTypes) == 1 and ArgTypes contains T1
31252: typedef T1 first_argument_type; // iff sizeof...(ArgTypes) == 2 and ArgTypes contains T1,
31253: T2 
31254: typedef T2 second_argument_type; // iff sizeof...(ArgTypes) == 2 and ArgTypes contains T1, 
31255: T 2 
31256: // 20.6.18.1, construct/copy/destroy: 
31257: reference_closure() = default;
31258: reference_closure(const reference_closure&) = default;
31259: constexpr reference_closure(nullptr_t);
31260: reference_closure& operator=(const reference_closure&) = default;
31261: reference_closure& operator=(nullptr_t);
31262: ~reference_closure() = default;
31263: // 20.6.18.2, observer: 
31264: explicit operator bool() const; 
31265: // 20.6.18.3, invocation: 
31266: R operator()(ArgTypes...) const;
31267: };
31268: // 20.6.18.4, comparisons: 
31269: template <class R, class... ArgTypes> 
31270: bool operator==(const reference_closure<R (ArgTypes...)>&, nullptr_t); 
31271: template <class R, class... ArgTypes> 
31272: bool operator==(nullptr_t, const reference_closure<R (ArgTypes...)>&); 
31273: template <class R, class... ArgTypes> 
31274: ∫ 20.6.18 590 
31275: 
31276: . ISO/IEC N2800=08-0310 
31277: bool operator!=(const reference_closure<R(ArgTypes...)>&, nullptr_t); 
31278: template <class R, class... ArgTypes> 
31279: bool operator!=(nullptr_t, const reference_closure<R (ArgTypes...)>&); 
31280: } 
31281: 1 The reference_closure class template represents reference-only closures (5.1.1). 
31282: 2 A reference_closure object f of type F is Callable for argument types T1, T2, ..., TN in ArgTypes 
31283: and a return type R if, given lvalues t1, t2, ..., tN of types T1, T2, ..., TN, respectively, IN-
31284: VOKE (f, t1, t2, ..., tN) is well formed and, if R is not void, convertible to R. 
31285: 3 The instances of reference_closure class template are trivial and standard-layout classes (3.9). 
31286: 4 Unless otherwise specified, the functions in this section do not throw exceptions. 
31287: 20.6.18.1 Construct, copy, destroy [func.referenceclosure.cons] 
31288: reference_closure(); 
31289: 1 Postcondition: None 〞 the object state is undefined. 
31290: reference_closure(const reference_closure& f) 
31291: 2 Postcondition: *this is a copy of f. 
31292: reference_closure(nullptr_t) 
31293: 3 Postcondition: !*this 
31294: reference_closure& operator=(const reference_closure& f) 
31295: 4 Postcondition: *this is a copy of f. 
31296: 5 Returns: *this. 
31297: reference_closure& operator=(nullptr_t); 
31298: 6 Postcondition: !*this 
31299: 7 Returns: *this 
31300: reference_closure(); 
31301: 8 Effects: destroys the object. 
31302: 20.6.18.2 Observer 
31303: explicit operator bool() const; 
31304: [func.referenceclosure.obs] 
31305: 1 Returns: true if *this was constructed or copied from a closure, false if *this was constructed 
31306: or copied from an object of type nullptr_t, undefined otherwise. 
31307: 20.6.18.3 Invocation [func.referenceclosure.invoke] 
31308: R operator()(ArgTypes... args) const; 
31309: 1 Effects: Undefined if *this was default constructed, constructed from an object of type nullptr_-
31310: t or copied from such. Otherwise, invokes the closure with the given arguments. 
31311: 2 Returns: Nothing if R is void, otherwise the return value of the closure. 
31312: ∫ 20.6.18.3 591 
31313: 
31314: c
31315: . ISO/IEC N2800=08-0310 
31316: 3 Throws: Any exception thrown by the wrapped function object. 
31317: 20.6.18.4 Comparison [func.referenceclosure.compare] 
31318: template <class R, class... ArgTypes> 
31319: bool operator==(const reference_closure<R(ArgTypes...)>& f, nullptr_t);
31320: template <class R, class... ArgTypes>
31321: bool operator==(nullptr_t, const reference_closure<R(ArgTypes...)>& f; 
31322: 1 Returns: !f 
31323: template <class R, class... ArgTypes> 
31324: bool operator!=(const reference_closure<R(ArgTypes...)>& f, nullptr_t);
31325: template <class R, class... ArgTypes>
31326: bool operator!=(nullptr_t, const reference_closure<R(ArgTypes...)>& f; 
31327: 2 Returns: (bool)f 
31328: 20.7 Memory [memory] 
31329: 1 Header <memory_concepts> synopsis 
31330: namespace std { 
31331: // 20.7.2.2 Allocator concepts 
31332: auto concept Allocator<Typename Alloc> see below ; 
31333: // 20.7.3 Allocator element concepts 
31334: auto concept HasAllocatorType<class T> see below ; 
31335: auto concept UsesAllocator<class T, class Alloc> see below ; 
31336: concept ConstructibleWithAllocator<class T, class Alloc, class... Args> see below ; 
31337: template <Allocator alloc, class T, class... Args> 
31338: requires see below 
31339: concept_map ConstructibleWithAllocator<T, Alloc, Args&&...> see below ; 
31340: concept AllocatableElement<class Alloc, class T, class... Args> see below ; 
31341: template <Allocator Alloc, class T, class... Args> 
31342: requires HasConstructor<T, Args&&...> 
31343: concept_map AllocatableElement<Alloc, T, Args&&...> see below ;
31344: }
31345: 2 Header <memory> synopsis 
31346: namespace std { 
31347: // 20.7.1, allocator argument tag 
31348: struct allocator_arg_t { }; 
31349: const allocator_arg_t allocator_arg = allocator_arg_t(); 
31350: // 20.7.3, allocator-related traits 
31351: template <class Alloc> struct is_scoped_allocator; 
31352: // 20.7.4, allocation propagation traits 
31353: template <class Alloc> struct allocator_propagate_never;
31354: template <class Alloc> struct allocator_propagate_on_copy_construction;
31355: template <class Alloc> struct allocator_propagate_on_move_assignment;
31356: ∫ 20.7 592 
31357: 
31358: c
31359: . ISO/IEC N2800=08-0310 
31360: template <class Alloc> struct allocator_propagate_on_copy_assignment;
31361: template <class Alloc> struct allocator_propagation_map;
31362: // 20.7.6, the default allocator: 
31363: template <class T> class allocator;
31364: template <ObjectType T>
31365: concept_map Allocator<allocator<T> > { };
31366: template <> class allocator<void>;
31367: template <class T, class U>
31368: bool operator==(const allocator<T>&, const allocator<U>&) throw();
31369: template <class T, class U>
31370: bool operator!=(const allocator<T>&, const allocator<U>&) throw();
31371: // 20.7.7, scoped allocator adaptor 
31372: template <Allocator OuterA, Allocator InnerA = unspecified allocator type> 
31373: class scoped_allocator_adaptor; 
31374: template <Allocator Alloc> 
31375: class scoped_allocator_adaptor<Alloc, unspecified allocator type>; 
31376: template <Allocator OuterA, Allocator InnerA> 
31377: struct is_scoped_allocator<scoped_allocator_adaptor<OuterA, InnerA> > 
31378: : true_type { }; 
31379: template <Allocator OuterA, Allocator InnerA> 
31380: struct allocator_propagate_never<scoped_allocator_adaptor<OuterA, InnerA> > 
31381: : true_type { }; 
31382: template <Allocator OuterA1, Allocator OuterA2, Allocator InnerA> 
31383: bool operator==(const scoped_allocator_adaptor<OuterA1, InnerA1>& a,) 
31384: const scoped_allocator_adaptor<OuterA2, InnerA>& b); 
31385: template <Allocator OuterA1, Allocator OuterA2, Allocator InnerA> 
31386: bool operator!=(const scoped_allocator_adaptor<OuterA1, InnerA1>& a,) 
31387: const scoped_allocator_adaptor<OuterA2, InnerA>& b); 
31388: // 20.7.8, raw storage iterator: 
31389: template <class OutputIterator, class T> class raw_storage_iterator; 
31390: // 20.7.9, temporary buffers: 
31391: template <class T>
31392: pair<T*,ptrdiff_t> get_temporary_buffer(ptrdiff_t n);
31393: template <class T>
31394: void return_temporary_buffer(T* p);
31395: // 20.7.10, construct element 
31396: template <Allocator Alloc, class T, class... Args>
31397: requires AllocatableElement<Alloc, T, Args&&...>
31398: void construct_element(Alloc& alloc, T& r, Args&&... args);
31399: // 20.7.11, specialized algorithms: 
31400: template <ObjectType T> T* addressof(T& r);
31401: template <ObjectType T> T* addressof(T&& r);
31402: template <class InputIterator, class ForwardIterator>
31403: ForwardIterator uninitialized_copy(InputIterator first, InputIterator last, 
31404: ForwardIterator result); 
31405: template <class InputIterator, class Size, class ForwardIterator> 
31406: ForwardIterator uninitialized_copy_n(InputIterator first, Size n, 
31407: ForwardIterator result); 
31408: template <class ForwardIterator, class T> 
31409: ∫ 20.7 593 
31410: 
31411: . ISO/IEC N2800=08-0310 
31412: void uninitialized_fill(ForwardIterator first, ForwardIterator last,
31413: const T& x);
31414: template <class ForwardIterator, class Size, class T>
31415: void uninitialized_fill_n(ForwardIterator first, Size n, const T& x);
31416: // 20.7.12 Class unique_ptr: 
31417: template <class X> class default_delete;
31418: template <class X, class D = default_delete<T>> class unique_ptr;
31419: // 20.7.13.1, Class bad_weak_ptr: 
31420: class bad_weak_ptr; 
31421: // 20.7.13.2, Class template shared_ptr: 
31422: template<class T> class shared_ptr; 
31423: // 20.7.13.2.7, shared_ptr comparisons: 
31424: template<class T, class U> 
31425: bool operator==(shared_ptr<T> const& a, shared_ptr<U> const& b);
31426: template<class T, class U>
31427: bool operator!=(shared_ptr<T> const& a, shared_ptr<U> const& b);
31428: template<class T, class U>
31429: bool operator<(shared_ptr<T> const& a, shared_ptr<U> const& b);
31430: template <class T, class U>
31431: bool operator>(shared_ptr<T> const& a, shared_ptr<U> const& b);
31432: template <class T, class U>
31433: bool operator<=(shared_ptr<T> const& a, shared_ptr<U> const& b);
31434: template <class T, class U>
31435: bool operator>=(shared_ptr<T> const& a, shared_ptr<U> const& b); 
31436: // 20.7.13.2.9, shared_ptr specialized algorithms: 
31437: template<class T> void swap(shared_ptr<T>& a, shared_ptr<T>& b); 
31438: // 20.7.13.2.10, shared_ptr casts: 
31439: template<class T, class U> 
31440: shared_ptr<T> static_pointer_cast(shared_ptr<U> const& r);
31441: template<class T, class U>
31442: shared_ptr<T> dynamic_pointer_cast(shared_ptr<U> const& r);
31443: template<class T, class U>
31444: shared_ptr<T> const_pointer_cast(shared_ptr<U> const& r); 
31445: // 20.7.13.2.8, shared_ptr I/O: 
31446: template<class E, class T, class Y> 
31447: basic_ostream<E, T>& operator<< (basic_ostream<E, T>& os, shared_ptr<Y> const& p); 
31448: // 20.7.13.2.11, shared_ptr get_deleter: 
31449: template<class D, class T> D* get_deleter(shared_ptr<T> const& p); 
31450: // 20.7.13.3, Class template weak_ptr: 
31451: template<class T> class weak_ptr; 
31452: // 20.7.13.3.6, weak_ptr specialized algorithms: 
31453: template<class T> void swap(weak_ptr<T>& a, weak_ptr<T>& b); 
31454: // 20.7.13.4 Class template owner_less 
31455: template <class T> class owner_less; 
31456: ∫ 20.7 594 
31457: 
31458: . ISO/IEC N2800=08-0310 
31459: // 20.7.13.5, Class enable_shared_from_this: 
31460: template<class T> class enable_shared_from_this; 
31461: // 20.7.13.6, shared_ptr atomic access: 
31462: template<class T>
31463: bool atomic_is_lock_free(const shared_ptr<T>* p);
31464: template<class T> 
31465: shared_ptr<T> atomic_load(const shared_ptr<T>* p); 
31466: template<class T> 
31467: shared_ptr<T> atomic_load_explicit(const shared_ptr<T>* p, memory_order mo); 
31468: template<class T> 
31469: void atomic_store(shared_ptr<T>* p, shared_ptr<T> r); 
31470: template<class T> 
31471: void atomic_store_explicit(shared_ptr<T>* p, shared_ptr<T> r, memory_order mo); 
31472: template<class T> 
31473: shared_ptr<T> atomic_exchange(shared_ptr<T>* p, shared_ptr<T> r); 
31474: template<class T> 
31475: shared_ptr<T> atomic_exchange_explicit(shared_ptr<T>* p, shared_ptr<T> r, 
31476: memory_order mo); 
31477: template<class T> 
31478: bool atomic_compare_exchange_weak( 
31479: shared_ptr<T>* p, shared_ptr<T>* v, shared_ptr<T> w); 
31480: template<class T> 
31481: bool atomic_compare_exchange_strong( 
31482: shared_ptr<T>* p, shared_ptr<T>* v, shared_ptr<T> w); 
31483: template<class T> 
31484: bool atomic_compare_exchange_weak_explicit( 
31485: shared_ptr<T>* p, shared_ptr<T>* v, shared_ptr<T> w, 
31486: memory_order success, memory_order failure); 
31487: template<class T> 
31488: bool atomic_compare_exchange_strong_explicit( 
31489: shared_ptr<T>* p, shared_ptr<T>* v, shared_ptr<T> w, 
31490: memory_order success, memory_order failure); 
31491: // 20.7.13.7, Pointer safety 
31492: enum class pointer_safety { relaxed, preferred, strict }; 
31493: void declare_reachable(void *p); 
31494: template <class T> T *undeclare_reachable(T *p); 
31495: void declare_no_pointers(char *p, size_t n); 
31496: void undeclare_no_pointers(char *p, size_t n); 
31497: pointer_safety get_pointer_safety(); 
31498: // 20.7.14, Pointer alignment function 
31499: void *align(std::size_t alignment, std::size_t size, 
31500: void *&ptr, std::size_t& space); 
31501: } 
31502: 20.7.1 Allocator argument tag [allocator.tag] 
31503: namespacestd { 
31504: ∫ 20.7.1 595 
31505: 
31506: c
31507: . ISO/IEC N2800=08-0310 
31508: struct allocator_arg_t { };
31509: const allocator_arg_t allocator_arg = allocator_arg_t();
31510: } 
31511: 1 The allocator_arg_t struct is an empty structure type used as a unique type to disambiguate con-
31512: structor and function overloading. Specifically, several types (see pair, 20.2.3) have constructors with 
31513: allocator_arg_t as the first argument, immediately followed by an argument of a type that satisfies 
31514: the Allocator requirements (20.7.2.2). 
31515: 20.7.2 Allocators [allocator] 
31516: 20.7.2.1 In general [allocator.general] 
31517: 1 The library describes a standard set of requirements for allocators, which are objects that encapsulate 
31518: the information about an allocation model. This information includes the knowledge of pointer types, 
31519: the type of their difference, the type of the size of objects in this allocation model, as well as the memory 
31520: allocation and deallocation primitives for the model. All of the string types (21) and containers (23) 
31521: are parametrized in terms of allocators. 
31522: 2 If the alignment associated with a specific over-aligned type is not supported by an allocator, instan-
31523: tiation of the allocator for that type may fail. The allocator also may silently ignore the requested 
31524: alignment. [ Note: additionally, the member function allocate for that type may fail by throwing an 
31525: object of type std::bad_alloc. 〞 end note ] 
31526: 20.7.2.2 Allocator concept [allocator.concepts] 
31527: auto concept Allocator<typename X> : 
31528: CopyConstructible<X>, EqualityComparable<X> {
31529: ObjectType value_type = typename X::value_type;
31530: Dereferenceable pointer = see below ;
31531: Dereferenceable const_pointer = see below ;
31532: requires Regular<pointer>
31533: && RandomAccessIterator<pointer>
31534: && Regular<const_pointer>
31535: && RandomAccessIterator<const_pointer>;
31536: SignedIntegralLike difference_type =
31537: RandomAccessIter<pointer>::difference_type;
31538: typename generic_pointer = void*; 
31539: typename const_generic_pointer = const void*; 
31540: typename reference = value_type&; 
31541: typename const_reference = const value_type&; 
31542: UnsignedIntegralLike size_type = see below ; 
31543: template <ObjectType T> class rebind = see below ; 
31544: requires Destructible<value_type>; 
31545: requires Convertible<pointer, const_pointer>
31546: && Convertible<pointer, generic_pointer>
31547: && SameType<pointer::reference, value_type&>
31548: && SameType<pointer::reference, reference>;
31549: requires Convertible<const_pointer, const_generic_pointer> 
31550: && SameType<const_pointer::reference, const value_type&> 
31551: && Sametype<const_pointer::reference, const_reference>; 
31552: requires Sametype<rebind<value_type>, X>;
31553: requires SameType<generic_pointer,
31554: rebind<unspecified unique type>::generic_pointer>;
31555: requires SameType<const_generic_pointer,
31556: ∫ 20.7.2.2 596 
31557: 
31558: c
31559: . ISO/IEC N2800=08-0310 
31560: rebind<unspecified unique type>::const_generic_pointer>; 
31561: pointer X::allocate(size_type n);
31562: pointer X::allocate(size_type n, const_generic_pointer p);
31563: void X::deallocate(pointer p, size_type n);
31564: size_type X::max_size() const { return numeric_limits<size_type>::max(); }
31565: template <ObjectType T> X::X(const rebind<T>& y);
31566: template <class... Args>
31567: requires Hasconstructor<value_type, Args&&...>
31568: void X::construct(value_type* p, Args&&... args) {
31569: ::new ((void*)p) value_type(forward<Args>(args)...);
31570: }
31571: void X::destroy(value_type* p) {
31572: addressof(*p)->value_type();
31573: } 
31574: pointer X::addressof(reference r) const {
31575: return addressof(r); // see below
31576: }
31577: const_pointer X::addressof(const_reference r) const {
31578: return addressof(r); // see below
31579: }
31580: }
31581: ObjectType value_type; 
31582: 1 Type: the type of objects allocated by X. 
31583: Dereferenceable pointer;
31584: Dereferenceable const_pointer;
31585: 2 Type: a pointer-like (const pointer-like) type used to refer to memory allocated by objects of 
31586: type X. The default pointer type is X::pointer if such a type is declared and value_type* 
31587: otherwise. The default const_pointer type is X::const_pointer if such a type is declared and 
31588: const value_type* otherwise. The behavior is undefined if an exception is propagated when 
31589: applying any operation from the Regular concept to a pointer, const_pointer, generic_-
31590: pointer, or const_generic_pointer. 
31591: SignedIntegralLike difference_type; 
31592: 3 Type: a type that can represent the difference between any two pointers in the allocation model. 
31593: typename generic_pointer;
31594: typename const_generic_pointer;
31595: 4 Type: a type that can store the value of a pointer (const_pointer) from any allocator in the 
31596: same family (see member template rebind in 20.7.2.1) as X and which will produce the same 
31597: value when explicitly converted back to that pointer type. For any two allocators X and Y of the 
31598: same family, the implementation of a library facility using Allocator<X> and Allocator<Y> may 
31599: add the additonal requirements SameType<Allocator<X>::generic_pointer, Allocator<Y>:: 
31600: generic_pointer> and SameType<Allocator<X>::const_generic_pointer, Allocator<Y>:: 
31601: const_generic_pointer>.[ Example: 
31602: template <ObjectType T, Allocator Alloc = allocator<T> >
31603: requires Destructible<T> &&
31604: SameType<Alloc::generic_pointer,
31605: ∫ 20.7.2.2 597 
31606: 
31607: c
31608: . ISO/IEC N2800=08-0310 
31609: Alloc::Rebind<list_node<T>>::generic_pointer> && 
31610: SameType<Alloc::const_generic_pointer, 
31611: Alloc::Rebind<list_node<T>>::const_generic_pointer> && 
31612: class list; 
31613: 〞end example ] 
31614: typename reference;
31615: typename const_reference;
31616: 5 Type: a reference (const reference) to a value_type object. 
31617: UnsignedIntegralLike size_type; 
31618: 6 Type: a type that can represent the size of the largest object in the allocation model. The default 
31619: size_type is X::size_type if such a type is declared and std::size_t otherwise. 
31620: template <ObjectType T> class rebind; 
31621: 7 Class template: instantiations of the template are allocators in the same family as X, that is, 
31622: if the name X is bound to SomeAllocator<value_type>, then rebind<U> is the same type as 
31623: SomeAllocator<U>. The resulting type SomeAllocator<U> shall meet the requirements of the 
31624: Allocator concept. The default template for rebind is a template R for which R<U> is X::template 
31625: rebind<U>::other. 
31626: pointer X::allocate(size_type n);
31627: pointer X::allocate(size_type n, const_generic_pointer hint);
31628: 8 Effects: contiguous memory is allocated for n objects of type value_type but the objects are not 
31629: constructed.226 
31630: 9 Returns: a pointer to the allocated memory. [ Note: if n == 0, the return value is unspecified. 
31631: 〞end note ] 
31632: 10 Remark: the meaning of hint is not specified, but it should be used as an aid to locality. [ Note: 
31633: in a container member function, a pointer to an adjacent element is often a good choice for the 
31634: hint argument. 〞end note ] 
31635: void X::deallocate(pointer p, size_type n); 
31636: 11 Preconditions: p shall be a non-singular pointer value obtained from a call to allocate() on 
31637: this allocator or one that compares equal to it. p shall not have been passed to deallocate() 
31638: since the call to allocate(). n shall equal the value passed as the first argument in the call to 
31639: allocate(). All n value_type objects in the area pointed to by p shall have been destroyed 
31640: prior to this call. 
31641: 12 Effects: deallocates the storage referenced by p. 
31642: 13 Throws: nothing. 
31643: size_type X::max_size(); 
31644: 14 Returns: the largest value that can meaningfully be passed to X::allocate(). 
31645: template <class... Args>
31646: requires Hasconstructor<value_type, Args&&...>
31647: 226) a.allocate should be an efficient means of allocating a single object of type T, even when sizeof(T) is small. That is, 
31648: there is no need for a container to maintain its own free list. 
31649: ∫ 20.7.2.2 598 
31650: 
31651: . ISO/IEC N2800=08-0310 
31652: void X::construct(value_type* p, Args&&... args); 
31653: 15 Effects: calls the constructor for the object at p, using the constructor arguments args. 
31654: 16 Default behavior: ::new ((void*)p) value_type(forward<Args>(args)...); 
31655: void X::destroy(value_type* p); 
31656: 17 Effects: calls the destructor on the object at p but does not deallocate it. 
31657: 18 Default behavior: p->value_type(); 
31658: pointer X::address(reference r) const;
31659: const_pointer X::address(const_reference r) const;
31660: 19 Precondition: r is a reference to an object that was allocated from this allocator or one that 
31661: compares equal to it. 
31662: 20 Returns: a pointer to the object referred to by r. This concept defines a default implementation 
31663: of address only if pointer is the same as value_type*. 
31664: 20.7.3 Allocator-related element concepts [allocator.element.concepts] 
31665: auto concept HasAllocatorType<typename T> {
31666: typename allocator_type = T::allocator_type;
31667: requires Allocator<allocator_type>;
31668: } 
31669: 1 Remark: automatically detects whether T has a nested allocator_type that meets the require-
31670: ments of an allocator. 
31671: auto concept UsesAllocator<typename T, typename Alloc> {
31672: requires Allocator<alloc>;
31673: typename allocator_type = T::allocator_type;
31674: requires Allocator<allocator_type>
31675: && Convertible<Alloc, allocator_type>;
31676: }
31677: 2 Remark: Automatically detects whether T has a nested allocator_type that is convertible from 
31678: Alloc. A program may define a concept map UsesAllocator<T, Alloc> for a user-defined 
31679: type T that does not have a nested allocator_type but is nonetheless constructible using the 
31680: specified Alloc.[ Note: although the default concept maps for the concepts UsesAllocator and 
31681: HasAllocatorType often cause them to appear in pairs, there is no inherent relationship between 
31682: UsesAllocator and HasAllocatorType, nor between !UsesAllocator and !HasAllocatorType. 
31683: 〞end note ] 
31684: template <class Alloc> struct is_scoped_allocator : false_type { }; 
31685: 3 [ Note: If a specialization is_scoped_allocator<Alloc> is derived from true_type, it indicates 
31686: that Alloc is a scoped allocator. A scoped allocator specifies the memory resource to be used by 
31687: a container (as all allocators do) and also specifies an inner allocator resource to be used by every 
31688: element of the container. 〞end note ] 
31689: 4 Requires: If a specialization is_scoped_allocator<Alloc> is derived from true_type, Alloc 
31690: shall have a nested type inner_allocator_type and a member function inner_allocator() 
31691: which is callable with no arguments and which returns an object of a type that is convertible to 
31692: inner_allocator_type. 
31693: ∫ 20.7.3 599 
31694: 
31695: c
31696: . ISO/IEC N2800=08-0310 
31697: concept ConstructibleWithAllocator<class T, class Alloc, class... Args> {
31698: T::T(allocator_arg_t, Alloc, Args&&);
31699: } 
31700: 5 [ Note: The ConstructibleWithAllocator concept provides a uniform interface for passing an allo-
31701: cator to an object＊s constructor. 〞end note ] 
31702: 6 The library shall define concept map templates to adapt ConstructibleWithAllocator for each pat-
31703: tern of constraints in Table 42. Each concept map shall adapt T＊s constructor, mapping the variadic 
31704: argument pack from its position in the ConstructibleWithAllocator concept into its corresponding 
31705: position in the actual constructor for T and mapping the Alloc and allocator_arg_t arguments to 
31706: their appropriate positions, if any, in the argument list for T＊s constructor. The concept maps shall be 
31707: constrained such that, in situations where a set of types matches more than one pattern, the partial 
31708: ordering of concept maps gives precedence to those patterns described earlier in the table. [ Note: 
31709: there are concept maps to encompass almost all types, including those that don＊t use allocators at all. 
31710: However, there is no concept map in this library for a type that uses an allocator but does not support 
31711: passing the specified allocator to the specified constructor. The last restriction prevents the allocator 
31712: being quitely ignored in a context where the user is likely to expect it to be used. 〞end note ] 
31713: Table 42 〞 ConstructibleWithAllocator concept map con-
31714: straint patterns 
31715: Concept requirements Constructor requirement 
31716: UsesAllocator<T, Alloc> T::T(allocator_arg_t, Alloc, Args&&...) 
31717: UsesAllocator<T, Alloc> T::T(Args&&..., Alloc) 
31718: !HasAllocatorType<T> && T::T(Args&&...) 
31719: !UsesAllocator<T, Alloc> 
31720: 7 The AllocatableElement concept provides a uniform interface (see 20.7.10) for constructing an object 
31721: from an allocator. A concept map provides a default implementation that is suitable for most alloca-
31722: tors. Specific allocator templates may provide more specialized concept maps (for example, 20.7.7.) 
31723: [ Note: ConstructibleWithAllocator describes how to construct an item that uses an allocator; 
31724: AllocatableElement describes how to consturct an item that was allocated from an allocator. 〞end 
31725: note ] 
31726: concept AllocatableElement<class Alloc, class T, class... Args> {
31727: requires Allocator<Alloc>;
31728: void construct_element(Alloc&, T*, Args&&...);
31729: } 
31730: template <Allocator Alloc, class T, class ... Args>
31731: requires HasConstructor<T, Args...>
31732: concept_map AllocatableElement<Alloc, T, Args&&...> {
31733: void construct_element(Alloc& a, T* t, Args&&... args) {
31734: Alloc::rebind<T>(a).construct(t, forward(args)...);
31735: }
31736: }
31737: 20.7.4 Allocator propagation traits [allocator.propagation] 
31738: template <class Alloc> struct allocator_propagate_never
31739: : false_type { };
31740: ∫ 20.7.4 600 
31741: 
31742: c
31743: . ISO/IEC N2800=08-0310 
31744: 1 Requires: Alloc shall be an Allocator (20.7.2.2). 
31745: 2 [ Note: If specialized to derive from true_type for a specific allocator type, indicates that a 
31746: container using the specified Alloc should not copy or move the allocator when the container is 
31747: copy-constructed, move-constructed, copy-assigned, moved-assigned, or swapped. 〞end note ] 
31748: template <class Alloc> struct allocator_propagate_on_copy_construction
31749: : false_type { };
31750: 3 Requires: Alloc shall be an Allocator (20.7.2.2). 
31751: 4 [ Note: If specialized to derive from true_type for specific allocator type, indicates that a con-
31752: tainer using the specified Alloc should copy or move the allocator when the container is copy 
31753: constructed or move constructed, but not when the container is copy assigned, moved assigned, 
31754: or swapped. 〞 end note ] 
31755: 5 Default behavior: The unspecialized trait derives from true_type if none of allocator_propagate_-
31756: never, allocator_propagate_on_move_assignment, or allocator_propagate_on_copy_assignment 
31757: is derived from true_type for the given type Alloc. Otherwise, it derives from false_type. 
31758: template <class Alloc> struct allocator_propagate_on_move_assignment
31759: : false_type { };
31760: 6 Requires: Alloc shall be an Allocator (20.7.2.2). 
31761: 7 [ Note: if specialized to derive from true_type for specific allocator type, indicates that a con-
31762: tainer using the specified Alloc should copy or move the allocator when the container is copy 
31763: constructed, move constructed, move assigned, or swapped but not when the container is copy 
31764: assigned. 〞end note ] 
31765: template <class Alloc> struct allocator_propagate_on_copy_assignment
31766: : false_type { };
31767: 8 Requires: Alloc shall be an Allocator (20.7.2.2). 
31768: 9 [ Note: If specialized to derive from true_type for a specific allocator type, indicates that a 
31769: container using the specified Alloc should copy or move the allocator when the container is copy 
31770: constructed, move constructed, move assigned, swapped or copy assigned. 〞end note ] 
31771: 20.7.5 Allocator propagation map [allocator.propagation.map] 
31772: template <class Alloc> struct allocator_propagation_map {
31773: static Alloc select_for_copy_construction(const Alloc&);
31774: static void move_assign(Alloc& to, Alloc&& from);
31775: static void copy_assign(Alloc& to, Alloc& from);
31776: static void swap(Alloc& a, Alloc& b);
31777: } 
31778: 1 Requires: Exactly one propagation trait shall derive from true_type for Alloc. 
31779: 2 [ Note: The allocator_propagation_map provides functions to be used by containers for manip-
31780: ulating allocators during construction, assignment, and swap operations. The implementations 
31781: of the functions above are dependent on the allocator propagation traits of the specific Alloc. 
31782: 〞end note ] 
31783: static Alloc select_for_copy_construction(const Alloc&); 
31784: 3 Returns: Alloc() if allocator_propagate_never<Alloc>::value is true, otherwise x. 
31785: ∫ 20.7.5 601 
31786: 
31787: c
31788: . ISO/IEC N2800=08-0310 
31789: static void move_assign(Alloc& to, Alloc&& from); 
31790: 4 Effects: If allocator_propagate_on_move_assignment<Alloc>::value is true or if allocator_-
31791: propa-gate_on_copy_assignment<Alloc>::value is true, assigns to = forward(from); oth-
31792: erwise does nothing. 
31793: static void copy_assign(Alloc& to, Alloc& from); 
31794: Effects: If allocator_propagate_on_copy_assignment<Alloc>::value is true, assigns to = 
31795: from; otherwise does nothing. 
31796: static void swap(Alloc& a, Alloc& b); 
31797: 5 Effects: If allocator_propagate_on_move_assignment<Alloc>::value is true or if allocator_-
31798: propa-gate_on_copy_assignment<Alloc>::value is true, exchanges the values of a and b; 
31799: otherwise, if a == b, does nothing; otherwise the behavior is undefined. 
31800: 20.7.6 The default allocator [default.allocator] 
31801: namespace std {
31802: template <class T> class allocator;
31803: // specialize for void:
31804: template <> class allocator<void> {
31805: public:
31806: typedef void* pointer;
31807: typedef const void* const_pointer;
31808: // reference-to-void members are impossible.
31809: typedef void value_type;
31810: template <class U> struct rebind { typedef allocator<U> other; };
31811: }; 
31812: template <class T> class allocator { 
31813: public: 
31814: typedef size_t size_type; 
31815: typedef ptrdiff_t difference_type; 
31816: typedef T* pointer; 
31817: typedef const T* const_pointer; 
31818: typedef T& reference; 
31819: typedef const T& const_reference; 
31820: typedef T value_type; 
31821: template <class U> struct rebind { typedef allocator<U> other; }; 
31822: allocator() throw();
31823: allocator(const allocator&) throw();
31824: template <class U> allocator(const allocator<U>&) throw();
31825: ~allocator() throw(); 
31826: pointer address(reference x) const;
31827: const_pointer address(const_reference x) const;
31828: pointer allocate( 
31829: size_type, allocator<void>::const_pointer hint = 0);
31830: void deallocate(pointer p, size_type n);
31831: size_type max_size() const throw();
31832: ∫ 20.7.6 602 
31833: 
31834: c
31835: . ISO/IEC N2800=08-0310 
31836: template<class... Args> void construct(pointer p, Args&&... args); 
31837: void destroy(pointer p); 
31838: }; 
31839: } 
31840: 20.7.6.1 allocator members [allocator.members] 
31841: 1 Except for the destructor, member functions of the default allocator shallnot introduce data races (1.10) 
31842: as a result of concurrent calls to those member functions from different threads. Calls to these func-
31843: tions that allocate or deallocate a particular unit of storage shall occur in a single total order, and 
31844: each such deallocation call shall happen before the next allocation (if any) in this order. 
31845: pointer address(reference x) const; 
31846: 2 Returns: The actual address of the object referenced by x, even in the presence of an overloaded 
31847: operator&. 
31848: const_pointer address(const_reference x) const; 
31849: 3 Returns: The actual address of the object referenced by x, even in the presence of an overloaded 
31850: operator&. 
31851: pointer allocate(size_type n, allocator<void>::const_pointer hint=0); 
31852: 4 [ Note: In a container member function, the address of an adjacent element is often a good choice 
31853: to pass for the hint argument. 〞 end note ] 
31854: 5 Returns: a pointer to the initial element of an array of storage of size n * sizeof(T), aligned 
31855: appropriately for objects of type T. It is implementation-defined whether over-aligned types are 
31856: supported (3.11). 
31857: 6 Remark: the storage is obtained by calling ::operator new(std::size_t) (18.5.1), but it is 
31858: unspecified when or how often this function is called. The use of hint is unspecified, but intended 
31859: as an aid to locality if an implementation so desires. 
31860: 7 Throws: bad_alloc if the storage cannot be obtained. 
31861: void deallocate(pointer p, size_type n); 
31862: 8 Requires: p shall be a pointer value obtained from allocate(). n shall equal the value passed as 
31863: the first argument to the invocation of allocate which returned p. 
31864: 9 Effects: Deallocates the storage referenced by p . 
31865: 10 Remarks: Uses ::operator delete(void*) (18.5.1), but it is unspecified when this function is 
31866: called. 
31867: size_type max_size() const throw(); 
31868: 11 Returns: the largest value N for which the call allocate(N,0) might succeed. 
31869: template <class... Args> void construct(pointer p, Args&&... args); 
31870: 12 Effects: ::new((void *)p) T(std::forward<Args>(args)...) 
31871: void destroy(pointer p); 
31872: 13 Effects: p->T() 
31873: ∫ 20.7.6.1 603 
31874: 
31875: c
31876: . ISO/IEC N2800=08-0310 
31877: 20.7.6.2 allocator globals [allocator.globals] 
31878: template <class T1, class T2>
31879: bool operator==(const allocator<T1>&, const allocator<T2>&) throw();
31880: 1 Returns: true. 
31881: template <class T1, class T2>
31882: bool operator!=(const allocator<T1>&, const allocator<T2>&) throw();
31883: 2 Returns: false. 
31884: 20.7.7 Scoped allocator adaptor [allocator.adaptor] 
31885: 1 The scoped_allocator_adaptor class template is an allocator template that specifies the memory 
31886: resource (the outer allocator) to be used by a container (as any other allocator does) and also specifies 
31887: an inner allocator resource to be used by every element in the container. This adaptor is instantiated 
31888: with outer and inner allocator types. If instantiated with only one allocator type (i.e., the second type 
31889: is void), the same allocator type is used for both the outer and inner allocator types and the same 
31890: allocator instance is used for both the outer and inner allocator instances. The interface is specialized 
31891: for the single-allocator case such that it takes only one allocator instance argument in the constructor, 
31892: versus two allocators for the general case. Otherwise, the interface to the specialized and general cases 
31893: are the same. A scoped_allocator_adaptor that is instantiated with two identical parameters is 
31894: different than an adaptor instantiated with only one parameter: the former may be constructed with 
31895: different instances of outer and inner allocators whereas the second may be constructed only with one 
31896: allocator instance. [ Note: The scoped_allocator_adaptor is derived from the outer allocator type 
31897: so it can be substituted for the outer allocator type in most expressions. 〞 end note ] 
31898: namespace std { 
31899: template<Allocator OuterA, Allocator InnerA = unspecified allocator type> 
31900: class scoped_allocator_adaptor; 
31901: template<Allocator OuterA> 
31902: class scoped_allocator_adaptor<OuterA, unspecified allocator type> : public OuterA { 
31903: public: 
31904: // outer and inner allocator types are the same: 
31905: typedef OuterA outer_allocator_type;
31906: typedef OuterA inner_allocator_type;
31907: typedef typename outer_allocator_type::size_type size_type; 
31908: typedef typename outer_allocator_type::difference_type difference_type; 
31909: typedef typename outer_allocator_type::pointer pointer; 
31910: typedef typename outer_allocator_type::const_pointer const_pointer; 
31911: typedef typename outer_allocator_type::generic_pointer generic_pointer; 
31912: typedef typename outer_allocator_type::const_generic_pointer const_generic_pointer; 
31913: typedef typename outer_allocator_type::reference reference; 
31914: typedef typename outer_allocator_type::const_reference const_reference; 
31915: typedef typename outer_allocator_type::value_type value_type; 
31916: template <ObjectType U> 
31917: struct rebind { 
31918: typedef scoped_allocator_adaptor< 
31919: Allocator<OuterA>::rebind<U>, unspecified allocator type> other; 
31920: }; 
31921: scoped_allocator_adaptor(); 
31922: ∫ 20.7.7 604 
31923: 
31924: . ISO/IEC N2800=08-0310 
31925: scoped_allocator_adaptor(scoped_allocator_adaptor&&);
31926: scoped_allocator_adaptor(const scoped_allocator_adaptor&);
31927: scoped_allocator_adaptor(OuterA&& outerAlloc);
31928: scoped_allocator_adaptor(const OuterA& outerAlloc);
31929: template <Allocator OuterA2> 
31930: requires Convertible<OuterA2&&, OuterA> 
31931: scoped_allocator_adaptor(scoped_allocator_adaptor<OuterA2, void>&&); 
31932: template <Allocator OuterA2> 
31933: requires Convertible<const OuterA2&, OuterA> 
31934: scoped_allocator_adaptor(const scoped_allocator_adaptor<OuterA2, void>&); 
31935: ~scoped_allocator_adaptor(); 
31936: pointer address(reference x) const;
31937: const_pointer address(const_reference x) const;
31938: pointer allocate(size_type n);
31939: pointer allocate(size_type n, const_generic_pointer u);
31940: void deallocate(pointer p, size_type n);
31941: size_type max_size() const;
31942: template <class... Args>
31943: requires HasConstructor<value_type, Args&&...>
31944: void construct(pointer p, Args&&... args);
31945: void destroy(pointer p);
31946: const outer_allocator_type& outer_allocator();
31947: const inner_allocator_type& inner_allocator();
31948: };
31949: template<typename OuterA, typename InnerA>
31950: class scoped_allocator_adaptor : public OuterA {
31951: public:
31952: typedef OuterA outer_allocator_type;
31953: typedef InnerA inner_allocator_type;
31954: typedef typename outer_allocator_type::size_type size_type; 
31955: typedef typename outer_allocator_type::difference_type difference_type; 
31956: typedef typename outer_allocator_type::pointer pointer; 
31957: typedef typename outer_allocator_type::const_pointer const_pointer; 
31958: typedef typename outer_allocator_type::generic_pointer generic_pointer; 
31959: typedef typename outer_allocator_type::const_generic_pointer const_generic_pointer; 
31960: typedef typename outer_allocator_type::reference reference; 
31961: typedef typename outer_allocator_type::const_reference const_reference; 
31962: typedef typename outer_allocator_type::value_type value_type; 
31963: template <ObjectType U>
31964: struct rebind {
31965: typedef scoped_allocator_adaptor<
31966: Allocator<OuterA>::rebind<U>, InnerA> other;
31967: };
31968: scoped_allocator_adaptor();
31969: scoped_allocator_adaptor(outer_allocator_type&& outerA,
31970: inner_allocator_type&& innerA);
31971: ∫ 20.7.7 605 
31972: 
31973: c
31974: . ISO/IEC N2800=08-0310 
31975: scoped_allocator_adaptor(const outer_allocator_type& outerA, 
31976: const inner_allocator_type& innerA); 
31977: scoped_allocator_adaptor(scoped_allocator_adaptor&& other); 
31978: scoped_allocator_adaptor(const scoped_allocator_adaptor& other); 
31979: template <Allocator OuterA2>
31980: requires Convertible<OuterA2&&, OuterA>
31981: scoped_allocator_adaptor(
31982: scoped_allocator_adaptor<OuterA2&,InnerA>&&); 
31983: template <Allocator OuterA2>
31984: requires Convertible<const OuterA2&, OuterA>
31985: scoped_allocator_adaptor(
31986: const scoped_allocator_adaptor<OuterA2&,InnerA>&); 
31987: ~scoped_allocator_adaptor(); 
31988: pointer address(reference x) const;
31989: const_pointer address(const_reference x) const;
31990: pointer allocate(size_type n);
31991: pointer allocate(size_type n, const_generic_pointer u);
31992: void deallocate(pointer p, size_type n);
31993: size_type max_size() const;
31994: template <class... Args>
31995: requires HasConstructor<value_type, Args&&...
31996: void construct(value_type* p, Args&&... args);
31997: void destroy(value_type* p); 
31998: const outer_allocator_type& outer_allocator() const;
31999: const inner_allocator_type& inner_allocator() const;
32000: };
32001: template<Allocator OuterA1, Allocator OuterA2, Allocator InnerA> 
32002: bool operator==(const scoped_allocator_adaptor<OuterA1,InnerA>& a, 
32003: const scoped_allocator_adaptor<OuterA2,InnerA>& b); 
32004: template<Allocator OuterA1, Allocator OuterA2, Allocator InnerA>
32005: bool operator!=(const scoped_allocator_adaptor<OuterA1,InnerA>& a,
32006: const scoped_allocator_adaptor<OuterA2,InnerA>& b);
32007: }
32008: 20.7.7.1 scoped_allocator_adaptor constructors [allocator.adaptor.cntr] 
32009: scoped_allocator_adaptor(); 
32010: 1 Effects: Initializes the outer and inner allocator instances using their corresponding default con-
32011: tructors. 
32012: scoped_allocator_adaptor(scoped_allocator_adaptor&& other);
32013: scoped_allocator_adaptor(const scoped_allocator_adaptor& other);
32014: 2 Effects: Initializes the outer and inner allocator instances from the corresponding parts of other. 
32015: scoped_allocator_adaptor(OuterA&& outer);
32016: scoped_allocator_adaptor(const OuterA& outer);
32017: ∫ 20.7.7.1 606 
32018: 
32019: c
32020: . ISO/IEC N2800=08-0310 
32021: 3 Requires: scoped_allocator_adaptor was instantiated with only one parameter. 
32022: 4 Effects: Initializes the base class (which is both the outer and inner allocator) from outer. 
32023: template <Allocator OuterA2>
32024: requires Convertible<OuterA2&&, OuterA>
32025: scoped_allocator_adaptor(
32026: scoped_allocator_adaptor<OuterA2, InnerA>&& other); 
32027: template <Allocator OuterA2>
32028: requires Convertible<OuterA2&&, OuterA>
32029: scoped_allocator_adaptor(
32030: const scoped_allocator_adaptor<OuterA2, InnerA>& other); 
32031: 5 Requires: Same<OuterA2, OuterA::rebind<value_type>::other>.
32032: 6 Effects: Initializes the outer and inner allocator instances from the corresponding parts of other.
32033: 20.7.7.2 scoped_allocator_adaptor members [allocator.adaptor.members] 
32034: pointer address(reference x) const;
32035: const_pointer address(const_reference x) const
32036: 1 Returns: outer_allocator().address(x) 
32037: pointer allocate(size_type n); 
32038: 2 Returns: outer_allocator().allocate(n) 
32039: template <typename HintP>
32040: pointer allocate(size_type n, HintP u);
32041: 3 Returns: outer_allocator().allocate(n, u) 
32042: void deallocate(pointer p, size_type n); 
32043: 4 Effects: outer_allocator().deallocate(p, n) 
32044: size_type max_size() const; 
32045: 5 Returns: outer_allocator().max_size() 
32046: template <class... Args>
32047: requires HasConstructor<value_type, Args&&...>
32048: void construct(value_type* p, Args&&... args);
32049: 6 Effects: outer_allocator().construct(p, forward<Args>(args)...) 
32050: void destroy(pointer p) 
32051: 7 Effects: outer_allocator().destroy(p) 
32052: const outer_allocator_type& outer_allocator() const; 
32053: 8 Returns: The outer allocator used to construct this object. 
32054: const inner_allocator_type& inner_allocator() const; 
32055: 9 Returns: The inner allocator used to construct this object. For the single-parameter instantiation, 
32056: returns the same reference as outer_allocator(). 
32057: ∫ 20.7.7.2 607 
32058: 
32059: c
32060: . ISO/IEC N2800=08-0310 
32061: 20.7.7.3 scoped_allocator_adaptor globals [allocator.adaptor.globals] 
32062: template<Allocator OuterA1, Allocator OuterA2, Allocator InnerA>
32063: bool operator==(const scoped_allocator_adaptor<OuterA1, InnerA>& a,
32064: const scoped_allocator_adaptor<OuterA2, InnerA>& b);
32065: 1 Returns: a.outer_allocator() == b.outer_allocator() 
32066: && a.inner_allocator() == b.inner_allocator() 
32067: template<Allocator OuterA1, Allocator OuterA2, Allocator InnerA>
32068: bool operator!=(const scoped_allocator_adaptor<OuterA1, InnerA>& a,
32069: const scoped_allocator_adaptor<OuterA2, InnerA>& b);
32070: 2 Returns: !(a == b) 
32071: 20.7.8 Raw storage iterator [storage.iterator] 
32072: 1 raw_storage_iterator is provided to enable algorithms to store their results into uninitialized mem-
32073: ory. The formal template parameter OutputIterator is required to have its operator* return an 
32074: object for which operator& is defined and returns a pointer to T, and is also required to satisfy the 
32075: requirements of an output iterator (24.1.3). 
32076: namespace std {
32077: template <class OutputIterator, class T>
32078: class raw_storage_iterator
32079: : public iterator<output_iterator_tag,void,void,void,void> {
32080: public:
32081: explicit raw_storage_iterator(OutputIterator x);
32082: raw_storage_iterator<OutputIterator,T>& operator*(); 
32083: raw_storage_iterator<OutputIterator,T>& operator=(const T& element); 
32084: raw_storage_iterator<OutputIterator,T>& operator++(); 
32085: raw_storage_iterator<OutputIterator,T> operator++(int); 
32086: };
32087: }
32088: raw_storage_iterator(OutputIterator x); 
32089: 2 Effects: Initializes the iterator to point to the same value to which x points. 
32090: raw_storage_iterator<OutputIterator,T>& operator*(); 
32091: 3 Returns: *this 
32092: raw_storage_iterator<OutputIterator,T>& operator=(const T& element); 
32093: 4 Effects: Constructs a value from element at the location to which the iterator points. 
32094: 5 Returns: A reference to the iterator. 
32095: raw_storage_iterator<OutputIterator,T>& operator++(); 
32096: 6 Effects: Pre-increment: advances the iterator and returns a reference to the updated iterator. 
32097: raw_storage_iterator<OutputIterator,T> operator++(int); 
32098: 7 Effects: Post-increment: advances the iterator and returns the old value of the iterator. 
32099: ∫ 20.7.8 608 
32100: 
32101: c
32102: . ISO/IEC N2800=08-0310 
32103: 20.7.9 Temporary buffers [temporary.buffer] 
32104: template <class T>
32105: pair<T*, ptrdiff_t> get_temporary_buffer(ptrdiff_t n);
32106: 1 Effects: Obtains a pointer to storage sufficient to store up to n adjacent T objects. It is 
32107: implementation-defined whether over-aligned types are supported (3.11). 
32108: 2 Returns: A pair containing the buffer＊s address and capacity (in the units of sizeof(T)), or a 
32109: pair of 0 values if no storage can be obtained or if n <= 0. 
32110: template <class T> void return_temporary_buffer(T* p); 
32111: 3 Effects: Deallocates the buffer to which p points.
32112: 4 Requires: The buffer shall have been previously allocated by get_temporary_buffer.
32113: 20.7.10 construct_element [construct.element] 
32114: template <Allocator Alloc, class T, class... Args>
32115: requires AllocatableElement<Alloc, T, Args&&...>
32116: void construct_element(Alloc& a, T& r, Args&&... args);
32117: 1 [ Note: The appropriate overload of the construct_element function is called from within con-
32118: tainers to construct elements during insertion operations and to move elements during reallocation 
32119: operations. It automates the process of determining whether the scoped allocator model is in use 
32120: and transmitting the inner allocator for scoped allocators. 〞 end note ] 
32121: 2 Effects: AllocatableElement<Alloc, T, Args&&...>::construct_element( a, addressof(r), 
32122: forward<Args>(args)...) 
32123: 20.7.11 Specialized algorithms [specialized.algorithms] 
32124: 1 All the iterators that are used as formal template parameters in the following algorithms are required to 
32125: have their operator* return an object for which operator& is defined and returns a pointer to T. In the 
32126: algorithm uninitialized_copy, the formal template parameter InputIterator is required to satisfy 
32127: the requirements of an input iterator (24.1.2). In all of the following algorithms, the formal template 
32128: parameter ForwardIterator is required to satisfy the requirements of a forward iterator (24.1.4) and 
32129: also to satisfy the requirements of a mutable iterator (24.1), and is required to have the property that 
32130: no exceptions are thrown from increment, assignment, comparison, or dereference of valid iterators. In 
32131: the following algorithms, if an exception is thrown there are no effects. 
32132: 20.7.11.1 addressof [object.addressof] 
32133: template <ObjectType T> T* addressof(T& r);
32134: template <ObjectType T> T* addressof(T&& r);
32135: Returns: the actual address of the object referenced by r, even in the presence of an overloaded 
32136: operator&. 
32137: 20.7.11.2 uninitialized_copy [uninitialized.copy] 
32138: template <class InputIterator, class ForwardIterator>
32139: ForwardIterator uninitialized_copy(InputIterator first, InputIterator last,
32140: ForwardIterator result);
32141: ∫ 20.7.11.2 609 
32142: 
32143: c
32144: . ISO/IEC N2800=08-0310 
32145: 1 Effects: 
32146: for (; first != last; ++result, ++first) 
32147: new (static_cast<void*>(&*result)) 
32148: typename iterator_traits<ForwardIterator>::value_type(*first); 
32149: 2 Returns: result 
32150: template <class InputIterator, class Size, class ForwardIterator>
32151: ForwardIterator uninitialized_copy_n(InputIterator first, Size n,
32152: ForwardIterator result);
32153: 3 Effects: 
32154: for ( ; n > 0; ++result, ++first, --n) { 
32155: new (static_cast<void*>(&*result)) 
32156: typename iterator_traits<ForwardIterator>::value_type(*first); 
32157: } 
32158: 4 Returns: result 
32159: 20.7.11.3 uninitialized_fill [uninitialized.fill] 
32160: template <class ForwardIterator, class T>
32161: void uninitialized_fill(ForwardIterator first, ForwardIterator last,
32162: const T& x);
32163: 1 Effects: 
32164: for (; first != last; ++first)
32165: new (static_cast<void*>(&*first))
32166: typename iterator_traits<ForwardIterator>::value_type(x);
32167: 20.7.11.4 uninitialized_fill_n [uninitialized.fill.n] 
32168: template <class ForwardIterator, class Size, class T>
32169: void uninitialized_fill_n(ForwardIterator first, Size n, const T& x);
32170: 1 Effects: 
32171: for (; n--; ++first)
32172: new (static_cast<void*>(&*first))
32173: typename iterator_traits<ForwardIterator>::value_type(x);
32174: 20.7.12 Class template unique_ptr [unique.ptr] 
32175: 1 Template unique_ptr stores a pointer to an object and deletes that object using the associated deleter 
32176: when it is itself destroyed (such as when leaving block scope (6.7)). 
32177: 2 The unique_ptr provides a semantics of strict ownership. A unique_ptr owns the object it holds a 
32178: pointer to. A unique_ptr is not CopyConstructible, nor CopyAssignable, however it is MoveConstructible 
32179: and MoveAssignable. The template parameter T of unique_ptr may be an incomplete type. [ Note: 
32180: The uses of unique_ptr include providing exception safety for dynamically allocated memory, pass-
32181: ing ownership of dynamically allocated memory to a function, and returning dynamically allocated 
32182: memory from a function. 〞end note ] 
32183: ∫ 20.7.12 610 
32184: 
32185: c
32186: . ISO/IEC N2800=08-0310 
32187: namespace std {
32188: template<class T> struct default_delete;
32189: template<class T> struct default_delete<T[]>;
32190: template<class T, class D = default_delete<T>> class unique_ptr;
32191: template<class T, class D> class unique_ptr<T[], D>;
32192: template<class T, class D> void swap(unique_ptr<T, D>& x, unique_ptr<T, D>& y); 
32193: template<class T, class D> void swap(unique_ptr<T, D>&& x, unique_ptr<T, D>& y); 
32194: template<class T, class D> void swap(unique_ptr<T, D>& x, unique_ptr<T, D>&& y); 
32195: template<class T1, class D1, class T2, class D2> 
32196: bool operator==(const unique_ptr<T1, D1>& x, const unique_ptr<T2, D2>& y); 
32197: template<class T1, class D1, class T2, class D2> 
32198: bool operator!=(const unique_ptr<T1, D1>& x, const unique_ptr<T2, D2>& y); 
32199: template<class T1, class D1, class T2, class D2> 
32200: bool operator<(const unique_ptr<T1, D1>& x, const unique_ptr<T2, D2>& y); 
32201: template<class T1, class D1, class T2, class D2> 
32202: bool operator<=(const unique_ptr<T1, D1>& x, const unique_ptr<T2, D2>& y); 
32203: template<class T1, class D1, class T2, class D2> 
32204: bool operator>(const unique_ptr<T1, D1>& x, const unique_ptr<T2, D2>& y); 
32205: template<class T1, class D1, class T2, class D2> 
32206: bool operator>=(const unique_ptr<T1, D1>& x, const unique_ptr<T2, D2>& y); 
32207: } 
32208: 20.7.12.1 Default deleters [unique.ptr.dltr] 
32209: 20.7.12.1.1 default_delete [unique.ptr.dltr.dflt] 
32210: namespace std { 
32211: template <class T> struct default_delete {
32212: default_delete();
32213: template <class U> default_delete(const default_delete<U>&);
32214: void operator()(T*) const;
32215: };
32216: }
32217: default_delete(); 
32218: Effects: Default constructs a default_delete. 
32219: template <class U> default_delete(const default_delete<U>& other); 
32220: 1 Effects: Constructs a default_delete from a default_delete<U>. 
32221: void operator()(T *ptr) const; 
32222: 2 Effects: calls delete on ptr. A diagnostic is required if T is an incomplete type. 
32223: 20.7.12.1.2 default_delete<T[]> [unique.ptr.dltr.dflt1] 
32224: namespace std {
32225: template <class T> struct default_delete<T[]> {
32226: void operator()(T*) const;
32227: };
32228: }
32229: ∫ 20.7.12.1.2 611 
32230: 
32231: c
32232: . ISO/IEC N2800=08-0310 
32233: void operator()(T* ptr) const; 
32234: 1 operator() calls delete[] on ptr. A diagnostic is required if T is an incomplete type. 
32235: 20.7.12.1.3 default_delete<T[N]> [unique.ptr.dltr.dflt2] 
32236: 20.7.12.2 unique_ptr for single objects [unique.ptr.single] 
32237: namespace std {
32238: template <class T, class D = default_delete<T>> class unique_ptr {
32239: public:
32240: typedef implementation-defined pointer;
32241: typedef T element_type;
32242: typedef D deleter_type;
32243: // constructors 
32244: unique_ptr();
32245: explicit unique_ptr(pointer p);
32246: unique_ptr(pointer p, implementation-defined d);
32247: unique_ptr(pointer p, implementation-defined d);
32248: unique_ptr(uniquePtr&& u);
32249: unique_ptr(nullptr_t) : unique_ptr() { }
32250: template <class U, class E> unique_ptr(unique_ptr<U, E>&& u);
32251: // destructor 
32252: unique_ptr(); 
32253: // assignment 
32254: unique_ptr& operator=(unique_ptr&& u);
32255: template <class U, class E> unique_ptr& operator=(unique_ptr<U, E>&& u);
32256: unique_ptr& operator=(unspecified-pointer-type);
32257: // observers 
32258: typename add_lvalue_reference<T>::type operator*() const;
32259: pointer operator->() const;
32260: pointer get() const;
32261: deleter_type& get_deleter();
32262: const deleter_type& get_deleter() const;
32263: explicit operator bool() const;
32264: // modifiers 
32265: pointer release();
32266: void reset(pointer p = pointer());
32267: void swap(unique_ptr&& u);
32268: // disable copy from lvalue 
32269: unique_ptr(const unique_ptr&) = delete;
32270: template <class U, class E> unique_ptr(const unique_ptr<U, E>&) = delete;
32271: unique_ptr& operator=(const unique_ptr&) = delete;
32272: template <class U, class E> unique_ptr& operator=(const unique_ptr<U, E>&) = delete;
32273: };
32274: }
32275: 1 The default type for the template parameter D is default_delete. A client-supplied template argu-
32276: ment D shall be a function pointer or functor for which, given a value d of type D and a pointer ptr 
32277: ∫ 20.7.12.2 612 
32278: 
32279: c
32280: . ISO/IEC N2800=08-0310 
32281: of type T*, the expression d(ptr) is valid and has the effect of deallocating the pointer as appropriate 
32282: for that deleter. D may also be an lvalue-reference to a deleter. 
32283: 2 If the deleter D maintains state, it is intended that this state stay with the associated pointer as 
32284: ownership is transferred from unique_ptr to unique_ptr. The deleter state need never be copied, 
32285: only moved or swapped as pointer ownership is moved around. That is, the deleter need only be 
32286: MoveConstructible, MoveAssignable, and Swappable, and need not be CopyConstructible (unless 
32287: copied into the unique_ptr) nor CopyAssignable. 
32288: 3 If the type remove_reference<D>::type::pointer exists, then unique_ptr<T, D>::pointer shall 
32289: be a synonym for remove_reference<D>::type::pointer. Otherwise unique_ptr<T, D>::pointer 
32290: shall be a synonym for T*. The type unique_ptr<T, D>::pointer shall be CopyConstructible (Ta-
32291: ble 20.1.8) and CopyAssignable (Table 20.1.8). 
32292: 20.7.12.2.1 unique_ptr constructors [unique.ptr.single.ctor] 
32293: unique_ptr(); 
32294: 1 Requires: D shall be default constructible, and that construction shall not throw an exception. D 
32295: shall not be a reference type or pointer type (diagnostic required). 
32296: 2 Effects: Constructs a unique_ptr which owns nothing. 
32297: 3 Postconditions: get() == 0. get_deleter() returns a reference to a default constructed deleter 
32298: D.
32299: 4 Throws: nothing.
32300: unique_ptr(pointer p); 
32301: 5 Requires: D shall be default constructible, and that construction shall not throw an exception.
32302: 6 Effects: Constructs a unique_ptr which owns p.
32303: 7 Postconditions: get() == p. get_deleter() returns a reference to a default constructed deleter
32304: D.
32305: 8 Throws: nothing.
32306: unique_ptr(pointer p, implementation-defined d);
32307: unique_ptr(pointer p, implementation-defined d);
32308: 9 The signature of these constructors depends upon whether D is a reference type or not. If D is 
32309: non-reference type A, then the signatures are: 
32310: unique_ptr(pointer p, const A& d);
32311: unique_ptr(pointer p, A&& d);
32312: 10 If D is an lvalue-reference type A&, then the signatures are: 
32313: unique_ptr(pointer p, A& d);
32314: unique_ptr(pointer p, A&& d);
32315: 11 If D is an lvalue-reference type const A&, then the signatures are: 
32316: unique_ptr(pointer p, const A& d);
32317: unique_ptr(pointer p, const A&& d);
32318: 12 Requires: If D is not an lvalue-reference type then 
32319: ∫ 20.7.12.2.1 613 
32320: 
32321: c
32322: . ISO/IEC N2800=08-0310 
32323: 〞 If d is an lvalue or const rvalue then the first constructor of this pair will be selected. D must 
32324: be CopyConstructible (Table 20.1.8), and this unique_ptr will hold a copy of d. The copy 
32325: constructor of D shall not throw an exception. 
32326: 〞 Otherwise d is a non-const rvalue and the second constructor of this pair will be selected. 
32327: D need only be MoveConstructible (Table 20.1.8), and this unique_ptr will hold a value 
32328: move constructed from d. The move constructor of D shall not throw an exception. 
32329: 13 Otherwise D is an lvalue-reference type. d shall be reference-compatible with one of the construc-
32330: tors. If d is an rvalue, it will bind to the second constructor of this pair. That constructor shall 
32331: emit a diagnostic. [ Note: The diagnostic could be implemented using a static_assert which 
32332: assures that D is not a reference type. 〞 end note ] Else d is an lvalue and will bind to the 
32333: first constructor of this pair. The type which D references need not be CopyConstructible nor 
32334: MoveConstructible. This unique_ptr will hold a D which refers to the lvalue d.[ Note: D may 
32335: not be an rvalue-reference type. 〞end note ] 
32336: 14 Postconditions: get() == p. get_deleter() returns a reference to the internally stored deleter. 
32337: If D is a reference type then get_deleter() returns a reference to the lvalue d. 
32338: 15 Throws: nothing. 
32339: [ Example: 
32340: D d; 
32341: unique_ptr<int, D> p1(new int, D()); // D must be MoveConstructible 
32342: unique_ptr<int, D> p2(new int, d); // D must be Copyconstructible 
32343: unique_ptr<int, D&> p3(new int, d); // p3 holds a reference to d 
32344: unique_ptr<int, const D&> p4(new int, D()); // error: rvalue deleter object combined 
32345: // with reference deleter type 
32346: 〞end example ] 
32347: unique_ptr(unique_ptr&& u); 
32348: 16 Requires: If the deleter is not a reference type, construction of the deleter D from an rvalue D shall 
32349: not throw an exception. 
32350: 17 Effects: Constructs a unique_ptr which owns the pointer which u owns (if any). If the deleter 
32351: is not a reference type, it is move constructed from u＊s deleter, otherwise the reference is copy 
32352: constructed from u＊s deleter. After the construction, u no longer owns a pointer. [ Note: The 
32353: deleter constructor can be implemented with std::forward<D>. 〞end note ] 
32354: 18 Postconditions: get() == value u.get() had before the construction. get_deleter() returns 
32355: a reference to the internally stored deleter which was constructed from u.get_deleter(). If D 
32356: is a reference type then get_deleter() and u.get_deleter() both reference the same lvalue 
32357: deleter. 
32358: 19 Throws: nothing. 
32359: template <class U, class E> unique_ptr(unique_ptr<U, E>&& u); 
32360: 20 Requires: If D is not a reference type, construction of the deleter D from an rvalue of type E shall 
32361: be well formed and shall not throw an exception. If D is a reference type, then E shall be the same 
32362: type as D (diagnostic required). unique_ptr<U, E>::pointer shall be implicitly convertible to 
32363: pointer.[ Note: These requirements imply that T and U are complete types. 〞end note ] 
32364: 21 Effects: Constructs a unique_ptr which owns the pointer which u owns (if any). If the deleter 
32365: is not a reference type, it is move constructed from u＊s deleter, otherwise the reference is copy 
32366: ∫ 20.7.12.2.1 614 
32367: 
32368: c
32369: . ISO/IEC N2800=08-0310 
32370: constructed from u＊s deleter. After the construction, u no longer owns a pointer. [ Note: The 
32371: deleter constructor can be implemented with std::forward<D>. 〞end note ] 
32372: 22 Postconditions: get() == value u.get() had before the construction, modulo any required off-
32373: set adjustments resulting from the cast from unique_ptr<U, E>::pointer to pointer. get_-
32374: deleter() returns a reference to the internally stored deleter which was constructed from u.get_-
32375: deleter(). 
32376: 23 Throws: nothing. 
32377: 20.7.12.2.2 unique_ptr destructor [unique.ptr.single.dtor] 
32378: unique_ptr(); 
32379: 1 Requires: The expression get_deleter()(get()) shall be well formed, shall have well-defined 
32380: behavior, and shall not throw exceptions. [ Note: The use of default_delete requires T to be a 
32381: complete type. 〞end note ] 
32382: 2 Effects: If get() == 0 there are no effects. Otherwise get_deleter()(get()). 
32383: 3 Throws: nothing. 
32384: 20.7.12.2.3 unique_ptr assignment [unique.ptr.single.asgn] 
32385: unique_ptr& operator=(unique_ptr&& u); 
32386: 1 Requires: Assignment of the deleter D from an rvalue D shall not throw an exception. 
32387: 2 Effects: reset(u.release()) followed by a move assignment from u＊s deleter to this deleter. 
32388: 3 Postconditions: This unique_ptr now owns the pointer which u owned, and u no longer owns 
32389: it. [ Note: If D is a reference type, then the referenced lvalue deleters are move assigned. 〞end 
32390: note ] 
32391: 4 Returns: *this. 
32392: 5 Throws: nothing. 
32393: template <class U, class E> unique_ptr& operator=(unique_ptr<U, E>&& u); 
32394: 6 Requires: Assignment of the deleter D from an rvalue D shall not throw an exception. unique_-
32395: ptr<U, E>::pointer shall be implicitly convertible to pointer.[ Note: These requirements 
32396: imply that T and U are complete types. 〞end note ] 
32397: 7 Effects: reset(u.release()) followed by a move assignment from u＊s deleter to this deleter. 
32398: If either D or E is a reference type, then the referenced lvalue deleter participates in the move 
32399: assignment. 
32400: 8 Postconditions: This unique_ptr now owns the pointer which u owned, and u no longer owns it. 
32401: 9 Returns: *this. 
32402: 10 Throws: nothing. 
32403: unique_ptr& operator=(unspecified-pointer-type); 
32404: Assigns from the literal 0 or NULL.[ Note: The unspecified-pointer-type is often implemented as a 
32405: pointer to a private data member, avoiding many of the implicit conversion pitfalls. 〞 end note ] 
32406: 11 Effects: reset(). 
32407: ∫ 20.7.12.2.3 615 
32408: 
32409: c
32410: . ISO/IEC N2800=08-0310 
32411: 12 Postcondition: get() == 0 
32412: 13 Returns: *this. 
32413: 14 Throws: nothing. 
32414: 20.7.12.2.4 unique_ptr observers [unique.ptr.single.observers] 
32415: typename add_lvalue_reference<T>::type operator*() const; 
32416: 1 Requires: get() != 0.
32417: 2 Returns: *get().
32418: 3 Throws: nothing.
32419: pointer operator->() const; 
32420: 4 Requires: get() != 0.
32421: 5 Returns: get().
32422: 6 Throws: nothing.
32423: 7 Note: use typically requires that T be a complete type.
32424: pointer get() const; 
32425: 8 Returns: The stored pointer.
32426: 9 Throws: nothing.
32427: deleter_type& get_deleter();
32428: const deleter_type& get_deleter() const;
32429: 10 Returns: A reference to the stored deleter. 
32430: 11 Throws: nothing. 
32431: explicit operator bool() const; 
32432: 12 Returns: get() != 0. 
32433: 13 Throws: nothing. 
32434: 20.7.12.2.5 unique_ptr modifiers [unique.ptr.single.modifiers] 
32435: pointer release(); 
32436: 1 Postcondition: get() == 0.
32437: 2 Returns: The value get() had at the start of the call to release.
32438: 3 Throws: nothing.
32439: void reset(pointer p = pointer()); 
32440: 4 Requires: The expression get_deleter()(get()) shall be well formed, shall have well-defined 
32441: behavior, and shall not throw exceptions. 
32442: 5 Effects: If get() == 0 there are no effects. Otherwise get_deleter()(get()). 
32443: 6 Postconditions: get() == p. 
32444: ∫ 20.7.12.2.5 616 
32445: 
32446: c
32447: . ISO/IEC N2800=08-0310 
32448: 7 Throws: nothing. 
32449: void swap(unique_ptr&& u); 
32450: 8 Requires: The deleter D shall be Swappable and shall not throw an exception under swap. 
32451: 9 Effects: The stored pointers of this and u are exchanged. The stored deleters are swap＊d (un-
32452: qualified). 
32453: 10 Throws: nothing. 
32454: 20.7.12.3 unique_ptr for array objects with a runtime length [unique.ptr.runtime] 
32455: namespace std {
32456: template <class T, class D> class unique_ptr<T[], D> {
32457: public:
32458: typedef implementation-defined pointer;
32459: typedef T element_type;
32460: typedef D deleter_type;
32461: // constructors 
32462: unique_ptr();
32463: explicit unique_ptr(pointer p);
32464: unique_ptr(pointer p, implementation-defined d);
32465: unique_ptr(pointer p, implementation-defined d);
32466: unique_ptr(uniquePtr&& u);
32467: unique_ptr(nullptr_t) : unique_ptr() { }
32468: // destructor 
32469: unique_ptr(); 
32470: // assignment 
32471: unique_ptr& operator=(unique_ptr&& u);
32472: unique_ptr& operator=(unspecified-pointer-type);
32473: // observers 
32474: T& operator[](size_t i) const;
32475: pointer get() const;
32476: deleter_type& get_deleter();
32477: const deleter_type& get_deleter() const;
32478: explicit operator bool() const;
32479: // modifiers 
32480: pointer release();
32481: void reset(pointer p = pointer());
32482: void swap(unique_ptr&& u);
32483: // disable copy from lvalue 
32484: unique_ptr(const unique_ptr&) = delete;
32485: unique_ptr& operator=(const unique_ptr&) = delete;
32486: };
32487: }
32488: 1 A specialization for array types is provided with a slightly altered interface. 
32489: 〞 Conversions among different types of unique_ptr<T[], D> or to or from the non-array forms of 
32490: unique_ptr are disallowed (diagnostic required). 
32491: ∫ 20.7.12.3 617 
32492: 
32493: . ISO/IEC N2800=08-0310 
32494: 〞 Pointers to types derived from T are rejected by the constructors, and by reset. 
32495: 〞 The observers operator* and operator-> are not provided. 
32496: 〞 The indexing observer operator[] is provided. 
32497: 〞 The default deleter will call delete[]. 
32498: 2 Descriptions are provided below only for member functions that have behavior different from the 
32499: primary template. 
32500: 3 The template argument T shall be a complete type. 
32501: 20.7.12.3.1 unique_ptr constructors [unique.ptr.runtime.ctor] 
32502: unique_ptr(pointer p);
32503: unique_ptr(pointer p, implementation-defined d);
32504: unique_ptr(pointer p, implementation-defined d);
32505: These constructors behave the same as in the primary template except that they do not accept 
32506: pointer types which are convertible to pointer.[ Note: One implementation techniqueis to create 
32507: private templated overloads of these members. 〞end note ] 
32508: 20.7.12.3.2 unique_ptr observers [unique.ptr.runtime.observers] 
32509: T& operator[](size_t i) const; 
32510: 1 Requires: i< the size of the array to which the stored pointer points.
32511: 2 Returns: get()[i].
32512: 3 Throws: nothing.
32513: 20.7.12.3.3 unique_ptr modifiers [unique.ptr.runtime.modifiers] 
32514: void reset(pointer p = pointer()); 
32515: 1 Requires: Does not accept pointer types which are convertible to pointer (diagnostic required). 
32516: [ Note: One implementation technique is to create a private templated overload. 〞 end note ] 
32517: 2 Effects: If get() == 0 there are no effects. Otherwise get_deleter()(get()). 
32518: 3 Postcondition: get() == p. 
32519: 4 Throws: nothing. 
32520: 20.7.12.4 unique_ptr specialized algorithms [unique.ptr.special] 
32521: template <class T, class D> void swap(unique_ptr<T, D>& x, unique_ptr<T, D>& y); 
32522: template <class T, class D> void swap(unique_ptr<T, D>&& x, unique_ptr<T, D>& y); 
32523: template <class T, class D> void swap(unique_ptr<T, D>& x, unique_ptr<T, D>& y); 
32524: 1 Effects: Calls x.swap(y). 
32525: template <class T1, class D1, class T2, class D2>
32526: bool operator==(const unique_ptr<T1, D1>& x, const unique_ptr<T2, D2>& y);
32527: 2 Returns: x.get() == y.get(). 
32528: ∫ 20.7.12.4 618 
32529: 
32530: c
32531: . ISO/IEC N2800=08-0310 
32532: template <class T1, class D1, class T2, class D2>
32533: bool operator!=(const unique_ptr<T1, D1>& x, const unique_ptr<T2, D2>& y);
32534: 3 Returns: x.get() != y.get(). 
32535: template <class T1, class D1, class T2, class D2>
32536: bool operator<(const unique_ptr<T1, D1>& x, const unique_ptr<T2, D2>& y);
32537: 4 Returns: x.get() < y.get(). 
32538: template <class T1, class D1, class T2, class D2>
32539: bool operator<=(const unique_ptr<T1, D1>& x, const unique_ptr<T2, D2>& y);
32540: 5 Returns: x.get() <= y.get(). 
32541: template <class T1, class D1, class T2, class D2>
32542: bool operator>(const unique_ptr<T1, D1>& x, const unique_ptr<T2, D2>& y);
32543: 6 Returns: x.get() > y.get(). 
32544: template <class T1, class D1, class T2, class D2>
32545: bool operator>=(const unique_ptr<T1, D1>& x, const unique_ptr<T2, D2>& y);
32546: 7 Returns: x.get() >= y.get(). 
32547: 20.7.13 Smart pointers [util.smartptr] 
32548: 20.7.13.1 Class bad_weak_ptr [util.smartptr.weakptr] 
32549: namespace std {
32550: class bad_weak_ptr: public std::exception {
32551: public:
32552: bad_weak_ptr();
32553: };
32554: } // namespace std
32555: 1 An exception of type bad_weak_ptr is thrown by the shared_ptr constructor taking a weak_ptr. 
32556: bad_weak_ptr(); 
32557: 2 Postconditions: what() returns "bad_weak_ptr". 
32558: 3 Throws: nothing. 
32559: 20.7.13.2 Class template shared_ptr [util.smartptr.shared] 
32560: 1 The shared_ptr class template stores a pointer, usually obtained via new. shared_ptr implements 
32561: semantics of shared ownership; the last remaining owner of the pointer is responsible for destroying the 
32562: object, or otherwise releasing the resources associated with the stored pointer. A shared_ptr object 
32563: is empty if it does not own a pointer. 
32564: namespace std {
32565: template<class T> class shared_ptr {
32566: public:
32567: typedef T element_type; 
32568: // 20.7.13.2.1, constructors: 
32569: shared_ptr(); 
32570: ∫ 20.7.13.2 619 
32571: 
32572: c
32573: . ISO/IEC N2800=08-0310 
32574: template<class Y> explicit shared_ptr(Y* p);
32575: template<class Y, class D> shared_ptr(Y* p, D d);
32576: template<class Y, class D, class A> shared_ptr(Y* p, D d, A a);
32577: template<class Y> shared_ptr(const shared_ptr<Y>& r, T *p);
32578: shared_ptr(const shared_ptr& r);
32579: template<class Y> shared_ptr(const shared_ptr<Y>& r);
32580: shared_ptr(shared_ptr&& r);
32581: template<class Y> shared_ptr(shared_ptr<Y>&& r);
32582: template<class Y> explicit shared_ptr(const weak_ptr<Y>& r);
32583: template<class Y> explicit shared_ptr(auto_ptr<Y>&& r);
32584: template <class Y, class D> explicit shared_ptr(const unique_ptr<Y, D>& r) = delete;
32585: template <class Y, class D> explicit shared_ptr(unique_ptr<Y, D>&&) r};
32586: shared_ptr(nullptr_t) : shared_ptr() { }
32587: // 20.7.13.2.2, destructor: 
32588: ~shared_ptr(); 
32589: // 20.7.13.2.3, assignment: 
32590: shared_ptr& operator=(const shared_ptr& r);
32591: template<class Y> shared_ptr& operator=(const shared_ptr<Y>& r);
32592: shared_ptr& operator=(shared_ptr&& r);
32593: template<class Y> shared_ptr& operator=(shared_ptr<Y>&& r);
32594: template<class Y> shared_ptr& operator=(auto_ptr<Y>&& r);
32595: template <class Y, class D> shared_ptr& operator=(const unique_ptr<Y, D>& r) = delete;
32596: template <class Y, class D> shared_ptr& operator=(unique_ptr<Y, D>&& r);
32597: // 20.7.13.2.4, modifiers: 
32598: void swap(shared_ptr&& r);
32599: void reset();
32600: template<class Y> void reset(Y* p);
32601: template<class Y, class D> void reset(Y* p, D d);
32602: template<class Y, class D, class A> void reset(Y* p, D d, A a);
32603: // 20.7.13.2.5, observers: 
32604: T* get() const;
32605: T& operator*() const;
32606: T* operator->() const;
32607: long use_count() const;
32608: bool unique() const;
32609: explicit operator bool() const;
32610: template <class U> bool owner_before(shared_ptr<U> const& b) const;
32611: template <class U> bool owner_before(weak_ptr<U> const& b) const;
32612: }; 
32613: // 20.7.13.2.6, shared_ptr creation 
32614: template<class T, class... Args> shared_ptr<T> make_shared(Args&&... args); 
32615: template<class T, class A, class... Args> 
32616: shared_ptr<T> allocate_shared(const A& a, Args&&... args); 
32617: // 20.7.13.2.7, shared_ptr comparisons: 
32618: template<class T, class U>
32619: bool operator==(const shared_ptr<T>& a, const shared_ptr<U>& b);
32620: template<class T, class U>
32621: bool operator!=(const shared_ptr<T>& a, const shared_ptr<U>& b);
32622: template<class T, class U>
32623: ∫ 20.7.13.2 620 
32624: 
32625: c
32626: . ISO/IEC N2800=08-0310 
32627: bool operator<(const shared_ptr<T>& a, const shared_ptr<U>& b); 
32628: // 20.7.13.2.8, shared_ptr I/O: 
32629: template<class E, class T, class Y> 
32630: basic_ostream<E, T>& operator<< (basic_ostream<E, T>& os, const shared_ptr<Y>& p); 
32631: // 20.7.13.2.9, shared_ptr specialized algorithms: 
32632: template<class T> void swap(shared_ptr<T>& a, shared_ptr<T>& b);
32633: template<class T> void swap(shared_ptr<T>&& a, shared_ptr<T>& b);
32634: template<class T> void swap(shared_ptr<T>& a, shared_ptr<T>&& b);
32635: // 20.7.13.2.10, shared_ptr casts: 
32636: template<class T, class U>
32637: shared_ptr<T> static_pointer_cast(const shared_ptr<U>& r);
32638: template<class T, class U>
32639: shared_ptr<T> dynamic_pointer_cast(const shared_ptr<U>& r);
32640: template<class T, class U>
32641: shared_ptr<T> const_pointer_cast(const shared_ptr<U>& r);
32642: // 20.7.13.2.11, shared_ptr get_deleter: 
32643: template<class D, class T> D* get_deleter(const shared_ptr<T>& p);
32644: } // namespace std
32645: 2 Specializations of shared_ptr shall be CopyConstructible, Assignable, and LessThanComparable, 
32646: allowing their use in standard containers. Specializations of shared_ptr shall be convertible to bool, 
32647: allowing their use in boolean expressions and declarations in conditions. The template parameter T of 
32648: shared_ptr may be an incomplete type. 
32649: 3 [ Example: 
32650: if(shared_ptr<X> px = dynamic_pointer_cast<X>(py)) { 
32651: // do something with px 
32652: } 
32653: 〞end example ] 
32654: 20.7.13.2.1 shared_ptr constructors [util.smartptr.shared.const] 
32655: shared_ptr(); 
32656: 1 Effects: Constructs an empty shared_ptr object. 
32657: 2 Postconditions: use_count() == 0 && get() == 0. 
32658: 3 Throws: nothing. 
32659: template<class Y> explicit shared_ptr(Y* p); 
32660: 4 Requires: p shall be convertible to T*. Y shall be a complete type. The expression delete p shall 
32661: be well formed, shall have well defined behavior, and shall not throw exceptions. 
32662: 5 Effects: Constructs a shared_ptr object that owns the pointer p. 
32663: 6 Postconditions: use_count() == 1 && get() == p. 
32664: 7 Throws: bad_alloc, or an implementation-defined exception when a resource other than memory 
32665: could not be obtained. 
32666: 8 Exception safety: If an exception is thrown, delete p is called. 
32667: ∫ 20.7.13.2.1 621 
32668: 
32669: c
32670: . ISO/IEC N2800=08-0310 
32671: template<class Y, class D> shared_ptr(Y* p, D d);
32672: template<class Y, class D, class A> shared_ptr(Y* p, D d, A a);
32673: 9 Requires: p shall be convertible to T*. D shall be CopyConstructible. The copy constructor and 
32674: destructor of D shall not throw exceptions. The expression d(p) shall be well formed, shall have 
32675: well defined behavior, and shall not throw exceptions. A shall be an allocator (20.7.2.2). The 
32676: copy constructor and destructor of A shall not throw exceptions. 
32677: 10 Effects: Constructs a shared_ptr object that owns the pointer p and the deleter d. The second 
32678: constructor shall use a copy of a to allocate memory for internal use. 
32679: 11 Postconditions: use_count() == 1 && get() == p. 
32680: 12 Throws: bad_alloc, or an implementation-defined exception when a resource other than memory 
32681: could not be obtained. 
32682: 13 Exception safety: If an exception is thrown, d(p) is called. 
32683: template<class Y> shared_ptr(const shared_ptr<Y>& r, T *p); 
32684: 14 Effects: Constructs a shared_ptr instance that stores p and shares ownership with r. 
32685: 15 Postconditions: get() == p && use_count() == r.use_count() 
32686: 16 Throws: nothing. 
32687: 17 [ Note: to avoid the possibility of a dangling pointer, the user of this constructor must ensure that 
32688: p remains valid at least until the ownership group of r is destroyed. 〞end note ] 
32689: 18 [ Note: this constructor allows creation of an empty shared_ptr instance with a non-NULL stored 
32690: pointer. 〞end note ] 
32691: shared_ptr(const shared_ptr& r);
32692: template<class Y> shared_ptr(const shared_ptr<Y>& r);
32693: 19 Requires: The second constructor shall not participate in the overload resolution unless Y* is 
32694: implicitly convertible to T*. 
32695: 20 Effects: If r is empty, constructs an empty shared_ptr object; otherwise, constructs a shared_-
32696: ptr object that shares ownership with r. 
32697: 21 Postconditions: get() == r.get() && use_count() == r.use_count(). 
32698: 22 Throws: nothing. 
32699: shared_ptr(shared_ptr&& r);
32700: template<class Y> shared_ptr(shared_ptr<Y>&& r);
32701: 23 Requires: For the second constructor Y* shall be convertible to T*.
32702: 24 Effects: Move-constructs a shared_ptr instance from r.
32703: 25 Postconditions: *this shall contain the old value of r. r shall be empty. r.get() == 0.
32704: 26 Throws: nothing.
32705: template<class Y> explicit shared_ptr(const weak_ptr<Y>& r); 
32706: 27 Requires: Y* shall be convertible to T*. 
32707: 28 Effects: Constructs a shared_ptr object that shares ownership with r and stores a copy of the 
32708: pointer stored in r. 
32709: ∫ 20.7.13.2.1 622 
32710: 
32711: c
32712: . ISO/IEC N2800=08-0310 
32713: 29 Postconditions: use_count() == r.use_count().
32714: 30 Throws: bad_weak_ptr when r.expired().
32715: 31 Exception safety: If an exception is thrown, the constructor has no effect.
32716: template<class Y> explicit shared_ptr(auto_ptr<Y>&& r); 
32717: 32 Requires: r.release() shall be convertible to T*. Y shall be a complete type. The expression 
32718: delete r.release() shall be well formed, shall have well defined behavior, and shall not throw 
32719: exceptions. 
32720: 33 Effects: Constructs a shared_ptr object that stores and owns r.release(). 
32721: 34 Postconditions: use_count() == 1 && r.get() == 0. 
32722: 35 Throws: bad_alloc, or an implementation-defined exception when a resource other than memory 
32723: could not be obtained. 
32724: 36 Exception safety: If an exception is thrown, the constructor has no effect. 
32725: template <class Y, class D> explicit shared_ptr(unique_ptr<Y, D>&&r); 
32726: 37 Effects: Equivalent to shared_ptr(r.release(), r.get_deleter()) when D is not a reference 
32727: type, otherwise shared_ptr(r.release(), ref(r.get_deleter())). 
32728: 38 Exception safety: If an exception is thrown, the constructor has no effect. 
32729: 20.7.13.2.2 shared_ptr destructor [util.smartptr.shared.dest] 
32730: ~shared_ptr(); 
32731: 1 Effects: 
32732: 〞 If *this is empty or shares ownership with another shared_ptr instance (use_count() > 
32733: 1), there are no side effects. 
32734: 〞 Otherwise, if *this owns a pointer p and a deleter d, d(p) is called. 
32735: 〞 Otherwise, *this owns a pointer p, and delete p is called. 
32736: 2 Throws: nothing. 
32737: 3 [ Note: Since the destruction of *this decreases the number of instances that share ownership with 
32738: *this by one, after *this has been destroyed all shared_ptr instances that shared ownership with 
32739: *this will report a use_count() that is one less than its previous value. 〞end note ] 
32740: 20.7.13.2.3 shared_ptr assignment [util.smartptr.shared.assign] 
32741: shared_ptr& operator=(const shared_ptr& r);
32742: template<class Y> shared_ptr& operator=(const shared_ptr<Y>& r);
32743: template<class Y> shared_ptr& operator=(auto_ptr<Y>&& r);
32744: 1 Effects: Equivalent to shared_ptr(r).swap(*this). 
32745: 2 Returns: *this. 
32746: 3 [ Note: The use count updates caused by the temporary object construction and destruction 
32747: are not observable side effects, so the implementation may meet the effects (and the implied 
32748: guarantees) via different means, without creating a temporary. In particular, in the example: 
32749: ∫ 20.7.13.2.3 623 
32750: 
32751: c
32752: . ISO/IEC N2800=08-0310 
32753: shared_ptr<int> p(new int);
32754: shared_ptr<void> q(p);
32755: p = p;
32756: q = p;
32757: both assignments may be no-ops. 〞end note ] 
32758: shared_ptr& operator=(shared_ptr&& r);
32759: template<class Y> shared_ptr& operator=(shared_ptr<Y>&& r);
32760: 4 Effects: Equivalent to shared_ptr(std::move(r)).swap(*this). 
32761: 5 Returns: *this. 
32762: template <class Y, class D> shared_ptr& operator=(unique_ptr<Y, D>&& r); 
32763: 6 Effects: Equivalent to shared_ptr(std::move(r)).swap(*this). 
32764: 7 Returns: *this 
32765: 20.7.13.2.4 shared_ptr modifiers [util.smartptr.shared.mod] 
32766: void swap(shared_ptr&& r); 
32767: 1 Effects: Exchanges the contents of *this and r. 
32768: 2 Throws: nothing. 
32769: void reset(); 
32770: 3 Effects: Equivalent to shared_ptr().swap(*this). 
32771: template<class Y> void reset(Y* p); 
32772: 4 Effects: Equivalent to shared_ptr(p).swap(*this). 
32773: template<class Y, class D> void reset(Y* p, D d); 
32774: 5 Effects: Equivalent to shared_ptr(p, d).swap(*this). 
32775: template<class Y, class D, class A> void reset(Y* p, D d, A a); 
32776: 6 Effects: Equivalent to shared_ptr(p, d, a).swap(*this). 
32777: 20.7.13.2.5 shared_ptr observers [util.smartptr.shared.obs] 
32778: T* get() const; 
32779: 1 Returns: the stored pointer. Returns a null pointer if *this is empty. 
32780: 2 Throws: nothing. 
32781: T& operator*() const; 
32782: 3 Requires: get() != 0. 
32783: 4 Returns: *get(). 
32784: 5 Throws: nothing. 
32785: ∫ 20.7.13.2.5 624 
32786: 
32787: c
32788: . ISO/IEC N2800=08-0310 
32789: 6 Remarks: When T is void, it is unspecified whether this member function is declared. If it
32790: is declared, it is unspecified what its return type is, except that the declaration (although not
32791: necessarily the definition) of the function shall be well formed.
32792: T* operator->() const; 
32793: 7 Requires: get() != 0.
32794: 8 Returns: get().
32795: 9 Throws: nothing.
32796: long use_count() const; 
32797: 10 Returns: the number of shared_ptr objects, *this included, that share ownership with *this, 
32798: or 0 when *this is empty. 
32799: 11 Throws: nothing. 
32800: 12 [ Note: use_count() is not necessarily efficient. 〞end note ] 
32801: bool unique() const; 
32802: 13 Returns: use_count() == 1.
32803: 14 Throws: nothing.
32804: 15 [ Note: unique() may be faster than use_count(). If you are using unique() to implement copy
32805: on write, do not rely on a specific value when get() == 0. 〞end note ] 
32806: explicit operator bool() const; 
32807: 16 Returns: get() != 0. 
32808: 17 Throws: nothing. 
32809: template <class U> bool owner_before(shared_ptr<U> const& b) const;
32810: template <class U> bool owner_before(weak_ptr<U> const& b) const;
32811: 18 Returns: an unspecified value such that 
32812: 〞 x.owner_before(y) defines a strict weak ordering (25.3); 
32813: 〞 under the equivalence relation defined by owner_before, !a.owner_before(b) && !b.owner_-
32814: before(a), two shared_ptr or weak_ptr instances are equivalent if and only if they share 
32815: ownership or are both empty. 
32816: 20.7.13.2.6 shared_ptr creation [util.smartptr.shared.create] 
32817: template<class T, class... Args> shared_ptr<T> make_shared(Args&&... args);
32818: template<class T, class A, class... Args>
32819: shared_ptr<T> allocate_shared(const A& a, Args&&... args);
32820: 1 Requires: The expression new (pv) T(std::forward<Args>(args)...), where pv has type void* 
32821: and points to storage suitable to hold an object of type T, shall be well formed. A shall be an 
32822: allocator (20.7.2.2). The copy constructor and destructor of A shall not throw exceptions. 
32823: 2 Effects: Allocates memory suitable for an object of type T and constructs an objectin that memory 
32824: via the placement new expression new (pv) T() or new (pv) T(std::forward<Args>(args)...). 
32825: ∫ 20.7.13.2.6 625 
32826: 
32827: c
32828: . ISO/IEC N2800=08-0310 
32829: The template allocate_shared uses a copy of a to allocate memory. If an exception is thrown, 
32830: the functions have no effect. 
32831: 3 Returns: A shared_ptr instance that stores and owns the address of the newly constructed object 
32832: of type T. 
32833: 4 Postconditions: get() != 0 && use_count() == 1 
32834: 5 Throws: bad_alloc, or an exception thrown from A::allocate or from the constructor of T. 
32835: 6 Remarks: Implementations are encouraged, but not required, to perform no more than one mem-
32836: ory allocation. [ Note: this provides efficiency equivalent to an intrusive smart pointer. 〞end 
32837: note ] 
32838: 7 [ Note: these functions will typically allocate more memory than sizeof(T) to allow for internal 
32839: bookkeeping structures such as the reference counts. 〞end note ] 
32840: 20.7.13.2.7 shared_ptr comparison [util.smartptr.shared.cmp] 
32841: template<class T, class U> bool operator==(const shared_ptr<T>& a, const shared_ptr<U>& b); 
32842: 1 Returns: a.get() == b.get(). 
32843: 2 Throws: nothing. 
32844: template<class T, class U> bool operator<(const shared_ptr<T>& a, const shared_ptr<U>& b); 
32845: 3 Returns: a.get() < b.get() 
32846: 4 For templates greater, less, greater_equal, and less_equal, the partial specializations for shared_-
32847: ptr yield a total order, even if the built-in operators <, >, <=, >= do not. Moreover, less<shared_-
32848: ptr<T>>:: operator()(a, b) shall return std::less<T*>::operator()(a.get(), b.get()). 
32849: 5 Throws: nothing. 
32850: 6 [ Note: Defining a comparison operator allows shared_ptr objects to be used as keys in associative 
32851: containers. 〞end note ] 
32852: 20.7.13.2.8 shared_ptr I/O [util.smartptr.shared.io] 
32853: template<class E, class T, class Y>
32854: basic_ostream<E, T>& operator<< (basic_ostream<E, T>& os, shared_ptr<Y> const& p);
32855: 1 Effects: os << p.get();. 
32856: 2 Returns: os. 
32857: 20.7.13.2.9 shared_ptr specialized algorithms [util.smartptr.shared.spec] 
32858: template<class T> void swap(shared_ptr<T>& a, shared_ptr<T>& b);
32859: template<class T> void swap(shared_ptr<T>&& a, shared_ptr<T>& b);
32860: template<class T> void swap(shared_ptr<T>& a, shared_ptr<T>&& b);
32861: 1 Effects: Equivalent to a.swap(b). 
32862: 2 Throws: nothing. 
32863: ∫ 20.7.13.2.9 626 
32864: 
32865: c
32866: . ISO/IEC N2800=08-0310 
32867: 20.7.13.2.10 shared_ptr casts [util.smartptr.shared.cast] 
32868: template<class T, class U> shared_ptr<T> static_pointer_cast(const shared_ptr<U>& r); 
32869: 1 Requires: The expression static_cast<T*>(r.get()) shall be well formed.
32870: 2 Returns: If r is empty, an empty shared_ptr<T>; otherwise, a shared_ptr<T> object that stores
32871: static_cast<T*>(r.get()) and shares ownership with r.
32872: 3 Postconditions: w.get() == static_cast<T*>(r.get()) and w.use_count() == r.use_count(),
32873: where w is the return value.
32874: 4 Throws: nothing.
32875: 5 [ Note: The seemingly equivalent expression shared_ptr<T>(static_cast<T*>(r.get())) will even
32876: 
32877: tually 
32878: result in undefined behavior, attempting to delete the same object twice. 〞end note ] 
32879: template<class T, class U> shared_ptr<T> dynamic_pointer_cast(const shared_ptr<U>& r); 
32880: 6 Requires: The expression dynamic_cast<T*>(r.get()) shall be well formed and shall have welldefined
32881: behavior.
32882: 7 Returns: 
32883: 〞 When dynamic_cast<T*>(r.get()) returns a nonzero value, a shared_ptr<T> object that stores 
32884: a copy of it and shares ownership with r; 
32885: 〞 Otherwise, an empty shared_ptr<T> object.
32886: 8 Postcondition: w.get() == dynamic_cast<T*>(r.get()), where w is the return value.
32887: 9 Throws: nothing.
32888: 10 [ Note: The seemingly equivalent expression shared_ptr<T>(dynamic_cast<T*>(r.get())) will even-
32889: tually result in undefined behavior, attempting to delete the same object twice. 〞end note ] 
32890: template<class T, class U> shared_ptr<T> const_pointer_cast(const shared_ptr<U>& r); 
32891: 11 Requires: The expression const_cast<T*>(r.get()) shall be well formed. 
32892: 12 Returns: If r is empty, an empty shared_ptr<T>; otherwise, a shared_ptr<T> object that stores 
32893: const_cast<T*>(r.get()) and shares ownership with r. 
32894: 13 Postconditions: w.get() == const_cast<T*>(r.get()) and w.use_count() == r.use_count(), where 
32895: w is the return value. 
32896: 14 Throws: nothing. 
32897: 15 [ Note: The seemingly equivalent expression shared_ptr<T>(const_cast<T*>(r.get())) will even-
32898: tually result in undefined behavior, attempting to delete the same object twice. 〞end note ] 
32899: 20.7.13.2.11 get_deleter [util.smartptr.getdeleter] 
32900: template<class D, class T> D* get_deleter(const shared_ptr<T>& p); 
32901: 1 Returns: If p owns a deleter d of type cv-unqualified D, returns &d; otherwise returns 0. The returned
32902: pointer remains valid as long as there exists a shared_ptr instance that owns d.[ Note: It is unspecified
32903: whether the pointer remains valid longer than that. This can happen if the implementation doesn＊t
32904: destroy the deleter until all weak_ptr instances that share ownership with p have been destroyed.
32905: 〞 end note ] 
32906: ∫ 20.7.13.2.11 627 
32907: 
32908: c
32909: . ISO/IEC N2800=08-0310 
32910: 2 Throws: nothing. 
32911: 20.7.13.3 Class template weak_ptr [util.smartptr.weak] 
32912: 1 The weak_ptr class template stores a weak reference to an object that is already managed by a shared_ptr. 
32913: To access the object, a weak_ptr can be converted to a shared_ptr using the member function lock. 
32914: namespace std {
32915: template<class T> class weak_ptr {
32916: public:
32917: typedef T element_type; 
32918: // constructors 
32919: weak_ptr();
32920: template<class Y> weak_ptr(shared_ptr<Y> const& r);
32921: weak_ptr(weak_ptr const& r);
32922: template<class Y> weak_ptr(weak_ptr<Y> const& r);
32923: // destructor 
32924: ~weak_ptr(); 
32925: // assignment 
32926: weak_ptr& operator=(weak_ptr const& r);
32927: template<class Y> weak_ptr& operator=(weak_ptr<Y> const& r);
32928: template<class Y> weak_ptr& operator=(shared_ptr<Y> const& r);
32929: // modifiers 
32930: void swap(weak_ptr& r);
32931: void reset();
32932: // observers 
32933: long use_count() const;
32934: bool expired() const;
32935: shared_ptr<T> lock() const;
32936: template<class U> bool owner_before(const shared_ptr<U>& b);
32937: template<class U> bool owner_before(const weak_ptr<U>& b);
32938: // comparisons 
32939: template <class Y> bool operator<(weak_ptr<Y> const&) const = delete;
32940: template <class Y> bool operator<=(weak_ptr<Y> const&) const = delete;
32941: template <class Y> bool operator>(weak_ptr<Y> const&) const = delete;
32942: template <class Y> bool operator>=(weak_ptr<Y> const&) const = delete;
32943: }; 
32944: // specialized algorithms 
32945: template<class T> void swap(weak_ptr<T>& a, weak_ptr<T>& b);
32946: } // namespace std
32947: 2 Specializations of weak_ptr shall be CopyConstructible, Assignable, and LessThanComparable, allowing 
32948: their use in standard containers. The template parameter T of weak_ptr may be an incomplete type. 
32949: 20.7.13.3.1 weak_ptr constructors [util.smartptr.weak.const] 
32950: weak_ptr(); 
32951: 1 Effects: Constructs an empty weak_ptr object. 
32952: ∫ 20.7.13.3.1 628 
32953: 
32954: c
32955: . ISO/IEC N2800=08-0310 
32956: 2 Postconditions: use_count() == 0. 
32957: 3 Throws: nothing. 
32958: weak_ptr(const weak_ptr& r);
32959: template<class Y> weak_ptr(const weak_ptr<Y>& r);
32960: template<class Y> weak_ptr(const shared_ptr<Y>& r);
32961: 4 Requires: The second and third constructors shall not participate in the overload resolution unless Y* 
32962: is implicitly convertible to T*. 
32963: 5 Effects: If r is empty, constructs an empty weak_ptr object; otherwise, constructs a weak_ptr object 
32964: that shares ownership with r and stores a copy of the pointer stored in r. 
32965: 6 Postconditions: use_count() == r.use_count(). 
32966: 7 Throws: nothing. 
32967: 20.7.13.3.2 weak_ptr destructor 
32968: ~weak_ptr(); 
32969: 1 Effects: Destroys this weak_ptr object but has no effect on the object 
32970: [util.smartptr.weak.dest] 
32971: its stored pointer points to. 
32972: [util.smartptr.weak.assign] 
32973: 2 Throws: nothing. 
32974: 20.7.13.3.3 weak_ptr assignment 
32975: weak_ptr& operator=(const weak_ptr& r);
32976: template<class Y> weak_ptr& operator=(const weak_ptr<Y>& r);
32977: template<class Y> weak_ptr& operator=(const shared_ptr<Y>& r);
32978: 1 Effects: Equivalent to weak_ptr(r).swap(*this).
32979: 2 Throws: nothing.
32980: 3 Remarks: The implementation may meet the effects (and the
32981: without creating a temporary. 
32982: 20.7.13.3.4 weak_ptr modifiers 
32983: void swap(weak_ptr& r); 
32984: 1 Effects: Exchanges the contents of *this and r. 
32985: 2 Throws: nothing. 
32986: void reset(); 
32987: 3 Effects: Equiv